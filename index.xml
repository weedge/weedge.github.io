<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>æ—¶é—´é£˜è¿‡</title>
    <link>https://weedge.github.io/</link>
    <description>Recent content on æ—¶é—´é£˜è¿‡</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Sun, 19 Jan 2025 10:26:23 +0800</lastBuildDate>
    
        <atom:link href="https://weedge.github.io/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>About</title>
      <link>https://weedge.github.io/about/</link>
      <pubDate>Tue, 01 Jan 2013 21:38:52 +0800</pubDate>
      
      <guid>https://weedge.github.io/about/</guid>
      
        <description>
&lt;link rel=&#34;stylesheet&#34; href=&#34;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css&#34;&gt;
&lt;style type=&#34;text/css&#34;&gt;.dark-theme .aplayer{background:#212121}.dark-theme .aplayer.aplayer-withlist .aplayer-info{border-bottom-color:#5c5c5c}.dark-theme .aplayer.aplayer-fixed .aplayer-list{border-color:#5c5c5c}.dark-theme .aplayer .aplayer-body{background-color:#212121}.dark-theme .aplayer .aplayer-info{border-top-color:#212121}.dark-theme .aplayer .aplayer-info .aplayer-music .aplayer-title{color:#fff}.dark-theme .aplayer .aplayer-info .aplayer-music .aplayer-author{color:#fff}.dark-theme .aplayer .aplayer-info .aplayer-controller .aplayer-time{color:#eee}.dark-theme .aplayer .aplayer-info .aplayer-controller .aplayer-time .aplayer-icon path{fill:#eee}.dark-theme .aplayer .aplayer-list{background-color:#212121}.dark-theme .aplayer .aplayer-list::-webkit-scrollbar-thumb{background-color:#999}.dark-theme .aplayer .aplayer-list::-webkit-scrollbar-thumb:hover{background-color:#bbb}.dark-theme .aplayer .aplayer-list li{color:#fff;border-top-color:#666}.dark-theme .aplayer .aplayer-list li:hover{background:#4e4e4e}.dark-theme .aplayer .aplayer-list li.aplayer-list-light{background:#6c6c6c}.dark-theme .aplayer .aplayer-list li .aplayer-list-index{color:#ddd}.dark-theme .aplayer .aplayer-list li .aplayer-list-author{color:#ddd}.dark-theme .aplayer .aplayer-lrc{text-shadow:-1px -1px 0 #666}.dark-theme .aplayer .aplayer-lrc:before{background:-moz-linear-gradient(top, #212121 0%, rgba(33,33,33,0) 100%);background:-webkit-linear-gradient(top, #212121 0%, rgba(33,33,33,0) 100%);background:linear-gradient(to bottom, #212121 0%, rgba(33,33,33,0) 100%);filter:progid:DXImageTransform.Microsoft.gradient( startColorstr=&#39;#212121&#39;, endColorstr=&#39;#00212121&#39;,GradientType=0 )}.dark-theme .aplayer .aplayer-lrc:after{background:-moz-linear-gradient(top, rgba(33,33,33,0) 0%, rgba(33,33,33,0.8) 100%);background:-webkit-linear-gradient(top, rgba(33,33,33,0) 0%, rgba(33,33,33,0.8) 100%);background:linear-gradient(to bottom, rgba(33,33,33,0) 0%, rgba(33,33,33,0.8) 100%);filter:progid:DXImageTransform.Microsoft.gradient( startColorstr=&#39;#00212121&#39;, endColorstr=&#39;#cc212121&#39;,GradientType=0 )}.dark-theme .aplayer .aplayer-lrc p{color:#fff}.dark-theme .aplayer .aplayer-miniswitcher{background:#484848}.dark-theme .aplayer .aplayer-miniswitcher .aplayer-icon path{fill:#eee}&lt;/style&gt;
&lt;script src=&#34;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js&#34;&gt;&lt;/script&gt;

&lt;script src=&#34;https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js&#34;&gt;&lt;/script&gt;&lt;meting-js server=&#34;netease&#34; type=&#34;playlist&#34; id=&#34;304060&#34; theme=&#34;#2980b9&#34;&gt;&lt;/meting-js&gt;
&lt;blockquote&gt;
&lt;p&gt;æˆé•¿å‹å¥¶çˆ¸ï¼Œä¿æŒå¥½å¥‡å¿ƒï¼Œé™ªå°æœ‹å‹ä¸€èµ·é•¿å¤§ï¼›&lt;/p&gt;
&lt;p&gt;å¯¹åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œæœºå™¨æ€ä¹ˆå­¦ä¹ å’Œåº”ç”¨ï¼Œåº•å±‚æœªçŸ¥çš„ä¸œä¸œæ„Ÿå…´è¶£ï¼›ä¸å–œæ¬¢è´´æ ‡ç­¾ï¼Œè¯„è®ºè‡ªå·±å’Œä»–äººï¼Œäººç”Ÿæ²¡æœ‰é™å®šã€‚&lt;/p&gt;
&lt;p&gt;æ–°å¹´æ„¿æœ›ï¼šèº«ä½“å¥åº·ï¼Œå–œä¹å‘è´¢ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;äººç”Ÿ&#34;&gt;äººç”Ÿ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;â€œç‰©æ¥é¡ºåº”ï¼Œæœªæ¥ä¸è¿ï¼Œå½“æ—¶ä¸æ‚ï¼Œæ—¢è¿‡ä¸æ‹â€ â€“ æ›¾å›½è—©&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;â€œYesterday is a history, tomorrow is a mystery, only today is a gift, that is why we call it present. &amp;quot; â€“ åŠŸå¤«ç†ŠçŒ« (inner peace)&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;Hope is the good thing and maybe the best of things And no good things ever dies ~ Andy Dufresne â€“ Shawshank Redemption&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;è§„å¾‹&#34;&gt;è§„å¾‹&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;â€è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢â€œ â€“ å±ˆåŸã€Šç¦»éªšã€‹&lt;/li&gt;
&lt;li&gt;â€œä¼—é‡Œå¯»ä»–åƒç™¾åº¦ã€‚è“¦ç„¶å›é¦–ï¼Œé‚£äººå´åœ¨ï¼Œç¯ç«é˜‘çŠå¤„â€ â€“ è¾›å¼ƒç–¾ã€Šé’ç‰æ¡ˆÂ·å…ƒå¤•ã€‹&lt;/li&gt;
&lt;li&gt;â€œé“ç”Ÿä¸€ï¼Œä¸€ç”ŸäºŒï¼ŒäºŒç”Ÿä¸‰ï¼Œä¸‰ç”Ÿä¸‡ç‰©â€ â€“ è€å­ã€Šé“å¾·ç»ã€‹&lt;/li&gt;
&lt;li&gt;â€œ&lt;strong&gt;ä¸‡ç‰©ä¹‹å§‹ï¼Œå¤§é“è‡³ç®€ï¼Œè¡åŒ–è‡³ç¹&lt;/strong&gt;â€ â€“ è€å­ã€Šé“å¾·ç»ã€‹&lt;/li&gt;
&lt;/ol&gt;
</description>
      
    </item>
    
    <item>
      <title>è®ºæ–‡è§£è¯»ï¼šFish-Speech: Leveraging Large Language Models for Advanced Multilingual Text-to-Speech Synthesis</title>
      <link>https://weedge.github.io/post/multimoding/voices/fishspeech/</link>
      <pubDate>Sun, 19 Jan 2025 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/multimoding/voices/fishspeech/</guid>
      
        <description>&lt;h2 id=&#34;ç›¸å…³è®ºæ–‡&#34;&gt;ç›¸å…³è®ºæ–‡&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;base&lt;/strong&gt;: åŸºç¡€æ™®é€‚ç ”ç©¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;hourglass transformers: &lt;a href=&#34;https://arxiv.org/abs/2110.13711&#34;&gt;2021. Hierarchical Transformers Are More Efficient Language Models&lt;/a&gt; | &lt;a href=&#34;https://github.com/lucidrains/simple-hierarchical-transformer&#34;&gt;lucidrains/simple-hierarchical-transformer&lt;/a&gt; vanilla layers and shortened layers use GPT  AR  GLM ğŸ¤&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2305.07185&#34;&gt;2023.5 &lt;strong&gt;MEGABYTE: Predicting Million-byte Sequences with Multiscale Transformers&lt;/strong&gt;&lt;/a&gt; (åˆ†åˆ«åœ¨æ–‡æœ¬ï¼Œå›¾ç‰‡ï¼Œè¯­éŸ³å»ºæ¨¡)| &lt;a href=&#34;https://github.com/lucidrains/MEGABYTE-pytorch&#34;&gt;lucidrains/MEGABYTE-pytorch&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;PS: æƒ³æ³•å’Œè‡ªå·±æ•´ç†çš„&lt;a href=&#34;https://github.com/ai-bot-pro/baby-llm/tree/main/simpleLM&#34;&gt;simple LM&lt;/a&gt;ç›¸ä¼¼~&lt;/p&gt;
&lt;p&gt;æ‰©å±•é˜…è¯»ï¼š&lt;a href=&#34;https://arxiv.org/abs/2412.09871&#34;&gt;2024.12 &lt;strong&gt;Byte Latent Transformer: Patches Scale Better Than Tokens&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://github.com/facebookresearch/blt&#34;&gt;paper code&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;audio speech&lt;/strong&gt;: åœºæ™¯ç ”ç©¶&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;â­ï¸&lt;a href=&#34;https://arxiv.org/abs/2310.00704&#34;&gt;2023.10 UniAudio: &lt;strong&gt;An Audio Foundation Model Toward Universal Audio Generation&lt;/strong&gt;&lt;/a&gt; (çµæ„Ÿæ¥è‡ª MEGABYTEï¼Œå°†å…¶åº”ç”¨äºè¯­éŸ³æ¨¡å‹)| &lt;a href=&#34;https://github.com/yangdongchao/UniAudio&#34;&gt;paper code&lt;/a&gt;  (ä»£ç å¯æ‰©å±•ä»»åŠ¡è¿›è¡Œè®­ç»ƒ, å·²æ‰©å±•äº†éŸ³ä¹æ•°æ®)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/d0bc3097-3daa-47db-8bbb-f24f5aec800d&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;â­ï¸&lt;a href=&#34;https://arxiv.org/abs/2411.01156&#34;&gt;2024. &lt;strong&gt;Fish-Speech: Leveraging Large Language Models for Advanced Multilingual Text-to-Speech Synthesis&lt;/strong&gt;&lt;/a&gt; (è®ºæ–‡ä¸­ä»‹ç»çš„Daul-AR, GFSQ, Firefly-GAN(FF-GAN) å¯¹EVA-GANæ”¹ç‰ˆï¼Œç»†èŠ‚éœ€è¦ç»“åˆä»£ç ç†è§£) | &lt;a href=&#34;https://github.com/fishaudio/fish-speech&#34;&gt;paper code&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ‰©å±•é˜…è¯»&#34;&gt;æ‰©å±•é˜…è¯»&lt;/h2&gt;
&lt;h3 id=&#34;neural-vocoder&#34;&gt;&lt;strong&gt;Neural&lt;/strong&gt; Vocoder&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://arxiv.org/abs/1609.03499&#34;&gt;2016.9 &lt;strong&gt;WaveNet: A Generative Model for Raw Audio&lt;/strong&gt;&lt;/a&gt; (é¦–æ¬¡å¼•å…¥äº†ç”¨äºéŸ³é¢‘ç”Ÿæˆçš„è‡ªå›å½’æ¨¡å‹(CNN+LSTM))| &lt;a href=&#34;https://github.com/vincentherrmann/pytorch-wavenet&#34;&gt;pytorch code&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;â­ï¸&lt;a href=&#34;https://arxiv.org/abs/2010.05646&#34;&gt;2020.10 &lt;strong&gt;HiFi-GAN: Generative Adversarial Networks for Efficient and High Fidelity Speech Synthesis&lt;/strong&gt;&lt;/a&gt; (å¼•å…¥äº†å¯¹æŠ—æ€§è®­ç»ƒï¼Œåœ¨éŸ³é¢‘è´¨é‡å’Œè®¡ç®—æ•ˆç‡æ–¹é¢æ ‘ç«‹äº†æ–°æ ‡å‡†, multi-scale discriminator (MSD) +   multi-period discriminator (MPD)) | &lt;a href=&#34;https://github.com/jik876/hifi-gan&#34;&gt;paper code&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;HiFi-Gan Generator(Decoder)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/8b09b501-bfef-48eb-b823-ba8d78307c31&#34; alt=&#34;HiFi-Gan Generator&#34;&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;inference speed&lt;/strong&gt;&lt;/em&gt;ï¼š(æ¨¡å‹å‚æ•°å°ï¼Œé€‚åˆå®æ—¶åœ¨çº¿åœºæ™¯ä¸‹çš„ç ”ç©¶ï¼ŒéŸ©å›½å’Œæ—¥æœ¬æ¯”è¾ƒå…³æ³¨(ä¸“æ³¨)è¿™ä¸ªæ–¹é¢)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://arxiv.org/abs/2306.00814&#34;&gt;2023.6 &lt;strong&gt;Vocos: Closing the gap between time-domain and Fourier-based neural vocoders for high-quality audio synthesis&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://github.com/gemelo-ai/vocos&#34;&gt;paper code&lt;/a&gt; | æ¨ç†é€Ÿåº¦å¿«ï¼šè¿è¡Œé€Ÿåº¦æ¯” HiFi-GAN å¿«çº¦ 13 å€ï¼Œæ¯” BigVGAN å¿«è¿‘ 70 å€ã€‚åœ¨æ²¡æœ‰ GPU åŠ é€Ÿçš„æƒ…å†µä¸‹è¿è¡Œæ—¶ï¼Œè¿™ç§é€Ÿåº¦ä¼˜åŠ¿å°¤å…¶æ˜æ˜¾ã€‚è¿™ä¸»è¦æ˜¯ç”±äºä½¿ç”¨äº†çŸ­æ—¶å‚…é‡Œå¶é€†å˜æ¢ï¼ˆISTFTï¼‰ç®—æ³•è€Œä¸æ˜¯è½¬ç½®å·ç§¯ã€‚è¿˜è¯„ä¼°äº† Vocos çš„ä¸€ä¸ªå˜ä½“ï¼Œå®ƒåˆ©ç”¨ ResBlock çš„æ‰©å¼ å·ç§¯è€Œä¸æ˜¯ ConvNeXt å—ã€‚åœ¨ GPU ä¸Šæ‰§è¡Œæ—¶ï¼Œæ·±åº¦å¯åˆ†ç¦»å·ç§¯å¯æä¾›é¢å¤–çš„åŠ é€Ÿã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://ieeexplore.ieee.org/document/10389765&#34;&gt;2023.12 &lt;strong&gt;WaveNeXt: ConvNeXt-Based Fast Neural Vocoder Without ISTFT layer&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://ast-astrec.nict.go.jp/demo_samples/asru_2023_okamoto/index.html&#34;&gt;demo samples&lt;/a&gt; | paper codeåŸºäº &lt;a href=&#34;https://arxiv.org/abs/2110.07840&#34;&gt;ESPNet2-TTS&lt;/a&gt;  | ä¸€ç§æ–°å‹çš„åŸºäºConvNeXtçš„å¿«é€Ÿç¥ç»å£°ç å™¨WaveNeXtï¼Œå®ƒé€šè¿‡æ›¿æ¢Vocosä¸­çš„é€†çŸ­æ—¶å‚…é‡Œå¶å˜æ¢ï¼ˆiSTFTï¼‰å±‚ä¸ºå¯è®­ç»ƒçš„çº¿æ€§å±‚ï¼Œç›´æ¥é¢„æµ‹è¯­éŸ³æ³¢å½¢æ ·æœ¬ï¼Œè€Œä¸ä¾èµ–äºSTFTé¢‘è°±ã€‚è¿™ä¸€æ”¹è¿›ä¸ä»…ä¿æŒäº†Vocosçš„å¿«é€Ÿæ¨ç†é€Ÿåº¦ï¼Œè¿˜æé«˜äº†è¯­éŸ³åˆæˆçš„è´¨é‡ã€‚æ–‡ç« è¿˜æ¢è®¨äº†å¦‚ä½•å°†WaveNeXtä¸åŸºäºJETSçš„ç«¯åˆ°ç«¯æ–‡æœ¬åˆ°è¯­éŸ³ï¼ˆE2E TTSï¼‰æ¡†æ¶é›†æˆï¼Œå¹¶ç ”ç©¶äº†é‡‡æ ·é¢‘ç‡ä¸º48kHzçš„å…¨å¸¦æ¨¡å‹ï¼ˆFull-band Modelï¼šèƒ½å¤Ÿå¤„ç†å’Œç”Ÿæˆè¦†ç›–æ•´ä¸ªéŸ³é¢‘é¢‘è°±èŒƒå›´çš„æ¨¡å‹ï¼Œé€šå¸¸æ˜¯æŒ‡èƒ½å¤Ÿå¤„ç†ä»æœ€ä½é¢‘åˆ°æœ€é«˜é¢‘çš„å®Œæ•´éŸ³é¢‘ä¿¡å·çš„æ¨¡å‹ï¼‰ã€‚å®éªŒç»“æœè¡¨æ˜ï¼ŒWaveNeXtåœ¨åˆ†æ-åˆæˆå’ŒE2E TTSæ¡ä»¶ä¸‹å‡ä¼˜äºVocosï¼ŒåŒæ—¶ä¿æŒäº†å¿«é€Ÿæ¨ç†çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/4a1eeaff-528f-4706-b5fc-210caea2c13b&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;Scaling&lt;/strong&gt;&lt;/em&gt;ï¼šï¼ˆæ¨¡å‹å‚æ•°å¤§ï¼Œé€‚åˆçº¿ä¸Šã€ç¦»çº¿åœºæ™¯ä¸‹é«˜è´¨é‡éŸ³é¢‘ç”Ÿæˆçš„ç ”ç©¶ï¼Œå›½å†…å’Œè€ç¾å–œæ¬¢ç ”ç©¶è¿™ä¸ªæ–¹å‘ï¼Œæ¢ç´¢æ¨¡å‹è¾¹ç•Œï¼Œæ³›åŒ–èƒ½åŠ›ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;NVIDIA &lt;a href=&#34;https://arxiv.org/abs/2206.04658&#34;&gt;2023. BigVGAN: A Universal Neural Vocoder with Large-Scale Training&lt;/a&gt; (scaling of datasets and models) 112M params and  LibriTTS dataset(low-fidelity 24kHz)ï¼Œhigh-fidelity out-of-distribution (OOD) generation without fine-tuning | &lt;a href=&#34;https://github.com/NVIDIA/BigVGAN&#34;&gt;paper code&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;â­ï¸NVIDIA &lt;a href=&#34;https://arxiv.org/abs/2402.00892&#34;&gt;2024.1 &lt;strong&gt;EVA-GAN: Enhanced Various Audio Generation via Scalable Generative Adversarial Networks&lt;/strong&gt;&lt;/a&gt;  (BigVGAN more model and data scaling) ~200M params and 36,000-hour HiFi (44.1kHz) dataset &lt;strong&gt;for music and singing generation&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;EVA-GAN as an advancement over HiFi-GANï¼Œcharacterized by a larger context window, an improved structure, increased capacity, and an expanded dataset.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Dataset Scaling: base (LJSpeech + LibriTTS + VCTK + M4Singer)   + &lt;a href=&#34;https://huggingface.co/datasets/fish-audio-private/hifi-16kh&#34;&gt;&lt;strong&gt;fish-audio-private/hifi-16kh&lt;/strong&gt;&lt;/a&gt; + &lt;a href=&#34;https://huggingface.co/datasets/fish-audio-private/playerfm-20000h&#34;&gt;&lt;strong&gt;fish-audio-private/playerfm-20000h&lt;/strong&gt;&lt;/a&gt; scaling 36,000 hour dataset&lt;/li&gt;
&lt;li&gt;Model Scaling: å°† EVA-GAN baseæ¨¡å‹ä¸­Generatorå‚æ•°ä» 16.3 Må‚æ•°æ‰©å¤§åˆ° EVA-GAN-big 174.4 M, æé«˜äº†é²æ£’æ€§å’Œæ•´ä½“æ€§èƒ½.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/eded57e5-67a3-45c0-8660-e97500ef2b3c&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;vq-vector-quantize-çŸ¢é‡é‡åŒ–&#34;&gt;VQ vector-quantize çŸ¢é‡é‡åŒ–&lt;/h2&gt;
&lt;p&gt;VQ è®©ä½ è„‘æ´å¤§å¼€~&lt;/p&gt;
&lt;p&gt;å¸¸ä¸ VAE, GAN æ¡†æ¶ï¼›Codec(tokenizer) ç»“åˆã€‚ä»¥åŠVector Compression storage and ANN search for Vector embeddingsã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/lucidrains/vector-quantize-pytorch&#34;&gt;https://github.com/lucidrains/vector-quantize-pytorch&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;vq-vaes&#34;&gt;VQ-VAEs&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;VQ-VAE æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/1711.00937&#34;&gt;2017.11 &lt;strong&gt;Neural Discrete Representation Learning&lt;/strong&gt; å€¼å¾—ç»†å“&lt;/a&gt; | &lt;a href=&#34;https://github.com/google-deepmind/sonnet/blob/v1/sonnet/python/modules/nets/vqvae.py&#34;&gt;paper code&lt;/a&gt;  (å°† VAE ä¸VQç›¸ç»“åˆä»¥è·å¾—ç¦»æ•£çš„æ½œåœ¨è¡¨ç¤º(discrete latent representation/variables)ï¼Œè®ºæ–‡ä¸­å°†VQ-VAEåº”ç”¨äºå›¾åƒ,éŸ³é¢‘,è§†é¢‘ æ— ç›‘ç£ç”Ÿæˆ)&lt;/p&gt;
&lt;p&gt;PSï¼šè¯­è¨€æœ¬è´¨ä¸Šæ˜¯ç¦»æ•£çš„ï¼Œç±»ä¼¼åœ°ï¼Œè¯­éŸ³é€šå¸¸è¡¨ç¤ºä¸ºç¬¦å·åºåˆ—ï¼Œå›¾åƒé€šå¸¸å¯ä»¥ç”¨è¯­è¨€ç®€æ´åœ°æè¿°ã€‚æ­¤å¤–ï¼Œç¦»æ•£è¡¨ç¤ºéå¸¸é€‚åˆå¤æ‚çš„æ¨ç†ã€è§„åˆ’å’Œé¢„æµ‹å­¦ä¹ ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœä¸‹é›¨ï¼Œæˆ‘ä¼šä½¿ç”¨é›¨ä¼ï¼‰ã€‚è™½ç„¶åœ¨æ·±åº¦å­¦ä¹ ä¸­ä½¿ç”¨ç¦»æ•£æ½œåœ¨å˜é‡å·²è¢«è¯æ˜å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œä½†å¯ä»¥ç”¨å¼ºå¤§çš„è‡ªå›å½’æ¨¡å‹æ¥å¯¹ç¦»æ•£å˜é‡çš„åˆ†å¸ƒè¿›è¡Œå»ºæ¨¡ï¼š&lt;a href=&#34;https://arxiv.org/abs/1609.03499&#34;&gt;2016.9 &lt;strong&gt;WaveNet: A Generative Model for Raw Audio&lt;/strong&gt;&lt;/a&gt; (é¦–å…ˆå¼•å…¥äº†ç”¨äºéŸ³é¢‘ç”Ÿæˆçš„è‡ªå›å½’æ¨¡å‹) ï¼ˆè°·æ­Œå¤§æ³•ï¼Œæ³•åŠ›æ— è¾¹~ï¼‰; åç»­è¿›è¡Œäº†æ‰©å±•ç ”ç©¶ VQ-VAE2 æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/1906.00446&#34;&gt;2019.6 Generating Diverse High-Fidelity Images with VQ-VAE-2&lt;/a&gt; (å¼•å…¥å¤šå°ºåº¦åˆ†å±‚VQ-VAEæ¥å¢å¼ºå±€éƒ¨ç‰¹å¾)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;RQ-VAE æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2203.01941&#34;&gt;2022.5 &lt;strong&gt;Autoregressive Image Generation using Residual Quantization&lt;/strong&gt;&lt;/a&gt; (ä½¿ç”¨Residual-VQ æ„é€ VAE)| &lt;a href=&#34;https://github.com/kakaobrain/rq-vae-transformer&#34;&gt;paper code&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Latent Quantization æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2305.18378&#34;&gt;2023.5 Disentanglement via Latent Quantization&lt;/a&gt; | &lt;a href=&#34;https://github.com/kylehkhsu/latent_quantization/blob/main/scripts/train_ae.py&#34;&gt;paper code&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;â­ï¸FSQ: &lt;a href=&#34;https://arxiv.org/abs/2309.15505&#34;&gt;2023.9 &lt;strong&gt;Finite Scalar Quantization: VQ-VAE Made Simple&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://github.com/google-research/google-research/tree/master/fsq&#34;&gt;paper code&lt;/a&gt; |  &lt;a href=&#34;https://github.com/lucidrains/vector-quantize-pytorch?#finite-scalar-quantization&#34;&gt;lucidrains/vector-quantize-pytorch?#finite-scalar-quantization&lt;/a&gt; ï¼ˆåœ¨å¤§å¤§ç®€åŒ–ç”Ÿæˆå»ºæ¨¡çš„çŸ¢é‡é‡åŒ–æ–¹å¼ï¼Œæ¶ˆé™¤æ‰¿è¯ºæŸå¤±ã€ç æœ¬ EMA æ›´æ–°çš„éœ€è¦ï¼Œå¹¶è§£å†³ç æœ¬å´©æºƒæˆ–åˆ©ç”¨ç‡ä¸è¶³çš„é—®é¢˜ã€‚å°†æ¯ä¸ªæ ‡é‡èˆå…¥ä¸ºå…·æœ‰ç›´é€šæ¢¯åº¦çš„ç¦»æ•£çº§åˆ«ï¼›codeæˆä¸ºè¶…ç«‹æ–¹ä½“ä¸­çš„å‡åŒ€ç‚¹ã€‚ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;VQ-VAE with Rotation Trick: &lt;a href=&#34;https://arxiv.org/abs/2410.06424&#34;&gt;2024.10 Restructuring Vector Quantization with the Rotation Trick&lt;/a&gt; (é€šè¿‡ VQ å±‚å¯¹æ¢¯åº¦è¿›è¡Œå˜æ¢ï¼Œä»¥ä¾¿è¾“å…¥å‘é‡å’Œé‡åŒ–è¾“å‡ºä¹‹é—´çš„ç›¸å¯¹è§’åº¦å’Œå¤§å°è¢«ç¼–ç åˆ°æ¢¯åº¦ä¸­)| &lt;a href=&#34;https://github.com/cfifty/rotation_trick&#34;&gt;paper code&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;vq-gans&#34;&gt;VQ-GANs&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;VQ-GAN æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2012.09841&#34;&gt;2021. &lt;strong&gt;Taming Transformers for High-Resolution Image Synthesis&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://github.com/CompVis/taming-transformers&#34;&gt;paper code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Improved VQ-GAN æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2110.04627&#34;&gt;2022. &lt;strong&gt;Vector-quantized Image Modeling with Improved VQGAN&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Latent Quantization æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2305.18378&#34;&gt;2023.5 Disentanglement via Latent Quantization&lt;/a&gt; | &lt;a href=&#34;https://github.com/kylehkhsu/latent_quantization/blob/main/scripts/train_gan.py&#34;&gt;paper code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;RVQ-GAN æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2306.06546&#34;&gt;2023.6 High-Fidelity Audio Compression with Improved RVQGAN&lt;/a&gt; |&lt;a href=&#34;https://github.com/descriptinc/descript-audio-codec&#34;&gt;paper code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;SimVQ æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2411.02038&#34;&gt;2024.11 &lt;strong&gt;Addressing Representation Collapse in Vector Quantized Models with One Linear Layer&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://github.com/youngsheen/SimVQ&#34;&gt;paper code&lt;/a&gt; |  &lt;a href=&#34;https://github.com/lucidrains/vector-quantize-pytorch?#sim-vq&#34;&gt;lucidrains/vector-quantize-pytorch?#sim-vq&lt;/a&gt; (ä½œè€…å‘ç°ç»“åˆRotation Trick å¹¶å°†çº¿æ€§æŠ•å½±æ‰©å±•ä¸ºå°å‹å•å±‚ MLP æ—¶ï¼Œæœ‰æ›´å¥½çš„æ•ˆæœ)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;audio-codec-with-vq&#34;&gt;Audio Codec with VQ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Residual-VQ (RVQ) æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2107.03312&#34;&gt;2021. &lt;strong&gt;SoundStream: An End-to-End Neural Audio Codec&lt;/strong&gt;&lt;/a&gt; (å¯åœ¨ç«¯ä¾§å•ä¸ª CPU çº¿ç¨‹æµå¼å®æ—¶è¿è¡Œï¼ŒåŠ ä¸Šç«¯ä¾§è‡ªç ”èŠ¯ç‰‡(FPGA,ARMæ¶æ„)è¿è¡Œæƒ…å†µå‘¢ï¼Ÿ) | &lt;a href=&#34;https://github.com/lucidrains/audiolm-pytorch/blob/main/audiolm_pytorch/soundstream.py&#34;&gt;audiolm_pytorch/soundstream&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GroupedResidualVQ æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2305.02765&#34;&gt;2023. HiFi-Codec: Group-residual Vector quantization for High Fidelity Audio Codec&lt;/a&gt;ï¼ˆå¯¹ç‰¹å¾ç»´åº¦ç»„è¿›è¡Œæ®‹å·® VQï¼Œæ˜¾ç¤ºå‡ºä¸ Meta çš„ &lt;a href=&#34;https://arxiv.org/abs/2210.13438&#34;&gt;Encodecæ¨¡å‹&lt;/a&gt;(ä½¿ç”¨RVQ) ç­‰æ•ˆçš„ç»“æœï¼ŒåŒæ—¶ä½¿ç”¨æ›´å°‘çš„ç æœ¬ï¼‰| &lt;a href=&#34;https://github.com/yangdongchao/AcademiCodec&#34;&gt;paper code&lt;/a&gt;  (fishspeech ä¹Ÿä½¿ç”¨äº†ç±»ä¼¼ç»„çš„æ–¹æ³•ï¼Œè¿ç”¨åœ¨FSQä¸­)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;RVQ-GAN æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2306.06546&#34;&gt;2023.6 High-Fidelity Audio Compression with Improved RVQGAN&lt;/a&gt; |&lt;a href=&#34;https://github.com/descriptinc/descript-audio-codec&#34;&gt;paper code&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SimVQ æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2411.02038&#34;&gt;2024.11.4 &lt;strong&gt;Addressing Representation Collapse in Vector Quantized Models with One Linear Layer&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://github.com/youngsheen/SimVQ&#34;&gt;paper code&lt;/a&gt; | &lt;a href=&#34;https://github.com/lucidrains/vector-quantize-pytorch?#sim-vq&#34;&gt;lucidrains/vector-quantize-pytorch?#sim-vq&lt;/a&gt; (ä½œè€…å‘ç°ç»“åˆRotation Trick å¹¶å°†çº¿æ€§æŠ•å½±æ‰©å±•ä¸ºå°å‹å•å±‚ MLP æ—¶ï¼Œæœ‰æ›´å¥½çš„æ•ˆæœ)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¡¨ç¤ºåç¼©é—®é¢˜&lt;/strong&gt;ï¼šåœ¨VQæ¨¡å‹ä¸­ï¼Œéšç€ä»£ç æœ¬ï¼ˆcodebookï¼‰å¤§å°çš„å¢åŠ ï¼Œä»£ç æœ¬çš„åˆ©ç”¨ç‡é™ä½ï¼Œå¯¼è‡´æ¨¡å‹æ€§èƒ½æ— æ³•æå‡ï¼Œè¿™å°±æ˜¯è¡¨ç¤ºåç¼©é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜é™åˆ¶äº†VQæ¨¡å‹åœ¨å¤§è§„æ¨¡è®­ç»ƒä¸­çš„å¯æ‰©å±•æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç°æœ‰çš„æ—¨åœ¨å‡è½»è¡¨ç¤ºåç¼©çš„æ–¹æ³•é€šå¸¸ä¼šä»¥ç‰ºç‰²æ¨¡å‹å®¹é‡ä¸ºä»£ä»·æ¥é™ä½æ½œåœ¨ç©ºé—´çš„ç»´åº¦ï¼Œä½†è¿™å¹¶ä¸èƒ½å®Œå…¨è§£å†³æ ¸å¿ƒé—®é¢˜ï¼Œæ¯”å¦‚FSQã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åœ¨è®ºæ–‡ç ”ç©¶ä¸­ï¼Œå¯¹ VQ æ¨¡å‹ä¸­çš„è¡¨ç¤ºåç¼©é—®é¢˜è¿›è¡Œäº†ç†è®ºåˆ†æï¼Œå¹¶å°†å…¶ä¸»è¦åŸå› ç¡®å®šä¸ºç æœ¬çš„ä¸ç›¸äº¤ä¼˜åŒ–ï¼Œå…¶ä¸­åªæœ‰ä¸€å°éƒ¨åˆ†ç å‘é‡é€šè¿‡æ¢¯åº¦ä¸‹é™è¿›è¡Œæ›´æ–°ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæå‡ºäº†&lt;strong&gt;SimVQ&lt;/strong&gt; ï¼Œè¿™æ˜¯ä¸€ç§é€šè¿‡åŸºäºå¯å­¦ä¹ æ½œåœ¨åŸºç¡€çš„çº¿æ€§å˜æ¢å±‚é‡æ–°å‚æ•°åŒ–ä»£ç å‘é‡çš„æ–°é¢–æ–¹æ³•ã€‚è¿™ç§å˜æ¢ä¼˜åŒ–äº†ç æœ¬è·¨è¶Šçš„&lt;em&gt;æ•´ä¸ªçº¿æ€§ç©ºé—´&lt;/em&gt;ï¼Œè€Œä¸æ˜¯ä»…ä»…æ›´æ–°æ™®é€š VQ æ¨¡å‹ä¸­æœ€è¿‘é‚»æœç´¢æ‰€é€‰æ‹©çš„&lt;em&gt;ç å‘é‡&lt;/em&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SimVQçš„ä¸€ä¸ªå…³é”®ä¼˜åŠ¿åœ¨äºï¼Œ&lt;strong&gt;å®ƒåœ¨ä»£ç æœ¬å¤§å°æ‰©å±•æ—¶èƒ½å¤ŸæŒç»­æå‡æ€§èƒ½ï¼Œè€Œä¼ ç»Ÿçš„VQæ¨¡å‹åœ¨è¿™ç§æƒ…å†µä¸‹å¾€å¾€ä¼šé‡åˆ°æ€§èƒ½ç“¶é¢ˆ&lt;/strong&gt;ã€‚è¿™&lt;strong&gt;ä½¿å¾—SimVQèƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”å¤§è§„æ¨¡è®­ç»ƒçš„éœ€æ±‚ï¼Œä¾‹å¦‚åœ¨å¤§å‹è¯­è¨€æ¨¡å‹ä¸­ä½œä¸ºå¤šæ¨¡æ€åˆ†è¯å™¨&lt;/strong&gt;ã€‚(CosyVoice2ä¸­çš„speech tokenizerç”¨çš„æ˜¯FSQ, åº”è¯¥å¯ä»¥æ›¿æ¢æˆæœ€æ–°çš„SimVQæ¥æŒ‰ç…§è®ºæ–‡ä¸­æåˆ°çš„è¯­éŸ³æ•°æ®LibriTTS-580h æµ‹è¯•éªŒè¯ä¸‹codebook size scaling)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/6f02f852-3ff1-4f50-b48d-25e7257e8872&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Residual FSQ from &lt;a href=&#34;https://arxiv.org/abs/2411.19842&#34;&gt;2024.11.29 Scaling Transformers for Low-Bitrate High-Quality Speech Coding&lt;/a&gt; | &lt;a href=&#34;https://github.com/Stability-AI/stable-codec&#34;&gt;paper code&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;visual-tokenizer-with-vq&#34;&gt;Visual Tokenizer with VQ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;3D-VQ from MAGVIT ( VQ-VAE æ¡†æ¶):  &lt;a href=&#34;https://arxiv.org/abs/2212.05199&#34;&gt;2023. MAGVIT: Masked Generative Video Transformer&lt;/a&gt; |&lt;a href=&#34;https://github.com/google-research/magvit&#34;&gt;paper code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Lookup-Free Quantization (LFQ)&lt;/strong&gt; from MAGVIT2 ( VQ-VAE æ¡†æ¶): &lt;a href=&#34;https://arxiv.org/abs/2310.05737&#34;&gt;2024.3 &lt;strong&gt;Language Model Beats Diffusion - Tokenizer is Key to Visual Generation&lt;/strong&gt;&lt;/a&gt; (LM(discrete latent) vs DDM(continuous latent)  å¾ˆå¥½çš„ä¸€ç¯‡è®ºæ–‡) | &lt;a href=&#34;https://github.com/lucidrains/magvit2-pytorch&#34;&gt;magvit2-pytorch code&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ç§æ–°çš„è§†é¢‘åˆ†è¯å™¨ï¼Œåœ¨ä¸‰ä¸ªæ–¹é¢ä¼˜äºä¹‹å‰æ€§èƒ½æœ€ä½³çš„è§†é¢‘åˆ†è¯å™¨ï¼šè§†è§‰ç”Ÿæˆã€è§†é¢‘å‹ç¼©å’ŒåŠ¨ä½œè¯†åˆ«ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€ç§æ–°é¢–çš„å…æŸ¥æ‰¾é‡åŒ–æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡å­¦ä¹ å¤§é‡è¯æ±‡æ¥æé«˜è¯­è¨€æ¨¡å‹çš„è§†è§‰ç”Ÿæˆè´¨é‡ã€‚&lt;/li&gt;
&lt;li&gt;è®ºæ–‡ä¸­çš„å®éªŒè¡¨æ˜ï¼Œå½“æä¾›ç›¸åŒçš„è®­ç»ƒæ•°æ®ã€ç­‰æ•ˆçš„æ¨¡å‹å¤§å°å’Œç›¸ä¼¼çš„è®­ç»ƒé¢„ç®—æ—¶ï¼Œè¯­è¨€æ¨¡å‹å¯ä»¥ä¼˜äº ImageNet ä¸Šçš„æ‰©æ•£æ¨¡å‹ã€‚&lt;/li&gt;
&lt;li&gt;æ ¹æ®ç”¨æˆ·ç ”ç©¶ï¼Œè§†é¢‘å‹ç¼©å™¨åœ¨ç›¸ä¼¼çš„æ¯”ç‰¹ç‡ä¸‹æ¯” HEVC(High Efficiency Video Coding H.265) å’Œä¸‹ä¸€ä»£video codec VVC (Versatile Video Coding H.266)å…·æœ‰æ›´å¥½çš„è´¨é‡ï¼ˆäººå·¥è¯„ä¼°ï¼‰ã€‚ä¸“ä¸ºè§†é¢‘ç”Ÿæˆè€Œè®¾è®¡çš„è§†è§‰åˆ†è¯å™¨çš„ç¬¬ä¸€æ¬¡æˆåŠŸå°è¯•ï¼Œä»¥è¾¾åˆ°ä¸æ ‡å‡†ç¼–è§£ç å™¨ç›¸å½“çš„ç»“æœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;BSQ (Binary Spherical Quantization) from &lt;a href=&#34;https://arxiv.org/abs/2406.07548&#34;&gt;2024.6 Image and Video Tokenization with Binary Spherical Quantization&lt;/a&gt; (BSQ vs  LFQ BSQ åœ¨é‡åŒ–è¯¯å·®ã€è®­ç»ƒæ•ˆç‡ã€ç†µè®¡ç®—å¤æ‚åº¦ä»¥åŠå®éªŒç»“æœç­‰æ–¹é¢å‡ä¼˜äº LFQï¼Œå°¤å…¶æ˜¯åœ¨é«˜ç»´åº¦å’Œé«˜åˆ†è¾¨ç‡æ•°æ®ä¸Šè¡¨ç°æ›´ä¸ºçªå‡º)|&lt;a href=&#34;https://github.com/zhaoyue-zephyrus/bsq-vit&#34;&gt;paper code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2409.04410&#34;&gt;2024.9 Open-MAGVIT2: An Open-Source Project Toward Democratizing Auto-regressive Visual Generation&lt;/a&gt; (å¯ä»¥ç»ƒç»ƒä¸¹ï¼Œçœ‹çœ‹æ•ˆæœ)| &lt;a href=&#34;https://github.com/TencentARC/Open-MAGVIT2&#34;&gt;paper code&lt;/a&gt; Open-MAGVIT2(SEED-Voken åé¢åˆå¼•å…¥ IBQ åå˜æˆäº† Visual Tokenizer) from magvit2-pytorch&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;IBQ&lt;/strong&gt; (Index Backpropagation Quantization) from &lt;a href=&#34;https://arxiv.org/abs/2412.02692&#34;&gt;2024.12 Taming Scalable Visual Tokenizer for Autoregressive Image Generation&lt;/a&gt; (è§£å†³äº†ç°æœ‰ VQ æ–¹æ³•åœ¨æ‰©å±•æ€§ä¸Šçš„ç“¶é¢ˆé—®é¢˜ï¼Œå®ç°äº†é«˜åˆ©ç”¨ç‡çš„å¤§è§„æ¨¡è§†è§‰æ ‡è®°åŒ–ï¼Œå¹¶åœ¨å›¾åƒé‡å»ºå’Œç”Ÿæˆä»»åŠ¡ä¸­å–å¾—äº†ä¼˜å¼‚çš„æ€§èƒ½ã€‚é€šè¿‡å…¨å±€æ›´æ–°ç­–ç•¥ï¼ŒIBQåœ¨æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹ä¸­ä¿æŒäº†è¾ƒé«˜çš„ç æœ¬åˆ©ç”¨ç‡ï¼ˆçº¦96%ï¼‰ï¼›IBQé¦–æ¬¡æˆåŠŸè®­ç»ƒäº†å¤§è§„æ¨¡ç æœ¬ï¼ˆ2Â¹â¸ï¼Œå³262,144ä¸ªç æœ¬å¤§å°ï¼‰å’Œé«˜ç»´åº¦ï¼ˆ256ç»´ï¼‰çš„è§†è§‰åˆ†è¯å™¨ï¼›ImageNet ä¸Šçš„å®éªŒè¡¨æ˜ï¼ŒIBQ èƒ½å¤Ÿå®ç°é«˜åˆ©ç”¨ç‡ã€å¤§è§„æ¨¡çš„è§†è§‰åˆ†è¯å™¨ï¼Œå¹¶åœ¨é‡å»º(è¿˜åŸä¿®å¤)ï¼ˆ1.00 rFIDï¼‰å’Œç”Ÿæˆ(åˆ›æ–°)ï¼ˆ2.05 gFIDï¼‰æ–¹é¢æé«˜æ€§èƒ½)| &lt;a href=&#34;https://github.com/TencentARC/SEED-Voken&#34;&gt;paper code&lt;/a&gt;  (scaling codebook size, code dimension and model size)&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;vector-compressionstorage-and-searchann-with-vq-for-vector-embeddings&#34;&gt;Vector Compression(storage) and Search(ANN) with VQ for Vector embeddings&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;QINCoï¼š&lt;a href=&#34;https://arxiv.org/abs/2401.14732&#34;&gt;2024. 5 Residual Quantization with Implicit Neural Codebooks&lt;/a&gt; | &lt;a href=&#34;https://github.com/facebookresearch/Qinco/tree/main/qinco_v1&#34;&gt;paper code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;QINCo2ï¼š&lt;a href=&#34;https://arxiv.org/abs/2501.03078&#34;&gt;2025.1 &lt;strong&gt;QINCo2: Vector Compression and Search with Improved Implicit Neural Codebooks&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://arxiv.org/abs/2501.03078&#34;&gt;paper code&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;fishspeech&#34;&gt;FishSpeech&lt;/h2&gt;
&lt;h3 id=&#34;ä¸»è¦è´¡çŒ®&#34;&gt;ä¸»è¦è´¡çŒ®&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;åˆ©ç”¨LLMså’ŒåŒAR ç»“æ„æ¥å–ä»£ä¼ ç»Ÿçš„G2P ï¼ˆæ–‡å­—åˆ°éŸ³ç´ çš„è½¬æ¢(Grapheme-to-Phoneme)ï¼‰è½¬æ¢ï¼Œæä¾›å¼ºå¤§ä¸”å¯æ‰©å±•çš„å¤šè¯­è¨€è¯­éŸ³åˆæˆ;&lt;/li&gt;
&lt;li&gt;FFGAN vocoder é›†æˆäº†å¤šç§çŸ¢é‡é‡åŒ–æŠ€æœ¯ï¼ˆGrouped Finite Scalar Vector Quantization, GFSQï¼‰ï¼Œä»¥ä¼˜åŒ–å‹ç¼©æ¯”å’Œç æœ¬åˆ©ç”¨ç‡æ¥å®ç°é«˜ä¿çœŸè¯­éŸ³åˆæˆ;&lt;/li&gt;
&lt;li&gt;ä¼˜åŒ–æ¨ç†ï¼Œåœ¨æ¶ˆè´¹çº§ NVIDIA RTX 4060 ç§»åŠ¨å¹³å°ä¸Šå®ç°äº†çº¦ 1:5 çš„å®æ—¶å› å­ï¼Œåœ¨é«˜æ€§èƒ½ NVIDIA RTX 4090 é…ç½®ä¸Šå®ç°äº† 1:15 çš„å®æ—¶å› å­ã€‚å»¶è¿Ÿä¸º 150 æ¯«ç§’ï¼Œè¿œä½äºå…¶ä»–ä½¿ç”¨ DiT å’Œ Flow ç»“æ„çš„ TTS ç³»ç»Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;fish-speechçš„åŒè‡ªå›å½’dual-aræ¨¡å‹ç»“æ„&#34;&gt;Fish-Speechçš„åŒè‡ªå›å½’ï¼ˆDual-ARï¼‰æ¨¡å‹ç»“æ„&lt;/h3&gt;
&lt;p&gt;Dual-AR æ¨¡å‹ç»“æ„ æé«˜äº†åºåˆ—ç”Ÿæˆè¿‡ç¨‹ä¸­ç æœ¬å¤„ç†çš„ç¨³å®šæ€§å’Œè®¡ç®—æ•ˆç‡ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨åˆ†ç»„æœ‰é™æ ‡é‡çŸ¢é‡é‡åŒ– (GFSQ) æ—¶ï¼Œç”±ä¸¤ä¸ªsequential AR transformer(GLM)ç»„æˆ: &lt;strong&gt;Slow Transformer&lt;/strong&gt; å’Œ &lt;strong&gt;Fast Transformer&lt;/strong&gt;  (åˆ†åˆ«å¯¹åº”UniAudioçš„Global GPT å’Œ local GPT) ï¼›Transformer é‡‡ç”¨ Llamaæ¨¡å‹ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/65172ed8-6e10-4c63-ac1c-0813b6493549&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;slow-transformer&#34;&gt;&lt;strong&gt;Slow Transformer&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Slow Transformer åœ¨æ›´é«˜çš„æŠ½è±¡çº§åˆ«ä¸Šè¿è¡Œï¼Œ&lt;strong&gt;å¤„ç†è¾“å…¥æ–‡æœ¬åµŒå…¥(Text Embeddings å’Œ Codebook Embeddings)ä»¥ç¼–ç å…¨å±€è¯­è¨€ç»“æ„å’Œè¯­ä¹‰å†…å®¹&lt;/strong&gt;ã€‚è¯¥æ¨¡å—&lt;strong&gt;è´Ÿè´£ç”Ÿæˆä¸­é—´éšè—çŠ¶æ€å¹¶é«˜ç²¾åº¦é¢„æµ‹è¯­ä¹‰token&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å‡è®¾è¾“å…¥çš„toenåºåˆ—ä¸º$x = [xâ‚, xâ‚‚, &amp;hellip;, xâ‚œ]$ï¼ŒSlow Transformer ç”Ÿæˆéšè—çŠ¶æ€ $h âˆˆ â„^(TÃ—D)$ å’Œtokenå¯¹æ•° $z$ï¼Œé€šè¿‡ä»¥ä¸‹å˜æ¢å®ç°ï¼š
$$
h = SlowTransformer(x)
$$&lt;/p&gt;
&lt;p&gt;$$
z = Wtok Â· Norm(h)
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼Œ$Norm(Â·)$è¡¨ç¤ºå±‚å½’ä¸€åŒ–ï¼Œ$W_{tok}$ æ˜¯æ ‡è®°é¢„æµ‹å±‚çš„å¯å­¦ä¹ å‚æ•°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;fast-transformer&#34;&gt;Fast Transformer&lt;/h4&gt;
&lt;p&gt;Fast Transformeré€šè¿‡Codebook Embeddingå¤„ç†æ¥ç»†åŒ–Slow Transformerçš„è¾“å‡ºï¼Œ&lt;strong&gt;æ•æ‰è‡ªç„¶è¯­éŸ³æ‰€éœ€çš„è¯¦ç»†å£°å­¦ç‰¹å¾(acoustic features)&lt;/strong&gt;ã€‚&lt;strong&gt;å¤„ç†æ®‹å·®ä¿¡æ¯å¹¶ä¼˜åŒ–Codebookçš„ä½¿ç”¨&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Fast Transformerçš„è¾“å…¥æ˜¯éšè—çŠ¶æ€ $h$ å’Œcodebook embedding $c$ çš„æ‹¼æ¥åºåˆ—ï¼Œå…·ä½“å¦‚ä¸‹ï¼š
$$
hÌƒ = [h; c]ï¼Œ(h^{fast})
$$&lt;/p&gt;
&lt;p&gt;$$
h^{fast} = FastTransformer(Ä¥, (h^{fast}))
$$&lt;/p&gt;
&lt;p&gt;$$
y = W_{cbk} Â· Norm(h^{fast})
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼Œ$[h; c]$ è¡¨ç¤º $h$ å’Œ $c$ çš„æ‹¼æ¥æ“ä½œï¼Œ$W_{cbk}$ æ˜¯codebooké¢„æµ‹å±‚çš„å¯å­¦ä¹ å‚æ•°ï¼Œ$y$ æ˜¯æœ€ç»ˆçš„ç æœ¬å¯¹æ•°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;dual-arç»“æ„çš„ä¼˜åŠ¿&#34;&gt;Dual ARç»“æ„çš„ä¼˜åŠ¿&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¢å¼ºçš„åºåˆ—ç”Ÿæˆç¨³å®šæ€§&lt;/strong&gt;ï¼šé€šè¿‡åˆ†å±‚å¤„ç†å…¨å±€å’Œå±€éƒ¨ä¿¡æ¯ï¼Œæ˜¾è‘—æé«˜äº†GFSQåœ¨åºåˆ—ç”Ÿæˆä»»åŠ¡ä¸­çš„ç¨³å®šæ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŒ–çš„ç æœ¬å¤„ç†&lt;/strong&gt;ï¼šå¿«é€Ÿå˜æ¢å™¨å®ç°äº†ä¸€ç§é«˜æ•ˆçš„ç æœ¬åµŒå…¥å¤„ç†æœºåˆ¶ï¼Œåœ¨ä¸å¢åŠ æ˜¾è‘—è®¡ç®—å¼€é”€çš„æƒ…å†µä¸‹æå‡äº†æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯å¯¹äºè§„æ¨¡ä¸º7Bæˆ–æ›´å¤§çš„æ¨¡å‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜ä¿çœŸè¯­éŸ³åˆæˆè´¨é‡&lt;/strong&gt;ï¼šSlowå’ŒFast Transformerä¹‹é—´çš„ååŒä½œç”¨ä½¿å¾—ç³»ç»Ÿèƒ½å¤Ÿä»¥é«˜ä¿çœŸåº¦åˆæˆè¯­éŸ³ï¼Œå¹¶èƒ½å¤Ÿå¤„ç†å¤æ‚çš„è¯­è¨€ç°è±¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šè¯­è¨€å¤„ç†èƒ½åŠ›&lt;/strong&gt;ï¼šé€šè¿‡å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ç”Ÿæˆè¯­è¨€ç‰¹å¾ï¼Œæ¶ˆé™¤äº†ä¼ ç»Ÿæ–‡å­—åˆ°éŸ³ç´ è½¬æ¢çš„ä¾èµ–ï¼Œä»è€Œç®€åŒ–äº†åˆæˆæµç¨‹å¹¶å¢å¼ºäº†å¤šè¯­è¨€èƒ½åŠ›ã€‚é€šè¿‡æ··åˆæ–‡æœ¬æ•°æ®ï¼Œç†è§£èƒ½åŠ›å°†è¿›ä¸€æ­¥æå‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;firefly-gan&#34;&gt;Firefly-GAN&lt;/h3&gt;
&lt;p&gt;Firefly-GANï¼ˆFF-GANï¼‰æ˜¯ &lt;a href=&#34;https://arxiv.org/abs/2402.00892&#34;&gt;2024.1 &lt;strong&gt;EVA-GAN: Enhanced Various Audio Generation via Scalable Generative Adversarial Networks&lt;/strong&gt;&lt;/a&gt;  çš„ä¸€ä¸ªæ˜¾è‘—æ”¹è¿›ç‰ˆæœ¬ã€‚å®ƒç”¨æ›´é«˜æ•ˆçš„è®¾è®¡æ›¿æ¢äº†HiFi-GANä¸­çš„ä¼ ç»Ÿå·ç§¯ç»„ä»¶ï¼Œå¼•å…¥äº†å¹¶è¡Œå—ï¼ˆParallelBlockï¼‰ä»¥æ›¿ä»£å¤šæ„Ÿå—é‡ï¼ˆMulti-Receptive Field, MRFï¼‰æ¨¡å—ã€‚é€šè¿‡å¼•å…¥åˆ†ç»„æœ‰é™æ ‡é‡çŸ¢é‡é‡åŒ–ï¼ˆGrouped Finite Scalar Vector Quantization GFSQï¼‰ï¼Œ&lt;strong&gt;FF-GANåœ¨åºåˆ—ç”Ÿæˆç¨³å®šæ€§ä»¥åŠè¯­è¨€å˜åŒ–å¤„ç†æ–¹é¢è¡¨ç°å‡ºè‰²ï¼Œå°¤å…¶é€‚ç”¨äºå¤šè¯­è¨€åˆæˆçš„AIåº”ç”¨&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/f5f8cd7f-2463-4c1e-a8cd-af77b48fe9fa&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;firefly-generator&#34;&gt;Firefly Generator&lt;/h4&gt;
&lt;p&gt;FF-GANé‡‡ç”¨äº†å¢å¼ºçš„å·ç§¯ç»“æ„ï¼ŒåŒ…æ‹¬&lt;strong&gt;æ·±åº¦å¯åˆ†ç¦»å·ç§¯(depth-wise separable convolution)&lt;/strong&gt; &lt;a href=&#34;https://arxiv.org/abs/1704.04861&#34;&gt;2017.4 Mobilenets: Efficient convolutional neural networks for mobile vision applications&lt;/a&gt; å’Œ &lt;strong&gt;æ‰©å¼ å·ç§¯(dilated convolution)&lt;/strong&gt; &lt;a href=&#34;https://arxiv.org/abs/1511.07122&#34;&gt;2015.11 Multi-Scale Context Aggregation by Dilated Convolutions&lt;/a&gt;ï¼Œä»¥æ›¿ä»£ä¼ ç»Ÿçš„Conv1då±‚ã€‚è¿™ç§æ¶æ„æ”¹è¿›&lt;strong&gt;å¢å¼ºäº†æ¨¡å‹æ•æ‰å’Œåˆæˆå¤æ‚éŸ³é¢‘ç‰¹å¾çš„èƒ½åŠ›&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¹¶è¡Œå—&lt;/strong&gt;ï¼ˆParallelBlock æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2402.00892&#34;&gt;2024.1 EVA-GAN: Enhanced Various Audio Generation via Scalable Generative Adversarial Networks&lt;/a&gt; ï¼‰&lt;strong&gt;æ›¿ä»£ä¼ ç»Ÿçš„å¤šæ„Ÿå—é‡ï¼ˆMRFï¼‰æ¨¡å—&lt;/strong&gt;ï¼Œè¿›è¡Œæ”¹è¿›ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜åŒ–äº†â€œtypo-codebook(é”™è¯¯ç æœ¬)â€è¾“å…¥çš„å¤„ç†æ•ˆç‡ã€‚&lt;/li&gt;
&lt;li&gt;å®ç°äº†å¯é…ç½®çš„å·ç§¯æ ¸å¤§å°å’Œæ‰©å¼ ç‡ï¼Œå¹¶é‡‡ç”¨ stack-and-average æœºåˆ¶å¤„ç†æ¥è‡ªä¸‰ä¸ªæ®‹å·®å—ï¼ˆResBlocksï¼‰çš„è¾“å‡ºï¼Œè€Œä¸æ˜¯ç›´æ¥è¿›è¡ŒåŠ æ³•æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;æä¾›äº†å¢å¼ºçš„æ„Ÿå—é‡ï¼ˆMulti-Receptive Field, MRFï¼‰è¦†ç›–ã€ä¼˜è¶Šçš„ç‰¹å¾æå–èƒ½åŠ›å’Œæ›´å¥½çš„å¯é…ç½®æ€§ï¼Œä»è€Œæå‡äº†éŸ³é¢‘åˆæˆçš„è´¨é‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;grouped-finite-scalar-vector-quantization-gfsq&#34;&gt;Grouped Finite Scalar Vector Quantization (GFSQ)&lt;/h4&gt;
&lt;p&gt;ä¸ºäº†é€‚åº”â€œtypo-codebookâ€ä»»åŠ¡ï¼Œå¼•å…¥äº†åˆ†ç»„æœ‰é™æ ‡é‡çŸ¢é‡é‡åŒ–ï¼ˆ Grouped Finite Scalar Vector Quantization GFSQï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯GFSQçš„è¯¦ç»†å¼€å‘è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;å‡è®¾è¾“å…¥å¼ é‡ä¸º $z âˆˆ â„^{BÃ—CÃ—L}$ï¼Œæ•´ä¸ªè¿‡ç¨‹åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š&lt;/p&gt;
&lt;h5 id=&#34;ä¸‹é‡‡æ ·downsampling&#34;&gt;ä¸‹é‡‡æ ·ï¼ˆDownsamplingï¼‰&lt;/h5&gt;
&lt;p&gt;ä½¿ç”¨ä¸‹é‡‡æ ·å‡½æ•° $f_{down}$ å¯¹è¾“å…¥å¼ é‡ $z$ è¿›è¡Œä¸‹é‡‡æ ·ï¼Œå¾—åˆ°ä¸‹é‡‡æ ·åçš„å¼ é‡ $z_d âˆˆ â„^{BÃ—C_dÃ—L_d}$ï¼š
$$
z_d = f_{down}(z)
$$&lt;/p&gt;
&lt;h5 id=&#34;gfsqè¿‡ç¨‹&#34;&gt;GFSQè¿‡ç¨‹&lt;/h5&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹å¾åˆ†ç»„(Feature Grouping)&lt;/strong&gt; è¾“å…¥ç‰¹å¾çŸ©é˜µ $Z$ è¢«åˆ’åˆ†ä¸º$G$ ç»„ï¼š
$$
Z = [Z^{(1)}, Z^{(2)}, &amp;hellip;, Z^{(G)}]
$$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ ‡é‡é‡åŒ–(Scalar Quantization)&lt;/strong&gt; å¯¹äºæ¯ä¸ªæ ‡é‡ $z_{b,c,l}^{(g)}$ï¼š
$$
áº‘_{b,c,l}^{(g)} = Q(z_{b,c,l}^{(g)})
$$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç´¢å¼•ç”Ÿæˆ(Index Generation)&lt;/strong&gt; æ¯ä¸ªæ ‡é‡æ˜ å°„åˆ°ç´¢å¼• $k_{b,c,l}^{(g)}$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è§£ç (Decoding)&lt;/strong&gt;
$$
áº‘_{b,c,l}^{(g)} = Codebook^{(g)}[k_{b,c,l}^{(g)}]
$$&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h5 id=&#34;é‡æ„é‡åŒ–ä¸‹é‡‡æ ·å¼ é‡reconstruct-the-quantized-downsampled-tensor&#34;&gt;é‡æ„é‡åŒ–ä¸‹é‡‡æ ·å¼ é‡ï¼ˆReconstruct the Quantized Downsampled Tensorï¼‰&lt;/h5&gt;
&lt;p&gt;å°†æ‰€æœ‰ç»„çš„é‡åŒ–å‘é‡æ²¿é€šé“ç»´åº¦æ‹¼æ¥ï¼Œå¾—åˆ°é‡åŒ–ä¸‹é‡‡æ ·å¼ é‡ $z_{qd} âˆˆ â„^{(BÃ—C_dÃ—L_d)}$ï¼š
$$
z_{qd}(b, :, l) = [áº‘_{q_d}^{(1)}(b, :, l); áº‘_{q_d}^{(2)}(b, :, l); &amp;hellip;; áº‘_{q_d}^{(G)}(b, :, l)]
$$&lt;/p&gt;
&lt;h5 id=&#34;ä¸Šé‡‡æ ·upsampling&#34;&gt;ä¸Šé‡‡æ ·ï¼ˆUpsamplingï¼‰&lt;/h5&gt;
&lt;p&gt;ä½¿ç”¨ä¸Šé‡‡æ ·å‡½æ•° $f_{up}$ å°†é‡åŒ–ä¸‹é‡‡æ ·å¼ é‡æ¢å¤åˆ°å…¶åŸå§‹å¤§å°ï¼Œå¾—åˆ°æœ€ç»ˆçš„é‡åŒ–å¼ é‡ $z_q âˆˆ â„^{BÃ—CÃ—L}$ï¼š
$$
z_q = f_{up}(z_{q_d})
$$
ç›®æ ‡æ˜¯ä½¿ $z_q$ å°½å¯èƒ½æ¥è¿‘åŸå§‹è¾“å…¥ $z$ï¼š
$$
z_q â‰ˆ z
$$&lt;/p&gt;
&lt;h4 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h4&gt;
&lt;p&gt;GFSQæŠ€æœ¯å®ç°äº†æ¥è¿‘100%çš„ç æœ¬åˆ©ç”¨ç‡ï¼Œå¹¶åœ¨å†…éƒ¨æ¶ˆèå®éªŒä¸­ï¼Œç›¸æ¯”äºå…¶ä»–é‡åŒ–æŠ€æœ¯ï¼ˆå¦‚RFSQã€RVQå’ŒGRFSQï¼‰è·å¾—äº†æ›´å¥½çš„å®¢è§‚å’Œä¸»è§‚è¯„åˆ†ã€‚FF-GANæ˜¾è‘—å¢å¼ºäº†â€œtypo-codebookâ€æ“ä½œçš„ç¨³å®šæ€§ï¼Œå¹¶ç¡®ä¿åœ¨å¤šæƒ…æ„Ÿå’Œå¤šè¯­è¨€ä»»åŠ¡ä¸­ä¿ç•™å…¨é¢çš„ä¸­é—´å˜é‡ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è®­ç»ƒä¸æ¨ç†&#34;&gt;è®­ç»ƒä¸æ¨ç†&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/a3302fff-211f-467e-a53f-a0916984ae0c&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;training-è®­ç»ƒ&#34;&gt;&lt;strong&gt;Training&lt;/strong&gt; è®­ç»ƒ&lt;/h4&gt;
&lt;p&gt;Fish-Speeché‡‡ç”¨äº†ä¸€ä¸ªä¸‰é˜¶æ®µçš„è®­ç»ƒæ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆä½¿ç”¨&lt;strong&gt;å¤§è§„æ¨¡çš„æ ‡å‡†æ•°æ®è¿›è¡Œé¢„è®­ç»ƒ(PT)&lt;/strong&gt;ï¼Œ&lt;/li&gt;
&lt;li&gt;ç„¶åé€šè¿‡&lt;strong&gt;å°æ‰¹é‡çš„é«˜è´¨é‡æ•°æ®è¿›è¡Œæœ‰ç›‘ç£å¾®è°ƒï¼ˆSFTï¼‰&lt;/strong&gt;ï¼Œ&lt;/li&gt;
&lt;li&gt;æœ€å&lt;strong&gt;ä½¿ç”¨æ‰‹åŠ¨æ ‡è®°çš„æ­£è´Ÿæ ·æœ¬å¯¹ è¿›è¡ŒDPOï¼ˆDiscriminator Pessimistic Optimizationï¼‰è®­ç»ƒ&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è®­ç»ƒåŸºç¡€è®¾æ–½åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼ˆè§ä¸Šå›¾ï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªå›å½’ï¼ˆARï¼‰è®­ç»ƒä½¿ç”¨&lt;strong&gt;8å—H100 GPUï¼ˆ80Gæ˜¾å­˜ï¼‰&lt;/strong&gt;ï¼Œ&lt;strong&gt;æŒç»­ä¸€å‘¨&lt;/strong&gt;ã€‚(Training Stage2)&lt;/li&gt;
&lt;li&gt;å£°ç å™¨ï¼ˆvocoderï¼‰è®­ç»ƒåˆ™ä½¿ç”¨&lt;strong&gt;8å—RTX 4090 GPU&lt;/strong&gt;ï¼Œå†&lt;strong&gt;æŒç»­ä¸€å‘¨&lt;/strong&gt;ã€‚(Training Stage1)&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›è®­ç»ƒæ—¶é—´ä¸åŒ…æ‹¬DPOé˜¶æ®µã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;inference-æ¨ç†&#34;&gt;Inference æ¨ç†&lt;/h4&gt;
&lt;p&gt;è®­ç»ƒåæ¨ç†è¿‡ç¨‹è§ä¸Šå›¾Inferenceã€‚é€šè¿‡é‡‡ç”¨fish-techæŠ€æœ¯ï¼ˆåŒ…æ‹¬KVç¼“å­˜â­ï¸&lt;a href=&#34;2211.05102&#34;&gt;2023. &lt;strong&gt;Efficiently Scaling Transformer Inference&lt;/strong&gt;&lt;/a&gt;ã€PyTorchç¼–è¯‘ç­‰åŠ é€Ÿæ–¹æ³•ï¼‰ï¼Œç³»ç»Ÿåœ¨&lt;strong&gt;æ¶ˆè´¹çº§NVIDIA RTX 4060ç§»åŠ¨å¹³å°ä¸Šå®ç°äº†å¤§çº¦1:5çš„å®æ—¶å› å­ï¼ˆreal-time factors RTFï¼‰ï¼Œåœ¨é«˜æ€§èƒ½NVIDIA RTX 4090é…ç½®ä¸Šå®ç°äº†1:15çš„å®æ—¶å› å­&lt;/strong&gt;ã€‚è¿™äº›æ¶æ„ä¼˜åŒ–æ˜¾è‘—é™ä½äº†æ¨ç†å»¶è¿Ÿï¼Œ&lt;strong&gt;å®ç°äº†150æ¯«ç§’çš„é¦–åŒ…å»¶è¿Ÿ(first-packet latency)&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œè¯¥ç³»ç»Ÿå¯ä»¥&lt;strong&gt;æµå¼å¤„ç†ä¿¡æ¯&lt;/strong&gt;ï¼Œä¾¿äºä¸ç°ä»£AIå·¥å…·ç»“åˆï¼Œå¹¶åœ¨ä¸åŒåœºæ™¯ä¸­ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;dataset-æ•°æ®é›†&#34;&gt;Dataset æ•°æ®é›†&lt;/h3&gt;
&lt;p&gt;è®­ç»ƒæ•°æ®åŒ…æ‹¬æ¥è‡ªå…¬å…±æ•°æ®æºå’Œ æ•°æ®æ”¶é›†è¿‡ç¨‹çš„å¤§é‡è¯­éŸ³æ ·æœ¬ã€‚æ•°æ®é›†åŒ…å«çº¦&lt;strong&gt;72ä¸‡ï¼ˆ720kï¼‰å°æ—¶çš„å¤šè¯­è¨€è¯­éŸ³æ•°æ®&lt;/strong&gt;ï¼Œå…¶ä¸­&lt;strong&gt;è‹±è¯­å’Œæ™®é€šè¯æ˜¯ä¸»è¦ç»„æˆéƒ¨åˆ†ï¼Œå„å 30ä¸‡å°æ—¶&lt;/strong&gt;ã€‚è¿˜åŒ…å«äº†å…¶ä»–è¯­ç³»çš„è¯­éŸ³æ•°æ®ï¼Œ&lt;strong&gt;æ¯ç§è¯­ç³»å„å 2ä¸‡å°æ—¶ï¼ŒåŒ…æ‹¬å¾·è¯­ï¼ˆæ—¥è€³æ›¼è¯­ç³»ï¼‰ã€æ³•è¯­å’Œæ„å¤§åˆ©è¯­ï¼ˆç½—æ›¼è¯­ç³»ï¼‰ã€æ—¥è¯­å’ŒéŸ©è¯­ï¼ˆä¸œäºšè¯­ç³»ï¼‰ä»¥åŠé˜¿æ‹‰ä¼¯è¯­ï¼ˆé—ªç±³ç‰¹è¯­ç³»ï¼‰&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä»”ç»†å¹³è¡¡äº†ä¸åŒè¯­è¨€çš„æ•°æ®ï¼Œä»¥å¸®åŠ©æ¨¡å‹åŒæ—¶å­¦ä¹ å¤šç§è¯­è¨€ã€‚è¿™ç§æ–¹æ³•æœ‰åŠ©äºæ¨¡å‹åœ¨ç”Ÿæˆæ··åˆè¯­è¨€å†…å®¹æ—¶è¡¨ç°è‰¯å¥½ã€‚æ•°æ®é›†çš„åºå¤§è§„æ¨¡å’Œå¤šæ ·æ€§æ˜¾è‘—æå‡äº†æ¨¡å‹å¤„ç†å¤šè¯­è¨€çš„è‡ªç„¶æ€§ã€‚&lt;/p&gt;
&lt;p&gt;PS: scaling æ•°æ®é›† åˆ° 72ä¸‡å°æ—¶ï¼›è€Œ åç»­ CosyVoice2å…¬å¸ƒçš„è®­ç»ƒæ•°æ®é›†æ—¶ 20ä¸‡è®­ç»ƒspeech tokenizer, 16.68ä¸‡å°æ—¶è®­ç»ƒcosyvoice2 LM&lt;/p&gt;
&lt;h3 id=&#34;experimental-evaluation-å®éªŒè¯„ä¼°&#34;&gt;Experimental Evaluation å®éªŒè¯„ä¼°&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†è¯„ä¼°è®ºæ–‡ä¸­çš„æ¨¡å‹ç›¸å¯¹äºåŸºçº¿æ¨¡å‹çš„æ•ˆæœï¼Œè¿›è¡Œäº†è¯´è¯äººå…‹éš†ä»»åŠ¡çš„å®éªŒã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å®éªŒéªŒè¯ï¼Œå°†åˆ†æé™åˆ¶åœ¨å•è¯­è¨€è¯­éŸ³å…‹éš†åœºæ™¯ï¼Œä¸åŒ…æ‹¬è·¨è¯­è¨€åˆæˆçš„ä»»åŠ¡ã€‚&lt;strong&gt;è¯„ä¼°è¯­æ–™åº“ç”±10ä¸ªä¸åŒçš„è¯´è¯è€…ï¼ˆåŒ…æ‹¬ä¸åŒçš„è¯­è¨€ï¼‰èº«ä»½ç»„æˆï¼Œå…¶ä¸­30ä¸ªæ˜¯ç»¼åˆçš„æ¯ä¸ªè¯´è¯è€…çš„è¯è¯­ï¼Œäº§ç”Ÿ300ä¸ªæ ·æœ¬çš„ç»¼åˆè¯„ä¼°é›†&lt;/strong&gt;ã€‚åº”è¯¥æŒ‡å‡ºçš„æ˜¯ï¼Œ&lt;strong&gt;è·¨è¯­è¨€ç»¼åˆæ˜¯ä¸åŒ…æ‹¬åœ¨æœ¬æ¬¡è¯„ä¼°ä¸­&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¯„ä¼°æ–¹æ³•åŒ…æ‹¬å®¢è§‚å’Œä¸»è§‚æŒ‡æ ‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¯é”™è¯¯ç‡ï¼ˆWERï¼‰ç”¨äºè¯„ä¼°è¯­éŸ³çš„å¯ç†è§£æ€§ï¼Œ&lt;strong&gt;ä½¿ç”¨OpenAI Whisper-medium ASRæ¨¡å‹è¿›è¡Œè½¬å½•è¯„ä»·çš„ç»“æœ&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;è¯´è¯äººåµŒå…¥ç›¸ä¼¼åº¦ï¼ˆspeaker embedding similarity ï¼‰ç”¨äºè¯„ä¼°è¯­éŸ³å…‹éš†çš„ä¿çœŸåº¦ï¼Œå·¥å…·åŒ…ï¼š
&lt;ul&gt;
&lt;li&gt;Resemblyzerï¼š &lt;a href=&#34;https://github.com/resemble-ai/Resemblyzer&#34;&gt;https://github.com/resemble-ai/Resemblyzer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Speechbrain&lt;/strong&gt;ï¼š &lt;a href=&#34;https://github.com/speechbrain/speechbrain&#34;&gt;https://github.com/speechbrain/speechbrain&lt;/a&gt; | &lt;a href=&#34;https://arxiv.org/abs/2407.00463&#34;&gt;2024.6 Open-Source Conversational AI with SpeechBrain 1.0&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ä»¥åŠå¹³å‡æ„è§å¾—åˆ†ï¼ˆmean opinion score MOSï¼‰ç”¨äºé‡åŒ–æ„ŸçŸ¥è´¨é‡ï¼Œ&lt;strong&gt;äººå·¥è¯„ä¼°&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ä¸€è¯„ä¼°æ¡†æ¶æ—¨åœ¨è¯„ä¼°æ¨¡å‹åœ¨ä¿æŒè¯´è¯äººèº«ä»½çš„åŒæ—¶ï¼Œç»´æŒé«˜ä¿çœŸè¯­éŸ³åˆæˆçš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;h4 id=&#34;word-error-rate-analysis-è¯é”™è¯¯ç‡åˆ†æ&#34;&gt;Word Error Rate Analysis è¯é”™è¯¯ç‡åˆ†æ&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¨¡å‹åç§°&lt;/th&gt;
&lt;th&gt;WER (%)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;çœŸå®å½•éŸ³&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;9.22&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Fish-Speech&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;6.89&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Reecho1&lt;/td&gt;
&lt;td&gt;11.92&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;F5-TTS&lt;/td&gt;
&lt;td&gt;13.98&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CosyVoice&lt;/td&gt;
&lt;td&gt;22.20&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¡¨1ï¼šè¯­éŸ³å…‹éš†ä»»åŠ¡çš„è¯é”™è¯¯ç‡ï¼ˆWERï¼‰ç»“æœ&lt;/p&gt;
&lt;p&gt;è¡¨1çš„åˆ†ææ˜¾ç¤ºï¼ŒFish-Speech æ¨¡å‹åœ¨è¯­éŸ³å…‹éš†ä»»åŠ¡ä¸­å®ç°äº†6.89%çš„è¯é”™è¯¯ç‡ï¼Œè¿™ä¸ä»…æ˜¾è‘—ä½äºåŸºçº¿æ¨¡å‹ï¼Œç”šè‡³ä¼˜äºçœŸå®å½•éŸ³ï¼ˆ9.22%ï¼‰ã€‚è¿™ä¸€æ€§èƒ½ä¸ºFish-Speechæ¨¡å‹åœ¨è¯­éŸ³å…‹éš†åœºæ™¯ä¸­çš„èƒ½åŠ›æä¾›äº†æœ‰åŠ›è¯æ®ã€‚è¯¥æ¨¡å‹ä¸å…¶ä»–ç«äº‰æ¨¡å‹ï¼ˆWERèŒƒå›´ä»11.92%åˆ°22.20%ï¼‰ä¹‹é—´çš„å·®è·çªæ˜¾äº†Fish-Speechæ¨¡å‹æ–¹æ³•åœ¨åˆæˆç¨³å®šæ€§å’Œå†…å®¹ä¿çœŸåº¦æ–¹é¢çš„æ”¹è¿›ã€‚&lt;/p&gt;
&lt;h4 id=&#34;speaker-similarity-analysis-è¯´è¯äººç›¸ä¼¼åº¦åˆ†æ&#34;&gt;Speaker Similarity Analysis è¯´è¯äººç›¸ä¼¼åº¦åˆ†æ&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¨¡å‹åç§°&lt;/th&gt;
&lt;th&gt;Resemblyzer&lt;/th&gt;
&lt;th&gt;SpeechBrain&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;çœŸå®å½•éŸ³&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;0.921&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;0.770&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CosyVoice&lt;/td&gt;
&lt;td&gt;0.936&lt;/td&gt;
&lt;td&gt;0.813&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Fish-Speech&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;0.914&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;0.762&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;F5-TTS&lt;/td&gt;
&lt;td&gt;0.905&lt;/td&gt;
&lt;td&gt;0.787&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Reecho&lt;/td&gt;
&lt;td&gt;0.887&lt;/td&gt;
&lt;td&gt;0.636&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¡¨2ï¼šä¸åŒæ¨¡å‹çš„è¯´è¯äººç›¸ä¼¼åº¦è¯„åˆ†ï¼ŒåŒ…æ‹¬çœŸå®å½•éŸ³&lt;/p&gt;
&lt;p&gt;è¡¨2å±•ç¤ºäº†â€œtypo-codebookâ€ç­–ç•¥å¯¹è¯´è¯äººç›¸ä¼¼åº¦æŒ‡æ ‡çš„å½±å“ã€‚Fish-Speechæ¨¡å‹åœ¨Resemblyzerå’ŒSpeechBrainä¸Šçš„ç›¸ä¼¼åº¦è¯„åˆ†åˆ†åˆ«ä¸º0.914å’Œ0.762ï¼Œä¸çœŸå®å½•éŸ³çš„è¡¨ç°ï¼ˆ0.921å’Œ0.770ï¼‰éå¸¸æ¥è¿‘ã€‚åœ¨Resemblyzerè¯„ä¼°ä¸­ï¼Œä¸çœŸå®å½•éŸ³çš„å·®è·ä»…ä¸º0.76%ï¼Œåœ¨SpeechBrainè¯„ä¼°ä¸­ä¸º1.04%ã€‚è¿™è¡¨æ˜&lt;strong&gt;Fish-Speechæ¨¡å‹åœ¨æ•æ‰è‡ªç„¶è¯­éŸ³ç‰¹å¾æ–¹é¢å…·æœ‰å“è¶Šçš„èƒ½åŠ›&lt;/strong&gt;ã€‚ç»“æœå¼ºçƒˆè¡¨æ˜ï¼Œâ€œtypo-codebookâ€æ¶æ„&lt;strong&gt;èƒ½å¤Ÿæ›´å…¨é¢åœ°æ•æ‰å£°å­¦çŠ¶æ€ï¼Œä»è€Œæé«˜åˆæˆè¯­éŸ³çš„éŸ³è‰²ä¿çœŸåº¦&lt;/strong&gt;ã€‚Fish-Speechæ¨¡å‹æ–¹æ³•æ˜¾è‘—ä¼˜äºåŸºçº¿æ¨¡å‹ï¼Œä¾‹å¦‚F5-TTSï¼ˆ0.905å’Œ0.787ï¼‰å’ŒReechoï¼ˆ0.887å’Œ0.636ï¼‰ã€‚åœ¨&lt;strong&gt;ä¸¤ä¸ªè¯„ä¼°æ¡†æ¶ä¸­çš„ä¸€è‡´è¡¨ç°è¯æ˜äº†Fish-Speechæ¨¡å‹æ–¹æ³•åœ¨ä¿ç•™è¯´è¯äººç‰¹å¾æ–¹é¢çš„æœ‰æ•ˆæ€§&lt;/strong&gt;ï¼Œè¿™å¯¹äºé«˜è´¨é‡çš„æ–‡æœ¬åˆ°è¯­éŸ³åˆæˆå’Œä»£ç†ä»»åŠ¡è‡³å…³é‡è¦ã€‚&lt;/p&gt;
&lt;h4 id=&#34;perceptual-quality-assessmentæ„ŸçŸ¥è´¨é‡è¯„ä¼°&#34;&gt;&lt;strong&gt;Perceptual Quality Assessment&lt;/strong&gt;æ„ŸçŸ¥è´¨é‡è¯„ä¼°&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¨¡å‹åç§°&lt;/th&gt;
&lt;th&gt;MOS&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;çœŸå®å½•éŸ³&lt;/td&gt;
&lt;td&gt;5.00&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Fish-Speech&lt;/td&gt;
&lt;td&gt;4.05&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CosyVoice&lt;/td&gt;
&lt;td&gt;3.80&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;F5-TTS&lt;/td&gt;
&lt;td&gt;2.90&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Reecho&lt;/td&gt;
&lt;td&gt;3.76&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¡¨3ï¼šå…‹éš†è¯­éŸ³è´¨é‡çš„äº”çº§å¹³å‡æ„è§å¾—åˆ†ï¼ˆMOSï¼‰è¯„åˆ†&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è¯„ä¼°åˆæˆéŸ³é¢‘çš„æ„ŸçŸ¥è´¨é‡ï¼Œè¿›è¡Œäº†å…¨é¢çš„å¹³å‡æ„è§å¾—åˆ†ï¼ˆMOSï¼‰å¬æµ‹å®éªŒï¼Œå‚ä¸è€…ä¸ºæ²¡æœ‰éŸ³é¢‘å¤„ç†ç»éªŒçš„æ™®é€šå¬ä¼—ã€‚&lt;strong&gt;è¯„ä¼°éµå¾ªåŒç›²ã€éšæœºåŒ–æ–¹æ³•&lt;/strong&gt;ï¼Œä»¥ç¡®ä¿è¯„ä¼°çš„å…¬æ­£æ€§ã€‚ç»“æœæ˜¾ç¤ºï¼ŒFish-Speechåœ¨ä¸»è§‚è¯„åˆ†ä¸Šæ˜¾è‘—é«˜äºå…¶ä»–åŸºçº¿æ¨¡å‹ï¼ˆp &amp;lt; 0.05ï¼‰ï¼Œåœ¨è¯­éŸ³è‡ªç„¶åº¦å’Œè¯´è¯äººç›¸ä¼¼åº¦æ–¹é¢è¡¨ç°å‡ºè‰²ã€‚è¿™ä¸€äººç±»æ„ŸçŸ¥æŒ‡æ ‡çš„è¯„ä¼°å¼ºçƒˆè¡¨æ˜ï¼Œ&lt;strong&gt;Fish-Speechèƒ½å¤Ÿæ›´å¥½åœ°æ•æ‰å’Œå†ç°äººç±»è¯­éŸ³çš„è‡ªç„¶ç‰¹å¾ï¼Œå°¤å…¶æ˜¯åœ¨è¯­éŸ³å…‹éš†ä»»åŠ¡çš„èƒŒæ™¯ä¸‹&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“è®º-1&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;Fish-Speechè®ºæ–‡ç ”ç©¶åœ¨æ–‡æœ¬åˆ°è¯­éŸ³ï¼ˆTTSï¼‰é¢†åŸŸå–å¾—äº†æ˜¾è‘—è¿›å±•ï¼Œé€šè¿‡å¼•å…¥ä¸€ç§æ–°å‹çš„å¤šè¯­è¨€å’Œå¤šæƒ…æ„Ÿç¨³å®šåŒ–è§£å†³æ–¹æ¡ˆï¼Œä¸ºæœªæ¥çš„äººå·¥æ™ºèƒ½åº”ç”¨æä¾›äº†æ›´è‡ªç„¶ã€æ›´é«˜è´¨é‡çš„è¯­éŸ³åˆæˆæŠ€æœ¯ã€‚æ ¸å¿ƒåˆ›æ–°åœ¨äºå¼€å‘äº†ä¸€ç§ç»“åˆäº†åŒè‡ªå›å½’ï¼ˆDual-ARï¼‰ç”Ÿæˆç»“æ„çš„â€œtypo-codebookâ€å£°ç å™¨ã€‚è¿™ç§ç»“æ„ç»„åˆåœ¨åˆæˆè¿‡ç¨‹ä¸­è¡¨ç°å‡ºç¨³å®šæ€§ï¼ŒåŒæ—¶ä¿ç•™äº†ç”Ÿæˆè¯­éŸ³ä¸­çš„å£°å­¦ç‰¹å¾ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼ŒFish-Speechè®ºæ–‡ä¸­é‡‡ç”¨äº†éæ–‡å­—åˆ°éŸ³ç´ ï¼ˆnon-G2Pï¼‰ç»“æ„ï¼Œæœ‰æ•ˆè§£å†³äº†ä¼ ç»ŸåŸºäºéŸ³ç´ ç³»ç»Ÿå›ºæœ‰çš„å±€é™æ€§ï¼Œå¹¶ä¸ºè·¨è¯­è¨€å’Œæƒ…æ„Ÿå¤šæ ·åŒ–çš„TTSåº”ç”¨æä¾›äº†åšå®çš„åŸºç¡€ï¼Œç‰¹åˆ«æ˜¯åœ¨äººå·¥æ™ºèƒ½ä»£ç†äº¤äº’çš„èƒŒæ™¯ä¸‹ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;é™„å½•&#34;&gt;é™„å½•&lt;/h2&gt;
&lt;h3 id=&#34;frÃ©chet-inception-distance-fid&#34;&gt;FrÃ©chet Inception Distance (FID)&lt;/h3&gt;
&lt;p&gt;FID æ˜¯ &lt;strong&gt;FrÃ©chet Inception Distance&lt;/strong&gt; çš„ç¼©å†™ï¼Œæ˜¯ä¸€ç§ç”¨äºè¯„ä¼°ç”Ÿæˆæ¨¡å‹ï¼ˆå¦‚ GAN å’Œæ‰©æ•£æ¨¡å‹ï¼‰ç”Ÿæˆå›¾åƒè´¨é‡çš„æŒ‡æ ‡ã€‚å®ƒé€šè¿‡æ¯”è¾ƒç”Ÿæˆå›¾åƒå’ŒçœŸå®å›¾åƒåœ¨ç‰¹å¾ç©ºé—´ä¸­çš„åˆ†å¸ƒå·®å¼‚æ¥é‡åŒ–ä¸¤è€…çš„ç›¸ä¼¼åº¦ã€‚å…·ä½“æ¥è¯´ï¼ŒFID çš„è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹å¾æå–&lt;/strong&gt;ï¼šä½¿ç”¨é¢„è®­ç»ƒçš„ Inception v3 ç½‘ç»œæå–çœŸå®å›¾åƒå’Œç”Ÿæˆå›¾åƒçš„ç‰¹å¾å‘é‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿè®¡åˆ†å¸ƒ&lt;/strong&gt;ï¼šè®¡ç®—è¿™äº›ç‰¹å¾å‘é‡çš„å‡å€¼å’Œåæ–¹å·®çŸ©é˜µã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è·ç¦»è®¡ç®—&lt;/strong&gt;ï¼šä½¿ç”¨ FrÃ©chet è·ç¦»å…¬å¼è®¡ç®—ä¸¤ä¸ªåˆ†å¸ƒä¹‹é—´çš„è·ç¦»ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;FID çš„å…¬å¼ä¸ºï¼š
$$
FID=âˆ¥Î¼_râˆ’Î¼_gâˆ¥^2+Tr(Î£_r+Î£_gâˆ’2(Î£_rÎ£_g)^{1/2})
$$
å…¶ä¸­ï¼ŒÎ¼r å’Œ Î¼g åˆ†åˆ«æ˜¯çœŸå®å›¾åƒå’Œç”Ÿæˆå›¾åƒçš„ç‰¹å¾å‡å€¼ï¼Œ$Î£r$ å’Œ $Î£g$ æ˜¯å®ƒä»¬çš„åæ–¹å·®çŸ©é˜µã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;FID çš„ç‰©ç†å«ä¹‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;FID è¶Šå°ï¼Œè¡¨ç¤ºç”Ÿæˆå›¾åƒä¸çœŸå®å›¾åƒè¶Šç›¸ä¼¼ã€‚&lt;/li&gt;
&lt;li&gt;å®ƒåŒæ—¶è¡¡é‡äº†ç”Ÿæˆå›¾åƒçš„è´¨é‡å’Œå¤šæ ·æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;FID æ˜¯ç›®å‰å¹¿æ³›ä½¿ç”¨çš„ç”Ÿæˆæ¨¡å‹è¯„ä¼°æŒ‡æ ‡ä¹‹ä¸€ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿæ›´å‡†ç¡®åœ°åæ˜ ç”Ÿæˆå›¾åƒä¸çœŸå®å›¾åƒä¹‹é—´çš„åˆ†å¸ƒå·®å¼‚ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;residual-informationæ®‹å·®ä¿¡æ¯&#34;&gt;residual informationï¼ˆæ®‹å·®ä¿¡æ¯ï¼‰&lt;/h3&gt;
&lt;p&gt;åœ¨æ·±åº¦å­¦ä¹ å’Œè¯­éŸ³åˆæˆçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œ**residual informationï¼ˆæ®‹å·®ä¿¡æ¯ï¼‰**æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤æ‚çš„åºåˆ—ç”Ÿæˆä»»åŠ¡æ—¶ã€‚å®ƒé€šå¸¸ç”¨äºæè¿°æ¨¡å‹ä¸­æœªè¢«å®Œå…¨æ•æ‰æˆ–å¤„ç†çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯èƒ½åŒ…å«é‡è¦çš„ç»†èŠ‚æˆ–æœªè¢«å……åˆ†åˆ©ç”¨çš„ç‰¹å¾ã€‚ä»¥ä¸‹æ˜¯å¯¹æ®‹å·®ä¿¡æ¯çš„è¯¦ç»†è§£é‡ŠåŠå…¶åœ¨è¯­éŸ³åˆæˆä¸­çš„åº”ç”¨ã€‚&lt;/p&gt;
&lt;h4 id=&#34;1-æ®‹å·®ä¿¡æ¯çš„å®šä¹‰&#34;&gt;&lt;strong&gt;1. æ®‹å·®ä¿¡æ¯çš„å®šä¹‰&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œ&lt;strong&gt;æ®‹å·®ä¿¡æ¯&lt;/strong&gt;é€šå¸¸æŒ‡çš„æ˜¯è¾“å…¥æ•°æ®ä¸æ¨¡å‹å½“å‰è¾“å‡ºä¹‹é—´çš„å·®å¼‚ã€‚è¿™ç§å·®å¼‚å¯èƒ½åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœªè¢«æ¨¡å‹æ•æ‰çš„ç»†èŠ‚&lt;/strong&gt;ï¼šæ¨¡å‹å¯èƒ½æœªèƒ½å®Œå…¨ç†è§£è¾“å…¥æ•°æ®ä¸­çš„æŸäº›å¤æ‚ç‰¹å¾ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å™ªå£°æˆ–è¯¯å·®&lt;/strong&gt;ï¼šè¾“å…¥æ•°æ®ä¸­å¯èƒ½å­˜åœ¨çš„å™ªå£°æˆ–æ¨¡å‹é¢„æµ‹ä¸­çš„è¯¯å·®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æœªå……åˆ†åˆ©ç”¨çš„ç‰¹å¾&lt;/strong&gt;ï¼šè¾“å…¥æ•°æ®ä¸­æŸäº›ç‰¹å¾å¯èƒ½æœªè¢«æ¨¡å‹å……åˆ†åˆ©ç”¨ï¼Œæ®‹å·®ä¿¡æ¯å¯ä»¥æä¾›é¢å¤–çš„çº¿ç´¢æ¥ä¼˜åŒ–è¿™äº›ç‰¹å¾çš„å¤„ç†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;2-æ®‹å·®ä¿¡æ¯åœ¨è¯­éŸ³åˆæˆä¸­çš„åº”ç”¨&#34;&gt;&lt;strong&gt;2. æ®‹å·®ä¿¡æ¯åœ¨è¯­éŸ³åˆæˆä¸­çš„åº”ç”¨&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;åœ¨è¯­éŸ³åˆæˆï¼ˆTTSï¼‰ç³»ç»Ÿä¸­ï¼Œæ®‹å·®ä¿¡æ¯å¯ä»¥ç”¨äºä¼˜åŒ–ç”Ÿæˆçš„è¯­éŸ³è´¨é‡å’Œè‡ªç„¶åº¦ã€‚ä»¥ä¸‹æ˜¯æ®‹å·®ä¿¡æ¯åœ¨è¯­éŸ³åˆæˆä¸­çš„å…·ä½“åº”ç”¨ï¼š&lt;/p&gt;
&lt;h4 id=&#34;21-åœ¨åŒè‡ªå›å½’æ¶æ„ä¸­çš„ä½œç”¨&#34;&gt;&lt;strong&gt;2.1 åœ¨åŒè‡ªå›å½’æ¶æ„ä¸­çš„ä½œç”¨&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;åœ¨Fish-Speechæ¡†æ¶ä¸­ï¼ŒåŒè‡ªå›å½’æ¶æ„ï¼ˆDual-ARï¼‰é€šè¿‡æ…¢é€Ÿå˜æ¢å™¨ï¼ˆSlow Transformerï¼‰å’Œå¿«é€Ÿå˜æ¢å™¨ï¼ˆFast Transformerï¼‰ååŒå·¥ä½œï¼Œå¤„ç†å…¨å±€å’Œå±€éƒ¨ä¿¡æ¯ã€‚æ®‹å·®ä¿¡æ¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ‰®æ¼”äº†é‡è¦è§’è‰²ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ…¢é€Ÿå˜æ¢å™¨çš„è¾“å‡º&lt;/strong&gt;ï¼šæ…¢é€Ÿå˜æ¢å™¨ç”Ÿæˆçš„éšè—çŠ¶æ€åŒ…å«äº†å…¨å±€è¯­ä¹‰ä¿¡æ¯ï¼Œä½†å¯èƒ½æœªèƒ½å®Œå…¨æ•æ‰åˆ°æ‰€æœ‰ç»†èŠ‚ã€‚è¿™äº›æœªè¢«å®Œå…¨å¤„ç†çš„ä¿¡æ¯å°±æ˜¯æ®‹å·®ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¿«é€Ÿå˜æ¢å™¨çš„ç»†åŒ–&lt;/strong&gt;ï¼šå¿«é€Ÿå˜æ¢å™¨æ¥æ”¶æ…¢é€Ÿå˜æ¢å™¨çš„è¾“å‡ºï¼Œå¹¶è¿›ä¸€æ­¥å¤„ç†æ®‹å·®ä¿¡æ¯ã€‚é€šè¿‡å¤„ç†è¿™äº›æ®‹å·®ä¿¡æ¯ï¼Œå¿«é€Ÿå˜æ¢å™¨èƒ½å¤Ÿè¡¥å……ç»†èŠ‚ï¼Œä¼˜åŒ–ç”Ÿæˆçš„è¯­éŸ³è´¨é‡ã€‚ä¾‹å¦‚ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç»†èŠ‚ç‰¹å¾çš„è¡¥å……&lt;/strong&gt;ï¼šå¿«é€Ÿå˜æ¢å™¨å¯ä»¥å¤„ç†æ®‹å·®ä¿¡æ¯ä¸­çš„å£°å­¦ç»†èŠ‚ï¼Œå¦‚éŸ³è°ƒã€è¯­è°ƒã€æƒ…æ„Ÿè¡¨è¾¾ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªç„¶åº¦çš„æå‡&lt;/strong&gt;ï¼šé€šè¿‡å¤„ç†æ®‹å·®ä¿¡æ¯ï¼Œå¿«é€Ÿå˜æ¢å™¨èƒ½å¤Ÿç”Ÿæˆæ›´è‡ªç„¶ã€æ›´æµç•…çš„è¯­éŸ³ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;22-åœ¨çŸ¢é‡é‡åŒ–ä¸­çš„ä½œç”¨&#34;&gt;&lt;strong&gt;2.2 åœ¨çŸ¢é‡é‡åŒ–ä¸­çš„ä½œç”¨&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;åœ¨GFSQï¼ˆGrouped Finite Scalar Vector Quantizationï¼‰ä¸­ï¼Œæ®‹å·®ä¿¡æ¯ä¹Ÿèµ·åˆ°é‡è¦ä½œç”¨ã€‚å…·ä½“æ¥è¯´ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é‡åŒ–è¿‡ç¨‹ä¸­çš„æ®‹å·®&lt;/strong&gt;ï¼šåœ¨é‡åŒ–è¿‡ç¨‹ä¸­ï¼Œè¾“å…¥ç‰¹å¾è¢«æ˜ å°„åˆ°ç æœ¬ä¸­çš„æœ€è¿‘é‚»å‘é‡ã€‚è¿™ä¸ªæ˜ å°„è¿‡ç¨‹å¯èƒ½ä¼šä¸¢å¤±ä¸€äº›ç»†èŠ‚ä¿¡æ¯ï¼Œè¿™äº›æœªè¢«å®Œå…¨æ˜ å°„çš„ä¿¡æ¯å°±æ˜¯æ®‹å·®ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŒ–ç æœ¬åˆ©ç”¨&lt;/strong&gt;ï¼šé€šè¿‡å¤„ç†è¿™äº›æ®‹å·®ä¿¡æ¯ï¼Œæ¨¡å‹å¯ä»¥æ›´å¥½åœ°è°ƒæ•´ç æœ¬çš„ä½¿ç”¨ï¼Œä»è€Œæé«˜åˆæˆè¯­éŸ³çš„è‡ªç„¶åº¦å’Œä¿çœŸåº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;23-åœ¨ç¥ç»å£°ç å™¨ä¸­çš„ä½œç”¨&#34;&gt;&lt;strong&gt;2.3 åœ¨ç¥ç»å£°ç å™¨ä¸­çš„ä½œç”¨&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;åœ¨ç¥ç»å£°ç å™¨ï¼ˆå¦‚FF-GANï¼‰ä¸­ï¼Œæ®‹å·®ä¿¡æ¯ç”¨äºä¼˜åŒ–ç”Ÿæˆçš„éŸ³é¢‘ä¿¡å·ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¢‘è°±ç»†èŠ‚çš„è¡¥å……&lt;/strong&gt;ï¼šç¥ç»å£°ç å™¨é€šè¿‡å¤„ç†æ®‹å·®ä¿¡æ¯ï¼Œè¡¥å……é¢‘è°±ä¸­çš„ç»†èŠ‚ï¼Œä»è€Œç”Ÿæˆæ›´è‡ªç„¶çš„éŸ³é¢‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é«˜é¢‘é‡å»º&lt;/strong&gt;ï¼šæ®‹å·®ä¿¡æ¯å¯ä»¥å¸®åŠ©ç¥ç»å£°ç å™¨æ›´å¥½åœ°é‡å»ºé«˜é¢‘æˆåˆ†ï¼Œè¿™å¯¹äºè¯­éŸ³çš„è‡ªç„¶åº¦å’Œæ¸…æ™°åº¦è‡³å…³é‡è¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;3-æ®‹å·®ä¿¡æ¯çš„å¤„ç†æ–¹æ³•&#34;&gt;3. æ®‹å·®ä¿¡æ¯çš„å¤„ç†æ–¹æ³•&lt;/h4&gt;
&lt;p&gt;åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ®‹å·®ä¿¡æ¯å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å¤„ç†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æ®‹å·®è¿æ¥ï¼ˆResidual Connectionsï¼‰&lt;/strong&gt;ï¼šåœ¨æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­ï¼Œæ®‹å·®è¿æ¥å…è®¸æ¨¡å‹ç›´æ¥ä¼ é€’è¾“å…¥ä¿¡æ¯åˆ°åç»­å±‚ï¼Œä»è€Œä¿ç•™æœªè¢«å¤„ç†çš„ç»†èŠ‚ã€‚ä¾‹å¦‚ï¼Œåœ¨Transformeræ¶æ„ä¸­ï¼Œæ®‹å·®è¿æ¥è¢«å¹¿æ³›ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„åŠ›æœºåˆ¶ï¼ˆAttention Mechanismsï¼‰&lt;/strong&gt;ï¼šé€šè¿‡æ³¨æ„åŠ›æœºåˆ¶ï¼Œæ¨¡å‹å¯ä»¥åŠ¨æ€åœ°å…³æ³¨è¾“å…¥æ•°æ®ä¸­çš„é‡è¦éƒ¨åˆ†ï¼Œä»è€Œæ›´å¥½åœ°å¤„ç†æ®‹å·®ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šå°ºåº¦ç‰¹å¾æå–&lt;/strong&gt;ï¼šé€šè¿‡å¤šå°ºåº¦ç‰¹å¾æå–ï¼Œæ¨¡å‹å¯ä»¥åŒæ—¶å¤„ç†å…¨å±€å’Œå±€éƒ¨ä¿¡æ¯ï¼Œä»è€Œæ›´å¥½åœ°åˆ©ç”¨æ®‹å·®ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;4-æ€»ç»“&#34;&gt;&lt;strong&gt;4. æ€»ç»“&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;æ®‹å·®ä¿¡æ¯åœ¨è¯­éŸ³åˆæˆä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ï¼Œå®ƒåŒ…å«äº†æœªè¢«æ¨¡å‹å®Œå…¨å¤„ç†çš„ç»†èŠ‚å’Œç‰¹å¾ã€‚é€šè¿‡åˆç†å¤„ç†æ®‹å·®ä¿¡æ¯ï¼Œæ¨¡å‹å¯ä»¥æ˜¾è‘—æå‡ç”Ÿæˆè¯­éŸ³çš„è´¨é‡å’Œè‡ªç„¶åº¦ã€‚åœ¨Fish-Speechæ¡†æ¶ä¸­ï¼Œæ®‹å·®ä¿¡æ¯é€šè¿‡åŒè‡ªå›å½’æ¶æ„å’ŒGFSQæŠ€æœ¯è¢«å……åˆ†åˆ©ç”¨ï¼Œä»è€Œå®ç°äº†é«˜æ•ˆã€é«˜è´¨é‡çš„è¯­éŸ³åˆæˆã€‚&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>è®ºæ–‡è§£è¯»ï¼šCosyVoice2: Scalable Streaming Speech Synthesis with Large Language Models</title>
      <link>https://weedge.github.io/post/multimoding/voices/cosyvoice2/</link>
      <pubDate>Fri, 17 Jan 2025 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/multimoding/voices/cosyvoice2/</guid>
      
        <description>&lt;h2 id=&#34;cosyvoice2-è®ºæ–‡&#34;&gt;CosyVoice2 è®ºæ–‡&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2412.10117&#34;&gt;2024.12  &lt;strong&gt;CosyVoice 2: Scalable Streaming Speech Synthesis with Large Language Models&lt;/strong&gt;&lt;/a&gt;ï¼ˆæµå¼åˆæˆï¼‰&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/FunAudioLLM/CosyVoice&#34;&gt;paper code&lt;/a&gt;: å…¬å¼€æ¨ç†å’Œæƒé‡ï¼Œè®­ç»ƒè¿‡ç¨‹éœ€è¦åœ¨CosyVoiceçš„åŸºç¡€ä¸Šä¿®æ”¹ä¸‹ã€‚&lt;/li&gt;
&lt;li&gt;achatbot TTS é›†æˆ CosyVoice2ï¼š &lt;a href=&#34;https://github.com/ai-bot-pro/achatbot/pull/107&#34;&gt;https://github.com/ai-bot-pro/achatbot/pull/107&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Colab achatbot_CosyVoice æ“ä½œç¬”è®°ï¼š &lt;a href=&#34;https://github.com/weedge/doraemon-nb/blob/main/achatbot_CosyVoice.ipynb&#34;&gt;https://github.com/weedge/doraemon-nb/blob/main/achatbot_CosyVoice.ipynb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Colab CosyVoice æ“ä½œç¬”è®°ï¼š &lt;a href=&#34;https://github.com/weedge/doraemon-nb/blob/main/CosyVoice.ipynb&#34;&gt;https://github.com/weedge/doraemon-nb/blob/main/CosyVoice.ipynb&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;æ‰©å±•é˜…è¯»&#34;&gt;æ‰©å±•é˜…è¯»&lt;/h2&gt;
&lt;h3 id=&#34;zero-shot-tts-models-é›¶æ ·æœ¬-tts-æ¨¡å‹&#34;&gt;zero-shot TTS models é›¶æ ·æœ¬ TTS æ¨¡å‹&lt;/h3&gt;
&lt;h4 id=&#34;codec-language-models-ç¼–è§£ç å™¨è¯­è¨€æ¨¡å‹&#34;&gt;codec language models ç¼–è§£ç å™¨è¯­è¨€æ¨¡å‹&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;speech &lt;strong&gt;codec model&lt;/strong&gt;  to extract discrete speech representation:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2107.03312&#34;&gt;2021.7 SoundStream: An End-to-End Neural Audio Codec&lt;/a&gt; | &lt;a href=&#34;https://github.com/wesbz/SoundStream&#34;&gt;code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2210.13438&#34;&gt;2022.10 &lt;strong&gt;High Fidelity Neural Audio Compression&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;http://github.com/facebookresearch/encodec&#34;&gt;facebookresearch/encodec&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2305.02765&#34;&gt;2023.5 HiFi-Codec: Group-residual Vector quantization for High Fidelity Audio Codec&lt;/a&gt; | &lt;a href=&#34;https://github.com/yangdongchao/AcademiCodec&#34;&gt;paper code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2309.07405&#34;&gt;2023.10 FunCodec: A Fundamental, Reproducible and Integrable Open-source Toolkit for Neural Speech Codec&lt;/a&gt; | &lt;a href=&#34;https://github.com/modelscope/FunCodec&#34;&gt;modelscope/FunCodec&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;speech &lt;strong&gt;codec model&lt;/strong&gt; + &lt;strong&gt;autoregressive model&lt;/strong&gt; to predict the speech tokens (acoustic tokens):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2301.02111&#34;&gt;2023.1 &lt;strong&gt;Neural Codec Language Models are Zero-Shot Text to Speech Synthesizers&lt;/strong&gt;&lt;/a&gt; (Vall-E) | ä»¥åŠåç»­ Vall-E å‡çº§ç³»åˆ— (ä¸åŒ…æ‹¬MELLE): &lt;a href=&#34;https://www.microsoft.com/en-us/research/project/vall-e-x/&#34;&gt;https://www.microsoft.com/en-us/research/project/vall-e-x/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2302.03540&#34;&gt;2023.2 Speak, Read and Prompt: High-Fidelity Text-to-Speech with Minimal Supervision&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;speech &lt;strong&gt;codec model&lt;/strong&gt; (speech semantics Codec) +  &lt;strong&gt;non-autoregressive masked model&lt;/strong&gt; to predict the speech tokens (acoustic tokens):&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2409.00750&#34;&gt;2024.9 &lt;strong&gt;MaskGCT: Zero-Shot Text-to-Speech with Masked Generative Codec Transformer&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://github.com/open-mmlab/Amphion/tree/main/models/tts/maskgct&#34;&gt;paper code&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;codec model (speech acoustic Codec) or  &lt;strong&gt;vocoder&lt;/strong&gt; to synthesize waveforms from mel-spectrograms:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://arxiv.org/abs/2306.00814&#34;&gt;2023.6 &lt;strong&gt;Vocos: Closing the gap between time-domain and Fourier-based neural vocoders for high-quality audio synthesis&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://github.com/gemelo-ai/vocos&#34;&gt;paper code&lt;/a&gt; | æ¨ç†é€Ÿåº¦å¿«ï¼šè¿è¡Œé€Ÿåº¦æ¯” HiFi-GAN å¿«çº¦ 13 å€ï¼Œæ¯” BigVGAN å¿«è¿‘ 70 å€ã€‚åœ¨æ²¡æœ‰ GPU åŠ é€Ÿçš„æƒ…å†µä¸‹è¿è¡Œæ—¶ï¼Œè¿™ç§é€Ÿåº¦ä¼˜åŠ¿å°¤å…¶æ˜æ˜¾ã€‚è¿™ä¸»è¦æ˜¯ç”±äºä½¿ç”¨äº†çŸ­æ—¶å‚…é‡Œå¶é€†å˜æ¢ï¼ˆISTFTï¼‰ç®—æ³•è€Œä¸æ˜¯è½¬ç½®å·ç§¯ã€‚è¿˜è¯„ä¼°äº† Vocos çš„ä¸€ä¸ªå˜ä½“ï¼Œå®ƒåˆ©ç”¨ ResBlock çš„æ‰©å¼ å·ç§¯è€Œä¸æ˜¯ ConvNeXt å—ã€‚åœ¨ GPU ä¸Šæ‰§è¡Œæ—¶ï¼Œæ·±åº¦å¯åˆ†ç¦»å·ç§¯å¯æä¾›é¢å¤–çš„åŠ é€Ÿã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://ieeexplore.ieee.org/document/10389765&#34;&gt;2023.12 &lt;strong&gt;WaveNeXt: ConvNeXt-Based Fast Neural Vocoder Without ISTFT layer&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://ast-astrec.nict.go.jp/demo_samples/asru_2023_okamoto/index.html&#34;&gt;demo samples&lt;/a&gt; | paper codeåŸºäº &lt;a href=&#34;https://arxiv.org/abs/2110.07840&#34;&gt;ESPNet2-TTS&lt;/a&gt;  | ä¸€ç§æ–°å‹çš„åŸºäºConvNeXtçš„å¿«é€Ÿç¥ç»å£°ç å™¨WaveNeXtï¼Œå®ƒé€šè¿‡æ›¿æ¢Vocosä¸­çš„é€†çŸ­æ—¶å‚…é‡Œå¶å˜æ¢ï¼ˆiSTFTï¼‰å±‚ä¸ºå¯è®­ç»ƒçš„çº¿æ€§å±‚ï¼Œç›´æ¥é¢„æµ‹è¯­éŸ³æ³¢å½¢æ ·æœ¬ï¼Œè€Œä¸ä¾èµ–äºSTFTé¢‘è°±ã€‚è¿™ä¸€æ”¹è¿›ä¸ä»…ä¿æŒäº†Vocosçš„å¿«é€Ÿæ¨ç†é€Ÿåº¦ï¼Œè¿˜æé«˜äº†è¯­éŸ³åˆæˆçš„è´¨é‡ã€‚æ–‡ç« è¿˜æ¢è®¨äº†å¦‚ä½•å°†WaveNeXtä¸åŸºäºJETSçš„ç«¯åˆ°ç«¯æ–‡æœ¬åˆ°è¯­éŸ³ï¼ˆE2E TTSï¼‰æ¡†æ¶é›†æˆï¼Œå¹¶ç ”ç©¶äº†é‡‡æ ·é¢‘ç‡ä¸º48kHzçš„å…¨å¸¦æ¨¡å‹ï¼ˆFull-band Modelï¼šèƒ½å¤Ÿå¤„ç†å’Œç”Ÿæˆè¦†ç›–æ•´ä¸ªéŸ³é¢‘é¢‘è°±èŒƒå›´çš„æ¨¡å‹ï¼Œé€šå¸¸æ˜¯æŒ‡èƒ½å¤Ÿå¤„ç†ä»æœ€ä½é¢‘åˆ°æœ€é«˜é¢‘çš„å®Œæ•´éŸ³é¢‘ä¿¡å·çš„æ¨¡å‹ï¼‰ã€‚å®éªŒç»“æœè¡¨æ˜ï¼ŒWaveNeXtåœ¨åˆ†æ-åˆæˆå’ŒE2E TTSæ¡ä»¶ä¸‹å‡ä¼˜äºVocosï¼ŒåŒæ—¶ä¿æŒäº†å¿«é€Ÿæ¨ç†çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/4a1eeaff-528f-4706-b5fc-210caea2c13b&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;feature-diffusion-models-ç‰¹å¾æ‰©æ•£æ¨¡å‹&#34;&gt;feature diffusion models ç‰¹å¾æ‰©æ•£æ¨¡å‹&lt;/h4&gt;
&lt;p&gt;DDPM + CFM + NAR(non-autoregressive) model, æ²¡æœ‰ codec&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Base module:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Denoising Diffusion Probabilistic Model(DDPM)ï¼š &lt;a href=&#34;https://arxiv.org/abs/2006.11239&#34;&gt;2020.6 &lt;strong&gt;Denoising Diffusion Probabilistic Models&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://github.com/hojonathanho/diffusion&#34;&gt;paper code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Conditional Flow Matching (CFM)ï¼š  &lt;a href=&#34;https://arxiv.org/abs/2210.02747&#34;&gt;2022.10 &lt;strong&gt;Flow Matching for Generative Modeling&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://github.com/atong01/conditional-flow-matching&#34;&gt;CFM lib&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;the alignment modeling between input text and synthesized speech&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;phoneme-level duration model:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2403.03100&#34;&gt;2024.5 NaturalSpeech 3&lt;/a&gt;  and &lt;a href=&#34;https://arxiv.org/abs/2306.15687&#34;&gt;2023.6 Voicebox&lt;/a&gt; use frame-wise phoneme alignment;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2309.03199&#34;&gt;2023.9 Matcha-TTS&lt;/a&gt; adopts monotonic alignment search(MAS) and relies on phoneme-level duration model;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2406.18009&#34;&gt;2024.6 E2 TTS&lt;/a&gt; å’Œ&lt;a href=&#34;https://arxiv.org/abs/2406.02430&#34;&gt;2024.6 Seed-TTS&lt;/a&gt; ç ”ç©¶è¡¨æ˜åœ¨æ–‡æœ¬å’Œè¯­éŸ³ä¹‹é—´å¼•å…¥è¿™ç§åƒµåŒ–å’Œä¸çµæ´»çš„å¯¹é½æ–¹å¼ä¼šé˜»ç¢æ¨¡å‹ç”Ÿæˆæ›´è‡ªç„¶çš„ç»“æœã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;E3 TTS æ”¾å¼ƒéŸ³ç´ çº§æŒç»­æ—¶é—´å¹¶å¯¹è¾“å…¥åºåˆ—åº”ç”¨äº¤å‰æ³¨æ„åŠ›ï¼Œä½†äº§ç”Ÿçš„éŸ³é¢‘è´¨é‡æœ‰é™ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;DiTTo-TTS ä½¿ç”¨æ‰©æ•£å˜æ¢å™¨ (DiT) ï¼Œå¹¶ä»¥æ¥è‡ªé¢„è®­ç»ƒè¯­è¨€æ¨¡å‹çš„ç¼–ç æ–‡æœ¬ä¸ºæ¡ä»¶è¿›è¡Œäº¤å‰æ³¨æ„ã€‚ä¸ºäº†è¿›ä¸€æ­¥å¢å¼ºå¯¹é½ï¼Œå®ƒä½¿ç”¨é¢„è®­ç»ƒçš„è¯­è¨€æ¨¡å‹æ¥å¾®è°ƒç¥ç»éŸ³é¢‘ç¼–è§£ç å™¨ï¼Œå°†è¯­ä¹‰ä¿¡æ¯æ³¨å…¥ç”Ÿæˆçš„è¡¨ç¤ºä¸­ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›¸æ¯”ä¹‹ä¸‹ï¼ŒåŸºäº Voiceboxçš„ E2 TTSé‡‡ç”¨äº†æ›´ç®€å•çš„æ–¹æ³•ï¼Œåˆ é™¤äº†éŸ³ç´ å’ŒæŒç»­æ—¶é—´é¢„æµ‹å™¨ï¼Œç›´æ¥ä½¿ç”¨å¡«å……tokenå¡«å……åˆ°æ¢…å°”é¢‘è°±å›¾é•¿åº¦çš„å­—ç¬¦ä½œä¸ºè¾“å…¥ã€‚è¿™ä¸ªç®€å•çš„æ–¹æ¡ˆä¹Ÿå®ç°äº†éå¸¸è‡ªç„¶å’ŒçœŸå®çš„åˆæˆç»“æœã€‚ç„¶è€Œï¼ŒF5-TTS å‘ç° E2 TTS ä¸­æ–‡æœ¬å’Œè¯­éŸ³å¯¹é½å­˜åœ¨é²æ£’æ€§é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://arxiv.org/abs/2406.02430&#34;&gt;2024.6 Seed-TTS&lt;/a&gt; é‡‡ç”¨äº†ç±»ä¼¼çš„ç­–ç•¥å¹¶å–å¾—äº†ä¼˜å¼‚çš„ç»“æœï¼Œå°½ç®¡æ²¡æœ‰è¯¦ç»†è¯´æ˜æ¨¡å‹ç»†èŠ‚ã€‚åœ¨è¿™äº›æœªæ˜ç¡®å»ºæ¨¡éŸ³ç´ çº§æŒç»­æ—¶é—´çš„æ–¹æ³•ä¸­ï¼Œæ¨¡å‹å­¦ä¹ æ ¹æ®ç»™å®šçš„æ€»åºåˆ—é•¿åº¦åˆ†é…æ¯ä¸ªå•è¯æˆ–éŸ³ç´ çš„é•¿åº¦ï¼Œä»è€Œæ”¹è¿›éŸµå¾‹å’ŒèŠ‚å¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://arxiv.org/abs/2410.06885&#34;&gt;2024.10 &lt;strong&gt;F5-TTS: A fairytaler that fakes fluent and faithful speech with flow matching&lt;/strong&gt;&lt;/a&gt; ä¿æŒäº†ç®¡é“çš„ç®€å•æ€§ï¼Œæ— éœ€éŸ³ç´ å¯¹é½ã€æŒç»­æ—¶é—´é¢„æµ‹å™¨ã€æ–‡æœ¬ç¼–ç å™¨å’Œè¯­ä¹‰æ³¨å…¥ç¼–è§£ç å™¨æ¨¡å‹ï¼Œåˆ©ç”¨å¸¦æœ‰ &lt;a href=&#34;https://arxiv.org/abs/2301.00808&#34;&gt;ConvNeXt V2&lt;/a&gt;|&lt;a href=&#34;https://github.com/facebookresearch/ConvNeXt-V2&#34;&gt;paper code&lt;/a&gt; çš„Diffusion Transformer(DiT)æ¥æ›´å¥½åœ°è§£å†³ä¸Šä¸‹æ–‡å­¦ä¹ æœŸé—´çš„æ–‡æœ¬è¯­éŸ³å¯¹é½é—®é¢˜ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;codec-language-and-feature-diffusion-hybrid-systems-æ··åˆç³»ç»Ÿ&#34;&gt;codec language and feature diffusion hybrid systems æ··åˆç³»ç»Ÿ&lt;/h4&gt;
&lt;p&gt;text-to-codec language model  å’Œ codec-to-feature diffusion model&lt;/p&gt;
&lt;p&gt;è¯­è¨€æ¨¡å‹è§£å†³æ–‡æœ¬å’Œè¯­éŸ³ä¹‹é—´çš„å¯¹é½ä»¥åŠè¯è¯­æŒç»­æ—¶é—´é¢„æµ‹ï¼Œè€Œç¼–è§£ç å™¨åˆ°ç‰¹å¾æ‰©æ•£æ¨¡å‹åˆ™æ ¹æ®ç”Ÿæˆçš„ç¼–è§£ç å™¨å’Œå…¶ä»–æ¡ä»¶åˆæˆè¯­éŸ³ç‰¹å¾ï¼ˆæ¢…å°”è°±ï¼‰ã€‚é€šè¿‡åˆ©ç”¨ä¸¤ç§ç”Ÿæˆæ¨¡å‹çš„ä¼˜åŠ¿ï¼Œæ··åˆç³»ç»Ÿå®ç°äº†é«˜åº¦å¤šæ ·æ€§ã€éŸµå¾‹ä¸€è‡´æ€§å’Œè¯­éŸ³è´¨é‡ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2406.02430&#34;&gt;2024.6 Seed-TTS&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2407.05407&#34;&gt;2024.7 Cosyvoice&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2409.03283&#34;&gt;2024.9 Fireredtts&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;language-model-based-zero-shot-tts-models--streaming-synthesis&#34;&gt;language model-based zero-shot TTS models  &lt;strong&gt;streaming&lt;/strong&gt; synthesis&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2402.08093&#34;&gt;2024.2 &lt;strong&gt;BASE TTS: Lessons from building a billion-parameter Text-to-Speech model on 100K hours of data&lt;/strong&gt;&lt;/a&gt; | å°çº¢ä¹¦çš„FireRedTTS æ¥æºäºæ­¤ &lt;a href=&#34;https://github.com/FireRedTeam/FireRedTTS&#34;&gt;FireRedTTS paper code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2406.02897&#34;&gt;2024.6 LiveSpeech: Low-Latency Zero-shot Text-to-Speech via Autoregressive Modeling of Audio Discrete Codes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2309.11210&#34;&gt;2024.9 Speak While You Think: Streaming Speech Synthesis During Text Generation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2410.00767&#34;&gt;2024.10 Zero-Shot Text-to-Speech from Continuous Text Streams&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;cosyvoice2&#34;&gt;CosyVoice2&lt;/h2&gt;
&lt;p&gt;Cosyvoice2 å¯¹ Cosyvoice è¿›è¡Œäº†å‡çº§ï¼Œä¸»è¦åŒ…æ‹¬å¦‚ä¸‹å››ç‚¹ï¼šï¼ˆæ¨¡å‹ç²¾ç®€æ¶ˆèï¼Œå¯æ›¿æ¢åŒç±»å‹ä¸åŒå‚æ•°é‡çš„æ–‡æœ¬LLMsï¼Œæé«˜ç æœ¬åˆ©ç”¨ç‡ï¼Œæ— æŸæµå¼åˆæˆï¼Œè¯­ä¹‰-å£°å­¦è§£è€¦å»ºæ¨¡ï¼ŒæŒ‡ä»¤å’Œé›¶æ ·æœ¬èƒ½åŠ›æ¨¡å‹æ•´åˆï¼‰&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†æµå¼å’Œéæµå¼åˆæˆç»Ÿä¸€åœ¨å•ä¸€æ¡†æ¶ä¸­ï¼Œå¹¶æå‡ºç»Ÿä¸€çš„æ–‡æœ¬è¯­éŸ³è¯­è¨€æ¨¡å‹å’Œå—æ„ŸçŸ¥å› æœæµåŒ¹é…æ¨¡å‹(&lt;strong&gt;chunk-aware causal flow matching model&lt;/strong&gt;)ï¼Œä»è€Œå®ç°ä¸ç¦»çº¿æ¨¡å¼ç›¸æ¯”çš„æ— æŸæµå¼åˆæˆã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡**åˆ é™¤æ–‡æœ¬ç¼–ç å™¨(text encoder)å’Œè¯´è¯äººåµŒå…¥(speaker embedding)**æ¥ç®€åŒ–LM æ¶æ„ï¼Œå…è®¸é¢„å…ˆè®­ç»ƒçš„æ–‡æœ¬å¤§è¯­è¨€æ¨¡å‹( LLMs ) ä½œä¸ºéª¨å¹²ï¼Œå¢å¼ºä¸Šä¸‹æ–‡ç†è§£ã€‚&lt;/li&gt;
&lt;li&gt;ç”¨æœ‰é™æ ‡é‡é‡åŒ– (&lt;strong&gt;finite scalar quantization&lt;/strong&gt; FSQ | &lt;a href=&#34;https://arxiv.org/abs/2309.15505&#34;&gt;2023.9 &lt;strong&gt;Finite Scalar Quantization: VQ-VAE Made Simple&lt;/strong&gt;&lt;/a&gt;| &lt;a href=&#34;https://github.com/google-research/google-research/tree/master/fsq&#34;&gt;paper code&lt;/a&gt;) å–ä»£è¯­éŸ³tokenå™¨ä¸­çš„çŸ¢é‡é‡åŒ– (VQ)ï¼Œæé«˜ç æœ¬åˆ©ç”¨ç‡å¹¶æ•è·æ›´å¤šè¯­éŸ³ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;å‡çº§æŒ‡ä»¤TTS èƒ½åŠ›ï¼Œæ”¯æŒæ›´å¤šæŒ‡ä»¤ï¼ŒåŒ…æ‹¬æƒ…æ„Ÿã€å£éŸ³ã€è§’è‰²é£æ ¼å’Œç»†ç²’åº¦æ§åˆ¶ã€‚åœ¨ CosyVoice 2 ä¸­ï¼ŒæŒ‡ä»¤å’Œé›¶æ ·æœ¬èƒ½åŠ›è¢«é›†æˆåˆ°ä¸€ä¸ªæ¨¡å‹ä¸­ï¼Œä»è€Œå®ç°æ›´é€šç”¨å’Œç”ŸåŠ¨çš„åˆæˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/651d93fd-56b3-4390-8fd9-90312c70d6f6&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;CosyVoice 2 åŸºäºå…¶å‰èº«çš„è®¾è®¡ç†å¿µï¼Œé€šè¿‡åˆ†ç¦»è¯­éŸ³ä¿¡å·çš„è¯­ä¹‰å’Œå£°å­¦ä¿¡æ¯ï¼Œå¹¶ç‹¬ç«‹åœ°å¯¹å®ƒä»¬è¿›è¡Œå»ºæ¨¡ã€‚è¯­éŸ³ç”Ÿæˆè¿‡ç¨‹è¢«é‡æ–°å®šä¹‰ä¸ºä¸€ä¸ªé€æ­¥çš„è¯­ä¹‰è§£ç è¿‡ç¨‹ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­é€æ­¥å¼•å…¥æ¡ä»¶ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡æœ¬-è¯­éŸ³è¯­è¨€æ¨¡å‹ï¼ˆLMï¼‰ä»…å…³æ³¨è¯­ä¹‰ä¿¡æ¯ï¼Œå°†é«˜çº§æ–‡æœ¬tokenè§£ç ä¸ºå—ç›‘ç£çš„è¯­ä¹‰speech tokenã€‚&lt;/li&gt;
&lt;li&gt;åœ¨æµåŒ¹é…æ¨¡å‹ä¸­ï¼Œé€šè¿‡speaker embeddingå’Œå‚è€ƒè¯­éŸ³å¼•å…¥å£°å­¦ç»†èŠ‚ï¼ˆå¦‚éŸ³è‰²ï¼‰ï¼Œå°†speech tokenè½¬æ¢ä¸ºç»™å®šè¯´è¯äººçš„ Mel é¢‘è°±ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œé¢„è®­ç»ƒçš„å£°ç å™¨æ¨¡å‹æ¢å¤ç›¸ä½ï¼Œå°† Mel é¢‘è°±è½¬æ¢å›åŸå§‹éŸ³é¢‘ä¿¡å·ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸‹å°†è¯¦ç»†ä»‹ç» CosyVoice 2 ä»¥åŠä¸ºæµå¼åˆæˆæ‰€åšçš„ä¿®æ”¹ï¼Œä»äº”ä¸ªæ–¹é¢è¿›è¡Œé˜è¿°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡æœ¬tokenizer&lt;/li&gt;
&lt;li&gt;å—ç›‘ç£çš„è¯­ä¹‰speech tokenizer&lt;/li&gt;
&lt;li&gt;ç»Ÿä¸€çš„æ–‡æœ¬-è¯­éŸ³ LM&lt;/li&gt;
&lt;li&gt;æµå¼/éæµå¼åˆæˆ&lt;/li&gt;
&lt;li&gt;å—æ„ŸçŸ¥æµåŒ¹é…æ¨¡å‹&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ–‡æœ¬tokenizer&#34;&gt;æ–‡æœ¬tokenizer&lt;/h3&gt;
&lt;p&gt;CosyVoice 2 &lt;strong&gt;ç›´æ¥ä½¿ç”¨åŸå§‹æ–‡æœ¬ä½œä¸ºè¾“å…¥ï¼Œé€šè¿‡åŸºäº BPE çš„æ–‡æœ¬tokenizerè¿›è¡ŒtokenåŒ–&lt;/strong&gt;ã€‚è¿™æ¶ˆé™¤äº†éœ€è¦é€šè¿‡å›¾éŸ³è½¬æ¢ï¼ˆg2pï¼‰è·å–éŸ³ç´ çš„å‰ç«¯æ¨¡å‹çš„éœ€æ±‚ã€‚è¿™ç§æ–¹æ³•ä¸ä»…ç®€åŒ–äº†æ•°æ®é¢„å¤„ç†æµç¨‹ï¼Œè¿˜ä½¿æ¨¡å‹èƒ½å¤Ÿä»¥ç«¯åˆ°ç«¯çš„æ–¹å¼å­¦ä¹ ä¸åŒä¸Šä¸‹æ–‡ä¸­å•è¯çš„å‘éŸ³ã€‚&lt;strong&gt;ä¸æ–‡æœ¬ LLM ä¸­å¸¸ç”¨çš„tokenizerä¸åŒï¼ŒCosyVoice 2 ä¼šå±è”½æ‰ä¸€å¯¹å¤šçš„tokenã€‚è¿™å¯ä»¥é˜²æ­¢tokençš„å‘éŸ³å˜å¾—è¿‡é•¿ï¼Œå¹¶å‡å°‘ç”±äºæ•°æ®ç¨€ç–æ€§å¼•èµ·çš„è¾¹ç¼˜æƒ…å†µ&lt;/strong&gt;ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ª BPE tokenç¼–ç äº†å¤šä¸ªä¸­æ–‡å­—ç¬¦ï¼Œå®ƒå°†è¢«å±è”½ï¼Œå¹¶ä¸”åœ¨tokenåŒ–è¿‡ç¨‹ä¸­æ¯ä¸ªå­—ç¬¦å°†åˆ†åˆ«è¿›è¡Œç¼–ç ã€‚å…¶ä»–è¯­è¨€ï¼Œå¦‚è‹±è¯­ã€æ—¥è¯­å’ŒéŸ©è¯­ï¼Œä¸è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å—ç›‘ç£çš„è¯­ä¹‰speech-tokenizer&#34;&gt;å—ç›‘ç£çš„è¯­ä¹‰speech tokenizer&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;å°†æœ‰é™æ ‡é‡é‡åŒ–ï¼ˆFSQï¼‰æ¨¡å—æ’å…¥åˆ° SenseVoice-Large ASR æ¨¡å‹çš„ç¼–ç å™¨ä¸­&lt;/strong&gt;ã€‚åœ¨è®­ç»ƒé˜¶æ®µï¼Œè¾“å…¥è¯­éŸ³ X é€šè¿‡ $Encoder_1$ è·å–ä¸­é—´è¡¨ç¤ºï¼Œå…¶ä¸­ $Encoder_1$ ç”±å…­ä¸ªå¸¦æœ‰æ—‹è½¬ä½ç½®åµŒå…¥çš„ Transformer å—ç»„æˆã€‚ç„¶åï¼Œä¸­é—´è¡¨ç¤ºè¢«é€å…¥ FSQ æ¨¡å—è¿›è¡Œé‡åŒ–ï¼Œé‡åŒ–åçš„è¡¨ç¤ºé€šè¿‡ SenseVoice-Large çš„å…¶ä½™æ¨¡å—ï¼ŒåŒ…æ‹¬ $Encoder_2$ å’Œ ASR Decoderï¼Œä»¥é¢„æµ‹å¯¹åº”æ–‡æœ¬tokençš„åéªŒæ¦‚ç‡ã€‚
åœ¨ FSQ æ¨¡å—ä¸­ï¼Œä¸­é—´è¡¨ç¤º $H$ é¦–å…ˆè¢«æŠ•å½±åˆ°ä¸€ä¸ª $D$ ç»´çš„ä½ç§©ç©ºé—´ä¸­ï¼Œæ¯ä¸ªç»´åº¦çš„å€¼é€šè¿‡æœ‰ç•Œå››èˆäº”å…¥æ“ä½œ ROUND é‡åŒ–ä¸º $[-K, K]$ ã€‚ç„¶åï¼Œé‡åŒ–åçš„ä½ç§©è¡¨ç¤º $\bar{H}$ è¢«æŠ•å½±å›åŸå§‹ç»´åº¦ $\tilde{H}$
ä»¥ä¾›åç»­æ¨¡å—ä½¿ç”¨ï¼š&lt;/p&gt;
&lt;p&gt;$$
\bar{H} = \text{ROUND}(\text{Proj}_{\text{down}}(H));
$$&lt;/p&gt;
&lt;p&gt;$$
\hat{H} = \text{Proj}_{\text{up}}(\bar{H})
$$&lt;/p&gt;
&lt;p&gt;åœ¨è®­ç»ƒé˜¶æ®µï¼Œä½¿ç”¨ç›´é€šä¼°è®¡æ¥è¿‘ä¼¼ FSQ æ¨¡å—å’Œ Encoder1 çš„æ¢¯åº¦ã€‚speech token $\mu_i$ å¯ä»¥é€šè¿‡è®¡ç®—é‡åŒ–åçš„ä½ç§©è¡¨ç¤º $\bar{h}_i$ åœ¨ $(2K + 1)$ è¿›åˆ¶ç³»ç»Ÿä¸­çš„ç´¢å¼•æ¥è·å¾—ï¼š&lt;/p&gt;
&lt;p&gt;$$
\mu_i = \sum_{j=0}^{D-1} \bar{h}_{i,j} (2K + 1)^j
$$&lt;/p&gt;
&lt;p&gt;$Encoder_1$ã€FSQ æ¨¡å—çš„ä½ç§©æŠ•å½±å™¨ã€æœ‰ç•Œå››èˆäº”å…¥æ“ä½œå’Œç´¢å¼•è®¡ç®—æ„æˆäº† CosyVoice 2 çš„speech tokenizerã€‚peech tokenizerçš„å·¥ä½œé€Ÿç‡ä¸ºæ¯ç§’ 25 ä¸ªspeech tokenï¼Œå³æ¯ç§’ 25 ä¸ªspeech tokenã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç»Ÿä¸€çš„æ–‡æœ¬-è¯­éŸ³è¯­è¨€æ¨¡å‹unified-text-speech-language-model&#34;&gt;ç»Ÿä¸€çš„æ–‡æœ¬-è¯­éŸ³è¯­è¨€æ¨¡å‹(Unified Text-Speech Language Model)&lt;/h3&gt;
&lt;p&gt;åœ¨ CosyVoice 2 ä¸­ï¼Œä½¿ç”¨é¢„è®­ç»ƒçš„æ–‡æœ¬ LLMï¼ŒQwen2.5-0.5Bï¼Œä½œä¸ºæ–‡æœ¬-è¯­éŸ³è¯­è¨€æ¨¡å‹ï¼Œä»¥è¾“å…¥æ–‡æœ¬ä¸ºæç¤ºè‡ªå›å½’åœ°ç”Ÿæˆspeech tokenã€‚ä¸å…¶å®ƒè¯­è¨€æ¨¡å‹ç±»ä¼¼ï¼Œæ–‡æœ¬-è¯­éŸ³ LM ä¹Ÿä»¥ä¸‹ä¸€ä¸ªtokené¢„æµ‹æ–¹æ¡ˆè¿›è¡Œè®­ç»ƒï¼Œä¸ä¹‹å‰çš„ CosyVoice ä¸åŒ:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å»é™¤äº†speaker embeddingä»¥é¿å…ä¿¡æ¯æ³„éœ²&lt;/strong&gt;ã€‚å‘ç°è¿™ç§è¯è¯­çº§å‘é‡ä¸ä»…åŒ…å«è¯´è¯äººèº«ä»½ï¼Œè¿˜åŒ…å«è¯­è¨€å’Œå‰¯è¯­è¨€ä¿¡æ¯(paralanguage information: æŒ‡åœ¨å£è¯­äº¤æµä¸­ï¼Œé™¤äº†è¯­è¨€å†…å®¹æœ¬èº«ä¹‹å¤–çš„å…¶ä»–å£°éŸ³ç‰¹å¾å’Œè¡¨è¾¾æ–¹å¼ã€‚è¿™äº›ä¿¡æ¯è™½ç„¶ä¸ç›´æ¥æ¶‰åŠè¯­è¨€çš„è¯æ±‡æˆ–è¯­æ³•ç»“æ„ï¼Œä½†å¯¹ç†è§£å’Œä¼ è¾¾è¯´è¯äººçš„æ„å›¾ã€æƒ…æ„Ÿå’Œæ€åº¦ç­‰æ–¹é¢èµ·ç€é‡è¦ä½œç”¨)ï¼Œè¿™ä¼šæŸå®³æ–‡æœ¬-è¯­éŸ³ LM çš„è¯­è°ƒè‡ªç„¶åº¦å’Œè·¨è¯­è¨€èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ”¾å¼ƒäº†ä¹‹å‰ CosyVoice çš„ text encoder&lt;/strong&gt;ï¼Œå› ä¸ºå‘ç° Qwen2.5-0.5B æ¨¡å‹è¶³å¤Ÿå¼ºå¤§ï¼Œèƒ½å¤Ÿå¯¹é½æ–‡æœ¬å’Œspeech tokenï¼Œå› æ­¤ä¸å†éœ€è¦text encoderã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;lmæµå¼éæµå¼åˆæˆstreaming-and-non-streaming-synthesis&#34;&gt;LMæµå¼/éæµå¼åˆæˆ(streaming and non-streaming synthesis)&lt;/h3&gt;
&lt;p&gt;å¾—ç›Šäºæ–‡æœ¬-è¯­éŸ³ LM çš„ç®€æ´æ€§ï¼Œå¯ä»¥æ„å»ºä¸€ä¸ªç»Ÿä¸€çš„æ¨¡å‹ï¼Œç”¨äºæµå¼å’Œéæµå¼åˆæˆã€‚åœ¨è¿™é‡Œï¼Œâ€œæµå¼æ¨¡å¼(Streaming mode)â€æ„å‘³ç€è¾“å…¥æ–‡æœ¬æ˜¯è¿ç»­æ¥æ”¶çš„ï¼Œè€Œä¸æ˜¯é¢„å…ˆä½œä¸ºå®Œæ•´å¥å­å·²çŸ¥çš„ã€‚åœ¨ CosyVoice 2 ä¸­ï¼Œæµå¼å’Œéæµå¼æ¨¡å¼ä¹‹é—´çš„åŒºåˆ«ä»…åœ¨äº LM çš„åºåˆ—æ„å»ºæ–¹å¼ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/04156456-4018-4b0e-ace8-b7b7fb36b6d5&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éæµå¼æ¨¡å¼(Non-Streaming mode)&lt;/strong&gt;ï¼šå°†â€œåºåˆ—å¼€å§‹â€ $S$ ã€æ‰€æœ‰æ–‡æœ¬tokenã€â€œè¯è¯­è½¬æ¢â€token $T$ ã€æ‰€æœ‰speech tokenå’Œâ€œåºåˆ—ç»“æŸâ€ $E$ ä¾æ¬¡è¿æ¥ï¼Œå¦‚å›¾ 2 åº•éƒ¨æ‰€ç¤ºã€‚å¿½ç•¥tokenæ„å‘³ç€åœ¨æœ€å°åŒ–äº¤å‰ç†µç›®æ ‡å‡½æ•°æ—¶å¿½ç•¥å®ƒä»¬çš„æŸå¤±ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµå¼æ¨¡å¼(Streaming mode)&lt;/strong&gt;ï¼šå°†æ–‡æœ¬å’Œspeech tokenä»¥é¢„å®šä¹‰çš„æ¯”ä¾‹ $N:M$ æ··åˆï¼Œå³æ¯ $N$ ä¸ªæ–‡æœ¬tokenåé¢è·Ÿéš $M$ ä¸ªspeech tokenã€‚å¦‚æœä¸‹ä¸€ä¸ªtokenæ˜¯æ–‡æœ¬tokenï¼Œæ¨¡å‹æœŸæœ›é¢„æµ‹ä¸€ä¸ªå¡«å……tokenï¼ˆè€Œä¸æ˜¯æ–‡æœ¬tokenï¼‰ï¼Œè¿™è¡¨ç¤ºåœ¨æ¨ç†é˜¶æ®µåº”å°†æ¥ä¸‹æ¥çš„ $N$ ä¸ªæ–‡æœ¬tokenè¿æ¥èµ·æ¥ã€‚ä¸€æ—¦æ–‡æœ¬tokenç”¨å®Œï¼Œâ€œè¯è¯­è½¬æ¢â€token $T$ å’Œå‰©ä½™çš„speech tokenå°†ä¾æ¬¡è¿æ¥ï¼Œå½¢æˆæµå¼æ¨¡å¼ä¸­çš„æ··åˆæ–‡æœ¬-speech tokenåºåˆ—ã€‚&lt;strong&gt;åœ¨çš„å®éªŒä¸­ï¼Œ $N$ å’Œ $M$ åˆ†åˆ«è®¾ç½®ä¸º 5 å’Œ 15&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡åŒæ—¶åœ¨ä¸Šè¿°ä¸¤ç§åºåˆ—ä¸Šè®­ç»ƒæ–‡æœ¬-è¯­éŸ³ LMï¼Œå¯ä»¥åœ¨å•ä¸ªç»Ÿä¸€æ¨¡å‹ä¸­æ‰§è¡Œæµå¼å’Œéæµå¼è¯­éŸ³ç”Ÿæˆã€‚åœ¨å®é™…åœºæ™¯ä¸­ï¼Œä¾‹å¦‚è¯´è¯äººå¾®è°ƒï¼ˆSFTï¼‰å’Œä¸Šä¸‹æ–‡å­¦ä¹ ï¼ˆICLï¼‰ï¼Œæ¨ç†åºåˆ—æœ‰æ‰€ä¸åŒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ICLï¼Œéæµå¼&lt;/strong&gt;ï¼šåœ¨ ICL ä¸­ï¼ŒLM éœ€è¦å‚è€ƒéŸ³é¢‘çš„æç¤ºæ–‡æœ¬å’Œspeech tokenæ¥æ¨¡ä»¿å£éŸ³ã€è¯­è°ƒã€æƒ…æ„Ÿå’Œé£æ ¼ã€‚åœ¨éæµå¼æ¨¡å¼ä¸­ï¼Œæç¤ºå’Œå¾…åˆæˆçš„æ–‡æœ¬tokenè¢«ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿æ¥èµ·æ¥ï¼Œæç¤ºspeech tokenè¢«è§†ä¸ºé¢„ç”Ÿæˆçš„ç»“æœå¹¶å›ºå®šï¼šâ€œ $S$ ï¼Œæç¤ºæ–‡æœ¬ï¼Œæ–‡æœ¬ï¼Œ $T$ ï¼Œæç¤ºè¯­éŸ³â€ã€‚LM çš„è‡ªå›å½’ç”Ÿæˆä»è¿™æ ·çš„åºåˆ—å¼€å§‹ï¼Œç›´åˆ°æ£€æµ‹åˆ°â€œåºåˆ—ç»“æŸâ€token $E$ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ICLï¼Œæµå¼&lt;/strong&gt;ï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‡è®¾å¾…ç”Ÿæˆçš„æ–‡æœ¬å·²ç»å·²çŸ¥ï¼Œspeech tokenåº”ä»¥æµå¼æ–¹å¼ç”Ÿæˆã€‚åŒæ ·ï¼Œå°†æç¤ºå’Œå¾…ç”Ÿæˆçš„æ–‡æœ¬ä½œä¸ºä¸€ä¸ªæ•´ä½“å¤„ç†ã€‚ç„¶åï¼Œå°†å®ƒä»¬ä¸æç¤ºspeech tokenä»¥ $N:M$ çš„æ¯”ä¾‹æ··åˆï¼šâ€œ $S$ ï¼Œæ··åˆæ–‡æœ¬è¯­éŸ³ï¼Œ $T$ ï¼Œå‰©ä½™è¯­éŸ³â€ã€‚å¦‚æœæ–‡æœ¬çš„é•¿åº¦å¤§äºæç¤ºspeech tokençš„é•¿åº¦ï¼ŒLM å°†ç”Ÿæˆâ€œå¡«å……tokenâ€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰‹åŠ¨å¡«å…… $N$ ä¸ªæ–‡æœ¬tokenã€‚å¦‚æœæ–‡æœ¬tokenç”¨å®Œï¼Œâ€œè¯è¯­è½¬æ¢â€token $T$ å°†è¢«æ·»åŠ ã€‚åœ¨æµå¼æ¨¡å¼ä¸­ï¼Œæ¯ç”Ÿæˆ $M$ ä¸ªtokenå°±è¿”å›ä¸€æ¬¡ç”Ÿæˆç»“æœï¼Œç›´åˆ°æ£€æµ‹åˆ° $E$ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SFTï¼Œéæµå¼&lt;/strong&gt;ï¼šåœ¨ SFT åœºæ™¯ä¸­ï¼ŒLM åœ¨ç‰¹å®šè¯´è¯äººä¸Šè¿›è¡Œå¾®è°ƒï¼Œæç¤ºæ–‡æœ¬å’Œè¯­éŸ³ä¸å†éœ€è¦ã€‚å› æ­¤ï¼Œåˆå§‹åºåˆ—éå¸¸ç®€å•ï¼šâ€œ $S$ ï¼Œæ–‡æœ¬ï¼Œ $T$ â€ã€‚ä»è¿™é‡Œå¼€å§‹ï¼Œæ–‡æœ¬-è¯­éŸ³ LM å¯ä»¥è‡ªå›å½’åœ°ç”Ÿæˆspeech tokenï¼Œç›´åˆ° $T$ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SFTï¼Œæµå¼&lt;/strong&gt;ï¼šåœ¨ SFT çš„æµå¼æ¨¡å¼ä¸­ï¼Œä»ä»¥ä¸‹åºåˆ—å¼€å§‹è¯­éŸ³ç”Ÿæˆï¼šâ€œ $S$ ï¼Œå‰ $N$ ä¸ªæ–‡æœ¬â€ã€‚ç„¶åï¼ŒLM å°†ç”Ÿæˆ $M$ ä¸ªspeech tokenï¼Œæ‰‹åŠ¨å¡«å……æ¥ä¸‹æ¥çš„ $N$ ä¸ªæ–‡æœ¬tokenã€‚é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰æ–‡æœ¬tokenç”¨å®Œï¼Œç„¶åæ·»åŠ  $T$ ã€‚æ³¨æ„ï¼Œ&lt;strong&gt;è¿™ç§æ¨¡å¼ä¹Ÿå¯ä»¥è¢«è¯­éŸ³åˆ°è¯­éŸ³å¤šæ¨¡æ€å¤§å‹è¯­è¨€æ¨¡å‹é‡‡ç”¨ï¼Œä»¥è·å¾—æä½çš„å»¶è¿Ÿ&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;å—æ„ŸçŸ¥æµåŒ¹é…chunk-aware-flow-matching&#34;&gt;å—æ„ŸçŸ¥æµåŒ¹é…(Chunk-aware Flow Matching)&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/e44ba5d4-5499-4e74-8d82-5f28ad0ae55d&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ CosyVoice 2 ä¸­ï¼Œä½¿ç”¨ Mel é¢‘è°±ä½œä¸ºå£°å­¦ç‰¹å¾ï¼Œå¸§ç‡ä¸º 50 Hzï¼Œé‡‡æ ·ç‡ä¸º 24000ã€‚ç”±äºspeech tokenå’Œ Mel ç‰¹å¾ä¹‹é—´çš„å¸§ç‡ä¸åŒ¹é…ï¼Œå°†speech tokenä¸Šé‡‡æ ·ä¸¤å€ä»¥åŒ¹é… Mel é¢‘è°±çš„å¸§ç‡ã€‚åœ¨ä¸Šé‡‡æ ·æ“ä½œä¹‹å‰ï¼Œæ·»åŠ äº†ä¸€ä¸ªé¢å¤–çš„å‰ç»å·ç§¯å±‚ï¼Œä¸ºåç»­çš„å› æœæ¨¡å—æä¾›æœªæ¥ä¿¡æ¯ã€‚å‰ç»å±‚é€šè¿‡ä¸€ä¸ªå³å¡«å……çš„ 1-D å·ç§¯å®ç°ï¼Œå¡«å……å¤§å°ä¸º $P$ ï¼Œæ ¸å¤§å°ä¸º $P + 1$ ã€‚ä¹‹åï¼Œè·Ÿéšå‡ ä¸ªå—æ„ŸçŸ¥å› æœ Transformer å—ï¼Œä»¥å¯¹é½speech tokençš„è¡¨ç¤ºç©ºé—´ä»¥åŒ¹é…å£°å­¦ç‰¹å¾ã€‚&lt;/p&gt;
&lt;p&gt;éšåï¼Œç›®æ ‡æ˜¯è¿›ä¸€æ­¥å°†speech tokenè§£ç ä¸ºç”±speaker embeddingå’Œå‚è€ƒè¯­éŸ³æŒ‡å®šçš„ Mel é¢‘è°±ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œä½¿ç”¨æ¡ä»¶æµåŒ¹é…ï¼ˆCFMï¼‰æ¨¡å‹æ¥é‡‡æ · Mel é¢‘è°±ï¼Œç»™å®šspeech tokenã€å‚è€ƒè¯­éŸ³å’Œspeaker embeddingä½œä¸ºæ¡ä»¶ã€‚åœ¨ CFM æ¨¡å‹ä¸­ï¼Œç›®æ ‡ Mel é¢‘è°±çš„åˆ†å¸ƒç”±ä»å…ˆéªŒåˆ†å¸ƒ $p_0(X)$ å’Œæ•°æ®åˆ†å¸ƒ $q(X)$ çš„æ¦‚ç‡å¯†åº¦è·¯å¾„æè¿°ã€‚æ¦‚ç‡å¯†åº¦è·¯å¾„å¯ä»¥ç”±ä¸€ä¸ªæ—¶é—´ä¾èµ–çš„å‘é‡åœºå®šä¹‰ã€‚ä¸ºäº†é‡‡æ ·æ•ˆç‡ï¼Œä½¿ç”¨æœ€ä¼˜ä¼ è¾“ï¼ˆOTï¼‰æµæ¥åŒ¹é…å‘é‡åœº $\omega_t$ ï¼Œç”±ä¸€ä¸ªå¸¸å¾®åˆ†æ–¹ç¨‹ï¼ˆODEï¼‰ç»™å‡ºï¼š&lt;/p&gt;
&lt;p&gt;$$
\omega_t(\phi^{\text{OT}}_t(X_0, X_1) | X_1) = X_1 - X_0
$$&lt;/p&gt;
&lt;p&gt;$$
\phi^{\text{OT}}_t(X_0, X_1) = (1 - t)X_0 + tX_1
$$&lt;/p&gt;
&lt;p&gt;$$
X_0 \sim p_0(X) = \mathcal{N}(0, I)
$$&lt;/p&gt;
&lt;p&gt;$$
X_1 \sim q(X)
$$&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªå› æœå·ç§¯ Transformer UNet è¢«ç”¨æ¥å­¦ä¹ ä¸Šè¿° ODEï¼Œä»¥ä¸Šé‡‡æ ·çš„token $\mu$ã€æ©è”½çš„ Mel é¢‘è°± $\tilde{X}_1$ ã€speaker embedding $v$ å’Œæ—¶é—´æ­¥ $t$ä½œä¸ºæ¡ä»¶ï¼š&lt;/p&gt;
&lt;p&gt;$$
\nu_t(\phi^{\text{OT}}_t(X_0, X_1) | \theta) = \text{UNet}_\theta \left( \phi^{\text{OT}}_t(X_0, X_1), t; v, {\mu}_{1:L}, \tilde{X}_1 \right)
$$&lt;/p&gt;
&lt;p&gt;åœ¨è®­ç»ƒé˜¶æ®µï¼Œæ©è”½çš„ Mel é¢‘è°±æ˜¯é€šè¿‡éšæœºæ©è”½ $X_1$ ä¸­ 70% åˆ° 100% çš„æœ€ç»ˆå¸§è·å¾—çš„ã€‚å¯¹äºæ¨ç†ï¼Œå®ƒç”±å‚è€ƒè¯­éŸ³æå–çš„ Mel é¢‘è°±æä¾›ã€‚é€šè¿‡æœ€å°åŒ–é¢„æµ‹å’ŒçœŸå® ODE ä¹‹é—´çš„ L1 æŸå¤±ï¼Œå¯ä»¥ä¼˜åŒ– UNet å‚æ•° $\theta$ ï¼š
$$
\theta = \arg\min_\theta \mathbb{E}_{p_0(X), q(X), t} \left[ \left| \omega_t(\phi^{\text{OT}}_t(X_0, X_1)) - \nu_t(\phi^{\text{OT}}_t(X_0, X_1) | \theta; \mu, \tilde{X}_1, v) \right|_1 \right]
$$&lt;/p&gt;
&lt;p&gt;åœ¨è®­ç»ƒé˜¶æ®µï¼Œæ—¶é—´æ­¥éµå¾ªå‡åŒ€åˆ†å¸ƒ $U[0, 1]$ ã€‚ç„¶è€Œï¼Œåœ¨æ¨ç†è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ä½™å¼¦è°ƒåº¦å™¨ä¸ºåˆå§‹ç”Ÿæˆé˜¶æ®µæä¾›æ›´å¤šæ­¥éª¤ï¼š
$$
t := 1 - \cos \left( \frac{1}{2} t \pi \right)
$$
æ­¤å¤–ï¼Œè¿˜åœ¨æœ‰æ¡ä»¶å’Œæ— æ¡ä»¶çš„æƒ…å†µä¸‹è®­ç»ƒæ¨¡å‹ï¼Œä»¥ä¾¿åœ¨æ¨ç†é˜¶æ®µå¯ç”¨æ— åˆ†ç±»å™¨å¼•å¯¼ï¼ˆCFGï¼‰ï¼š
$$
\tilde{\nu}_t(\phi^{\text{OT}}_t(X_0, X_1) | \theta; \Psi) = (1 + \beta) \cdot \nu_t(\phi^{\text{OT}}_t(X_0, X_1) | \theta; \Psi) - \beta \cdot \nu_t(\phi^{\text{OT}}_t(X_0, X_1) | \theta)
$$
å…¶ä¸­ï¼Œ $ \Psi$ è¡¨ç¤ºæ¡ä»¶ ${v, \mu, \tilde{X}_1}$ ã€‚æ ¹æ®å®éªŒç»“æœï¼ŒCFG å¼ºåº¦ $\beta$ å’Œæµä¼°è®¡æ¬¡æ•°ï¼ˆNFEï¼‰åˆ†åˆ«è®¾ç½®ä¸º 0.7 å’Œ 10ã€‚
å½“å‰çš„æµåŒ¹é…æ¨¡å‹é€šå¸¸åœ¨ç¦»çº¿æ¨¡å¼ä¸‹å·¥ä½œï¼Œå³åªæœ‰åœ¨æ‰€æœ‰speech tokenç”Ÿæˆåï¼ŒMel é¢‘è°±æ‰èƒ½è¢«é‡‡æ ·ï¼Œè¿™å¯¹æµå¼åˆæˆä¸å¤Ÿå‹å¥½ã€‚ä¸ºäº†å…‹æœè¿™ä¸ªé—®é¢˜ï¼Œå°†å¤šæ­¥æµä¼°è®¡è§†ä¸ºä¸€ä¸ªå †å çš„æ›´æ·±çš„ç¥ç»ç½‘ç»œï¼Œé‡å¤ UNet åæ¬¡ã€‚å› æ­¤ï¼Œé€šè¿‡ä½¿å±•å¼€çš„ç¥ç»ç½‘ç»œå› æœåŒ–ï¼Œå¯ä»¥å°†å…¶åº”ç”¨äºæµå¼åˆæˆã€‚æ„å»ºäº†å››ç§æ©ç ä»¥æ»¡è¶³ä¸åŒåº”ç”¨åœºæ™¯çš„éœ€æ±‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;éå› æœæ©ç (Non-causal Mask)&lt;/strong&gt;ï¼šç”¨äºç¦»çº¿æ¨¡å¼ï¼Œé€šè¿‡å…³æ³¨æ‰€æœ‰æ¡ä»¶å¸§æ¥å®ç°æœ€ä½³æ€§èƒ½ã€‚éå› æœæ©ç é€‚ç”¨äºå»¶è¿Ÿä¸æ•æ„Ÿçš„æƒ…å†µã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å…¨å› æœæ©ç (Full-causal Mask)&lt;/strong&gt;ï¼šä¸ºéœ€è¦æä½å»¶è¿Ÿçš„åœºæ™¯è®¾è®¡ï¼Œä»…å…³æ³¨è¿‡å»çš„å¸§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å—-M æ©ç (Chunk-M Mask)&lt;/strong&gt;ï¼šåœ¨å»¶è¿Ÿå’Œæ€§èƒ½ä¹‹é—´å–å¾—å¹³è¡¡ï¼Œå¯ä»¥åˆ©ç”¨è¿‡å»å’Œ $M$ ä¸ªæœªæ¥å¸§çš„ä¿¡æ¯ã€‚è¿™ç§æ©ç æ›´é€‚åˆäºä½å»¶è¿Ÿçš„é¦–ä¸ªå—ç”Ÿæˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å—-2M æ©ç (Chunk-2M Mask)&lt;/strong&gt;ï¼šé€šè¿‡ç‰ºç‰²æ›´å¤šçš„å»¶è¿Ÿï¼Œå®ç°æ¥è¿‘ç¦»çº¿æ¨¡å¼çš„æ€§èƒ½ï¼Œå¯ç”¨äºçº§è”ç”Ÿæˆå—ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¯¹äºæ¯ä¸ªè®­ç»ƒæ¡ˆä¾‹çš„å°æ‰¹é‡ï¼Œåœ¨ä¸Šè¿°å››ç§æ©ç ä¸­å‡åŒ€åˆ†å¸ƒåœ°éšæœºé‡‡æ ·ä¸€ä¸ªæ©ç ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¸€ä¸ªæµåŒ¹é…æ¨¡å‹å¯ä»¥å…¼å®¹ä¸åŒåœºæ™¯ï¼Œé™ä½éƒ¨ç½²å¤æ‚åº¦ã€‚æ­¤å¤–ï¼Œå—æ„ŸçŸ¥è®­ç»ƒçš„å¦ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œå…·æœ‰æ›´å¤šä¸Šä¸‹æ–‡çš„æ©ç ä½œä¸ºå…·æœ‰è¾ƒå°‘ä¸Šä¸‹æ–‡çš„æ©ç çš„æ•™å¸ˆï¼Œå—ç›Šäºéšå¼çš„è‡ªè’¸é¦æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;æµå¼æ¨¡å¼çš„å»¶è¿Ÿåˆ†ælatency-analysis-for-streaming-mode&#34;&gt;æµå¼æ¨¡å¼çš„å»¶è¿Ÿåˆ†æ(Latency Analysis for Streaming Mode)&lt;/h3&gt;
&lt;p&gt;æµå¼åˆæˆæ¨¡å‹çš„é¦–ä¸ªåŒ…å»¶è¿Ÿæ˜¯ä¸€ä¸ªé‡è¦çš„æŒ‡æ ‡ï¼Œå®ƒæ˜¾è‘—å½±å“ç”¨æˆ·ä½“éªŒï¼Œç‰¹åˆ«æ˜¯åœ¨åŸºäº LLM çš„è¯­éŸ³èŠå¤©åº”ç”¨ä¸­ï¼Œå¦‚ GPT-4oã€‚åœ¨ TTS çš„èƒŒæ™¯ä¸‹ï¼Œå¾…åˆæˆçš„æ–‡æœ¬æ˜¯é¢„å…ˆå·²çŸ¥çš„ï¼Œå»¶è¿Ÿæ¥è‡ªspeech tokenç”Ÿæˆã€Mel é¢‘è°±é‡å»ºå’Œæ³¢å½¢åˆæˆçš„æ–¹é¢ã€‚å› æ­¤ï¼ŒCosyVoice 2 çš„é¦–ä¸ªåŒ…å»¶è¿Ÿ $L_{\text{TTS}}$ å¯ä»¥é€šè¿‡ä»¥ä¸‹å…¬å¼è·å¾—ï¼š&lt;/p&gt;
&lt;p&gt;$$
L_{\text{TTS}} = M \cdot d_{\text{lm}} + M \cdot d_{\text{fm}} + M \cdot d_{\text{voc}}
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼Œ$d_{\text{lm}}$ è¡¨ç¤ºç”Ÿæˆä¸€ä¸ªspeech tokençš„è®¡ç®—æ—¶é—´ï¼Œ $d_{\text{fm}}$ è¡¨ç¤ºç”Ÿæˆä¸€ä¸ªspeech tokençš„ Mel é¢‘è°±å¸§çš„è®¡ç®—æ—¶é—´ï¼Œ $d_{\text{voc}}$ è¡¨ç¤ºåˆæˆå¯¹åº”äºä¸€ä¸ªspeech tokençš„æ³¢å½¢çš„è®¡ç®—æ—¶é—´ã€‚åœ¨åŸºäº LLM çš„è¯­éŸ³èŠå¤©ä¸­ï¼Œé¦–ä¸ªåŒ…æ‰€éœ€çš„æ–‡æœ¬é•¿åº¦ä¹Ÿåº”è€ƒè™‘åœ¨å†…ï¼Œé¦–ä¸ªåŒ…å»¶è¿Ÿ $L_{\text{Chat}}$ å˜ä¸ºï¼š
$$
L_{\text{Chat}} \leq N \cdot d_{\text{llm}} + L_{\text{TTS}}
$$
å…¶ä¸­ï¼Œ $d_{\text{llm}}$ è¡¨ç¤ºç”Ÿæˆä¸€ä¸ªæ–‡æœ¬tokençš„è®¡ç®—æ—¶é—´ã€‚æ³¨æ„ï¼Œç”±äºåœ¨ CosyVoice 2 çš„æ–‡æœ¬tokenizerä¸­å±è”½äº†å¤šå­—ç¬¦tokenï¼Œæ–‡æœ¬ LLM ä½¿ç”¨çš„æ–‡æœ¬tokenæ€»æ˜¯æ¯” CosyVoice 2 ç¼–ç æ›´é•¿çš„åŸå§‹æ–‡æœ¬ã€‚å› æ­¤ï¼Œé¦–ä¸ªåŒ…å»¶è¿Ÿ $L_{\text{Chat}}$ å¿…é¡»ä½äº $N \cdot d_{\text{llm}}$ å’Œ $L_{\text{TTS}}$ çš„æ€»å’Œã€‚&lt;/p&gt;
&lt;h3 id=&#34;æŒ‡ä»¤å¼ç”Ÿæˆ-instructed-generation&#34;&gt;æŒ‡ä»¤å¼ç”Ÿæˆ Instructed Generation&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†å¢å¼º CosyVoice 2 çš„å¯æ§æ€§ï¼Œå°†æŒ‡ä»¤æ•°æ®é›†æ•´åˆåˆ°åŸºç¡€è®­ç»ƒé›†ä¸­ã€‚æ”¶é›†äº† 1500 å°æ—¶çš„æŒ‡ä»¤è®­ç»ƒæ•°æ®ï¼ŒåŒ…æ‹¬è‡ªç„¶è¯­è¨€æŒ‡ä»¤å’Œç»†ç²’åº¦æŒ‡ä»¤ï¼Œå¦‚è¡¨ 1 æ‰€ç¤ºã€‚å¯¹äºè‡ªç„¶è¯­è¨€æŒ‡ä»¤ï¼Œåœ¨å¾…åˆæˆçš„è¾“å…¥æ–‡æœ¬å‰æ·»åŠ è‡ªç„¶è¯­è¨€æè¿°å’Œä¸€ä¸ªç‰¹æ®Šçš„ç»“æŸtokenâ€œ&amp;lt;|endofprompt|&amp;gt;â€ã€‚è¿™äº›æè¿°æ¶µç›–äº†æƒ…æ„Ÿã€è¯­é€Ÿã€è§’è‰²æ‰®æ¼”å’Œæ–¹è¨€ç­‰æ–¹é¢ã€‚å¯¹äºç»†ç²’åº¦æŒ‡ä»¤ï¼Œåœ¨æ–‡æœ¬tokenä¹‹é—´æ’å…¥å£°éŸ³çˆ†å‘ï¼Œä½¿ç”¨tokenå¦‚â€œ[laughter]â€å’Œâ€œ[breath]â€ã€‚æ­¤å¤–ï¼Œè¿˜å°†å£°éŸ³ç‰¹å¾æ ‡ç­¾åº”ç”¨äºçŸ­è¯­ï¼›ä¾‹å¦‚ï¼Œâ€œ&amp;lt;strong&amp;gt; XXX&amp;lt;/strong&amp;gt;â€è¡¨ç¤ºå¯¹æŸäº›å•è¯çš„å¼ºè°ƒï¼Œè€Œâ€œ&amp;lt;laughter&amp;gt;XXX&amp;lt;/laughter&amp;gt;â€è¡¨ç¤ºå¸¦ç€ç¬‘å£°è¯´è¯ã€‚
&lt;img src=&#34;https://github.com/user-attachments/assets/c8dae8bc-e5fb-4018-bd37-c42bc3414c06&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;å¤šè¯´è¯äººå¾®è°ƒ-multi-speaker-fine-tuning&#34;&gt;å¤šè¯´è¯äººå¾®è°ƒ Multi-Speaker Fine-tuning&lt;/h3&gt;
&lt;p&gt;åœ¨ç‰¹å®šè¯´è¯äººä¸Šå¯¹é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œå¾®è°ƒï¼ˆSFTï¼‰å¯ä»¥è¿›ä¸€æ­¥æé«˜ç”Ÿæˆè´¨é‡å’Œè¯´è¯äººç›¸ä¼¼æ€§ã€‚åœ¨æœ¬æŠ¥å‘Šä¸­ï¼Œå¼•å…¥äº†å¤šè¯´è¯äººå¾®è°ƒï¼ˆmSFTï¼‰ï¼Œåœ¨å¤šä¸ªè¯´è¯äººä¸ŠåŒæ—¶è¿›è¡Œå¾®è°ƒï¼Œè€Œä¸æ˜¯å•ä¸ªè¯´è¯äººã€‚è¿™ç§æ–¹æ³•ç¡®ä¿äº†å¤šä¸ªè¯´è¯äººä¹‹é—´å…¨é¢çš„è¯­è°ƒå’Œå‘éŸ³è¦†ç›–ï¼Œå¹¶å‡è½»äº†é¢„è®­ç»ƒæ¨¡å‹å¯èƒ½å‡ºç°çš„ç¾éš¾æ€§é—å¿˜ã€‚ä¸ºäº†é¿å…ä¸åŒè¯´è¯äººä¹‹é—´çš„éŸ³è‰²æ··æ·†ï¼Œåœ¨ç‰¹å®šè¯´è¯äººçš„è¾“å…¥æ–‡æœ¬å‰æ·»åŠ è¯´è¯äººæç¤ºæ ‡ç­¾ï¼Œå¦‚â€œSpeaker A&amp;lt;|endofprompt|&amp;gt;â€ã€‚å¦‚æœè®­ç»ƒæ ·æœ¬æœªtokenè¯´è¯äººï¼Œåˆ™ä½¿ç”¨ç‰¹æ®Šæ ‡ç­¾â€œunknown&amp;lt;|endofprompt|&amp;gt;â€ã€‚åœ¨æ•´ä¸ªå¤šè¯´è¯äººå¾®è°ƒè¿‡ç¨‹ä¸­ï¼Œå­¦ä¹ ç‡è®¾ç½®ä¸º $1 \times 10^{-5}$ ã€‚&lt;/p&gt;
&lt;h3 id=&#34;sftçš„å¼ºåŒ–å­¦ä¹ -reinforcement-learning-for-sft&#34;&gt;SFTçš„å¼ºåŒ–å­¦ä¹  Reinforcement Learning for SFT&lt;/h3&gt;
&lt;p&gt;å¼ºåŒ–å­¦ä¹ æ˜¯å¤§å‹è¯­è¨€æ¨¡å‹è®­ç»ƒä¸­å¸¸ç”¨çš„æ–¹æ³•ï¼Œå¯ä»¥ä½¿ LM è¾“å‡ºä¸äººç±»åå¥½å¯¹é½ã€‚åœ¨ CosyVoice 2 ä¸­ï¼Œä½¿ç”¨è¯´è¯äººç›¸ä¼¼æ€§ï¼ˆSSï¼‰å’Œ ASR ç³»ç»Ÿçš„è¯†åˆ«è¯é”™è¯¯ç‡ï¼ˆWERï¼‰ä½œä¸ºå¥–åŠ±å‡½æ•°ï¼Œä»¥åœ¨å¾®è°ƒé˜¶æ®µæé«˜è¯´è¯äººç›¸ä¼¼æ€§å’Œå‘éŸ³å‡†ç¡®æ€§ã€‚ä½¿ç”¨ WER å’Œ SS æ¥åŒºåˆ†é¦–é€‰æ ·æœ¬ $x_w$ å’Œè¢«æ‹’ç»çš„æ ·æœ¬ $x_l$ ï¼Œå¹¶ä½¿ç”¨ç›´æ¥åå¥½ä¼˜åŒ–ï¼ˆDPOï¼‰ä¼˜åŒ– TTS ç³»ç»Ÿï¼š
$$
L_{\text{DPO}}(\pi_\theta; \pi_{\text{ref}}) = - \log \sigma \left( \beta \log \frac{\pi_\theta(\mu_w|y)}{\pi_{\text{ref}}(\mu_w|y)} - \beta \log \frac{\pi_\theta(\mu_l|y)}{\pi_{\text{ref}}(\mu_l|y)} \right)
$$
å…¶ä¸­ï¼Œ$\mu_w$ å’Œ $\mu_l$ æ˜¯ä»é¦–é€‰å’Œè¢«æ‹’ç»çš„æ ·æœ¬ $x_w$ å’Œ $x_l$ ä¸­æå–çš„speech tokenã€‚
ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•è€—æ—¶ä¸”è®¡ç®—é‡å¤§ï¼Œå› ä¸ºå®ƒéœ€è¦é€šè¿‡ TTS ç³»ç»Ÿåå¤åˆæˆéŸ³é¢‘ä»¥è·å¾—å¯åŒºåˆ†çš„é¦–é€‰å’Œè¢«æ‹’ç»çš„æ ·æœ¬ã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªè®­ç»ƒæ­¥éª¤éœ€è¦è¿›è¡Œå››æ¬¡å‰å‘æ“ä½œã€‚ä¸ºäº†ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œå°† LM é¢„æµ‹çš„token $\mu_i \in {0, 1, \ldots, (2K + 1)^D - 1}$ æ¢å¤ä¸ºé‡åŒ–åçš„ä½ç§©è¡¨ç¤º $\bar{H}$ ï¼Œå¹¶ç›´æ¥ä½¿ç”¨speech tokenizerçš„ ASR åç«¯é‡æ–°é¢„æµ‹è¾“å…¥æ–‡æœ¬ã€‚ç„¶åï¼Œå°†é¢„æµ‹çš„å¯¹æ•°åéªŒæ¦‚ç‡è§†ä¸º ASR å¥–åŠ±å‡½æ•°ï¼Œä»¥ä¼˜åŒ–æ–‡æœ¬-è¯­éŸ³è¯­è¨€æ¨¡å‹ã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼ŒASR åç«¯å‚æ•°è¢«å†»ç»“ã€‚
$$
\bar{h}_{i,j} = \left\lfloor \frac{\mu_i}{(2K + 1)^j} \right\rfloor \mod (2K + 1)
$$&lt;/p&gt;
&lt;p&gt;$$
\hat{H} = \text{Proj}_{\text{up}}(\bar{H})
$$&lt;/p&gt;
&lt;p&gt;$$
L_{\text{ASR}} = - \log P(Y | \hat{H}; \theta_{\text{ASR}})
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼Œ $Y$ æ˜¯è¾“å…¥æ–‡æœ¬ï¼Œ $\bar{H}$ æ˜¯æ¢å¤çš„è¯­éŸ³ä½ç§©è¡¨ç¤ºã€‚ç”±äºæ ·æœ¬æ“ä½œ $u_i \sim P(\mu_i|\mu_{1:i-1}, Y; \theta_{\text{LM}})$ ä»ç„¶é˜»æ­¢ç›´æ¥ä¼˜åŒ–æ¨¡å‹ï¼Œä½¿ç”¨ Gumbel Softmax é‡‡æ ·ä½¿å…¶å¯å¾®åˆ†ï¼Œç„¶åé€šè¿‡ $L_{\text{ASR}}$ ä¼˜åŒ– $\theta_{\text{LM}}$ ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®éªŒè®¾ç½®&#34;&gt;å®éªŒè®¾ç½®&lt;/h2&gt;
&lt;h3 id=&#34;speech-tokenizerçš„è®­ç»ƒæ•°æ®&#34;&gt;Speech Tokenizerçš„è®­ç»ƒæ•°æ®&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ä¸€ä¸ª200,000å°æ—¶çš„æ•°æ®é›†æ¥è®­ç»ƒSpeech Tokenizerï¼Œå½’ä¸€åŒ–è½¬å½•ä½œä¸ºæ ‡ç­¾ã€‚è¯¦ç»†æ•°æ®ä¿¡æ¯å¦‚è¡¨2æ‰€ç¤ºã€‚è®­ç»ƒæ•°æ®æ¥è‡ªä¸‰ä¸ªä¸åŒçš„æ¥æºï¼šå¼€æºASRæ•°æ®é›†ã€å†…éƒ¨å·¥ä¸šæ•°æ®é›†å’ŒTTSç”Ÿæˆæ•°æ®é›†ã€‚å°½ç®¡åœ¨è®­ç»ƒSpeech Tokenizeræ—¶åªä½¿ç”¨äº†ä¸­æ–‡å’Œè‹±æ–‡æ•°æ®ï¼Œå¦‚è¡¨2æ‰€ç¤ºï¼Œåç»­å®éªŒè¡¨æ˜Speech Tokenizerå…·æœ‰å…¶ä»–è¯­è¨€çš„é›¶æ ·æœ¬èƒ½åŠ›ã€‚å®ƒä¹Ÿå¯ä»¥ç”¨äºæ—¥è¯­å’ŒéŸ©è¯­çš„è¯­éŸ³åˆæˆã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è¯­è¨€&lt;/th&gt;
&lt;th&gt;æ—¶é•¿ï¼ˆå°æ—¶ï¼‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ä¸­æ–‡&lt;/td&gt;
&lt;td&gt;110,884&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è‹±æ–‡&lt;/td&gt;
&lt;td&gt;99,918&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¡¨ 2ï¼šSpeech Tokenizerè®­ç»ƒæ•°æ®çš„è¯¦ç»†ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;cosyvoice-2çš„è®­ç»ƒæ•°æ®&#34;&gt;CosyVoice 2çš„è®­ç»ƒæ•°æ®&lt;/h3&gt;
&lt;p&gt;CosyVoice 2ä¸å…¶å‰èº«ç‰ˆæœ¬å…±äº«ç›¸åŒçš„è®­ç»ƒæ•°æ®ã€‚é¦–å…ˆä½¿ç”¨å†…éƒ¨è¯­éŸ³å¤„ç†å·¥å…·æ”¶é›†ä»…è¯­éŸ³æ•°æ®ã€‚éšåï¼Œåˆ†åˆ«ä½¿ç”¨&lt;a href=&#34;https://arxiv.org/abs/2206.08317&#34;&gt;2022. Paraformer&lt;/a&gt;å’Œ&lt;a href=&#34;https://arxiv.org/abs/2407.04051&#34;&gt;2024. SenseVoice&lt;/a&gt;ä¸ºä¸­æ–‡å’Œå…¶ä»–è¯­è¨€ç”Ÿæˆä¼ªæ–‡æœ¬æ ‡ç­¾ã€‚è¿˜ä½¿ç”¨å†…éƒ¨å¼ºåˆ¶å¯¹é½æ¨¡å‹è¿‡æ»¤ä½è´¨é‡æ•°æ®å¹¶å¢å¼ºæ ‡ç‚¹ç¬¦å·çš„å‡†ç¡®æ€§ã€‚æ•°æ®è¯¦ç»†ä¿¡æ¯å¦‚è¡¨3æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è¯­è¨€&lt;/th&gt;
&lt;th&gt;æ—¶é•¿ï¼ˆå°æ—¶ï¼‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ä¸­æ–‡&lt;/td&gt;
&lt;td&gt;130,000&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è‹±æ–‡&lt;/td&gt;
&lt;td&gt;30,000&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ—¥æ–‡&lt;/td&gt;
&lt;td&gt;4,600&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;éŸ©æ–‡&lt;/td&gt;
&lt;td&gt;2,200&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¡¨ 3ï¼šCosyVoice 2çš„è®­ç»ƒæ•°æ®è¯¦ç»†ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¯„ä¼°è®¾ç½®&#34;&gt;è¯„ä¼°è®¾ç½®&lt;/h3&gt;
&lt;p&gt;åœ¨ä¸¤ä¸ªæµ‹è¯•é›†ä¸Šè¯„ä¼°CosyVoice 2ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€ä¸ªæµ‹è¯•é›†æ˜¯ä»&lt;a href=&#34;https://www.openslr.org/12&#34;&gt;Librispeechè¯­æ–™åº“&lt;/a&gt;çš„test-cleané›†ä¸­æ„å»ºçš„ï¼Œè®°ä¸ºtest-cleanã€‚è¿™ä¸ªæµ‹è¯•é›†ç”¨äºè¯„ä¼°CosyVoice 2åœ¨æœ‰é™è‹±æ–‡é¢†åŸŸä¸Šçš„è¡¨ç°ã€‚ä½¿ç”¨Whisper-large V3ä½œä¸ºASRæ¨¡å‹æ¥è¯„ä¼°å†…å®¹ä¸€è‡´æ€§ã€‚å¯¹äºè¯´è¯äººç›¸ä¼¼æ€§ï¼ˆSSï¼‰ï¼Œä½¿ç”¨&lt;a href=&#34;https://arxiv.org/abs/2305.12838&#34;&gt;2023. ERes2Net&lt;/a&gt;æ¨¡å‹æå–æç¤ºå’Œç”Ÿæˆè¯è¯­çš„speaker embeddingsï¼Œå®ƒä»¬çš„åŸå§‹ä½™å¼¦ç›¸ä¼¼åº¦è¢«è§†ä¸ºè¯´è¯äººç›¸ä¼¼æ€§ã€‚&lt;a href=&#34;https://arxiv.org/abs/2010.15258&#34;&gt;2020. NMOSåˆ†æ•°&lt;/a&gt;ç”¨äºè¯„ä¼°å®¢è§‚è´¨é‡ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒä¸ªè¯„ä¼°æ˜¯åœ¨&lt;a href=&#34;https://arxiv.org/abs/2406.02430&#34;&gt;2024. Seed-TTS SEEDæµ‹è¯•é›†&lt;/a&gt;ä¸Šè¿›è¡Œçš„ï¼Œè¯¥æµ‹è¯•é›†å¹¿æ³›ç”¨äºè¯„ä¼°æœ€è¿‘çš„TTSæ¨¡å‹ï¼Œæ¶µç›–å„ç§æ–‡æœ¬é¢†åŸŸå’Œå‚è€ƒè¯­éŸ³ã€‚åœ¨è¿™ä¸ªè¯„ä¼°ä¸­ï¼Œä»&lt;a href=&#34;https://commonvoice.mozilla.org/zh-CN/datasets&#34;&gt;CommonVoiceæ•°æ®é›†&lt;/a&gt;ä¸­é€‰æ‹©äº†çº¦2,000ä¸ªä¸­æ–‡å’Œ1,000ä¸ªè‹±æ–‡æ ·æœ¬ï¼Œåˆ†åˆ«è®°ä¸ºtest-zhå’Œtest-enã€‚&lt;/li&gt;
&lt;li&gt;æ­¤å¤–ï¼Œè¿˜åŒ…æ‹¬çº¦400ä¸ªç¡¬æµ‹è¯•æ¡ˆä¾‹ï¼Œç”¨äºè¯„ä¼°TTSæ¨¡å‹åœ¨æ–‡æœ¬é‡å¤ã€ç»•å£ä»¤å’Œå…¶ä»–å…·æœ‰æŒ‘æˆ˜æ€§çš„åˆæˆæ¡ˆä¾‹ä¸Šçš„é²æ£’æ€§ï¼Œè®°ä¸ºtest-hardã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½¿ç”¨Paraformerè¯†åˆ«test-zhå’Œtest-hardçš„åˆæˆç»“æœ&lt;/strong&gt;ï¼Œ&lt;strong&gt;è€Œä½¿ç”¨Whisper-large V3è¯„ä¼°test-ençš„å†…å®¹ä¸€è‡´æ€§&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é‡‡ç”¨ä¸¤ä¸ªè¯´è¯äººéªŒè¯ï¼ˆSVï¼‰æ¨¡å‹æ¥è¯„ä¼°è¯´è¯äººç›¸ä¼¼æ€§ï¼šå¾®è½¯çš„&lt;a href=&#34;https://github.com/microsoft/unilm/tree/master/wavlm&#34;&gt;WavLM-finetuned SVæ¨¡å‹&lt;/a&gt;å’Œé˜¿é‡Œ3D-Speakerä¸­çš„&lt;a href=&#34;https://github.com/modelscope/3D-Speaker&#34;&gt;ERes2Net&lt;/a&gt;&lt;/strong&gt;ï¼Œï¼ˆåç»­ç ”ç©¶è¿˜æœ‰é‡‡ç”¨å…¶ä»–æ¨¡å‹è¿›è¡ŒSSè¯„ä¼°ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;æ—¥è¯­å’ŒéŸ©è¯­çš„åŸºå‡†æµ‹è¯•&#34;&gt;æ—¥è¯­å’ŒéŸ©è¯­çš„åŸºå‡†æµ‹è¯•&lt;/h3&gt;
&lt;p&gt;å‡†å¤‡äº†ä¸¤ä¸ªæµ‹è¯•é›†ï¼Œåˆ†åˆ«è®°ä¸ºtest-jaå’Œtest-koï¼Œç”¨äºè¯„ä¼°æ—¥è¯­å’ŒéŸ©è¯­çš„è¯­éŸ³åˆæˆã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;test-jaåŒ…å«ä»CommonVoiceæ•°æ®é›†ä¸­æå–çš„1,000ä¸ªæ ·æœ¬ï¼Œç”¨äºæµ‹é‡æ¨¡å‹åœ¨å„ç§æŒ‡æ ‡ä¸Šçš„è¡¨ç°ï¼Œå¦‚WERã€SSã€MOSã€‚å…·ä½“æ¥è¯´ï¼Œéšæœºæ‰“ä¹±å¹¶é…å¯¹äº†æ•´ä¸ªCommonVoice JA-testé›†ä½œä¸ºå‚è€ƒè¯è¯­å’Œç›®æ ‡è¯è¯­ã€‚è€ƒè™‘åˆ°JA-testé›†è¯è¯­æ–‡æœ¬é•¿åº¦çš„å¹¿æ³›èŒƒå›´ï¼Œä»8åˆ°32ä¸ªå­—ç¬¦çš„é•¿åº¦èŒƒå›´å†…éšæœºé€‰æ‹©äº†1,000å¯¹å‚è€ƒ-ç›®æ ‡è¯è¯­ä½œä¸ºçš„æœ€ç»ˆæµ‹è¯•é›†ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºtest-koï¼Œé€‰æ‹©äº†1,000ä¸ªè¯­éŸ³æ ·æœ¬ï¼ŒWERå°äº5%ï¼Œä¸”æ²¡æœ‰åˆ é™¤æˆ–æ’å…¥é”™è¯¯ï¼Œä½¿ç”¨&lt;a href=&#34;https://huggingface.co/openai/whisper-large-v3&#34;&gt;Whisper-Large V3&lt;/a&gt;ä½œä¸ºASRæ¨¡å‹ã€‚è¿™äº›æ ·æœ¬ä½œä¸ºéŸ©è¯­è¯­éŸ³åˆæˆçš„å‚è€ƒè¯è¯­ã€‚å¯¹äºè¾“å…¥æ–‡æœ¬ï¼Œä»å‰©ä½™æ•°æ®ä¸­éšæœºé€‰æ‹©äº†1,000ä¸ªæ–‡æœ¬æ ·æœ¬ã€‚å·²ç»å‘å¸ƒäº†è¿™ä¸¤ä¸ªæµ‹è¯•é›†çš„æç¤ºè¯è¯­ã€æç¤ºè½¬å½•å’Œè¾“å…¥æ–‡æœ¬çš„åˆ—è¡¨ï¼Œä»¥æ–¹ä¾¿ç»“æœå¤ç°ã€‚é€šè¿‡æä¾›è¿™ä¸ªå¼€æºæ•°æ®ï¼Œæ—¨åœ¨å»ºç«‹ä¸€ä¸ªè¯„ä¼°æ—¥è¯­å’ŒéŸ©è¯­TTSæ¨¡å‹çš„åŸºå‡†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Whisper-large V3ç”¨äºæ—¥è¯­å’ŒéŸ©è¯­çš„è¯„ä¼°ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å®éªŒç»“æœ&#34;&gt;å®éªŒç»“æœ&lt;/h2&gt;
&lt;h3 id=&#34;speech-tokenizerçš„è¯„ä¼°&#34;&gt;Speech Tokenizerçš„è¯„ä¼°&lt;/h3&gt;
&lt;p&gt;ç†æƒ³çš„Speech Tokenizeråº”æœ‰æ•ˆåˆ©ç”¨ç æœ¬ï¼Œé«˜ä¿çœŸåº¦åœ°ä¿ç•™ä¿¡æ¯ï¼Œå¹¶è¡¨ç°å‡ºè¯´è¯äººç‹¬ç«‹æ€§ã€‚ä»å››ä¸ªæ–¹é¢è¯„ä¼°å—ç›‘ç£Speech Tokenizerï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç æœ¬åˆ©ç”¨ç‡ï¼›&lt;/li&gt;
&lt;li&gt;æ•´ä¸ªç¼–ç å™¨å†…çš„ASRé”™è¯¯ç‡ï¼›&lt;/li&gt;
&lt;li&gt;ä¸åŒè¯´è¯äººçš„tokenå¯è§†åŒ–ï¼›&lt;/li&gt;
&lt;li&gt;è¯´è¯äººè¯†åˆ«è®­ç»ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¡¨4æ˜¾ç¤ºäº†ç æœ¬åˆ©ç”¨ç‡å’ŒASRé”™è¯¯ç‡ã€‚ç»“æœè¡¨æ˜ï¼ŒåŸºäºFSQçš„speech tokenizerå®Œå…¨åˆ©ç”¨äº†ç æœ¬ï¼Œå¹¶åœ¨ASRæ–¹é¢ä¿æŒäº†æ›´å¤šæœ‰æ•ˆä¿¡æ¯ï¼Œè¡¨æ˜FSQä¿ç•™äº†æ›´å¤šè¯­ä¹‰ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ–¹æ³•&lt;/th&gt;
&lt;th&gt;ç æœ¬å¤§å°&lt;/th&gt;
&lt;th&gt;ç æœ¬åˆ©ç”¨ç‡&lt;/th&gt;
&lt;th&gt;ASRé”™è¯¯ç‡ (C.V. EN)&lt;/th&gt;
&lt;th&gt;ASRé”™è¯¯ç‡ (C.V. CN)&lt;/th&gt;
&lt;th&gt;ASRé”™è¯¯ç‡ (Fluers EN)&lt;/th&gt;
&lt;th&gt;ASRé”™è¯¯ç‡ (Fluers CN)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;VQ&lt;/td&gt;
&lt;td&gt;4,096&lt;/td&gt;
&lt;td&gt;963 (23%)&lt;/td&gt;
&lt;td&gt;18.26&lt;/td&gt;
&lt;td&gt;11.56&lt;/td&gt;
&lt;td&gt;7.65&lt;/td&gt;
&lt;td&gt;5.03&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;FSQ&lt;/td&gt;
&lt;td&gt;6,561&lt;/td&gt;
&lt;td&gt;6,561 (100%)&lt;/td&gt;
&lt;td&gt;10.67&lt;/td&gt;
&lt;td&gt;7.29&lt;/td&gt;
&lt;td&gt;6.58&lt;/td&gt;
&lt;td&gt;4.43&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¡¨ 4ï¼šSensevoice-largeç¼–ç å™¨å†…VQå’ŒFSQçš„æ¯”è¾ƒã€‚C.V.è¡¨ç¤ºCommonVoiceåŸºå‡†æµ‹è¯•ã€‚&lt;/p&gt;
&lt;p&gt;è¿›ä¸€æ­¥é€šè¿‡t-SNEå¯è§†åŒ–åˆ†æFSQçš„ç‰¹æ€§ã€‚ä½œä¸ºTTSä»»åŠ¡çš„ä¸Šæ¸¸æ¨¡å‹ï¼Œ&lt;strong&gt;speech tokenizeråº”å°½é‡å‡å°‘è¯´è¯äººèº«ä»½ä¿¡æ¯ä¸è¯­éŸ³ä¿¡å·çš„çº ç¼ &lt;/strong&gt;ã€‚ä»&lt;a href=&#34;https://www.robots.ox.ac.uk/~vgg/data/voxceleb/vox1.html&#34;&gt;VoxCeleb1æ•°æ®é›†&lt;/a&gt;ä¸­é€‰æ‹©äº†æ¯åè¯´è¯äººçš„100ä¸ªè¯­éŸ³æ ·æœ¬ï¼Œå¹¶å¯è§†åŒ–äº†ç›¸åº”çš„tokenã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¦‚å›¾4(a)å’Œ(b)æ‰€ç¤ºï¼Œé‡åŒ–å‰$Encoder_1$çš„è¾“å‡ºåœ¨ä¸åŒè¯´è¯äººä¹‹é—´è¡¨ç°å‡ºä¸åŒçš„åˆ†å¸ƒã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œé‡åŒ–è¡¨ç¤ºçš„åˆ†å¸ƒå‡ ä¹æ— æ³•åŒºåˆ†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ­¤å¤–ï¼Œå›¾4(c)è¿˜è¡¨æ˜speech tokenizerå®Œå…¨åˆ©ç”¨äº†ç æœ¬ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éšåï¼Œä½¿ç”¨&lt;a href=&#34;https://github.com/s3prl/s3prl&#34;&gt;S3prlå·¥å…·åŒ…&lt;/a&gt;è¿›ä¸€æ­¥é€šè¿‡æ‰§è¡Œè¯´è¯äººè¯†åˆ«ï¼ˆSIDï¼‰ä»»åŠ¡æ¥è¯„ä¼°è¯´è¯äººçº ç¼ ã€‚ä½¿ç”¨å¸¦æœ‰FSQçš„Sensevoice-largeç¼–ç å™¨ä½œä¸ºä¸Šæ¸¸ç‰¹å¾æå–å™¨ï¼Œå¹¶ä½¿ç”¨é‡åŒ–å‰æˆ–åçš„è¡¨ç¤ºè®­ç»ƒSIDä»»åŠ¡ã€‚å›¾5æ˜¾ç¤ºäº†è®­ç»ƒæœŸé—´çš„å‡†ç¡®ç‡æ›²çº¿ã€‚å¸¦æœ‰é‡åŒ–tokençš„SIDå±‚æ²¡æœ‰æ”¶æ•›ï¼Œè¿™è¯æ˜äº†speech tokenizeråœ¨è§£è€¦è¯´è¯äººä¿¡æ¯æ–¹é¢çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/bd6e5e60-d6e6-4e55-b557-c24bebf22e58&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;p&gt;å›¾ 4ï¼šVoxceb1æ•°æ®é›†ä¸­ä¸‰åä¸åŒè¯´è¯äººçš„è¯­éŸ³è¡¨ç¤ºåœ¨é‡åŒ–å‰(a)å’Œé‡åŒ–å(b)çš„t-SNEå¯è§†åŒ–ã€‚(c)æ˜¾ç¤ºäº†è¯´è¯äººï¼ˆæ¯ä¸ªbin 500ä¸ªtokenï¼‰çš„tokenç™¾åˆ†æ¯”çš„ç æœ¬åˆ©ç”¨ç‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/0f1b5023-15a8-48db-94ca-ac04c3715f0a&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å›¾ 5ï¼šé‡åŒ–å‰æˆ–é‡åŒ–åtokençš„SIDè®­ç»ƒçš„æ”¶æ•›æ›²çº¿ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸åŸºçº¿çš„æ¯”è¾ƒç»“æœ&#34;&gt;ä¸åŸºçº¿çš„æ¯”è¾ƒç»“æœ&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆåœ¨æœ‰é™çš„è‹±æ–‡æ–‡æœ¬åŸŸä¸Šè¯„ä¼°äº†CosyVoice 2æ¨¡å‹ï¼Œå¹¶ä¸å‡ ä¸ªå¼€æºæ¨¡å‹è¿›è¡Œäº†æ¯”è¾ƒï¼Œå¦‚ChatTTSã€GPT-SoVITsã€OpenVoiceã€ParlerTTSã€EmotiVoiceå’Œå…¶å‰èº«CosyVoiceã€‚&lt;/p&gt;
&lt;p&gt;PS: å¥‡äº†ä¸ªæ€ªï¼Œä¸ºå•¥æ²¡æœ‰è¯„ä¼° &lt;a href=&#34;https://arxiv.org/abs/2411.01156&#34;&gt;fish-speech&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è¡¨5å±•ç¤ºäº†å®¢è§‚ç»“æœï¼ŒåŒ…æ‹¬å†…å®¹ä¸€è‡´æ€§ï¼ˆWERï¼‰ã€è¯­éŸ³è´¨é‡ï¼ˆNMOSï¼‰å’Œè¯´è¯äººç›¸ä¼¼æ€§ï¼ˆSSï¼‰ã€‚ä»è¡¨ä¸­å¯ä»¥çœ‹å‡ºï¼Œ&lt;strong&gt;CosyVoice 2åœ¨Librispeech test-cleané›†ä¸Šå®ç°äº†æœ€å…ˆè¿›çš„æ€§èƒ½ï¼Œè¶…è¶Šäº†æ‰€æœ‰åŸºçº¿æ¨¡å‹çš„æ‰€æœ‰è¯„ä¼°æŒ‡æ ‡ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒCosyVoice 2ç”šè‡³åœ¨å†…å®¹ä¸€è‡´æ€§ã€è¯­éŸ³è´¨é‡å’Œè¯´è¯äººç›¸ä¼¼æ€§æ–¹é¢éƒ½è¶…è¿‡äº†äººç±»è¯è¯­ï¼Œè¡¨æ˜å…¶äººç±»æ°´å¹³çš„åˆæˆè´¨é‡&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¨¡å‹&lt;/th&gt;
&lt;th&gt;WER (%)&lt;/th&gt;
&lt;th&gt;NMOS&lt;/th&gt;
&lt;th&gt;SS&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;äººç±»&lt;/td&gt;
&lt;td&gt;2.66&lt;/td&gt;
&lt;td&gt;3.84&lt;/td&gt;
&lt;td&gt;0.697&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ChatTTS&lt;/td&gt;
&lt;td&gt;6.84&lt;/td&gt;
&lt;td&gt;3.89&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GPT-SoVITs&lt;/td&gt;
&lt;td&gt;5.13&lt;/td&gt;
&lt;td&gt;3.93&lt;/td&gt;
&lt;td&gt;0.405&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;OpenVoice&lt;/td&gt;
&lt;td&gt;3.47&lt;/td&gt;
&lt;td&gt;3.87&lt;/td&gt;
&lt;td&gt;0.299&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ParlerTTS&lt;/td&gt;
&lt;td&gt;3.16&lt;/td&gt;
&lt;td&gt;3.86&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;EmotiVoice&lt;/td&gt;
&lt;td&gt;3.14&lt;/td&gt;
&lt;td&gt;3.93&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CosyVoice&lt;/td&gt;
&lt;td&gt;2.89&lt;/td&gt;
&lt;td&gt;3.93&lt;/td&gt;
&lt;td&gt;0.743&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CosyVoice 2&lt;/td&gt;
&lt;td&gt;2.47&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;3.96&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;0.745&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CosyVoice 2-S&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;2.45&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;3.90&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;0.751&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¡¨ 5ï¼šåŸºçº¿å’ŒCosyVoice 2åœ¨LibriSpeech test-cleanå­é›†ä¸Šçš„å†…å®¹ä¸€è‡´æ€§ï¼ˆWERï¼‰ã€è¯´è¯äººç›¸ä¼¼æ€§ï¼ˆSSï¼‰å’Œè¯­éŸ³è´¨é‡ï¼ˆNMOSï¼‰ç»“æœã€‚ä½¿ç”¨Whisper-Large V3ä½œä¸ºASRæ¨¡å‹ï¼Œè®¡ç®—WERå‰æ’é™¤äº†æ ‡ç‚¹ç¬¦å·ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜åœ¨å¸¸ç”¨çš„æµ‹è¯•é›†ä¸Šè¯„ä¼°äº†CosyVoice 2ï¼šSEED test-zhã€test-enå’Œtest-hardï¼Œè¿™äº›æµ‹è¯•é›†åŒ…æ‹¬æ¥è‡ªä¸åŒé¢†åŸŸçš„å¤šæ ·åŒ–è¾“å…¥æ–‡æœ¬å’Œå‚è€ƒè¯­éŸ³ã€‚è¡¨6å±•ç¤ºäº†CosyVoice 2å’ŒåŸºçº¿æ¨¡å‹çš„å®éªŒç»“æœã€‚&lt;strong&gt;åœ¨test-zhé›†ä¸Šï¼ŒCosyVoice 2åœ¨CERå’ŒSSæ–¹é¢è¶…è¶Šäº†æ‰€æœ‰å¼€æºæ¨¡å‹ï¼Œä»…æ¯”å•†ä¸šæ¨¡å‹SEED-TTSè½åä¸€ç‚¹ç‚¹&lt;/strong&gt;ã€‚&lt;strong&gt;åœ¨test-ené›†ä¸Šï¼ŒCosyVoice 2åœ¨WERå’ŒSSæ–¹é¢åˆ†åˆ«æ’åç¬¬å››å’Œç¬¬ä¸‰&lt;/strong&gt;ã€‚&lt;strong&gt;è¿™å¯èƒ½æ˜¯ç”±äºä¸­æ–‡å’Œè‹±æ–‡è®­ç»ƒæ•°æ®é‡ä¹‹é—´çš„ä¸å¹³è¡¡&lt;/strong&gt;ã€‚è®¡åˆ’åœ¨æœªæ¥çš„å·¥ä½œä¸­æ¢ç´¢æ•°æ®æ‰©å±•ï¼Œä»¥æé«˜è‹±æ–‡çš„å†…å®¹ä¸€è‡´æ€§ã€‚&lt;strong&gt;åœ¨test-hardé›†ä¸Šï¼Œç¦»çº¿CosyVoice 2æ¨¡å‹åœ¨æ‰€æœ‰æ¯”è¾ƒçš„åŸºçº¿ä¸­å®ç°äº†æœ€å…ˆè¿›çš„æ€§èƒ½ï¼Œè¡¨æ˜å…¶åœ¨å…·æœ‰æŒ‘æˆ˜æ€§çš„åˆæˆåœºæ™¯ä¸­çš„é²æ£’æ€§&lt;/strong&gt;ã€‚ä¸äººç±»ç”Ÿæˆçš„è¯­éŸ³ç›¸æ¯”ï¼ŒCosyVoice 2åœ¨å†…å®¹ä¸€è‡´æ€§å’Œè¯´è¯äººç›¸ä¼¼æ€§æ–¹é¢è¡¨ç°å‡ºå¯æ¯”çš„æ€§èƒ½ã€‚è€ƒè™‘åˆ°è¯†åˆ«é”™è¯¯ä¹Ÿå¯èƒ½æ¥è‡ªASRæ¨¡å‹ï¼Œåˆç†åœ°å¾—å‡ºç»“è®ºï¼ŒCosyVoice 2å®ç°äº†äººç±»æ°´å¹³çš„åˆæˆèƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜è¯„ä¼°äº†æµå¼æ¨¡å¼ï¼Œè®°ä¸ºè¡¨5å’Œ6ä¸­çš„â€œCosyVoice 2-Sâ€ã€‚å¯¹äºä¸¤ç§è¯„ä¼°è®¾ç½®ï¼Œ&lt;strong&gt;æµå¼æ¨¡å¼çš„æ€§èƒ½åœ¨å…¸å‹æµ‹è¯•æ¡ˆä¾‹ä¸­å‡ ä¹æ— æŸ&lt;/strong&gt;ã€‚åªæœ‰åœ¨å…·æœ‰æŒ‘æˆ˜æ€§çš„æ¡ˆä¾‹ä¸­ï¼Œå†…å®¹ä¸€è‡´æ€§æ‰æœ‰è½»å¾®ä¸‹é™ï¼Œçªå‡ºäº†ç»Ÿä¸€çš„æµå¼/éæµå¼æ¡†æ¶çš„ä¼˜åŠ¿ã€‚&lt;strong&gt;å®éªŒè¯„ä¼°å‘ç°ï¼Œä¸åŒSVæ¨¡å‹ä¸Šçš„è¯´è¯äººç›¸ä¼¼æ€§ç»“æœä¸ä¸€è‡´ã€‚è¿™å¯èƒ½è¡¨æ˜å¦‚ä½•è‡ªåŠ¨è¯„ä¼°TTSæ¨¡å‹çš„è¯´è¯äººç›¸ä¼¼æ€§æ˜¯ä¸€ä¸ªæ–°çš„ç ”ç©¶è¯¾é¢˜&lt;/strong&gt;ã€‚ç”±äºä¸åŒçš„TTSæ¨¡å‹å¯èƒ½ä½¿ç”¨ä¸åŒçš„SVæ¨¡å‹æ¥æå–è¯´è¯äººä¿¡æ¯ï¼Œä½¿ç”¨ç›¸åŒçš„SVæ¨¡å‹è¯„ä¼°è¯´è¯äººç›¸ä¼¼æ€§å¯ä»¥æ›´å‡†ç¡®åœ°è¯„ä¼°è¯´è¯äººä¿¡æ¯çš„åˆ©ç”¨ã€‚å› æ­¤ï¼Œåœ¨åç»­å®éªŒä¸­ä½¿ç”¨ERes2Net3æ¥è¯„ä¼°è¯´è¯äººç›¸ä¼¼æ€§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/4de7a183-2a9d-4fb2-9cf3-cbd461a8e6a1&#34; alt=&#34;image&#34;&gt;è¡¨ 6ï¼šCosyVoice 2å’Œæœ€è¿‘çš„TTSæ¨¡å‹åœ¨SEEDæµ‹è¯•é›†ä¸Šçš„ç»“æœã€‚â€ è¡¨ç¤ºé—­æºæ¨¡å‹ã€‚å¯¹äºè¯´è¯äººç›¸ä¼¼æ€§ï¼Œæ‹¬å·å†…çš„ç»“æœæ˜¯é€šè¿‡ERes2Netæµ‹é‡çš„ï¼Œè€Œæ‹¬å·å¤–çš„ç»“æœæ˜¯é€šè¿‡åŸºäºWavLMçš„æ¨¡å‹æµ‹é‡çš„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ¨¡å—åŒ–æ¶ˆèç ”ç©¶&#34;&gt;æ¨¡å—åŒ–æ¶ˆèç ”ç©¶&lt;/h3&gt;
&lt;p&gt;åœ¨æ–‡æœ¬-è¯­éŸ³è¯­è¨€æ¨¡å‹ä¸Šè¿›è¡Œäº†æ¨¡å—åŒ–æ¶ˆèç ”ç©¶ï¼Œä»¥è¯„ä¼°ä¿®æ”¹çš„å½±å“ï¼ŒåŒ…æ‹¬LLMåˆå§‹åŒ–ã€å»é™¤speaker embeddingå’Œä½¿ç”¨FSQã€‚&lt;/p&gt;
&lt;p&gt;è¡¨7å±•ç¤ºäº†ä»å…¶å‰èº«é€æ­¥å‘å±•åˆ°CosyVoice 2çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;+LLM init: é€šè¿‡å°†&lt;strong&gt;éšæœºåˆå§‹åŒ–çš„è¯­è¨€æ¨¡å‹æ›¿æ¢ä¸ºé¢„è®­ç»ƒçš„LLM&lt;/strong&gt;ï¼Œåœ¨test-zhå’Œtest-hardé›†ä¸Šçš„å†…å®¹ä¸€è‡´æ€§åˆ†åˆ«å®ç°äº†18.46%å’Œ15.40%çš„ç›¸å¯¹æ”¹è¿›ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;+Drop Spk Emb: &lt;strong&gt;ä»æ–‡æœ¬åˆ°è¯­éŸ³è¯­è¨€æ¨¡å‹ä¸­å»é™¤äº†speaker embedingï¼Œè¿™æœ‰åŠ©äºé˜²æ­¢ä¿¡æ¯æ³„éœ²å’Œä¸Šä¸‹æ–‡å­¦ä¹ ä¸­çš„å¹²æ‰°&lt;/strong&gt;ã€‚&lt;strong&gt;è¿™ä¸€å˜åŒ–æ˜¾è‘—å‡å°‘äº†å†…å®¹é”™è¯¯ï¼ŒåŒæ—¶ä¿æŒäº†è¯´è¯äººç›¸ä¼¼æ€§ï¼Œè¡¨æ˜å†…å®¹ä¿¡æ¯ä¸»è¦ç”±LMå»ºæ¨¡ï¼Œè€Œè¯´è¯äººä¿¡æ¯ä¸»è¦ç”±æµåŒ¹é…æ¨¡å‹æ¢å¤&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;+FSQ(CosyVoice 2): é€šè¿‡å°†VQæ›¿æ¢ä¸ºFSQï¼Œå®ç°äº†CosyVoice 2æ¨¡å‹ï¼Œæ³¨æ„åˆ°&lt;strong&gt;å†…å®¹ä¸€è‡´æ€§çš„æ˜¾è‘—æé«˜å’Œä¸å˜çš„è¯´è¯äººç›¸ä¼¼æ€§&lt;/strong&gt;ã€‚é€šè¿‡&lt;strong&gt;å……åˆ†åˆ©ç”¨ç æœ¬ï¼ŒFSQæ•è·äº†æ›´å¤šå†…å®¹ä¿¡æ¯å’Œä¸Šä¸‹æ–‡å˜åŒ–ï¼Œä»è€Œæ›´å¥½åœ°å¯¹é½æ–‡æœ¬å’Œè¯­éŸ³token&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;+Pitch Loss: æ­¤å¤–ï¼Œé€šè¿‡&lt;strong&gt;åœ¨FSQåŸºç¡€çš„Speech Tokenizerè®­ç»ƒä¸­åŠ å…¥éŸ³é«˜æŸå¤±ä½œä¸ºçº¦æŸè¿›è¡Œäº†æ¯”è¾ƒå®éªŒ&lt;/strong&gt;ã€‚å‘ç°ï¼Œè¿™ç§æ–¹æ³•&lt;strong&gt;åœ¨ä¸‹æ¸¸TTSä»»åŠ¡ä¸­è¡¨ç°å‡ºäº†æ›´å¥½çš„æ€§èƒ½&lt;/strong&gt;ï¼Œå¦‚è¡¨7çš„æœ€åä¸€è¡Œæ‰€ç¤ºã€‚åœ¨æœªæ¥çš„CosyVoiceç‰ˆæœ¬ä¸­ï¼Œè®¡åˆ’è¿›è¡Œæ›´è¯¦ç»†çš„å®éªŒå’Œåˆ†æã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¨¡å‹&lt;/th&gt;
&lt;th&gt;test-zh&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;test-en&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;test-hard&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;CER (%)&lt;/td&gt;
&lt;td&gt;SS&lt;/td&gt;
&lt;td&gt;WER (%)&lt;/td&gt;
&lt;td&gt;SS&lt;/td&gt;
&lt;td&gt;WER (%)&lt;/td&gt;
&lt;td&gt;SS&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CosyVoice&lt;/td&gt;
&lt;td&gt;3.63&lt;/td&gt;
&lt;td&gt;0.775&lt;/td&gt;
&lt;td&gt;4.29&lt;/td&gt;
&lt;td&gt;0.699&lt;/td&gt;
&lt;td&gt;11.75&lt;/td&gt;
&lt;td&gt;0.755&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;+ LLM init.&lt;/td&gt;
&lt;td&gt;2.96&lt;/td&gt;
&lt;td&gt;0.808&lt;/td&gt;
&lt;td&gt;4.57&lt;/td&gt;
&lt;td&gt;0.730&lt;/td&gt;
&lt;td&gt;9.94&lt;/td&gt;
&lt;td&gt;0.789&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;+ Drop Spk Emb.&lt;/td&gt;
&lt;td&gt;2.56&lt;/td&gt;
&lt;td&gt;0.804&lt;/td&gt;
&lt;td&gt;3.81&lt;/td&gt;
&lt;td&gt;0.740&lt;/td&gt;
&lt;td&gt;9.66&lt;/td&gt;
&lt;td&gt;0.778&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;+ FSQ (CosyVoice 2)&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;1.45&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;0.806&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;2.57&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;0.736&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;6.83&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;0.776&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;+ Pitch Loss&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;1.19&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;0.802&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;2.40&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;0.728&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;6.29&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;0.769&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¡¨ 7ï¼šæ–‡æœ¬-è¯­éŸ³è¯­è¨€æ¨¡å‹ä¿®æ”¹çš„æ¨¡å—åŒ–åˆ†æã€‚&lt;/p&gt;
&lt;p&gt;è¿˜è¿›è¡Œäº†å¦ä¸€é¡¹æ¨¡å—åŒ–åˆ†æï¼Œä»¥è¯„ä¼°æµå¼æ¨¡å—å¯¹åˆæˆæ€§èƒ½çš„å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;è¡¨8å±•ç¤ºäº†å†…å®¹ä¸€è‡´æ€§å’Œè¯´è¯äººç›¸ä¼¼æ€§çš„ç»“æœã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘ç°&lt;strong&gt;æµå¼LMå¯¹test-zhå’Œtest-ené›†ä¸Šçš„å…¸å‹æ¡ˆä¾‹å½±å“æœ€å°&lt;/strong&gt;ï¼Œè¡¨æ˜ç»Ÿä¸€è®­ç»ƒæ¡†æ¶çš„æœ‰æ•ˆæ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æµå¼LMçš„ä¸»è¦å½±å“åœ¨test-hardé›†ä¸Šçš„å…·æœ‰æŒ‘æˆ˜æ€§çš„æ¡ˆä¾‹ä¸­è§‚å¯Ÿåˆ°ï¼Œå¯èƒ½æ˜¯å› ä¸ºæµå¼æ¨¡å¼ä¸­ä¸Šä¸‹æ–‡ä¿¡æ¯çš„ä¸¢å¤±&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æœ‰è¶£çš„æ˜¯ï¼Œ&lt;strong&gt;ä¸ç¦»çº¿æ¨¡å¼ç›¸æ¯”ï¼Œæµå¼æµåŒ¹é…æ¨¡å‹çš„è¯´è¯äººç›¸ä¼¼æ€§ç•¥é«˜&lt;/strong&gt;ã€‚è¿™å¯èƒ½æ˜¯ç”±äºæµå¼æ¨¡å¼ä¸­åˆå§‹å—çš„æç¤ºåˆ°ç”Ÿæˆæ¯”ä¾‹è¾ƒé«˜ï¼Œè€Œç¦»çº¿æ¨¡å¼ä¸­çš„æç¤ºåˆ°ç”Ÿæˆæ¯”ä¾‹å¯èƒ½éå¸¸ä½ï¼ŒåŒ…å«è®¸å¤šå¡«å……tokenã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸æµå¼LMç›¸æ¯”ï¼Œæµå¼æµåŒ¹é…æ¨¡å‹å¯¹å†…å®¹ä¸€è‡´æ€§çš„è´Ÿé¢å½±å“è¦å°å¾—å¤šï¼Œè¿™è¦å½’åŠŸäºCosyVoice 2ä¸­çš„è¯­ä¹‰-å£°å­¦è§£è€¦å»ºæ¨¡&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¨¡å‹&lt;/th&gt;
&lt;th&gt;LM&lt;/th&gt;
&lt;th&gt;FM&lt;/th&gt;
&lt;th&gt;test-zh&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;test-en&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;test-hard&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;CER (%)&lt;/td&gt;
&lt;td&gt;SS&lt;/td&gt;
&lt;td&gt;WER (%)&lt;/td&gt;
&lt;td&gt;SS&lt;/td&gt;
&lt;td&gt;CER (%)&lt;/td&gt;
&lt;td&gt;SS&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;M1&lt;/td&gt;
&lt;td&gt;ç¦»çº¿&lt;/td&gt;
&lt;td&gt;ç¦»çº¿&lt;/td&gt;
&lt;td&gt;1.45&lt;/td&gt;
&lt;td&gt;0.806&lt;/td&gt;
&lt;td&gt;2.57&lt;/td&gt;
&lt;td&gt;0.736&lt;/td&gt;
&lt;td&gt;6.83&lt;/td&gt;
&lt;td&gt;0.776&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;M2&lt;/td&gt;
&lt;td&gt;ç¦»çº¿&lt;/td&gt;
&lt;td&gt;æµå¼&lt;/td&gt;
&lt;td&gt;1.46&lt;/td&gt;
&lt;td&gt;0.811&lt;/td&gt;
&lt;td&gt;2.60&lt;/td&gt;
&lt;td&gt;0.743&lt;/td&gt;
&lt;td&gt;7.12&lt;/td&gt;
&lt;td&gt;0.788&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;M3&lt;/td&gt;
&lt;td&gt;æµå¼&lt;/td&gt;
&lt;td&gt;ç¦»çº¿&lt;/td&gt;
&lt;td&gt;1.38&lt;/td&gt;
&lt;td&gt;0.806&lt;/td&gt;
&lt;td&gt;2.51&lt;/td&gt;
&lt;td&gt;0.737&lt;/td&gt;
&lt;td&gt;7.88&lt;/td&gt;
&lt;td&gt;0.773&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;M4&lt;/td&gt;
&lt;td&gt;æµå¼&lt;/td&gt;
&lt;td&gt;æµå¼&lt;/td&gt;
&lt;td&gt;1.45&lt;/td&gt;
&lt;td&gt;0.812&lt;/td&gt;
&lt;td&gt;2.38&lt;/td&gt;
&lt;td&gt;0.743&lt;/td&gt;
&lt;td&gt;8.08&lt;/td&gt;
&lt;td&gt;0.785&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¡¨ 8ï¼šCosyVoice 2ä¸­æµå¼æ¨¡å—å½±å“çš„æ¨¡å—åŒ–åˆ†æã€‚æµå¼æ¨¡å—çš„å—å¤§å°è®¾ç½®ä¸º15ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ—¥è¯­å’ŒéŸ©è¯­åŸºå‡†æµ‹è¯•çš„ç»“æœ&#34;&gt;æ—¥è¯­å’ŒéŸ©è¯­åŸºå‡†æµ‹è¯•çš„ç»“æœ&lt;/h3&gt;
&lt;p&gt;é™¤äº†ä¸­æ–‡å’Œè‹±æ–‡ï¼ŒCosyVoice 2è¿˜&lt;strong&gt;æ”¯æŒæ—¥è¯­å’ŒéŸ©è¯­&lt;/strong&gt;ã€‚åœ¨æ„å»ºçš„æ—¥è¯­å’ŒéŸ©è¯­æµ‹è¯•é›†ä¸Š&lt;strong&gt;è¯„ä¼°äº†å†…å®¹ä¸€è‡´æ€§ã€è¯´è¯äººç›¸ä¼¼æ€§å’Œè¯­éŸ³è´¨é‡&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚è¡¨9æ‰€ç¤ºï¼ŒCosyVoice 2åœ¨éŸ©è¯­ä¸Šçš„è¡¨ç°æ˜¾è‘—ä¼˜äºæ—¥è¯­ï¼Œè¿™ä¸»è¦æ˜¯ç”±äºæ—¥è¯­å’Œä¸­æ–‡å­—ç¬¦é›†çš„é‡å ï¼Œå¯¼è‡´åœ¨æ—¥è¯­ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ä¸­æ–‡å‘éŸ³ã€‚åœ¨æœªæ¥çš„å·¥ä½œä¸­ï¼Œè®¡åˆ’æ¢ç´¢å¢å¼ºå¤šè¯­è¨€åˆæˆçš„è¯­è¨€ä¸Šä¸‹æ–‡çš„æ–¹æ³•ã€‚ç”±äºéŸ©è¯­ä¸å…¶ä»–è¯­è¨€æ²¡æœ‰å­—ç¬¦é‡å ï¼Œå…¶è¯­éŸ³åˆæˆè¡¨ç°æ›´å¥½ã€‚å¦ä¸€ä¸ªé—®é¢˜æ˜¯æ•°æ®ä¸å¹³è¡¡ã€‚ç›¸ä¿¡ï¼Œå¢åŠ è®­ç»ƒæ•°æ®é‡å¯ä»¥è¿›ä¸€æ­¥æé«˜æ—¥è¯­å’ŒéŸ©è¯­çš„åˆæˆæ€§èƒ½ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¨¡å‹&lt;/th&gt;
&lt;th&gt;test-ja&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;test-ko&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;CER (%)&lt;/td&gt;
&lt;td&gt;SS&lt;/td&gt;
&lt;td&gt;NMOS&lt;/td&gt;
&lt;td&gt;CER (%)&lt;/td&gt;
&lt;td&gt;SS&lt;/td&gt;
&lt;td&gt;NMOS&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CosyVoice 2&lt;/td&gt;
&lt;td&gt;18.79&lt;/td&gt;
&lt;td&gt;0.630&lt;/td&gt;
&lt;td&gt;3.42&lt;/td&gt;
&lt;td&gt;7.98&lt;/td&gt;
&lt;td&gt;0.707&lt;/td&gt;
&lt;td&gt;3.73&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CosyVoice 2-S&lt;/td&gt;
&lt;td&gt;21.41&lt;/td&gt;
&lt;td&gt;0.629&lt;/td&gt;
&lt;td&gt;3.35&lt;/td&gt;
&lt;td&gt;9.06&lt;/td&gt;
&lt;td&gt;0.714&lt;/td&gt;
&lt;td&gt;3.60&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¡¨ 9ï¼šCosyVoice 2åŠå…¶æµå¼å¯¹åº”æ¨¡å‹åœ¨æ—¥è¯­test-jaå’ŒéŸ©è¯­test-koæµ‹è¯•é›†ä¸Šçš„å†…å®¹ä¸€è‡´æ€§ï¼ˆCERï¼‰ã€è¯´è¯äººç›¸ä¼¼æ€§ï¼ˆSSï¼‰å’Œè¯­éŸ³è´¨é‡ï¼ˆNMOSï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æŒ‡ä»¤å¼ç”Ÿæˆçš„ç»“æœ&#34;&gt;æŒ‡ä»¤å¼ç”Ÿæˆçš„ç»“æœ&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†è¯„ä¼°æŒ‡ä»¤å¼ç”Ÿæˆçš„æ€§èƒ½ï¼Œåˆ›å»ºäº†ä¸€ä¸ªåŒ…å«290ä¸ªæ ·æœ¬çš„ä¸­æ–‡æµ‹è¯•é›†ã€‚è¯¥æµ‹è¯•é›†åŒ…æ‹¬29ç§æŒ‡ä»¤ï¼Œå¦‚è¡¨1æ‰€ç¤ºï¼Œæ¯ç§æŒ‡ä»¤æœ‰10ä¸ªä¸åŒçš„è¾“å…¥æ–‡æœ¬ã€‚ä½¿ç”¨äº”åè¯´è¯äººçš„äº”ä¸ªéŸ³é¢‘æç¤ºå’Œè¯´è¯äººåµŒå…¥ä½œä¸ºæµåŒ¹é…æ¨¡å‹çš„æ¡ä»¶ã€‚æµ‹è¯•æ˜¯åœ¨ç¦»çº¿æ¨¡å¼ä¸‹è¿›è¡Œçš„ã€‚å®¢è§‚åœ°è¯„ä¼°äº†å†…å®¹ä¸€è‡´æ€§ï¼ˆCERï¼‰ã€è¯´è¯äººç›¸ä¼¼æ€§ï¼ˆSSï¼‰å’Œè¯­éŸ³è´¨é‡ï¼ˆNMOSï¼‰ã€‚&lt;strong&gt;ä¸»è§‚ä¸Šï¼Œä½¿ç”¨æŒ‡ä»¤çš„å¹³å‡æ„è§å¾—åˆ†ï¼ˆMOS-Iï¼‰è¯„ä¼°æŒ‡ä»¤çš„å‡†ç¡®æ€§å’Œè‡ªç„¶åº¦ï¼ŒèŒƒå›´ä»1åˆ°5&lt;/strong&gt;ã€‚æ¯ä¸ªæ ·æœ¬ç”±10åæ¯è¯­ä¸ºä¸­æ–‡çš„è¯´è¯äººè¯„ä¼°ï¼Œè¯„åˆ†ä»¥0.5çš„å¢é‡ç»™å‡ºã€‚è¯„ä¼°æ ‡å‡†ä¾§é‡äºè¯­éŸ³æ˜¯å¦éµå¾ªæ‰€æœ‰æŒ‡å®šçš„æŒ‡ä»¤ï¼Œå¦‚æƒ…æ„Ÿè¡¨è¾¾ã€è¯­é€Ÿè°ƒæ•´ã€æ–¹è¨€ä½¿ç”¨å’Œè§’è‰²æ‰®æ¼”ã€‚ç»†ç²’åº¦æ§åˆ¶ï¼ŒåŒ…æ‹¬æ’å…¥ç¬‘å£°ã€å¸¦ç¬‘è¯´è¯ã€å‘¼å¸æ§åˆ¶å’Œå¼ºè°ƒï¼Œè¯„ä¼°å…¶è‡ªç„¶åº¦å’Œå‡†ç¡®æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚è¡¨10æ‰€ç¤ºï¼ŒCosyVoice 2åœ¨å†…å®¹ä¸€è‡´æ€§ï¼ˆCERï¼‰ã€è¯´è¯äººç›¸ä¼¼æ€§ï¼ˆSSï¼‰å’ŒæŒ‡ä»¤æ§åˆ¶çš„å‡†ç¡®æ€§å’Œè‡ªç„¶åº¦ï¼ˆMOS-Iï¼‰æ–¹é¢è¡¨ç°å‡ºè‰²ï¼ŒåŒæ—¶ä¿æŒäº†ä¸CosyVoice-Instructç›¸å½“çš„è¯­éŸ³è´¨é‡ã€‚å½“ä»CosyVoice 2ä¸­ç§»é™¤è¾“å…¥æŒ‡ä»¤æ—¶ï¼ŒMOS-Iæ˜¾è‘—ä¸‹é™ï¼›ç„¶è€Œï¼Œå†…å®¹ä¸€è‡´æ€§ï¼ˆCERï¼‰ã€è¯´è¯äººç›¸ä¼¼æ€§ï¼ˆSSï¼‰å’Œè¯­éŸ³è´¨é‡ï¼ˆNMOSï¼‰æœ‰æ‰€æé«˜ã€‚è¿™è¡¨æ˜æŒ‡ä»¤å¯æ§æ€§å¾ˆéš¾ä»å†…å®¹æ–‡æœ¬ä¸­éšå¼åœ°å‡ºç°ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¨¡å‹&lt;/th&gt;
&lt;th&gt;CER (%)&lt;/th&gt;
&lt;th&gt;SS&lt;/th&gt;
&lt;th&gt;NMOS&lt;/th&gt;
&lt;th&gt;MOS-I&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;CosyVoice-Instruct&lt;/td&gt;
&lt;td&gt;1.72&lt;/td&gt;
&lt;td&gt;0.797&lt;/td&gt;
&lt;td&gt;3.94&lt;/td&gt;
&lt;td&gt;3.09&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CosyVoice 2&lt;/td&gt;
&lt;td&gt;1.52&lt;/td&gt;
&lt;td&gt;0.804&lt;/td&gt;
&lt;td&gt;3.94&lt;/td&gt;
&lt;td&gt;4.06&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CosyVoice 2 w/o Instruction&lt;/td&gt;
&lt;td&gt;0.97&lt;/td&gt;
&lt;td&gt;0.817&lt;/td&gt;
&lt;td&gt;4.02&lt;/td&gt;
&lt;td&gt;2.28&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¡¨ 10ï¼šåœ¨å†…éƒ¨ä¸­æ–‡æµ‹è¯•é›†ä¸Šå¯¹CosyVoice-Instructã€CosyVoice 2å’Œæ²¡æœ‰æŒ‡ä»¤è¾“å…¥çš„CosyVoice 2è¿›è¡Œå†…å®¹ä¸€è‡´æ€§ï¼ˆCERï¼‰ã€è¯´è¯äººç›¸ä¼¼æ€§ï¼ˆSSï¼‰ã€è¯­éŸ³è´¨é‡ï¼ˆNMOSï¼‰å’ŒMOS-Iï¼ˆæŒ‡ä»¤ï¼Œè¯„ä¼°æŒ‡ä»¤çš„å‡†ç¡®æ€§å’Œè‡ªç„¶åº¦ï¼‰çš„è¯„ä¼°ç»“æœã€‚ä½¿ç”¨Paraformeræ¨¡å‹ä½œä¸ºASRç³»ç»Ÿï¼Œè®¡ç®—CERæ—¶æ’é™¤äº†æ ‡ç‚¹ç¬¦å·ã€‚ç”±äºParaformeræ¨¡å‹æ— æ³•è¯†åˆ«ä¸­æ–‡æ–¹è¨€è¯­éŸ³ï¼Œå› æ­¤åœ¨è®¡ç®—CERæ—¶æœªåŒ…æ‹¬æ–¹è¨€æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;PSï¼šè¿™é‡Œçš„ &amp;ldquo;w/o&amp;rdquo; æ˜¯ &amp;ldquo;without&amp;rdquo; çš„ç¼©å†™ï¼Œè¡¨ç¤ºâ€œæ²¡æœ‰â€æˆ–â€œä¸ä½¿ç”¨â€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¯´è¯äººå¾®è°ƒæ¨¡å‹çš„ç»“æœ&#34;&gt;è¯´è¯äººå¾®è°ƒæ¨¡å‹çš„ç»“æœ&lt;/h3&gt;
&lt;p&gt;åœ¨å¾®è°ƒé˜¶æ®µï¼Œå¯¹åŒä¸€è¯´è¯äººçš„è¯´è¯äººåµŒå…¥è¿›è¡Œæ— ç›‘ç£èšç±»ï¼Œä»¥ç¡®ä¿è¯´è¯äººéŸ³è‰²çš„ç¨³å®šæ€§ã€‚å·²ç»è¯æ˜ï¼Œç›®æ ‡è¯´è¯äººåªè¦æœ‰400ä¸ªéŸ³é¢‘è®°å½•å°±å¯ä»¥å®ç°ç›¸å½“å¥½çš„è¯­éŸ³åˆæˆæ€§èƒ½ï¼Œä¸åŒè¯´è¯äººä¹‹é—´çš„å®¢è§‚æŒ‡æ ‡å˜åŒ–å¾ˆå°ï¼Œå¦‚å›¾6æ‰€ç¤ºã€‚å®éªŒè¡¨æ˜ï¼Œå¤§å¤šæ•°è¯´è¯äººéƒ½å¯ä»¥ç»§æ‰¿é›¶æ ·æœ¬TTSæ¨¡å‹çš„å¼ºå¤§ä¸Šä¸‹æ–‡ç†è§£å’Œæ„ŸçŸ¥èƒ½åŠ›ï¼Œä»è€Œè‡ªç„¶åœ°è¡¨è¾¾å„ç§æƒ…ç»ªå’Œæƒ…æ„Ÿï¼Œä»¥å“åº”è¾“å…¥æ–‡æœ¬ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/235f1711-2201-423d-8978-53fd5805b2f8&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;p&gt;å›¾ 6ï¼šCosyVoice 2 SFTæ¨¡å‹åœ¨SEEDè¯„ä¼°è®¾ç½®ä¸‹çš„ç»“æœã€‚CERç”¨äºtest-zhå’Œtest-hardï¼Œè€ŒWERç”¨äºtest-enã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨å¼ºåŒ–å­¦ä¹ çš„lmå¾®è°ƒ&#34;&gt;ä½¿ç”¨å¼ºåŒ–å­¦ä¹ çš„LMå¾®è°ƒ&lt;/h3&gt;
&lt;p&gt;å°½ç®¡SFTå¯ä»¥æé«˜å¤§å¤šæ•°è¯´è¯äººçš„æ€§èƒ½ï¼Œä½†Spk Eçš„ç»“æœä»ç„¶æ¯”åŸºç¡€æ¨¡å‹å·®ï¼Œå°¤å…¶æ˜¯åœ¨è‹±æ–‡æ–¹é¢ã€‚å› ä¸ºSpk Eçš„è¯­éŸ³æ›´å¤æ‚ï¼Œè¯­é€Ÿæ›´å¿«ã€‚æ­¤å¤–ï¼ŒSpk Eåªæœ‰ä¸­æ–‡å½•éŸ³ã€‚å› æ­¤ï¼Œå¯¹Spk Eåº”ç”¨äº†å¼ºåŒ–å­¦ä¹ ä»¥è¿›ä¸€æ­¥æ”¹è¿›ã€‚&lt;strong&gt;å¯¹äºDPOï¼Œé€šè¿‡SFTæ¨¡å‹åˆæˆäº†10,000ä¸ªæ ·æœ¬å¯¹ï¼Œé€šè¿‡ASRå’ŒSSå¥–åŠ±æ”¹å˜LMçš„åå¥½åå·®ã€‚è¿˜ä½¿ç”¨å¯å¾®åˆ†çš„ASRå¥–åŠ±æ¥ä¼˜åŒ–LMå‚æ•°&lt;/strong&gt;ã€‚ç»è¿‡RLåï¼Œåœ¨Spk Eçš„æµ‹è¯•é›†ä¸Šè¯„ä¼°äº†æ¨¡å‹çš„å†…å®¹ä¸€è‡´æ€§ï¼ˆWERï¼‰ã€è¯´è¯äººç›¸ä¼¼æ€§ï¼ˆSSï¼‰å’Œè¯­éŸ³è´¨é‡ï¼ˆNMOSï¼‰ï¼Œå¹¶è¿›ä¸€æ­¥åœ¨SeedTTSæµ‹è¯•é›†ä¸Šè¯„ä¼°äº†WERï¼Œä»¥æ¢ç´¢æ¨¡å‹æ˜¯å¦èƒ½å¤Ÿå¯¹åŸŸå¤–æˆ–è·¨è¯­è¨€è¾“å…¥æ–‡æœ¬ä¿æŒé²æ£’æ€§ã€‚ç»“æœå¦‚è¡¨11æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;ä¸é¢„è®­ç»ƒçš„åŸºç¡€æ¨¡å‹ç›¸æ¯”ï¼ŒSFTæ¨¡å‹æ˜¾ç¤ºå‡ºæ›´é«˜çš„è¯´è¯äººç›¸ä¼¼æ€§å’Œè¯­éŸ³è´¨é‡ï¼Œç„¶è€Œï¼ŒWERå¯èƒ½æ¯”åŸºç¡€æ¨¡å‹æ›´å·®ã€‚å‘ç°åŸºç¡€æ¨¡å‹åˆæˆçš„éŸ³é¢‘æ€»æ˜¯æ¯”SFTå’ŒçœŸå®éŸ³é¢‘æ›´æ…¢ï¼Œè¿™å¯¹ASRç³»ç»Ÿæ›´å‹å¥½ã€‚å¯¹äºç›®æ ‡è¯´è¯äººæ•°æ®é›†ï¼Œåå¥½åå·®å’Œå¯å¾®åˆ†å¥–åŠ±éƒ½å¯ä»¥å‡å°‘WERï¼Œå¯¹å…¶ä»–ä¸¤ä¸ªæŒ‡æ ‡å‡ ä¹æ²¡æœ‰æœ‰å®³å½±å“ã€‚ä½†å¯¹äºSEEDæµ‹è¯•é›†ï¼ŒåŸºäºDPOçš„å¼ºåŒ–å­¦ä¹ åªå¯¹ä¸­æ–‡å’Œè‹±æ–‡å­é›†æœ‰ç›Šï¼Œè€Œç¡¬æ ·æœ¬ä¼šæ›´å·®ã€‚åŸå› å¯èƒ½æ˜¯ç¡¬æ ·æœ¬åŒ…å«è®¸å¤šé‡å¤çš„å•è¯æˆ–çŸ­è¯­ï¼Œå®ƒä»¬å¯èƒ½åœ¨DPOè®­ç»ƒä¸­è¢«è§†ä¸ºè¢«æ‹’ç»çš„æ ·æœ¬ã€‚ç„¶è€Œï¼Œå¯å¾®åˆ†ASRå¥–åŠ±ä¸ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå®ƒå¯ä»¥ç›´æ¥é€šè¿‡ASRåéªŒæ¦‚ç‡ä¼˜åŒ–TTSç³»ç»Ÿã€‚è¿™æ„å‘³ç€&lt;strong&gt;å¯å¾®åˆ†ASRå¥–åŠ±åœ¨åŸŸå¤–æƒ…å†µä¸‹å…·æœ‰æ›´å¥½çš„æ³›åŒ–èƒ½åŠ›&lt;/strong&gt;ã€‚æœ€åï¼Œå¯ä»¥å°†å®ƒä»¬ç»“åˆèµ·æ¥ä»¥è¿›ä¸€æ­¥æ”¹è¿›ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¨¡å‹&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;å†…éƒ¨ç›®æ ‡è¯´è¯äºº&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;SEEDæµ‹è¯• (%)&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;WER (%)&lt;/td&gt;
&lt;td&gt;NMOS&lt;/td&gt;
&lt;td&gt;SS&lt;/td&gt;
&lt;td&gt;zh&lt;/td&gt;
&lt;td&gt;en&lt;/td&gt;
&lt;td&gt;hard&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;çœŸå®å€¼&lt;/td&gt;
&lt;td&gt;6.00&lt;/td&gt;
&lt;td&gt;3.87&lt;/td&gt;
&lt;td&gt;0.697&lt;/td&gt;
&lt;td&gt;1.26&lt;/td&gt;
&lt;td&gt;2.14&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CosyVoice 2&lt;/td&gt;
&lt;td&gt;5.34&lt;/td&gt;
&lt;td&gt;3.91&lt;/td&gt;
&lt;td&gt;0.721&lt;/td&gt;
&lt;td&gt;1.45&lt;/td&gt;
&lt;td&gt;2.57&lt;/td&gt;
&lt;td&gt;6.83&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CosyVoice 2-SFT&lt;/td&gt;
&lt;td&gt;7.15&lt;/td&gt;
&lt;td&gt;3.96&lt;/td&gt;
&lt;td&gt;0.795&lt;/td&gt;
&lt;td&gt;1.50&lt;/td&gt;
&lt;td&gt;4.26&lt;/td&gt;
&lt;td&gt;7.90&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;+ $L_{ASR}$&lt;/td&gt;
&lt;td&gt;6.79&lt;/td&gt;
&lt;td&gt;3.96&lt;/td&gt;
&lt;td&gt;0.795&lt;/td&gt;
&lt;td&gt;1.29&lt;/td&gt;
&lt;td&gt;3.53&lt;/td&gt;
&lt;td&gt;7.30&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;+ $L_{DPO}$&lt;/td&gt;
&lt;td&gt;6.83&lt;/td&gt;
&lt;td&gt;3.96&lt;/td&gt;
&lt;td&gt;0.792&lt;/td&gt;
&lt;td&gt;1.43&lt;/td&gt;
&lt;td&gt;4.02&lt;/td&gt;
&lt;td&gt;8.31&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;+ $L_{ASR}$+ $L_{DPO}$&lt;/td&gt;
&lt;td&gt;6.64&lt;/td&gt;
&lt;td&gt;3.97&lt;/td&gt;
&lt;td&gt;0.796&lt;/td&gt;
&lt;td&gt;1.25&lt;/td&gt;
&lt;td&gt;3.17&lt;/td&gt;
&lt;td&gt;6.66&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¡¨ 11ï¼š Spk E ä¸Šå¼ºåŒ–å­¦ä¹ æ¨¡å‹çš„å†…å®¹ä¸€è‡´æ€§ (WER)ã€è¯´è¯è€…ç›¸ä¼¼åº¦ (SS) å’Œè¯­éŸ³è´¨é‡ (NMOS) æ¯”è¾ƒã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h2&gt;
&lt;p&gt;åœ¨CosyVoiceçš„åŸºç¡€ä¸Šï¼Œæœ¬æŠ¥å‘Šä»‹ç»äº†CosyVoice 2ï¼Œè¿™æ˜¯ä¸€ä¸ªæ”¹è¿›çš„æµå¼è¯­éŸ³åˆæˆæ¨¡å‹ï¼Œåˆ©ç”¨å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰ã€‚é€šè¿‡åœ¨ä¸€ä¸ªæ¡†æ¶å†…ç»Ÿä¸€æµå¼å’Œéæµå¼åˆæˆï¼ŒCosyVoice 2å®ç°äº†äººç±»æ°´å¹³çš„è‡ªç„¶åº¦ã€æœ€å°çš„å“åº”å»¶è¿Ÿï¼Œä»¥åŠåœ¨æµå¼æ¨¡å¼ä¸‹å‡ ä¹æ— æŸçš„åˆæˆè´¨é‡ã€‚å…³é”®åˆ›æ–°åŒ…æ‹¬&lt;strong&gt;æœ‰é™æ ‡é‡é‡åŒ–ï¼ˆFSQï¼‰ä»¥å……åˆ†åˆ©ç”¨ç æœ¬&lt;/strong&gt;ã€&lt;strong&gt;ç®€åŒ–æ–‡æœ¬-è¯­éŸ³è¯­è¨€æ¨¡å‹æ¶æ„ä»¥æ•´åˆé¢„è®­ç»ƒçš„æ–‡æœ¬LLMs&lt;/strong&gt;ï¼Œä»¥åŠ&lt;strong&gt;å¼€å‘å—æ„ŸçŸ¥å› æœæµåŒ¹é…æ¨¡å‹ä»¥æ”¯æŒå¤šæ ·åŒ–çš„åˆæˆåœºæ™¯&lt;/strong&gt;ã€‚æ­¤å¤–ï¼Œ&lt;strong&gt;æŒ‡ä»¤å¼TTSèƒ½åŠ›çš„æå‡å…è®¸çµæ´»ä¸”ç”ŸåŠ¨çš„è¯­éŸ³ç”Ÿæˆï¼Œèƒ½å¤Ÿç²¾ç»†æ§åˆ¶æƒ…æ„Ÿã€å£éŸ³ã€è§’è‰²é£æ ¼å’Œå£°éŸ³çˆ†å‘&lt;/strong&gt;ã€‚é€šè¿‡ç³»ç»Ÿçš„ä¿®æ”¹å’Œä¼˜åŒ–ï¼ŒCosyVoice 2ä¸ä»…æä¾›äº†å“è¶Šçš„åˆæˆè´¨é‡ï¼Œè¿˜æ”¾å®½äº†éƒ¨ç½²è¦æ±‚ï¼Œä½¿å…¶é€‚ç”¨äºæµå¼å’Œéæµå¼åº”ç”¨ã€‚è®ºæ–‡å›¢é˜Ÿè®¤ä¸ºCosyVoice 2åœ¨å¯æ‰©å±•ã€é«˜è´¨é‡å’Œäº¤äº’å¼æ–‡æœ¬åˆ°è¯­éŸ³åˆæˆæ–¹é¢æ˜¯ä¸€ä¸ªé‡è¦çš„è¿›æ­¥ã€‚&lt;/p&gt;
&lt;p&gt;PS: è®ºæ–‡ä¸­æœªæåˆ°å®é™…éƒ¨ç½²æƒ…å†µï¼Œçº¿ä¸Šåˆ†å¸ƒå¼æ¨ç†æœåŠ¡(infer serve)çš„æŒ‡æ ‡è¯„ä¼°ï¼›æä¾›å®é™…ç”Ÿäº§æœåŠ¡çš„æ—¶å€™ï¼Œéƒ¨ç½²æœåŠ¡å’Œä¼˜åŒ–ä¸æ¨¡å‹ç»“æ„å¯†åˆ‡ç›¸å…³ï¼ŒCosyVoice2ä¸­ç®€åŒ–æ–‡æœ¬-è¯­éŸ³è¯­è¨€æ¨¡å‹æ¶æ„ä»¥æ•´åˆé¢„è®­ç»ƒçš„æ–‡æœ¬LLMsï¼Œ è™½ç„¶è¾“å…¥çš„tokenå’Œæ–‡æœ¬LLMsç¨æœ‰ä¸åŒï¼Œä½†æ˜¯æ¨ç†ä¼˜åŒ–å·¥ä½œå¯ä»¥å¤ç”¨ï¼›è€Œä¸”è¿˜å¯ä»¥å¤ç”¨LLMçš„scalingå·¥ä½œæ¥è¿›è¡Œæ•´åˆæ‰©å±•ã€‚&lt;strong&gt;CosyVoice 2ä¸­çš„è¯­ä¹‰-å£°å­¦è§£è€¦å»ºæ¨¡&lt;/strong&gt;ï¼Œä¸¤è€…åˆ†åˆ«æ”¯æŒæµå¼å’Œéæµå¼è¾“å‡ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;é™åˆ¶&#34;&gt;é™åˆ¶&lt;/h2&gt;
&lt;p&gt;CosyVoice 2å­˜åœ¨ä¸€äº›éœ€è¦è§£å†³çš„é™åˆ¶ã€‚é¦–å…ˆï¼Œå®ƒåªæ”¯æŒæœ‰é™æ•°é‡çš„è¯­è¨€ã€‚å¯¹äºå­—ç¬¦é›†é‡å çš„è¯­è¨€ï¼Œåˆæˆæ€§èƒ½å¯èƒ½ä¼šä¸‹é™ï¼Œè¿™ä¸ºæœªæ¥çš„ç ”ç©¶æå‡ºäº†ä¸€ä¸ªå¼€æ”¾æ€§æŒ‘æˆ˜ã€‚å…¶æ¬¡ï¼ŒCosyVoice 2æ— æ³•é€šè¿‡æ–‡æœ¬æŒ‡ä»¤æ§åˆ¶éŸ³è‰²ç­‰å£°å­¦ç‰¹å¾ï¼Œè¿™å¯èƒ½æ˜¯è§’è‰²æ‰®æ¼”åº”ç”¨ä¸­ä¸€ä¸ªæœ‰è¶£çš„æ¢ç´¢é¢†åŸŸã€‚æ­¤å¤–ï¼ŒCosyVoiceåœ¨æ‰§è¡Œå”±æ­Œä»»åŠ¡æ—¶è¡¨ç°ä¸ä½³ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é™„å½•&#34;&gt;é™„å½•ï¼š&lt;/h2&gt;
&lt;h3 id=&#34;paralanguage-informationå‰¯è¯­è¨€ä¿¡æ¯&#34;&gt;Paralanguage informationï¼ˆå‰¯è¯­è¨€ä¿¡æ¯ï¼‰&lt;/h3&gt;
&lt;p&gt;Paralanguage informationï¼ˆå‰¯è¯­è¨€ä¿¡æ¯ï¼‰æ˜¯æŒ‡åœ¨å£è¯­äº¤æµä¸­ï¼Œé™¤äº†è¯­è¨€å†…å®¹æœ¬èº«ä¹‹å¤–çš„å…¶ä»–å£°éŸ³ç‰¹å¾å’Œè¡¨è¾¾æ–¹å¼ã€‚è¿™äº›ä¿¡æ¯è™½ç„¶ä¸ç›´æ¥æ¶‰åŠè¯­è¨€çš„è¯æ±‡æˆ–è¯­æ³•ç»“æ„ï¼Œä½†å¯¹ç†è§£å’Œä¼ è¾¾è¯´è¯äººçš„æ„å›¾ã€æƒ…æ„Ÿå’Œæ€åº¦ç­‰æ–¹é¢èµ·ç€é‡è¦ä½œç”¨ã€‚å‰¯è¯­è¨€ä¿¡æ¯åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š&lt;/p&gt;
&lt;h4 id=&#34;1-è¯­è°ƒintonation&#34;&gt;1. è¯­è°ƒï¼ˆIntonationï¼‰&lt;/h4&gt;
&lt;p&gt;è¯­è°ƒæ˜¯æŒ‡è¯´è¯æ—¶å£°éŸ³çš„é«˜ä½å˜åŒ–ã€‚ä¸åŒçš„è¯­è°ƒå¯ä»¥ä¼ è¾¾ä¸åŒçš„æƒ…æ„Ÿå’Œæ„å›¾ã€‚ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‡è°ƒ&lt;/strong&gt;ï¼šé€šå¸¸ç”¨äºæé—®ï¼Œè¡¨ç¤ºç–‘é—®æˆ–ä¸ç¡®å®šã€‚ä¾‹å¦‚ï¼Œâ€œä½ ä»Šå¤©å»å—ï¼Ÿâ€ï¼ˆå‡è°ƒï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é™è°ƒ&lt;/strong&gt;ï¼šé€šå¸¸ç”¨äºé™ˆè¿°å¥ï¼Œè¡¨ç¤ºè‚¯å®šæˆ–ç»“æŸã€‚ä¾‹å¦‚ï¼Œâ€œä½ ä»Šå¤©å»ã€‚â€ï¼ˆé™è°ƒï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;2-è¯­é€Ÿspeech-rate&#34;&gt;2. è¯­é€Ÿï¼ˆSpeech Rateï¼‰&lt;/h4&gt;
&lt;p&gt;è¯­é€Ÿæ˜¯æŒ‡è¯´è¯çš„å¿«æ…¢ã€‚ä¸åŒçš„è¯­é€Ÿå¯ä»¥ä¼ è¾¾ä¸åŒçš„æƒ…æ„Ÿå’Œ urgencyï¼ˆç´§è¿«æ„Ÿï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¿«é€Ÿ&lt;/strong&gt;ï¼šé€šå¸¸è¡¨ç¤ºå…´å¥‹ã€ç´§å¼ æˆ–æ€¥åˆ‡ã€‚ä¾‹å¦‚ï¼Œå¿«é€Ÿè¯´è¯å¯èƒ½è¡¨æ˜è¯´è¯äººå¾ˆå…´å¥‹æˆ–æœ‰ç´§æ€¥äº‹æƒ…è¦ä¼ è¾¾ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ…¢é€Ÿ&lt;/strong&gt;ï¼šé€šå¸¸è¡¨ç¤ºæ²‰æ€ã€æ‚²ä¼¤æˆ–å¼ºè°ƒã€‚ä¾‹å¦‚ï¼Œæ…¢é€Ÿè¯´è¯å¯èƒ½è¡¨æ˜è¯´è¯äººåœ¨æ€è€ƒæˆ–å¼ºè°ƒæŸä¸ªé‡è¦ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;3-éŸ³é‡volume&#34;&gt;3. éŸ³é‡ï¼ˆVolumeï¼‰&lt;/h4&gt;
&lt;p&gt;éŸ³é‡æ˜¯æŒ‡è¯´è¯çš„å“åº¦ã€‚ä¸åŒçš„éŸ³é‡å¯ä»¥ä¼ è¾¾ä¸åŒçš„æƒ…æ„Ÿå’Œæ€åº¦ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¤§å£°&lt;/strong&gt;ï¼šé€šå¸¸è¡¨ç¤ºæ„¤æ€’ã€å…´å¥‹æˆ–å¼ºè°ƒã€‚ä¾‹å¦‚ï¼Œå¤§å£°è¯´è¯å¯èƒ½è¡¨æ˜è¯´è¯äººå¾ˆæ„¤æ€’æˆ–åœ¨å¼ºè°ƒæŸä¸ªé‡è¦ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å°å£°&lt;/strong&gt;ï¼šé€šå¸¸è¡¨ç¤ºå®³ç¾ã€å®³æ€•æˆ–ä¿å¯†ã€‚ä¾‹å¦‚ï¼Œå°å£°è¯´è¯å¯èƒ½è¡¨æ˜è¯´è¯äººå¾ˆå®³ç¾æˆ–åœ¨åˆ†äº«ç§˜å¯†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;4-åœé¡¿pauses&#34;&gt;4. åœé¡¿ï¼ˆPausesï¼‰&lt;/h4&gt;
&lt;p&gt;åœé¡¿æ˜¯æŒ‡è¯´è¯ä¸­çš„çŸ­æš‚æ²‰é»˜ã€‚åœé¡¿å¯ä»¥ç”¨äºå¼ºè°ƒã€æ€è€ƒæˆ–æƒ…æ„Ÿè¡¨è¾¾ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;çŸ­æš‚åœé¡¿&lt;/strong&gt;ï¼šé€šå¸¸ç”¨äºå¼ºè°ƒæŸä¸ªè¯æˆ–çŸ­è¯­ã€‚ä¾‹å¦‚ï¼Œâ€œæˆ‘â€”â€”çœŸçš„â€”â€”ä¸çŸ¥é“ã€‚â€ï¼ˆçŸ­æš‚åœé¡¿ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¾ƒé•¿åœé¡¿&lt;/strong&gt;ï¼šé€šå¸¸ç”¨äºæ€è€ƒæˆ–æƒ…æ„Ÿè¡¨è¾¾ã€‚ä¾‹å¦‚ï¼Œâ€œæˆ‘â€¦â€¦æˆ‘ä¸çŸ¥é“ã€‚â€ï¼ˆè¾ƒé•¿åœé¡¿ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;5-é‡éŸ³stress&#34;&gt;5. é‡éŸ³ï¼ˆStressï¼‰&lt;/h4&gt;
&lt;p&gt;é‡éŸ³æ˜¯æŒ‡åœ¨å•è¯æˆ–çŸ­è¯­ä¸­æŸä¸ªéŸ³èŠ‚çš„å¼ºè°ƒã€‚ä¸åŒçš„é‡éŸ³å¯ä»¥æ”¹å˜å•è¯çš„æ„æ€æˆ–å¼ºè°ƒæŸä¸ªéƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å•è¯é‡éŸ³&lt;/strong&gt;ï¼šä¾‹å¦‚ï¼Œâ€œrecordâ€ï¼ˆåŠ¨è¯ï¼‰å’Œâ€œrecordâ€ï¼ˆåè¯ï¼‰çš„é‡éŸ³ä½ç½®ä¸åŒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;çŸ­è¯­é‡éŸ³&lt;/strong&gt;ï¼šä¾‹å¦‚ï¼Œâ€œæˆ‘çœŸçš„å¾ˆå–œæ¬¢è¿™ä¸ªç¤¼ç‰©ã€‚â€ï¼ˆé‡éŸ³åœ¨â€œçœŸçš„â€ä¸Šï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;6-å¡«å……è¯fillers&#34;&gt;6. å¡«å……è¯ï¼ˆFillersï¼‰&lt;/h4&gt;
&lt;p&gt;å¡«å……è¯æ˜¯æŒ‡åœ¨è¯´è¯ä¸­ç”¨äºå¡«å……ç©ºç™½æˆ–æ€è€ƒçš„è¯ã€‚è¿™äº›è¯å¯ä»¥ä¼ è¾¾è¯´è¯äººçš„æ€è€ƒè¿‡ç¨‹æˆ–æƒ…æ„ŸçŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å¸¸è§çš„å¡«å……è¯&lt;/strong&gt;ï¼šä¾‹å¦‚ï¼Œâ€œå—¯â€ã€â€œå•Šâ€ã€â€œè¿™ä¸ªâ€ã€â€œé‚£ä¸ªâ€ç­‰ã€‚è¿™äº›è¯å¯ä»¥è¡¨æ˜è¯´è¯äººåœ¨æ€è€ƒæˆ–çŠ¹è±«ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;7-å£°éŸ³è´¨é‡voice-quality&#34;&gt;7. å£°éŸ³è´¨é‡ï¼ˆVoice Qualityï¼‰&lt;/h4&gt;
&lt;p&gt;å£°éŸ³è´¨é‡æ˜¯æŒ‡å£°éŸ³çš„ç‰©ç†ç‰¹å¾ï¼Œå¦‚æ²™å“‘ã€å°–é”ã€æŸ”å’Œç­‰ã€‚ä¸åŒçš„å£°éŸ³è´¨é‡å¯ä»¥ä¼ è¾¾ä¸åŒçš„æƒ…æ„Ÿå’Œå¥åº·çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ²™å“‘&lt;/strong&gt;ï¼šå¯èƒ½è¡¨æ˜è¯´è¯äººæ„Ÿå†’æˆ–æƒ…ç»ªä½è½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å°–é”&lt;/strong&gt;ï¼šå¯èƒ½è¡¨æ˜è¯´è¯äººå¾ˆç´§å¼ æˆ–å…´å¥‹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æŸ”å’Œ&lt;/strong&gt;ï¼šå¯èƒ½è¡¨æ˜è¯´è¯äººå¾ˆæ¸©æŸ”æˆ–å…³å¿ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;8-éŸ³è‰²timbre&#34;&gt;8. éŸ³è‰²ï¼ˆTimbreï¼‰&lt;/h4&gt;
&lt;p&gt;éŸ³è‰²æ˜¯æŒ‡å£°éŸ³çš„ç‹¬ç‰¹è´¨åœ°æˆ–è‰²å½©ã€‚ä¸åŒçš„éŸ³è‰²å¯ä»¥ä¼ è¾¾ä¸åŒçš„æƒ…æ„Ÿå’Œä¸ªæ€§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ¸©æš–çš„éŸ³è‰²&lt;/strong&gt;ï¼šå¯èƒ½è¡¨æ˜è¯´è¯äººå¾ˆå‹å¥½å’Œäº²åˆ‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†·æ·¡çš„éŸ³è‰²&lt;/strong&gt;ï¼šå¯èƒ½è¡¨æ˜è¯´è¯äººå¾ˆä¸¥è‚ƒæˆ–ç–è¿œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h4&gt;
&lt;p&gt;å‰¯è¯­è¨€ä¿¡æ¯åœ¨å£è¯­äº¤æµä¸­èµ·ç€é‡è¦ä½œç”¨ï¼Œå®ƒå¯ä»¥å¸®åŠ©å¬è€…æ›´å¥½åœ°ç†è§£è¯´è¯äººçš„æ„å›¾ã€æƒ…æ„Ÿå’Œæ€åº¦ã€‚é€šè¿‡è¯­è°ƒã€è¯­é€Ÿã€éŸ³é‡ã€åœé¡¿ã€é‡éŸ³ã€å¡«å……è¯ã€å£°éŸ³è´¨é‡å’ŒéŸ³è‰²ç­‰å‰¯è¯­è¨€ç‰¹å¾ï¼Œè¯´è¯äººå¯ä»¥æ›´æœ‰æ•ˆåœ°ä¼ è¾¾ä¿¡æ¯ï¼Œå¢å¼ºäº¤æµçš„è‡ªç„¶åº¦å’Œç”ŸåŠ¨æ€§ã€‚åœ¨è¯­éŸ³åˆæˆå’Œè¯­éŸ³è¯†åˆ«ç³»ç»Ÿä¸­ï¼Œè€ƒè™‘å‰¯è¯­è¨€ä¿¡æ¯å¯ä»¥æ˜¾è‘—æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;t-sneå¯è§†åŒ–&#34;&gt;t-SNEå¯è§†åŒ–&lt;/h3&gt;
&lt;h4 id=&#34;å®šä¹‰&#34;&gt;å®šä¹‰&lt;/h4&gt;
&lt;p&gt;t-SNEï¼ˆt-distributed Stochastic Neighbor Embeddingï¼‰æ˜¯ä¸€ç§ç”¨äºé«˜ç»´æ•°æ®å¯è§†åŒ–çš„é™ç»´ç®—æ³•ã€‚å®ƒèƒ½å¤Ÿå°†é«˜ç»´æ•°æ®æ˜ å°„åˆ°äºŒç»´æˆ–ä¸‰ç»´ç©ºé—´ä¸­ï¼Œä»¥ä¾¿äººä»¬èƒ½å¤Ÿç›´è§‚åœ°è§‚å¯Ÿæ•°æ®çš„åˆ†å¸ƒæƒ…å†µå’Œå†…åœ¨ç»“æ„ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å·¥ä½œåŸç†&#34;&gt;å·¥ä½œåŸç†&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç›¸ä¼¼åº¦è®¡ç®—&lt;/strong&gt;ï¼šåœ¨é«˜ç»´ç©ºé—´ä¸­ï¼Œè®¡ç®—æ•°æ®ç‚¹ä¹‹é—´çš„ç›¸ä¼¼åº¦ã€‚å¯¹äºæ•°æ®ç‚¹ $x_i$ å’Œ $x_j$ï¼Œå…¶ç›¸ä¼¼åº¦ $p_{j|i}$ è¡¨ç¤ºåœ¨ä»¥ $x_i$ ä¸ºä¸­å¿ƒçš„é«˜æ–¯åˆ†å¸ƒä¸‹ï¼Œ$x_j$ å‡ºç°çš„æ¦‚ç‡ã€‚è®¡ç®—å…¬å¼ä¸ºï¼š
$$
p_{j|i} = \frac{\exp(-|x_i - x_j|^2 / 2\sigma_i^2)}{\sum_{k \neq i} \exp(-|x_i - x_k|^2 / 2\sigma_i^2)}
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼Œ$sigma_i$æ˜¯é«˜æ–¯åˆ†å¸ƒçš„æ ‡å‡†å·®ï¼Œé€šè¿‡äºŒåˆ†æŸ¥æ‰¾æ³•ç¡®å®šï¼Œä½¿å¾—æ¯ä¸ªæ•°æ®ç‚¹çš„å›°æƒ‘åº¦ï¼ˆPerplexityï¼‰è¾¾åˆ°é¢„è®¾å€¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ˜ å°„åˆ°ä½ç»´ç©ºé—´&lt;/strong&gt;ï¼šåœ¨ä½ç»´ç©ºé—´ä¸­ï¼Œä¸ºæ¯ä¸ªæ•°æ®ç‚¹ $y_i$ å’Œ $y_j$ è®¡ç®—ç›¸ä¼¼åº¦ $q_{ij}$ï¼Œé‡‡ç”¨ t åˆ†å¸ƒæ¥è®¡ç®—ï¼Œå…¬å¼ä¸ºï¼š
$$
q_{ij} = \frac{(1 + |y_i - y_j|^2)^{-1}}{\sum_{k \neq l} (1 + |y_k - y_l|^2)^{-1}}
$$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜åŒ–æ˜ å°„&lt;/strong&gt;ï¼šé€šè¿‡æœ€å°åŒ–é«˜ç»´ç©ºé—´å’Œä½ç»´ç©ºé—´ç›¸ä¼¼åº¦çš„å·®å¼‚æ¥ä¼˜åŒ–æ˜ å°„ã€‚ä½¿ç”¨KLæ•£åº¦ï¼ˆKullback-Leibler Divergenceï¼‰ä½œä¸ºæŸå¤±å‡½æ•°ï¼Œé€šè¿‡æ¢¯åº¦ä¸‹é™æ³•ä¸æ–­è°ƒæ•´ä½ç»´ç©ºé—´ä¸­çš„æ•°æ®ç‚¹ä½ç½®ï¼Œä½¿å¾— (q_{ij}) å°½å¯èƒ½æ¥è¿‘ (p_{ij})ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;ä¼˜ç‚¹&#34;&gt;ä¼˜ç‚¹&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;èƒ½å¤Ÿå¾ˆå¥½åœ°ä¿æŒæ•°æ®çš„å±€éƒ¨ç»“æ„&lt;/strong&gt;ï¼št-SNEåœ¨æ˜ å°„è¿‡ç¨‹ä¸­ï¼Œæ³¨é‡ä¿æŒæ•°æ®ç‚¹ä¹‹é—´çš„å±€éƒ¨é‚»è¿‘å…³ç³»ï¼Œä½¿å¾—ç›¸ä¼¼çš„æ•°æ®ç‚¹åœ¨ä½ç»´ç©ºé—´ä¸­ä¹Ÿèƒ½èšé›†åœ¨ä¸€èµ·ï¼Œä¾¿äºè§‚å¯Ÿæ•°æ®çš„ç°‡ç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯¹é«˜ç»´æ•°æ®çš„å¯è§†åŒ–æ•ˆæœè¾ƒå¥½&lt;/strong&gt;ï¼šç›¸æ¯”å…¶ä»–é™ç»´æ–¹æ³•ï¼Œå¦‚PCAï¼Œt-SNEåœ¨å¤„ç†é«˜ç»´æ•°æ®æ—¶ï¼Œèƒ½å¤Ÿæ›´æ¸…æ™°åœ°å±•ç¤ºæ•°æ®çš„åˆ†å¸ƒæƒ…å†µï¼Œæ­ç¤ºå‡ºæ•°æ®ä¸­éšè—çš„æ¨¡å¼å’Œç»“æ„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;ç¼ºç‚¹&#34;&gt;ç¼ºç‚¹&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è®¡ç®—å¤æ‚åº¦è¾ƒé«˜&lt;/strong&gt;ï¼šåœ¨è®¡ç®—æ•°æ®ç‚¹ä¹‹é—´çš„ç›¸ä¼¼åº¦ä»¥åŠä¼˜åŒ–æ˜ å°„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è¿›è¡Œå¤§é‡çš„è®¡ç®—ï¼Œå°¤å…¶æ˜¯å¯¹äºå¤§è§„æ¨¡æ•°æ®é›†ï¼Œè®¡ç®—æˆæœ¬è¾ƒé«˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“æœå…·æœ‰ä¸€å®šçš„éšæœºæ€§&lt;/strong&gt;ï¼šç”±äºt-SNEçš„ä¼˜åŒ–è¿‡ç¨‹æ¶‰åŠåˆ°éšæœºåˆå§‹åŒ–ï¼Œæ¯æ¬¡è¿è¡Œå¯èƒ½ä¼šå¾—åˆ°ç•¥æœ‰ä¸åŒçš„ç»“æœï¼Œè¿™ç»™ç»“æœçš„è§£é‡Šå’Œå¯¹æ¯”å¸¦æ¥äº†ä¸€å®šçš„å›°éš¾ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éš¾ä»¥å¤„ç†å¤§è§„æ¨¡æ•°æ®&lt;/strong&gt;ï¼šç”±äºè®¡ç®—å¤æ‚åº¦å’Œå†…å­˜æ¶ˆè€—çš„é™åˆ¶ï¼Œt-SNEåœ¨å¤„ç†å¤§è§„æ¨¡æ•°æ®é›†æ—¶å¯èƒ½ä¼šé‡åˆ°æ€§èƒ½ç“¶é¢ˆï¼Œéœ€è¦å€ŸåŠ©ä¸€äº›ä¼˜åŒ–æ–¹æ³•æˆ–è¿‘ä¼¼ç®—æ³•æ¥æé«˜æ•ˆç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;åº”ç”¨åœºæ™¯&#34;&gt;åº”ç”¨åœºæ™¯&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å›¾åƒæ•°æ®å¯è§†åŒ–&lt;/strong&gt;ï¼šåœ¨å›¾åƒè¯†åˆ«ã€å›¾åƒåˆ†ç±»ç­‰é¢†åŸŸï¼Œå¯ä»¥å°†å›¾åƒç‰¹å¾é€šè¿‡t-SNEæ˜ å°„åˆ°äºŒç»´æˆ–ä¸‰ç»´ç©ºé—´ä¸­ï¼Œè§‚å¯Ÿä¸åŒç±»åˆ«å›¾åƒçš„åˆ†å¸ƒæƒ…å†µï¼Œäº†è§£æ¨¡å‹çš„åˆ†ç±»æ•ˆæœã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–‡æœ¬æ•°æ®å¯è§†åŒ–&lt;/strong&gt;ï¼šå¯¹äºæ–‡æœ¬æ•°æ®çš„è¯å‘é‡æˆ–æ–‡æ¡£å‘é‡ï¼Œåˆ©ç”¨t-SNEè¿›è¡Œå¯è§†åŒ–ï¼Œèƒ½å¤Ÿç›´è§‚åœ°å±•ç¤ºè¯è¯­æˆ–æ–‡æ¡£ä¹‹é—´çš„è¯­ä¹‰ç›¸ä¼¼æ€§ï¼Œå‘ç°æ–‡æœ¬æ•°æ®ä¸­çš„ä¸»é¢˜å’Œèšç±»ç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿç‰©ä¿¡æ¯å­¦æ•°æ®å¯è§†åŒ–&lt;/strong&gt;ï¼šåœ¨åŸºå› è¡¨è¾¾æ•°æ®ã€è›‹ç™½è´¨ç»“æ„æ•°æ®ç­‰ç”Ÿç‰©ä¿¡æ¯å­¦é¢†åŸŸï¼Œt-SNEå¯ä»¥å¸®åŠ©ç ”ç©¶äººå‘˜è§‚å¯Ÿæ•°æ®çš„åˆ†å¸ƒç‰¹å¾ï¼Œå‘ç°æ½œåœ¨çš„ç”Ÿç‰©è§„å¾‹å’Œæ¨¡å¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h3 id=&#34;è¯´è¯äººçº ç¼ speaker-entanglement&#34;&gt;è¯´è¯äººçº ç¼ ï¼ˆSpeaker Entanglementï¼‰&lt;/h3&gt;
&lt;p&gt;è¯´è¯äººçº ç¼ ï¼ˆSpeaker Entanglementï¼‰æ˜¯æŒ‡åœ¨è¯­éŸ³å¤„ç†å’Œè¯­éŸ³åˆæˆä¸­ï¼Œè¯­éŸ³ä¿¡å·ä¸­åŒ…å«çš„è¯´è¯äººèº«ä»½ä¿¡æ¯ä¸å…¶ä»–è¯­éŸ³ç‰¹å¾ï¼ˆå¦‚è¯­ä¹‰ã€æƒ…æ„Ÿã€è¯­è°ƒç­‰ï¼‰ç›¸äº’æ··åˆï¼Œéš¾ä»¥åˆ†ç¦»çš„ç°è±¡ã€‚è¿™ç§çº ç¼ ä¼šä½¿å¾—æ¨¡å‹åœ¨å¤„ç†è¯­éŸ³æ—¶ï¼Œéš¾ä»¥ç‹¬ç«‹åœ°æ§åˆ¶å’Œè°ƒæ•´è¯´è¯äººçš„ç‰¹å¾ï¼Œä»è€Œå½±å“è¯­éŸ³åˆæˆçš„çµæ´»æ€§å’Œè‡ªç„¶åº¦ã€‚&lt;/p&gt;
&lt;h4 id=&#34;è¯´è¯äººçº ç¼ çš„å…·ä½“è¡¨ç°&#34;&gt;è¯´è¯äººçº ç¼ çš„å…·ä½“è¡¨ç°&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è¯­ä¹‰ä¸è¯´è¯äººèº«ä»½çš„æ··åˆ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;åœ¨è¯­éŸ³åˆæˆä¸­ï¼Œç†æƒ³çš„æ¨¡å‹åº”è¯¥èƒ½å¤Ÿå°†è¯­ä¹‰ä¿¡æ¯ï¼ˆå³æ–‡æœ¬å†…å®¹ï¼‰ä¸è¯´è¯äººèº«ä»½ä¿¡æ¯ï¼ˆå¦‚éŸ³è‰²ã€è¯­è°ƒç­‰ï¼‰åˆ†å¼€å¤„ç†ã€‚ç„¶è€Œï¼Œå¦‚æœå­˜åœ¨è¯´è¯äººçº ç¼ ï¼Œæ¨¡å‹åœ¨ç”Ÿæˆè¯­éŸ³æ—¶å¯èƒ½ä¼šå°†ç‰¹å®šè¯´è¯äººçš„è¯­ä¹‰ç‰¹å¾ä¸èº«ä»½ç‰¹å¾æ··åˆï¼Œå¯¼è‡´ç”Ÿæˆçš„è¯­éŸ³åœ¨ä¸åŒè¯´è¯äººä¹‹é—´ç¼ºä¹ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æƒ…æ„Ÿä¸è¯´è¯äººèº«ä»½çš„æ··åˆ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æƒ…æ„Ÿè¡¨è¾¾æ˜¯è¯­éŸ³åˆæˆä¸­çš„ä¸€ä¸ªé‡è¦æ–¹é¢ã€‚å¦‚æœå­˜åœ¨è¯´è¯äººçº ç¼ ï¼Œæ¨¡å‹å¯èƒ½ä¼šå°†ç‰¹å®šè¯´è¯äººçš„æƒ…æ„Ÿç‰¹å¾ä¸èº«ä»½ç‰¹å¾æ··åˆï¼Œä½¿å¾—ç”Ÿæˆçš„è¯­éŸ³åœ¨è¡¨è¾¾ä¸åŒæƒ…æ„Ÿæ—¶ï¼Œä»ç„¶å¸¦æœ‰ç‰¹å®šè¯´è¯äººçš„ç‰¹å¾ï¼Œè€Œä¸æ˜¯æ ¹æ®è¾“å…¥çš„æƒ…æ„ŸæŒ‡ä»¤è¿›è¡Œè°ƒæ•´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯­è°ƒä¸è¯´è¯äººèº«ä»½çš„æ··åˆ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è¯­è°ƒæ˜¯è¯­éŸ³ä¸­çš„ä¸€ä¸ªé‡è¦ç‰¹å¾ï¼Œç”¨äºè¡¨è¾¾ç–‘é—®ã€é™ˆè¿°ã€å¼ºè°ƒç­‰ã€‚å¦‚æœå­˜åœ¨è¯´è¯äººçº ç¼ ï¼Œæ¨¡å‹åœ¨ç”Ÿæˆä¸åŒè¯­è°ƒçš„è¯­éŸ³æ—¶ï¼Œå¯èƒ½ä¼šå—åˆ°ç‰¹å®šè¯´è¯äººè¯­è°ƒç‰¹å¾çš„å½±å“ï¼Œå¯¼è‡´ç”Ÿæˆçš„è¯­éŸ³åœ¨è¯­è°ƒä¸Šä¸å¤Ÿè‡ªç„¶å’Œçµæ´»ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;è¯´è¯äººçº ç¼ çš„å½±å“&#34;&gt;è¯´è¯äººçº ç¼ çš„å½±å“&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;é™ä½è¯­éŸ³åˆæˆçš„çµæ´»æ€§&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è¯´è¯äººçº ç¼ ä¼šé™åˆ¶æ¨¡å‹åœ¨ç”Ÿæˆè¯­éŸ³æ—¶å¯¹è¯´è¯äººç‰¹å¾çš„ç‹¬ç«‹æ§åˆ¶èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ¨¡å‹æ— æ³•å°†è¯­ä¹‰å’Œè¯´è¯äººèº«ä»½åˆ†å¼€å¤„ç†ï¼Œå°±éš¾ä»¥å®ç°å¤šè¯´è¯äººçš„è¯­éŸ³åˆæˆï¼Œæˆ–è€…åœ¨ä¸åŒè¯´è¯äººä¹‹é—´åˆ‡æ¢æ—¶ä¼šå‡ºç°ä¸è‡ªç„¶çš„è¿‡æ¸¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å½±å“è¯­éŸ³åˆæˆçš„è‡ªç„¶åº¦&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è¯´è¯äººçº ç¼ ä¼šå¯¼è‡´ç”Ÿæˆçš„è¯­éŸ³åœ¨è¯­ä¹‰ã€æƒ…æ„Ÿå’Œè¯­è°ƒç­‰æ–¹é¢ä¸å¤Ÿè‡ªç„¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ¨¡å‹åœ¨ç”Ÿæˆå¸¦æœ‰ç‰¹å®šæƒ…æ„Ÿçš„è¯­éŸ³æ—¶ï¼Œä»ç„¶å—åˆ°ç‰¹å®šè¯´è¯äººçš„æƒ…æ„Ÿç‰¹å¾çš„å½±å“ï¼Œç”Ÿæˆçš„è¯­éŸ³å¯èƒ½ä¼šæ˜¾å¾—ç”Ÿç¡¬å’Œä¸è‡ªç„¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¢åŠ æ¨¡å‹è®­ç»ƒçš„å¤æ‚æ€§&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è¯´è¯äººçº ç¼ ä¼šå¢åŠ æ¨¡å‹è®­ç»ƒçš„éš¾åº¦ï¼Œå› ä¸ºæ¨¡å‹éœ€è¦åŒæ—¶å­¦ä¹ å’Œå¤„ç†å¤šç§æ··åˆçš„ç‰¹å¾ã€‚è¿™å¯èƒ½å¯¼è‡´æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å‡ºç°è¿‡æ‹Ÿåˆæˆ–æ¬ æ‹Ÿåˆçš„é—®é¢˜ï¼Œå½±å“æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;è§£å†³è¯´è¯äººçº ç¼ çš„æ–¹æ³•&#34;&gt;è§£å†³è¯´è¯äººçº ç¼ çš„æ–¹æ³•&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹å¾è§£è€¦&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é€šè¿‡è®¾è®¡ç‰¹å®šçš„æ¨¡å‹æ¶æ„ï¼Œå°†è¯­ä¹‰ã€æƒ…æ„Ÿã€è¯­è°ƒç­‰ç‰¹å¾ä¸è¯´è¯äººèº«ä»½ç‰¹å¾è§£è€¦ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨è‡ªç¼–ç å™¨æˆ–å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆVAEï¼‰æ¥æå–å’Œåˆ†ç¦»è¿™äº›ç‰¹å¾ï¼Œç„¶åå†è¿›è¡Œè¯­éŸ³åˆæˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šä»»åŠ¡å­¦ä¹ &lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;åœ¨æ¨¡å‹è®­ç»ƒä¸­ï¼ŒåŒæ—¶è¿›è¡Œå¤šä¸ªä»»åŠ¡ï¼Œå¦‚è¯´è¯äººè¯†åˆ«ã€æƒ…æ„Ÿè¯†åˆ«å’Œè¯­ä¹‰ç†è§£ï¼Œä»¥å¢å¼ºæ¨¡å‹å¯¹ä¸åŒç‰¹å¾çš„åŒºåˆ†èƒ½åŠ›ã€‚é€šè¿‡å¤šä»»åŠ¡å­¦ä¹ ï¼Œæ¨¡å‹å¯ä»¥æ›´å¥½åœ°ç†è§£å’Œåˆ†ç¦»è¿™äº›ç‰¹å¾ï¼Œä»è€Œå‡å°‘è¯´è¯äººçº ç¼ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®å¢å¼º&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨æ•°æ®å¢å¼ºæŠ€æœ¯ï¼Œå¦‚è¯­éŸ³å˜è°ƒã€è¯­é€Ÿè°ƒæ•´ã€å™ªå£°æ·»åŠ ç­‰ï¼Œæ¥å¢åŠ è®­ç»ƒæ•°æ®çš„å¤šæ ·æ€§ã€‚è¿™å¯ä»¥å¸®åŠ©æ¨¡å‹æ›´å¥½åœ°å­¦ä¹ å’Œé€‚åº”ä¸åŒçš„è¯­éŸ³ç‰¹å¾ï¼Œå‡å°‘è¯´è¯äººçº ç¼ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ­£åˆ™åŒ–æŠ€æœ¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨æ­£åˆ™åŒ–æŠ€æœ¯ï¼Œå¦‚dropoutã€æƒé‡è¡°å‡ç­‰ï¼Œæ¥é˜²æ­¢æ¨¡å‹è¿‡æ‹Ÿåˆï¼Œå¢å¼ºæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚æ­£åˆ™åŒ–æŠ€æœ¯å¯ä»¥å‡å°‘æ¨¡å‹å¯¹ç‰¹å®šè¯´è¯äººç‰¹å¾çš„ä¾èµ–ï¼Œä»è€Œå‡å°‘è¯´è¯äººçº ç¼ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;æ€»ç»“-1&#34;&gt;æ€»ç»“&lt;/h4&gt;
&lt;p&gt;è¯´è¯äººçº ç¼ æ˜¯è¯­éŸ³å¤„ç†å’Œè¯­éŸ³åˆæˆä¸­çš„ä¸€ä¸ªé‡è¦é—®é¢˜ï¼Œå®ƒä¼šå½±å“æ¨¡å‹çš„çµæ´»æ€§å’Œç”Ÿæˆè¯­éŸ³çš„è‡ªç„¶åº¦ã€‚é€šè¿‡ç‰¹å¾è§£è€¦ã€å¤šä»»åŠ¡å­¦ä¹ ã€æ•°æ®å¢å¼ºå’Œæ­£åˆ™åŒ–æŠ€æœ¯ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘è¯´è¯äººçº ç¼ ï¼Œæé«˜è¯­éŸ³åˆæˆçš„è´¨é‡å’Œçµæ´»æ€§ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;ç¡¬æµ‹è¯•hard-testing&#34;&gt;ç¡¬æµ‹è¯•ï¼ˆHard Testingï¼‰&lt;/h3&gt;
&lt;p&gt;ç¡¬æµ‹è¯•ï¼ˆHard Testingï¼‰æ˜¯æŒ‡åœ¨è¯„ä¼°æ¨¡å‹æ€§èƒ½æ—¶ï¼Œä½¿ç”¨å…·æœ‰æŒ‘æˆ˜æ€§çš„ã€éš¾åº¦è¾ƒé«˜çš„æµ‹è¯•æ¡ˆä¾‹æ¥æ£€éªŒæ¨¡å‹çš„é²æ£’æ€§å’Œæé™æ€§èƒ½ã€‚è¿™äº›æµ‹è¯•æ¡ˆä¾‹é€šå¸¸åŒ…å«å¤æ‚çš„è¾“å…¥ã€è¾¹ç¼˜æƒ…å†µæˆ–æç«¯æ¡ä»¶ï¼Œæ—¨åœ¨æ­ç¤ºæ¨¡å‹åœ¨é¢å¯¹å›°éš¾ä»»åŠ¡æ—¶çš„è¡¨ç°ã€‚ç¡¬æµ‹è¯•æœ‰åŠ©äºå‘ç°æ¨¡å‹çš„å¼±ç‚¹å’Œä¸è¶³ï¼Œä»è€ŒæŒ‡å¯¼è¿›ä¸€æ­¥çš„æ”¹è¿›å’Œä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ç¡¬æµ‹è¯•çš„å…·ä½“å†…å®¹&#34;&gt;ç¡¬æµ‹è¯•çš„å…·ä½“å†…å®¹&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¤æ‚è¾“å…¥&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;åŒ…å«å¤šä¸ªè¯­ä¹‰å±‚é¢çš„è¾“å…¥ï¼Œå¦‚åŒ…å«å¤šä¸ªæŒ‡ä»¤ã€å¤æ‚çš„æƒ…æ„Ÿè¡¨è¾¾æˆ–å¤šç§è¯­è¨€æ··åˆçš„è¾“å…¥ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œä¸€ä¸ªè¾“å…¥æ–‡æœ¬å¯èƒ½åŒæ—¶åŒ…å«å¤šç§æƒ…æ„ŸæŒ‡ä»¤ï¼šâ€œè¯·ç”¨é«˜å…´çš„æƒ…æ„Ÿè¯´ï¼Œä½†ä¸­é—´å¸¦ç‚¹æ‚²ä¼¤ã€‚â€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¾¹ç¼˜æƒ…å†µ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è¾“å…¥æ–‡æœ¬æˆ–è¯­éŸ³ä¸­åŒ…å«ä¸å¸¸è§çš„è¯æ±‡ã€è¯­æ³•ç»“æ„æˆ–å‘éŸ³ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼ŒåŒ…å«ç½•è§çš„æ–¹è¨€è¯æ±‡æˆ–ç”Ÿåƒ»å­—çš„è¾“å…¥æ–‡æœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æç«¯æ¡ä»¶&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è¾“å…¥æ–‡æœ¬æˆ–è¯­éŸ³çš„é•¿åº¦éå¸¸é•¿æˆ–éå¸¸çŸ­ï¼Œæˆ–è€…åŒ…å«å¤§é‡çš„é‡å¤å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œä¸€ä¸ªéå¸¸é•¿çš„æ–‡æœ¬æ®µè½æˆ–åŒ…å«å¤§é‡é‡å¤å•è¯çš„æ–‡æœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šæ¨¡æ€è¾“å…¥&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è¾“å…¥åŒ…å«å¤šç§æ¨¡æ€çš„ä¿¡æ¯ï¼Œå¦‚æ–‡æœ¬ã€è¯­éŸ³ã€å›¾åƒç­‰ï¼Œæ¨¡å‹éœ€è¦åŒæ—¶å¤„ç†è¿™äº›ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œè¾“å…¥æ–‡æœ¬å’Œå‚è€ƒè¯­éŸ³ä¸åŒ¹é…ï¼Œæˆ–è€…è¾“å…¥æ–‡æœ¬åŒ…å«å›¾åƒæè¿°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;ç¡¬æµ‹è¯•çš„ç›®çš„&#34;&gt;ç¡¬æµ‹è¯•çš„ç›®çš„&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è¯„ä¼°é²æ£’æ€§&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;æ£€æŸ¥æ¨¡å‹åœ¨é¢å¯¹å¤æ‚å’Œå›°éš¾çš„è¾“å…¥æ—¶æ˜¯å¦èƒ½å¤Ÿä¿æŒç¨³å®šå’Œå‡†ç¡®çš„æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œè¯„ä¼°æ¨¡å‹åœ¨å¤„ç†åŒ…å«å¤§é‡é‡å¤å†…å®¹çš„æ–‡æœ¬æ—¶æ˜¯å¦ä¼šå‡ºç°é”™è¯¯æˆ–å¡é¡¿ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å‘ç°å¼±ç‚¹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ç¡¬æµ‹è¯•ï¼Œå¯ä»¥å‘ç°æ¨¡å‹åœ¨ç‰¹å®šæƒ…å†µä¸‹è¡¨ç°ä¸ä½³çš„åœ°æ–¹ï¼Œä»è€ŒæŒ‡å¯¼æ¨¡å‹çš„æ”¹è¿›ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œå‘ç°æ¨¡å‹åœ¨å¤„ç†ç½•è§æ–¹è¨€è¯æ±‡æ—¶çš„è¯†åˆ«ç‡è¾ƒä½ï¼Œå¯ä»¥é’ˆå¯¹æ€§åœ°ä¼˜åŒ–æ¨¡å‹çš„è¯æ±‡è¡¨å’Œè®­ç»ƒæ•°æ®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æå‡æ€§èƒ½&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ä¸æ–­æŒ‘æˆ˜æ¨¡å‹çš„æé™ï¼Œæ¨åŠ¨æ¨¡å‹åœ¨å„ç§æƒ…å†µä¸‹éƒ½èƒ½è¡¨ç°å‡ºè‰²ï¼Œæå‡æ•´ä½“æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œé€šè¿‡ç¡¬æµ‹è¯•ä¼˜åŒ–æ¨¡å‹çš„è¯­éŸ³åˆæˆè´¨é‡ï¼Œä½¿å…¶åœ¨å¤„ç†å¤æ‚æƒ…æ„Ÿè¡¨è¾¾æ—¶æ›´åŠ è‡ªç„¶å’Œæµç•…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;ç¡¬æµ‹è¯•çš„åº”ç”¨åœºæ™¯&#34;&gt;ç¡¬æµ‹è¯•çš„åº”ç”¨åœºæ™¯&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è¯­éŸ³åˆæˆ&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è¯„ä¼°TTSæ¨¡å‹åœ¨å¤„ç†å¤æ‚æƒ…æ„Ÿã€å¤šè¯­è¨€æ··åˆå’Œé•¿æ–‡æœ¬æ—¶çš„æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œè¯„ä¼°æ¨¡å‹åœ¨ç”Ÿæˆå¸¦æœ‰å¤šç§æƒ…æ„Ÿçš„é•¿æ–‡æœ¬è¯­éŸ³æ—¶çš„è‡ªç„¶åº¦å’Œä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯­éŸ³è¯†åˆ«&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è¯„ä¼°ASRæ¨¡å‹åœ¨å¤„ç†å¸¦æœ‰å™ªå£°ã€å£éŸ³å’Œç½•è§è¯æ±‡çš„è¯­éŸ³æ—¶çš„æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œè¯„ä¼°æ¨¡å‹åœ¨è¯†åˆ«å¸¦æœ‰å¼ºçƒˆåœ°æ–¹å£éŸ³çš„è¯­éŸ³æ—¶çš„å‡†ç¡®ç‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è‡ªç„¶è¯­è¨€å¤„ç†&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è¯„ä¼°NLPæ¨¡å‹åœ¨å¤„ç†å¤æ‚è¯­æ³•ç»“æ„ã€å¤šæ¨¡æ€è¾“å…¥å’Œé•¿æ–‡æœ¬æ—¶çš„æ€§èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œè¯„ä¼°æ¨¡å‹åœ¨å¤„ç†åŒ…å«å›¾åƒæè¿°å’Œå¤æ‚æŒ‡ä»¤çš„æ–‡æœ¬æ—¶çš„ç†è§£èƒ½åŠ›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;æ€»ç»“-2&#34;&gt;æ€»ç»“&lt;/h4&gt;
&lt;p&gt;ç¡¬æµ‹è¯•æ˜¯ä¸€ç§é‡è¦çš„è¯„ä¼°æ–¹æ³•ï¼Œé€šè¿‡ä½¿ç”¨å…·æœ‰æŒ‘æˆ˜æ€§çš„æµ‹è¯•æ¡ˆä¾‹ï¼Œå¯ä»¥å…¨é¢è¯„ä¼°æ¨¡å‹çš„é²æ£’æ€§å’Œæ€§èƒ½æé™ã€‚è¿™æœ‰åŠ©äºå‘ç°æ¨¡å‹çš„å¼±ç‚¹ï¼ŒæŒ‡å¯¼è¿›ä¸€æ­¥çš„ä¼˜åŒ–å’Œæ”¹è¿›ï¼Œä»è€Œæå‡æ¨¡å‹åœ¨å®é™…åº”ç”¨ä¸­çš„è¡¨ç°ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;cerss-å’Œ-wer&#34;&gt;CERã€SS å’Œ WER&lt;/h3&gt;
&lt;p&gt;åœ¨è¯­éŸ³åˆæˆå’Œè¯­éŸ³è¯†åˆ«ä»»åŠ¡ä¸­ï¼ŒCERã€SS å’Œ WER æ˜¯å¸¸ç”¨çš„è¯„ä¼°æŒ‡æ ‡ï¼Œåˆ†åˆ«ä»£è¡¨ä¸åŒçš„æ€§èƒ½æ–¹é¢ã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»æ¯ä¸ªæŒ‡æ ‡çš„å«ä¹‰å’Œè®¡ç®—æ–¹æ³•ï¼š&lt;/p&gt;
&lt;h4 id=&#34;1-cercharacter-error-rate&#34;&gt;1. CERï¼ˆCharacter Error Rateï¼‰&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;å­—ç¬¦é”™è¯¯ç‡ï¼ˆCERï¼‰&lt;/strong&gt; æ˜¯è¡¡é‡ç”Ÿæˆæ–‡æœ¬ä¸ç›®æ ‡æ–‡æœ¬ä¹‹é—´å­—ç¬¦çº§å·®å¼‚çš„æŒ‡æ ‡ã€‚å®ƒé€šå¸¸ç”¨äºè¯„ä¼°è¯­éŸ³è¯†åˆ«å’Œè¯­éŸ³åˆæˆä»»åŠ¡ä¸­æ–‡æœ¬çš„å‡†ç¡®æ€§ã€‚CER è®¡ç®—äº†ç”Ÿæˆæ–‡æœ¬å’Œç›®æ ‡æ–‡æœ¬ä¹‹é—´çš„æ’å…¥ã€åˆ é™¤å’Œæ›¿æ¢æ“ä½œçš„æ€»æ•°ï¼Œç„¶åé™¤ä»¥ç›®æ ‡æ–‡æœ¬çš„å­—ç¬¦æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è®¡ç®—æ–¹æ³•&lt;/strong&gt;ï¼š
$$
\text{CER} = \frac{\text{æ’å…¥æ•°} + \text{åˆ é™¤æ•°} + \text{æ›¿æ¢æ•°}}{\text{ç›®æ ‡æ–‡æœ¬çš„å­—ç¬¦æ•°}}
$$
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›®æ ‡æ–‡æœ¬ï¼š&lt;code&gt;&amp;quot;hello world&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆæ–‡æœ¬ï¼š&lt;code&gt;&amp;quot;helo world&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ’å…¥æ•°ï¼š0&lt;/li&gt;
&lt;li&gt;åˆ é™¤æ•°ï¼š0&lt;/li&gt;
&lt;li&gt;æ›¿æ¢æ•°ï¼š1ï¼ˆ&lt;code&gt;&amp;quot;ll&amp;quot;&lt;/code&gt; æ›¿æ¢ä¸º &lt;code&gt;&amp;quot;l&amp;quot;&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;ç›®æ ‡æ–‡æœ¬çš„å­—ç¬¦æ•°ï¼š11&lt;/li&gt;
&lt;li&gt;CERï¼š$\frac{1}{11} \approx 0.091$ æˆ– 9.1%&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;2-ssspeaker-similarity&#34;&gt;2. SSï¼ˆSpeaker Similarityï¼‰&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;è¯´è¯äººç›¸ä¼¼æ€§ï¼ˆSSï¼‰&lt;/strong&gt; æ˜¯è¡¡é‡ç”Ÿæˆè¯­éŸ³ä¸ç›®æ ‡è¯´è¯äººè¯­éŸ³åœ¨éŸ³è‰²å’ŒéŸ³è´¨ä¸Šçš„ç›¸ä¼¼åº¦çš„æŒ‡æ ‡ã€‚å®ƒé€šå¸¸ç”¨äºè¯„ä¼°è¯­éŸ³åˆæˆä»»åŠ¡ä¸­ç”Ÿæˆè¯­éŸ³çš„è¯´è¯äººä¸€è‡´æ€§ã€‚SS é€šå¸¸é€šè¿‡è¯´è¯äººéªŒè¯ï¼ˆSVï¼‰æ¨¡å‹æ¥è®¡ç®—ï¼ŒSV æ¨¡å‹ä¼šæå–è¯­éŸ³çš„åµŒå…¥å‘é‡å¹¶è®¡ç®—ç”Ÿæˆè¯­éŸ³å’Œç›®æ ‡è¯­éŸ³ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è®¡ç®—æ–¹æ³•&lt;/strong&gt;ï¼š
$$
\text{SS} = \cos(\text{ç”Ÿæˆè¯­éŸ³çš„åµŒå…¥å‘é‡}, \text{ç›®æ ‡è¯­éŸ³çš„åµŒå…¥å‘é‡})
$$
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ç›®æ ‡è¯­éŸ³çš„åµŒå…¥å‘é‡ï¼š&lt;/p&gt;
&lt;p&gt;[0.1, 0.2, 0.3, $\ldots$]&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç”Ÿæˆè¯­éŸ³çš„åµŒå…¥å‘é‡ï¼š&lt;/p&gt;
&lt;p&gt;[0.11, 0.21, 0.31, $\ldots$]&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½™å¼¦ç›¸ä¼¼åº¦ï¼š$\cos(\text{ç”Ÿæˆè¯­éŸ³çš„åµŒå…¥å‘é‡}, \text{ç›®æ ‡è¯­éŸ³çš„åµŒå…¥å‘é‡}) \approx 0.95$&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;SSï¼š0.95&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;3-werword-error-rate&#34;&gt;3. WERï¼ˆWord Error Rateï¼‰&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;è¯é”™è¯¯ç‡ï¼ˆWERï¼‰&lt;/strong&gt; æ˜¯è¡¡é‡ç”Ÿæˆæ–‡æœ¬ä¸ç›®æ ‡æ–‡æœ¬ä¹‹é—´è¯çº§å·®å¼‚çš„æŒ‡æ ‡ã€‚å®ƒé€šå¸¸ç”¨äºè¯„ä¼°è¯­éŸ³è¯†åˆ«å’Œè¯­éŸ³åˆæˆä»»åŠ¡ä¸­æ–‡æœ¬çš„å‡†ç¡®æ€§ã€‚WER è®¡ç®—äº†ç”Ÿæˆæ–‡æœ¬å’Œç›®æ ‡æ–‡æœ¬ä¹‹é—´çš„æ’å…¥ã€åˆ é™¤å’Œæ›¿æ¢æ“ä½œçš„æ€»æ•°ï¼Œç„¶åé™¤ä»¥ç›®æ ‡æ–‡æœ¬çš„è¯æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è®¡ç®—æ–¹æ³•&lt;/strong&gt;ï¼š
$$
\text{WER} = \frac{\text{æ’å…¥æ•°} + \text{åˆ é™¤æ•°} + \text{æ›¿æ¢æ•°}}{\text{ç›®æ ‡æ–‡æœ¬çš„è¯æ•°}}
$$
&lt;strong&gt;ç¤ºä¾‹&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç›®æ ‡æ–‡æœ¬ï¼š&lt;code&gt;&amp;quot;hello world&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆæ–‡æœ¬ï¼š&lt;code&gt;&amp;quot;hello there&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æ’å…¥æ•°ï¼š1ï¼ˆ&lt;code&gt;&amp;quot;there&amp;quot;&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;åˆ é™¤æ•°ï¼š1ï¼ˆ&lt;code&gt;&amp;quot;world&amp;quot;&lt;/code&gt;ï¼‰&lt;/li&gt;
&lt;li&gt;æ›¿æ¢æ•°ï¼š0&lt;/li&gt;
&lt;li&gt;ç›®æ ‡æ–‡æœ¬çš„è¯æ•°ï¼š2&lt;/li&gt;
&lt;li&gt;WERï¼š$\frac{1 + 1 + 0}{2} = 1.0$ æˆ– 100%&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;æ€»ç»“-3&#34;&gt;æ€»ç»“&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;CER&lt;/strong&gt;ï¼šå­—ç¬¦é”™è¯¯ç‡ï¼Œç”¨äºè¯„ä¼°æ–‡æœ¬çš„å­—ç¬¦çº§å‡†ç¡®æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SS&lt;/strong&gt;ï¼šè¯´è¯äººç›¸ä¼¼æ€§ï¼Œç”¨äºè¯„ä¼°ç”Ÿæˆè¯­éŸ³ä¸ç›®æ ‡è¯´è¯äººè¯­éŸ³çš„éŸ³è‰²å’ŒéŸ³è´¨ç›¸ä¼¼åº¦ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;WER&lt;/strong&gt;ï¼šè¯é”™è¯¯ç‡ï¼Œç”¨äºè¯„ä¼°æ–‡æœ¬çš„è¯çº§å‡†ç¡®æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™äº›æŒ‡æ ‡åœ¨è¯­éŸ³åˆæˆå’Œè¯­éŸ³è¯†åˆ«ä»»åŠ¡ä¸­éå¸¸é‡è¦ï¼Œå®ƒä»¬å¸®åŠ©è¯„ä¼°æ¨¡å‹çš„æ€§èƒ½ï¼ŒæŒ‡å¯¼æ¨¡å‹çš„ä¼˜åŒ–å’Œæ”¹è¿›ã€‚é€šè¿‡ç»¼åˆä½¿ç”¨è¿™äº›æŒ‡æ ‡ï¼Œå¯ä»¥å…¨é¢è¯„ä¼°æ¨¡å‹åœ¨ä¸åŒæ–¹é¢çš„è¡¨ç°ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;nmos-normalized-mean-opinion-score&#34;&gt;NMOS ï¼ˆNormalized Mean Opinion Scoreï¼‰&lt;/h3&gt;
&lt;p&gt;NMOSï¼ˆNormalized Mean Opinion Scoreï¼‰æ˜¯ä¸€ç§ç”¨äºè¯„ä¼°è¯­éŸ³è´¨é‡çš„å®¢è§‚æŒ‡æ ‡ï¼Œå®ƒé€šè¿‡æ¨¡æ‹Ÿäººç±»å¬ä¼—çš„ä¸»è§‚è¯„ä»·æ¥é‡åŒ–è¯­éŸ³çš„è‡ªç„¶åº¦å’Œå¯ç†è§£æ€§ã€‚NMOSå€¼é€šå¸¸åœ¨0åˆ°5ä¹‹é—´ï¼Œå…¶ä¸­5è¡¨ç¤ºæœ€ä½³è´¨é‡ï¼Œ0è¡¨ç¤ºæœ€å·®è´¨é‡ã€‚NMOSå¹¿æ³›åº”ç”¨äºè¯­éŸ³å¤„ç†ã€è¯­éŸ³åˆæˆå’Œè¯­éŸ³é€šä¿¡ç³»ç»Ÿä¸­ï¼Œä»¥è¯„ä¼°å’Œä¼˜åŒ–è¯­éŸ³ä¿¡å·çš„è´¨é‡ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;NMOSæ˜¯ä¸€ç§æ ‡å‡†åŒ–çš„å¹³å‡æ„è§å¾—åˆ†ï¼Œç”¨äºè¯„ä¼°è¯­éŸ³è´¨é‡ã€‚å®ƒé€šè¿‡ç®—æ³•è‡ªåŠ¨è®¡ç®—ï¼Œæ¨¡æ‹Ÿäººç±»å¯¹è¯­éŸ³è´¨é‡çš„ä¸»è§‚è¯„ä»·ã€‚&lt;/li&gt;
&lt;li&gt;NMOSå€¼è¶Šé«˜ï¼Œè¡¨ç¤ºè¯­éŸ³è´¨é‡è¶Šå¥½ï¼›å€¼è¶Šä½ï¼Œè¡¨ç¤ºè¯­éŸ³è´¨é‡è¶Šå·®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¡ç®—æ–¹æ³•&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;NMOSçš„è®¡ç®—é€šå¸¸åŸºäºè¯­éŸ³ä¿¡å·çš„å¤šä¸ªç‰¹å¾ï¼Œå¦‚ä¿¡å™ªæ¯”ï¼ˆSNRï¼‰ã€è°æ³¢å™ªå£°æ¯”ï¼ˆHNRï¼‰ã€æ¢…å°”é¢‘è°±å¤±çœŸç­‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œä¸€ä¸ªå¸¸è§çš„NMOSè®¡ç®—æ–¹æ³•æ˜¯ä½¿ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå¦‚DNSMOSï¼ˆDeep Noise Suppression Mean Opinion Scoreï¼‰ï¼Œè¯¥æ¨¡å‹é€šè¿‡è®­ç»ƒå­¦ä¹ äººç±»å¯¹è¯­éŸ³è´¨é‡çš„ä¸»è§‚è¯„ä»·æ ‡å‡†ï¼Œç„¶åå¯¹æ–°çš„è¯­éŸ³æ ·æœ¬è¿›è¡Œè¯„åˆ†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åº”ç”¨åœºæ™¯&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯­éŸ³åˆæˆ&lt;/strong&gt;ï¼šè¯„ä¼°ç”Ÿæˆè¯­éŸ³çš„è‡ªç„¶åº¦å’Œå¯ç†è§£æ€§ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯­éŸ³è¯†åˆ«&lt;/strong&gt;ï¼šè¯„ä¼°è¯­éŸ³ä¿¡å·åœ¨ä¼ è¾“å’Œå¤„ç†è¿‡ç¨‹ä¸­çš„è´¨é‡æŸå¤±ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯­éŸ³é€šä¿¡&lt;/strong&gt;ï¼šè¯„ä¼°è¯­éŸ³åœ¨ä¸åŒé€šä¿¡ç¯å¢ƒä¸‹çš„è´¨é‡ï¼Œå¦‚ç”µè¯é€šè¯ã€è§†é¢‘ä¼šè®®ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;nmosçš„ä½œç”¨&#34;&gt;NMOSçš„ä½œç”¨&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è¯„ä¼°è¯­éŸ³è´¨é‡&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;NMOSå¯ä»¥å¿«é€Ÿã€è‡ªåŠ¨åœ°è¯„ä¼°è¯­éŸ³ä¿¡å·çš„è´¨é‡ï¼Œæä¾›ä¸€ä¸ªé‡åŒ–çš„æŒ‡æ ‡æ¥è¡¡é‡è¯­éŸ³çš„è‡ªç„¶åº¦å’Œå¯ç†è§£æ€§ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼ŒNMOSå¯ä»¥ç”¨äºæ¯”è¾ƒä¸åŒè¯­éŸ³åˆæˆæ¨¡å‹çš„è¾“å‡ºè´¨é‡ï¼Œå¸®åŠ©é€‰æ‹©æœ€ä½³æ¨¡å‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é€šè¿‡NMOSï¼Œå¯ä»¥è¯†åˆ«è¯­éŸ³å¤„ç†ç³»ç»Ÿä¸­çš„é—®é¢˜ï¼Œå¦‚å™ªå£°ã€å¤±çœŸå’Œç¼–ç  artifactsï¼Œä»è€ŒæŒ‡å¯¼ç³»ç»Ÿçš„ä¼˜åŒ–å’Œæ”¹è¿›ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œå¦‚æœNMOSå€¼è¾ƒä½ï¼Œå¯èƒ½è¡¨æ˜è¯­éŸ³ä¿¡å·åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å—åˆ°äº†å™ªå£°å¹²æ‰°ï¼Œéœ€è¦ä¼˜åŒ–å™ªå£°æŠ‘åˆ¶ç®—æ³•ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”¨æˆ·æ»¡æ„åº¦é¢„æµ‹&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;NMOSå€¼å¯ä»¥é¢„æµ‹ç”¨æˆ·å¯¹è¯­éŸ³è´¨é‡çš„æ»¡æ„åº¦ï¼Œå¸®åŠ©è®¾è®¡æ›´ç¬¦åˆç”¨æˆ·éœ€æ±‚çš„è¯­éŸ³ç³»ç»Ÿã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œä¸€ä¸ªé«˜NMOSå€¼çš„è¯­éŸ³åˆæˆç³»ç»Ÿæ›´å¯èƒ½è·å¾—ç”¨æˆ·çš„æ­£é¢è¯„ä»·ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;nmosçš„è®¡ç®—ç¤ºä¾‹&#34;&gt;NMOSçš„è®¡ç®—ç¤ºä¾‹&lt;/h4&gt;
&lt;p&gt;å‡è®¾æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªé¢„è®­ç»ƒçš„NMOSæ¨¡å‹æ¥è¯„ä¼°ä¸€æ®µè¯­éŸ³çš„è´¨é‡ã€‚æ¨¡å‹çš„è¾“å‡ºæ˜¯ä¸€ä¸ª0åˆ°5ä¹‹é—´çš„åˆ†æ•°ï¼Œè¡¨ç¤ºè¯­éŸ³çš„è‡ªç„¶åº¦å’Œå¯ç†è§£æ€§ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;p&gt;Pythonå¤åˆ¶&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;torch&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;dnsmos&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DNSMOS&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# åŠ è½½é¢„è®­ç»ƒçš„NMOSæ¨¡å‹&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;model&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DNSMOS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# è¯»å–è¯­éŸ³æ–‡ä»¶&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;audio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;torchaudio&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;example.wav&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# è®¡ç®—NMOS&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;nmoss&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mos_sig&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mos_bak&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mos_ovr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;audio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# è¾“å‡ºNMOSå€¼&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;NMOS: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nmoss&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;.2f&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;MOS_SIG: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mos_sig&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;.2f&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;MOS_BAK: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mos_bak&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;.2f&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;MOS_OVR: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mos_ovr&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;.2f&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ&lt;code&gt;nmoss&lt;/code&gt;è¡¨ç¤ºæ•´ä½“çš„NMOSå€¼ï¼Œ&lt;code&gt;mos_sig&lt;/code&gt;ã€&lt;code&gt;mos_bak&lt;/code&gt;å’Œ&lt;code&gt;mos_ovr&lt;/code&gt;åˆ†åˆ«è¡¨ç¤ºä¿¡å·è´¨é‡ã€èƒŒæ™¯å™ªå£°è´¨é‡å’Œæ•´ä½“è´¨é‡çš„è¯„åˆ†ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ€»ç»“-4&#34;&gt;æ€»ç»“&lt;/h4&gt;
&lt;p&gt;NMOSæ˜¯ä¸€ç§é‡è¦çš„å®¢è§‚æŒ‡æ ‡ï¼Œç”¨äºè¯„ä¼°è¯­éŸ³è´¨é‡ã€‚é€šè¿‡æ¨¡æ‹Ÿäººç±»çš„ä¸»è§‚è¯„ä»·ï¼ŒNMOSå¯ä»¥å¿«é€Ÿã€è‡ªåŠ¨åœ°æä¾›è¯­éŸ³è´¨é‡çš„é‡åŒ–è¯„ä¼°ï¼Œå¸®åŠ©ä¼˜åŒ–è¯­éŸ³å¤„ç†ç³»ç»Ÿï¼Œæé«˜ç”¨æˆ·æ»¡æ„åº¦ã€‚åœ¨è¯­éŸ³åˆæˆã€è¯­éŸ³è¯†åˆ«å’Œè¯­éŸ³é€šä¿¡ç­‰åº”ç”¨ä¸­ï¼ŒNMOSå¹¿æ³›ç”¨äºè¯„ä¼°å’Œä¼˜åŒ–è¯­éŸ³ä¿¡å·çš„è´¨é‡ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;mos-imean-opinion-score-for-instruction&#34;&gt;MOS-Iï¼ˆMean Opinion Score for Instructionï¼‰&lt;/h3&gt;
&lt;p&gt;MOS-Iï¼ˆMean Opinion Score for Instructionï¼‰æ˜¯ä¸€ä¸ªç”¨äºè¯„ä¼°è¯­éŸ³åˆæˆç³»ç»Ÿä¸­æŒ‡ä»¤å¼ç”Ÿæˆï¼ˆInstruction-based Generationï¼‰çš„ä¸»è§‚æŒ‡æ ‡ã€‚å®ƒé€šè¿‡ç”¨æˆ·å¯¹ç”Ÿæˆè¯­éŸ³çš„æŒ‡ä»¤éµå¾ªç¨‹åº¦ã€è‡ªç„¶åº¦å’Œå‡†ç¡®æ€§çš„è¯„åˆ†æ¥è¡¡é‡æ¨¡å‹çš„æ€§èƒ½ã€‚MOS-Iç‰¹åˆ«é€‚ç”¨äºè¯„ä¼°æ¨¡å‹åœ¨ç”Ÿæˆå¸¦æœ‰ç‰¹å®šæƒ…æ„Ÿã€è¯­é€Ÿã€å£éŸ³æˆ–è§’è‰²é£æ ¼çš„è¯­éŸ³æ—¶çš„è¡¨ç°ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;MOS-I&lt;/strong&gt;ï¼šç”¨äºè¯„ä¼°ç”Ÿæˆè¯­éŸ³æ˜¯å¦å‡†ç¡®åœ°éµå¾ªäº†ç»™å®šçš„æŒ‡ä»¤ï¼Œå¦‚æƒ…æ„Ÿè¡¨è¾¾ã€è¯­é€Ÿè°ƒæ•´ã€æ–¹è¨€ä½¿ç”¨å’Œè§’è‰²æ‰®æ¼”ç­‰ã€‚è¯„åˆ†èŒƒå›´é€šå¸¸ä¸º1åˆ°5ï¼Œå…¶ä¸­5è¡¨ç¤ºæœ€ä½³è¡¨ç°ï¼Œ1è¡¨ç¤ºæœ€å·®è¡¨ç°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯„åˆ†æ ‡å‡†&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;1&lt;/strong&gt;ï¼šç”Ÿæˆçš„è¯­éŸ³å®Œå…¨ä¸ç¬¦åˆæŒ‡ä»¤ï¼Œå¬èµ·æ¥ä¸è‡ªç„¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;2&lt;/strong&gt;ï¼šç”Ÿæˆçš„è¯­éŸ³éƒ¨åˆ†ç¬¦åˆæŒ‡ä»¤ï¼Œä½†æ•´ä½“è¡¨ç°ä¸ä½³ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;3&lt;/strong&gt;ï¼šç”Ÿæˆçš„è¯­éŸ³åŸºæœ¬ç¬¦åˆæŒ‡ä»¤ï¼Œä½†ä»æœ‰æ”¹è¿›ç©ºé—´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;4&lt;/strong&gt;ï¼šç”Ÿæˆçš„è¯­éŸ³å¾ˆå¥½åœ°ç¬¦åˆæŒ‡ä»¤ï¼Œè¡¨ç°è‡ªç„¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;5&lt;/strong&gt;ï¼šç”Ÿæˆçš„è¯­éŸ³å®Œå…¨ç¬¦åˆæŒ‡ä»¤ï¼Œè¡¨ç°éå¸¸è‡ªç„¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®¡ç®—æ–¹æ³•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;MOS-I&lt;/strong&gt; æ˜¯é€šè¿‡æ”¶é›†å¤šä¸ªå¬ä¼—å¯¹åŒä¸€ç”Ÿæˆè¯­éŸ³çš„è¯„åˆ†ï¼Œç„¶åè®¡ç®—è¿™äº›è¯„åˆ†çš„å¹³å‡å€¼æ¥å¾—åˆ°çš„ã€‚æ¯ä¸ªå¬ä¼—æ ¹æ®ç”Ÿæˆè¯­éŸ³å¯¹æŒ‡ä»¤çš„éµå¾ªç¨‹åº¦ã€è‡ªç„¶åº¦å’Œå‡†ç¡®æ€§è¿›è¡Œè¯„åˆ†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¾‹å¦‚ï¼Œå¦‚æœæœ‰10ä¸ªå¬ä¼—å¯¹åŒä¸€ç”Ÿæˆè¯­éŸ³è¿›è¡Œè¯„åˆ†ï¼Œè¯„åˆ†åˆ†åˆ«ä¸ºï¼š4, 4, 5, 3, 4, 4, 5, 4, 3, 4ï¼Œé‚£ä¹ˆMOS-Iå€¼ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;MOS-I=(4+4+5+3+4+4+5+4+3+4)/10=4.0&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;åº”ç”¨åœºæ™¯-1&#34;&gt;åº”ç”¨åœºæ™¯&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;æƒ…æ„Ÿè¡¨è¾¾&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è¯„ä¼°ç”Ÿæˆè¯­éŸ³æ˜¯å¦å‡†ç¡®åœ°è¡¨è¾¾äº†æŒ‡å®šçš„æƒ…æ„Ÿï¼Œå¦‚é«˜å…´ã€æ‚²ä¼¤ã€æƒŠè®¶ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼ŒæŒ‡ä»¤ä¸ºâ€œç”¨é«˜å…´çš„æƒ…æ„Ÿè¯´â€ï¼Œç”Ÿæˆçš„è¯­éŸ³æ˜¯å¦å¬èµ·æ¥ç¡®å®å¾ˆé«˜å…´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯­é€Ÿè°ƒæ•´&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è¯„ä¼°ç”Ÿæˆè¯­éŸ³æ˜¯å¦æŒ‰ç…§æŒ‡å®šçš„è¯­é€Ÿè¿›è¡Œåˆæˆï¼Œå¦‚å¿«é€Ÿã€æ…¢é€Ÿç­‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼ŒæŒ‡ä»¤ä¸ºâ€œè¯­é€ŸåŠ å¿«â€ï¼Œç”Ÿæˆçš„è¯­éŸ³æ˜¯å¦ç¡®å®æ›´å¿«ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–¹è¨€ä½¿ç”¨&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è¯„ä¼°ç”Ÿæˆè¯­éŸ³æ˜¯å¦å‡†ç¡®åœ°ä½¿ç”¨äº†æŒ‡å®šçš„æ–¹è¨€ï¼Œå¦‚ç²¤è¯­ã€å››å·è¯ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼ŒæŒ‡ä»¤ä¸ºâ€œç”¨ç²¤è¯­å£éŸ³è¯´â€ï¼Œç”Ÿæˆçš„è¯­éŸ³æ˜¯å¦ç¡®å®å¸¦æœ‰ç²¤è¯­å£éŸ³ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§’è‰²æ‰®æ¼”&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è¯„ä¼°ç”Ÿæˆè¯­éŸ³æ˜¯å¦å‡†ç¡®åœ°æ¨¡ä»¿äº†æŒ‡å®šçš„è§’è‰²ï¼Œå¦‚æœºå™¨äººã€å°çŒªä½©å¥‡ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼ŒæŒ‡ä»¤ä¸ºâ€œä»¥æœºå™¨äººçš„è§’è‰²å’Œæˆ‘äº¤æµâ€ï¼Œç”Ÿæˆçš„è¯­éŸ³æ˜¯å¦ç¡®å®å¬èµ·æ¥åƒæœºå™¨äººã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;è¯„ä¼°æµç¨‹&#34;&gt;è¯„ä¼°æµç¨‹&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å‡†å¤‡æµ‹è¯•æ•°æ®&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é€‰æ‹©ä¸€ç»„å…·æœ‰ä»£è¡¨æ€§çš„è¾“å…¥æ–‡æœ¬å’Œå¯¹åº”çš„æŒ‡ä»¤ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œè¾“å…¥æ–‡æœ¬ä¸ºâ€œä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œé€‚åˆå‡ºå»ç©ã€‚â€ï¼ŒæŒ‡ä»¤ä¸ºâ€œç”¨é«˜å…´çš„æƒ…æ„Ÿè¯´â€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿæˆè¯­éŸ³&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨è¯­éŸ³åˆæˆæ¨¡å‹ç”Ÿæˆè¯­éŸ³æ ·æœ¬ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œç”Ÿæˆå¸¦æœ‰é«˜å…´æƒ…æ„Ÿçš„è¯­éŸ³æ ·æœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ”¶é›†è¯„åˆ†&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;é‚€è¯·å¤šä¸ªå¬ä¼—å¯¹ç”Ÿæˆçš„è¯­éŸ³æ ·æœ¬è¿›è¡Œè¯„åˆ†ï¼Œè¯„åˆ†æ ‡å‡†ä¸º1åˆ°5ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œé‚€è¯·10åæ¯è¯­ä¸ºä¸­æ–‡çš„å¬ä¼—å¯¹ç”Ÿæˆçš„è¯­éŸ³æ ·æœ¬è¿›è¡Œè¯„åˆ†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è®¡ç®—MOS-I&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;è®¡ç®—æ‰€æœ‰è¯„åˆ†çš„å¹³å‡å€¼ï¼Œå¾—åˆ°MOS-Iå€¼ã€‚&lt;/li&gt;
&lt;li&gt;ä¾‹å¦‚ï¼Œè®¡ç®—10ä¸ªè¯„åˆ†çš„å¹³å‡å€¼ï¼Œå¾—åˆ°MOS-Iå€¼ä¸º4.0ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;æ€»ç»“-5&#34;&gt;æ€»ç»“&lt;/h4&gt;
&lt;p&gt;MOS-Iæ˜¯ä¸€ä¸ªé‡è¦çš„ä¸»è§‚è¯„ä¼°æŒ‡æ ‡ï¼Œç”¨äºè¯„ä¼°è¯­éŸ³åˆæˆç³»ç»Ÿåœ¨æŒ‡ä»¤å¼ç”Ÿæˆä»»åŠ¡ä¸­çš„è¡¨ç°ã€‚é€šè¿‡æ”¶é›†å¤šä¸ªå¬ä¼—çš„è¯„åˆ†ï¼ŒMOS-Iå¯ä»¥å…¨é¢è¯„ä¼°ç”Ÿæˆè¯­éŸ³å¯¹æŒ‡ä»¤çš„éµå¾ªç¨‹åº¦ã€è‡ªç„¶åº¦å’Œå‡†ç¡®æ€§ã€‚è¿™æœ‰åŠ©äºä¼˜åŒ–æ¨¡å‹ï¼Œæé«˜ç”Ÿæˆè¯­éŸ³çš„è´¨é‡å’Œç”¨æˆ·æ»¡æ„åº¦ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒMOS-Iå¸¸ç”¨äºè¯„ä¼°æ¨¡å‹åœ¨æƒ…æ„Ÿè¡¨è¾¾ã€è¯­é€Ÿè°ƒæ•´ã€æ–¹è¨€ä½¿ç”¨å’Œè§’è‰²æ‰®æ¼”ç­‰ä»»åŠ¡ä¸­çš„è¡¨ç°ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h3 id=&#34;è¯´è¯äººspk-e&#34;&gt;è¯´è¯äººï¼ˆSpk Eï¼‰&lt;/h3&gt;
&lt;p&gt;åœ¨è¯­éŸ³åˆæˆå’Œè¯­éŸ³å¤„ç†çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œ&amp;ldquo;Spk E&amp;rdquo; é€šå¸¸æ˜¯æŒ‡ä¸€ä¸ªç‰¹å®šçš„è¯´è¯äººï¼ˆSpeaker Eï¼‰ã€‚è¯´è¯äººï¼ˆSpkï¼‰æ˜¯è¯­éŸ³æ•°æ®ä¸­çš„ä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„è¯´è¯è€…ã€‚&amp;ldquo;Spk E&amp;rdquo; å¯èƒ½æ˜¯æ•°æ®é›†ä¸­ä¼—å¤šè¯´è¯äººä¸­çš„ä¸€ä¸ªï¼Œç”¨äºè®­ç»ƒå’Œè¯„ä¼°è¯­éŸ³åˆæˆæ¨¡å‹æˆ–è¯­éŸ³è¯†åˆ«æ¨¡å‹ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯´è¯äººï¼ˆSpkï¼‰&lt;/strong&gt;ï¼šåœ¨è¯­éŸ³æ•°æ®é›†ä¸­ï¼Œæ¯ä¸ªè¯´è¯äººé€šå¸¸æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå¦‚ &amp;ldquo;Spk A&amp;rdquo;ã€&amp;ldquo;Spk B&amp;rdquo;ã€&amp;ldquo;Spk C&amp;rdquo; ç­‰ã€‚è¿™äº›æ ‡è¯†ç¬¦ç”¨äºåŒºåˆ†ä¸åŒçš„è¯´è¯è€…ï¼Œä»¥ä¾¿æ¨¡å‹å¯ä»¥å­¦ä¹ å’Œè¯†åˆ«æ¯ä¸ªè¯´è¯äººçš„ç‹¬ç‰¹è¯­éŸ³ç‰¹å¾ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spk E&lt;/strong&gt;ï¼šå…·ä½“æŒ‡æ•°æ®é›†ä¸­çš„ç¬¬äº”ä¸ªè¯´è¯äººï¼ˆå‡è®¾æŒ‰å­—æ¯é¡ºåºæ’åˆ—ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼š
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è®­ç»ƒ&lt;/strong&gt;ï¼šåœ¨è®­ç»ƒè¯­éŸ³åˆæˆæ¨¡å‹æ—¶ï¼Œä½¿ç”¨å¤šä¸ªè¯´è¯äººçš„æ•°æ®å¯ä»¥å¸®åŠ©æ¨¡å‹å­¦ä¹ ä¸åŒè¯´è¯äººçš„è¯­éŸ³ç‰¹å¾ï¼Œä»è€Œæé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›å’Œå¤šè¯´è¯äººåˆæˆèƒ½åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯„ä¼°&lt;/strong&gt;ï¼šåœ¨è¯„ä¼°æ¨¡å‹æ€§èƒ½æ—¶ï¼Œä½¿ç”¨ç‰¹å®šçš„è¯´è¯äººæ•°æ®å¯ä»¥æµ‹è¯•æ¨¡å‹åœ¨ç”Ÿæˆç‰¹å®šè¯´è¯äººè¯­éŸ³æ—¶çš„è¡¨ç°ï¼Œå¦‚è¯´è¯äººç›¸ä¼¼æ€§ã€è¯­éŸ³è‡ªç„¶åº¦ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¾®è°ƒ&lt;/strong&gt;ï¼šåœ¨å¯¹æ¨¡å‹è¿›è¡Œå¾®è°ƒæ—¶ï¼Œå¯ä»¥é’ˆå¯¹ç‰¹å®šçš„è¯´è¯äººè¿›è¡Œä¼˜åŒ–ï¼Œä»¥æé«˜ç”Ÿæˆè¯­éŸ³çš„è´¨é‡å’Œç›¸ä¼¼åº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;è¯´è¯äººç›¸ä¼¼æ€§speaker-similarity&#34;&gt;è¯´è¯äººç›¸ä¼¼æ€§ï¼ˆSpeaker Similarityï¼‰&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¯´è¯äººç›¸ä¼¼æ€§ï¼ˆSSï¼‰&lt;/strong&gt;ï¼šç”¨äºè¡¡é‡ç”Ÿæˆè¯­éŸ³ä¸ç›®æ ‡è¯´è¯äººè¯­éŸ³åœ¨éŸ³è‰²å’ŒéŸ³è´¨ä¸Šçš„ç›¸ä¼¼åº¦ã€‚SS é€šå¸¸é€šè¿‡è¯´è¯äººéªŒè¯ï¼ˆSVï¼‰æ¨¡å‹æ¥è®¡ç®—ï¼ŒSV æ¨¡å‹ä¼šæå–è¯­éŸ³çš„åµŒå…¥å‘é‡å¹¶è®¡ç®—ç”Ÿæˆè¯­éŸ³å’Œç›®æ ‡è¯­éŸ³ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è®¡ç®—æ–¹æ³•&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;SS=cos(ç”Ÿæˆè¯­éŸ³çš„åµŒå…¥å‘é‡,ç›®æ ‡è¯­éŸ³çš„åµŒå…¥å‘é‡)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;è¯´è¯äººå¾®è°ƒspeaker-fine-tuning&#34;&gt;è¯´è¯äººå¾®è°ƒï¼ˆSpeaker Fine-Tuningï¼‰&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯´è¯äººå¾®è°ƒï¼ˆSFTï¼‰&lt;/strong&gt;ï¼šåœ¨ç‰¹å®šè¯´è¯äººä¸Šå¯¹é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œå¾®è°ƒï¼Œå¯ä»¥è¿›ä¸€æ­¥æé«˜ç”Ÿæˆè´¨é‡å’Œè¯´è¯äººç›¸ä¼¼æ€§ã€‚é€šè¿‡åœ¨ç‰¹å®šè¯´è¯äººçš„æ•°æ®ä¸Šè¿›è¡Œå¾®è°ƒï¼Œæ¨¡å‹å¯ä»¥æ›´å¥½åœ°æ•æ‰è¯¥è¯´è¯äººçš„ç‹¬ç‰¹ç‰¹å¾ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤šè¯´è¯äººå¾®è°ƒï¼ˆmSFTï¼‰&lt;/strong&gt;ï¼šåŒæ—¶åœ¨å¤šä¸ªè¯´è¯äººä¸Šè¿›è¡Œå¾®è°ƒï¼Œå¯ä»¥ç¡®ä¿æ¨¡å‹åœ¨å¤šä¸ªè¯´è¯äººä¹‹é—´å…·æœ‰å…¨é¢çš„è¯­è°ƒå’Œå‘éŸ³è¦†ç›–ï¼Œå‡å°‘ç¾éš¾æ€§é—å¿˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;ç¤ºä¾‹&#34;&gt;ç¤ºä¾‹&lt;/h4&gt;
&lt;p&gt;å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«å¤šä¸ªè¯´è¯äººçš„è¯­éŸ³æ•°æ®é›†ï¼Œå…¶ä¸­ &amp;ldquo;Spk E&amp;rdquo; æ˜¯å…¶ä¸­ä¸€ä¸ªè¯´è¯äººã€‚æˆ‘ä»¬å¯ä»¥åœ¨è®­ç»ƒå’Œè¯„ä¼°è¿‡ç¨‹ä¸­ä½¿ç”¨ &amp;ldquo;Spk E&amp;rdquo; çš„æ•°æ®ï¼š&lt;/p&gt;
&lt;p&gt;Pythonå¤åˆ¶&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ç¤ºä¾‹æ•°æ®é›†&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;speakers&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Spk A&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Spk B&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Spk C&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Spk D&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Spk E&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# è®­ç»ƒæ¨¡å‹&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;spk&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;speakers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;train_model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;spk_data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;spk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# è¯„ä¼°æ¨¡å‹&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;spk&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;speakers&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;evaluate_model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;spk_data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;spk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# ç‰¹å®šè¯´è¯äººå¾®è°ƒ&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;fine_tune_model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;spk_e_data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# è¯„ä¼°å¾®è°ƒåçš„æ¨¡å‹&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;evaluate_model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;spk_e_data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;æ€»ç»“-6&#34;&gt;æ€»ç»“&lt;/h4&gt;
&lt;p&gt;&amp;ldquo;Spk E&amp;rdquo; æ˜¯æ•°æ®é›†ä¸­çš„ä¸€ä¸ªç‰¹å®šè¯´è¯äººæ ‡è¯†ç¬¦ï¼Œç”¨äºè®­ç»ƒã€è¯„ä¼°å’Œå¾®è°ƒè¯­éŸ³åˆæˆæ¨¡å‹ã€‚é€šè¿‡ä½¿ç”¨å¤šä¸ªè¯´è¯äººçš„æ•°æ®ï¼Œæ¨¡å‹å¯ä»¥å­¦ä¹ å’Œè¯†åˆ«ä¸åŒè¯´è¯äººçš„ç‹¬ç‰¹ç‰¹å¾ï¼Œä»è€Œæé«˜ç”Ÿæˆè¯­éŸ³çš„è´¨é‡å’Œè‡ªç„¶åº¦ã€‚è¯´è¯äººç›¸ä¼¼æ€§ï¼ˆSSï¼‰å’Œè¯´è¯äººå¾®è°ƒï¼ˆSFTï¼‰æ˜¯è¯„ä¼°å’Œä¼˜åŒ–æ¨¡å‹æ€§èƒ½çš„é‡è¦æ‰‹æ®µã€‚&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>è®ºæ–‡è§£è¯»ï¼šCosyVoice: A Scalable Multilingual Zero-shot Text-to-speech Synthesizer based on Supervised Semantic Tokens</title>
      <link>https://weedge.github.io/post/multimoding/voices/cosyvoice/</link>
      <pubDate>Wed, 15 Jan 2025 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/multimoding/voices/cosyvoice/</guid>
      
        <description>&lt;h2 id=&#34;cosyvoice&#34;&gt;CosyVoice&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2407.04051&#34;&gt;2024.7 FunAudioLLM: Voice Understanding and Generation Foundation Models for Natural Interaction Between Humans and LLMs&lt;/a&gt; ï¼ˆä¸»è¦ä»‹ç»ASR SenseVoice å’Œ TTS CosyVoice,å…¶ä¸­ SenseVoice æ²¡æœ‰å•ç‹¬è®ºæ–‡ï¼Œç›¸å…³CosyVoice å’Œå•ç‹¬è®ºæ–‡æ˜¯é‡å¤çš„, SenseVoice Largeçš„å·¥ä½œå¯ä»¥ç”¨äº CosyVoice åœ¨å¤šè¯­è¨€ä¸Šï¼Œ Supervised speech tokenizer æ¨¡å—çš„è®­ç»ƒå’Œæ¨ç†ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2407.05407&#34;&gt;2024.7 &lt;strong&gt;CosyVoice: A Scalable Multilingual Zero-shot Text-to-speech Synthesizer based on Supervised Semantic Tokens&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2412.10117&#34;&gt;2024.12 CosyVoice 2: Scalable Streaming Speech Synthesis with Large Language Models&lt;/a&gt; ï¼ˆæµå¼åˆæˆï¼‰&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/FunAudioLLM/CosyVoice&#34;&gt;paper code&lt;/a&gt;: å…¬å¼€æ¨ç†å’Œæƒé‡ï¼Œåœ¨openslrå…¬å¼€æ•°æ®é›†è‹±æ–‡æ•°æ®é›†LibriSpeech å’Œä¸­æ–‡æ•°æ®é›† MAGICDATA å¯¹æ¨¡å‹è¿›è¡Œè®­ç»ƒä»£ç ï¼› æ— supervised Speech Tokenizer (å¯¹SenseVoice ASRçš„æ”¹é€ å¾®è°ƒ) å’ŒSpeaker Embedding model(context-aware masking CAM++) çš„è®­ç»ƒè¿‡ç¨‹ä»£ç ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åˆ›æ–°ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†ç›‘ç£è¯­éŸ³tokené›†æˆåˆ°TTS æ¨¡å‹ï¼Œå¢å¼ºäº†é›¶æ ·æœ¬è¯­éŸ³å…‹éš†ä¸­çš„å†…å®¹ä¸€è‡´æ€§å’Œè¯´è¯è€…ç›¸ä¼¼æ€§ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€ç§å¯æ‰©å±•çš„é›¶æ ·æœ¬ TTS åˆæˆç³»ç»Ÿï¼Œå®ƒå°†ç”¨äºæ–‡æœ¬åˆ°tokenç”Ÿæˆçš„ LLM ä¸ç”¨äºtokenåˆ°è¯­éŸ³åˆæˆçš„æ¡ä»¶æµåŒ¹é…æ¨¡å‹(conditional flow matching model(CFM))ç›¸ç»“åˆï¼Œä¸ä¾èµ–äºéŸ³ç´ æŒç»­æ—¶é—´é¢„æµ‹(Duration predictor)ï¼Œä¸éœ€è¦ä½¿ç”¨è¡¥å……éŸ³ç´ å™¨(phonemizers)å’Œå¼ºåˆ¶å¯¹é½å™¨aligners (æ¯”å¦‚ï¼šGlow-TTSä¸­ Monotonic Alignment Search(MAS))ã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºäº†è¿›ä¸€æ­¥ç»†åŒ–ç”Ÿæˆè¯­éŸ³çš„è´¨é‡ï¼Œå°† x-vector åˆå¹¶åˆ° LLM ä¸­ï¼Œå°†è¯­éŸ³å»ºæ¨¡åˆ†ä¸ºè¯­ä¹‰ã€è¯´è¯è€…å’ŒéŸµå¾‹(semantic, speaker, and prosody)ç»„ä»¶ã€‚ LLM å¯¹è¯­ä¹‰(semantic)å†…å®¹å’ŒéŸµå¾‹(prosody)è¿›è¡Œå»ºæ¨¡ï¼Œè€Œæ¡ä»¶æµåŒ¹é…æ¨¡å‹(CFM)åˆ™æ•è·éŸ³è‰²(timbre)å’Œç¯å¢ƒä¿¡æ¯ã€‚æˆ‘ä»¬ä½¿ç”¨&lt;strong&gt;Classifier-Free Guidance&lt;/strong&gt;(&lt;a href=&#34;https://arxiv.org/abs/2207.12598&#34;&gt;2022. &lt;strong&gt;Classifier-free diffusion guidance&lt;/strong&gt;&lt;/a&gt;)ã€ä½™å¼¦è°ƒåº¦å™¨(&lt;a href=&#34;https://d2l.ai/chapter_optimization/lr-scheduler.html#cosine-scheduler&#34;&gt;cosine scheduler&lt;/a&gt;)å’Œå±è”½æ¡ä»¶(masked conditions)ç­‰æŠ€æœ¯æ¥ä¼˜åŒ–æµåŒ¹é…è¿‡ç¨‹ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/3e8c1132-e146-4b73-8d0c-f3972bf7c8bd&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;CosyVoiceç”±å››ä¸ªç»„ä»¶ç»„æˆï¼Œå³æ–‡æœ¬ç¼–ç å™¨(text encoder)ã€è¯­éŸ³åˆ†è¯å™¨(speech tokenizer)ã€å¤§è¯­è¨€æ¨¡å‹(large language model)å’Œæ¡ä»¶æµåŒ¹é…æ¨¡å‹(conditional flow matching model)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡æœ¬ç¼–ç å™¨(text encoder)ç”¨äºå¯¹é½æ–‡æœ¬å’Œè¯­éŸ³tokençš„è¯­ä¹‰ç©ºé—´;&lt;/li&gt;
&lt;li&gt;è¯­éŸ³æ ‡è®°å™¨(speech tokenizer)ç”¨äºæå–è¯­ä¹‰token;&lt;/li&gt;
&lt;li&gt;LLM(GLM)å­¦ä¹ æ–‡æœ¬ç¼–ç å’Œè¯­éŸ³æ ‡è®°çš„æ•´ä¸ªåºåˆ—ï¼Œå°† TTS é‡æ–°è¡¨è¿°ä¸ºä»¥æ–‡æœ¬ä½œä¸ºæç¤ºçš„è‡ªå›å½’åºåˆ—ç”Ÿæˆé—®é¢˜;&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨æ¡ä»¶æµåŒ¹é…æ¨¡å‹(conditional flow matching model), é€šè¿‡æœ€ä¼˜è·¯å¾„ä¸Šçš„å»å™ªå¤„ç†,å°†è¯­éŸ³æ ‡è®°è½¬æ¢ä¸ºæ¢…å°”è°±å›¾(Mel spectrogram); é€šè¿‡&lt;strong&gt;Classifier-Free Guidance&lt;/strong&gt;ï¼ˆClassifier-free diffusion guidance CFGï¼‰æé«˜æ‰©æ•£æ¦‚ç‡æ¨¡å‹çš„ç”Ÿæˆè´¨é‡, å°†CFGé€‚åº”åˆ°æ¡ä»¶æµåŒ¹é…æ¨¡å‹ä¸­;&lt;/li&gt;
&lt;li&gt;è·å¾—äººç±»è€³æœµå¯æ„ŸçŸ¥çš„å£°éŸ³ä¿¡å·ï¼Œå£°ç å™¨(vocoder)ä½¿ç”¨ Hifi-GAN Generator ç”¨äºå°†ç”Ÿæˆçš„æ¢…å°”é¢‘è°±å›¾ä½œä¸ºè¾“å…¥æ¥åˆæˆæ³¢å½¢(waveform)ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;conditional flow matching model (OT-CFM) æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2309.03199&#34;&gt;2023.9 &lt;strong&gt;Matcha-TTS: A fast TTS architecture with conditional flow matching&lt;/strong&gt;&lt;/a&gt;(CFMçš„æ”¹è¿›ç‰ˆæœ¬OT-CFM)&lt;/li&gt;
&lt;li&gt;Classifier-free diffusion guidance (CFG) æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2207.12598&#34;&gt;2022. &lt;strong&gt;Classifier-free diffusion guidance&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;vocoder æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2010.05646&#34;&gt;2020. &lt;strong&gt;HiFi-GAN: Generative Adversarial Networks for Efficient and High Fidelity Speech Synthesis&lt;/strong&gt;&lt;/a&gt; Generatorã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é™„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¨ç†å’Œè®­ç»ƒæ“ä½œç¬”è®°ï¼š &lt;a href=&#34;https://github.com/weedge/doraemon-nb/blob/main/CosyVoice.ipynb&#34;&gt;https://github.com/weedge/doraemon-nb/blob/main/CosyVoice.ipynb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;achatbot æ¥å…¥ CosyVoice:
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/ai-bot-pro/achatbot/pull/21&#34;&gt;https://github.com/ai-bot-pro/achatbot/pull/21&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/ai-bot-pro/achatbot/pull/23&#34;&gt;https://github.com/ai-bot-pro/achatbot/pull/23&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/ai-bot-pro/achatbot/pull/107&#34;&gt;https://github.com/ai-bot-pro/achatbot/pull/107&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;supervised-semantic-tokens-for-speech-è¯­éŸ³çš„ç›‘ç£è¯­ä¹‰tokens&#34;&gt;Supervised Semantic Tokens for Speech è¯­éŸ³çš„ç›‘ç£è¯­ä¹‰tokens&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Supervised speech tokenizer&lt;/strong&gt;: ä½¿ç”¨ä¸€ä¸ªç›‘ç£è‡ªåŠ¨è¯­éŸ³è¯†åˆ«ï¼ˆASRï¼‰æ¨¡å‹æ¥æ´¾ç”Ÿç›‘ç£è¯­ä¹‰è¯­éŸ³tokenizer(Supervised speech tokenizer)ã€‚è¯¥æ¨¡å‹æ˜¯æˆ‘ä»¬ä¸“æœ‰çš„SenseVoice ASRæ¨¡å‹çš„ä¸€ä¸ªå¾®è°ƒç‰ˆæœ¬ã€‚å®ƒåœ¨å¤šè¯­è¨€éŸ³é¢‘æ•°æ®ä¸Šè¿›è¡Œè®­ç»ƒï¼Œå…·æœ‰ä¸°å¯Œçš„éŸ³é¢‘å†…å®¹ç†è§£èƒ½åŠ›ã€‚ä¸åŸå§‹ASRæ¨¡å‹ä¸åŒï¼Œæˆ‘ä»¬å°†ç¼–ç å™¨åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå¹¶åœ¨å®ƒä»¬ä¹‹é—´æ’å…¥ä¸€ä¸ªå‘é‡é‡åŒ–å±‚ã€‚ç»™å®šä¸€ä¸ªæ¢…å°”é¢‘è°±å›¾ X ä½œä¸ºè¾“å…¥ï¼Œå®ƒé¦–å…ˆç»è¿‡ä½ç½®ç¼–ç å’Œ $Encoder_1$ä»¥è·å¾—ä¸Šä¸‹æ–‡æ„ŸçŸ¥è¡¨ç¤º H ï¼š
$$
H = \text{Encoder}_1(\text{PosEnc}(X))
$$&lt;/p&gt;
&lt;p&gt;ç„¶åï¼Œå‘é‡é‡åŒ–å™¨ï¼ˆVQï¼‰è¢«ç”¨æ¥è·å¾—ç¦»æ•£æ ‡è®°ã€‚å¯¹äºç¬¬ l å¸§çš„éšè—è¡¨ç¤º $h_l$ ï¼Œç æœ¬ C ä¸­æœ€è¿‘é‚»åµŒå…¥çš„ç´¢å¼•è¢«è§†ä¸ºè¯¥æ—¶é—´æ­¥çš„è¯­éŸ³token $\mu_l$ ï¼š
$$
\mu_l = \text{VQ}(h_l, C) = \arg \min_{c_n \in C} | h_l - c_n |_2
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ $|\cdot |_2$  è¡¨ç¤ºL2èŒƒæ•°ï¼ˆL2 normï¼Œä¹Ÿç§°ä¸ºæ¬§å‡ é‡Œå¾—èŒƒæ•°æˆ–æ¬§å‡ é‡Œå¾—è·ç¦»ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è®­ç»ƒé˜¶æ®µï¼Œç æœ¬åµŒå…¥é€šè¿‡æŒ‡æ•°ç§»åŠ¨å¹³å‡ï¼ˆEMAï¼‰è¿›è¡Œæ›´æ–°ï¼š
$$
c_{\mu_l} := \alpha c_{\mu_l} + (1 - \alpha) h_l
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ $\alpha$ æ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„è¡°å‡ç³»æ•°ã€‚ç›¸åº”çš„è¯­éŸ³tokençš„ç æœ¬åµŒå…¥è¢«ç”¨ä½œé‡åŒ–åçš„éšè—è¡¨ç¤º
$ \bar{H} = { c_{\mu_1}, c_{\mu_2}, \ldots, c_{\mu_L} }$ ï¼Œå¹¶ä¼ é€’ç»™å‰©ä½™çš„ç¼–ç å™¨å±‚$Encoder_2$ï¼š
$$
\tilde{H} = \text{Encoder}_2(\text{PosEnc}(\bar{H}))
$$&lt;/p&gt;
&lt;p&gt;åœ¨å‰©ä½™çš„ç¼–ç å™¨å±‚ä¹‹å‰ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªé¢å¤–çš„ä½ç½®ç¼–ç ï¼Œä»¥å¢å¼ºæ—¶é—´ä¿¡æ¯ã€‚ç»è¿‡$Encoder_2$åï¼Œè·Ÿéšä¸€ä¸ªåŸºäºTransformerçš„ASRè§£ç å™¨ï¼Œé¢„æµ‹æ–‡æœ¬æ ‡ç­¾(labels)çš„åéªŒæ¦‚ç‡ï¼š
$$
P(Y | X) = \text{ASRDecoder}(\tilde{H}, Y^{Z-1})
$$
å…¶ä¸­ $Y^{Z-1}$ è¡¨ç¤ºåœ¨æ•™å¸ˆå¼ºåˆ¶è®­ç»ƒæ–¹æ¡ˆä¸­å·¦ç§»çš„æ–‡æœ¬æ ‡ç­¾ã€‚&lt;/p&gt;
&lt;h3 id=&#34;large-language-model-for-tts-ç”¨äºttsçš„å¤§å‹è¯­è¨€æ¨¡å‹&#34;&gt;Large Language Model for TTS ç”¨äºTTSçš„å¤§å‹è¯­è¨€æ¨¡å‹&lt;/h3&gt;
&lt;p&gt;å°†æ–‡æœ¬åˆ°è¯­éŸ³ï¼ˆTTSï¼‰ä»»åŠ¡é‡æ–°å®šä¹‰ä¸ºä¸€ä¸ªè‡ªå›å½’è¯­éŸ³tokenç”Ÿæˆé—®é¢˜ï¼Œå¹¶ä½¿ç”¨å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æ¥è§£å†³ã€‚å¯¹äºLLMï¼Œåºåˆ—çš„æ„å»ºè‡³å…³é‡è¦ï¼Œå…·ä½“æ„å»ºæ–¹å¼å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;$$
S, v, {\bar{y}_u}|{u\in[1:U]}, T, {\mu_l}|{l\in[1:L]}, E
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;S å’Œ E åˆ†åˆ«è¡¨ç¤ºåºåˆ—çš„å¼€å§‹å’Œç»“æŸã€‚&lt;/li&gt;
&lt;li&gt;v æ˜¯ä»è¯­éŸ³ X ä¸­æå–çš„è¯´è¯äººåµŒå…¥å‘é‡ï¼Œä½¿ç”¨é¢„è®­ç»ƒçš„å£°çº¹æ¨¡å‹(voice-print model),æ¥è‡ª: &lt;a href=&#34;https://github.com/modelscope/3D-Speaker/tree/main/egs/3dspeaker/sv-cam++&#34;&gt;https://github.com/modelscope/3D-Speaker/tree/main/egs/3dspeaker/sv-cam++&lt;/a&gt; | &lt;a href=&#34;https://arxiv.org/abs/2305.12838&#34;&gt;An Enhanced Res2Net with Local and Global Feature Fusion for Speaker Verification&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ–‡æœ¬ç¼–ç  $\bar{Y}={\bar{y}_u}, u\in[1:U] $ å°†æ–‡æœ¬é€šè¿‡å­—èŠ‚å¯¹ç¼–ç (BPE)tokenizerå’Œæ–‡æœ¬ç¼–ç å™¨(TextEncoder)è·å¾—ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;$$
\bar{Y} = \text{TextEncoder}(\text{BPE}(Y))
$$&lt;/p&gt;
&lt;p&gt;ç”±äºæ–‡æœ¬å’Œè¯­éŸ³tokenä½äºä¸åŒçš„è¯­ä¹‰å±‚æ¬¡ï¼Œæ–‡æœ¬ç¼–ç å™¨ç”¨äºå¯¹é½å®ƒä»¬çš„è¯­ä¹‰ç©ºé—´ï¼Œä»è€Œæœ‰åˆ©äºLLMçš„å»ºæ¨¡ã€‚åœ¨æ–‡æœ¬ç¼–ç å’Œè¯­éŸ³token ${\mu_l}_{l \in [1:L]}$ ä¹‹é—´æ’å…¥ä¸€ä¸ªèµ·å§‹æ ‡è¯†ç¬¦ T ï¼Œè¯­éŸ³tokenæ˜¯ä½¿ç”¨è¯­éŸ³çš„ç›‘ç£è¯­ä¹‰æ ‡è®°å™¨(Supervised Semantic Speech Tokenizer)æå–çš„ã€‚åœ¨è®­ç»ƒé˜¶æ®µï¼Œé‡‡ç”¨æ•™å¸ˆå¼ºåˆ¶æ–¹æ¡ˆï¼Œå…¶ä¸­å·¦ç§»åºåˆ—ä½œä¸ºæ¨¡å‹è¾“å…¥ï¼ŒåŸå§‹åºåˆ—ä½œä¸ºæœŸæœ›è¾“å‡ºã€‚æ³¨æ„ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œåªæœ‰è¯­éŸ³tokenå’Œ E çš„äº¤å‰ç†µæŸå¤±è¢«è€ƒè™‘ï¼š&lt;/p&gt;
&lt;p&gt;$$
\text{LLM} = - \frac{1}{L + 1} \sum_{l=1}^{L+1} \log q(\mu_l)
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ $\mu_{L+1}$ æ˜¯â€œåºåˆ—ç»“æŸâ€token E ã€‚ $q(\mu_l)$ è¡¨ç¤ºç”±LLMçš„softmaxå±‚é¢„æµ‹çš„ $\mu_l$ çš„åéªŒæ¦‚ç‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;optimal-transport-conditional-flow-matching-æœ€ä¼˜ä¼ è¾“æ¡ä»¶æµåŒ¹é…&#34;&gt;Optimal-transport Conditional Flow Matching æœ€ä¼˜ä¼ è¾“æ¡ä»¶æµåŒ¹é…&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨æœ€ä¼˜ä¼ è¾“æ¡ä»¶æµåŒ¹é…æ¨¡å‹ï¼ˆOT-CFMï¼‰æ¥å­¦ä¹ æ¢…å°”é¢‘è°±å›¾çš„åˆ†å¸ƒï¼Œå¹¶ä»¥ç”Ÿæˆçš„è¯­éŸ³æ ‡è®°ä¸ºæ¡ä»¶ç”Ÿæˆæ ·æœ¬ã€‚ä¸æ‰©æ•£æ¦‚ç‡æ¨¡å‹ï¼ˆDPMsï¼‰ç›¸æ¯”ï¼ŒOT-CFMå…·æœ‰æ›´ç®€å•çš„æ¢¯åº¦ã€æ›´å®¹æ˜“çš„è®­ç»ƒå’Œæ›´å¿«çš„ç”Ÿæˆé€Ÿåº¦ã€‚
è¿™åœ¨è®ºæ–‡ï¼š&lt;a href=&#34;https://arxiv.org/abs/2210.02747&#34;&gt;2022.10 Flow matching for generative modeling&lt;/a&gt; | &lt;a href=&#34;https://arxiv.org/abs/2302.00482&#34;&gt;2023.2 Improving and generalizing flow-based generative models with minibatch optimal transport&lt;/a&gt; | &lt;a href=&#34;https://arxiv.org/abs/2309.03199&#34;&gt;2023.9 &lt;strong&gt;Matcha-TTS: A fast TTS architecture with conditional flow matching&lt;/strong&gt;&lt;/a&gt; ä¸­å·²ç»ç ”ç©¶è¿‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿ç»­æ—¶é—´æ­£è§„åŒ–æµï¼ˆCNFsï¼‰ä¸­ï¼Œä»å…ˆéªŒåˆ†å¸ƒ $p_0(X)$ åˆ°æ¢…å°”é¢‘è°±å›¾æ•°æ®åˆ†å¸ƒ $q(X)$ æ„å»ºä¸€ä¸ªæ¦‚ç‡å¯†åº¦è·¯å¾„ã€‚è¿™ä¸ªæ¦‚ç‡å¯†åº¦è·¯å¾„ç”±ä¸€ä¸ªæ—¶é—´ä¾èµ–çš„å‘é‡åœº $\nu_t(X)$ å®šä¹‰ï¼Œé€šè¿‡ä»¥ä¸‹å¸¸å¾®åˆ†æ–¹ç¨‹ï¼ˆODEï¼‰ç”Ÿæˆæµ $\phi_t$ ï¼š&lt;/p&gt;
&lt;p&gt;$$
\frac{d}{dt} \phi_t(X) = \nu_t(\phi_t(X), t)
\phi_0(X) \sim p_0(X) = N(X; 0, I)
\phi_1(X) \sim p_1(X)
$$&lt;/p&gt;
&lt;p&gt;é€šè¿‡æ±‚è§£åˆå€¼é—®é¢˜ï¼Œå¯ä»¥ç”¨ $p_1(X)$ è¿‘ä¼¼è¯­éŸ³åˆ†å¸ƒ $q(X)$ å¹¶ä»ä¸­é‡‡æ ·ã€‚ä¸ºäº†å­¦ä¹ å‘é‡åœº $\nu_t(X)$ ï¼Œæˆ‘ä»¬å®šä¹‰æœ€ä¼˜ä¼ è¾“ï¼ˆOTï¼‰æµï¼Œå¹¶é€šè¿‡æœ€å°åŒ–ä»¥ä¸‹æŸå¤±å‡½æ•°ä½¿ç¥ç»ç½‘ç»œåŒ¹é…å®ƒï¼š&lt;/p&gt;
&lt;p&gt;$$
L_{OT-CFM}\ = \mathbb{E}_{t, p_0(X_0),\ q(X_1)} \left[ \left| \omega_t(\phi_{OT}^t(X_0, X_1) | X_1) - \nu_t(\phi_{OT}^t(X_0, X_1) | \theta) \right| \right]
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼š
$$
\phi_{OT}^t(X_0, X_1) = (1 - (1 - \sigma)t)X_0 + tX_1
\omega_t(\phi_{OT}^t(X_0, X_1) | X_1) = X_1 - (1 - \sigma)X_0
$$&lt;/p&gt;
&lt;p&gt;è¯´è¯äººåµŒå…¥ v ã€è¯­éŸ³æ ‡è®° ${\mu_l}_{1:L}$ å’Œæ©ç æ¢…å°”é¢‘è°±å›¾ $\tilde{X}_1$ ä¹Ÿè¢«è¾“å…¥åˆ°ç¥ç»ç½‘ç»œä¸­ï¼Œä»¥åŒ¹é…å¸¦æœ‰å¯å­¦ä¹ å‚æ•° $\theta$ çš„å‘é‡åœºï¼š&lt;/p&gt;
&lt;p&gt;$$
\nu_t(\phi_{OT}^t(X_0, X_1) | \theta) = \text{NN}_\theta \left( \phi_{OT}^t(X_0, X_1), t; v, {\mu_l}_{1:L}, \tilde{X}_1 \right)
$$&lt;/p&gt;
&lt;p&gt;æ©ç æ¢…å°”é¢‘è°±å›¾ $\tilde{X}_1$ æ˜¯é€šè¿‡ä»éšæœºèµ·ç‚¹åˆ°ç»“æŸè¿ç»­å¸§è®¾ä¸ºé›¶å¾—åˆ°çš„ã€‚è€ƒè™‘åˆ°ç”Ÿæˆè¿‡ç¨‹åœ¨å¼€å§‹æ—¶æ¯”åç»­æ›´éš¾ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªä½™å¼¦è°ƒåº¦å™¨æ¥è°ƒæ•´æ—¶é—´æ­¥ t ï¼š&lt;/p&gt;
&lt;p&gt;$$
t := 1 - \cos \left(\frac{t\pi}{2}\right)
$$&lt;/p&gt;
&lt;p&gt;åœ¨è°ƒåº¦çš„æµä¸‹ï¼Œå¼€å§‹æ—¶æœ‰æ›´å¤šçš„ç”Ÿæˆæ­¥éª¤ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Classifier-Free Guidance&lt;/strong&gt;ï¼ˆClassifier-free diffusion guidance CFGï¼‰å·²è¢«è¯æ˜å¯ä»¥æé«˜æ‰©æ•£æ¦‚ç‡æ¨¡å‹çš„ç”Ÿæˆè´¨é‡ã€‚
åœ¨è®ºæ–‡ï¼š&lt;a href=&#34;https://arxiv.org/abs/2102.09672&#34;&gt;2021. &lt;strong&gt;Improved denoising diffusion probabilistic models&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://arxiv.org/abs/2207.12598&#34;&gt;2022. &lt;strong&gt;Classifier-free diffusion guidance&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://arxiv.org/abs/2306.15687&#34;&gt;2023. Voicebox: Text-guided multilingual universal speech generation at scale&lt;/a&gt; ä¸­å·²ç»ç ”ç©¶è¿‡ã€‚
å› æ­¤ï¼Œæå‡ºå°†CFGé€‚åº”åˆ°æ¡ä»¶æµåŒ¹é…æ¨¡å‹ä¸­ã€‚åœ¨è®­ç»ƒé˜¶æ®µï¼Œä»¥å›ºå®šæ¦‚ç‡0.2éšæœºä¸¢å¼ƒæ¡ä»¶ $\Psi = {v, {\mu_l}_{1:L}, \tilde{X}_1}$ ã€‚ä»¥è¿™ç§æ–¹å¼ï¼Œå¯ä»¥å­¦ä¹ æ¡ä»¶å’Œæ— æ¡ä»¶æµã€‚åœ¨ç”ŸæˆæœŸé—´ï¼Œå‘é‡åœºè¢«ä¿®æ”¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;$$
\tilde{\nu}_t(\phi_{OT}^t(X_0, X_1)|\theta; \Psi)=(1+\beta)\cdot \nu_t(\phi_{OT}^t(X_0, X_1)|\theta;\Psi) -\beta \cdot \nu_t(\phi_{OT}^t(X_0, X_1) | \theta)
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ $\beta$ æ˜¯æŒ‡å¯¼å¼ºåº¦ï¼Œå–å€¼ä¸º0.7ã€‚&lt;/p&gt;
&lt;h3 id=&#34;zero-shot-in-context-learning-é›¶æ ·æœ¬ä¸Šä¸‹æ–‡å­¦ä¹ &#34;&gt;Zero-shot In-context Learning é›¶æ ·æœ¬ä¸Šä¸‹æ–‡å­¦ä¹ &lt;/h3&gt;
&lt;p&gt;è¿™ç§é›¶æ ·æœ¬ä¸Šä¸‹æ–‡å­¦ä¹ èƒ½åŠ›ä½¿å¾—CosyVoiceèƒ½å¤Ÿåœ¨æ²¡æœ‰ç›®æ ‡è¯´è¯äººçš„å¤§é‡æ ·æœ¬çš„æƒ…å†µä¸‹ï¼Œç”Ÿæˆé«˜è´¨é‡çš„è¯­éŸ³ï¼Œè¿™å¯¹äºä¸ªæ€§åŒ–è¯­éŸ³åˆæˆå’Œå¤šè¯­è¨€åº”ç”¨å…·æœ‰é‡è¦æ„ä¹‰ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¨¡å‹èƒ½å¤Ÿå¿«é€Ÿé€‚åº”æ–°çš„è¯´è¯äººå’Œè¯­è¨€ï¼Œæä¾›æ›´åŠ è‡ªç„¶å’Œä¸€è‡´çš„è¯­éŸ³è¾“å‡ºã€‚&lt;/p&gt;
&lt;p&gt;CosyVoiceæ¨¡å‹å±•ç¤ºäº†é›¶æ ·æœ¬ä¸Šä¸‹æ–‡å­¦ä¹ çš„èƒ½åŠ›ï¼Œå…è®¸ä»…ä½¿ç”¨ç®€çŸ­çš„å‚è€ƒè¯­éŸ³æ ·æœ¬å¤åˆ¶ä»»æ„å£°éŸ³ã€‚è¿™ä¸€è¿‡ç¨‹æ¶‰åŠç²¾å¿ƒæ„å»ºè¾“å…¥åºåˆ—ä»¥ä¾›token è¯­è¨€æ¨¡å‹ï¼ˆLMï¼‰ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æ„å»ºè¾“å…¥åºåˆ—å¦‚å›¾æ‰€ç¤ºï¼š
&lt;img src=&#34;https://github.com/user-attachments/assets/a4391621-c996-414b-b5a1-0bc55b99ed4e&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äºæç¤ºè¯­éŸ³(prompt speech)å’Œè¾“å…¥æ–‡æœ¬(input text)ä½¿ç”¨ç›¸åŒè¯­è¨€çš„æƒ…å†µï¼Œå°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªç»Ÿä¸€çš„è¾“å…¥ï¼Œå°†æç¤ºè¯­éŸ³tokenè§†ä¸ºé¢„å…ˆç”Ÿæˆçš„ã€‚é€šè¿‡è¿™ç§è¾“å…¥åºåˆ—ï¼Œè‡ªå›å½’LMè¿­ä»£é¢„æµ‹åç»­tokenï¼Œç›´åˆ°é‡åˆ°â€œåºåˆ—ç»“æŸâ€æ ‡è®° Eã€‚&lt;/li&gt;
&lt;li&gt;å½“æç¤ºè¯­éŸ³(prompt speech)å’Œè¾“å…¥æ–‡æœ¬(input text)åœ¨è¯­è¨€ä¸Šä¸åŒæ—¶ï¼Œçœç•¥ä¸æç¤ºç›¸å…³çš„æ–‡æœ¬(prompt text)å’Œtokens (prompt speech token)ï¼Œä»¥é˜²æ­¢åŸå§‹è¯­è¨€çš„éŸµå¾‹ç‰¹å¾(prosodic characteristics)å½±å“ç›®æ ‡è¯­è¨€ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæç¤ºæ–‡æœ¬ï¼ˆå¯¹åº”äºæç¤ºè¯­éŸ³çš„å†…å®¹ï¼‰å¯ä»¥é€šè¿‡äººå·¥æ ‡æ³¨æˆ–ASRæ¨¡å‹ï¼ˆå¦‚SenseVoiceï¼‰è¿›è¡Œè½¬å½•ã€‚ä¸æç¤ºæ–‡æœ¬ç±»ä¼¼ï¼Œprompt speech tokenæ˜¯ä½¿ç”¨ supervised semantic speech ($S^3$) tokenizer ä»æç¤ºè¯­éŸ³ä¸­æå–çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”Ÿæˆspeech tokenåï¼Œå°†å®ƒä»¬é™„åŠ åˆ°prompt tokensä¹‹åï¼Œå½¢æˆæµåŒ¹é…æ¨¡å‹çš„å¤åˆæ¡ä»¶ã€‚æ­¤å¤–ï¼Œè¿˜çº³å…¥äº†prompt speechçš„è¯´è¯äººåµŒå…¥(speaker embedding)å’Œæ¢…å°”é¢‘è°±å›¾(Mel spectrogram)ï¼Œä»¥è¿›ä¸€æ­¥å¢å¼ºéŸ³è‰²(timbre)å’Œç¯å¢ƒçš„ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;PS: å¼•å…¥æç¤ºè¯­éŸ³å’Œæ–‡æœ¬ï¼Œè¿›è¡Œé›¶æ ·æœ¬ä¸Šä¸‹æ–‡å­¦ä¹ ï¼Œä¹Ÿä¸ºåç»­speech to speechå­¦ä¹ æä¾›å‚è€ƒæ–¹æ³•&lt;/p&gt;
&lt;h3 id=&#34;rich-generation-with-instruction-å¸¦æŒ‡ä»¤çš„ä¸°å¯Œç”Ÿæˆ&#34;&gt;Rich Generation with Instruction å¸¦æŒ‡ä»¤çš„ä¸°å¯Œç”Ÿæˆ&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†è¿›ä¸€æ­¥å¢å¼ºCosyVoiceçš„å¯æ§æ€§ï¼Œæˆ‘ä»¬å°è¯•æ•´åˆé¢å¤–çš„æŒ‡ä»¤å¾®è°ƒã€‚CosyVoice-instructåœ¨CosyVoice-baseçš„åŸºç¡€ä¸Šè¿›è¡Œäº†æ‰©å±•ï¼Œå¢å¼ºäº†å¯¹æŒ‡ä»¤çš„éµå¾ªèƒ½åŠ›ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒæ”¯æŒå¯¹å¤šä¸ªæ–¹é¢çš„æ§åˆ¶ï¼ŒåŒ…æ‹¬è¯´è¯äººèº«ä»½ï¼ˆå³è¯´è¯äººçš„ç‰¹å¾ï¼‰ã€è¯´è¯é£æ ¼ï¼ˆåŒ…æ‹¬æƒ…æ„Ÿã€æ€§åˆ«ã€è¯­é€Ÿå’ŒéŸ³é«˜ï¼‰ä»¥åŠç»†ç²’åº¦çš„å‰¯è¯­è¨€ç‰¹å¾ã€‚è¿™äº›ç‰¹å¾åŒ…æ‹¬æ’å…¥ç¬‘å£°ã€å‘¼å¸å£°ã€è¾¹ç¬‘è¾¹è¯´ä»¥åŠå¼ºè°ƒæŸäº›è¯æ±‡çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨ä¸åŒ…å«è¯´è¯äººåµŒå…¥çš„è‡ªå›å½’è¯­è¨€æ¨¡å‹çš„è®­ç»ƒæ•°æ®å¯¹CosyVoice-baseè¿›è¡Œäº†å¾®è°ƒã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ç±»åˆ«&lt;/th&gt;
&lt;th&gt;ç¤ºä¾‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Speaker Identity&lt;/td&gt;
&lt;td&gt;1. Selene â€™Moonshadeâ€™, is a mysterious, elegant dancer with a connection to the night. Her movements are both mesmerizing and deadly.&lt;!-- raw HTML omitted --&gt;Hope is a good thing. &lt;!-- raw HTML omitted --&gt; 2. Theo â€™Crimsonâ€™, is a fiery, passionate rebel leader. Fights with fervor for justice, but struggles with impulsiveness.&lt;!-- raw HTML omitted --&gt;You donâ€™t know about real loss&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç±»åˆ«ç¤ºä¾‹è¯´è¯äººèº«ä»½&lt;/td&gt;
&lt;td&gt;1. Selene â€˜Moonshadeâ€™ï¼Œæ˜¯ä¸€ä½ç¥ç§˜ã€ä¼˜é›…çš„èˆè€…ï¼Œä¸å¤œæ™šæœ‰ç€ç¥ç§˜çš„è”ç³»ã€‚å¥¹çš„åŠ¨ä½œæ—¢è¿·äººåˆè‡´å‘½ã€‚&lt;!-- raw HTML omitted --&gt;å¸Œæœ›æ˜¯ç¾å¥½çš„ä¸œè¥¿ã€‚&lt;!-- raw HTML omitted --&gt;2. Theo â€˜Crimsonâ€™ï¼Œæ˜¯ä¸€ä½çƒ­æƒ…ã€æ¿€è¿›çš„å›å†›é¢†è¢–ã€‚ä»–ä¸ºæ­£ä¹‰è€Œæˆ˜ï¼Œå……æ»¡çƒ­æƒ…ï¼Œä½†æœ‰æ—¶ä¼šå†²åŠ¨ã€‚&lt;!-- raw HTML omitted --&gt;ä½ ä¸çŸ¥é“çœŸæ­£çš„å¤±è½æ˜¯ä»€ä¹ˆã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Speaking Style&lt;/td&gt;
&lt;td&gt;1. A happy girl with high tone and quick speech.&lt;!-- raw HTML omitted --&gt;The sun is shining brightly today.&lt;!-- raw HTML omitted --&gt;2. A sad woman with normal tone and slow speaking speed.&lt;!-- raw HTML omitted --&gt;I failed my important exam.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è¯´è¯é£æ ¼&lt;/td&gt;
&lt;td&gt;1. ä¸€ä¸ªå¿«ä¹çš„å¥³å­©ï¼Œè¯­è°ƒé«˜ï¼Œè¯­é€Ÿå¿«ã€‚&lt;!-- raw HTML omitted --&gt;ä»Šå¤©é˜³å…‰æ˜åªšã€‚&lt;!-- raw HTML omitted --&gt;2. ä¸€ä¸ªæ‚²ä¼¤çš„å¥³æ€§ï¼Œè¯­è°ƒæ­£å¸¸ï¼Œè¯­é€Ÿæ…¢ã€‚&lt;!-- raw HTML omitted --&gt;æˆ‘é‡è¦çš„è€ƒè¯•æ²¡é€šè¿‡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Fine-grained Paralinguistics&lt;/td&gt;
&lt;td&gt;1. Well thatâ€™s kind of scary [laughter].&lt;!-- raw HTML omitted --&gt;2. I donâ€™t think I over eat yeah [breath] and um I do exercise regularly.&lt;!-- raw HTML omitted --&gt;3. Well that pretty much covers &lt;!-- raw HTML omitted --&gt;the subject&lt;!-- raw HTML omitted --&gt; well thanks for calling me. &lt;!-- raw HTML omitted --&gt;4. The teamâ€™s &lt;!-- raw HTML omitted --&gt;unity&lt;!-- raw HTML omitted --&gt; and &lt;!-- raw HTML omitted --&gt;resilience&lt;!-- raw HTML omitted --&gt; helped them win the championship&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç»†ç²’åº¦å‰¯è¯­è¨€&lt;/td&gt;
&lt;td&gt;1. å¥½å§ï¼Œè¿™æœ‰ç‚¹å“äºº[ç¬‘å£°]ã€‚&lt;!-- raw HTML omitted --&gt;2. æˆ‘ä¸è®¤ä¸ºæˆ‘åƒå¾—è¿‡å¤šï¼Œæ˜¯çš„[å‘¼å¸]ï¼Œè€Œä¸”æˆ‘ç¡®å®å®šæœŸé”»ç‚¼ã€‚&lt;!-- raw HTML omitted --&gt;3. å¥½å§ï¼Œè¿™åŸºæœ¬ä¸Šæ¶µç›–äº†&amp;lt;ç¬‘å£°&amp;gt;è¿™ä¸ªè¯é¢˜&lt;!-- raw HTML omitted --&gt;ï¼Œå¥½å§ï¼Œè°¢è°¢ä½ æ‰“ç”µè¯ç»™æˆ‘ã€‚&lt;!-- raw HTML omitted --&gt;4. å›¢é˜Ÿçš„&lt;!-- raw HTML omitted --&gt;å›¢ç»“&lt;!-- raw HTML omitted --&gt;å’Œ&lt;!-- raw HTML omitted --&gt;éŸ§æ€§&lt;!-- raw HTML omitted --&gt;å¸®åŠ©ä»–ä»¬èµ¢å¾—äº†å† å†›ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;é€šè¿‡è¿™ç§æŒ‡ä»¤å¾®è°ƒï¼ŒCosyVoiceèƒ½å¤Ÿæ ¹æ®ç»™å®šçš„æŒ‡ä»¤ç”Ÿæˆæ›´åŠ ä¸°å¯Œå’Œå¤šæ ·åŒ–çš„è¯­éŸ³ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯ä¸‹çš„éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šç”Ÿæˆä¸€ä¸ªå¿«ä¹çš„å¥³å­©çš„å£°éŸ³ï¼Œæˆ–è€…åœ¨è¯­éŸ³ä¸­æ’å…¥ç¬‘å£°ï¼Œä½¿ç”Ÿæˆçš„è¯­éŸ³æ›´åŠ è‡ªç„¶å’Œç”ŸåŠ¨ã€‚è¿™ç§å¯æ§æ€§ä¸ä»…æé«˜äº†è¯­éŸ³åˆæˆçš„çµæ´»æ€§ï¼Œè¿˜ä¸ºä¸ªæ€§åŒ–è¯­éŸ³åˆæˆå’Œå¤šè¯­è¨€åº”ç”¨æä¾›äº†æ›´å¹¿æ³›çš„å¯èƒ½æ€§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;datasets-æ•°æ®é›†&#34;&gt;Datasets æ•°æ®é›†&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/1904.02882&#34;&gt;Libritts: A corpus derived from librispeech for text-to-speech&lt;/a&gt; (å°è§„æ¨¡å•è¯­è¨€æ•°æ®é›†, åº”è¯¥æ˜¯ç”¨æ¥å¿«é€ŸéªŒè¯çš„) | &lt;a href=&#34;https://www.openslr.org/60/&#34;&gt;https://www.openslr.org/60/&lt;/a&gt; : è¯¥è¯­æ–™åº“åŒ…å« 2,456 åè‹±è¯­ä½¿ç”¨è€…çš„ 585 å°æ—¶; å…¶ä¸­â€œtrain-clean-100â€ã€â€œtrain-clean-360â€å’Œâ€œtrain-other-500â€åˆå¹¶è¿›è¡Œè®­ç»ƒ(train)ï¼Œâ€œdev-cleanâ€ç”¨äºæ¨¡å‹é€‰æ‹©ã€‚ â€œtest-cleanâ€ç”¨äºæ„å»ºè¯„ä¼°é›†ï¼ˆvalï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;éå…¬å¼€æ•°æ®ï¼Œå†…éƒ¨é‡‡é›†ï¼Œåˆ©ç”¨ä¸“é—¨çš„å†…éƒ¨å·¥å…·è¿›è¡Œè¯­éŸ³æ£€æµ‹ã€ä¿¡å™ªæ¯” (SNR) ä¼°è®¡ã€è¯´è¯äººäºŒå€¼åŒ–å’Œåˆ†ç¦»ã€‚éšåï¼Œä½¿ç”¨ SenseVoice-Large å’Œ Paraformer ç”Ÿæˆä¼ªæ–‡æœ¬æ ‡ç­¾ã€‚è¿™äº›æ ‡ç­¾åœ¨å¼ºåˆ¶å¯¹é½ (force-alignment FA) æ¨¡å‹çš„å¸®åŠ©ä¸‹ç»å†äº†ç»†åŒ–è¿‡ç¨‹ï¼Œè¿™æœ‰åŠ©äºæ¶ˆé™¤ä½è´¨é‡æ•°æ®å¹¶æé«˜æ ‡ç‚¹ç¬¦å·çš„å‡†ç¡®æ€§ã€‚(å¤§è§„æ¨¡å¤šè¯­è¨€æ•°æ®é›†ï¼Œè¿›è¡Œscalingï¼Œæ¯•ç«Ÿç»“åˆLLMæ¨¡å‹å‚æ•°å˜å¤§äº†)ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;PS: è¿™é‡Œè¿˜æ˜¯ç”¨äº†&lt;a href=&#34;https://arxiv.org/abs/2010.11567&#34;&gt;AISHELL-3: A Multi-speaker Mandarin TTS Corpus and the Baselines&lt;/a&gt; ä½œä¸ºè¯„ä¼°æ•°æ®é›†æ¥è¯„ä¼°æ¨¡å‹çš„ç”Ÿæˆè´¨é‡ã€‚&lt;/p&gt;
&lt;p&gt;å¤§è§„æ¨¡å¤šè¯­è¨€æ•°æ®é›†æ—¶é•¿å’Œå¯¹åº”æŒ‡ä»¤ç±»å‹æ—¶é•¿ç»Ÿè®¡:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/fb02e823-bb65-4299-8314-088d1963a56e&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;å®éªŒè®¾ç½®&#34;&gt;å®éªŒè®¾ç½®&lt;/h2&gt;
&lt;h3 id=&#34;supervised-semantic-speech-tokenizer&#34;&gt;Supervised Semantic Speech Tokenizer&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºå°è§„æ¨¡å•è¯­è¨€æ•°æ®é›†ï¼ˆLibrispeechæ•°æ®é›†ï¼‰ï¼›é‡‡ç”¨ ESPNet Conformer ASR æ¨¡å‹ä½œä¸ºä¸»å¹²ï¼›Speech Tokenizer ç”±å‰å…­ä¸ªç¼–ç å™¨å±‚å’ŒVQç»„æˆï¼›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;VQå•ä¸ªç æœ¬åŒ…å« 4,096 ä¸ªcodeã€‚åœ¨Librispeechæ•°æ®é›†ä¸Šä»å¤´å¼€å§‹ 50 ä¸ª epoch è®­ç»ƒé‡åŒ–å™¨å¢å¼ºçš„ ASR æ¨¡å‹ã€‚&lt;/li&gt;
&lt;li&gt;Text Tokenizer: åœ¨è®­ç»ƒæ–‡æœ¬ä¸Šè®­ç»ƒå•è¯å¥å­æ¨¡å‹ï¼Œå…¶è¯æ±‡é‡ä¸º 4,000ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºå¤§è§„æ¨¡å¤šè¯­è¨€æ•°æ®é›†ï¼ˆå†…éƒ¨é‡‡é›†å¤„ç†çš„æ•°æ®é›†ï¼‰ï¼›é‡‡ç”¨SenseVoice-Largeä¸°å¯Œçš„è¯†åˆ«æ¨¡å‹ä½œä¸ºéª¨å¹²ï¼›Speech Tokenizer ä¹Ÿç”±å‰å…­ä¸ªç¼–ç å™¨å±‚å’ŒVQç»„æˆï¼›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;VQåŒ…å« 4,096 ä¸ªcodeçš„å•ä¸ªç æœ¬ã€‚ä¸å•è¯­è¨€å®éªŒä¸åŒï¼Œä½¿ç”¨é¢„è®­ç»ƒçš„æ£€æŸ¥ç‚¹æ¥åˆå§‹åŒ–SenseVoice-Largeæ¨¡å‹ï¼Œè€Œä¸æ˜¯ä»å¤´å¼€å§‹è®­ç»ƒã€‚åŠ å…¥VQåï¼Œè¿›ä¸€æ­¥å¾®è°ƒäº† 8 ä¸ª A800 GPU ä¸Š 210,000 ä¸ªè®­ç»ƒæ­¥éª¤(steps)çš„æ•´ä½“å‚æ•°ã€‚&lt;/li&gt;
&lt;li&gt;Text Tokenizer ä½¿ç”¨åŸæœ‰æ¨¡å‹ä¸­è‡ªå¸¦çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;SenseVoice æ¨¡å‹ç»“æ„ï¼ˆsmall Transformer Encoder, large Transformer Encoder-Decoderï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/b1da07c1-29c2-41b9-824b-b190baec33d3&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;cosyvoice-æ¨¡å‹è®¾ç½®&#34;&gt;CosyVoice æ¨¡å‹è®¾ç½®&lt;/h3&gt;
&lt;p&gt;åœ¨å•è¯­è¨€å’Œå¤šè¯­è¨€å®éªŒä¸­è®­ç»ƒå¾®å°å’Œæ­£å¸¸å¤§å°çš„æ¨¡å‹ã€‚æ¨¡å‹æ¶æ„è®¾ç½®çš„è¯¦ç»†ä¿¡æ¯å¦‚è¡¨æ‰€ç¤º:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/121c6bcb-d71f-4d90-86c5-281d9443b0ca&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¾®å‹æ¨¡å‹åœ¨ LibriTTS è®­ç»ƒé›†ä¸Šä½¿ç”¨ 4 ä¸ª V100-32M GPU è¿›è¡Œäº† 50 ä¸ªå‘¨æœŸçš„è®­ç»ƒ.&lt;/li&gt;
&lt;li&gt;å¤šè¯­è¨€æ¨¡å‹åˆ™åœ¨æˆ‘ä»¬çš„å†…éƒ¨æ•°æ®é›†ä¸Šä½¿ç”¨ 64 ä¸ª V100-32M GPU è¿›è¡Œäº† 800,000 ä¸ªæ­¥éª¤çš„è®­ç»ƒã€‚&lt;/li&gt;
&lt;li&gt;å¾®å°æ¨¡å‹å’Œæ™®é€šæ¨¡å‹çš„å­¦ä¹ ç‡åˆ†åˆ«ä¸º 1eâˆ’3 å’Œ 1eâˆ’4ã€‚é¢„çƒ­æ­¥éª¤è®¾ç½®ä¸º 10,000ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å®éªŒç»“æœ&#34;&gt;å®éªŒç»“æœ&lt;/h2&gt;
&lt;h3 id=&#34;supervised-semantic-speech-tokenizer-çš„è¯„ä¼°&#34;&gt;Supervised Semantic Speech Tokenizer çš„è¯„ä¼°&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¼•å…¥VQåæ˜¯å¦WERå¾ˆé«˜ï¼Œç»“æœè¡¨æ˜å’Œä¸é‡åŒ–æ—¶ï¼Œå·®è·ä¸å¤§&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ä¸åŒçš„ Tokenizer (text Tokenizer å’Œ speech Tokenizer) å¯¹æ¨¡å‹çš„å½±å“è¯„ä¼°ï¼Œåœ¨ LibriTTS å•ä¸€è¯´è¯äººè‹±æ–‡æµ‹è¯•é›†ä¸Šä¸å…¶ä»– TTS æ¨¡å‹åœ¨å†…å®¹ä¸€è‡´æ€§å’Œè¯´è¯äººç›¸ä¼¼åº¦ (SS) æ–¹é¢çš„æ¯”è¾ƒã€‚ä½¿ç”¨ éè‡ªå›å½’ ASR æ¨¡å‹ Paraformer-en æ¥è¯†åˆ«ç”Ÿæˆçš„è¯è¯­(utterances), ç”¨äºå¿«é€Ÿè¯„ä¼° WER.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸å…¶ä»– TTS æ¨¡å‹ç›¸æ¯”ï¼Œå³ä½¿ä½¿ç”¨ç›¸åŒçš„æ–‡æœ¬å’Œè¯­éŸ³æ ‡è®°å™¨ï¼Œæ‰€æå‡ºçš„ CosyVoice æ¡†æ¶ä¹Ÿèƒ½å®ç°å¯æ¯”çš„å†…å®¹ä¸€è‡´æ€§å’Œæ›´é«˜çš„è¯´è¯è€…ç›¸ä¼¼åº¦ã€‚&lt;/li&gt;
&lt;li&gt;å¤šè¯­è¨€textå’Œspeech tokenizeræ›¿æ¢äº†å•è¯­è¨€textå’Œspeech tokenizerã€‚ä»…ä½¿ç”¨ LibriTTS è¯­æ–™åº“æ¥è®­ç»ƒæ¨¡å‹ä¼šé™ä½å†…å®¹ä¸€è‡´æ€§å’Œè¯´è¯äººç›¸ä¼¼åº¦ã€‚é€šè¿‡æ¶‰åŠå†…éƒ¨å¤§è§„æ¨¡æ•°æ®é›†ï¼Œæ€§èƒ½å¾—åˆ°æ˜¾ç€æå‡ï¼Œè¾¾åˆ°äº†äººç±»åŒç­‰çš„è´¨é‡ã€‚
&lt;img src=&#34;https://github.com/user-attachments/assets/c9dc29f0-591d-4fb8-a0a4-c5618704a83a&#34; alt=&#34;image&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;cosyvoiceç”Ÿæˆè´¨é‡è¯„ä¼°&#34;&gt;CosyVoiceç”Ÿæˆè´¨é‡è¯„ä¼°&lt;/h3&gt;
&lt;p&gt;è¯„ä¼°æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä»LibriTTSæµ‹è¯•å­é›†æ„å»ºè‹±æ–‡è¯„ä¼°é›†ï¼Œä»AISHELL-3 æµ‹è¯•é›†æ„å»ºä¸­æ–‡è¯„ä¼°é›†ï¼› å¯¹äºè¿™äº›é›†ä¸­çš„æ¯ä¸ªæ–‡æœ¬ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªæç¤ºè¯­éŸ³ã€‚ä½¿ç”¨ Whisper-Large V3 è¿›è¡Œè‹±è¯­è¯†åˆ«ï¼Œä½¿ç”¨ Paraformer-zh è¿›è¡Œä¸­æ–‡è¯†åˆ«æ¥è¯„ä¼°å†…å®¹ä¸€è‡´æ€§ã€‚é€šè¿‡è®¡ç®—ä½¿ç”¨ ERes2Net æå–çš„ç”Ÿæˆè¯­éŸ³å’Œæç¤ºè¯­éŸ³çš„è¯´è¯äººåµŒå…¥ä¹‹é—´çš„ä½™å¼¦ç›¸ä¼¼åº¦æ¥é‡åŒ–è¯´è¯äººç›¸ä¼¼åº¦ ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;token LM é‡‡ç”¨éšæœºé‡‡æ ·è§£ç ç­–ç•¥ï¼Œä½¿ç”¨äº”ä¸ªä¸åŒçš„éšæœºç§å­å€¼ï¼š0ã€7ã€42ã€123 å’Œ 1,337 æ¥è¯„ä¼°åˆæˆè¿‡ç¨‹ã€‚å¯¹æ‰€å¾—è¯„ä¼°æŒ‡æ ‡è¿›è¡Œå¹³å‡ä»¥ç¡®å®šå¹³å‡å€¼å’Œæ ‡å‡†å·®ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ASR re-ranking ä»¥å±•ç¤ºç¦»çº¿æ¨¡å¼ä¸‹æ½œåœ¨çš„æ€§èƒ½æ”¹è¿›ã€‚
ASR re-rankingï¼ˆè‡ªåŠ¨è¯­éŸ³è¯†åˆ«é‡æ’åºï¼‰æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œç”¨äºæ”¹è¿›è‡ªåŠ¨è¯­éŸ³è¯†åˆ«ï¼ˆASRï¼‰ç³»ç»Ÿçš„è¾“å‡ºè´¨é‡ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡é‡æ–°è¯„ä¼°å’Œæ’åºASRç³»ç»Ÿç”Ÿæˆçš„å€™é€‰è½¬å½•ç»“æœï¼Œé€‰æ‹©æœ€æœ‰å¯èƒ½æ­£ç¡®çš„è½¬å½•ã€‚è¿™ç§æ–¹æ³•å¯ä»¥æ˜¾è‘—æé«˜ASRç³»ç»Ÿçš„å‡†ç¡®æ€§å’Œé²æ£’æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤æ‚æˆ–å™ªå£°ç¯å¢ƒä¸‹çš„è¯­éŸ³æ•°æ®æ—¶ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨è‹±è¯­æ•°æ®é›†ä¸Šï¼ŒCosyVoice è¾¾åˆ°äº†äººç±»æ°´å¹³çš„æ€§èƒ½ï¼Œå…·æœ‰ç›¸ä¼¼çš„å†…å®¹è¯†åˆ«å’Œæ›´é«˜çš„è¯´è¯äººç›¸ä¼¼åº¦ã€‚&lt;/li&gt;
&lt;li&gt;ASR é‡æ–°æ’åæ˜¾ç€å¢å¼ºäº†å†…å®¹ä¸€è‡´æ€§ï¼Œå°†å­—é”™è¯¯ç‡ (WER) é™ä½äº† 1.51%ã€‚&lt;/li&gt;
&lt;li&gt;CosyVoice åœ¨ WER ä»¥åŠæ’å…¥å’Œåˆ é™¤é”™è¯¯æ•°é‡æ–¹é¢ä¼˜äº ChatTTSï¼Œè¿™è¡¨æ˜å…¶å…·æœ‰å‡ºè‰²çš„å†…å®¹ä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰è¯„ä¼° ChatTTS çš„è¯´è¯è€…ç›¸ä¼¼åº¦ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‘å¸ƒè¯­éŸ³å…‹éš†åŠŸèƒ½ã€‚
&lt;img src=&#34;https://github.com/user-attachments/assets/4da8d716-2a56-4236-a812-f4ffe348cf88&#34; alt=&#34;image&#34;&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;cosyvoiceçš„æƒ…ç»ªå¯æ§æ€§-emotion-controllability&#34;&gt;CosyVoiceçš„æƒ…ç»ªå¯æ§æ€§ Emotion Controllability&lt;/h3&gt;
&lt;p&gt;è¯„ä¼°æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½¿ç”¨å…¬å…±è¯­éŸ³æƒ…ç»ªè¯†åˆ«æ¨¡å‹ &lt;a href=&#34;https://arxiv.org/abs/2312.15185&#34;&gt;2023. emotion2vec: Self-supervised pre-training for speech emotion representation&lt;/a&gt;|&lt;a href=&#34;https://github.com/ddlBoJack/emotion2vec&#34;&gt;paper code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;é’ˆå¯¹å…­ç§æƒ…ç»ªåˆ†åˆ«ç”Ÿæˆå¹¶è¯„ä¼°äº† 100 ä¸ªè‹±è¯­è¯è¯­ï¼šå¿«ä¹ã€æ„¤æ€’ã€æ‚²ä¼¤ã€æƒŠè®¶ã€ææƒ§å’ŒåŒæ¶ã€‚åˆæˆæ–‡æœ¬çš„å†…å®¹æ—¨åœ¨åŒ¹é…ç›®æ ‡æƒ…æ„Ÿã€‚ç„¶åï¼Œæˆ‘ä»¬æµ‹é‡æ¯ç§æƒ…ç»ªçš„åˆæˆè¯­éŸ³é¢„æµ‹æƒ…ç»ªçš„å‡†ç¡®æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¹äº CosyVoice-instructï¼Œè¾“å…¥ç”±å†…å®¹æ–‡æœ¬å’Œè¯­éŸ³é£æ ¼æŒ‡ä»¤ç»„æˆ(e.g., â€œHappy. &lt;!-- raw HTML omitted --&gt; Content Textâ€)ã€‚ç›¸åï¼ŒCosyVoice-base ä»…æ¥æ”¶å†…å®¹æ–‡æœ¬ä½œä¸ºè¾“å…¥ã€‚&lt;/li&gt;
&lt;li&gt;ç»“æœè¡¨æ˜ï¼Œå¸¦æœ‰æƒ…æ„ŸæŒ‡ä»¤çš„ CosyVoice-instruct æ¯”æ²¡æœ‰æƒ…æ„ŸæŒ‡ä»¤çš„ CosyVoice-base å’Œ CosyVoice-instruct éƒ½æœ‰æ˜¾ç€çš„æ”¹è¿›ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/069420d2-26b7-4f11-b7b0-7d608e836fc6&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;cosyvoice-ä½œä¸ºæ•°æ®ç”Ÿæˆå™¨-data-generator&#34;&gt;CosyVoice ä½œä¸ºæ•°æ®ç”Ÿæˆå™¨ Data Generator&lt;/h3&gt;
&lt;p&gt;è¯„ä¼°æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡CosyVoiceç”Ÿæˆè¯­éŸ³æ•°æ®ï¼Œç”¨äº ASR æ¨¡å‹è®­ç»ƒï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨åŸå§‹Librispeech è®­ç»ƒé›†è¿›è¡ŒASRæ¨¡å‹è®­ç»ƒï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨åŸå§‹Librispeech+åˆæˆæ•°æ®ï¼Œç”¨äº ASRè®­ç»ƒï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨åŸå§‹Librispeech+MLS+åˆæˆæ•°æ®ï¼Œç”¨äº ASRè®­ç»ƒï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å•è¯é”™è¯¯ç‡ä½œä¸ºè¯„ä¼°æ ‡å‡†ã€‚&lt;/p&gt;
&lt;p&gt;CosyVoice çš„ä¸€ä¸ªç®€å•åº”ç”¨æ˜¯ä½œä¸ºæ•°æ®ç”Ÿæˆå™¨æ¥å¢å¼ºå…¶ä»–ä»»åŠ¡çš„è®­ç»ƒæ•°æ®ï¼Œä¾‹å¦‚ ASRã€è¯­éŸ³åˆ°è¯­éŸ³ç¿»è¯‘ (S2ST)ã€‚ä»¥ASRä»»åŠ¡ä¸ºä¾‹ï¼Œæˆ‘ä»¬åœ¨Librispeechè¯­æ–™åº“ä¸Šè¿›è¡Œäº†å®éªŒï¼Œä»¥è¯„ä¼°CosyVoiceç”Ÿæˆé«˜è´¨é‡æ•°æ®çš„èƒ½åŠ›ã€‚å®éªŒç»“æœå¦‚è¡¨æ‰€ç¤ºï¼Œå…¶ä¸­â€œLibrispeechâ€è¡¨ç¤ºåŸå§‹çš„960å°æ—¶æ•°æ®ã€‚ â€œSyn on LS textâ€å’Œâ€œSyn on LS, MLS textâ€åˆ†åˆ«è¡¨ç¤ºä½¿ç”¨ Librispeech å’Œ Multilingual LibriSpeech (&lt;a href=&#34;https://www.openslr.org/94/&#34;&gt;MLS&lt;/a&gt;) è®­ç»ƒé›†çš„æ–‡æœ¬ç”Ÿæˆçš„æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/c8cdd5c4-e730-4388-82c3-cf46fdb3809e&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;p&gt;ç»“æœï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»è¡¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä»…å¯¹åˆæˆæ•°æ®è¿›è¡Œè®­ç»ƒï¼ŒASR æ¨¡å‹å°±å¯ä»¥è¾¾åˆ°ä¸åŸå§‹ Librispeech è®­ç»ƒé›†ç›¸å½“çš„ç»“æœã€‚å°†å®ƒä»¬é›†æˆåï¼Œå¯ä»¥è§‚å¯Ÿåˆ°è¯†åˆ«ç²¾åº¦æ˜¾ç€æé«˜ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªæœ‰è¶£çš„å‘ç°æ˜¯ï¼Œå°†åˆæˆæ•°æ®çº³å…¥ MLS æ–‡æœ¬å¯ä»¥æ˜¾ç€æé«˜è¯†åˆ«æ€§èƒ½ã€‚è¿™å¯èƒ½è¡¨æ˜æ–‡æœ¬å¤šæ ·æ€§å¯¹äº ASR ä»»åŠ¡æ¯”è¯­éŸ³æœ¬èº«çš„æŒç»­æ—¶é—´æ›´é‡è¦ã€‚&lt;/li&gt;
&lt;li&gt;è¿™ä¸€æ”¹è¿›å¯å½’å› äº CosyVoice åˆæˆæ ·æœ¬å¼•å…¥çš„ä¸åŒè¯­è¨€å†…å®¹ã€‚&lt;/li&gt;
&lt;li&gt;è¯„ä¼°ç»“æœå¼ºè°ƒäº† CosyVoice ç”Ÿæˆçš„æ ·æœ¬çš„é«˜è´¨é‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç†æƒ³åŒ–ï¼šæ—¢ç„¶åˆæˆçš„è¯­éŸ³æ•°æ®èƒ½æé«˜ASRæ¨¡å‹è¯†åˆ«ä»»åŠ¡ç²¾åº¦æé«˜ï¼Œæ¨¡å‹è´¨é‡æé«˜ï¼Œè¿›è€Œå¯ä»¥æå‡Supervised Semantic Speech Tokenizeræ¥æé«˜ TTSæ¨¡å‹çš„è´¨é‡æ€§èƒ½ã€‚ å½¢æˆé—­ç¯ï¼Œæ‹Ÿå®šè¯„ä¼°æ ‡å‡†ï¼Œè‡ªé€‚åº”å­¦ä¹ æé«˜ï¼Ÿ&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;CosyVoiceä½œä¸ºä¸€ç§è‡ªå›å½’ï¼Œå¯æ‰©å±•çš„å¤šè¯­è¨€è¯­éŸ³ç”Ÿæˆæ¨¡å‹ï¼Œå®ƒæ”¯æŒé›¶æ ·æœ¬ä¸Šä¸‹æ–‡å­¦ä¹ ã€è·¨è¯­è¨€è¯­éŸ³å…‹éš†ã€æŒ‡ä»¤ç”Ÿæˆä»¥åŠæƒ…æ„Ÿã€å‰¯è¯­è¨€ç‰¹å¾çš„ç»†ç²’åº¦æ§åˆ¶ã€‚å®éªŒç»“æœè¡¨æ˜ï¼ŒCosyVoiceçš„ç³»ç»Ÿæ¶æ„å¯¹äºè¯´è¯è€…ç›¸ä¼¼åº¦å¾ˆé‡è¦ï¼Œè€Œæ–‡æœ¬å’Œè¯­éŸ³æ ‡è®°å™¨å¯¹å†…å®¹ä¸€è‡´æ€§å½±å“å¾ˆå¤§ã€‚æ­¤å¤–ï¼Œæ‰©å¤§æ¨¡å‹å¤§å°å’Œæ•°æ®é‡å¯ä»¥æ˜¾ç€æé«˜æ€§èƒ½ã€‚å› æ­¤ï¼ŒCosyVoice å®ç°äº†äººç±»åŒç­‰çš„ç”Ÿæˆè´¨é‡ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æ‰©å¤§æ¨¡å‹å¤§å°ï¼Œå®é™…ç”Ÿäº§ç¯å¢ƒä¸­æ¨ç†éƒ¨ç½²çš„æˆæœ¬ä¼šå¢åŠ ï¼Œè€Œä¸”è®ºæ–‡ä¸­æ²¡æœ‰å¯¹æ¨ç†ç”Ÿæˆå®æ—¶å› å­RTFè¿›è¡Œè¯„ä¼°ï¼›åœ¨åŒä¸€ç¡¬ä»¶å¹³å°ï¼Œæ¨ç†é€Ÿåº¦ç›¸å¯¹NARæ¨¡å‹æ¥è¯´è¦æ…¢äº›ï¼›å°½ç®¡å¯ä»¥ç»“åˆLLMä¸­çš„æ¨ç†ä¼˜åŒ–æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;é™„å½•&#34;&gt;é™„å½•ï¼š&lt;/h2&gt;
&lt;h3 id=&#34;vector-quantizerå‘é‡é‡åŒ–å™¨&#34;&gt;Vector Quantizer(å‘é‡é‡åŒ–å™¨)&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/lucidrains/vector-quantize-pytorch&#34;&gt;https://github.com/lucidrains/vector-quantize-pytorch&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/ai-bot-pro/baby-llm/pull/1&#34;&gt;https://github.com/ai-bot-pro/baby-llm/pull/1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/ai-bot-pro/baby-llm/pull/13&#34;&gt;https://github.com/ai-bot-pro/baby-llm/pull/13&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å‘é‡é‡åŒ–å™¨ï¼ˆVector Quantizerï¼‰æ˜¯ä¸€ç§å°†è¿ç»­æˆ–ç¦»æ•£å‘é‡åºåˆ—æ˜ å°„ä¸ºé€‚åˆåœ¨æ•°å­—ä¿¡é“ä¸Šé€šä¿¡æˆ–å­˜å‚¨çš„æ•°å­—åºåˆ—çš„ç³»ç»Ÿã€‚å…¶ä¸»è¦ç›®æ ‡æ˜¯æ•°æ®å‹ç¼©ï¼šåœ¨ä¿æŒæ•°æ®å¿…è¦ä¿çœŸåº¦çš„åŒæ—¶ï¼Œé€šè¿‡å‡å°‘æ¯”ç‰¹æ•°æ¥è¡¨ç¤ºæ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;åº”ç”¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‘é‡é‡åŒ–å™¨åœ¨å¤šä¸ªé¢†åŸŸæœ‰å¹¿æ³›åº”ç”¨ï¼ŒåŒ…æ‹¬ï¼š&lt;/li&gt;
&lt;li&gt;å›¾åƒå‹ç¼©ï¼šé€šè¿‡å°†å›¾åƒå—æ˜ å°„åˆ°ç æœ¬ä¸­çš„ç å­—ï¼Œå‡å°‘å­˜å‚¨å’Œä¼ è¾“æ‰€éœ€çš„æ¯”ç‰¹æ•°ã€‚&lt;/li&gt;
&lt;li&gt;å£°éŸ³å‹ç¼©ï¼šå°†éŸ³é¢‘ä¿¡å·çš„ç‰¹å¾å‘é‡é‡åŒ–ï¼Œå®ç°é«˜æ•ˆçš„éŸ³é¢‘ç¼–ç ã€‚&lt;/li&gt;
&lt;li&gt;è¯­éŸ³è¯†åˆ«ï¼šå°†è¯­éŸ³ç‰¹å¾å‘é‡é‡åŒ–ï¼Œæé«˜è¯†åˆ«æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚&lt;/li&gt;
&lt;li&gt;è¡¨ç¤ºå­¦ä¹ ï¼šé€šè¿‡å‘é‡é‡åŒ–å­¦ä¹ æ›´å…·è§£é‡Šæ€§å’Œæ³›åŒ–èƒ½åŠ›çš„ç‰¹å¾è¡¨ç¤ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¼˜åŠ¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æé«˜è®¡ç®—æ•ˆç‡ï¼šå‘é‡åŒ–æŠ€æœ¯é€šè¿‡å°†æ•°æ®è½¬åŒ–ä¸ºå‘é‡å½¢å¼ï¼Œå¯ä»¥åˆ©ç”¨ç°ä»£è®¡ç®—æ¶æ„ï¼ˆå¦‚GPUï¼‰è¿›è¡Œé«˜æ•ˆçš„å¹¶è¡Œè®¡ç®—ï¼Œæ˜¾è‘—æé«˜å¤„ç†é€Ÿåº¦ã€‚&lt;/li&gt;
&lt;li&gt;ä¿ƒè¿›æ•°æ®äº¤äº’ï¼šé€šè¿‡å°†ä¸åŒç±»å‹çš„æ•°æ®è½¬åŒ–ä¸ºå‘é‡å½¢å¼ï¼Œå¯ä»¥æ›´å®¹æ˜“åœ°åœ¨ä¸åŒçš„æ¨¡å‹å’Œä»»åŠ¡ä¹‹é—´å…±äº«å’Œè¿ç§»çŸ¥è¯†ã€‚&lt;/li&gt;
&lt;li&gt;æ”¹å–„æœç´¢å’Œæ¨èç³»ç»Ÿï¼šå‘é‡åŒ–çš„æ•°æ®å¯ä»¥ç”¨äºå¿«é€Ÿæ£€ç´¢ç›¸ä¼¼å†…å®¹ï¼Œå¦‚ç›¸ä¼¼å›¾ç‰‡ã€æ–‡æ¡£æˆ–å•†å“æ¨èç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‘é‡é‡åŒ–å™¨å¯¹è®¡ç®—æ•ˆç‡çš„æå‡ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘æ•°æ®å­˜å‚¨éœ€æ±‚ï¼šå‘é‡é‡åŒ–é€šè¿‡å°†é«˜ç»´å‘é‡æ˜ å°„åˆ°æœ‰é™çš„ç æœ¬ä¸­ï¼Œæ˜¾è‘—å‡å°‘äº†æ•°æ®çš„å­˜å‚¨éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œä¹˜ç§¯é‡åŒ–ï¼ˆPQï¼‰å¯ä»¥å°†é«˜ç»´å‘é‡å‹ç¼©é«˜è¾¾97%ï¼Œä»è€ŒèŠ‚çœå¤§é‡å†…å­˜ã€‚&lt;/li&gt;
&lt;li&gt;åŠ é€Ÿç›¸ä¼¼æ€§æœç´¢ï¼šåœ¨è¿›è¡Œæœ€è¿‘é‚»æœç´¢æ—¶ï¼Œå‘é‡é‡åŒ–å¯ä»¥æ˜¾è‘—åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä¹˜ç§¯é‡åŒ–å¯ä»¥åœ¨å®é™…æµ‹è¯•ä¸­å°†æœ€è¿‘é‚»æœç´¢çš„é€Ÿåº¦æé«˜5.5å€ã€‚æ­¤å¤–ï¼Œé€šè¿‡é¢„å…ˆè®¡ç®—å’Œå­˜å‚¨ç æœ¬ä¸­æ¯ä¸ªç å­—ä¸æŸ¥è¯¢å‘é‡çš„è·ç¦»ï¼Œå¯ä»¥è¿›ä¸€æ­¥å‡å°‘è®¡ç®—æ—¶é—´ï¼Œæé«˜æ£€ç´¢é€Ÿåº¦ã€‚&lt;/li&gt;
&lt;li&gt;æé«˜å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼šå‘é‡åŒ–æ“ä½œå¯ä»¥åˆ©ç”¨ç°ä»£å¤„ç†å™¨çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ï¼Œæ˜¾è‘—åŠ é€Ÿè®¡ç®—è¿‡ç¨‹ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨NEON Intrinsicå‡½æ•°è¿›è¡Œå‘é‡åŒ–ä¼˜åŒ–ï¼Œå¯ä»¥å°†æ•ˆç‡æå‡54%ã€‚åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œå‘é‡åŒ–æ“ä½œå¯ä»¥åŠ é€ŸçŸ©é˜µè¿ç®—ã€å·ç§¯æ“ä½œã€æ¿€æ´»å‡½æ•°è®¡ç®—å’ŒæŸå¤±å‡½æ•°è®¡ç®—ç­‰ï¼Œä»è€Œç¼©çŸ­è®­ç»ƒæ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;ç®€åŒ–è®¡ç®—è¿‡ç¨‹ï¼šå‘é‡åŒ–æŠ€æœ¯å¯ä»¥å°†å¤æ‚çš„æ ‡é‡è¿ç®—è½¬æ¢ä¸ºæ›´ç®€å•çš„å‘é‡è¿ç®—ï¼Œå‡å°‘ä»£ç å¤æ‚åº¦ï¼Œæé«˜ç¨‹åºçš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨NumPyåº“è¿›è¡Œå‘é‡åŒ–æ•°ç»„è¿ç®—ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘è®¡ç®—æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;å‡å°‘å¾ªç¯æ¬¡æ•°ï¼šé€šè¿‡å°†forå¾ªç¯è½¬æ¢ä¸ºå‘é‡æˆ–çŸ©é˜µè¿ç®—ï¼Œå‘é‡åŒ–å¯ä»¥å‡å°‘å¾ªç¯æ¬¡æ•°ï¼Œä»è€Œæé«˜è®¡ç®—æ•ˆç‡ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨å‘é‡åŒ–å·ç§¯æ“ä½œå¯ä»¥æ˜¾è‘—åŠ å¿«å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ä¸­çš„å·ç§¯è®¡ç®—ã€‚&lt;/li&gt;
&lt;li&gt;ä¼˜åŒ–ç¡¬ä»¶åˆ©ç”¨ï¼šç°ä»£å¤„ç†å™¨å’ŒGPUéƒ½æ”¯æŒå‘é‡åŒ–æ“ä½œï¼Œé€šè¿‡ä¼˜åŒ–ä»£ç ä»¥é€‚åº”ç¡¬ä»¶çš„æ¶æ„ï¼Œå¯ä»¥è¿›ä¸€æ­¥æå‡æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨SIMDæŒ‡ä»¤é›†å¯ä»¥åŠ é€Ÿå‘é‡è®¡ç®—ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç»¼ä¸Šæ‰€è¿°ï¼Œå‘é‡é‡åŒ–å™¨é€šè¿‡å‡å°‘æ•°æ®å­˜å‚¨éœ€æ±‚ã€åŠ é€Ÿç›¸ä¼¼æ€§æœç´¢ã€æé«˜å¹¶è¡Œè®¡ç®—èƒ½åŠ›ã€ç®€åŒ–è®¡ç®—è¿‡ç¨‹ã€å‡å°‘å¾ªç¯æ¬¡æ•°å’Œä¼˜åŒ–ç¡¬ä»¶åˆ©ç”¨ï¼Œæ˜¾è‘—æå‡äº†è®¡ç®—æ•ˆç‡ã€‚è¿™äº›ä¼˜åŠ¿åœ¨å¤„ç†å¤§è§„æ¨¡æ•°æ®å’Œè¿›è¡Œå¤æ‚è¿ç®—æ—¶å°¤ä¸ºæ˜æ˜¾ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆPS:ä»¥ä¸Šæ–‡å­—æ¥è‡ªKIMI,å¼•ç”¨äº’è”ç½‘å†…å®¹è¿›è¡Œçš„æ€»ç»“å½’çº³ï¼‰&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„Pythonä»£ç ç¤ºä¾‹ï¼Œï¼ˆè¿™é‡Œç®€åŒ–äº†ç æœ¬ï¼Œéšæœºç”Ÿæˆï¼Œä¸€èˆ¬æ˜¯è®­ç»ƒè€Œæ¥ï¼‰;è¿™é‡Œå±•ç¤ºé€šè¿‡è®­ç»ƒå¥½çš„ç æœ¬ï¼Œå¦‚ä½•å®ç°å°†åŸå§‹ç‰¹å¾å‘é‡xé€šè¿‡ç æœ¬è¿›è¡Œé‡åŒ–ï¼ˆä»åŸæ¥çš„12ç»´å˜æˆäº†4ç»´ï¼‰ï¼Œç„¶åé€šè¿‡ç æœ¬è¿›è¡Œå°½å¯èƒ½è¿‘ä¼¼è¿˜åŸå…¶ç‰¹å¾(æœ¬è´¨æ²¡å˜å°±è¡Œ)ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;numpy&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;np&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;random&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;randint&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# åŸå§‹å‘é‡&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# å­å‘é‡çš„ä¸ªæ•°&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;D&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# åŸå§‹å‘é‡çš„ç»´åº¦&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;D_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;D&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# å­å‘é‡çš„ç»´åº¦&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;u&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;D_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;D&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;D_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# åˆ’åˆ†å­å‘é‡&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;k&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;256&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# æ€»ç°‡å¿ƒä¸ªæ•°&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;k_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;k&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;**&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# å­å‘é‡çš„ç°‡å¿ƒä¸ªæ•°&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;å­å‘é‡çš„ç°‡å¿ƒä¸ªæ•°ï¼š&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;k_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# ç”Ÿæˆç æœ¬&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;codebook&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;c_j&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;j&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;k_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;c_ji&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;randint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;D_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;c_j&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_ji&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;codebook&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;c_j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# è®¡ç®—æ¬§å‡ é‡Œå¾·è·ç¦»&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;euclidean_distance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;distance&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;sum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;**&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;zip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;**&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.5&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;distance&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# æ‰¾åˆ°æœ€è¿‘çš„ç°‡å¿ƒ&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;nearest_cluster_center&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;codebook&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;ans&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;distance&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;9e9&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;j&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;k_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;euclidean_distance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;codebook&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;distance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
                &lt;span class=&#34;n&#34;&gt;distance&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;
                &lt;span class=&#34;n&#34;&gt;nearest_cluster_center&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;j&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;ans&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;nearest_cluster_center&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ans&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# é‡åŒ–ç¼–ç &lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;quantization_code&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;nearest_cluster_center&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;codebook&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# æ¢å¤å‘é‡&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;restore_u&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;code&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;enumerate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;quantization_code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;restore_u&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;extend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;codebook&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;

&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;åŸå§‹å‘é‡:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;åˆ’åˆ†å­å‘é‡:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;u&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;codebook:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;codebook&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;é‡åŒ–ç¼–ç :&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;quantization_code&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;æ¢å¤å‘é‡:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;restore_u&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;å­å‘é‡çš„ç°‡å¿ƒä¸ªæ•°ï¼š 4
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;åŸå§‹å‘é‡: [1, 8, 3, 9, 1, 2, 9, 4, 5, 4, 6, 2]
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;åˆ’åˆ†å­å‘é‡: [[1, 8, 3], [9, 1, 2], [9, 4, 5], [4, 6, 2]]
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;codebook: [[[8, 1, 6], [8, 7, 0], [7, 2, 5], [1, 0, 5]], [[1, 5, 0], [3, 1, 1], [5, 2, 2], [7, 3, 4]], [[8, 4, 5], [0, 7, 9], [8, 1, 1], [3, 3, 0]], [[9, 3, 3], [5, 9, 1], [8, 6, 8], [7, 9, 1]]]
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;é‡åŒ–ç¼–ç : [1, 3, 0, 1]
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;æ¢å¤å‘é‡: [8, 7, 0, 7, 3, 4, 8, 4, 5, 5, 9, 1]
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;cfg-classifier-free-diffusion-guidance&#34;&gt;CFG (Classifier-free diffusion guidance)&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://arxiv.org/abs/2207.12598&#34;&gt;2022. &lt;strong&gt;Classifier-free diffusion guidance&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://github.com/coderpiaobozhe/classifier-free-diffusion-guidance-Pytorch&#34;&gt;Unofficial Implementation pytorch&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;h4 id=&#34;èƒŒæ™¯å’ŒåŠ¨æœº&#34;&gt;èƒŒæ™¯å’ŒåŠ¨æœº&lt;/h4&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨æ¡ä»¶ç”Ÿæˆä»»åŠ¡ä¸­ï¼ŒClassifier Guidance æ–¹æ³•é€šè¿‡å¼•å…¥ä¸€ä¸ªé¢å¤–çš„åˆ†ç±»å™¨æ¥æå‡æ‰©æ•£æ¨¡å‹ç”Ÿæˆæ ·æœ¬çš„è´¨é‡ã€‚è¿™ç§æ–¹æ³•è™½ç„¶æœ‰æ•ˆï¼Œä½†å­˜åœ¨ä¸€äº›æ˜æ˜¾çš„ç¼ºç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¢å¤–çš„è®­ç»ƒæˆæœ¬ï¼šéœ€è¦åœ¨å™ªå£°æ•°æ®ä¸Šé‡æ–°è®­ç»ƒé¢å¤–çš„åˆ†ç±»å™¨ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹åˆ†ç±»å™¨çš„å‡†ç¡®åº¦æœ‰è¦æ±‚ï¼šåˆ†ç±»å™¨ä¸å‡†ç¡®ä¼šå¯¼è‡´ score ä¼°è®¡æ—¶å¾—åˆ°ä¸å‡†ç¡®çš„æ¢¯åº¦ï¼Œå¯¼è‡´æ— æ³•ç”Ÿæˆå¯¹åº”ç±»åˆ«çš„ç»“æœã€‚&lt;/li&gt;
&lt;li&gt;å¯¹æŠ—æ”»å‡»å¯¼è‡´ç”Ÿæˆå¤±è´¥ï¼šé€šè¿‡æ¢¯åº¦æ›´æ–°å›¾åƒä¼šå¯¼è‡´å¯¹æŠ—æ”»å‡»æ•ˆåº”ï¼Œç”Ÿæˆå›¾åƒå¯èƒ½ä¼šæ¬ºéª—å·²ç»è®­ç»ƒå¥½çš„åˆ†ç±»å™¨ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰æŒ‰æ¡ä»¶ç”Ÿæˆã€‚&lt;/li&gt;
&lt;li&gt;ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œè°·æ­Œåœ¨è®ºæ–‡ä¸­æå‡ºäº† Classifier-Free Guidance æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆæ— éœ€é¢å¤–çš„åˆ†ç±»å™¨ï¼Œé€šè¿‡è°ƒèŠ‚å¼•å¯¼çš„æƒé‡æ¥æ§åˆ¶ç”Ÿæˆå›¾åƒçš„çœŸå®æ€§å’Œå¤šæ ·æ€§çš„å¹³è¡¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;h4 id=&#34;æ–¹æ³•åŸç†&#34;&gt;æ–¹æ³•åŸç†&lt;/h4&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Classifier-Free Guidance çš„æ ¸å¿ƒæ€æƒ³æ˜¯å¼•å…¥ä¸€ä¸ªéšå¼çš„åˆ†ç±»å™¨ $p(c \mid z_\lambda)$ ï¼Œç”¨å®ƒæ¥æ¨¡æ‹Ÿ Classifier Guidance ä¸­çš„æ˜¾å¼åˆ†ç±»å™¨çš„ä½œç”¨ã€‚å…·ä½“æ¥è¯´ï¼ŒClassifier-Free Guidance å¯¹åŸå§‹ diffusion çš„ score å‡½æ•° $\epsilon_\theta(z_\lambda, c)$ è¿›è¡Œäº†ä¿®æ”¹ï¼Œä½¿å…¶èƒ½å¤Ÿè¢«è¾“å…¥çš„æ¡ä»¶å¼•å¯¼ï¼Œä½†æ²¡æœ‰ä½¿ç”¨æ˜¾å¼çš„åˆ†ç±»å™¨ã€‚ åœ¨ Classifier Guidance ä¸­ï¼Œæ¡ä»¶ç”Ÿæˆæ—¶çš„åå‘ SDE ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;$$
dx = \left[ f(x, t) - g(t)^2 \nabla_x \log p_t(x \mid y) \right] dt + g(t) d\bar{w}
$$&lt;/p&gt;
&lt;p&gt;åˆ©ç”¨è´å¶æ–¯å…¬å¼ï¼Œå¯¹ $\nabla_x \log p_t(x \mid y)$ è¿›è¡Œå¤„ç†ï¼š
$$
\nabla_x \log p_t(x \mid y) = \nabla_x \log p_t(y \mid x) + \nabla_x \log p_t(x)
$$
åœ¨ Classifier-Free Guidance ä¸­ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›ä½¿ç”¨åˆ†ç±»å™¨æ¥è®¡ç®— $\nabla_x \log p_t(y \mid x)$ ï¼Œå› æ­¤éœ€è¦ç”¨å¦ä¸€ç§æ–¹å¼æ¥è¡¨ç¤ºè¿™ä¸€é¡¹ã€‚å…·ä½“æ¨å¯¼å¦‚ä¸‹ï¼š
$$
\nabla_{x_t} \log p(y \mid x_t) = \nabla_{x_t} \log p(x_t \mid y) - \nabla_{x_t} \log p(x_t)
$$
ä»£å…¥ Classifier Guidance ä¸­æ¨å¯¼å¾—åˆ°çš„åˆ†ç±»å™¨å¼•å¯¼å¯¹åº”çš„æ¢¯åº¦é¡¹ä¸­ï¼Œå¯ä»¥å¾—åˆ°ï¼š&lt;/p&gt;
&lt;p&gt;$$
\bar{\epsilon}_\theta(x_t, t, y) = (w+1) \epsilon_\theta(x_t, t, y) - w \epsilon_\theta(x_t, t)
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ï¼Œ w æ˜¯ä¸€ä¸ªæ§åˆ¶æ¡ä»¶é‡è¦æ€§çš„å‚æ•°ã€‚å½“ w = 0 æ—¶ï¼Œæ¨¡å‹å°±æ˜¯åŸæ¥çš„æ— æ¡ä»¶ç”Ÿæˆæ¨¡å‹ï¼›å½“ $w \to \infty$ æ—¶ï¼Œæ¨¡å‹å®Œå…¨ä¾èµ–äºæ¡ä»¶ï¼›å½“ w &amp;gt; 1 æ—¶ï¼Œæ¨¡å‹ä¸ä»…æ›´åŠ é‡è§†æ¡ä»¶ï¼Œè€Œä¸”å‘è¿œç¦»æ— æ¡ä»¶ç”Ÿæˆçš„æ–¹å‘ç§»åŠ¨ã€‚&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;
&lt;h4 id=&#34;å®ç°å’Œåº”ç”¨&#34;&gt;å®ç°å’Œåº”ç”¨&lt;/h4&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Classifier-Free Guidance çš„å®ç°ç›¸å¯¹ç®€å•ï¼Œä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;è®­ç»ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä»æ•°æ®é›†ä¸­é‡‡æ ·ä¸€å¼ å›¾ç‰‡å’Œå¯¹åº”çš„åˆ†ç±»ã€‚&lt;/li&gt;
&lt;li&gt;ä»¥ä¸€å®šæ¦‚ç‡ $p_{\text{uncond}}$ å°†æ¡ä»¶ c èµ‹å€¼ä¸ºç©ºï¼ˆéæ¡ä»¶ï¼‰ï¼Œä»¥ $1 - p_{\text{uncond}}$ çš„æ¦‚ç‡ä¿ç•™ c ï¼ˆæ¡ä»¶ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡è¿™ç§æ–¹å¼å°†æ¡ä»¶å’Œéæ¡ä»¶æ”¾åˆ°ä¸€èµ·è®­ç»ƒã€‚&lt;/li&gt;
&lt;li&gt;å–ä¸€ä¸ªæ—¶é—´æ ·æœ¬ $\lambda$ ã€‚&lt;/li&gt;
&lt;li&gt;æŠ½æ ·éšæœºå™ªéŸ³ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡å‡å€¼å’Œæ ‡å‡†å·®è®¡ç®— $z_\lambda$ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¨ç†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æ¨ç†æ—¶ï¼ŒåŒæ—¶é¢„æµ‹æ¡ä»¶ç”Ÿæˆå’Œæ— æ¡ä»¶ç”Ÿæˆçš„å›¾åƒã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ guidance scale æ§åˆ¶æœ€ç»ˆç”Ÿæˆç»“æœçš„æ–¹å‘å’Œå¼ºåº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;
&lt;h4 id=&#34;ä¼˜åŠ¿å’Œæ•ˆæœ&#34;&gt;ä¼˜åŠ¿å’Œæ•ˆæœ&lt;/h4&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Classifier-Free Guidance çš„ä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ— éœ€é¢å¤–åˆ†ç±»å™¨ï¼šæ— éœ€è®­ç»ƒé¢å¤–çš„åˆ†ç±»å™¨ï¼Œå‡å°‘äº†è®­ç»ƒæˆæœ¬å’Œå¤æ‚åº¦ã€‚&lt;/li&gt;
&lt;li&gt;çµæ´»æ€§ï¼šå¯ä»¥ç”Ÿæˆä»»æ„æ¡ä»¶ä¸‹çš„æ ·æœ¬ï¼Œä¸å—åˆ†ç±»å™¨ç±»åˆ«çš„é™åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆè´¨é‡ï¼šé€šè¿‡è°ƒèŠ‚ guidance scaleï¼Œå¯ä»¥ç”Ÿæˆé«˜è´¨é‡ä¸”å¤šæ ·åŒ–çš„æ ·æœ¬ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;
&lt;h4 id=&#34;æ€»ç»“-1&#34;&gt;æ€»ç»“&lt;/h4&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Classifier-Free Diffusion Guidance é€šè¿‡å¼•å…¥éšå¼çš„åˆ†ç±»å™¨å’Œè°ƒèŠ‚å¼•å¯¼æƒé‡ï¼Œé¿å…äº† Classifier Guidance çš„ç¼ºç‚¹ï¼ŒåŒæ—¶ä¿æŒäº†æ¡ä»¶ç”Ÿæˆçš„é«˜è´¨é‡å’Œçµæ´»æ€§ã€‚è¿™ç§æ–¹æ³•åœ¨å›¾åƒç”Ÿæˆã€æ–‡æœ¬åˆ°å›¾åƒç¿»è¯‘ç­‰ä»»åŠ¡ä¸­è¡¨ç°å‡ºè‰²ï¼Œé€‚ç”¨äºéœ€è¦é«˜è´¨é‡å’Œå¤šæ ·åŒ–ç”Ÿæˆçš„åº”ç”¨åœºæ™¯ã€‚&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>è®ºæ–‡è§£è¯» Matcha-TTS: A fast TTS architecture with conditional flow matching</title>
      <link>https://weedge.github.io/post/multimoding/voices/matcha-tts/</link>
      <pubDate>Tue, 14 Jan 2025 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/multimoding/voices/matcha-tts/</guid>
      
        <description>&lt;h1 id=&#34;-matcha-tts&#34;&gt;ğŸµ matcha-tts&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2309.03199&#34;&gt;2023.9 &lt;strong&gt;Matcha-TTS: A fast TTS architecture with conditional flow matching&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://github.com/shivammehta25/Matcha-TTS&#34;&gt;paper code&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ‘˜è¦&#34;&gt;æ‘˜è¦ï¼š&lt;/h1&gt;
&lt;p&gt;ä¸€ç§ç”¨äºå¿«é€Ÿ TTS å£°å­¦å»ºæ¨¡çš„æ–°ç¼–ç å™¨-è§£ç å™¨æ¶æ„ï¼Œä½¿ç”¨æœ€ä½³ä¼ è¾“æ¡ä»¶æµåŒ¹é… (OT-CFM) è¿›è¡Œè®­ç»ƒã€‚ä¸ä½¿ç”¨åˆ†æ•°åŒ¹é…è®­ç»ƒçš„æ¨¡å‹ç›¸æ¯”ï¼Œè¿™äº§ç”Ÿäº†åŸºäº ODE çš„è§£ç å™¨ï¼Œèƒ½å¤Ÿä»¥æ›´å°‘çš„åˆæˆæ­¥éª¤å®ç°é«˜è¾“å‡ºè´¨é‡ã€‚ä»”ç»†çš„è®¾è®¡é€‰æ‹©è¿˜ç¡®ä¿æ¯ä¸ªåˆæˆæ­¥éª¤éƒ½èƒ½å¿«é€Ÿè¿è¡Œã€‚è¯¥æ–¹æ³•æ˜¯æ¦‚ç‡æ€§çš„ã€éè‡ªå›å½’çš„ï¼Œå¹¶ä¸”æ— éœ€å¤–éƒ¨å¯¹é½å³å¯ä»å¤´å¼€å§‹å­¦ä¹ è¯´è¯ã€‚ä¸å¼ºå¤§çš„é¢„è®­ç»ƒåŸºçº¿æ¨¡å‹ç›¸æ¯”ï¼ŒMatcha-TTS ç³»ç»Ÿå…·æœ‰æœ€å°çš„å†…å­˜å ç”¨ï¼Œå¯ä»¥ä¸é•¿è¯­éŸ³ä¸Šæœ€å¿«çš„æ¨¡å‹ç›¸åª²ç¾ï¼Œå¹¶åœ¨å¬åŠ›æµ‹è¯•ä¸­è·å¾—æœ€é«˜çš„å¹³å‡æ„è§å¾—åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ç§éè‡ªå›å½’ç¥ç» TTS çš„æ–°æ–¹æ³•ï¼Œå®ƒä½¿ç”¨æ¡ä»¶æµåŒ¹é…(CFM from &lt;a href=&#34;https://arxiv.org/abs/2210.02747&#34;&gt;2022.10 &lt;strong&gt;Flow Matching for Generative Modeling&lt;/strong&gt;&lt;/a&gt;)ï¼ˆç±»ä¼¼äºæ ¡æ­£æµ(Rectified Flow &lt;a href=&#34;https://arxiv.org/abs/2209.03003&#34;&gt;2022.9 Flow Straight and Fast: Learning to Generate and Transfer Data with Rectified Flow&lt;/a&gt;ï¼‰æ¥åŠ é€ŸåŸºäº ODE çš„è¯­éŸ³åˆæˆã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Is probabilistic  æ˜¯æ¦‚ç‡æ€§çš„&lt;/li&gt;
&lt;li&gt;Has compact memory footprint å…·æœ‰ç´§å‡‘çš„å†…å­˜å ç”¨&lt;/li&gt;
&lt;li&gt;Sounds highly natural  å¬èµ·æ¥éå¸¸è‡ªç„¶&lt;/li&gt;
&lt;li&gt;Is very fast to synthesise from åˆæˆé€Ÿåº¦éå¸¸å¿«&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç®€æ´çš„ç»“æ„ï¼Œè®­ç»ƒæ¨ç†å¿«ï¼Œä½¿ç”¨æ›´å°‘é¢å†…å­˜ç©ºé—´ï¼Œ&lt;/p&gt;
&lt;p&gt;ä¸€ç§åŸºäºè¿ç»­å½’ä¸€åŒ–æµçš„æ¦‚ç‡æ€§ã€éè‡ªå›å½’ã€å¿«é€Ÿé‡‡æ ·çš„ TTS å£°å­¦æ¨¡å‹ã€‚ä¸»è¦æœ‰ä¸¤ä¸ªåˆ›æ–°ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æå‡ºäº†ä¸€ç§æ”¹è¿›çš„ç¼–ç å™¨-è§£ç å™¨ TTS ç»“æ„ï¼Œè¯¥ç»“æ„åœ¨è§£ç å™¨ä¸­ç»“åˆä½¿ç”¨ 1D CNN å’Œ Transformerã€‚è¿™å‡å°‘äº†å†…å­˜æ¶ˆè€—å¹¶ä¸”å¯ä»¥å¿«é€Ÿè¯„ä¼°ï¼Œä»è€Œæé«˜ç»¼åˆé€Ÿåº¦ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æœ€ä¼˜ä¼ è¾“æ¡ä»¶æµåŒ¹é… optimal-transport conditional flow matching(OT-CFM) æ¥è®­ç»ƒè¿™äº›æ¨¡å‹ï¼Œè¿™æ˜¯ä¸€ç§å­¦ä¹ ä»æ•°æ®åˆ†å¸ƒä¸­é‡‡æ ·çš„ ODE çš„æ–°æ–¹æ³•ã€‚ä¸ä¼ ç»Ÿçš„ è¿ç»­æ—¶é—´å½’ä¸€åŒ–æµ CNFï¼ˆcontinuous-time normalising flows ï¼‰ å’Œåˆ†æ•°åŒ¹é…æ¦‚ç‡æµ ODE ï¼ˆprobability flow ODEï¼‰ ç›¸æ¯”ï¼ŒOT-CFM å®šä¹‰äº†ä»æºåˆ°ç›®æ ‡çš„æ›´ç®€å•çš„è·¯å¾„ï¼Œä»è€Œèƒ½å¤Ÿä»¥æ¯” DPMï¼ˆDiffusion probabilistic modelï¼‰ æ›´å°‘çš„æ­¥éª¤è¿›è¡Œå‡†ç¡®åˆæˆã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å®éªŒç»“æœè¡¨æ˜ï¼Œè¿™ä¸¤ç§åˆ›æ–°éƒ½åŠ é€Ÿäº†åˆæˆï¼Œå‡å°‘äº†é€Ÿåº¦å’Œåˆæˆè´¨é‡ä¹‹é—´çš„æƒè¡¡ã€‚å°½ç®¡é€Ÿåº¦å¿«ä¸”è½»é‡çº§ï¼ŒMatcha-TTSèƒ½å¤Ÿåœ¨ä¸éœ€è¦å¤–éƒ¨å¯¹é½å™¨çš„æƒ…å†µä¸‹å­¦ä¹ è¯´è¯å’Œå¯¹é½ã€‚ä¸å¼ºå¤§çš„é¢„è®­ç»ƒåŸºçº¿æ¨¡å‹ç›¸æ¯”ï¼ŒMatcha-TTSå®ç°äº†å¿«é€Ÿåˆæˆï¼Œå¹¶è·å¾—äº†æ›´å¥½çš„è‡ªç„¶åº¦è¯„åˆ†ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;é™„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨LJ Speechæ•°æ®é›†è®­ç»ƒ202 epochs, åœ¨1xGPU ä¸Šè®­ç»ƒäº† 79,372 step çš„ckpt(è®ºæ–‡ä¸­æ˜¯2x3080GPU 50K step)ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://huggingface.co/weege007/matchaTTS/tree/main&#34;&gt;https://huggingface.co/weege007/matchaTTS/tree/main&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç¬”è®°åœ°å€ï¼š &lt;a href=&#34;https://github.com/weedge/doraemon-nb/blob/main/matcha_tts.ipynb&#34;&gt;https://github.com/weedge/doraemon-nb/blob/main/matcha_tts.ipynb&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/95bccbf2-b164-484f-a6c9-8ab7e235c018&#34; alt=&#34;loss&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;ç»“æ„&#34;&gt;ç»“æ„ï¼š&lt;/h1&gt;
&lt;p&gt;Matcha-TTS æ˜¯ä¸€ç§éè‡ªå›å½’çš„ç¥ç»æ–‡æœ¬åˆ°è¯­éŸ³ï¼ˆTTSï¼‰ç¼–ç å™¨-è§£ç å™¨ç»“æ„ã€‚å…¶ç»“æ„çš„æ¦‚è¿°åœ¨å›¾1ä¸­æä¾›ã€‚æ–‡æœ¬ç¼–ç å™¨å’Œæ—¶é•¿é¢„æµ‹å™¨ç»“æ„å’ŒGrad-TTSä¸€è‡´ï¼Œä½†Text encoderä½¿ç”¨æ—‹è½¬ä½ç½®åµŒå…¥è€Œä¸æ˜¯ç›¸å¯¹ä½ç½®åµŒå…¥ã€‚å¯¹é½å’Œæ—¶é•¿æ¨¡å‹è®­ç»ƒéµå¾ªMASå’Œå…ˆéªŒæŸå¤±  $\mathcal{L}_{enc}$ ï¼Œå¦‚Grad-TTSä¸­æ‰€è¿°ã€‚é¢„æµ‹çš„æ—¶é•¿ï¼Œç»è¿‡å‘ä¸Šå–æ•´åï¼Œç”¨äºä¸Šé‡‡æ ·ï¼ˆå¤åˆ¶ï¼‰ç¼–ç å™¨è¾“å‡ºçš„å‘é‡ï¼Œä»¥è·å¾— $\mu$ ï¼Œå³åœ¨ç»™å®šæ–‡æœ¬å’Œæ‰€é€‰æ—¶é•¿çš„æƒ…å†µä¸‹é¢„æµ‹çš„å¹³å‡å£°å­¦ç‰¹å¾ï¼ˆä¾‹å¦‚ï¼Œæ¢…å°”é¢‘è°±å›¾ï¼‰ã€‚è¿™ä¸ªå¹³å‡å€¼ç”¨äºæ¡ä»¶åŒ–è§£ç å™¨ï¼Œè§£ç å™¨é¢„æµ‹ç”¨äºåˆæˆçš„å‘é‡åœº $v_{t}\left(\phi_{t}^{OT}\left(x_{0}\right)\mid\mu;\theta\right)$ï¼Œä½†å®ƒå¹¶ä¸ç”¨ä½œåˆå§‹å™ªå£°æ ·æœ¬ $x_0$ çš„å‡å€¼ï¼ˆä¸Grad-TTSä¸åŒï¼‰ã€‚æœ€ç»ˆé€šè¿‡vocoder(HiFi-GAN Generator)ç”Ÿæˆwaveform&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/50e1e3ad-7181-41a5-8cc2-6d6c62473065&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;text-encoder-æ–‡æœ¬ç¼–ç å™¨&#34;&gt;Text encoder æ–‡æœ¬ç¼–ç å™¨&lt;/h2&gt;
&lt;p&gt;ä½ç½®ç¼–ç ä½¿ç”¨ RoPE embedding è€Œä¸æ˜¯ç›¸å¯¹ä½ç½® relative embedding, å’ŒGrad-TTSä¸­Text encoder ç›¸åŒçš„è¶…å‚æ•°&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2005.11129&#34;&gt;2020. &lt;strong&gt;Glow-TTS: A Generative Flow for Text-to-Speech via Monotonic Alignment Search&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2105.06337&#34;&gt;2021. &lt;strong&gt;Grad-TTS: A diffusion probabilistic model for text-to-speech&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;duration-predictor-æŒç»­æ—¶é—´é¢„æµ‹å™¨&#34;&gt;Duration predictor æŒç»­æ—¶é—´é¢„æµ‹å™¨&lt;/h2&gt;
&lt;p&gt;å’ŒGrad-TTSä¸­Duration predictor ç›¸åŒçš„è¶…å‚æ•°&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2005.11129&#34;&gt;2020. &lt;strong&gt;Glow-TTS: A Generative Flow for Text-to-Speech via Monotonic Alignment Search&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2105.06337&#34;&gt;2021. &lt;strong&gt;Grad-TTS: A diffusion probabilistic model for text-to-speech&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;decoder-the-flow-prediction-network-æµé¢„æµ‹ç½‘ç»œ&#34;&gt;Decoder (the Flow-prediction network æµé¢„æµ‹ç½‘ç»œ)&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ä¸¤ä¸ªä¸‹é‡‡æ ·å—ï¼Œç„¶åæ˜¯ä¸¤ä¸ªä¸­é‡‡æ ·å—å’Œä¸¤ä¸ªä¸Šé‡‡æ ·å—ï¼Œå¦‚å›¾ 2 æ‰€ç¤ºã€‚æ¯ä¸ªå—éƒ½æœ‰ä¸€ä¸ª Transformer å±‚ï¼Œéšè—ç»´åº¦ä¸º 256ã€2 ä¸ªå¤´ã€æ³¨æ„åŠ›ç»´åº¦ä¸º 64ï¼Œå¹¶ä¸”ä½¿ç”¨snake æ¿€æ´»å‡½æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/5c50f129-e7bf-427e-aa75-cfd01f6b089b&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å—LDM &lt;a href=&#34;https://arxiv.org/abs/2112.10752&#34;&gt;2021. High-resolution image synthesis with latent diffusion models&lt;/a&gt;çš„å¯å‘,ä¸€ä¸ªåŒ…å« 1D å·ç§¯æ®‹å·®å—çš„ U-Netï¼Œç”¨äºå¯¹è¾“å…¥è¿›è¡Œä¸‹é‡‡æ ·å’Œä¸Šé‡‡æ ·ï¼Œå¹¶å…·æœ‰æµåŒ¹é…æ­¥éª¤ tâˆˆ[0,1] åµŒå…¥, æ¯ä¸ªæ®‹å·®å—åé¢éƒ½æœ‰ä¸€ä¸ª Transformerå—ï¼Œå…¶å‰é¦ˆç½‘ç»œä½¿ç”¨ snake æ¿€æ´»å‡½æ•°ï¼Œè¿™äº› Transformer ä¸ä½¿ç”¨ä»»ä½•ä½ç½®åµŒå…¥ï¼Œå› ä¸ºéŸ³ç´ (phone)ä¹‹é—´çš„ä½ç½®ä¿¡æ¯å·²ç»ç”±ç¼–ç å™¨åµŒå…¥ï¼Œå¹¶ä¸”å·ç§¯å’Œä¸‹é‡‡æ ·æ“ä½œç”¨äºåœ¨åŒä¸€éŸ³ç´ å†…çš„å¸§ä¹‹é—´ï¼Œæ’å…¥è¿™äº›ä¿¡æ¯å¹¶åŒºåˆ†å®ƒä»¬å½¼æ­¤çš„ç›¸å¯¹ä½ç½®ã€‚ä¸ Grad-TTS ä½¿ç”¨çš„ä»… 2D å·ç§¯ U-Net ç›¸æ¯”ï¼Œè¯¥è§£ç å™¨ç½‘ç»œçš„è¯„ä¼°é€Ÿåº¦æ˜æ˜¾æ›´å¿«ï¼Œå¹¶ä¸”æ¶ˆè€—çš„å†…å­˜æ›´å°‘ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¿€æ´»å‡½æ•°ï¼š snake active function æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2006.08195&#34;&gt;2020. Neural networks fail to learn periodic functions and how to fix it&lt;/a&gt; å’Œ &lt;a href=&#34;https://arxiv.org/abs/2206.04658&#34;&gt;2022. BigVGAN: A universal neural vocoder with large-scale training&lt;/a&gt; ä¸€æ ·çš„ä½¿ç”¨æ–¹æ³•&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç»“æ„æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2105.06337&#34;&gt;2021. &lt;strong&gt;Grad-TTS: A diffusion probabilistic model for text-to-speech&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;optimal-transport-conditional-flow-matching-æœ€ä¼˜ä¼ è¾“æ¡ä»¶æµåŒ¹é…&#34;&gt;Optimal-transport conditional flow matching æœ€ä¼˜ä¼ è¾“æ¡ä»¶æµåŒ¹é…&lt;/h2&gt;
&lt;p&gt;åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œé¦–å…ˆä»‹ç»ç”±å‘é‡åœºç”Ÿæˆçš„æ¦‚ç‡å¯†åº¦è·¯å¾„ï¼Œç„¶åå¼•å…¥æå‡ºçš„æ–¹æ³•ä¸­ä½¿ç”¨çš„æœ€ä¼˜ä¼ è¾“æ¡ä»¶æµåŒ¹é…ï¼ˆOT-CFMï¼‰ç›®æ ‡ã€‚
è®¾ $\mathbf{x}$ è¡¨ç¤ºæ•°æ®ç©ºé—´ $\mathbb{R}^d$ä¸­çš„ä¸€ä¸ªè§‚æµ‹å€¼ï¼Œå®ƒä»å¤æ‚ä¸”æœªçŸ¥çš„æ•°æ®åˆ†å¸ƒ $q(\mathbf{x}) q(x)$ ä¸­é‡‡æ ·å¾—åˆ°ã€‚ä¸€ä¸ªæ¦‚ç‡å¯†åº¦è·¯å¾„æ˜¯ä¸€ä¸ªéšæ—¶é—´å˜åŒ–çš„æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼Œ $p_t: [0,1] \times \mathbb{R}^d \rightarrow \mathbb{R}^{&amp;gt;0} pt:[0,1]Ã—Rdâ†’R&amp;gt;0 $ï¼Œå…¶ä¸­ $t \in [0,1] tâˆˆ[0,1]$ ï¼Œ
$p_0(\mathbf{x}) = \mathcal{N}(\mathbf{x}; \mathbf{0}, \mathbf{I})$ æ˜¯ä¸€ä¸ªå…ˆéªŒåˆ†å¸ƒï¼Œä½¿å¾— $p_1(\mathbf{x})$ è¿‘ä¼¼äºæ•°æ®åˆ†å¸ƒ $q(\mathbf{x})$ ã€‚
ä¾‹å¦‚ï¼Œè¿ç»­æ—¶é—´å½’ä¸€åŒ–æµï¼ˆCNFsï¼‰é¦–å…ˆå®šä¹‰ä¸€ä¸ªå‘é‡åœº $\mathbf{v}_t: [0,1] \times \mathbb{R}^d \rightarrow \mathbb{R}^d$ ï¼Œå®ƒé€šè¿‡ä¸‹é¢çš„å¸¸å¾®åˆ†æ–¹ç¨‹ï¼ˆODEï¼‰ç”Ÿæˆæµ $\phi_t: [0,1] \times \mathbb{R}^d \rightarrow \mathbb{R}^d$ ï¼š&lt;/p&gt;
&lt;p&gt;$$
\frac{d}{dt} \phi_t(\mathbf{x}) = \mathbf{v}_t(\phi_t(\mathbf{x})) \quad ; \quad \phi_0(\mathbf{x}) = \mathbf{x}.
$$
è¿™ç”Ÿæˆäº†è·¯å¾„ $p_t$ ï¼Œä½œä¸ºæ•°æ®ç‚¹çš„è¾¹é™…æ¦‚ç‡åˆ†å¸ƒã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è§£å†³æ–¹ç¨‹ï¼ˆ1ï¼‰ä¸­çš„åˆå€¼é—®é¢˜ï¼Œä»è¿‘ä¼¼çš„æ•°æ®åˆ†å¸ƒ $p_1$ ä¸­é‡‡æ ·ã€‚ å‡è®¾å­˜åœ¨ä¸€ä¸ªå·²çŸ¥çš„å‘é‡åœº $\mathbf{u}_t$ ï¼Œå®ƒä» $p_0$ åˆ° $p_1 \approx q$ ç”Ÿæˆæ¦‚ç‡è·¯å¾„ $p_t$ ã€‚æµåŒ¹é…æŸå¤±å®šä¹‰ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;$$
\mathcal{L}_{\mathrm{FM}}(\theta) = \mathbb{E}_{t,p_t(\mathbf{x})} \left| \mathbf{u}_t(\mathbf{x}) - \mathbf{v}_t(\mathbf{x}; \theta) \right|^2,
$$
å…¶ä¸­ $t \sim \mathbb{U}[0,1]$ å¹¶ä¸” $\mathbf{v}_t(\mathbf{x}; \theta)$ æ˜¯ä¸€ä¸ªå…·æœ‰å‚æ•° $\theta$ çš„ç¥ç»ç½‘ç»œã€‚ç„¶è€Œï¼ŒæµåŒ¹é…åœ¨å®è·µä¸­æ˜¯ä¸å¯è¡Œçš„ï¼Œå› ä¸ºè·å–å‘é‡åœº $\mathbf{u}_t$ å’Œç›®æ ‡æ¦‚ç‡ $p_t$ å¹¶éæ˜“äº‹ã€‚å› æ­¤ï¼Œæ¡ä»¶æµåŒ¹é…è€ƒè™‘çš„æ˜¯ï¼š&lt;/p&gt;
&lt;p&gt;$$
\mathcal{L}_{\mathrm{CFM}}(\theta) = \mathbb{E}_{t,q(\mathbf{x}_1),p_t(\mathbf{x} \mid \mathbf{x}_1)} \left| \mathbf{u}_t(\mathbf{x} \mid \mathbf{x}_1) - \mathbf{v}_t(\mathbf{x}; \theta) \right|^2.
$$&lt;/p&gt;
&lt;p&gt;è¿™æ›¿æ¢äº†éš¾ä»¥å¤„ç†çš„è¾¹é™…æ¦‚ç‡å¯†åº¦å’Œå‘é‡åœºï¼Œè½¬è€Œè€ƒè™‘æ¡ä»¶æ¦‚ç‡å¯†åº¦å’Œæ¡ä»¶å‘é‡åœºã€‚å…³é”®æ˜¯ï¼Œè¿™äº›é€šå¸¸æ˜¯å¯è¡Œçš„ï¼Œå¹¶ä¸”æœ‰å°é—­å½¢å¼çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œä¸”å¯ä»¥è¯æ˜ $\mathcal{L}_{\mathrm{CFM}}(\theta)$ å’Œ $\mathcal{L}_{\mathrm{FM}}(\theta)$ åœ¨ $\theta$ æ–¹é¢å…·æœ‰ç›¸åŒçš„æ¢¯åº¦ã€‚&lt;/p&gt;
&lt;p&gt;Matcha-TTS ä½¿ç”¨æœ€ä¼˜ä¼ è¾“æ¡ä»¶æµåŒ¹é…ï¼ˆOT-CFMï¼‰è¿›è¡Œè®­ç»ƒï¼Œè¿™æ˜¯ä¸€ç§å…·æœ‰ç‰¹åˆ«ç®€å•æ¢¯åº¦çš„ CFM å˜ä½“ã€‚OT-CFM æŸå¤±å‡½æ•°å¯ä»¥å†™æˆï¼š
$$
L(\theta)=\mathbb{E}_{t, q(x_{1}), p_{0}(x_{0})}\left|u_{t}^{OT}\left(\phi_{t}^{OT}(x)\mid x_{1}\right)-v_{t}\left(\phi_{t}^{OT}(x)\mid\mu;\theta\right)\right|^{2}, \quad
$$&lt;/p&gt;
&lt;p&gt;å®šä¹‰ $\phi_{t}^{OT}(x)=(1-(1-\sigma_{\min}) t) x_{0}+t x_{1}$ ä¸ºä» $x_{0}$ åˆ° $x_{1}$ çš„æµï¼Œå…¶ä¸­æ¯ä¸ªæ•°æ® $x_{1}$ ä¸ä¸€ä¸ªéšæœºæ ·æœ¬ $x_{0}\sim\mathcal{N}(0, I)$ åŒ¹é…ï¼Œå…¶æ¢¯åº¦å‘é‡åœº(å…¶æœŸæœ›å€¼æ˜¯å­¦ä¹ çš„ç›®æ ‡) åˆ™æ˜¯ $u_{t}^{OT}\left(\phi_{t}^{OT}\left(x_{0}\right)\mid x_{1}\right)=x_{1}-(1-\sigma_{\min}) x_{0}$ï¼Œå®ƒæ˜¯çº¿æ€§çš„ã€æ—¶é—´ä¸å˜çš„ï¼Œå¹¶ä¸”åªä¾èµ–äº $x_{0}$ å’Œ $x_{1}$ ã€‚è¿™äº›å±æ€§ä½¿å¾—è®­ç»ƒæ›´ç®€å•ã€æ›´å¿«ï¼Œç”Ÿæˆæ›´å¿«ï¼Œå¹¶ä¸”ä¸ DPMs ç›¸æ¯”æ€§èƒ½æ›´å¥½ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Matcha-TTSçš„æƒ…å†µä¸‹ï¼Œ$\mathbf{x}_1$ æ˜¯å£°å­¦å¸§ï¼Œè€Œ $\boldsymbol{\mu}$ æ˜¯ä»æ–‡æœ¬é¢„æµ‹çš„è¿™äº›å¸§çš„æ¡ä»¶å‡å€¼ï¼Œä½¿ç”¨ä¸‹ä¸€éƒ¨åˆ†æè¿°çš„æ¶æ„ã€‚ $\sigma_{\min}$ æ˜¯ä¸€ä¸ªå…·æœ‰å¾ˆå°å€¼ï¼ˆåœ¨æˆ‘ä»¬çš„å®éªŒä¸­ä¸º1e-4ï¼‰çš„è¶…å‚æ•°ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2210.02747&#34;&gt;2022.10 Flow Matching for Generative Modeling&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;è®­ç»ƒ&#34;&gt;è®­ç»ƒ&lt;/h1&gt;
&lt;p&gt;å¸¸è§„æ•°æ®é›†ï¼Œè®ºæ–‡ä¸­ä½¿ç”¨å•äººæ•°æ®ï¼ˆLJ Speechï¼‰ï¼Œé¢å¤–ä¹Ÿç”¨å¤šäººæ•°æ®ï¼ˆVCTKï¼‰æ¥è®­ç»ƒï¼›å¯ä»¥ä½¿ç”¨lhotseå·¥å…·ä¸‹è½½, è¿›è¡Œåˆ‡åˆ†æ•°æ®é¢„å¤„ç†ï¼Œç„¶åé€šè¿‡å¸¦æœ‰ espeak-ng åç«¯çš„phonemizer: &lt;a href=&#34;https://github.com/bootphon/phonemizer&#34;&gt;https://github.com/bootphon/phonemizer&lt;/a&gt; ç”¨äºå°†è¾“å…¥å­—ç´ ï¼ˆgraphemesï¼‰è½¬æ¢ä¸º IPA éŸ³ç´ ï¼ˆIPA phonesï¼‰ï¼Œåœ¨ 2 ä¸ª GPU ä¸Šè®­ç»ƒäº† 500k æ›´æ–°ï¼Œæ‰¹é‡å¤§å°ä¸º 32ï¼Œå­¦ä¹ ç‡ä¸º 1e-4ã€‚&lt;/p&gt;
&lt;h2 id=&#34;è®­ç»ƒæ•°æ®é›†&#34;&gt;è®­ç»ƒæ•°æ®é›†ï¼š&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://keithito.com/LJ-Speech-Dataset/&#34;&gt;LJ Speech&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://datashare.ed.ac.uk/handle/10283/2651&#34;&gt;VCTK&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¯¹æ¯”å¼€æºæ¨¡å‹&#34;&gt;å¯¹æ¯”å¼€æºæ¨¡å‹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2006.04558&#34;&gt;2020. FastSpeech 2: Fast and High-Quality End-to-End Text to Speech&lt;/a&gt; ä¸€ç§å¿«é€Ÿé-æ¦‚ç‡å£°å­¦æ¨¡å‹ | &lt;a href=&#34;https://github.com/ming024/FastSpeech2&#34;&gt;éå®˜æ–¹ code&lt;/a&gt;ï¼Œ Matcha-TTSçš„è®ºæ–‡ä¸­æåˆ°ç”¨ï¼Œæ”¹ä¸ºä½¿ç”¨ Meta çš„ &lt;a href=&#34;https://github.com/facebookresearch/fairseq&#34;&gt;https://github.com/facebookresearch/fairseq&lt;/a&gt; ä¸­çš„æ£€æŸ¥ç‚¹ï¼ˆckptï¼‰?ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2106.06103&#34;&gt;2021.6 &lt;strong&gt;VITS: Conditional Variational Autoencoder with Adversarial Learning for End-to-End Text-to-Speech&lt;/strong&gt;&lt;/a&gt; ä¸€ä¸ªå…·æœ‰ç¦»æ•£æ—¶é—´å½’ä¸€åŒ–æµçš„å¼ºå¤§æ¦‚ç‡ç«¯å¯¹ç«¯ TTS ç³»ç»Ÿ | &lt;a href=&#34;https://github.com/jaywalnut310/vits&#34;&gt;paper code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2105.06337&#34;&gt;2021.5 Grad-TTS: A Diffusion Probabilistic Model for Text-to-Speech&lt;/a&gt; ä¸€ç§åŸºäº DPM çš„å¼ºå¤§å£°å­¦æ¨¡å‹ | &lt;a href=&#34;https://github.com/huawei-noah/Speech-Backbones/tree/main/Grad-TTS&#34;&gt;paper code&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å¯¹æ¯”è¯„ä¼°&#34;&gt;å¯¹æ¯”è¯„ä¼°&lt;/h2&gt;
&lt;p&gt;ä»å†…å­˜ä½¿ç”¨é‡(æ¨¡å‹å‚æ•°)ï¼Œæ¨ç†é€Ÿåº¦ï¼Œä»¥åŠç”Ÿæˆè¯­éŸ³è´¨é‡ä¸‰ä¸ªæ–¹é¢è¯„ä¼°ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰ç³»ç»Ÿè®­ç»ƒæœŸé—´ï¼ˆæ‰¹é‡å¤§å°ä¸º 32 å’Œ fp16ï¼‰çš„å‚æ•°æ•°é‡å’Œæœ€å¤§å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä½¿ç”¨å†…å­˜å°;&lt;/li&gt;
&lt;li&gt;åœ¨è®­ç»ƒç³»ç»Ÿä¹‹åï¼Œæˆ‘ä»¬é€šè¿‡è®¡ç®—åœ¨æµ‹è¯•é›†ä¸Šåˆæˆæ—¶çš„å®æ—¶å› å­ï¼ˆRTFï¼‰çš„å¹³å‡å€¼å’Œæ ‡å‡†å·®ï¼Œä»¥åŠå°†Whisper medium ASRç³»ç»Ÿåº”ç”¨äºç»“æœæ—¶çš„å•è¯é”™è¯¯ç‡ï¼ˆWERï¼‰ï¼Œæ¥è¯„ä¼°ä¸åŒæ¡ä»¶çš„åˆæˆé€Ÿåº¦å’Œå¯ç†è§£æ€§ï¼›&lt;/li&gt;
&lt;li&gt;å¹³å‡æ„è§å¾—åˆ†ï¼ˆMOSï¼‰å¬åŠ›æµ‹è¯•(ä¼—åŒ…äººå·¥æµ‹è¯•)ï¼Œè¿™ä¸ªæ¯”è¾ƒæ„ä¹‰ä¸å¤§ï¼›&lt;/li&gt;
&lt;li&gt;è¯„ä¼°äº†ä¸åŒæ¨¡å‹çš„åˆæˆé€Ÿåº¦å¦‚ä½•éšç€è¯­å¥é•¿åº¦çš„å¢åŠ è€Œå˜åŒ–ï¼Œé€šè¿‡ä½¿ç”¨GPT-2æ¨¡å‹ç”Ÿæˆä¸åŒé•¿åº¦çš„180ä¸ªå¥å­ï¼Œè¯„ä¼°åˆæˆæ—¶é—´ï¼Œå¯¹é•¿å¥å­åˆæˆæ›´å¿«ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;p&gt;ç»“åˆä½œè€…ä»¥å‰çš„ç ”ç©¶æˆæœï¼Œéƒ½æ˜¯åœ¨3090ä¸Šè¿›è¡Œè®­ç»ƒï¼Œæ„é€ ç²¾ç®€å°è€Œç¾çš„ç»“æ„ï¼Œæ»¡è¶³åŸºæœ¬è¦æ±‚(æ­£å¸¸æ–‡æœ¬åˆ°è¯­éŸ³)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2108.13320&#34;&gt;2021.8 Neural HMMs are all you need (for high-quality attention-free TTS)&lt;/a&gt; | &lt;a href=&#34;https://github.com/shivammehta25/Neural-HMM&#34;&gt;paper code&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2211.06892&#34;&gt;2022.11 OverFlow: Putting flows on top of neural transducers for better TTS&lt;/a&gt; | &lt;a href=&#34;https://github.com/shivammehta25/OverFlow&#34;&gt;paper code&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“ï¼š&lt;/h1&gt;
&lt;p&gt;è®ºæ–‡å®ç°çš„ä»£ç ç»“æ„æ¸…æ™°ï¼Œæç‚¼çš„ç½‘ç»œç»“æ„å‚æ•°å°‘ï¼Œæ‰€éœ€ç¡¬ä»¶æˆæœ¬ä¸é«˜ï¼ŒæŒºé€‚åˆå¿«é€Ÿä¸Šæ‰‹è®­ç»ƒä¸€ä¸ªttsï¼Œç„¶åæ ¹æ®éœ€æ±‚å’Œæ‰€è¦è§£å†³çš„å®é™…é—®é¢˜ï¼ŒåŠ å…¥å…¶ä»–ç½‘ç»œç»“æ„ï¼Œå†å»æ¨è¿›å‡çº§ã€‚æ¯”å¦‚ VALL-E, Seed-TTS(éçº¯DiTç»“æ„)ï¼ŒCosyVoice åŸºäºå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰æˆä¸ºä¸»æµï¼Œç”Ÿæˆæ›´åŠ æ³›åŒ–(æ¶Œç°),ä½†æ˜¯æ‰€éœ€è®­ç»ƒæ•°æ®å’Œæ¨¡å‹ç½‘ç»œå‚æ•°å¤§(scaling)ï¼Œè®­ç»ƒæ¨ç†æˆæœ¬é«˜(è™½ç„¶æœ‰å¤§é‡çš„æ¨ç†ä¼˜åŒ–å·¥ä½œ)ã€‚ &lt;a href=&#34;https://arxiv.org/abs/2407.05407&#34;&gt;2024.7 CosyVoice: A Scalable Multilingual Zero-shot Text-to-speech Synthesizer based on Supervised Semantic Tokens&lt;/a&gt; | &lt;a href=&#34;https://arxiv.org/abs/2412.10117&#34;&gt;2024.12 CosyVoice 2: Scalable Streaming Speech Synthesis with Large Language Models&lt;/a&gt; | &lt;a href=&#34;https://github.com/FunAudioLLM/CosyVoice&#34;&gt;paper code&lt;/a&gt;&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>è®ºæ–‡è§£è¯»ï¼š VALL-E ç³»åˆ—</title>
      <link>https://weedge.github.io/post/multimoding/voices/vall-e-x/</link>
      <pubDate>Mon, 13 Jan 2025 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/multimoding/voices/vall-e-x/</guid>
      
        <description>&lt;p&gt;å‰æ–‡è®²åˆ°VITSï¼Œé‡‡ç”¨çš„ç«¯åˆ°ç«¯çš„NARæ¨¡å‹ï¼Œè¿™ç¯‡æ–‡ç« è®°å½•ä¸‹å¾®è½¯æå‡ºçš„VALL-Eç³»åˆ—ï¼Œä» AR+NAR åˆ° AR æ¨¡å‹çš„è½¬å˜ï¼Œä»¥åŠåé¢MELLEå¼•å…¥çš„VAEå’ŒMel-Spectorgramï¼Œå°†neural codec text speech LM (AR+NAR Transformer Decoder) è½¬å˜ä¸º  autoregressive  mel-spectrogram text speech LM  (AR Transformer Decoder) ï¼›ç”±äºLMç”Ÿæˆçš„æ˜¯mel-spectrogram éœ€è¦é€šè¿‡vocoder è½¬æ¢æˆ waveformï¼› ç”Ÿæˆçš„å†…å®¹é‡‡æ ·æ¨¡å—ï¼šä»top-p random sampling å˜æˆ Latent Samplingæ½œåœ¨é‡‡æ ·æ¨¡å—ï¼ˆæ€æƒ³æºè‡ªVAE, ä»é¢„æµ‹çš„é«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·æ½œåœ¨åµŒå…¥ï¼Œç„¶åå°†å…¶æŠ•å½±å›é¢‘è°±å›¾ç©ºé—´ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;vall-e-ç³»åˆ—&#34;&gt;VALL-E ç³»åˆ—&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://www.microsoft.com/en-us/research/project/vall-e-x/&#34;&gt;https://www.microsoft.com/en-us/research/project/vall-e-x/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Vall-E: &lt;a href=&#34;https://ar5iv.labs.arxiv.org/html/2301.02111&#34;&gt;https://ar5iv.labs.arxiv.org/html/2301.02111&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»ç°æˆçš„ç¥ç»éŸ³é¢‘ç¼–è§£ç å™¨æ¨¡å‹æ´¾ç”Ÿçš„ç¦»æ•£ä»£ç æ¥è®­ç»ƒ&lt;em&gt;&lt;strong&gt;ç¥ç»ç¼–è§£ç å™¨è¯­è¨€æ¨¡å‹ï¼ˆneural codec language modelï¼‰&lt;/strong&gt;&lt;/em&gt;ï¼ˆç§°ä¸ºVALL-E ï¼‰ï¼Œå¹¶å°† TTS è§†ä¸ºæ¡ä»¶è¯­è¨€å»ºæ¨¡ä»»åŠ¡ï¼Œè€Œä¸æ˜¯åƒä¹‹å‰çš„å·¥ä½œé‚£æ ·å°† TTS è§†ä¸ºè¿ç»­ä¿¡å·å›å½’ã€‚ åœ¨é¢„è®­ç»ƒé˜¶æ®µï¼Œæˆ‘ä»¬å°† TTS è®­ç»ƒæ•°æ®æ‰©å±•åˆ° 60K å°æ—¶çš„è‹±è¯­è¯­éŸ³ï¼Œæ¯”ç°æœ‰ç³»ç»Ÿå¤§æ•°ç™¾å€ã€‚ VALL-Eå…·æœ‰æƒ…å¢ƒå­¦ä¹ åŠŸèƒ½ï¼Œå¯ç”¨äºåˆæˆé«˜è´¨é‡çš„ä¸ªæ€§åŒ–è¯­éŸ³ï¼Œåªéœ€å¯¹çœ‹ä¸è§çš„è¯´è¯è€…è¿›è¡Œ 3 ç§’çš„æ³¨å†Œå½•éŸ³ä½œä¸ºå£°éŸ³æç¤ºã€‚å®éªŒç»“æœè¡¨æ˜ï¼Œ VALL-Eåœ¨è¯­éŸ³è‡ªç„¶åº¦å’Œè¯´è¯äººç›¸ä¼¼åº¦æ–¹é¢æ˜¾ç€ä¼˜äºæœ€å…ˆè¿›çš„é›¶æ ·æœ¬ TTS ç³»ç»Ÿã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å‘ç°VALL-Eå¯ä»¥åœ¨åˆæˆæ—¶ä¿ç•™è¯´è¯è€…çš„æƒ…æ„Ÿå’Œå£°éŸ³æç¤ºçš„å£°å­¦ç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;ä¸ä¹‹å‰çš„ç®¡é“ä¸åŒï¼ˆä¾‹å¦‚ï¼ŒéŸ³ç´  â†’ æ¢…å°”è°±å›¾ â†’ æ³¢å½¢ï¼‰ï¼Œ VALL-Eçš„ç®¡çº¿æ˜¯éŸ³ç´  â†’ ç¦»æ•£ç  â†’ æ³¢å½¢ã€‚&lt;/p&gt;
&lt;p&gt;VALL-Eæ ¹æ®éŸ³ç´ å’Œå£°å­¦ä»£ç æç¤ºç”Ÿæˆä¸ç›®æ ‡å†…å®¹å’Œè¯´è¯è€…çš„å£°éŸ³ç›¸å¯¹åº”çš„ç¦»æ•£éŸ³é¢‘ç¼–è§£ç å™¨ä»£ç ã€‚ VALL-Eç›´æ¥æ”¯æŒå„ç§è¯­éŸ³åˆæˆåº”ç”¨ï¼Œä¾‹å¦‚é›¶æ ·æœ¬ TTSã€è¯­éŸ³ç¼–è¾‘ä»¥åŠä¸ GPT-3 ç­‰å…¶ä»–ç”Ÿæˆå¼ AI æ¨¡å‹ç›¸ç»“åˆçš„å†…å®¹åˆ›å»ºã€‚&lt;/p&gt;
&lt;p&gt;VALL-Eç³»åˆ—ï¼š2023å¹´çš„1æœˆä»½å¼€å§‹ - 2024å¹´çš„7æœˆä»½&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;VALL-E ä½¿ç”¨ä»ç°æˆçš„ç¥ç»éŸ³é¢‘ç¼–è§£ç å™¨æ¨¡å‹æ´¾ç”Ÿçš„ç¦»æ•£ä»£ç æ¥è®­ç»ƒç¥ç»ç¼–è§£ç å™¨è¯­è¨€æ¨¡å‹ï¼Œå¹¶å°† TTS è§†ä¸ºæ¡ä»¶è¯­è¨€å»ºæ¨¡ä»»åŠ¡ï¼Œè€Œä¸æ˜¯åƒä¹‹å‰çš„å·¥ä½œé‚£æ ·å°† TTS è§†ä¸ºè¿ç»­ä¿¡å·å›å½’ã€‚ VALL-E å…·æœ‰æƒ…å¢ƒå­¦ä¹ åŠŸèƒ½ï¼Œå¯ç”¨äºåˆæˆé«˜è´¨é‡çš„ä¸ªæ€§åŒ–è¯­éŸ³ï¼Œåªéœ€å½•åˆ¶æœªè§è¿‡çš„è®²è¯è€…çš„ 3 ç§’æ³¨å†Œå½•éŸ³ä½œä¸ºæç¤ºã€‚åœ¨è¯­éŸ³è‡ªç„¶åº¦å’Œè¯´è¯äººç›¸ä¼¼åº¦æ–¹é¢ï¼ŒVALL-E æ˜¾ç€ä¼˜äºæœ€å…ˆè¿›çš„é›¶æ ·æœ¬ TTS ç³»ç»Ÿã€‚æ­¤å¤–ï¼ŒVALL-Eå¯ä»¥åœ¨åˆæˆæ—¶ä¿ç•™è¯´è¯è€…çš„æƒ…ç»ªå’Œå£°éŸ³æç¤ºçš„å£°å­¦ç¯å¢ƒã€‚&lt;/li&gt;
&lt;li&gt;VALL-E X æ‰©å±•å…¶èƒ½åŠ›ï¼Œé€‚åº”å¤šè¯­è¨€åœºæ™¯ï¼Œä¿ƒè¿›è·¨è¯­è¨€é›¶æ ·æœ¬ TTSã€‚&lt;/li&gt;
&lt;li&gt;VALL-E R å¼•å…¥äº†éŸ³ç´ å•è°ƒå¯¹é½ç­–ç•¥ï¼Œå¢å¼ºäº†è¯­éŸ³ç”Ÿæˆçš„é²æ£’æ€§ã€‚&lt;/li&gt;
&lt;li&gt;VALL-E 2 é€šè¿‡é›†æˆé‡å¤æ„ŸçŸ¥é‡‡æ ·å’Œåˆ†ç»„ä»£ç å»ºæ¨¡æŠ€æœ¯ï¼Œ å®ç°äº†ä¸€ä¸ªçªç ´æ€§çš„é‡Œç¨‹ç¢‘ï¼šåœ¨ LibriSpeech å’Œ VCTK æ•°æ®é›†ä¸Šçš„é›¶æ ·æœ¬ TTS æ€§èƒ½ä¸äººç±»ç›¸å½“ã€‚è¿™æ ‡å¿—ç€æ­¤ç±»æˆå°±çš„é¦–æ¬¡å®ä¾‹ï¼Œä¸ºè¯¥é¢†åŸŸæ ‘ç«‹äº†æ–°æ ‡å‡†ã€‚&lt;/li&gt;
&lt;li&gt;MELLE æ˜¯ä¸€ç§æ–°é¢–çš„åŸºäºè¿ç»­å€¼æ ‡è®°çš„è¯­è¨€å»ºæ¨¡æ–¹æ³•ï¼Œç”¨äºæ–‡æœ¬åˆ°è¯­éŸ³åˆæˆ (TTS)ã€‚ MELLE ç›´æ¥ä»æ–‡æœ¬æ¡ä»¶è‡ªå›å½’ç”Ÿæˆè¿ç»­çš„æ¢…å°”é¢‘è°±å›¾å¸§ï¼Œç»•è¿‡äº†çŸ¢é‡é‡åŒ–çš„éœ€è¦ï¼ŒçŸ¢é‡é‡åŒ–æœ€åˆæ˜¯ä¸ºéŸ³é¢‘å‹ç¼©è€Œè®¾è®¡çš„ï¼Œä¸æ¢…å°”é¢‘è°±å›¾ç›¸æ¯”ï¼Œç‰ºç‰²äº†ä¿çœŸåº¦ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/9551079c-03b9-4b7e-8b94-fce8e3e5a408&#34; alt=&#34;image&#34;&gt;&lt;/p&gt;
&lt;p&gt;å­—èŠ‚çš„seed-tts å€Ÿé‰´äº†Vall-Eæ¨¡å‹(ç”¨æ‰©æ•£æ¨¡å‹æ›¿æ¢äº† VALL-E ä¸­çš„ NAR æ¨¡å‹ï¼Œè¯¥æ¨¡å‹æ ¹æ® AR é˜¶æ®µç”Ÿæˆçš„è¯­éŸ³æ ‡è®°ç”Ÿæˆè¿ç»­çš„è¯­éŸ³è¡¨ç¤º)&lt;/p&gt;
&lt;h2 id=&#34;melle&#34;&gt;MELLE&lt;/h2&gt;
&lt;p&gt;æœ€æ–°ç ”ç©¶åˆ°2024å¹´çš„7æœˆä»½ï¼Œ MELLEï¼š ä¸€ç§æ–°é¢–çš„åŸºäºè¿ç»­å€¼æ ‡è®°çš„è¯­è¨€å»ºæ¨¡æ–¹æ³•ï¼Œç”¨äºæ–‡æœ¬åˆ°è¯­éŸ³åˆæˆ (TTS)ã€‚ MELLE ç›´æ¥ä»æ–‡æœ¬æ¡ä»¶è‡ªå›å½’ç”Ÿæˆè¿ç»­çš„æ¢…å°”é¢‘è°±å›¾å¸§ï¼Œç»•è¿‡äº†çŸ¢é‡é‡åŒ–çš„éœ€è¦ï¼ŒçŸ¢é‡é‡åŒ–æœ€åˆæ˜¯ä¸ºéŸ³é¢‘å‹ç¼©è€Œè®¾è®¡çš„ï¼Œä¸æ¢…å°”é¢‘è°±å›¾ç›¸æ¯”ï¼Œç‰ºç‰²äº†ä¿çœŸåº¦ã€‚å…·ä½“æ¥è¯´ï¼Œï¼ˆiï¼‰ä¸æ˜¯ä½¿ç”¨äº¤å‰ç†µæŸå¤±ï¼Œè€Œæ˜¯åº”ç”¨å›å½’æŸå¤±å’Œæ‰€æå‡ºçš„é¢‘è°±å›¾é€šé‡æŸå¤±å‡½æ•°æ¥å¯¹è¿ç»­å€¼æ ‡è®°çš„æ¦‚ç‡åˆ†å¸ƒè¿›è¡Œå»ºæ¨¡ã€‚ (ii) å°†å˜åˆ†æ¨ç†çº³å…¥ MELLE ä¸­ä»¥ä¿ƒè¿›é‡‡æ ·æœºåˆ¶ï¼Œä»è€Œå¢å¼ºè¾“å‡ºå¤šæ ·æ€§å’Œæ¨¡å‹é²æ£’æ€§ã€‚
æ²¡æœ‰é‡‡ç”¨audio encodec, è€Œæ˜¯é‡‡ç”¨ æ¢…å°”é¢‘è°±å›¾ Mel-Spectrogram æŠ½å–å™¨ï¼Œé€šè¿‡ Mel-Spectrogram LMç”Ÿæˆ Mel-Spectrogramï¼Œ ç„¶åå°†Mel-Spectrogram é€šè¿‡ vocoder ç”Ÿæˆ waveform
MELLEåŒ…æ‹¬ä»¥ä¸‹ä¸»è¦ç»„ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;pre-netsï¼š
&lt;ul&gt;
&lt;li&gt;text tokenizer: åˆ†åˆ«å°†æ–‡æœ¬è½¬æ¢ä¸ºå­è¯æ ‡è®°(BPE),&lt;/li&gt;
&lt;li&gt;mel-spectrogram extractor: ä»è¯­éŸ³ä¸­æå–æ¢…å°”é¢‘è°±å›¾ï¼Œ&lt;/li&gt;
&lt;li&gt;ç„¶åå°†å®ƒä»¬æŠ•å½±åˆ°æ¨¡å‹ç»´åº¦ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;autoregressive (AR) Transformer decoderï¼š å……å½“è¯­è¨€æ¨¡å‹çš„è‡ªå›å½’ (AR) Transformer è§£ç å™¨ï¼›&lt;/li&gt;
&lt;li&gt;latent sampling moduleï¼š ä»é¢„æµ‹çš„é«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·æ½œåœ¨åµŒå…¥ï¼Œç„¶åå°†å…¶æŠ•å½±å›é¢‘è°±å›¾ç©ºé—´ï¼›&lt;/li&gt;
&lt;li&gt;stop prediction layerï¼š ç¡®å®šè¯­éŸ³ç»“å°¾çš„åœæ­¢é¢„æµ‹å±‚ï¼›&lt;/li&gt;
&lt;li&gt;post-netï¼šé¢‘è°±å›¾ç»†åŒ–çš„å·ç§¯åç½‘ç»œã€‚&lt;/li&gt;
&lt;li&gt;vocoderï¼šæœ€åï¼Œä½¿ç”¨å£°ç å™¨ä»ç”Ÿæˆçš„æ¢…å°”é¢‘è°±å›¾ä¸­æ¢å¤è¯­éŸ³ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å…¶ä¸­å¼•å…¥VAEå’ŒMel-Spectorgram å€Ÿé‰´äº†&lt;a href=&#34;https://arxiv.org/abs/2404.02781&#34;&gt;2024. CLaM-TTS: Improving Neural Codec Language Modeling for Zero-shot Text-to-Speech&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/baf84eb2-379c-4240-93af-4c2ab3d10552&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸åƒVALL-Eç³»åˆ—æ¨¡å‹ï¼Œç”±äºæ¢…å°”è°±å›¾çš„å®Œæ•´æ€§ï¼Œä¸éœ€è¦é¢å¤–çš„éè‡ªå›å½’ï¼ˆNARï¼‰æ¨¡å‹ã€‚è¿™ç§ç®€åŒ–æ˜¾ç€æé«˜äº†è®¡ç®—å’Œå­˜å‚¨æ•ˆç‡ã€‚æ­¤å¤–ï¼Œé€šè¿‡è°ƒæ•´ç¼©å‡å› å­ï¼Œ MELLEå¯ä»¥ä¸€æ­¥ç”Ÿæˆå¤šä¸ªæ¢…å°”è°±å›¾å¸§ï¼Œè¿›ä¸€æ­¥æé«˜æ•ˆç‡ï¼ŒåŒæ—¶ä»ä¿æŒå“è¶Šçš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ä½“æ¥è¯´ï¼š
ä¸»è¦ç›®çš„æ˜¯å°† &lt;strong&gt;æ–‡æœ¬å’Œå£°å­¦åµŒå…¥çš„ä¸²è”ä½œä¸ºè¾“å…¥æ¥å¯¹è¯­ä¹‰å’Œå£°å­¦ä¿¡æ¯ä¹‹é—´çš„ä¾èµ–å…³ç³»è¿›è¡Œå»ºæ¨¡&lt;/strong&gt;ï¼Œç”Ÿæˆçš„éšè—å±‚è¿›è¡Œé‡‡æ ·ï¼Œé€šè¿‡audio codec decoder ç›´æ¥ç”Ÿæˆ waveform æˆ–è€… ç”Ÿæˆ Mel-Spectrogram ç„¶åç”Ÿæˆ waveform&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;VALL-E ç³»åˆ—ï¼štext-speech LM æ˜¯ AR å’Œ NAR çš„ç»„åˆæ¨¡å‹ï¼›text tokenizerä½¿ç”¨ phonemizer/pypinyinï¼ˆä¸­æ–‡ï¼‰, audio tokenizer ä½¿ç”¨ audio codec encode/decode ï¼› ç”Ÿæˆçš„å†…å®¹é‡‡æ ·æ¨¡å—ï¼štop-p random sampling&lt;/li&gt;
&lt;li&gt;MELLE ï¼š tex-speech LM æ˜¯ AR æ¨¡å‹ï¼› text tokenizerä½¿ç”¨ BPE, audio tokenizer ä½¿ç”¨  mel-spectrograms extractor; ç”±äºLMç”Ÿæˆçš„æ˜¯mel-spectrogram éœ€è¦é€šè¿‡vocoder è½¬æ¢æˆ waveformï¼› ç”Ÿæˆçš„å†…å®¹é‡‡æ ·æ¨¡å—ï¼šLatent Samplingæ½œåœ¨é‡‡æ ·æ¨¡å—ï¼ˆæ€æƒ³æºè‡ªVAE, ä»é¢„æµ‹çš„é«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·æ½œåœ¨åµŒå…¥ï¼Œç„¶åå°†å…¶æŠ•å½±å›é¢‘è°±å›¾ç©ºé—´ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;PS: è¿˜æœ‰ä¸€ç§é‡‡æ ·æ¨¡å—ï¼š åŸºäºFlow matching æµåŒ¹é…çš„æ–¹å¼ï¼Œä»æ›´ç®€å•çš„åˆ†å¸ƒé‡‡æ ·ä¸­æ¢å¤è¯­éŸ³è¡¨ç¤ºã€‚æ¯”å¦‚: metaçš„ &lt;a href=&#34;https://arxiv.org/abs/2306.15687&#34;&gt;2023. Voicebox: Text-Guided Multilingual Universal Speech Generation at Scale&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä¸»è¦æ˜¯å­¦ä¹ åœ¨TTSä¸­å¼•å…¥GLMï¼Œå¦‚ä½•è®­ç»ƒã€‚&lt;/p&gt;
&lt;p&gt;å®˜æ–¹æ²¡æœ‰ç»™å‡ºæºç å’Œè®­ç»ƒå¥½çš„æƒé‡ï¼Œ è¿™é‡Œåªæ˜¯ä¸ºä¾‹å­¦ä¹ ARï¼ˆç”Ÿæˆå¼è¯­è¨€æ¨¡å‹GLMï¼‰å’ŒNARçš„ç»“åˆï¼Œ&lt;/p&gt;
&lt;p&gt;éå®˜æ–¹å®ç°ï¼š &lt;a href=&#34;https://github.com/lifeiteng/vall-e&#34;&gt;https://github.com/lifeiteng/vall-e&lt;/a&gt; (åªå®ç°äº†ç¬¬ä¸€ç‰ˆvall-e, å…¶å®ç±»ä¼¼è®­ç»ƒæ–‡æœ¬LLMä¸€æ ·çš„æ­¥éª¤ï¼Œå¢åŠ äº†æ–‡æœ¬è½¬éŸ³ç´ ï¼ŒåŠ ä¸Šè¯­éŸ³çš„tokenizer, é‡‡ç”¨çš„Transform decoderï¼Œ ARæ¨¡å‹éœ€è¦æ©ç self-Attentionï¼Œ NARåˆ™ä¸éœ€è¦æ©ç æ“ä½œï¼Œæ–‡æœ¬åˆ°éŸ³ç´ é‡‡ç”¨ &lt;a href=&#34;https://github.com/bootphon/phonemizer&#34;&gt;https://github.com/bootphon/phonemizer&lt;/a&gt; , audio codec ä½¿ç”¨ &lt;a href=&#34;https://github.com/facebookresearch/encodec&#34;&gt;https://github.com/facebookresearch/encodec&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;æ•°æ®é›†å¤„ç†å·¥å…·ä½¿ç”¨ &lt;a href=&#34;https://github.com/lhotse-speech/lhotse&#34;&gt;https://github.com/lhotse-speech/lhotse&lt;/a&gt;ï¼›ä¸»è¦æ˜¯æ•°æ®å¤„ç†æ¯”è¾ƒè€—æ—¶ã€‚å¯ä»¥å…ˆå°æ•°æ®éªŒè¯è®­ç»ƒé€»è¾‘ï¼Œç„¶ååœ¨scalingã€‚&lt;/p&gt;
&lt;p&gt;PS: åç»­å¯ä»¥æ”¹è¿›ä¸‹ï¼Œå°½é‡å¤ç°ä¸‹MELLE, éœ€è¦èŠ±ç‚¹é’± :(&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>è®ºæ–‡è§£è¯» VITS: Conditional Variational Autoencoder with Adversarial Learning for End-to-End Text-to-Speech</title>
      <link>https://weedge.github.io/post/multimoding/voices/vits/</link>
      <pubDate>Sat, 11 Jan 2025 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/multimoding/voices/vits/</guid>
      
        <description>&lt;p&gt;å‰æ–‡è®²åˆ°OpenVoicev2ï¼Œè¡¥å……ä¸‹ç»†èŠ‚ï¼Œç„¶åæ¢³ç†ä½¿ç”¨çš„åŸºç¡€æ¨¡å‹VITSï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ““&lt;/p&gt;
&lt;p&gt;melo-tts ç”ŸæˆåŸå§‹éŸ³é¢‘ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;OpenVoice ç‰ˆæœ¬1ä¸ä¾èµ–melo-tts, å‡çº§åçš„V2ç‰ˆæœ¬ä¾èµ–melo-tts, ä¸»è¦æ˜¯ç”ŸæˆåŸå§‹éŸ³é¢‘è´¨é‡åŠ å¼ºäº†(ç”±melo-ttsç”Ÿæˆ);&lt;/li&gt;
&lt;li&gt;é»˜è®¤é…ç½®ä½¿ç”¨äº†TransformerCouplingBlock listä½œä¸ºflow å’Œ reverse flow, è€Œç¬¬ä¸€ç‰ˆçš„OpenVoice æ¨¡å‹ä½¿ç”¨çš„ ResidualCouplingBlock ;&lt;/li&gt;
&lt;li&gt;melo-ttsçš„æ¨¡å‹æƒé‡æ”¯æŒå¤šè¯­è¨€ï¼Œæ›´å…·è¯­è¨€åŒºåˆ†ï¼Œæ¯”å¦‚ ZH: &lt;a href=&#34;https://huggingface.co/myshell-ai/MeloTTS-Chinese&#34;&gt;myshell-ai/MeloTTS-Chinese&lt;/a&gt;, EN_NEWEST: &lt;a href=&#34;https://huggingface.co/myshell-ai/MeloTTS-English-v3&#34;&gt;myshell-ai/MeloTTS-English-v3&lt;/a&gt;;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;éŸ³è‰²è½¬æ¢ç”Ÿæˆç›®æ ‡éŸ³é¢‘ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡è®­ç»ƒå¥½çš„&lt;strong&gt;éŸ³è‰²æŠ½å–å™¨&lt;/strong&gt;æŠ½å–ç›®æ ‡è¯´è¯è€…çš„éŸ³è‰² (&lt;a href=&#34;https://huggingface.co/myshell-ai/OpenVoiceV2/tree/main/base_speakers/ses&#34;&gt;myshell-ai/OpenVoiceV2/converter&lt;/a&gt;)ï¼›&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆçš„åŸå§‹éŸ³é¢‘ä¿¡æ¯é€šè¿‡ è®­ç»ƒæŠ½å–å¥½çš„åŸºç¡€è¯´è¯è€…çš„éŸ³è‰²(&lt;a href=&#34;https://huggingface.co/myshell-ai/OpenVoiceV2/tree/main/converter&#34;&gt;myshell-ai/OpenVoiceV2/base_speakers/ses&lt;/a&gt;)ï¼Œå°†åŸå§‹éŸ³é¢‘ä¸­çš„éŸ³è‰²å»é™¤ ï¼ˆflowï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;å°†å»é™¤åŸå§‹éŸ³è‰²çš„éŸ³é¢‘ å’Œ æŠ½å–å¥½çš„ç›®æ ‡è¯´è¯è€…çš„éŸ³è‰² åˆå¹¶ ï¼ˆreverse flowï¼‰ï¼› æœ€ç»ˆé€šè¿‡ vocoder(ä¹Ÿæ˜¯è®ºæ–‡ä¸­çš„Decoder,ä½¿ç”¨çš„ HiFi-Ganæ¨¡å‹)åˆæˆç›®æ ‡éŸ³é¢‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é¢å¤–æ³¨æ„çš„æ˜¯ï¼Œç”±melo-ttsç”ŸæˆåŸå§‹éŸ³é¢‘sample rateæ˜¯ 44100ï¼Œ è€Œé€šè¿‡éŸ³è‰²æå–å™¨ æå– å¹¶ä¸” ç”Ÿæˆç›®æ ‡éŸ³é¢‘sample rateæ˜¯ 22050&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å‰æçŸ¥è¯†è¿™é‡Œç®€å•æ¦‚æ‹¬å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;AE(Autoencoder): è‡ªç¼–ç å™¨æ˜¯&lt;a href=&#34;https://www.ibm.com/cn-zh/topics/self-supervised-learning&#34;&gt;è‡ªç›‘ç£&lt;/a&gt;ç³»ç»Ÿï¼Œå…¶è®­ç»ƒç›®æ ‡æ˜¯é€šè¿‡é™ç»´æ¥å‹ç¼©ï¼ˆæˆ–&lt;em&gt;ç¼–ç &lt;/em&gt;ï¼‰è¾“å…¥æ•°æ®ï¼Œç„¶åä½¿ç”¨è¯¥å‹ç¼©åçš„è¡¨ç¤ºå‡†ç¡®é‡å»ºï¼ˆæˆ–&lt;em&gt;è§£ç &lt;/em&gt;ï¼‰å…¶åŸå§‹è¾“å…¥ã€‚æ— æ³›åŒ–ç”Ÿæˆèƒ½åŠ›ï¼Œä½†æ˜¯å¯ä»¥æ‰§è¡Œç‰¹å®šä»»åŠ¡ï¼šå¸¸ç”¨äºæ•°æ®å‹ç¼©ã€å›¾åƒå»å™ªã€å¼‚å¸¸æ£€æµ‹å’Œé¢éƒ¨è¯†åˆ«ç­‰ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;VAE(Variational Autoencoder)&lt;/strong&gt; :ä¸å…¶ä»–è‡ªç¼–ç å™¨(Autoencoder(AE)çš„åŒºåˆ«åœ¨äºå®ƒä»¬å¯¹æ½œåœ¨ç©ºé—´è¿›è¡Œç¼–ç çš„ç‹¬ç‰¹æ–¹å¼ï¼Œä»¥åŠå¯ä»¥åº”ç”¨å…¶æ¦‚ç‡ç¼–ç çš„ä¸åŒç”¨ä¾‹ï¼Œå³éšæœºç”Ÿæˆè®­ç»ƒæ•°æ®çš„å˜ä½“ã€‚å…·æœ‰æ³›åŒ–ç”Ÿæˆèƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;CVAE(Conditional Variational Autoencoder)&lt;/strong&gt;: æ¡ä»¶å˜åˆ†è‡ªç¼–ç å™¨ å¯ä»¥ä»¥ç‰¹å®šè¾“å…¥ä¸ºæ¡ä»¶è¿›è¡Œè¾“å‡ºï¼Œè€Œä¸ä»…ä»…æ˜¯éšæœºç”Ÿæˆè®­ç»ƒæ•°æ®çš„å˜ä½“ã€‚è¿™æ˜¯é€šè¿‡å°†ç›‘ç£å­¦ä¹ ï¼ˆæˆ–åŠç›‘ç£å­¦ä¹ ï¼‰çš„å…ƒç´ ä¸å¸¸è§„è‡ªç¼–ç å™¨çš„ä¼ ç»Ÿæ— ç›‘ç£è®­ç»ƒç›®æ ‡ç›¸ç»“åˆæ¥å®ç°çš„ã€‚å…·æœ‰æŒ‡å®šç‰¹å¾çš„æ³›åŒ–èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;VAE ä¸ GANçš„åŒºåˆ«ï¼š&lt;/p&gt;
&lt;p&gt;VAE ç»å¸¸ä¸ç”Ÿæˆå¼å¯¹æŠ—ç½‘ç»œ (GAN) è¿›è¡Œæ¯”è¾ƒï¼ŒGAN æ˜¯å¦ä¸€ç§æ¨¡å‹æ¶æ„ï¼Œç”¨äºç”Ÿæˆç±»ä¼¼äºè®­ç»ƒæ•°æ®çš„æ ·æœ¬ï¼Œå°¤å…¶æ˜¯å›¾åƒã€‚&lt;/p&gt;
&lt;p&gt;ä¸ VAE ç±»ä¼¼ï¼ŒGAN æ˜¯ç»“åˆä¸¤ç§ç¥ç»ç½‘ç»œçš„è”åˆæ¶æ„ï¼šä¸€ä¸ªç”Ÿæˆå™¨ç½‘ç»œï¼Œè´Ÿè´£è¾“å‡ºä¸è®­ç»ƒæ•°æ®é›†ä¸­çš„å›¾åƒç›¸ä¼¼çš„å›¾åƒæ ·æœ¬ï¼Œå¦ä¸€ä¸ªåˆ¤åˆ«å™¨ç½‘ç»œï¼Œè´Ÿè´£ç¡®å®šç‰¹å®šå›¾åƒæ˜¯è®­ç»ƒæ•°æ®ä¸­çš„â€œçœŸå®â€å›¾åƒè¿˜æ˜¯æ¥è‡ªç”Ÿæˆå™¨ç½‘ç»œçš„â€œè™šå‡â€å›¾åƒã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªç½‘ç»œåœ¨é›¶å’Œåšå¼ˆä¸­è¿›è¡Œå¯¹æŠ—æ€§è®­ç»ƒï¼šæ¥è‡ªåˆ¤åˆ«å™¨çš„åé¦ˆç”¨äºæ”¹è¿›ç”Ÿæˆå™¨çš„è¾“å‡ºï¼Œç›´åˆ°åˆ¤åˆ«å™¨ä¸å†èƒ½å¤ŸåŒºåˆ†çœŸå‡æ ·æœ¬ã€‚&lt;/p&gt;
&lt;p&gt;å°±å›¾åƒåˆæˆè€Œè¨€ï¼Œä¸¤è€…å„æœ‰ä¼˜åŠ£ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GAN å¯ä»¥ç”Ÿæˆæ›´æ¸…æ™°çš„å›¾åƒï¼Œä½†ç”±äºä¸¤ç§å¤åˆæ¨¡å‹ä¹‹é—´çš„å¯¹æŠ—æ€§æƒè¡¡ï¼Œåœ¨è®­ç»ƒä¸­å¹¶ä¸ç¨³å®šã€‚&lt;/li&gt;
&lt;li&gt;VAE æ›´å®¹æ˜“è®­ç»ƒï¼Œä½†ç”±äºå…¶æ ¹æ®è®­ç»ƒæ•°æ®çš„â€œå¹³å‡â€ç‰¹å¾ç”Ÿæˆå›¾åƒçš„æ€§è´¨ï¼Œå¾€å¾€ä¼šç”Ÿæˆæ¯”è¾ƒæ¨¡ç³Šçš„å›¾åƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;VAE-GAN ä¸¤è€…ç»“åˆ
é¡¾åæ€ä¹‰ï¼ŒVAE-GAN æ˜¯å˜åˆ†è‡ªç¼–ç å™¨ (VAE) å’Œç”Ÿæˆå¼å¯¹æŠ—ç½‘ç»œ (GAN) çš„æ··åˆä½“ã€‚é€šè¿‡ç”¨åˆ¤åˆ«å™¨ç½‘ç»œæ›¿æ¢ VAE æ¨¡å‹çš„é‡å»ºæŸå¤±é¡¹ï¼Œæ¥é™ä½ VAE ç”Ÿæˆå›¾åƒçš„æ¨¡ç³Šæ€§ï¼Œæé«˜ç”Ÿæˆè´¨é‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;VITS ä½¿ç”¨äº† æ¡ä»¶å˜åˆ†è‡ªç¼–ç å™¨ (Conditional Variational Autoencoder (CVAE)) å’Œç”Ÿæˆå¼å¯¹æŠ—ç½‘ç»œ (&lt;a href=&#34;https://en.wikipedia.org/wiki/Generative_adversarial_network&#34;&gt;Generative adversarial network&lt;/a&gt;(GAN)) ä¸¤ä¸ªæ¨¡å‹æ¶æ„ã€‚ è‡³äºVAEå’ŒGANçš„ç»†èŠ‚å¯ä»¥å…³æ³¨ä¸‹baby-llmè¿™ä¸ªå­¦ä¹ é¡¹ç›®ä¸­çš„å¯¹åº”æ¨¡å—PRå­¦ä¹ èµ„æ–™:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;VAE: &lt;a href=&#34;https://github.com/ai-bot-pro/baby-llm/tree/main/modules/VAE&#34;&gt;https://github.com/ai-bot-pro/baby-llm/tree/main/modules/VAE&lt;/a&gt; | PR:  &lt;a href=&#34;https://github.com/ai-bot-pro/baby-llm/pull/13&#34;&gt;https://github.com/ai-bot-pro/baby-llm/pull/13&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;GAN: &lt;a href=&#34;https://github.com/ai-bot-pro/baby-llm/tree/main/modules/GAN&#34;&gt;https://github.com/ai-bot-pro/baby-llm/tree/main/modules/GAN&lt;/a&gt; | PR: &lt;a href=&#34;https://github.com/ai-bot-pro/baby-llm/pull/12&#34;&gt;https://github.com/ai-bot-pro/baby-llm/pull/12&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« æ˜¯è®²è§£VITSï¼Œæ˜¯ç°åœ¨å·¥ä¸šä¸ŠTTSå¸¸ç”¨çš„åŸºç¡€æ–¹æ¡ˆ(NARæ¨¡å‹ï¼Œæˆæœ¬ç›¸å¯¹ARæ¨¡å‹ä½ï¼Œ æ¨ç†å¿«ï¼Œç”Ÿæˆè´¨é‡å°½å¯èƒ½è¿½å¹³æˆ–è¶…è¶ŠSOTA ARæ¨¡å‹)ã€‚ä½œè€…æ¥è‡ªéŸ©å›½ç°ä»£æ±½è½¦å…¬å¸çš„ AIR å®éªŒå®¤ï¼ˆäººå·¥æ™ºèƒ½ç ”ç©¶å®éªŒå®¤ï¼‰ï¼Œè®ºæ–‡ç»“åˆäº†ä»¥å‰çš„ç ”ç©¶æˆæœï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/1811.02155&#34;&gt;2018. &lt;strong&gt;FloWaveNet : A Generative Flow for Raw Audio&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2005.11129&#34;&gt;2020. &lt;strong&gt;Glow-TTS: A Generative Flow for Text-to-Speech via Monotonic Alignment Search&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2010.05646&#34;&gt;2020. &lt;strong&gt;HiFi-GAN: Generative Adversarial Networks for Efficient and High Fidelity Speech Synthesis&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åç»­ä½œè€…è¿˜ç ”ç©¶äº†åŠ å…¥æ‰©æ•£æ¨¡å‹æ¥ç”Ÿæˆè¯­éŸ³ï¼Œä¸éœ€è¦ä½¿ç”¨åˆ†ç±»å™¨æŒ‡å¯¼çš„ç›®æ ‡è¯´è¯è€…çš„ä»»ä½•è½¬å½•ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2111.11755&#34;&gt;2022. Guided-TTS: A Diffusion Model for Text-to-Speech via Classifier Guidance&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Guided-TTS å°†æ— æ¡ä»¶æ‰©æ•£æ¦‚ç‡æ¨¡å‹(unconditional Diffusion Model)ä¸å•ç‹¬è®­ç»ƒçš„éŸ³ç´ åˆ†ç±»å™¨(phoneme classifier )ç›¸ç»“åˆï¼Œç”¨äºåˆ†ç±»å™¨æŒ‡å¯¼ã€‚æ— æ¡ä»¶æ‰©æ•£æ¨¡å‹å­¦ä¹ åœ¨æ²¡æœ‰ä»»ä½•ä¸Šä¸‹æ–‡çš„æƒ…å†µä¸‹ä»æœªè½¬å½•çš„è¯­éŸ³æ•°æ®ä¸­ç”Ÿæˆè¯­éŸ³ã€‚å¯¹äº TTS åˆæˆï¼Œä½¿ç”¨åœ¨å¤§è§„æ¨¡è¯­éŸ³è¯†åˆ«æ•°æ®é›†ä¸Šè®­ç»ƒçš„éŸ³ç´ åˆ†ç±»å™¨æ¥æŒ‡å¯¼æ‰©æ•£æ¨¡å‹çš„ç”Ÿæˆè¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h1 id=&#34;vits&#34;&gt;VITS&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2106.06103&#34;&gt;2021. &lt;strong&gt;Conditional Variational Autoencoder with Adversarial Learning for End-to-End Text-to-Speech&lt;/strong&gt;&lt;/a&gt;  | &lt;a href=&#34;https://github.com/jaywalnut310/vits&#34;&gt;paper coder&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸»è¦è´¡çŒ®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æå‡ºäº†ä¸€ç§å¹¶è¡Œçš„ç«¯åˆ°ç«¯ TTS æ–¹æ³•ï¼Œå®ƒå¯ä»¥ç”Ÿæˆæ¯”å½“å‰ä¸¤é˜¶æ®µæ¨¡å‹æ›´è‡ªç„¶çš„éŸ³é¢‘ï¼›&lt;/li&gt;
&lt;li&gt;é‡‡ç”¨é€šè¿‡å½’ä¸€åŒ–æµç¨‹å’Œå¯¹æŠ—æ€§è®­ç»ƒè¿‡ç¨‹å¢å¼ºçš„å˜åˆ†æ¨ç†ï¼Œæé«˜äº†ç”Ÿæˆæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ï¼›&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªéšæœºæŒç»­æ—¶é—´é¢„æµ‹å™¨ï¼ˆstochastic duration predictorï¼‰æ¥ä»è¾“å…¥æ–‡æœ¬ä¸­åˆæˆå…·æœ‰ä¸åŒèŠ‚å¥çš„è¯­éŸ³ï¼›&lt;/li&gt;
&lt;li&gt;é€šè¿‡å¯¹æ½œåœ¨å˜é‡çš„ä¸ç¡®å®šæ€§å»ºæ¨¡å’ŒéšæœºæŒç»­æ—¶é—´é¢„æµ‹å™¨ï¼Œè¡¨è¾¾äº†è‡ªç„¶çš„ä¸€å¯¹å¤šå…³ç³»ï¼Œå…¶ä¸­æ–‡æœ¬è¾“å…¥å¯ä»¥ä»¥ä¸åŒçš„éŸ³è°ƒï¼ˆpitchesï¼‰å’ŒèŠ‚å¥ï¼ˆrhythmsï¼‰ä»¥å¤šç§æ–¹å¼è¯´å‡ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é€šè¿‡åˆ©ç”¨æ¡ä»¶å˜åˆ†è‡ªç¼–ç å™¨ CVAEï¼Œæ¨¡å‹ç‰¹ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å­¦ä¹ ç›´æ¥ä»æ–‡æœ¬åˆæˆåŸå§‹æ³¢å½¢ï¼Œè€Œä¸éœ€è¦é¢å¤–çš„è¾“å…¥æ¡ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨åŠ¨æ€ç¼–ç¨‹æ–¹æ³• MAS æ¥æœç´¢æœ€ä½³å¯¹é½æ–¹å¼ï¼Œè€Œä¸æ˜¯ä¸è®¡ç®—æŸå¤±ç›¸æ¯”,ä¸éœ€è¦ä»»ä½•å¤–éƒ¨å¯¹é½å™¨ï¼›&lt;/li&gt;
&lt;li&gt;å¹¶è¡Œç”Ÿæˆæ ·æœ¬ï¼›&lt;/li&gt;
&lt;li&gt;é«˜æ•ˆçš„ç«¯åˆ°ç«¯è®­ç»ƒæ–¹æ³•, å¹¶ä¸”ç”Ÿæˆè´¨é‡ä¼˜äºæœ€å¥½çš„å…¬å¼€å¯ç”¨çš„ä¸¤é˜¶æ®µæ¨¡å‹ã€‚é™„ä¸¤é˜¶æ®µçš„æ•°æ®å¤„ç†è¿‡ç¨‹(åœ¨åç»­çš„ç ”ç©¶è®ºæ–‡ä¸­ç§°ä¹‹ä¸ºçº§è”æ–¹æ³•(cascaded)ï¼Œè§&lt;a href=&#34;https://www.microsoft.com/en-us/research/project/vall-e-x/&#34;&gt;VALL-E&lt;/a&gt;ç³»åˆ—è®ºæ–‡ç ”ç©¶)ï¼š
&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€é˜¶æ®µæ˜¯ä»é¢„å¤„ç†çš„æ–‡æœ¬ä¸­ç”Ÿæˆä¸­é—´è¯­éŸ³è¡¨ç¤ºï¼Œä¾‹å¦‚æ¢…å°”è°±å›¾(mel-spectrograms)æˆ–è¯­è¨€ç‰¹å¾(linguistic features)&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒé˜¶æ®µæ˜¯ç”Ÿæˆä»¥ä¸­é—´è¡¨ç¤ºä¸ºæ¡ä»¶çš„åŸå§‹æ³¢å½¢ã€‚&lt;/li&gt;
&lt;li&gt;ä¸¤é˜¶æ®µçš„ç›¸å…³æ¨¡å‹å¤§éƒ½æ˜¯ç‹¬ç«‹å¼€å‘çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç»“æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/3ddec975-a9fd-460c-91fa-894b8ebd8c8c&#34; alt=&#34;VITS&#34;&gt;&lt;/p&gt;
&lt;p&gt;PSï¼š &lt;a href=&#34;https://github.com/ai-bot-pro/achatbot&#34;&gt;achatbot&lt;/a&gt; é›†æˆäº†OpenVoiceV2 with meloTTS(meloTTSä»£ç å¤§éƒ¨åˆ†æ¥è‡ªVITSï¼ŒFlow é‡‡ç”¨ Transformer Encoder ç»“æ„æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2307.16430&#34;&gt;VITS2: Improving Quality and Efficiency of Single-Stage Text-to-Speech with Adversarial Learning and Architecture Design&lt;/a&gt; | &lt;a href=&#34;https://github.com/daniilrobnikov/vits2&#34;&gt;paper code&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;PRåœ°å€ï¼š &lt;a href=&#34;https://github.com/ai-bot-pro/achatbot/pull/103&#34;&gt;https://github.com/ai-bot-pro/achatbot/pull/103&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;cvae&#34;&gt;CVAE:&lt;/h2&gt;
&lt;p&gt;æ¡ä»¶ VAE:
ä¼ ç»Ÿâ€œåŸå§‹â€ VAE çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯ç”¨æˆ·æ— æ³•æ§åˆ¶è‡ªåŠ¨ç¼–ç å™¨ç”Ÿæˆçš„ç‰¹å®šè¾“å‡ºã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨å‰é¢æåˆ°çš„ MNIST æ•°æ®é›†è®­ç»ƒçš„ä¼ ç»Ÿ VAEï¼Œå¯ä»¥ç”Ÿæˆä» 0 åˆ° 9 çš„æ‰‹å†™æ•°å­—æ–°æ ·æœ¬ï¼Œä½†ä¸èƒ½å±€é™äºä»…è¾“å‡º 4 å’Œ 7ã€‚&lt;/p&gt;
&lt;p&gt;é¡¾åæ€ä¹‰ï¼Œæ¡ä»¶ VAE (CVAE) å¯ä»¥ä»¥ç‰¹å®šè¾“å…¥ä¸ºæ¡ä»¶è¿›è¡Œè¾“å‡ºï¼Œè€Œä¸ä»…ä»…æ˜¯éšæœºç”Ÿæˆè®­ç»ƒæ•°æ®çš„å˜ä½“ã€‚è¿™æ˜¯é€šè¿‡å°†ç›‘ç£å­¦ä¹ ï¼ˆæˆ–åŠç›‘ç£å­¦ä¹ ï¼‰çš„å…ƒç´ ä¸å¸¸è§„è‡ªç¼–ç å™¨çš„ä¼ ç»Ÿæ— ç›‘ç£è®­ç»ƒç›®æ ‡ç›¸ç»“åˆæ¥å®ç°çš„ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡åœ¨ç‰¹å®šå˜é‡çš„æ ‡è®°ç¤ºä¾‹ä¸Šè¿›ä¸€æ­¥è®­ç»ƒæ¨¡å‹ï¼Œè¿™äº›å˜é‡å¯ç”¨äºè°ƒèŠ‚è§£ç å™¨çš„è¾“å‡ºã€‚ä¾‹å¦‚ï¼ŒCVAE å¯é¦–å…ˆåœ¨é¢éƒ¨å›¾åƒçš„å¤§æ•°æ®é›†ä¸Šè¿›è¡Œè®­ç»ƒï¼Œç„¶åä½¿ç”¨ç›‘ç£å­¦ä¹ è¿›è¡Œè®­ç»ƒï¼Œå­¦ä¹ â€œèƒ¡é¡»â€çš„æ½œåœ¨ç¼–ç ï¼Œä»è€Œè¾“å‡ºæ–°çš„æœ‰èƒ¡é¡»é¢éƒ¨çš„å›¾åƒã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/1312.6114&#34;&gt;2013. Auto-Encoding Variational Bayes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ¥è‡ª &lt;a href=&#34;http://papers.nips.cc/paper/5775-learning-structured-output-representation-using-deep-conditional-generati&#34;&gt;2015. Learning Structured Output Representation using Deep Conditional Generative Models&lt;/a&gt;(CVAE)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/ucals/cvae&#34;&gt;https://github.com/ucals/cvae&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.ibm.com/cn-zh/think/topics/variational-autoencoder&#34;&gt;https://www.ibm.com/cn-zh/think/topics/variational-autoencoder&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;posterior-encoder&#34;&gt;Posterior Encoder:&lt;/h2&gt;
&lt;p&gt;WaveNet residual blockç”±å…·æœ‰é—¨æ§æ¿€æ´»å•å…ƒå’Œè·³è·ƒè¿æ¥çš„æ‰©å¼ å·ç§¯å±‚ç»„æˆ(LSTM+CNN)ã€‚å—ä¸Šæ–¹çš„çº¿æ€§æŠ•å½±å±‚äº§ç”Ÿæ­£æ€åéªŒåˆ†å¸ƒçš„å‡å€¼Î¼å’Œæ–¹å·®Î´ã€‚å¯¹äºå¤šè¯´è¯äººçš„æƒ…å†µï¼Œæˆ‘ä»¬åœ¨æ®‹å·®å—ä¸­ä½¿ç”¨å…¨å±€è°ƒèŠ‚(global conditioning)æ¥æ·»åŠ è¯´è¯äººåµŒå…¥ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/1609.03499&#34;&gt;2016. &lt;strong&gt;WaveNet: A Generative Model for Raw Audio&lt;/strong&gt;&lt;/a&gt;(WaveNet residual block) PS: åœ¨OpenVoice(meloTTS)ä¸­çš„å®ç°é‡‡ç”¨çš„Transformer Encoder, æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2307.16430&#34;&gt;VITS2: Improving Quality and Efficiency of Single-Stage Text-to-Speech with Adversarial Learning and Architecture Design&lt;/a&gt; | &lt;a href=&#34;https://github.com/daniilrobnikov/vits2&#34;&gt;paper code&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;prior-encoder&#34;&gt;Prior Encoder:&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†æé«˜å…ˆéªŒåˆ†å¸ƒçš„è¡¨ç¤ºèƒ½åŠ›ï¼Œæˆ‘ä»¬å°†å½’ä¸€åŒ–æµæ·»åŠ åˆ°æ¡ä»¶å…ˆéªŒç½‘ç»œä¸­ï¼Œä»è€Œç”Ÿæˆæ›´çœŸå®çš„æ ·æœ¬ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Text Encoder from Transformer Encoder &lt;a href=&#34;https://arxiv.org/abs/1706.03762&#34;&gt;2017. &lt;strong&gt;Attention Is All You Need&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Relative Position Representations &lt;a href=&#34;https://arxiv.org/abs/1803.02155&#34;&gt;2018. Self-attention with relative position representations&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;The Normalizing Flow &lt;a href=&#34;https://arxiv.org/abs/1605.08803&#34;&gt;2017. &lt;strong&gt;Density estimation using Real NVP&lt;/strong&gt;&lt;/a&gt; ä¸€å † WaveNet æ®‹å·®å—ç»„æˆçš„ä»¿å°„è€¦åˆå±‚å †æ ˆ&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;flow-the-normalizing-flow&#34;&gt;Flow (The Normalizing Flow):&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/1505.05770&#34;&gt;2015. Variational Inference with Normalizing Flows&lt;/a&gt; é€šè¿‡æ ‡å‡†åŒ–æµå¢å¼ºå…ˆéªŒå’ŒåéªŒåˆ†å¸ƒçš„è¡¨è¾¾èƒ½åŠ›æ¥æé«˜ VAE æ€§èƒ½&lt;/li&gt;
&lt;li&gt;æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/1811.02155&#34;&gt;2018. &lt;strong&gt;FloWaveNet : A Generative Flow for Raw Audio&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://github.com/ksw0306/FloWaveNet&#34;&gt;paper code&lt;/a&gt;
FloWaveNetï¼Œè¿™æ˜¯ä¸€ç§åŸºäºæµçš„æ–¹æ³•ï¼Œæ˜¯åŸå§‹éŸ³é¢‘åˆæˆçš„å®æ—¶å¹¶è¡Œç”Ÿæˆæ¨¡å‹çš„æ›¿ä»£æ–¹æ¡ˆã€‚ FloWaveNet&lt;strong&gt;åªéœ€è¦å•ä¸ªæœ€å¤§ä¼¼ç„¶æŸå¤±ï¼Œä¸éœ€è¦ä»»ä½•è¾…åŠ©æŸå¤±é¡¹&lt;/strong&gt;ï¼ŒåŒæ—¶ä¿æŒè®­ç»ƒçš„ç¨³å®šæ€§ã€‚å®ƒå…·æœ‰&lt;strong&gt;ç®€åŒ–çš„å•é˜¶æ®µè®­ç»ƒæ–¹æ¡ˆ&lt;/strong&gt;ï¼Œå› ä¸ºå®ƒ&lt;strong&gt;ä¸éœ€è¦æ•™å¸ˆç½‘ç»œå¹¶ä¸”å¯ä»¥è¿›è¡Œç«¯åˆ°ç«¯è®­ç»ƒ&lt;/strong&gt;ã€‚è¯¥æ¨¡å‹æœ¬è´¨ä¸Šæ˜¯&lt;strong&gt;å¹¶è¡Œçš„&lt;/strong&gt;ï¼Œå› ä¸º&lt;strong&gt;åŸºäºæµçš„ç”Ÿæˆå¯ä»¥å®ç°å®æ—¶æ³¢å½¢åˆæˆ&lt;/strong&gt;ã€‚ FloWaveNet å¯ä»¥ä½œä¸º WaveNet å£°ç å™¨çš„ç›´æ¥æ›¿ä»£å“ï¼Œåè€…ç”¨äºå„ç§æ–‡æœ¬è½¬è¯­éŸ³æ¶æ„ã€‚é™¤äº†ä¸Šè¿°æ‰€æœ‰ä¼˜ç‚¹ä¹‹å¤–ï¼ŒFloWaveNet æ ·æœ¬çš„è´¨é‡å’Œä¿çœŸåº¦ä¸ä¸¤é˜¶æ®µæ¨¡å‹ç›¸å½“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/d7f27c1a-3c68-463c-b76f-1568c0fab811&#34; alt=&#34;FlowWaveNet&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;masmonotonic-alignment-search&#34;&gt;MAS(Monotonic Alignment Search):&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æ¥è‡ª &lt;a href=&#34;https://arxiv.org/abs/2005.11129&#34;&gt;2020. &lt;strong&gt;Glow-TTS: A Generative Flow for Text-to-Speech via Monotonic Alignment Search&lt;/strong&gt;&lt;/a&gt;
Glow-TTS: ä¸€ç§åŸºäºæµ(FloWaveNet)çš„å¹¶è¡Œ TTS ç”Ÿæˆæ¨¡å‹ï¼Œ&lt;strong&gt;ä¸éœ€è¦ä»»ä½•å¤–éƒ¨å¯¹é½å™¨&lt;/strong&gt;(FastSpeech å’Œ ParaNet ä¹‹ç±»çš„æ–‡æœ¬è½¬è¯­éŸ³ (TTS) æ¨¡å‹æ¥å¹¶è¡Œåœ°ä»æ–‡æœ¬ç”Ÿæˆæ¢…å°”é¢‘è°±å›¾ã€‚ä½†å¦‚æœæ²¡æœ‰è‡ªå›å½’ TTS æ¨¡å‹ä½œä¸ºå¤–éƒ¨å¯¹é½å™¨çš„æŒ‡å¯¼ï¼Œå¹¶è¡Œ TTS æ¨¡å‹å°±æ— æ³•è¿›è¡Œè®­ç»ƒ)ã€‚é€šè¿‡ç»“åˆæµå’ŒåŠ¨æ€è§„åˆ’çš„ç‰¹æ€§ï¼Œæ‰€æå‡ºçš„æ¨¡å‹æœç´¢æ–‡æœ¬å’Œè¯­éŸ³çš„æ½œåœ¨è¡¨ç¤ºä¹‹é—´æœ€å¯èƒ½çš„å•è°ƒå¯¹é½ã€‚æˆ‘ä»¬è¯æ˜ï¼Œå¼ºåˆ¶æ‰§è¡Œç¡¬å•è°ƒå¯¹é½å¯ä»¥å®ç°ç¨³å¥çš„ TTSï¼Œä»è€Œæ³›åŒ–åˆ°é•¿è¯è¯­ï¼Œå¹¶ä¸”é‡‡ç”¨ç”Ÿæˆæµå¯ä»¥å®ç°å¿«é€Ÿã€å¤šæ ·åŒ–ä¸”å¯æ§çš„è¯­éŸ³åˆæˆã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/47e3a2ed-ce3c-4644-ae26-565e3ce1b69d&#34; alt=&#34;GlowTTS&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;stochastic-duration-predictor&#34;&gt;Stochastic Duration Predictor:&lt;/h2&gt;
&lt;p&gt;ç”Ÿæˆç±»ä¼¼äººç±»çš„è¯­éŸ³èŠ‚å¥ï¼Œå…¶æ ·æœ¬éµå¾ªç»™å®šéŸ³ç´ çš„æŒç»­æ—¶é—´åˆ†å¸ƒï¼›&lt;/p&gt;
&lt;p&gt;éšæœºæŒç»­æ—¶é—´é¢„æµ‹å™¨æ˜¯åŸºäºæµçš„ç”Ÿæˆæ¨¡å‹ï¼Œé€šå¸¸é€šè¿‡æœ€å¤§ä¼¼ç„¶ä¼°è®¡è¿›è¡Œè®­ç»ƒã€‚ç„¶è€Œï¼Œæœ€å¤§ä¼¼ç„¶ä¼°è®¡çš„ç›´æ¥åº”ç”¨å¾ˆå›°éš¾ï¼Œå› ä¸ºæ¯ä¸ªè¾“å…¥éŸ³ç´ çš„æŒç»­æ—¶é—´æ˜¯ 1) ä¸€ä¸ªç¦»æ•£æ•´æ•°ï¼Œéœ€è¦å¯¹å…¶è¿›è¡Œåé‡åŒ–ä»¥ä½¿ç”¨è¿ç»­å½’ä¸€åŒ–æµï¼›2) ä¸€ä¸ªæ ‡é‡ï¼Œå› ä¸ºå¯é€†æ€§ï¼Œè¿™ä¼šé˜»æ­¢é«˜ç»´å˜æ¢ã€‚åº”ç”¨å˜åˆ†åé‡åŒ–&lt;a href=&#34;https://arxiv.org/abs/1902.00275&#34;&gt;Flow++: Improving flow-based generative models with variational dequantization and architecture design&lt;/a&gt;å’Œå˜åˆ†æ•°æ®å¢å¼º&lt;a href=&#34;https://arxiv.org/abs/2002.09741&#34;&gt;VFlow: More Expressive Generative Flows with Variational Data Augmentation&lt;/a&gt;æ¥è§£å†³è¿™äº›é—®é¢˜ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸºäºduration predictor æ¥è‡ª&lt;a href=&#34;https://arxiv.org/abs/1905.09263&#34;&gt;2019. FastSpeech: Fast, Robust and Controllable Text to Speech&lt;/a&gt;ï¼Œç”¨äºLength Regulatoræ¨¡å—ä¸­ã€‚
&lt;ul&gt;
&lt;li&gt;Length Regulator è§£å†³å‰é¦ˆå˜æ¢å™¨ä¸­éŸ³ç´ å’Œé¢‘è°±å›¾åºåˆ—é•¿åº¦ä¸åŒ¹é…çš„é—®é¢˜ï¼Œä»¥åŠæ§åˆ¶è¯­éŸ³é€Ÿåº¦å’Œéƒ¨åˆ†éŸµå¾‹ã€‚éŸ³ç´ åºåˆ—çš„é•¿åº¦é€šå¸¸å°äºå…¶æ¢…å°”è°±å›¾åºåˆ—çš„é•¿åº¦ï¼Œå¹¶ä¸”æ¯ä¸ªéŸ³ç´ å¯¹åº”äºå¤šä¸ªæ¢…å°”è°±å›¾ã€‚æˆ‘ä»¬å°†ä¸éŸ³ç´ ç›¸å¯¹åº”çš„æ¢…å°”è°±å›¾çš„é•¿åº¦ç§°ä¸ºéŸ³ç´ æŒç»­æ—¶é—´ã€‚&lt;/li&gt;
&lt;li&gt;duration predictor æŒç»­æ—¶é—´é¢„æµ‹å™¨ç”±ä¸€ä¸ªå¸¦æœ‰ ReLU æ¿€æ´»çš„ 2 å±‚ 1D å·ç§¯ç½‘ç»œç»„æˆï¼Œæ¯ä¸ªç½‘ç»œåé¢éƒ½æœ‰å½’ä¸€åŒ–å±‚å’Œ dropout å±‚ï¼Œä»¥åŠä¸€ä¸ªé¢å¤–çš„çº¿æ€§å±‚æ¥è¾“å‡ºæ ‡é‡ï¼Œè¿™æ­£æ˜¯é¢„æµ‹éŸ³ç´ æŒç»­æ—¶é—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/0571d8cd-52e0-48f9-8db6-7b129c645bf1&#34; alt=&#34;FastSpeech&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åç»­å¯¹FastSpeechçš„æ”¹è¿›&lt;a href=&#34;https://arxiv.org/abs/2006.04558&#34;&gt;2020. FastSpeech 2: Fast and High-Quality End-to-End Text to Speech&lt;/a&gt; å…¶ä¸­FastSpeech 2s æ˜¯ç¬¬ä¸€æ¬¡å®Œå…¨å¹¶è¡Œåœ°ä»éŸ³ç´ åºåˆ—ç›´æ¥ç”Ÿæˆæ³¢å½¢çš„å°è¯•ï¼Œè€Œä¸æ˜¯è¯­è¨€ç‰¹å¾æˆ–æ¢…å°”è°±å›¾ï¼Œç«¯åˆ°ç«¯çš„ç”Ÿæˆï¼Œç›´æ¥ä»æ–‡æœ¬ç”Ÿæˆæ³¢å½¢ï¼Œæ— éœ€çº§è”æ¢…å°”é¢‘è°±å›¾ç”Ÿæˆï¼ˆå£°å­¦æ¨¡å‹ï¼‰å’Œæ³¢å½¢ç”Ÿæˆï¼ˆå£°ç å™¨ï¼‰ï¼›é€šå¸¸æ ‡å‡†çš„éè‡ªå›å½’å£°ç å™¨ï¼Œè½¬æ¢æ—¶é—´å¯¹é½çš„è¯­è¨€ç‰¹å¾åˆ°æ³¢å½¢ï¼Œå¹¶ä¸”éœ€è¦å•ç‹¬çš„è¯­è¨€æ¨¡å‹å°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºè¯­è¨€ç‰¹å¾æˆ–å£°å­¦æ¨¡å‹å°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºå£°å­¦ç‰¹å¾ï¼ˆä¾‹å¦‚ï¼Œæ¢…å°”è°±å›¾mel-spectrogramsï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/fdc5ca0b-b099-4eed-a765-b2253ade3aca&#34; alt=&#34;FastSpeech2s&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;decoder-hifi-gan-generator&#34;&gt;Decoder (HiFi-Gan Generator):&lt;/h2&gt;
&lt;p&gt;ç”±ä¸€å †è½¬ç½®å·ç§¯ç»„æˆï¼Œæ¯ä¸ªè½¬ç½®å·ç§¯åè·Ÿä¸€ä¸ªå¤šæ„Ÿå—é‡èåˆæ¨¡å—ï¼ˆMRFï¼‰ã€‚ MRFçš„è¾“å‡ºæ˜¯å…·æœ‰ä¸åŒæ„Ÿå—é‡å¤§å°çš„æ®‹å·®å—çš„è¾“å‡ºä¹‹å’Œã€‚å¯¹äºå¤šè¯´è¯äººè®¾ç½®ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªçº¿æ€§å±‚æ¥è½¬æ¢è¯´è¯äººåµŒå…¥å¹¶å°†å…¶æ·»åŠ åˆ°è¾“å…¥æ½œåœ¨å˜é‡zä¸­&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2010.05646&#34;&gt;2020. &lt;strong&gt;HiFi-GAN: Generative Adversarial Networks for Efficient and High Fidelity Speech Synthesis&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;HiFi-Gan Generator(Decoder)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/8b09b501-bfef-48eb-b823-ba8d78307c31&#34; alt=&#34;HiFi-Gan Generator&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;discriminatorhifi-gan-multi-period-discriminator&#34;&gt;Discriminator(HiFi-Gan Multi-Period Discriminator)&lt;/h2&gt;
&lt;p&gt;éµå¾ª HiFi-GAN ä¸­æå‡ºçš„å¤šå‘¨æœŸé‰´åˆ«å™¨çš„é‰´åˆ«å™¨æ¶æ„ã€‚å¤šå‘¨æœŸé‰´åˆ«å™¨æ˜¯åŸºäºå¤šä¸ªMelGANé©¬å°”å¯å¤«çª—å£çš„å­é‰´åˆ«å™¨(å…¶æ¥è‡ª&lt;a href=&#34;https://arxiv.org/abs/1611.07004&#34;&gt;Image-to-Image Translation with Conditional Adversarial Networks&lt;/a&gt;ä¸­çš„Markovian discriminator (PatchGAN)ï¼Œç”±ä¸€ç³»åˆ—å…·æœ‰å¤§å†…æ ¸çš„è·¨æ­¥å·ç§¯å±‚ç»„æˆã€‚æˆ‘ä»¬åˆ©ç”¨åˆ†ç»„å·ç§¯æ¥å…è®¸ä½¿ç”¨æ›´å¤§çš„å†…æ ¸å¤§å°ï¼ŒåŒæ—¶ä¿æŒè¾ƒå°çš„å‚æ•°æ•°é‡ã€‚)ï¼Œæ¯ä¸ªå­é‰´åˆ«å™¨éƒ½å¯¹è¾“å…¥æ³¢å½¢çš„ä¸åŒå‘¨æœŸæ¨¡å¼è¿›è¡Œæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/66bc011c-697d-47ab-9a56-d0bbe177341e&#34; alt=&#34;HiFi-GAN MPD&#34;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/1910.06711&#34;&gt;2019. &lt;strong&gt;Melgan: Generative adversarial networks for conditional waveform synthesis&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://github.com/descriptinc/melgan-neurips&#34;&gt;paper code&lt;/a&gt; | &lt;a href=&#34;https://github.com/seungwonpark/melgan&#34;&gt;NVIDIA/tacotron2 melgan&lt;/a&gt; (ç¬¬ä¸€ä¸ªæˆåŠŸè®­ç»ƒ GAN ç”ŸæˆåŸå§‹éŸ³é¢‘çš„å·¥ä½œï¼Œæ— éœ€é¢å¤–çš„è’¸é¦æˆ–æ„ŸçŸ¥æŸå¤±å‡½æ•°ï¼ŒåŒæ—¶ä»èƒ½äº§ç”Ÿé«˜è´¨é‡çš„æ–‡æœ¬åˆ°è¯­éŸ³åˆæˆæ¨¡å‹ã€‚ ç»“åˆç¡¬ä»¶åŠ é€Ÿæ¨ç†)
&lt;img src=&#34;https://github.com/user-attachments/assets/79dcb765-2cf6-4270-b75a-83fa5d22eefa&#34; alt=&#34;MelGAN&#34;&gt;&lt;/li&gt;
&lt;li&gt;åˆ¤åˆ«å™¨(Discriminator)(ç”¨äºè®­ç»ƒé˜¶æ®µ)
&lt;ul&gt;
&lt;li&gt;Multi-Period Discriminator(MPD) å¤šå‘¨æœŸåˆ¤åˆ«å™¨ (ç”±äºè¯­éŸ³éŸ³é¢‘ç”±ä¸åŒå‘¨æœŸçš„æ­£å¼¦ä¿¡å·ç»„æˆï¼Œå› æ­¤éœ€è¦è¯†åˆ«éŸ³é¢‘æ•°æ®ä¸­æ½œåœ¨çš„ä¸åŒå‘¨æœŸæ¨¡å¼)&lt;/li&gt;
&lt;li&gt;Multi-Scale Discriminator(MSD) å¤šå°ºåº¦é‰´åˆ«å™¨ (ä¸ºäº†æ•è·è¿ç»­æ¨¡å¼å’Œé•¿æœŸä¾èµ–æ€§,è¿ç»­è¯„ä¼°ä¸åŒçº§åˆ«çš„éŸ³é¢‘æ ·æœ¬, å€Ÿé‰´äº†&lt;a href=&#34;https://arxiv.org/abs/1910.06711&#34;&gt;2019. Melgan: Generative adversarial networks for conditional waveform synthesis&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;MPD å¯¹åŸå§‹æ³¢å½¢çš„ä¸ç›¸äº¤æ ·æœ¬è¿›è¡Œæ“ä½œ(ç¦»æ•£)ï¼Œè€Œ MSD å¯¹å¹³æ»‘æ³¢å½¢è¿›è¡Œæ“ä½œ(è¿ç»­)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h1 id=&#34;ipainternational-phonetic-alphabet&#34;&gt;IPA(International Phonetic Alphabet)&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/International_Phonetic_Alphabet&#34;&gt;https://en.wikipedia.org/wiki/International_Phonetic_Alphabet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/bootphon/phonemizer&#34;&gt;https://github.com/bootphon/phonemizer&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
      
    </item>
    
    <item>
      <title>è®ºæ–‡è§£è¯» OpenVoice: Versatile Instant Voice Cloning</title>
      <link>https://weedge.github.io/post/multimoding/voices/open_voice_extra_se_and_convert/</link>
      <pubDate>Sat, 11 May 2024 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/multimoding/voices/open_voice_extra_se_and_convert/</guid>
      
        <description>&lt;p&gt;ä½¿ç”¨meloTTS æœ¬æ–‡ç”Ÿæˆçš„éŸ³é¢‘&lt;/p&gt;



&lt;figure &gt;
  &lt;audio controls class=&#34;player&#34; preload=&#34;&#34;&gt;
    &lt;source src=&#34;https://media.githubusercontent.com/media/weedge/paper-speaker/main/multimoding/voices/open_voice_inference/zh-tts.wav&#34; type=&#34;audio/mpeg&#34;&gt;
  &lt;/audio&gt;
  
  
&lt;/figure&gt;

&lt;p&gt;ä½¿ç”¨openVoice clone è‡ªå·±çš„å£°éŸ³ é˜…è¯»æœ¬æ–‡å†…å®¹ 


&lt;figure &gt;
  &lt;audio controls class=&#34;player&#34; preload=&#34;&#34;&gt;
    &lt;source src=&#34;https://media.githubusercontent.com/media/weedge/paper-speaker/main/multimoding/voices/open_voice_inference/clone-me-zh-tts.wav&#34; type=&#34;audio/mpeg&#34;&gt;
  &lt;/audio&gt;
  
  
&lt;/figure&gt;
&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ–‡ä»¶ç›´æ¥ä¸Šä¼ åœ¨githubä¸­, æš‚æœªèµ°cdn, ç¼“å­˜æ¯”è¾ƒæ…¢ï¼Œå¯ä¸‹è½½æ’­æ”¾ï¼Œ ä¸‹è½½åœ°å€ï¼š &lt;a href=&#34;http://github.com/weedge/paper-speaker/tree/main/multimoding/voices/open_voice_inference&#34;&gt;http://github.com/weedge/paper-speaker/tree/main/multimoding/voices/open_voice_inference&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;p&gt;openVoiceV2 tone color clone: base TTS + extra tone color + convert&lt;/p&gt;
&lt;p&gt;Base TTS: use meloTTS , æ”¯æŒTTSæ¨¡å‹è®­ç»ƒï¼Œä»¥åŠload Pre-Trained ckpt è¿›è¡ŒTTS,  åœ¨ &lt;a href=&#34;https://github.com/jaywalnut310/vits&#34;&gt;VITS&lt;/a&gt;åŸºç¡€ä¸Šæ”¯æŒå¤šç§è¯­è¨€ï¼›&lt;/p&gt;
&lt;p&gt;è®ºæ–‡åœ°å€ï¼š&lt;a href=&#34;https://arxiv.org/abs/2312.01479&#34;&gt;OpenVoice: Versatile Instant Voice Cloning&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è®ºæ–‡ä¸»ä½œè€…ï¼šZengyi Qin (åŒæ—¶æ˜¯JetMoEçš„ä½œè€…ï¼Œç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šåˆ›æ–°)&lt;/p&gt;
&lt;p&gt;å…¬å¼€çš„æƒé‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;OpenVoice: &lt;a href=&#34;https://huggingface.co/myshell-ai/OpenVoice&#34;&gt;https://huggingface.co/myshell-ai/OpenVoice&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;OpenVoiceV2: &lt;a href=&#34;https://huggingface.co/myshell-ai/OpenVoiceV2&#34;&gt;https://huggingface.co/myshell-ai/OpenVoiceV2&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æºç ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/myshell-ai/OpenVoice&#34;&gt;https://github.com/myshell-ai/OpenVoice&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/myshell-ai/MeloTTS&#34;&gt;https://github.com/myshell-ai/MeloTTS&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è®­ç»ƒï¼š MSML dataset å’Œ è®­ç»ƒè¿‡ç¨‹ æœªå…¬å¼€&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é™„æ“ä½œç¬”è®°&lt;/strong&gt;ï¼š &lt;a href=&#34;https://github.com/weedge/doraemon-nb/blob/main/myshell_ai_OpenVoiceV2.ipynb&#34;&gt;https://github.com/weedge/doraemon-nb/blob/main/myshell_ai_OpenVoiceV2.ipynb&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æŠ½å–éŸ³è‰²ï¼š&lt;/p&gt;
&lt;script type=&#34;application/javascript&#34; src=&#34;https://gist.github.com/weedge/914e71c22aaaca90db1660fb5c5fe645.js&#34;&gt;&lt;/script&gt;

&lt;p&gt;cloneéŸ³è‰²è½¬æ¢ï¼š&lt;/p&gt;
&lt;script type=&#34;application/javascript&#34; src=&#34;https://gist.github.com/weedge/7b8393990adfa205afbede4d1c8615ec.js&#34;&gt;&lt;/script&gt;

&lt;p&gt;&lt;strong&gt;Tips&lt;/strong&gt;: ä½¿ç”¨cpuè½¬æ¢çš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œæ¯”å¦‚æœ¬æ–‡éŸ³è‰²è½¬æ¢æ—¶é—´å¤§æ¦‚éœ€è¦1ä¸ªå°æ—¶ï¼Œå¦‚æœæ˜¯åœ¨çº¿åœºæ™¯ï¼Œåƒapp.myshell.ai åœ¨çº¿è½¬æ¢çš„åœºæ™¯ä¸­ï¼Œé™åˆ¶è¾“å…¥æ–‡æœ¬çš„æœ€å¤§é•¿åº¦ä¸º300ï¼Œè€Œä¸”ä¹Ÿä¼šå®šä¹‰è½¬æ¢çš„è¶…æ—¶æ—¶é—´ï¼Œé˜²æ­¢è¿‡åº¦æ¶ˆè€—è®¡ç®—èµ„æºã€‚å¦‚æœæ˜¯ç¦»çº¿åœºæ™¯pipelineï¼Œå¯ä»¥é‡‡ç”¨m/ræ¡†æ¶æ¥åˆ†å¸ƒå¼å¤„ç†éŸ³é¢‘æ–‡ä»¶è½¬æ¢ã€‚ï¼ˆè¿™ä¸ªæ˜¯åç»­ä¿®æ”¹åŠ å…¥ï¼ŒéŸ³é¢‘æ–‡ä»¶æœªç”Ÿæˆï¼‰ï¼› å¦‚æœå¯¹äºæ–‡ç« ç»å¸¸æ›´æ–°çš„åœºæ™¯ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆæ–‡ç« éŸ³é¢‘æ–‡ä»¶ï¼Œè¿™ä¸ªæ˜¯æ¯”è¾ƒæ¶ˆè€—èµ„æºï¼Œæš‚æœªæ‰¾åˆ°ä¸€ç§diffæ–¹æ¡ˆå¢é‡æ›´æ–°éŸ³é¢‘ã€‚&lt;/p&gt;
&lt;h2 id=&#34;0-æ‘˜è¦&#34;&gt;0 æ‘˜è¦&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ä»‹ç»äº† OpenVoiceï¼Œè¿™æ˜¯ä¸€ç§å¤šåŠŸèƒ½çš„å³æ—¶è¯­éŸ³å…‹éš†æ–¹æ³•ï¼Œåªéœ€æ¥è‡ªå‚è€ƒè¯´è¯è€…çš„çŸ­éŸ³é¢‘å‰ªè¾‘å³å¯å¤åˆ¶å…¶å£°éŸ³å¹¶ç”Ÿæˆå¤šç§è¯­è¨€çš„è¯­éŸ³ã€‚OpenVoice åœ¨ä»¥ä¸‹é¢†åŸŸä¸­ä»£è¡¨äº†é‡å¤§è¿›å±•ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1) çµæ´»çš„è¯­éŸ³é£æ ¼æ§åˆ¶ã€‚&lt;/strong&gt; OpenVoice èƒ½å¤Ÿå¯¹è¯­éŸ³é£æ ¼è¿›è¡Œç²¾ç»†çš„æ§åˆ¶ï¼ŒåŒ…æ‹¬æƒ…æ„Ÿã€å£éŸ³ã€èŠ‚å¥ã€åœé¡¿å’Œè¯­è°ƒï¼Œé™¤äº†å¤åˆ¶å‚è€ƒè¯´è¯è€…çš„éŸ³è‰²å¤–ã€‚è¿™äº›è¯­éŸ³é£æ ¼ä¸æ˜¯ç›´æ¥ä»å‚è€ƒè¯´è¯è€…çš„é£æ ¼å¤åˆ¶å’Œå—åˆ°é™åˆ¶çš„ã€‚ä»¥å¾€çš„æ–¹æ³•ç¼ºä¹åœ¨å…‹éš†åçµæ´»æ“çºµè¯­éŸ³é£æ ¼çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2) é›¶æ ·æœ¬è·¨è¯­è¨€è¯­éŸ³å…‹éš†ã€‚&lt;/strong&gt; OpenVoice å®ç°äº†é›¶æ ·æœ¬è·¨è¯­è¨€è¯­éŸ³å…‹éš†ï¼Œé€‚ç”¨äºæœªåŒ…å«åœ¨å¤§è§„æ¨¡è¯´è¯è€…è®­ç»ƒé›†ä¸­çš„è¯­è¨€ã€‚ä¸ä»¥å¾€çš„æ–¹æ³•ä¸åŒï¼Œä»¥å¾€çš„æ–¹æ³•é€šå¸¸éœ€è¦ä¸ºæ‰€æœ‰è¯­è¨€æä¾›å¹¿æ³›çš„å¤§è§„æ¨¡è¯´è¯è€…å¤šè¯­è¨€ï¼ˆMSMLï¼‰æ•°æ®é›†ï¼Œè€Œ OpenVoice å¯ä»¥åœ¨æ²¡æœ‰é’ˆå¯¹è¯¥è¯­è¨€çš„ä»»ä½•å¤§è§„æ¨¡è¯´è¯è€…è®­ç»ƒæ•°æ®çš„æƒ…å†µä¸‹å°†è¯­éŸ³å…‹éš†åˆ°æ–°è¯­è¨€ä¸­ã€‚OpenVoice è¿˜å…·æœ‰&lt;strong&gt;è®¡ç®—æ•ˆç‡é«˜&lt;/strong&gt;çš„ç‰¹ç‚¹ï¼Œæˆæœ¬æ¯”å•†ä¸šå¯ç”¨çš„ç”šè‡³æ€§èƒ½è¾ƒå·®çš„ API ä½å‡ åå€ã€‚ä¸ºäº†ä¿ƒè¿›è¯¥é¢†åŸŸçš„è¿›ä¸€æ­¥ç ”ç©¶ï¼Œæˆ‘ä»¬å·²ç»å°†æºä»£ç å’Œè®­ç»ƒæ¨¡å‹å…¬å¼€ã€‚æˆ‘ä»¬è¿˜åœ¨æˆ‘ä»¬çš„æ¼”ç¤ºç½‘ç«™æä¾›äº†å®šæ€§ç»“æœã€‚åœ¨å…¶å…¬å¼€å‘å¸ƒä¹‹å‰ï¼Œæˆ‘ä»¬å†…éƒ¨ç‰ˆæœ¬çš„ OpenVoice åœ¨ 2023 å¹´ 5 æœˆè‡³ 10 æœˆä¹‹é—´è¢«å…¨çƒç”¨æˆ·æ•°åƒä¸‡æ¬¡ä½¿ç”¨ï¼Œä½œä¸º MyShell.ai çš„åç«¯æœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;1-ä»‹ç»&#34;&gt;1 ä»‹ç»&lt;/h2&gt;
&lt;p&gt;åœ¨æ–‡æœ¬è½¬è¯­éŸ³ï¼ˆTTSï¼‰åˆæˆä¸­ï¼Œå³æ—¶è¯­éŸ³å…‹éš†ï¼ˆIVCï¼‰æ„å‘³ç€ TTS æ¨¡å‹å¯ä»¥åœ¨ç»™å®šçŸ­éŸ³é¢‘æ ·æœ¬çš„æƒ…å†µä¸‹å…‹éš†ä»»ä½•å‚è€ƒè¯´è¯è€…çš„å£°éŸ³ï¼Œè€Œæ— éœ€å¯¹å‚è€ƒè¯´è¯è€…è¿›è¡Œé¢å¤–çš„è®­ç»ƒã€‚å®ƒä¹Ÿè¢«ç§°ä¸ºé›¶æ ·æœ¬ TTSã€‚IVC ä½¿ç”¨æˆ·èƒ½å¤Ÿçµæ´»å®šåˆ¶ç”Ÿæˆçš„è¯­éŸ³ï¼Œåœ¨å„ç§å®é™…åº”ç”¨ä¸­å±•ç°å‡ºå·¨å¤§çš„ä»·å€¼ï¼Œä¾‹å¦‚åª’ä½“å†…å®¹åˆ›ä½œã€å®šåˆ¶èŠå¤©æœºå™¨äººä»¥åŠäººä¸è®¡ç®—æœºæˆ–å¤§å‹è¯­è¨€æ¨¡å‹ä¹‹é—´çš„å¤šæ¨¡å¼äº¤äº’ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ IVC æ–¹é¢å·²ç»è¿›è¡Œäº†å¤§é‡çš„ç ”ç©¶å·¥ä½œã€‚è‡ªå›å½’æ–¹æ³•çš„ä¾‹å­åŒ…æ‹¬ VALLE&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt; å’Œ XTTS&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;ï¼Œå®ƒä»¬ä»å‚è€ƒéŸ³é¢‘ä¸­æå–å£°å­¦æ ‡è®°æˆ–è¯´è¯è€…åµŒå…¥ä½œä¸ºè‡ªå›å½’æ¨¡å‹çš„æ¡ä»¶ã€‚ç„¶åï¼Œè‡ªå›å½’æ¨¡å‹æŒ‰é¡ºåºç”Ÿæˆå£°å­¦æ ‡è®°ï¼Œç„¶åå°†å…¶è§£ç ä¸ºåŸå§‹éŸ³é¢‘æ³¢å½¢ã€‚å°½ç®¡è¿™äº›æ–¹æ³•å¯ä»¥å…‹éš†éŸ³è‰²ï¼Œä½†å®ƒä»¬ä¸å…è®¸ç”¨æˆ·çµæ´»åœ°æ“çºµå…¶ä»–é‡è¦çš„é£æ ¼å‚æ•°ï¼Œå¦‚æƒ…æ„Ÿã€å£éŸ³ã€èŠ‚å¥ã€åœé¡¿å’Œè¯­è°ƒã€‚è€Œä¸”ï¼Œè‡ªå›å½’æ¨¡å‹ç›¸å¯¹è®¡ç®—æˆæœ¬é«˜ï¼Œæ¨ç†é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ã€‚éè‡ªå›å½’æ–¹æ³•çš„ä¾‹å­åŒ…æ‹¬ YourTTS&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;å’Œæœ€è¿‘å¼€å‘çš„ Voicebox&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;ï¼Œå®ƒä»¬å±•ç¤ºäº†æ˜¾è‘—æ›´å¿«çš„æ¨ç†é€Ÿåº¦ï¼Œä½†ä»æ— æ³•æä¾›é™¤éŸ³è‰²ä»¥å¤–çš„é£æ ¼å‚æ•°çš„çµæ´»æ§åˆ¶ã€‚ç°æœ‰æ–¹æ³•çš„å¦ä¸€ä¸ªå…±åŒç¼ºç‚¹æ˜¯ï¼Œå®ƒä»¬é€šå¸¸éœ€è¦å¤§é‡çš„ MSML æ•°æ®é›†æ‰èƒ½å®ç°è·¨è¯­è¨€è¯­éŸ³å…‹éš†ã€‚è¿™ç§ç»„åˆæ•°æ®è¦æ±‚å¯èƒ½ä¼šé™åˆ¶å®ƒä»¬åŒ…å«æ–°è¯­è¨€çš„çµæ´»æ€§ã€‚æ­¤å¤–ï¼Œç”±äºç§‘æŠ€å·¨å¤´çš„è¯­éŸ³å…‹éš†ç ”ç©¶&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt; å¤§å¤šæ˜¯é—­æºçš„ï¼Œå› æ­¤ç ”ç©¶ç•Œæ²¡æœ‰ä¾¿æ·çš„æ–¹å¼ç«™åœ¨ä»–ä»¬çš„è‚©è†€ä¸Šï¼Œæ¨åŠ¨è¯¥é¢†åŸŸçš„è¿›å±•ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬ä»‹ç»äº† OpenVoiceï¼Œè¿™æ˜¯ä¸€ç§çµæ´»çš„å³æ—¶è¯­éŸ³å…‹éš†æ–¹æ³•ï¼Œé’ˆå¯¹è¯¥é¢†åŸŸçš„ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;é™¤äº†å…‹éš†éŸ³è‰²å¤–ï¼Œå¦‚ä½•çµæ´»æ§åˆ¶å…¶ä»–é‡è¦çš„é£æ ¼å‚æ•°ï¼Œå¦‚æƒ…æ„Ÿã€å£éŸ³ã€èŠ‚å¥ã€åœé¡¿å’Œè¯­è°ƒï¼Ÿè¿™äº›ç‰¹å¾å¯¹äºç”Ÿæˆä¸Šä¸‹æ–‡è‡ªç„¶çš„è¯­éŸ³å’Œå¯¹è¯éå¸¸é‡è¦ï¼Œè€Œä¸æ˜¯å•è°ƒåœ°å™è¿°è¾“å…¥æ–‡æœ¬ã€‚å…ˆå‰çš„æ–¹æ³•&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;åªèƒ½å…‹éš†å‚è€ƒè¯´è¯è€…çš„å•è°ƒéŸ³è‰²å’Œé£æ ¼ï¼Œä½†ä¸å…è®¸çµæ´»æ“çºµé£æ ¼ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚ä½•ä»¥ç®€å•çš„æ–¹å¼å®ç°é›¶æ ·æœ¬è·¨è¯­è¨€è¯­éŸ³å…‹éš†ã€‚æˆ‘ä»¬æå‡ºäº†ä¸¤ä¸ªé›¶æ ·æœ¬èƒ½åŠ›æ–¹é¢çš„é‡è¦é—®é¢˜ï¼Œè¿™äº›é—®é¢˜å¹¶ä¸æ˜¯å…ˆå‰ç ”ç©¶æ‰€è§£å†³çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœå‚è€ƒè¯´è¯è€…çš„è¯­è¨€ä¸åœ¨ MSML æ•°æ®é›†ä¸­ï¼Œæ¨¡å‹æ˜¯å¦èƒ½å¤Ÿå…‹éš†å…¶è¯­éŸ³ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¦‚æœç”Ÿæˆçš„è¯­éŸ³çš„è¯­è¨€ä¸åœ¨ MSML æ•°æ®é›†ä¸­ï¼Œæ¨¡å‹æ˜¯å¦èƒ½å¤Ÿå…‹éš†å‚è€ƒå£°éŸ³å¹¶ç”Ÿæˆè¯¥è¯­è¨€çš„è¯­éŸ³ï¼Ÿ
åœ¨å…ˆå‰çš„ç ”ç©¶ä¸­&lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;ï¼Œå‚è€ƒè¯´è¯è€…çš„è¯­è¨€å’Œæ¨¡å‹ç”Ÿæˆçš„è¯­è¨€éƒ½åº”åœ¨ MSML æ•°æ®é›†ä¸­å¤§é‡å­˜åœ¨ã€‚ä½†å¦‚æœä¸¤è€…éƒ½ä¸å­˜åœ¨å‘¢ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚ä½•åœ¨ä¸é™ä½è´¨é‡çš„æƒ…å†µä¸‹å®ç°è¶…å¿«é€Ÿçš„å®æ—¶æ¨ç†é€Ÿåº¦ï¼Œè¿™å¯¹äºå¤§è§„æ¨¡å•†ä¸šç”Ÿäº§ç¯å¢ƒè‡³å…³é‡è¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºäº†è§£å†³å‰ä¸¤ä¸ªé—®é¢˜ï¼ŒOpenVoice è¢«è®¾è®¡ä¸ºå°½å¯èƒ½åœ°è§£è€¦è¯­éŸ³ä¸­çš„ç»„ä»¶ã€‚è¯­è¨€ã€éŸ³è‰²å’Œå…¶ä»–é‡è¦çš„è¯­éŸ³ç‰¹å¾çš„ç”Ÿæˆè¢«ç‹¬ç«‹åœ°åˆ†å¼€ï¼Œä½¿å¾—å¯ä»¥çµæ´»æ“çºµå•ä¸ªè¯­éŸ³é£æ ¼å’Œè¯­è¨€ç±»å‹ã€‚è¿™æ˜¯åœ¨ä¸æ ‡è®°ä»»ä½•è¯­éŸ³é£æ ¼çš„ MSML è®­ç»ƒé›†ä¸­å®ç°çš„ã€‚æˆ‘ä»¬æƒ³æ¾„æ¸…ä¸€ç‚¹ï¼Œ&lt;strong&gt;æœ¬ç ”ç©¶ä¸­çš„é›¶æ ·æœ¬è·¨è¯­è¨€ä»»åŠ¡ä¸ VALLE-X ä¸­çš„ä»»åŠ¡ä¸åŒ&lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/strong&gt;ã€‚åœ¨ VALLE-X ä¸­ï¼Œæ‰€æœ‰è¯­è¨€çš„æ•°æ®éƒ½éœ€è¦åŒ…å«åœ¨ MSML è®­ç»ƒé›†ä¸­ï¼Œæ¨¡å‹æ— æ³•æ¨å¹¿åˆ° MSML è®­ç»ƒé›†ä¹‹å¤–çš„æœªè§è¿‡çš„è¯­è¨€ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒOpenVoice è®¾è®¡ä¸ºæ¨å¹¿åˆ°å®Œå…¨æœªè§è¿‡çš„ MSML è®­ç»ƒé›†ä¹‹å¤–çš„è¯­è¨€ã€‚ç¬¬ä¸‰ä¸ªé—®é¢˜é»˜è®¤è¢«è§£å†³ï¼Œå› ä¸ºè§£è€¦çš„ç»“æ„é™ä½äº†å¯¹æ¨¡å‹å¤§å°å’Œè®¡ç®—å¤æ‚åº¦çš„è¦æ±‚ã€‚æˆ‘ä»¬ä¸éœ€è¦ä¸€ä¸ªå¤§å‹æ¨¡å‹æ¥å­¦ä¹ æ‰€æœ‰ä¸œè¥¿ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬é¿å…äº†è‡ªå›å½’æˆ–æ‰©æ•£ç»„ä»¶ä»¥åŠ å¿«æ¨ç†é€Ÿåº¦ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨æ­¤å…¬å¼€å‘å¸ƒä¹‹å‰çš„ OpenVoice å†…éƒ¨ç‰ˆæœ¬å·²åœ¨ 2023 å¹´ 5 æœˆè‡³ 10 æœˆæœŸé—´å…¨çƒç”¨æˆ·ä½¿ç”¨äº†æ•°åƒä¸‡æ¬¡ã€‚å®ƒä¸º MyShell.ai çš„å³æ—¶è¯­éŸ³å…‹éš†åç«¯æä¾›æ”¯æŒï¼Œå¹¶åœ¨è¯¥å¹³å°ä¸Šè§è¯äº†æ•°ç™¾å€çš„ç”¨æˆ·å¢é•¿ã€‚ä¸ºäº†ä¿ƒè¿›è¯¥é¢†åŸŸçš„ç ”ç©¶è¿›å±•ï¼Œæˆ‘ä»¬è¯¦ç»†è§£é‡Šäº†è¯¥æŠ€æœ¯ï¼Œå¹¶å…¬å¼€æä¾›äº†æºä»£ç å’Œæ¨¡å‹æƒé‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2-æ–¹æ³•&#34;&gt;2 æ–¹æ³•&lt;/h2&gt;
&lt;p&gt;æŠ€æœ¯æ–¹æ³• &lt;strong&gt;ç®€å•&lt;/strong&gt; å®ç°ä½†æ•ˆæœæƒŠäººã€‚æˆ‘ä»¬é¦–å…ˆä»‹ç» OpenVoice èƒŒåçš„ç›´è§‰ï¼Œç„¶åè¯¦ç»†è¯´æ˜æ¨¡å‹ç»“æ„å’Œè®­ç»ƒè¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;21-ç›´è§‰&#34;&gt;2.1 ç›´è§‰&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;éš¾ç‚¹&lt;/strong&gt; ã€‚å¾ˆæ˜æ˜¾ï¼ŒåŒæ—¶å…‹éš†ä»»ä½•è¯´è¯è€…çš„éŸ³è‰²ï¼Œå®ç°å¯¹æ‰€æœ‰å…¶ä»–é£æ ¼çš„çµæ´»æ§åˆ¶ï¼Œå¹¶ä¸”ç”¨å¾ˆå°‘çš„å·¥ä½œé‡æ·»åŠ æ–°è¯­è¨€å¯èƒ½ä¼šéå¸¸å…·æœ‰æŒ‘æˆ˜æ€§ã€‚è¿™éœ€è¦å¤§é‡çš„ç»„åˆæ•°æ®é›†ï¼Œå…¶ä¸­å—æ§å‚æ•°ç›¸äº¤ï¼Œå¹¶ä¸”åªåœ¨ä¸€ä¸ªå±æ€§ä¸Šæœ‰å·®å¼‚çš„æ•°æ®å¯¹ï¼Œå¹¶ä¸”æœ‰è‰¯å¥½æ ‡è®°ï¼Œä»¥åŠä¸€ä¸ªç›¸å¯¹è¾ƒå¤§å®¹é‡çš„æ¨¡å‹æ¥æ‹Ÿåˆæ•°æ®é›†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç®€å•çš„éƒ¨åˆ†&lt;/strong&gt; ã€‚æˆ‘ä»¬è¿˜æ³¨æ„åˆ°ï¼Œåœ¨å¸¸è§„çš„å•è¯´è¯è€… TTS ä¸­ï¼Œåªè¦ä¸éœ€è¦è¯­éŸ³å…‹éš†ï¼Œå°±ç›¸å¯¹å®¹æ˜“æ·»åŠ å¯¹å…¶ä»–é£æ ¼å‚æ•°çš„æ§åˆ¶å’Œæ·»åŠ æ–°è¯­è¨€ã€‚ä¾‹å¦‚ï¼Œè®°å½•ä¸€ä¸ªåŒ…å« 10K ä¸ªå¸¦æœ‰æ ‡è®°çš„æƒ…æ„Ÿå’Œè¯­è°ƒçš„çŸ­éŸ³é¢‘æ ·æœ¬çš„å•è¯´è¯è€…æ•°æ®é›†è¶³ä»¥è®­ç»ƒå‡ºä¸€ä¸ªæä¾›å¯¹æƒ…æ„Ÿå’Œè¯­è°ƒè¿›è¡Œæ§åˆ¶çš„å•è¯´è¯è€… TTS æ¨¡å‹ã€‚é€šè¿‡åœ¨æ•°æ®é›†ä¸­åŒ…å«å¦ä¸€ä¸ªè¯´è¯è€…ï¼Œæ·»åŠ æ–°è¯­è¨€æˆ–å£éŸ³ä¹Ÿå¾ˆç®€å•ã€‚&lt;/p&gt;
&lt;p&gt;OpenVoice èƒŒåçš„ç›´è§‰æ˜¯å°† IVC ä»»åŠ¡è§£è€¦ä¸ºå•ç‹¬çš„å­ä»»åŠ¡ï¼Œå…¶ä¸­æ¯ä¸ªå­ä»»åŠ¡æ¯”è€¦åˆä»»åŠ¡æ›´å®¹æ˜“å®ç°ã€‚éŸ³è‰²å…‹éš†ä¸æ‰€æœ‰å…¶ä»–é£æ ¼å‚æ•°å’Œè¯­è¨€çš„æ§åˆ¶å®Œå…¨è§£è€¦ã€‚&lt;strong&gt;æˆ‘ä»¬æè®®ä½¿ç”¨åŸºç¡€è¯´è¯è€… TTS æ¨¡å‹æ¥æ§åˆ¶é£æ ¼å‚æ•°å’Œè¯­è¨€ï¼Œå¹¶ä½¿ç”¨éŸ³è‰²è½¬æ¢å™¨å°†å‚è€ƒéŸ³è‰²ä½“ç°åˆ°ç”Ÿæˆçš„è¯­éŸ³ä¸­&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;22-æ¨¡å‹ç»“æ„&#34;&gt;2.2 æ¨¡å‹ç»“æ„&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨å›¾1 ä¸­è¯´æ˜äº†æ¨¡å‹ç»“æ„ã€‚OpenVoice çš„ä¸¤ä¸ªä¸»è¦ç»„ä»¶æ˜¯åŸºç¡€è¯´è¯è€… TTS æ¨¡å‹å’ŒéŸ³è‰²è½¬æ¢å™¨ã€‚åŸºç¡€è¯´è¯è€… TTS æ¨¡å‹æ˜¯å•è¯´è¯è€…æˆ–å¤šè¯´è¯è€…æ¨¡å‹ï¼Œå…è®¸å¯¹é£æ ¼å‚æ•°ï¼ˆä¾‹å¦‚æƒ…æ„Ÿã€å£éŸ³ã€èŠ‚å¥ã€åœé¡¿å’Œè¯­è°ƒï¼‰ã€å£éŸ³å’Œè¯­è¨€è¿›è¡Œæ§åˆ¶ã€‚ç”±è¯¥æ¨¡å‹ç”Ÿæˆçš„è¯­éŸ³ä¼ é€’ç»™éŸ³è‰²è½¬æ¢å™¨ï¼Œè¯¥è½¬æ¢å™¨å°†åŸºç¡€è¯´è¯è€…çš„éŸ³è‰²æ”¹å˜ä¸ºå‚è€ƒè¯´è¯è€…çš„éŸ³è‰²ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/multimoding/voices/open_voice_inference/1.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å›¾1: OpenVoice æ¡†æ¶ç¤ºæ„å›¾ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªåŸºç¡€è¯´è¯è€…æ¨¡å‹æ¥æ§åˆ¶é£æ ¼å’Œè¯­è¨€ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªè½¬æ¢å™¨å°†å‚è€ƒè¯´è¯è€…çš„éŸ³è‰²ä½“ç°åˆ°è¯­éŸ³ä¸­ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åŸºç¡€è¯´è¯è€… TTS æ¨¡å‹ã€‚&lt;/strong&gt; åŸºç¡€è¯´è¯è€… TTS æ¨¡å‹çš„é€‰æ‹©éå¸¸çµæ´»ã€‚ä¾‹å¦‚ï¼ŒVITS&lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt; æ¨¡å‹å¯ä»¥ä¿®æ”¹ä¸ºåœ¨å…¶æ–‡æœ¬ç¼–ç å™¨å’ŒæŒç»­é¢„æµ‹å™¨ä¸­æ¥å—é£æ ¼å’Œè¯­è¨€åµŒå…¥ã€‚å…¶ä»–é€‰æ‹©ï¼Œå¦‚ InstructTTS&lt;sup id=&#34;fnref:7&#34;&gt;&lt;a href=&#34;#fn:7&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;7&lt;/a&gt;&lt;/sup&gt;  ä¹Ÿå¯ä»¥æ¥å—é£æ ¼æç¤ºã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨å•†ä¸šå¯ç”¨ï¼ˆä¸”ä»·æ ¼ä½å»‰ï¼‰çš„æ¨¡å‹ï¼Œå¦‚ Microsoft TTSï¼Œè¯¥æ¨¡å‹æ¥å—æŒ‡å®šæƒ…æ„Ÿã€åœé¡¿å’Œå‘éŸ³çš„è¯­éŸ³åˆæˆæ ‡è®°è¯­è¨€ï¼ˆSSMLï¼‰ã€‚ç”šè‡³å¯ä»¥è·³è¿‡åŸºç¡€è¯´è¯è€… TTS æ¨¡å‹ï¼Œè‡ªå·±æŒ‰ç…§æ‰€éœ€çš„é£æ ¼å’Œè¯­è¨€é˜…è¯»æ–‡æœ¬ã€‚åœ¨æˆ‘ä»¬çš„ OpenVoice å®ç°ä¸­ï¼Œé»˜è®¤ä½¿ç”¨äº† VITS&lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt;  æ¨¡å‹ï¼Œä½†å…¶ä»–é€‰æ‹©å®Œå…¨å¯è¡Œã€‚æˆ‘ä»¬å°†åŸºç¡€æ¨¡å‹çš„è¾“å‡ºè¡¨ç¤ºä¸º $\mathbf{X}(L_I, S_I, C_I)$ï¼Œå…¶ä¸­ä¸‰ä¸ªå‚æ•°åˆ†åˆ«è¡¨ç¤ºè¯­è¨€ã€é£æ ¼å’ŒéŸ³è‰²ã€‚ç±»ä¼¼åœ°ï¼Œæ¥è‡ªå‚è€ƒè¯´è¯è€…çš„è¯­éŸ³éŸ³é¢‘è¡¨ç¤ºä¸º $\mathbf{X}(L_O, S_O, C_O)$ã€‚&lt;/p&gt;
&lt;p&gt;é™„ vits æ¨¡å‹ç»“æ„ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/multimoding/voices/open_voice_inference/2.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;éŸ³è‰²è½¬æ¢å™¨ã€‚&lt;/strong&gt; éŸ³è‰²è½¬æ¢å™¨æ˜¯ä¸€ä¸ªç¼–ç å™¨-è§£ç å™¨ç»“æ„ï¼Œä¸­é—´å¸¦æœ‰å¯é€†æ­£è§„åŒ–æµ&lt;sup id=&#34;fnref:8&#34;&gt;&lt;a href=&#34;#fn:8&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;8&lt;/a&gt;&lt;/sup&gt; ã€‚ç¼–ç å™¨æ˜¯ä¸€ä¸ª 1D å·ç§¯ç¥ç»ç½‘ç»œï¼Œæ¥å— $\mathbf{X}(L_I, S_I, C_I)$ çš„çŸ­æ—¶å‚…é‡Œå¶å˜æ¢é¢‘è°±ä½œä¸ºè¾“å…¥ã€‚æ‰€æœ‰å·ç§¯éƒ½æ˜¯å•æ­¥é•¿çš„ã€‚ç¼–ç å™¨è¾“å‡ºçš„ç‰¹å¾å›¾è¡¨ç¤ºä¸º $\mathbf{Y}(L_I, S_I, C_I)$ã€‚éŸ³è‰²æå–å™¨æ˜¯ä¸€ä¸ªç®€å•çš„ 2D å·ç§¯ç¥ç»ç½‘ç»œï¼Œæ“ä½œè¾“å…¥è¯­éŸ³çš„æ¢…å°”é¢‘è°±å›¾ï¼Œå¹¶è¾“å‡ºä¸€ä¸ªå•ä¸€çš„ç‰¹å¾å‘é‡ï¼Œç¼–ç äº†éŸ³è‰²ä¿¡æ¯ã€‚æˆ‘ä»¬å°†å…¶åº”ç”¨äº $\mathbf{X}(L_I, S_I, C_I)$ ä»¥è·å¾—å‘é‡ $\mathbf{v}(C_I)$ï¼Œç„¶åå°†å…¶åº”ç”¨äº $\mathbf{X}(L_O, S_O, C_O)$ ä»¥è·å¾—å‘é‡ $\mathbf{v}(C_O)$ã€‚&lt;/p&gt;
&lt;p&gt;æ­£è§„åŒ–æµå±‚å°† $\mathbf{Y}(L_I, S_I, C_I)$ å’Œ $\mathbf{v}(C_I)$ ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¾“å‡ºæ¶ˆé™¤éŸ³è‰²ä¿¡æ¯ä½†ä¿ç•™æ‰€æœ‰å…¶ä»–é£æ ¼å±æ€§çš„ç‰¹å¾è¡¨ç¤º $\mathbf{Z}(L_I, S_I)$ã€‚&lt;strong&gt;ç‰¹å¾ $\mathbf{Z}(L_I, S_I)$ æ²¿ç€æ—¶é—´ç»´åº¦ä¸å›½é™…éŸ³æ ‡ï¼ˆIPA  International Phonetic Alphabetï¼‰&lt;sup id=&#34;fnref:9&#34;&gt;&lt;a href=&#34;#fn:9&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;9&lt;/a&gt;&lt;/sup&gt; å¯¹é½&lt;/strong&gt;ã€‚å…³äºå¦‚ä½•å­¦ä¹ è¿™æ ·çš„ç‰¹å¾è¡¨ç¤ºçš„è¯¦ç»†ä¿¡æ¯å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­è§£é‡Šã€‚ç„¶åï¼Œæˆ‘ä»¬ä»¥é€†æ–¹å‘åº”ç”¨æ­£è§„åŒ–æµå±‚ï¼Œå°† $\mathbf{Z}(L_I, S_I)$ å’Œ $\mathbf{v}(C_O)$ ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¾“å‡º $\mathbf{Y}(L_I, S_I, C_O)$ã€‚è¿™æ˜¯ä¸€ä¸ªå…³é”®æ­¥éª¤ï¼Œå‚è€ƒè¯´è¯è€…çš„éŸ³è‰² $C_O$ è¢«ä½“ç°åˆ°ç‰¹å¾å›¾ä¸­ã€‚ç„¶åï¼Œ$\mathbf{Y}(L_I, S_I, C_O)$ é€šè¿‡åŒ…å«ä¸€å †è½¬ç½® 1D å·ç§¯çš„ HiFi-Gan&lt;sup id=&#34;fnref:10&#34;&gt;&lt;a href=&#34;#fn:10&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;10&lt;/a&gt;&lt;/sup&gt; è§£ç ä¸ºåŸå§‹æ³¢å½¢ $\mathbf{X}(L_I, S_I, C_O)$ã€‚æˆ‘ä»¬çš„ OpenVoice å®ç°ä¸­çš„æ•´ä¸ªæ¨¡å‹éƒ½æ˜¯å‰å‘ä¼ é€’çš„ï¼Œæ²¡æœ‰ä»»ä½•è‡ªå›å½’ç»„ä»¶ã€‚éŸ³è‰²è½¬æ¢å™¨åœ¨æ¦‚å¿µä¸Šç±»ä¼¼äºè¯­éŸ³è½¬æ¢&lt;sup id=&#34;fnref:11&#34;&gt;&lt;a href=&#34;#fn:11&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;11&lt;/a&gt;&lt;/sup&gt; &lt;sup id=&#34;fnref:12&#34;&gt;&lt;a href=&#34;#fn:12&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;12&lt;/a&gt;&lt;/sup&gt; ï¼Œä½†åœ¨åŠŸèƒ½ã€æ¨¡å‹ç»“æ„å’Œè®­ç»ƒç›®æ ‡ä¸Šæœ‰æ‰€ä¸åŒã€‚éŸ³è‰²è½¬æ¢å™¨ä¸­çš„æµå±‚åœ¨ç»“æ„ä¸Šç±»ä¼¼äºåŸºäºæµçš„ TTS æ–¹æ³•&lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt; &lt;sup id=&#34;fnref:13&#34;&gt;&lt;a href=&#34;#fn:13&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;13&lt;/a&gt;&lt;/sup&gt; ï¼Œä½†å…·æœ‰ä¸åŒçš„åŠŸèƒ½å’Œè®­ç»ƒç›®æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ›¿ä»£æ–¹æ³•å’Œç¼ºç‚¹ã€‚&lt;/strong&gt; å°½ç®¡æœ‰æ›¿ä»£æ–¹æ³•&lt;sup id=&#34;fnref:14&#34;&gt;&lt;a href=&#34;#fn:14&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;14&lt;/a&gt;&lt;/sup&gt; &lt;sup id=&#34;fnref:15&#34;&gt;&lt;a href=&#34;#fn:15&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;15&lt;/a&gt;&lt;/sup&gt; &lt;sup id=&#34;fnref:11&#34;&gt;&lt;a href=&#34;#fn:11&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;11&lt;/a&gt;&lt;/sup&gt;  å¯ä»¥æå– $\mathbf{Z}(L_I, S_I)$ï¼Œä½†æˆ‘ä»¬ç»éªŒæ€§åœ°å‘ç°æ‰€æå‡ºçš„æ–¹æ³•å®ç°äº†æœ€ä½³çš„éŸ³é¢‘è´¨é‡ã€‚å¯ä»¥ä½¿ç”¨ HuBERT&lt;sup id=&#34;fnref:14&#34;&gt;&lt;a href=&#34;#fn:14&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;14&lt;/a&gt;&lt;/sup&gt;  æå–ç¦»æ•£æˆ–è¿ç»­çš„å£°å­¦å•å…ƒ&lt;sup id=&#34;fnref:11&#34;&gt;&lt;a href=&#34;#fn:11&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;11&lt;/a&gt;&lt;/sup&gt;   æ¥æ¶ˆé™¤éŸ³è‰²ä¿¡æ¯ï¼Œä½†æˆ‘ä»¬å‘ç°è¿™ç§æ–¹æ³•ä¹Ÿä¼šæ¶ˆé™¤è¾“å…¥è¯­éŸ³çš„æƒ…æ„Ÿå’Œå£éŸ³ã€‚å½“è¾“å…¥æ˜¯æœªè§è¿‡çš„è¯­è¨€æ—¶ï¼Œè¿™ç§æ–¹æ³•ä¹Ÿå­˜åœ¨ä¿ç•™è¯­ç´ è‡ªç„¶å‘éŸ³çš„é—®é¢˜ã€‚æˆ‘ä»¬è¿˜ç ”ç©¶äº†å¦ä¸€ç§æ–¹æ³•&lt;sup id=&#34;fnref:15&#34;&gt;&lt;a href=&#34;#fn:15&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;15&lt;/a&gt;&lt;/sup&gt; ï¼Œå®ƒé€šè¿‡ä»”ç»†æ„å»ºä¿¡æ¯ç“¶é¢ˆä»…ä¿ç•™è¯­éŸ³å†…å®¹ï¼Œä½†æˆ‘ä»¬è§‚å¯Ÿåˆ°è¿™ç§æ–¹æ³•æ— æ³•å®Œå…¨æ¶ˆé™¤éŸ³è‰²ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ–°é¢–æ€§çš„å¤‡æ³¨ã€‚&lt;/strong&gt; OpenVoice å¹¶ä¸æ‰“ç®—&lt;em&gt;å‘æ˜&lt;/em&gt;æ¨¡å‹ç»“æ„ä¸­çš„å­æ¨¡å—ã€‚åŸºç¡€è¯´è¯è€… TTS æ¨¡å‹å’ŒéŸ³è‰²è½¬æ¢å™¨éƒ½ä»ç°æœ‰å·¥ä½œ&lt;sup id=&#34;fnref:13&#34;&gt;&lt;a href=&#34;#fn:13&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;13&lt;/a&gt;&lt;/sup&gt; &lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt;  ä¸­å€Ÿé‰´äº†æ¨¡å‹ç»“æ„ã€‚OpenVoice çš„è´¡çŒ®æ˜¯ &lt;strong&gt;å°†å£°éŸ³é£æ ¼å’Œè¯­è¨€æ§åˆ¶ä¸éŸ³è‰²å…‹éš†åˆ†ç¦»&lt;/strong&gt; çš„è§£è€¦æ¡†æ¶ã€‚è¿™éå¸¸ç®€å•ï¼Œä½†éå¸¸æœ‰æ•ˆï¼Œç‰¹åˆ«æ˜¯å½“æƒ³è¦æ§åˆ¶é£æ ¼ã€å£éŸ³æˆ–æ³›åŒ–åˆ°æ–°è¯­è¨€æ—¶ã€‚å¦‚æœè¦åœ¨ç±»ä¼¼äº XTTS&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;  çš„è€¦åˆæ¡†æ¶ä¸Šå®ç°ç›¸åŒçš„æ§åˆ¶ï¼Œå¯èƒ½éœ€è¦å¤§é‡çš„æ•°æ®å’Œè®¡ç®—ï¼Œè€Œä¸”æµåˆ©åœ°è®²æ¯ç§è¯­è¨€ä¹Ÿç›¸å¯¹å›°éš¾ã€‚åœ¨ OpenVoice ä¸­ï¼Œåªè¦å•è¯´è¯è€… TTS è¯´å¾—æµåˆ©ï¼Œå…‹éš†çš„è¯­éŸ³å°±ä¼šæµåˆ©ã€‚å°†å£°éŸ³é£æ ¼å’Œè¯­è¨€çš„ç”Ÿæˆä¸éŸ³è‰²çš„ç”Ÿæˆåˆ†ç¦»æ˜¯ OpenVoice çš„æ ¸å¿ƒç†å¿µã€‚æˆ‘ä»¬è¿˜åœ¨æˆ‘ä»¬çš„é€‰æ‹©ä¸­æä¾›äº†ä½¿ç”¨éŸ³è‰²è½¬æ¢å™¨ä¸­çš„æµå±‚çš„è§è§£ï¼Œä»¥åŠåœ¨æˆ‘ä»¬çš„å®éªŒéƒ¨åˆ†ä¸­é€‰æ‹©é€šç”¨éŸ³ç´ ç³»ç»Ÿ(&lt;strong&gt;IPA: International Phonetic Alphabet&lt;/strong&gt;)åœ¨è¯­è¨€æ³›åŒ–ä¸­çš„é‡è¦æ€§ã€‚&lt;/p&gt;
&lt;h3 id=&#34;23-è®­ç»ƒ-training&#34;&gt;2.3 è®­ç»ƒ training&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†è®­ç»ƒåŸºç¡€è¯´è¯è€… TTS æ¨¡å‹ï¼Œæˆ‘ä»¬ä»ä¸¤ä½è‹±è¯­è¯´è¯è€…ï¼ˆç¾å›½å£éŸ³å’Œè‹±å›½å£éŸ³ï¼‰ã€ä¸€ä½ä¸­æ–‡è¯´è¯è€…å’Œä¸€ä½æ—¥è¯­è¯´è¯è€…æ”¶é›†äº†éŸ³é¢‘æ ·æœ¬ã€‚æ€»å…±æœ‰ 30K ä¸ªå¥å­ï¼Œå¹³å‡å¥å­é•¿åº¦ä¸º 7 ç§’ã€‚è‹±è¯­å’Œä¸­æ–‡æ•°æ®å…·æœ‰æƒ…æ„Ÿåˆ†ç±»æ ‡ç­¾ã€‚æˆ‘ä»¬ä¿®æ”¹äº† VITS&lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt;  æ¨¡å‹ï¼Œå°†æƒ…æ„Ÿåˆ†ç±»åµŒå…¥ã€è¯­è¨€åˆ†ç±»åµŒå…¥å’Œè¯´è¯è€… id è¾“å…¥åˆ°æ–‡æœ¬ç¼–ç å™¨ã€æŒç»­é¢„æµ‹å™¨å’Œæµå±‚ä¸­ã€‚è®­ç»ƒéµå¾ª VITS ä½œè€…æä¾›çš„æ ‡å‡†æµç¨‹&lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt; ã€‚è®­ç»ƒåçš„æ¨¡å‹èƒ½å¤Ÿé€šè¿‡åˆ‡æ¢ä¸åŒçš„åŸºç¡€è¯´è¯è€…æ¥æ”¹å˜å£éŸ³å’Œè¯­è¨€ï¼Œå¹¶ä»¥ä¸åŒçš„æƒ…æ„Ÿæœ—è¯»è¾“å…¥æ–‡æœ¬ã€‚æˆ‘ä»¬è¿˜å°è¯•äº†é¢å¤–çš„è®­ç»ƒæ•°æ®ï¼Œå¹¶ç¡®è®¤èŠ‚å¥ã€åœé¡¿å’Œè¯­è°ƒå¯ä»¥åƒæƒ…æ„Ÿä¸€æ ·å­¦ä¹ ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è®­ç»ƒéŸ³è‰²è½¬æ¢å™¨ï¼Œæˆ‘ä»¬ä» 20K ä¸ªäººå‘˜æ”¶é›†äº† 300K ä¸ªéŸ³é¢‘æ ·æœ¬ã€‚å¤§çº¦ 18 ä¸‡ä¸ªæ ·æœ¬æ˜¯è‹±è¯­ï¼Œ6 ä¸‡ä¸ªæ ·æœ¬æ˜¯ä¸­æ–‡ï¼Œ6 ä¸‡ä¸ªæ ·æœ¬æ˜¯æ—¥è¯­ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æ‰€è°“çš„ MSML æ•°æ®é›†ã€‚éŸ³è‰²è½¬æ¢å™¨çš„è®­ç»ƒç›®æ ‡æ˜¯åŒé‡çš„ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ±‚ç¼–ç å™¨-è§£ç å™¨äº§ç”Ÿè‡ªç„¶å£°éŸ³ã€‚åœ¨è®­ç»ƒæœŸé—´ï¼Œæˆ‘ä»¬ç›´æ¥å°†ç¼–ç å™¨çš„è¾“å‡ºé¦ˆé€åˆ°è§£ç å™¨ï¼Œå¹¶ä½¿ç”¨åŸå§‹æ³¢å½¢è¿›è¡Œç›‘ç£ï¼Œä½¿ç”¨æ¢…å°”é¢‘è°±æŸå¤±å’Œ HiFi-GAN&lt;sup id=&#34;fnref:10&#34;&gt;&lt;a href=&#34;#fn:10&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;10&lt;/a&gt;&lt;/sup&gt;  æŸå¤±å¯¹ç”Ÿæˆçš„æ³¢å½¢è¿›è¡Œè¯„ä¼°ã€‚æˆ‘ä»¬ä¸ä¼šåœ¨è¿™é‡Œè¯¦ç»†è¯´æ˜ï¼Œå› ä¸ºå…ˆå‰çš„æ–‡çŒ®&lt;sup id=&#34;fnref:10&#34;&gt;&lt;a href=&#34;#fn:10&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;10&lt;/a&gt;&lt;/sup&gt; &lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt; å·²ç»å¾ˆå¥½åœ°è§£é‡Šäº†è¿™ä¸€ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å…¶æ¬¡ï¼Œæˆ‘ä»¬è¦æ±‚æµå±‚å°½å¯èƒ½å¤šåœ°æ¶ˆé™¤éŸ³è‰²ä¿¡æ¯ã€‚åœ¨è®­ç»ƒæœŸé—´ï¼Œå¯¹äºæ¯ä¸ªéŸ³é¢‘æ ·æœ¬ï¼Œå…¶æ–‡æœ¬è¢«è½¬æ¢ä¸º&lt;strong&gt;å›½é™…éŸ³æ ‡ï¼ˆIPAï¼‰ä¸­çš„éŸ³ç´ &lt;/strong&gt;çš„åºåˆ—&lt;sup id=&#34;fnref:9&#34;&gt;&lt;a href=&#34;#fn:9&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;9&lt;/a&gt;&lt;/sup&gt; ï¼Œæ¯ä¸ªéŸ³ç´ ç”±ä¸€ä¸ªå¯å­¦ä¹ çš„å‘é‡åµŒå…¥è¡¨ç¤ºã€‚å‘é‡åµŒå…¥çš„åºåˆ—è¢«ä¼ é€’åˆ°ä¸€ä¸ª Transformer&lt;sup id=&#34;fnref:16&#34;&gt;&lt;a href=&#34;#fn:16&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;16&lt;/a&gt;&lt;/sup&gt;  ç¼–ç å™¨ï¼Œä»¥äº§ç”Ÿæ–‡æœ¬å†…å®¹çš„ç‰¹å¾è¡¨ç¤ºã€‚å°†è¿™ä¸ªç‰¹å¾è¡¨ç¤ºè¡¨ç¤ºä¸º $\mathbf{L}\in\mathbb{R}^{c\times l}$ï¼Œå…¶ä¸­ $c$ æ˜¯ç‰¹å¾é€šé“æ•°ï¼Œ$l$ æ˜¯è¾“å…¥æ–‡æœ¬ä¸­çš„éŸ³ç´ æ•°ã€‚éŸ³é¢‘æ³¢å½¢ç»è¿‡ç¼–ç å™¨å’Œæµå±‚å¤„ç†ï¼Œäº§ç”Ÿç‰¹å¾è¡¨ç¤º $\mathbf{Z}\in\mathbb{R}^{c\times t}$ï¼Œå…¶ä¸­ $t$ æ˜¯ç‰¹å¾æ²¿æ—¶é—´ç»´åº¦çš„é•¿åº¦ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨åŠ¨æ€æ—¶é—´è§„æ•´&lt;sup id=&#34;fnref:17&#34;&gt;&lt;a href=&#34;#fn:17&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;17&lt;/a&gt;&lt;/sup&gt; &lt;sup id=&#34;fnref:18&#34;&gt;&lt;a href=&#34;#fn:18&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;18&lt;/a&gt;&lt;/sup&gt; ï¼ˆå¦ä¸€ç§æ˜¯å•è°ƒè§„æ•´&lt;sup id=&#34;fnref:13&#34;&gt;&lt;a href=&#34;#fn:13&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;13&lt;/a&gt;&lt;/sup&gt; &lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt; ï¼‰å°† $\mathbf{L}$ ä¸ $\mathbf{Z}$ æ²¿ç€æ—¶é—´ç»´åº¦å¯¹é½ï¼Œäº§ç”Ÿ $\mathbf{\bar{L}}\in \mathbb{R}^{c\times t}$ï¼Œå¹¶æœ€å°åŒ– $\mathbf{\bar{L}}$ å’Œ $\mathbf{Z}$ ä¹‹é—´çš„ KL æ•£åº¦ã€‚ç”±äº $\mathbf{\bar{L}}$ ä¸åŒ…å«ä»»ä½•éŸ³è‰²ä¿¡æ¯ï¼Œæœ€å°åŒ–ç›®æ ‡ä¼šé¼“åŠ±æµå±‚ä»è¾“å‡º $\mathbf{Z}$ ä¸­æ¶ˆé™¤éŸ³è‰²ä¿¡æ¯ã€‚æµå±‚è¢«éŸ³è‰²ç¼–ç å™¨çš„éŸ³è‰²ä¿¡æ¯æ‰€æ¡ä»¶åŒ–ï¼Œè¿™è¿›ä¸€æ­¥å¸®åŠ©æµå±‚ç¡®å®šéœ€è¦æ¶ˆé™¤çš„ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æ²¡æœ‰ä¸ºæµå±‚æä¾›ä»»ä½•é£æ ¼æˆ–è¯­è¨€ä¿¡æ¯æ¥è¿›è¡Œæ¡ä»¶åŒ–ï¼Œè¿™é˜²æ­¢äº†æµå±‚é™¤éŸ³è‰²å¤–çš„ä¿¡æ¯ã€‚ç”±äºæµå±‚æ˜¯å¯é€†çš„ï¼Œå°†å®ƒä»¬æ¡ä»¶åŒ–ä¸ºä¸€ä¸ªæ–°çš„éŸ³è‰²ä¿¡æ¯å¹¶è¿è¡Œå…¶é€†è¿‡ç¨‹å¯ä»¥å°†æ–°çš„éŸ³è‰²æ·»åŠ å›ç‰¹å¾è¡¨ç¤ºä¸­ï¼Œç„¶åå°†å…¶è§£ç ä¸ºå¸¦æœ‰æ–°éŸ³è‰²çš„åŸå§‹æ³¢å½¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;3-å®éªŒ-experiment&#34;&gt;3 å®éªŒ Experiment&lt;/h2&gt;
&lt;p&gt;è¯„ä¼°è¯­éŸ³å…‹éš†çš„å‡†ç¡®æ€§å­˜åœ¨å‡ ä¸ªå®¢è§‚ä¸Šçš„å›°éš¾ã€‚é¦–å…ˆï¼Œä¸åŒçš„ç ”ç©¶ï¼ˆä¾‹å¦‚ &lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt; ã€&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt; ï¼‰é€šå¸¸å…·æœ‰ä¸åŒçš„è®­ç»ƒå’Œæµ‹è¯•é›†ã€‚æ•°å­—æ¯”è¾ƒå¯èƒ½ä»æœ¬è´¨ä¸Šæ˜¯ä¸å…¬å¹³çš„ã€‚å³ä½¿ä»–ä»¬çš„æŒ‡æ ‡å¦‚å¹³å‡æ„è§åˆ†æ•°å¯ä»¥é€šè¿‡ä¼—åŒ…è¯„ä¼°ï¼Œæµ‹è¯•é›†çš„å¤šæ ·æ€§å’Œéš¾åº¦ä¹Ÿä¼šæ˜¾è‘—å½±å“ç»“æœã€‚ä¾‹å¦‚ï¼Œå¦‚æœæµ‹è¯•é›†ä¸­è®¸å¤šæ ·æœ¬éƒ½æ˜¯ç¥ç»è¯­éŸ³ï¼Œé›†ä¸­åœ¨äººç±»è¯­éŸ³åˆ†å¸ƒçš„å¹³å‡å€¼ä¸Šï¼Œé‚£ä¹ˆå¤§å¤šæ•°æ–¹æ³•éƒ½ç›¸å¯¹å®¹æ˜“å®ç°è‰¯å¥½çš„è¯­éŸ³å…‹éš†ç»“æœã€‚ç¬¬äºŒï¼Œä¸åŒçš„ç ”ç©¶é€šå¸¸å…·æœ‰ä¸åŒçš„è®­ç»ƒé›†ï¼Œè§„æ¨¡å’Œå¤šæ ·æ€§ä¼šå¯¹ç»“æœäº§ç”Ÿé‡å¤§å½±å“ã€‚ç¬¬ä¸‰ï¼Œä¸åŒçš„ç ”ç©¶å¯èƒ½åœ¨å…¶æ ¸å¿ƒåŠŸèƒ½ä¸Šæœ‰ä¸åŒçš„å…³æ³¨ç‚¹ã€‚OpenVoice ä¸»è¦æ—¨åœ¨éŸ³è‰²å…‹éš†ã€å¯¹è¯­éŸ³é£æ ¼çš„çµæ´»æ§åˆ¶ï¼Œå¹¶ä½¿è·¨è¯­è¨€è¯­éŸ³å…‹éš†å³ä½¿æ²¡æœ‰æ–°è¯­è¨€çš„æµ·é‡è¯´è¯è€…æ•°æ®ä¹Ÿå˜å¾—ç®€å•ã€‚è¿™ä¸ä»¥å‰å…³äºè¯­éŸ³å…‹éš†æˆ–é›¶-shot TTS çš„å·¥ä½œçš„ç›®æ ‡ä¸åŒã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨åˆ†æ OpenVoice æœ¬èº«çš„å®šæ€§æ€§èƒ½ï¼Œå¹¶å…¬å¼€äº†ç›¸å…³ç ”ç©¶äººå‘˜è‡ªç”±è¯„ä¼°çš„éŸ³é¢‘æ ·æœ¬ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å‡†ç¡®çš„éŸ³è‰²å…‹éš†ã€‚&lt;/strong&gt; æˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªå‚è€ƒè¯´è¯è€…çš„æµ‹è¯•é›†ï¼Œé€‰æ‹©äº†åäººã€æ¸¸æˆè§’è‰²å’ŒåŒ¿åä¸ªä½“ã€‚æµ‹è¯•é›†æ¶µç›–äº†å¹¿æ³›çš„è¯­éŸ³åˆ†å¸ƒï¼ŒåŒ…æ‹¬å…·æœ‰è¡¨ç°åŠ›çš„ç‹¬ç‰¹è¯­éŸ³å’Œäººç±»è¯­éŸ³åˆ†å¸ƒä¸­çš„ä¸­æ€§æ ·æœ¬ã€‚ä½¿ç”¨ä»»ä½• 4 ä¸ªåŸºç¡€è¯´è¯è€…å’Œä»»ä½•å‚è€ƒè¯´è¯è€…ï¼ŒOpenVoice éƒ½èƒ½å‡†ç¡®å…‹éš†å‚è€ƒéŸ³è‰²ï¼Œå¹¶ä»¥å¤šç§è¯­è¨€å’Œå£éŸ³ç”Ÿæˆè¯­éŸ³ã€‚æˆ‘ä»¬é‚€è¯·è¯»è€…è®¿é—®è¯¥ç½‘ç«™ &lt;a href=&#34;https://research.myshell.ai/open-voice/accurate-tone-color-cloning&#34;&gt;https://research.myshell.ai/open-voice/accurate-tone-color-cloning&lt;/a&gt; è·å–å®šæ€§ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¯¹è¯­éŸ³é£æ ¼çš„çµæ´»æ§åˆ¶ã€‚&lt;/strong&gt; æå‡ºçš„æ¡†æ¶èƒ½å¤Ÿçµæ´»æ§åˆ¶è¯­éŸ³é£æ ¼çš„å‰ææ˜¯éŸ³è‰²è½¬æ¢å™¨èƒ½å¤Ÿä»…ä¿®æ”¹éŸ³è‰²å¹¶ä¿ç•™æ‰€æœ‰å…¶ä»–é£æ ¼å’Œè¯­éŸ³å±æ€§ã€‚ä¸ºäº†ç¡®è®¤è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†æˆ‘ä»¬çš„åŸºç¡€è¯´è¯è€…æ¨¡å‹å’Œ Microsoft TTS with SSML æ¥ç”Ÿæˆä¸€ä¸ªåŒ…å« 1K ä¸ªæ ·æœ¬çš„å…·æœ‰å¤šç§é£æ ¼ï¼ˆæƒ…æ„Ÿã€å£éŸ³ã€èŠ‚å¥ã€åœé¡¿å’Œè¯­è°ƒï¼‰çš„è¯­éŸ³è¯­æ–™åº“ä½œä¸ºåŸºç¡€è¯­éŸ³ã€‚è½¬æ¢ä¸ºå‚è€ƒéŸ³è‰²åï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°æ‰€æœ‰é£æ ¼éƒ½è¢«å¾ˆå¥½åœ°ä¿ç•™ã€‚åœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼Œæƒ…æ„Ÿä¼šç•¥å¾®ä¸­æ€§åŒ–ï¼Œæˆ‘ä»¬å‘ç°è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯ç”¨åŒä¸€åŸºç¡€è¯´è¯è€…çš„å…·æœ‰ä¸åŒæƒ…æ„Ÿçš„å¤šä¸ªå¥å­çš„å¹³å‡å‘é‡æ›¿æ¢è¯¥ç‰¹å®šå¥å­çš„éŸ³è‰²åµŒå…¥å‘é‡ã€‚è¿™æ ·åšä¼šç»™æµå±‚æä¾›è¾ƒå°‘çš„æƒ…æ„Ÿä¿¡æ¯ï¼Œä»¥ä¾¿å®ƒä»¬ä¸ä¼šæ¶ˆé™¤æƒ…æ„Ÿã€‚ç”±äºéŸ³è‰²è½¬æ¢å™¨èƒ½å¤Ÿä¿ç•™åŸºç¡€å£°éŸ³çš„æ‰€æœ‰é£æ ¼ï¼Œé€šè¿‡ç®€å•æ“ä½œåŸºç¡€è¯´è¯è€… TTS æ¨¡å‹æ¥æ§åˆ¶è¯­éŸ³é£æ ¼å˜å¾—éå¸¸ç®€å•ã€‚å®šæ€§ç»“æœå¯åœ¨æ­¤ç½‘ç«™ä¸Šå…¬å¼€è·å¾— &lt;a href=&#34;https://research.myshell.ai/open-voice/flexible-voice-style-control&#34;&gt;https://research.myshell.ai/open-voice/flexible-voice-style-control&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è½»æ¾çš„è·¨è¯­è¨€è¯­éŸ³å…‹éš†ã€‚&lt;/strong&gt; OpenVoice å®ç°äº†å‡ ä¹é›¶-shot çš„è·¨è¯­è¨€è¯­éŸ³å…‹éš†ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨æ–°è¯­è¨€çš„æµ·é‡è¯´è¯è€…æ•°æ®ã€‚å®ƒç¡®å®éœ€è¦è¯­è¨€çš„åŸºç¡€è¯´è¯è€…ï¼Œå¯ä»¥é€šè¿‡ç°æˆçš„æ¨¡å‹å’Œæ•°æ®é›†è½»æ¾å®ç°ã€‚åœ¨æˆ‘ä»¬çš„ç½‘ç«™ &lt;a href=&#34;https://research.myshell.ai/open-voice/zero-shot-cross-lingual-voice-cloning&#34;&gt;https://research.myshell.ai/open-voice/zero-shot-cross-lingual-voice-cloning&lt;/a&gt; ä¸Šï¼Œæˆ‘ä»¬æä¾›äº†ä¸°å¯Œçš„æ ·æœ¬ï¼Œå±•ç¤ºäº†æ‰€æå‡ºæ–¹æ³•çš„è·¨è¯­è¨€è¯­éŸ³å…‹éš†èƒ½åŠ›ã€‚è·¨è¯­è¨€èƒ½åŠ›æœ‰ä¸¤ä¸ªæ–¹é¢ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å½“å‚è€ƒè¯´è¯è€…çš„è¯­è¨€åœ¨ MSML æ•°æ®é›†ä¸­çœ‹ä¸åˆ°æ—¶ï¼Œæ¨¡å‹èƒ½å¤Ÿå‡†ç¡®å…‹éš†å‚è€ƒè¯´è¯è€…çš„éŸ³è‰²ã€‚&lt;/li&gt;
&lt;li&gt;å½“ç”Ÿæˆè¯­éŸ³çš„è¯­è¨€åœ¨ MSML æ•°æ®é›†ä¸­çœ‹ä¸åˆ°æ—¶ï¼Œæ¨¡å‹èƒ½å¤Ÿå…‹éš†å‚è€ƒå£°éŸ³å¹¶ä»¥è¯¥è¯­è¨€è¯´è¯ï¼Œåªè¦åŸºç¡€è¯´è¯è€… TTS æ”¯æŒè¯¥è¯­è¨€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ä½æˆæœ¬å¿«é€Ÿæ¨ç†ã€‚&lt;/strong&gt; ç”±äº OpenVoice æ˜¯ä¸€ä¸ªå‰å‘ç»“æ„ï¼Œæ²¡æœ‰ä»»ä½•è‡ªå›å½’ç»„ä»¶ï¼Œå®ƒå…·æœ‰éå¸¸é«˜çš„æ¨ç†é€Ÿåº¦ã€‚æˆ‘ä»¬çš„å®éªŒè¡¨æ˜ï¼Œç•¥å¾®ä¼˜åŒ–çš„ OpenVoice ç‰ˆæœ¬ï¼ˆåŒ…æ‹¬åŸºç¡€è¯´è¯è€…æ¨¡å‹å’ŒéŸ³è‰²è½¬æ¢å™¨ï¼‰èƒ½å¤Ÿåœ¨å•ä¸ª A10G GPU ä¸Šå®ç° $12\times$ çš„å®æ—¶æ€§èƒ½ï¼Œè¿™æ„å‘³ç€ç”Ÿæˆä¸€ç§’è¯­éŸ³åªéœ€ 85msã€‚é€šè¿‡è¯¦ç»†çš„ GPU ä½¿ç”¨åˆ†æï¼Œæˆ‘ä»¬ä¼°è®¡ä¸Šé™çº¦ä¸º $40\times$ çš„å®æ—¶æ€§èƒ½ï¼Œä½†æˆ‘ä»¬å°†è¿™ä¸€æ”¹è¿›ç•™ä½œå°†æ¥çš„å·¥ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;IPA çš„é‡è¦æ€§ã€‚&lt;/strong&gt; æˆ‘ä»¬å‘ç°å°† IPA ç”¨ä½œéŸ³ç´ è¯å…¸å¯¹äºéŸ³è‰²è½¬æ¢å™¨æ‰§è¡Œè·¨è¯­è¨€è¯­éŸ³å…‹éš†è‡³å…³é‡è¦ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨ç¬¬2.3èŠ‚ä¸­è¯¦ç»†è¯´æ˜çš„é‚£æ ·ï¼Œåœ¨è®­ç»ƒéŸ³è‰²è½¬æ¢å™¨æ—¶ï¼Œé¦–å…ˆå°†æ–‡æœ¬è½¬æ¢ä¸º IPA ä¸­çš„ä¸€ç³»åˆ—éŸ³ç´ ï¼Œç„¶åæ¯ä¸ªéŸ³ç´ ç”±ä¸€ä¸ªå¯å­¦ä¹ çš„å‘é‡åµŒå…¥è¡¨ç¤ºã€‚åµŒå…¥åºåˆ—é€šè¿‡å˜å‹å™¨å±‚ç¼–ç ï¼Œå¹¶ä¸æµå±‚çš„è¾“å‡ºè®¡ç®—æŸå¤±ï¼Œæ—¨åœ¨æ¶ˆé™¤éŸ³è‰²ä¿¡æ¯ã€‚IPA æœ¬èº«æ˜¯ä¸€ä¸ªè·¨è¯­è¨€ç»Ÿä¸€çš„éŸ³ç´ è¯å…¸ï¼Œè¿™ä½¿å¾—æµå±‚èƒ½å¤Ÿäº§ç”Ÿè¯­è¨€ä¸­æ€§çš„è¡¨ç¤ºã€‚å³ä½¿æˆ‘ä»¬å‘éŸ³è‰²è½¬æ¢å™¨è¾“å…¥å…·æœ‰çœ‹ä¸è§è¯­è¨€çš„è¯­éŸ³ï¼Œå®ƒä»èƒ½é¡ºåˆ©å¤„ç†éŸ³é¢‘ã€‚æˆ‘ä»¬è¿˜å°è¯•è¿‡å…¶ä»–ç±»å‹çš„éŸ³ç´ è¯å…¸ï¼Œä½†ç”Ÿæˆçš„éŸ³è‰²è½¬æ¢å™¨å¾€å¾€ä¼šåœ¨æœªçŸ¥è¯­è¨€ä¸­å‘éŸ³ä¸å‡†ç¡®ã€‚è™½ç„¶è¾“å…¥éŸ³é¢‘æ˜¯æ­£ç¡®çš„ï¼Œä½†è¾“å‡ºéŸ³é¢‘å¾ˆå¯èƒ½æœ‰é—®é¢˜ï¼Œå¬èµ·æ¥ä¸åƒæ˜¯æ¯è¯­äººå£«ã€‚&lt;/p&gt;
&lt;h2 id=&#34;4-è®¨è®º&#34;&gt;4 è®¨è®º&lt;/h2&gt;
&lt;p&gt;OpenVoice å±•ç¤ºäº†å‡ºè‰²çš„å®ä¾‹è¯­éŸ³å…‹éš†èƒ½åŠ›ï¼Œå¹¶åœ¨è¯­éŸ³é£æ ¼å’Œè¯­è¨€æ–¹é¢æ¯”ä»¥å‰çš„æ–¹æ³•æ›´åŠ çµæ´»ã€‚è¯¥æ–¹æ³•èƒŒåçš„ç›´è§‰æ˜¯ï¼Œåªè¦æˆ‘ä»¬ä¸è¦æ±‚æ¨¡å‹å…·æœ‰å…‹éš†å‚è€ƒè¯´è¯è€…éŸ³è‰²çš„èƒ½åŠ›ï¼Œè®­ç»ƒåŸºç¡€è¯´è¯è€… TTS æ¨¡å‹æ¥æ§åˆ¶è¯­éŸ³é£æ ¼å’Œè¯­è¨€ç›¸å¯¹å®¹æ˜“ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å»ºè®®å°†éŸ³è‰²å…‹éš†ä¸å…¶ä½™è¯­éŸ³é£æ ¼å’Œè¯­è¨€åˆ†ç¦»ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™æ˜¯ OpenVoice çš„åŸºæœ¬è®¾è®¡åŸåˆ™ã€‚ä¸ºäº†ä¿ƒè¿›æœªæ¥çš„ç ”ç©¶ï¼Œæˆ‘ä»¬å…¬å¼€äº†æºä»£ç å’Œæ¨¡å‹æƒé‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é™„æ¨¡å‹ç»“æ„-é…ç½®å’Œæ¨¡å—&#34;&gt;é™„ï¼šæ¨¡å‹ç»“æ„-é…ç½®å’Œæ¨¡å—&lt;/h2&gt;
&lt;p&gt;Config:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;nt&#34;&gt;&amp;#34;_version_&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;v2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;nt&#34;&gt;&amp;#34;data&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;sampling_rate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;22050&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_length&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;hop_length&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;256&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;win_length&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;n_speakers&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
  &lt;span class=&#34;nt&#34;&gt;&amp;#34;model&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;zero_g&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;inter_channels&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;192&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;hidden_channels&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;192&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;filter_channels&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;768&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;n_heads&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;n_layers&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;kernel_size&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;p_dropout&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;resblock&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;resblock_kernel_sizes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
      &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
      &lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
      &lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;resblock_dilation_sizes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;upsample_rates&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
      &lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
      &lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
      &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
      &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;upsample_initial_channel&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;512&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;upsample_kernel_sizes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
      &lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
      &lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
      &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
      &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;gin_channels&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;256&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;æ•´ä½“æ¨ç†è¿‡ç¨‹ å’Œ éŸ³è‰²è½¬æ¢è¿‡ç¨‹å¦‚å›¾ä»£ç æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/multimoding/voices/open_voice_inference/3.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Reference encoder: ReferenceEncoder (å½“æ¨¡å‹é…ç½®ä¸ºn_speakers==0çš„æ—¶å€™ä½¿ç”¨)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;  (ref_enc): ReferenceEncoder(
    (convs): ModuleList(
      (0): Conv2d(1, 32, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1))
      (1): Conv2d(32, 32, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1))
      (2): Conv2d(32, 64, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1))
      (3): Conv2d(64, 64, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1))
      (4): Conv2d(64, 128, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1))
      (5): Conv2d(128, 128, kernel_size=(3, 3), stride=(2, 2), padding=(1, 1))
    )
    (gru): GRU(1152, 128, batch_first=True)
    (proj): Linear(in_features=128, out_features=256, bias=True)
    (layernorm): LayerNorm((513,), eps=1e-05, elementwise_affine=True)
  )
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;forward:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;forward&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;inputs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mask&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;N&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;inputs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;inputs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;view&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;N&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;spec_channels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# [N, 1, Ty, n_freqs]&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;layernorm&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;layernorm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;conv&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;convs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;conv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;# out = wn(out)&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;F&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;relu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# [N, 128, Ty//2^K, n_mels//2^K]&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;transpose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# [N, Ty//2^K, 128, n_mels//2^K]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;T&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;N&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;contiguous&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;view&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;N&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;T&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# [N, Ty//2^K, 128*n_mels//2^K]&lt;/span&gt;

    &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gru&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flatten_parameters&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gru&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# out --- [1, N, 128]&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;proj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;squeeze&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;encoder: PosteriorEncoder&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;  (enc_q): PosteriorEncoder(
    (pre): Conv1d(513, 192, kernel_size=(1,), stride=(1,))
    (enc): WN(
      (in_layers): ModuleList(
        (0-15): 16 x Conv1d(192, 384, kernel_size=(5,), stride=(1,), padding=(2,))
      )
      (res_skip_layers): ModuleList(
        (0-14): 15 x Conv1d(192, 384, kernel_size=(1,), stride=(1,))
        (15): Conv1d(192, 192, kernel_size=(1,), stride=(1,))
      )
      (drop): Dropout(p=0, inplace=False)
      (cond_layer): Conv1d(256, 6144, kernel_size=(1,), stride=(1,))
    )
    (proj): Conv1d(192, 384, kernel_size=(1,), stride=(1,))
  )
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;forward:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;forward&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x_lengths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tau&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1.0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;x_mask&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unsqueeze&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commons&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sequence_mask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x_lengths&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)),&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dtype&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pre&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x_mask&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;enc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x_mask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;stats&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;proj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x_mask&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;logs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stats&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;out_channels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dim&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;z&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;randn_like&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tau&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;logs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x_mask&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;z&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;m&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;logs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x_mask&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;flow: ResidualCouplingBlock&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;  (flow): ResidualCouplingBlock(
    (flows): ModuleList(
      (0): ResidualCouplingLayer(
        (pre): Conv1d(96, 192, kernel_size=(1,), stride=(1,))
        (enc): WN(
          (in_layers): ModuleList(
            (0-3): 4 x Conv1d(192, 384, kernel_size=(5,), stride=(1,), padding=(2,))
          )
          (res_skip_layers): ModuleList(
            (0-2): 3 x Conv1d(192, 384, kernel_size=(1,), stride=(1,))
            (3): Conv1d(192, 192, kernel_size=(1,), stride=(1,))
          )
          (drop): Dropout(p=0, inplace=False)
          (cond_layer): Conv1d(256, 1536, kernel_size=(1,), stride=(1,))
        )
        (post): Conv1d(192, 96, kernel_size=(1,), stride=(1,))
      )
      (1): Flip()
      (2): ResidualCouplingLayer(
        (pre): Conv1d(96, 192, kernel_size=(1,), stride=(1,))
        (enc): WN(
          (in_layers): ModuleList(
            (0-3): 4 x Conv1d(192, 384, kernel_size=(5,), stride=(1,), padding=(2,))
          )
          (res_skip_layers): ModuleList(
            (0-2): 3 x Conv1d(192, 384, kernel_size=(1,), stride=(1,))
            (3): Conv1d(192, 192, kernel_size=(1,), stride=(1,))
          )
          (drop): Dropout(p=0, inplace=False)
          (cond_layer): Conv1d(256, 1536, kernel_size=(1,), stride=(1,))
        )
        (post): Conv1d(192, 96, kernel_size=(1,), stride=(1,))
      )
      (3): Flip()
      (4): ResidualCouplingLayer(
        (pre): Conv1d(96, 192, kernel_size=(1,), stride=(1,))
        (enc): WN(
          (in_layers): ModuleList(
            (0-3): 4 x Conv1d(192, 384, kernel_size=(5,), stride=(1,), padding=(2,))
          )
          (res_skip_layers): ModuleList(
            (0-2): 3 x Conv1d(192, 384, kernel_size=(1,), stride=(1,))
            (3): Conv1d(192, 192, kernel_size=(1,), stride=(1,))
          )
          (drop): Dropout(p=0, inplace=False)
          (cond_layer): Conv1d(256, 1536, kernel_size=(1,), stride=(1,))
        )
        (post): Conv1d(192, 96, kernel_size=(1,), stride=(1,))
      )
      (5): Flip()
      (6): ResidualCouplingLayer(
        (pre): Conv1d(96, 192, kernel_size=(1,), stride=(1,))
        (enc): WN(
          (in_layers): ModuleList(
            (0-3): 4 x Conv1d(192, 384, kernel_size=(5,), stride=(1,), padding=(2,))
          )
          (res_skip_layers): ModuleList(
            (0-2): 3 x Conv1d(192, 384, kernel_size=(1,), stride=(1,))
            (3): Conv1d(192, 192, kernel_size=(1,), stride=(1,))
          )
          (drop): Dropout(p=0, inplace=False)
          (cond_layer): Conv1d(256, 1536, kernel_size=(1,), stride=(1,))
        )
        (post): Conv1d(192, 96, kernel_size=(1,), stride=(1,))
      )
      (7): Flip()
    )
  )
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;forward:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;forward&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x_mask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;reverse&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;reverse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flow&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x_mask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;reverse&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;reverse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flow&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;reversed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x_mask&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;reverse&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;reverse&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr&gt;
&lt;p&gt;decoder: Generator (HIFI-GAN Generator)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;  (dec): Generator(
    (conv_pre): Conv1d(192, 512, kernel_size=(7,), stride=(1,), padding=(3,))
    (ups): ModuleList(
      (0): ConvTranspose1d(512, 256, kernel_size=(16,), stride=(8,), padding=(4,))
      (1): ConvTranspose1d(256, 128, kernel_size=(16,), stride=(8,), padding=(4,))
      (2): ConvTranspose1d(128, 64, kernel_size=(4,), stride=(2,), padding=(1,))
      (3): ConvTranspose1d(64, 32, kernel_size=(4,), stride=(2,), padding=(1,))
    )
    (resblocks): ModuleList(
      (0): ResBlock1(
        (convs1): ModuleList(
          (0): Conv1d(256, 256, kernel_size=(3,), stride=(1,), padding=(1,))
          (1): Conv1d(256, 256, kernel_size=(3,), stride=(1,), padding=(3,), dilation=(3,))
          (2): Conv1d(256, 256, kernel_size=(3,), stride=(1,), padding=(5,), dilation=(5,))
        )
        (convs2): ModuleList(
          (0-2): 3 x Conv1d(256, 256, kernel_size=(3,), stride=(1,), padding=(1,))
        )
      )
      (1): ResBlock1(
        (convs1): ModuleList(
          (0): Conv1d(256, 256, kernel_size=(7,), stride=(1,), padding=(3,))
          (1): Conv1d(256, 256, kernel_size=(7,), stride=(1,), padding=(9,), dilation=(3,))
          (2): Conv1d(256, 256, kernel_size=(7,), stride=(1,), padding=(15,), dilation=(5,))
        )
        (convs2): ModuleList(
          (0-2): 3 x Conv1d(256, 256, kernel_size=(7,), stride=(1,), padding=(3,))
        )
      )
      (2): ResBlock1(
        (convs1): ModuleList(
          (0): Conv1d(256, 256, kernel_size=(11,), stride=(1,), padding=(5,))
          (1): Conv1d(256, 256, kernel_size=(11,), stride=(1,), padding=(15,), dilation=(3,))
          (2): Conv1d(256, 256, kernel_size=(11,), stride=(1,), padding=(25,), dilation=(5,))
        )
        (convs2): ModuleList(
          (0-2): 3 x Conv1d(256, 256, kernel_size=(11,), stride=(1,), padding=(5,))
        )
      )
      (3): ResBlock1(
        (convs1): ModuleList(
          (0): Conv1d(128, 128, kernel_size=(3,), stride=(1,), padding=(1,))
          (1): Conv1d(128, 128, kernel_size=(3,), stride=(1,), padding=(3,), dilation=(3,))
          (2): Conv1d(128, 128, kernel_size=(3,), stride=(1,), padding=(5,), dilation=(5,))
        )
        (convs2): ModuleList(
          (0-2): 3 x Conv1d(128, 128, kernel_size=(3,), stride=(1,), padding=(1,))
        )
      )
      (4): ResBlock1(
        (convs1): ModuleList(
          (0): Conv1d(128, 128, kernel_size=(7,), stride=(1,), padding=(3,))
          (1): Conv1d(128, 128, kernel_size=(7,), stride=(1,), padding=(9,), dilation=(3,))
          (2): Conv1d(128, 128, kernel_size=(7,), stride=(1,), padding=(15,), dilation=(5,))
        )
        (convs2): ModuleList(
          (0-2): 3 x Conv1d(128, 128, kernel_size=(7,), stride=(1,), padding=(3,))
        )
      )
      (5): ResBlock1(
        (convs1): ModuleList(
          (0): Conv1d(128, 128, kernel_size=(11,), stride=(1,), padding=(5,))
          (1): Conv1d(128, 128, kernel_size=(11,), stride=(1,), padding=(15,), dilation=(3,))
          (2): Conv1d(128, 128, kernel_size=(11,), stride=(1,), padding=(25,), dilation=(5,))
        )
        (convs2): ModuleList(
          (0-2): 3 x Conv1d(128, 128, kernel_size=(11,), stride=(1,), padding=(5,))
        )
      )
      (6): ResBlock1(
        (convs1): ModuleList(
          (0): Conv1d(64, 64, kernel_size=(3,), stride=(1,), padding=(1,))
          (1): Conv1d(64, 64, kernel_size=(3,), stride=(1,), padding=(3,), dilation=(3,))
          (2): Conv1d(64, 64, kernel_size=(3,), stride=(1,), padding=(5,), dilation=(5,))
        )
        (convs2): ModuleList(
          (0-2): 3 x Conv1d(64, 64, kernel_size=(3,), stride=(1,), padding=(1,))
        )
      )
      (7): ResBlock1(
        (convs1): ModuleList(
          (0): Conv1d(64, 64, kernel_size=(7,), stride=(1,), padding=(3,))
          (1): Conv1d(64, 64, kernel_size=(7,), stride=(1,), padding=(9,), dilation=(3,))
          (2): Conv1d(64, 64, kernel_size=(7,), stride=(1,), padding=(15,), dilation=(5,))
        )
        (convs2): ModuleList(
          (0-2): 3 x Conv1d(64, 64, kernel_size=(7,), stride=(1,), padding=(3,))
        )
      )
      (8): ResBlock1(
        (convs1): ModuleList(
          (0): Conv1d(64, 64, kernel_size=(11,), stride=(1,), padding=(5,))
          (1): Conv1d(64, 64, kernel_size=(11,), stride=(1,), padding=(15,), dilation=(3,))
          (2): Conv1d(64, 64, kernel_size=(11,), stride=(1,), padding=(25,), dilation=(5,))
        )
        (convs2): ModuleList(
          (0-2): 3 x Conv1d(64, 64, kernel_size=(11,), stride=(1,), padding=(5,))
        )
      )
      (9): ResBlock1(
        (convs1): ModuleList(
          (0): Conv1d(32, 32, kernel_size=(3,), stride=(1,), padding=(1,))
          (1): Conv1d(32, 32, kernel_size=(3,), stride=(1,), padding=(3,), dilation=(3,))
          (2): Conv1d(32, 32, kernel_size=(3,), stride=(1,), padding=(5,), dilation=(5,))
        )
        (convs2): ModuleList(
          (0-2): 3 x Conv1d(32, 32, kernel_size=(3,), stride=(1,), padding=(1,))
        )
      )
      (10): ResBlock1(
        (convs1): ModuleList(
          (0): Conv1d(32, 32, kernel_size=(7,), stride=(1,), padding=(3,))
          (1): Conv1d(32, 32, kernel_size=(7,), stride=(1,), padding=(9,), dilation=(3,))
          (2): Conv1d(32, 32, kernel_size=(7,), stride=(1,), padding=(15,), dilation=(5,))
        )
        (convs2): ModuleList(
          (0-2): 3 x Conv1d(32, 32, kernel_size=(7,), stride=(1,), padding=(3,))
        )
      )
      (11): ResBlock1(
        (convs1): ModuleList(
          (0): Conv1d(32, 32, kernel_size=(11,), stride=(1,), padding=(5,))
          (1): Conv1d(32, 32, kernel_size=(11,), stride=(1,), padding=(15,), dilation=(3,))
          (2): Conv1d(32, 32, kernel_size=(11,), stride=(1,), padding=(25,), dilation=(5,))
        )
        (convs2): ModuleList(
          (0-2): 3 x Conv1d(32, 32, kernel_size=(11,), stride=(1,), padding=(5,))
        )
      )
    )
    (conv_post): Conv1d(32, 1, kernel_size=(7,), stride=(1,), padding=(3,), bias=False)
    (cond): Conv1d(256, 512, kernel_size=(1,), stride=(1,))
  )
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;forward:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;forward&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;conv_pre&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;g&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cond&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_upsamples&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;F&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaky_relu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;modules&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LRELU_SLOPE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;](&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;xs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;None&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;j&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_kernels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
            &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;xs&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
                &lt;span class=&#34;n&#34;&gt;xs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;resblocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_kernels&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;](&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
            &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
                &lt;span class=&#34;n&#34;&gt;xs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;resblocks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_kernels&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;j&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;](&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;xs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_kernels&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;F&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaky_relu&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;conv_post&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tanh&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;HIFI-GAN generator ç»“æ„&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/multimoding/voices/open_voice_inference/4.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;section class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;C. Wang, S. Chen, Y. Wu, Z. Zhang, L. Zhou, S. Liu, Z. Chen, Y. Liu, H. Wang, J. Li, et al. Neural codec language models are zero-shot text to speech synthesizers. arXiv preprint arXiv:2301.02111, 2023.&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;CoquiAI. Xtts taking text-to-speech to the next level. Technical Blog, 2023.&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;E. Casanova, J. Weber, C. D. Shulby, A. C. Junior, E. GÃ¶lge, and M. A. Ponti. Yourtts: Towards zero-shot multi-speaker tts and zero-shot voice conversion for everyone. In International Conference on Machine Learning, pages 2709â€“2720. PMLR, 2022.&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:4&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;M. Le, A. Vyas, B. Shi, B. Karrer, L. Sari, R. Moritz, M. Williamson, V. Manohar, Y. Adi, J. Mahadeokar, et al. Voicebox: Text-guided multilingual universal speech generation at scale. arXiv preprint arXiv:2306.15687, 2023.&amp;#160;&lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:5&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Z. Zhang, L. Zhou, C. Wang, S. Chen, Y. Wu, S. Liu, Z. Chen, Y. Liu, H. Wang, J. Li, et al. Speak foreign languages with your own voice: Cross-lingual neural codec language modeling. arXiv preprint arXiv:2303.03926, 2023.&amp;#160;&lt;a href=&#34;#fnref:5&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:6&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;J. Kim, J. Kong, and J. Son. Conditional variational autoencoder with adversarial learning for end-to-end text-to-speech. In International Conference on Machine Learning, pages 5530â€“5540. PMLR, 2021.&amp;#160;&lt;a href=&#34;#fnref:6&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:7&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;D. Yang, S. Liu, R. Huang, G. Lei, C. Weng, H. Meng, and D. Yu. Instructtts: Modelling expressive tts in discrete latent space with natural language style prompt. arXiv preprint arXiv:2301.13662, 2023.&amp;#160;&lt;a href=&#34;#fnref:7&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:8&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;D. Rezende and S. Mohamed. Variational inference with normalizing flows. In International conference on machine learning, pages 1530â€“1538. PMLR, 2015.&amp;#160;&lt;a href=&#34;#fnref:8&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:9&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;I. P. Association. Handbook of the International Phonetic Association: A guide to the use of the International Phonetic Alphabet. Cambridge University Press, 1999.&amp;#160;&lt;a href=&#34;#fnref:9&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:10&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;J. Kong, J. Kim, and J. Bae. HiFi-GAN: Generative adversarial networks for efficient and high fidelity speech synthesis. Advances in Neural Information Processing Systems, 33:17022â€“17033, 2020.&amp;#160;&lt;a href=&#34;#fnref:10&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:11&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;B. van Niekerk, M.-A. Carbonneau, J. ZaÃ¯di, M. Baas, H. SeutÃ©, and H. Kamper. A comparison of discrete and soft speech units for improved voice conversion. In ICASSP 2022-2022 IEEE International Conference on Acoustics, Speech and Signal Processing (ICASSP), pages 6562â€“6566. IEEE, 2022.&amp;#160;&lt;a href=&#34;#fnref:11&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:12&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;A. Polyak, Y. Adi, J. Copet, E. Kharitonov, K. Lakhotia, W.-N. Hsu, A. Mohamed, and E. Dupoux. Speech resynthesis from discrete disentangled self-supervised representations. arXiv preprint arXiv:2104.00355, 2021.&amp;#160;&lt;a href=&#34;#fnref:12&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:13&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;J. Kim, S. Kim, J. Kong, and S. Yoon. Glow-tts: A generative flow for text-to-speech via monotonic alignment search. Advances in Neural Information Processing Systems, 33:8067â€“8077, 2020.&amp;#160;&lt;a href=&#34;#fnref:13&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:14&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;W.-N. Hsu, B. Bolte, Y.-H. H. Tsai, K. Lakhotia, R. Salakhutdinov, and A. Mohamed. HuBERT: Self-supervised speech representation learning by masked prediction of hidden units. IEEE/ACM Transactions on Audio, Speech, and Language Processing, 29:3451â€“3460, 2021.&amp;#160;&lt;a href=&#34;#fnref:14&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:15&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;J. Li, W. Tu, and L. Xiao. Freevc: Towards high-quality text-free one-shot voice conversion. In ICASSP 2023-2023 IEEE International Conference on Acoustics, Speech and Signal Processing (ICASSP), pages 1â€“5. IEEE, 2023.&amp;#160;&lt;a href=&#34;#fnref:15&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:16&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;A. Vaswani, N. Shazeer, N. Parmar, J. Uszkoreit, L. Jones, A. N. Gomez, Å. Kaiser, and I. Polosukhin. Attention is all you need. Advances in neural information processing systems, 30, 2017.&amp;#160;&lt;a href=&#34;#fnref:16&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:17&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;P. Senin. Dynamic time warping algorithm review. Information and Computer Science Department University of Hawaii at Manoa Honolulu, USA, 855(1-23):40, 2008.&amp;#160;&lt;a href=&#34;#fnref:17&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:18&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;M. MÃ¼ller. Dynamic time warping. Information retrieval for music and motion, pages 69â€“84, 2007.&amp;#160;&lt;a href=&#34;#fnref:18&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;</description>
      
    </item>
    
    <item>
      <title>è®ºæ–‡è§£è¯» DeLighT: Very Deep and Light-weight Transformers</title>
      <link>https://weedge.github.io/post/paper/transformer/delight/</link>
      <pubDate>Sun, 28 Apr 2024 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/paper/transformer/delight/</guid>
      
        <description>&lt;p&gt;åœ¨çœ‹apple æœ€è¿‘å‘å¸ƒçš„OpenELM æ¨¡å‹ï¼Œå…¶è®ºæ–‡ä¸­æåˆ° block-wise scaling æ¨¡å‹ç»“æ„ä¼˜åŒ–æ–¹æ³•ï¼Œï¼ˆè®ºæ–‡è§ï¼š &lt;a href=&#34;https://machinelearning.apple.com/research/openelm&#34;&gt;&lt;strong&gt;OpenELM: An Efficient Language Model Family with Open-source Training and Inference Framework&lt;/strong&gt;&lt;/a&gt;ï¼‰ï¼Œè¿™é‡Œè®°å½•ä¸‹DeLighTè®ºæ–‡ä¸­çš„ block-wise scalingï¼Œç¿»è¯‘æ•´ç†ä¸‹ä»¥ä¾¿å¯¹ç…§ä»£ç å®ç°ï¼Œäº†è§£èƒŒæ™¯å’ŒåŸç†ã€‚DeLighTè®ºæ–‡ä¸­çš„å®éªŒä»»åŠ¡ä¸»è¦æ˜¯åœ¨ä¸¤ä¸ªæ ‡å‡†çš„åºåˆ—å»ºæ¨¡ä»»åŠ¡ä¸Šè¯„ä¼°äº†DeLighTçš„æ€§èƒ½ï¼šæœºå™¨ç¿»è¯‘ï¼ˆmachine translationï¼‰ä»»åŠ¡ encoder-decoder architecture å’Œ è¯­è¨€å»ºæ¨¡ï¼ˆ language modelingï¼‰decoder architectureï¼Œè®ºæ–‡ä¸­æœºå™¨ç¿»è¯‘ä»»åŠ¡æœªå¯¹En-Zh(è‹±æ–‡è¯‘ä¸­æ–‡)è¿›è¡Œå®éªŒï¼Œå¯ä»¥ä½œä¸ºä¸€ä¸ªå¤ç°ç»ƒä¹ ï¼Œæ ¹æ®æºç å®æ“ä¸€ä¸‹è®ºæ–‡ä¸­çš„å®éªŒï¼›è€Œè¯­è¨€å»ºæ¨¡å¯ä»¥ä½œä¸ºopenELMçš„æ¥æºå»¶ä¼¸~ ç»“åˆcornetè¿›è¡Œå¤ç°(ä¹Ÿæœ‰mxlç¤ºä¾‹ï¼Œmxlé’ˆå¯¹Apple Silicon ç¡¬ä»¶è¿›è¡Œçš„ä¼˜åŒ–æ·±åº¦å­¦ä¹ æ¡†æ¶)ã€‚&lt;/p&gt;
&lt;p&gt;è®ºæ–‡ä¸»ä½œè€…ï¼š&lt;a href=&#34;https://sacmehta.github.io/&#34;&gt;Sachin Mehta &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è®ºæ–‡åœ°å€ï¼šhttps://arxiv.org/pdf/2008.00623&lt;/p&gt;
&lt;p&gt;è®ºæ–‡ä»£ç ï¼š &lt;a href=&#34;https://github.com/sacmehta/delight&#34;&gt;https://github.com/sacmehta/delight&lt;/a&gt; ï¼ˆåŸºäºå½“æ—¶facebookçš„ &lt;a href=&#34;https://github.com/facebookresearch/fairseq&#34;&gt;fairseq&lt;/a&gt; seq2seqå·¥å…·åº“å¼€å‘ï¼‰&lt;/p&gt;
&lt;p&gt;è¯¥è®ºæ–‡ç ”ç©¶æ˜¯åœ¨ä½œè€…ä»¥å‰çš„DeFINE: DEep Factorized INput Token Embeddings for Neural Sequence Modeling è¿›è¡Œæ”¹è¿›ï¼Œæ¨¡å‹ç»“æ„å¼•å…¥æ›´å¤šçš„GLTsï¼Œæ¥å­¦ä¹ æ›´å®½çš„æƒé‡ï¼Œå¹¶ä¸”å‡å°‘äº†å‚æ•°æ•°é‡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ‘˜è¦&#34;&gt;&lt;strong&gt;æ‘˜è¦&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ä»‹ç»äº†ä¸€ç§æ·±åº¦ä¸”è½»é‡çº§çš„Transformerï¼Œåä¸ºDeLighTï¼Œå®ƒåœ¨å‚æ•°æ•°é‡æ˜¾è‘—å‡å°‘çš„æƒ…å†µä¸‹ï¼Œæä¾›äº†ä¸æ ‡å‡†åŸºäºTransformerçš„æ¨¡å‹ç›¸ä¼¼æˆ–æ›´å¥½çš„æ€§èƒ½ã€‚DeLighTæ›´æœ‰æ•ˆåœ°åœ¨æ¯ä¸ªTransformerå—å†…éƒ¨ï¼ˆé€šè¿‡DeLighTå˜æ¢ï¼‰ä»¥åŠè·¨å—ï¼ˆé€šè¿‡å—çº§ç¼©æ”¾ï¼‰åˆ†é…å‚æ•°ï¼Œå…è®¸è¾“å…¥ç«¯ä½¿ç”¨è¾ƒæµ…è¾ƒçª„çš„DeLighTå—ï¼Œè¾“å‡ºç«¯ä½¿ç”¨è¾ƒå®½è¾ƒæ·±çš„DeLighTå—ã€‚æ€»ä½“è€Œè¨€ï¼ŒDeLighTç½‘ç»œæ¯”æ ‡å‡†Transformeræ¨¡å‹æ·±2.5åˆ°4å€ï¼Œä½†å‚æ•°å’Œè¿ç®—é‡æ›´å°‘ã€‚åœ¨åŸºå‡†æœºå™¨ç¿»è¯‘å’Œè¯­è¨€å»ºæ¨¡ä»»åŠ¡ä¸Šçš„å®éªŒè¡¨æ˜ï¼ŒDeLighTåœ¨å¹³å‡å‚æ•°æ•°é‡å‡å°‘2åˆ°3å€çš„æƒ…å†µä¸‹ï¼Œè¾¾åˆ°æˆ–æé«˜äº†åŸºçº¿Transformerçš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;1-å¼•è¨€&#34;&gt;1 &lt;strong&gt;å¼•è¨€&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;åŸºäºæ³¨æ„åŠ›çš„Transformerç½‘ç»œï¼ˆVaswani et al., 2017ï¼‰å¹¿æ³›ç”¨äºåºåˆ—å»ºæ¨¡ä»»åŠ¡ï¼ŒåŒ…æ‹¬è¯­è¨€å»ºæ¨¡å’Œæœºå™¨ç¿»è¯‘ã€‚ä¸ºäº†æé«˜æ€§èƒ½ï¼Œæ¨¡å‹é€šå¸¸é€šè¿‡å¢åŠ éšè—å±‚çš„ç»´åº¦ï¼ˆå˜å¾—æ›´å®½ï¼‰æˆ–å †å æ›´å¤šçš„Transformerå—ï¼ˆå˜å¾—æ›´æ·±ï¼‰æ¥è¿›è¡Œæ‰©å±•ã€‚ä¾‹å¦‚ï¼ŒT5ï¼ˆRaffel et al., 2019ï¼‰ä½¿ç”¨äº†65Kçš„ç»´åº¦ï¼Œè€ŒGPT-3ï¼ˆBrown et al., 2020ï¼‰ä½¿ç”¨äº†96ä¸ªTransformerå—ã€‚ç„¶è€Œï¼Œè¿™ç§æ‰©å±•æ˜¾è‘—å¢åŠ äº†ç½‘ç»œå‚æ•°çš„æ•°é‡ï¼ˆä¾‹å¦‚ï¼ŒT5å’ŒGPT-3åˆ†åˆ«æ‹¥æœ‰110äº¿å’Œ1750äº¿å‚æ•°ï¼‰ï¼Œå¹¶ä½¿å­¦ä¹ è¿‡ç¨‹å¤æ‚åŒ–ï¼Œå³è¿™äº›æ¨¡å‹è¦ä¹ˆéœ€è¦éå¸¸å¤§çš„è®­ç»ƒè¯­æ–™åº“ï¼ˆRaffel et al., 2019; Devlin et al., 2019; Brown et al., 2020ï¼‰ï¼Œè¦ä¹ˆéœ€è¦ä»”ç»†çš„æ­£åˆ™åŒ–ï¼ˆHinton et al., 2012; Wan et al., 2013; Merity et al., 2018aï¼‰ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä¸€ç§æ–°çš„å‚æ•°é«˜æ•ˆæ³¨æ„åŠ›åŸºç¡€æ¶æ„ï¼Œå¯ä»¥è½»æ¾åœ°æ‰©å±•ä¸ºå®½å’Œæ·±ã€‚
æˆ‘ä»¬çš„æ·±åº¦è½»é‡çº§Transformeræ¶æ„ï¼ŒDeLighTï¼Œæ‰©å±•äº†Vaswani et al.ï¼ˆ2017ï¼‰çš„Transformeræ¶æ„ï¼Œå¹¶åœ¨å‚æ•°å’Œè¿ç®—é‡æ˜¾è‘—å‡å°‘çš„æƒ…å†µä¸‹æä¾›äº†ç›¸ä¼¼æˆ–æ›´å¥½çš„æ€§èƒ½ã€‚DeLighTçš„æ ¸å¿ƒæ˜¯DeLighTå˜æ¢ï¼Œå®ƒä½¿ç”¨Mehta et al.ï¼ˆ2018ï¼‰çš„ç»„çº¿æ€§å˜æ¢ï¼ˆGLTsï¼‰å’Œæ‰©å±•-ç¼©å‡ç­–ç•¥ï¼Œæœ‰æ•ˆåœ°å˜åŒ–DeLighTå—çš„å®½åº¦å’Œæ·±åº¦ã€‚ç”±äºGLTsæœ¬è´¨ä¸Šæ˜¯å±€éƒ¨çš„ï¼ŒDeLighTå˜æ¢ä½¿ç”¨ç‰¹å¾æ´—ç‰Œï¼Œç±»ä¼¼äºå·ç§¯ç½‘ç»œï¼ˆZhang et al., 2018ï¼‰ä¸­çš„é€šé“æ´—ç‰Œï¼Œä»¥åœ¨ä¸åŒç»„ä¹‹é—´å…±äº«ä¿¡æ¯ã€‚è¿™ç§å®½å’Œæ·±çš„è¡¨ç¤ºä¿ƒè¿›äº†ç”¨å•å¤´æ³¨æ„åŠ›å’Œè½»é‡çº§å‰é¦ˆå±‚æ›¿ä»£Transformerä¸­çš„å¤šå¤´æ³¨æ„åŠ›å’Œå‰é¦ˆå±‚ï¼Œä»è€Œå‡å°‘äº†æ€»ç½‘ç»œå‚æ•°å’Œè¿ç®—é‡ã€‚é‡è¦çš„æ˜¯ï¼Œä¸Transformerä¸åŒï¼ŒDeLighTå˜æ¢å°†æ·±åº¦å’Œå®½åº¦ä¸è¾“å…¥å¤§å°è§£è€¦ï¼Œå…è®¸æˆ‘ä»¬é€šè¿‡åœ¨è¾“å…¥ç«¯ä½¿ç”¨è¾ƒæµ…è¾ƒçª„çš„DeLighTå—ï¼Œåœ¨è¾“å‡ºç«¯ä½¿ç”¨è¾ƒæ·±è¾ƒå®½çš„DeLighTå—ï¼Œæ›´æœ‰æ•ˆåœ°è·¨å—åˆ†é…å‚æ•°ã€‚
æˆ‘ä»¬è¯æ˜äº†DeLighTæ¨¡å‹åœ¨ä¸¤ä¸ªå¸¸è§çš„åºåˆ—å»ºæ¨¡ä»»åŠ¡ä¸Šï¼Œå³ï¼ˆiï¼‰æœºå™¨ç¿»è¯‘å’Œï¼ˆiiï¼‰è¯­è¨€å»ºæ¨¡ï¼Œå®ç°äº†ä¸Transformeræ¨¡å‹ç›¸ä¼¼æˆ–æ›´å¥½çš„æ€§èƒ½ï¼ŒåŒæ—¶æ˜¾è‘—å‡å°‘äº†å‚æ•°å’Œè¿ç®—é‡ã€‚åœ¨èµ„æºè¾ƒå°‘çš„WMTâ€™16 En-Roæœºå™¨ç¿»è¯‘æ•°æ®é›†ä¸Šï¼ŒDeLighTä½¿ç”¨2.8å€æ›´å°‘çš„å‚æ•°è¾¾åˆ°äº†Transformerçš„æ€§èƒ½ã€‚åœ¨èµ„æºå……è¶³çš„WMTâ€™14 En-Fræ•°æ®é›†ä¸Šï¼ŒDeLighTä»¥1.8å€æ›´å°‘çš„å‚æ•°æä¾›äº†æ¯”åŸºçº¿Transformeræ›´å¥½çš„æ€§èƒ½ï¼ˆ+0.4 BLEUåˆ†æ•°ï¼‰ã€‚åŒæ ·ï¼Œåœ¨è¯­è¨€å»ºæ¨¡æ–¹é¢ï¼ŒDeLighTåœ¨WikiText-103æ•°æ®é›†ä¸Šä¸Transformer-XLï¼ˆDai et al., 2019ï¼‰çš„æ€§èƒ½ç›¸å½“ï¼Œä½†å‚æ•°æ•°é‡å‡å°‘äº†1.5å€ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2-ç›¸å…³å·¥ä½œ&#34;&gt;&lt;strong&gt;2 ç›¸å…³å·¥ä½œ&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;æ”¹è¿›Transformer(Improving transformers)&lt;/strong&gt;ï¼šå·²ç»å¼•å…¥äº†å‡ ç§æ–¹æ³•æ¥æ”¹è¿›Transformeræ¶æ„ã€‚ç¬¬ä¸€æ¡ç ”ç©¶çº¿ç´¢è§£å†³äº†åœ¨é•¿è¾“å…¥åºåˆ—ä¸Šè®¡ç®—è‡ªæ³¨æ„åŠ›çš„æŒ‘æˆ˜ï¼ˆChild et al., 2019; Kitaev et al., 2020; Beltagy et al., 2020ï¼‰ã€‚è¿™äº›æ–¹æ³•å¯ä»¥ä¸æˆ‘ä»¬çš„æ¶æ„ç»“åˆä½¿ç”¨ã€‚ç¬¬äºŒæ¡ç ”ç©¶çº¿ç´¢é›†ä¸­åœ¨è§£é‡Šå¤šå¤´æ³¨æ„åŠ›ï¼ˆRaganato and Tiedemann, 2018; Brunner et al., 2020ï¼‰ã€‚ä»–ä»¬è¡¨æ˜ï¼Œå¢åŠ Transformerå¤´çš„æ•°é‡å¯èƒ½ä¼šå¯¼è‡´å†—ä½™è¡¨ç¤ºï¼ˆVoita et al., 2019a; Michel et al., 2019ï¼‰ï¼Œå¹¶ä¸”ä½¿ç”¨å…·æœ‰é¢„å®šä¹‰æ¨¡å¼çš„å›ºå®šæ³¨æ„åŠ›å¤´ï¼ˆRaganato et al., 2020ï¼‰æˆ–åˆæˆæ³¨æ„åŠ›çŸ©é˜µï¼ˆTay et al., 2020ï¼‰å¯ä»¥æé«˜æ€§èƒ½ã€‚ç¬¬ä¸‰æ¡ç ”ç©¶çº¿ç´¢é›†ä¸­åœ¨é€šè¿‡å­¦ä¹ æ›´å¥½çš„è¡¨ç¤ºæ¥æ”¹è¿›Transformerï¼ˆWu et al., 2019; 2020; So et al., 2019ï¼‰ã€‚è¿™äº›å·¥ä½œæ—¨åœ¨é€šè¿‡ä½¿ç”¨ä¸åŒçš„å˜æ¢æ¥æé«˜Transformerçš„è¡¨è¾¾èƒ½åŠ›â€”â€”ä¾‹å¦‚ï¼Œä½¿ç”¨å·ç§¯ï¼ˆWu et al., 2019; Gehring et al., 2017ï¼‰ã€é—¨æ§çº¿æ€§å•å…ƒï¼ˆDauphin et al., 2017ï¼‰æˆ–å¤šåˆ†æ”¯ç‰¹å¾æå–å™¨ï¼ˆSo et al., 2019; Wu et al., 2020ï¼‰ã€‚æˆ‘ä»¬çš„å·¥ä½œå±äºè¿™ä¸€ç±»ã€‚ä¸ä¹‹å‰çš„å·¥ä½œä¸åŒï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•æœ‰æ•ˆåœ°åœ¨å—çº§åˆ«ä½¿ç”¨DeLighTå˜æ¢ä»¥åŠè·¨å—ä½¿ç”¨å—çº§ç¼©æ”¾æ¥åˆ†é…å‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¨¡å‹ç¼©æ”¾(Model scaling)&lt;/strong&gt;ï¼šæ¨¡å‹ç¼©æ”¾æ˜¯æé«˜åºåˆ—æ¨¡å‹æ€§èƒ½çš„æ ‡å‡†æ–¹æ³•ï¼ˆVaswani et al., 2017; Raffel et al., 2019; Lan et al., 2020; Devlin et al., 2019; Shoeybi et al., 2019; Tan and Le, 2019; Brown et al., 2020ï¼‰ã€‚åœ¨å®½åº¦ç¼©æ”¾ä¸­å¢åŠ æ¨¡å‹ç»´åº¦ï¼ˆVaswani et al., 2017; Devlin et al., 2019ï¼‰ï¼Œè€Œåœ¨æ·±åº¦ç¼©æ”¾ä¸­å †å æ›´å¤šçš„å—ï¼ˆä¾‹å¦‚ï¼ŒTransformerå—ï¼‰ï¼ˆShoeybi et al., 2019; Brown et al., 2020; Wang et al., 2019ï¼‰ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µï¼ˆåŠå…¶ç»„åˆï¼‰ä¸­ï¼Œç½‘ç»œä¸­æ¯ä¸ªå—å†…çš„å‚æ•°æ˜¯ç›¸åŒçš„ï¼Œè¿™å¯èƒ½å¯¼è‡´æ¬¡ä¼˜è§£å†³æ–¹æ¡ˆã€‚ä¸ºäº†è¿›ä¸€æ­¥æé«˜åºåˆ—æ¨¡å‹çš„æ€§èƒ½ï¼Œæœ¬æ–‡å¼•å…¥äº†å—çº§ç¼©æ”¾ï¼Œå…è®¸ä¸åŒå¤§å°çš„å—å¹¶æœ‰æ•ˆåœ°åœ¨ç½‘ç»œä¸­åˆ†é…å‚æ•°ã€‚æˆ‘ä»¬çš„ç»“æœè¡¨æ˜ï¼Œï¼ˆ1ï¼‰è¾“å…¥ç«¯çš„DeLighTå—è¾ƒæµ…è¾ƒçª„ï¼Œè¾“å‡ºç«¯çš„DeLighTå—è¾ƒæ·±è¾ƒå®½ï¼Œèƒ½æä¾›æœ€ä½³æ€§èƒ½ï¼Œä»¥åŠï¼ˆ2ï¼‰ä¸å•ç‹¬çš„æ¨¡å‹ç¼©æ”¾ç›¸æ¯”ï¼Œç»“åˆå—çº§ç¼©æ”¾çš„æ¨¡å‹ç¼©æ”¾å®ç°äº†æ›´å¥½çš„æ€§èƒ½ã€‚æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œå·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNsï¼‰ä¹Ÿåœ¨è¾“å…¥ç«¯å­¦ä¹ è¾ƒæµ…è¾ƒçª„çš„è¡¨ç¤ºï¼Œåœ¨è¾“å‡ºç«¯å­¦ä¹ è¾ƒæ·±è¾ƒå®½çš„è¡¨ç¤ºã€‚ä¸CNNsï¼ˆä¾‹å¦‚ï¼ŒHe et al. 2016çš„ResNetï¼‰åœ¨æ¯ä¸ªå·ç§¯å±‚æ‰§è¡Œå›ºå®šæ•°é‡çš„æ“ä½œä¸åŒï¼Œæ‰€æå‡ºçš„å—çº§ç¼©æ”¾åœ¨æ¯å±‚å’Œå—ä¸­ä½¿ç”¨å¯å˜æ•°é‡çš„æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ”¹è¿›åºåˆ—æ¨¡å‹(Improving sequence models)&lt;/strong&gt;ï¼šæœ€è¿‘è¿˜æœ‰å¤§é‡å…³äºæ”¹è¿›åºåˆ—æ¨¡å‹çš„ç›¸å…³æ–¹æ³•çš„å·¥ä½œï¼ŒåŒ…æ‹¬ï¼ˆ1ï¼‰ä½¿ç”¨æ›´å¥½çš„Tokençº§è¡¨ç¤ºæé«˜å‡†ç¡®æ€§â€”â€”ä¾‹å¦‚ï¼Œä½¿ç”¨BPEï¼ˆSennrich et al., 2016ï¼‰ã€è‡ªé€‚åº”è¾“å…¥ï¼ˆBaevski and Auli, 2019ï¼‰å’Œè¾“å‡ºï¼ˆGrave et al., 2017aï¼‰ï¼Œä»¥åŠDeFINEï¼ˆMehta et al., 2020ï¼‰ï¼Œä»¥åŠï¼ˆ2ï¼‰æé«˜æ•ˆç‡â€”â€”ä¾‹å¦‚ï¼Œä½¿ç”¨å‹ç¼©ï¼ˆChen et al., 2018; Sun et al., 2020ï¼‰ã€å‰ªæï¼ˆHan et al., 2016; Voita et al., 2019bï¼‰å’Œè’¸é¦ï¼ˆHinton et al., 2015; Sanh et al., 2019ï¼‰ã€‚ä¸æˆ‘ä»¬çš„å·¥ä½œæœ€æ¥è¿‘çš„æ˜¯DeFINEå˜æ¢ï¼Œå®ƒä¹Ÿä½¿ç”¨æ‰©å±•-ç¼©å‡ç­–ç•¥å­¦ä¹ è¡¨ç¤ºã€‚DeFINEå˜æ¢ï¼ˆå›¾1cï¼‰å’ŒDeLighTå˜æ¢ï¼ˆå›¾1dï¼‰ä¹‹é—´çš„å…³é”®åŒºåˆ«åœ¨äºï¼ŒDeLighTå˜æ¢åœ¨æ‰©å±•å’Œç¼©å‡å±‚ä¸­æ›´æœ‰æ•ˆåœ°åˆ†é…å‚æ•°ã€‚ä¸DeFINEä¸åŒï¼Œåè€…åœ¨ç»„çº¿æ€§å˜æ¢ä¸­ä½¿ç”¨è¾ƒå°‘çš„ç»„æ¥å­¦ä¹ æ›´å®½çš„è¡¨ç¤ºï¼ŒDeLighTå˜æ¢ä½¿ç”¨æ›´å¤šçš„ç»„ä»¥æ›´å°‘çš„å‚æ•°å­¦ä¹ æ›´å®½çš„è¡¨ç¤ºã€‚DeLighTå˜æ¢å®ç°äº†ä¸DeFINEå˜æ¢ç›¸å½“çš„æ€§èƒ½ï¼Œä½†å‚æ•°æ•°é‡æ˜¾è‘—å‡å°‘ã€‚&lt;/p&gt;
&lt;h2 id=&#34;3-delight-æ·±åº¦è½»é‡çº§transformer&#34;&gt;3 DeLighT: æ·±åº¦è½»é‡çº§Transformer&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/paper/transformer/DeLighT/1.png&#34; alt=&#34;image-20240428123509253&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾1. (a, b)æ ‡å‡†Transformerå—ä¸DeLighTå—ä¹‹é—´çš„å—çº§åˆ«æ¯”è¾ƒã€‚åœ¨DeLighTä¸­ï¼Œè®¡ç®—æ³¨æ„åŠ›çš„æ“ä½œæ•°é‡å‡å°‘äº†ä¸€åŠï¼Œè€ŒFFNä¸­çš„å‚æ•°æ•°é‡ï¼ˆå’Œæ“ä½œï¼‰å‡å°‘äº†$16\times$ã€‚å…·æœ‰å¯å­¦ä¹ å‚æ•°çš„å˜æ¢ï¼ˆLinear(å¤©ç©ºè“) å’Œ DeLighT(åœ°ä¸Šè‰ç»¿è‰²)ï¼‰æ˜¾ç¤ºä¸ºå½©è‰²ã€‚çº¿æ€§å˜æ¢çš„å½¢çŠ¶æŒ‡ç¤ºå…¶æ“ä½œï¼ˆæ‰©å±•ã€å‡å°‘ç­‰ï¼‰ã€‚(c, d) å°†DeFINEå˜æ¢ä¸DeLighTè¿›è¡Œäº†æ¯”è¾ƒã€‚ä¸DeFINEå˜æ¢ç›¸æ¯”ï¼ŒDeLighTä½¿ç”¨äº†æ›´å¤šç»„çš„ç»„çº¿æ€§å˜æ¢ï¼ˆgroup linear transformations GLTsï¼‰æ¥å­¦ä¹ æ›´å®½çš„æƒé‡ï¼Œå¹¶å‡å°‘äº†å‚æ•°æ•°é‡ã€‚ä¸åŒé¢œè‰²ç”¨äºæ˜¾ç¤ºGLTsä¸­çš„ç»„ã€‚ä¸ºç®€å•èµ·è§ï¼Œï¼ˆdï¼‰ä¸­æœªæ˜¾ç¤ºç‰¹å¾æ´—ç‰Œã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ ‡å‡†çš„Transformerå—ï¼ˆå›¾1aï¼‰ç”±å¤šå¤´æ³¨æ„åŠ›ç»„æˆï¼Œä½¿ç”¨æŸ¥è¯¢-é”®-å€¼åˆ†è§£æ¥å»ºæ¨¡åºåˆ—æ ‡è®°ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶ä¸”ç”±ä¸€ä¸ªå‰é¦ˆç½‘ç»œï¼ˆFFNï¼‰æ¥å­¦ä¹ æ›´å®½çš„è¡¨ç¤ºã€‚å¤šå¤´æ³¨æ„åŠ›é€šè¿‡å¯¹è¾“å…¥åº”ç”¨ä¸‰ä¸ªæŠ•å½±æ¥è·å–æŸ¥è¯¢$\mathbf{Q}$ã€é”®$\mathbf{K}$å’Œå€¼$\mathbf{V}$ï¼Œæ¯ä¸ªæŠ•å½±ç”±$h$ä¸ªçº¿æ€§å±‚ï¼ˆæˆ–å¤´ï¼‰ç»„æˆï¼Œå°†$d_m$ç»´è¾“å…¥æ˜ å°„åˆ°$d_h$ç»´ç©ºé—´ï¼Œå…¶ä¸­$d_h=d_m/h$æ˜¯å¤´çš„ç»´åº¦ã€‚FFNç”±ä¸¤ä¸ªçº¿æ€§å±‚ç»„æˆï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå°†ç»´åº¦ä»$d_m$æ‰©å±•åˆ°$d_f$ï¼Œç¬¬äºŒä¸ªå°†ç»´åº¦ä»$d_f$å‡å°‘åˆ°$d_m$ã€‚Transformerå—çš„æ·±åº¦ä¸º4ï¼ŒåŒ…æ‹¬ï¼ˆ1ï¼‰ç”¨äºqueryã€keyå’Œvalueçš„ä¸‰ä¸ªå¹¶è¡Œåˆ†æ”¯ï¼Œï¼ˆ2ï¼‰å°†å¤šä¸ªå¤´çš„è¾“å‡ºç»„åˆçš„èåˆå±‚ï¼Œä»¥åŠï¼ˆ3ï¼‰FFNä¸­çš„ä¸¤ä¸ªé¡ºåºçº¿æ€§å±‚ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒåŸºäºTransformerçš„ç½‘ç»œé€šè¿‡é¡ºåºå †å Transformerå—æ¥å¢åŠ ç½‘ç»œçš„å®¹é‡å’Œæ·±åº¦ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ‰©å±•äº†Transformeræ¶æ„ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ·±åº¦è½»é‡çº§çš„Transformerï¼ŒDeLighTã€‚æˆ‘ä»¬çš„æ¨¡å‹ä½¿ç”¨æ·±åº¦è½»é‡çº§çš„æ‰©å±•-å‡å°‘å˜æ¢ï¼ŒDeLighTï¼ˆç¬¬3.1èŠ‚ï¼‰ï¼Œæœ‰æ•ˆåœ°å®ç°äº†å­¦ä¹ æ›´å®½çš„è¡¨ç¤º(representations)ã€‚å®ƒè¿˜å…è®¸ç”¨å•å¤´æ³¨æ„åŠ›å’Œè½»é‡çº§FFNï¼ˆç¬¬3.2èŠ‚ï¼‰æ›¿æ¢å¤šå¤´æ³¨æ„åŠ›å’Œå‰é¦ˆç½‘ç»œï¼ˆFFNï¼‰å±‚ã€‚DeLighTå°†æ³¨æ„åŠ›ç»´åº¦ä¸æ·±åº¦å’Œå®½åº¦è§£è€¦ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨å—çº§åˆ«ç¼©æ”¾è€Œä¸æ˜¯å‡åŒ€å †å Transformerå—æ¥æœ‰æ•ˆåœ°å­¦ä¹ è¡¨ç¤ºï¼ˆç¬¬3.3èŠ‚ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;31-delight&#34;&gt;3.1 DeLighT&lt;/h3&gt;
&lt;p&gt;DeLighTå°†ä¸€ä¸ª$d_m$ç»´è¾“å…¥å‘é‡æ˜ å°„åˆ°ä¸€ä¸ªé«˜ç»´ç©ºé—´ï¼ˆæ‰©å±•ï¼‰ï¼Œç„¶åä½¿ç”¨Mehtaç­‰äººï¼ˆ2018ï¼‰çš„$N$ å±‚ç»„å˜æ¢å°†å…¶å‡å°‘åˆ°ä¸€ä¸ª$d_o$ç»´è¾“å‡ºå‘é‡ï¼ˆç¼©å‡ï¼‰ï¼Œå¦‚å›¾1 dæ‰€ç¤ºã€‚åœ¨è¿™äº›æ‰©å±•å’Œç¼©å‡é˜¶æ®µï¼ŒDeLighTå˜æ¢ä½¿ç”¨ç»„çº¿æ€§å˜æ¢ï¼ˆGLTsï¼‰ï¼Œå› ä¸ºå®ƒä»¬é€šè¿‡ä»è¾“å…¥çš„ç‰¹å®šéƒ¨åˆ†æ´¾ç”Ÿè¾“å‡ºæ¥å­¦ä¹ å±€éƒ¨è¡¨ç¤ºï¼Œå¹¶ä¸”æ¯”çº¿æ€§å˜æ¢æ›´é«˜æ•ˆã€‚ä¸ºäº†å­¦ä¹ å…¨å±€è¡¨ç¤ºï¼ŒDeLighTå˜æ¢ä½¿ç”¨ç‰¹å¾æ´—ç‰Œï¼Œåœ¨ç»„çº¿æ€§å˜æ¢ä¸­ä¸åŒç»„ä¹‹é—´å…±äº«ä¿¡æ¯ï¼Œç±»ä¼¼äºå·ç§¯ç½‘ç»œä¸­çš„é€šé“æ´—ç‰Œï¼ˆZhangç­‰äººï¼Œ2018ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å¢åŠ Transformerçš„è¡¨è¾¾èƒ½åŠ›å’Œå®¹é‡çš„æ ‡å‡†æ–¹æ³•æ˜¯å¢åŠ è¾“å…¥ç»´åº¦$d_m$ã€‚ç„¶è€Œï¼Œçº¿æ€§å¢åŠ $d_m$ä¹Ÿä¼šçº¿æ€§å¢åŠ æ ‡å‡†Transformerå—ä¸­å¤šå¤´æ³¨æ„åŠ›çš„æ“ä½œæ•°é‡ï¼ˆ$\mathcal{O}(n^2 d_m)$ï¼Œå…¶ä¸­$n$æ˜¯åºåˆ—é•¿åº¦ï¼‰ï¼ˆå›¾1 aï¼‰ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œä¸ºäº†å¢åŠ DeLighTå—çš„è¡¨è¾¾èƒ½åŠ›å’Œå®¹é‡ï¼Œæˆ‘ä»¬é€šè¿‡æ‰©å±•å’Œå‡å°‘é˜¶æ®µå¢åŠ å…¶ä¸­é—´DeLighTå˜æ¢çš„æ·±åº¦å’Œå®½åº¦ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¾ƒå°çš„ç»´åº¦è®¡ç®—æ³¨æ„åŠ›ï¼Œä»è€Œå‡å°‘æ“ä½œæ•°é‡ã€‚&lt;/p&gt;
&lt;p&gt;å½¢å¼ä¸Šï¼ŒDeLighTç”±äº”ä¸ªé…ç½®å‚æ•°æ§åˆ¶ï¼šï¼ˆ1ï¼‰GLTå±‚æ•°$N$ï¼Œï¼ˆ2ï¼‰å®½åº¦å€å¢å™¨$w_m$ï¼Œï¼ˆ3ï¼‰è¾“å…¥ç»´åº¦$d_m$ï¼Œï¼ˆ4ï¼‰è¾“å‡ºç»´åº¦$d_o$ï¼Œä»¥åŠï¼ˆ5ï¼‰GLTä¸­çš„æœ€å¤§ç»„æ•°$g_{max}$ã€‚åœ¨æ‰©å±•é˜¶æ®µï¼ŒDeLighTä½¿ç”¨$\lceil \frac{N}{2} \rceil$å±‚å°†$d_m$ç»´è¾“å…¥çº¿æ€§æŠ•å½±åˆ°é«˜ç»´ç©ºé—´$d_{max}=w_m d_m$ã€‚åœ¨å‡å°‘é˜¶æ®µï¼ŒDeLighTä½¿ç”¨å‰©ä½™çš„$N - \lceil \frac{N}{2} \rceil$ GLTå±‚å°†$d_{max}$ç»´å‘é‡çº¿æ€§æŠ•å½±åˆ°$d_o$ç»´ç©ºé—´ã€‚æ•°å­¦ä¸Šï¼Œæˆ‘ä»¬å®šä¹‰æ¯ä¸ªGLTå±‚$l$çš„è¾“å‡º$\mathbf{Y}$ä¸ºï¼š&lt;/p&gt;
&lt;p&gt;$$
\mathbf{Y}^l = \left\{
\begin{array}{ll}
\mathcal{F} \left(\mathbf{X}, \mathbf{W}^l, \mathbf{b}^l, g^l\right), &amp;amp; l = 1 \\
\mathcal{F} \left( \mathcal{H}\left(\mathbf{X}, \mathbf{Y}^{l-1}\right), \mathbf{W}^l,  \mathbf{b}^l, g^l\right), &amp;amp;  \text{Otherwise}
\end{array}
\right.
\label{eq:glt}
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ $\mathbf{W}^l = \lbrace \mathbf{W}^l_1, \cdots, \mathbf{W}^l_{g^l}\rbrace$  å’Œ $\mathbf{b}^l = \lbrace \mathbf{b}^l_1, \cdots, \mathbf{b}^l_{g^l}\rbrace$ æ˜¯ç¬¬$l$å±‚GLTçš„å¯å­¦ä¹ æƒé‡å’Œåç½®ï¼Œå…¶ä¸­$g^l$æ˜¯ç¬¬$l$å±‚GLTçš„ç»„æ•°ã€‚ç®€è¨€ä¹‹ï¼Œ$\mathcal{F}$å‡½æ•°æ¥å—è¾“å…¥$\mathbf{X}$ï¼ˆæˆ–$\mathcal{H}\left(\mathbf{X}, \mathbf{Y}^{l-1}\right)$ï¼‰å¹¶å°†å…¶åˆ†æˆ$g^l$ä¸ªä¸é‡å çš„ç»„ï¼Œä½¿å¾—$\mathbf{X} = \lbrace\mathbf{X}_1,\cdots,\mathbf{X}_{g^l}\rbrace$ ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åï¼Œ$\mathcal{F}$ å‡½æ•°çº¿æ€§åœ°å˜æ¢æ¯ä¸ª$\mathbf{X}_i$ï¼Œå¾—åˆ°è¾“å‡º$\mathbf{Y}^l_i = \mathbf{X}_i \mathbf{W}_i^l + \mathbf{b}_i^l$ã€‚æ¯ä¸ªç»„çš„è¾“å‡º$\mathbf{Y}^l_i$ç„¶åè¢«ä¸²è”èµ·æ¥ï¼Œäº§ç”Ÿè¾“å‡º$\mathbf{Y}^l$ã€‚å‡½æ•°$\mathcal{H}$é¦–å…ˆå¯¹$\mathbf{Y}^{l-1}$ä¸­æ¯ä¸ªç»„çš„è¾“å‡ºè¿›è¡Œæ´—ç‰Œï¼Œç„¶åä½¿ç”¨Mehtaç­‰äººï¼ˆ2020ï¼‰çš„è¾“å…¥æ··åˆå™¨è¿æ¥å°†å…¶ä¸è¾“å…¥$\mathbf{X}$ç»„åˆèµ·æ¥ï¼Œä»¥é¿å…æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚å›¾2 å¯è§†åŒ–äº†DeLighTå˜æ¢ä¸­çš„æ‰©å±•é˜¶æ®µï¼Œå…¶ä¸­åŒ…æ‹¬ç»„çº¿æ€§å˜æ¢ã€ç‰¹å¾æ´—ç‰Œå’Œè¾“å…¥æ··åˆå™¨è¿æ¥ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨DeLighTä¸­ï¼Œç¬¬$l$ä¸ªGLTçš„ç»„æ•°è®¡ç®—ä¸ºï¼š
$$
\begin{equation}
g^l = \left\{
\begin{array}{lr}
\text{min}(2^{l-1}, g_{max}), &amp;amp; 1 \leq l \leq \lceil{N/2}\rceil \\
g^{N-l}, &amp;amp; \text{Otherwise}
\end{array}
\right.
\end{equation}
$$
åœ¨æˆ‘ä»¬çš„å®éªŒä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨$g_{max} = \lceil \frac{d_m}{32} \rceil$ï¼Œä»¥ä¾¿æ¯ä¸ªç»„è‡³å°‘æœ‰32ä¸ªè¾“å…¥å…ƒç´ ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/paper/transformer/DeLighT/2.png&#34; alt=&#34;image-20240428132940873&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾2.ç¤ºä¾‹è¯´æ˜äº†DeLighTå˜æ¢ä¸­çš„æ‰©å±•é˜¶æ®µï¼Œè¯¥é˜¶æ®µä½¿ç”¨GLTsã€ç‰¹å¾æ´—ç‰Œå’Œè¾“å…¥æ··åˆå™¨è¿æ¥ï¼Œä»¥æœ‰æ•ˆåœ°å­¦ä¹ æ›´æ·±å’Œæ›´å®½çš„è¡¨ç¤º(representations)ã€‚ä¸ºäº†è¯´æ˜ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ç›¸åŒçš„è¾“å…¥å’Œè¾“å‡ºç»´åº¦ã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;32-delight-blocklayer&#34;&gt;3.2 DeLighT Block/Layer&lt;/h3&gt;
&lt;p&gt;å›¾1 bå±•ç¤ºäº†æˆ‘ä»¬å¦‚ä½•å°†DeLighTé›†æˆåˆ°Transformerå—ä¸­ä»¥æé«˜å…¶æ•ˆç‡ã€‚é¦–å…ˆå°†$d_m$ç»´è¾“å…¥é¦ˆé€åˆ°DeLighTä¸­ï¼Œäº§ç”Ÿ$d_o$ç»´è¾“å‡ºï¼Œå…¶ä¸­$d_o &amp;lt; d_m$ã€‚ç„¶åå°†è¿™äº›$d_o$ç»´è¾“å‡ºé¦ˆé€åˆ°å•å¤´æ³¨æ„åŠ›ä¸­ï¼Œæ¥ç€æ˜¯ä¸€ä¸ªè½»é‡çº§FFNæ¥å»ºæ¨¡å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DeLighTå±‚å’Œå•å¤´æ³¨æ„åŠ›(DeLighT layer and single head attention)&lt;/strong&gt;ï¼š å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªé•¿åº¦ä¸º$n$çš„è¾“å…¥æ ‡è®°åºåˆ—ï¼Œæ¯ä¸ªæ ‡è®°çš„ç»´åº¦ä¸º$d_m$ã€‚é¦–å…ˆå°†è¿™$n$ä¸ª$d_m$ç»´è¾“å…¥é¦ˆé€åˆ°DeLighTä¸­ï¼Œäº§ç”Ÿ$n$ä¸ª$d_o$ç»´è¾“å‡ºï¼Œå…¶ä¸­$d_o &amp;lt; d_m$ã€‚ç„¶åä½¿ç”¨ä¸‰ä¸ªçº¿æ€§å±‚åŒæ—¶å¯¹è¿™äº›$n$ä¸ª$d_o$ç»´è¾“å‡ºè¿›è¡ŒæŠ•å½±ï¼Œå¾—åˆ°$d_o$ç»´çš„æŸ¥è¯¢$\mathbf{Q}$ã€é”®$\mathbf{K}$å’Œå€¼$\mathbf{V}$ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›ï¼ˆå…¬å¼3ï¼‰å¯¹è¿™äº›nä¸ªTokenä¹‹é—´çš„ä¸Šä¸‹æ–‡å…³ç³»è¿›è¡Œå»ºæ¨¡ã€‚ä¸ºäº†å¯ç”¨æ®‹å·®è¿æ¥ï¼ˆHeç­‰äººï¼Œ2016ï¼‰ï¼Œè¿™ä¸ªæ³¨æ„åŠ›æ“ä½œçš„$d_o$ç»´è¾“å‡ºè¢«çº¿æ€§æŠ•å½±åˆ°ä¸€ä¸ª$d_m$ç»´çš„ç©ºé—´ã€‚
$$
\begin{equation}
\text{Attention}(\mathbf{K}, \mathbf{Q}, \mathbf{V}) = \text{softmax}\left(\frac{\mathbf{Q}\mathbf{K}^T}{\sqrt{d_o}}\right) \mathbf{V}
\label{eq:espda}
\end{equation}
$$
æˆ‘ä»¬å‡è®¾DeLighTå­¦ä¹ æ›´å®½çš„è¡¨ç¤º(representations)çš„èƒ½åŠ›ä½¿æˆ‘ä»¬èƒ½å¤Ÿç”¨å•å¤´æ³¨æ„åŠ›æ›¿æ¢å¤šå¤´æ³¨æ„åŠ›ã€‚æ ‡å‡†Transformerä¸­è®¡ç®—æ³¨æ„åŠ›çš„è®¡ç®—æˆæœ¬ä¸º$\mathcal{O}(d_m n^2)$ï¼Œè€ŒDeLighTå—ä¸­ä¸º$\mathcal{O}(d_o n^2)$ï¼Œå…¶ä¸­$d_o &amp;lt; d_m$ã€‚å› æ­¤ï¼ŒDeLighTå—å°†è®¡ç®—æ³¨æ„åŠ›çš„æˆæœ¬å‡å°‘äº†ä¸€ä¸ªå› å­$d_m/d_o$ã€‚åœ¨æˆ‘ä»¬çš„å®éªŒä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨$d_o=d_m/2$ï¼Œå› æ­¤ä¸Transformeræ¶æ„ç›¸æ¯”ï¼Œéœ€è¦$2\times$æ›´å°‘çš„ä¹˜åŠ æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è½»é‡çº§(Light-weight) FFN&lt;/strong&gt; ï¼šä¸Transformerä¸­çš„FFNç±»ä¼¼ï¼Œè¿™ä¸ªå—ä¹Ÿç”±ä¸¤ä¸ªçº¿æ€§å±‚ç»„æˆã€‚ç”±äºDeLighTå—å·²ç»é€šè¿‡DeLighTé›†æˆäº†æ›´å®½çš„è¡¨ç¤ºï¼Œå®ƒå…è®¸æˆ‘ä»¬åè½¬Transformerä¸­FFNå±‚çš„åŠŸèƒ½ã€‚ç¬¬ä¸€å±‚å°†è¾“å…¥çš„ç»´åº¦ä»$d_m$å‡å°‘åˆ°$d_m/r$ï¼Œè€Œç¬¬äºŒå±‚å°†ç»´åº¦ä»$d_m/r$æ‰©å±•åˆ°$d_m$ï¼Œå…¶ä¸­$r$æ˜¯ç¼©å‡å› å­ï¼ˆè§å›¾1bï¼‰ã€‚æˆ‘ä»¬çš„è½»é‡çº§FFNé€šè¿‡å› å­$r d_f/d_m$å‡å°‘äº†FFNä¸­çš„å‚æ•°å’Œæ“ä½œæ•°é‡ã€‚åœ¨æ ‡å‡†Transformerä¸­ï¼ŒFFNçš„ç»´åº¦æ‰©å±•äº†4å€ï¼ˆTransformer-baseä½¿ç”¨$d_m$=512å’Œ$d_f$=2048ï¼Œè€ŒTransformer-largeä½¿ç”¨$d_m$=1024å’Œ$d_f$=4096ï¼‰ã€‚ åœ¨æˆ‘ä»¬çš„å®éªŒä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨$r=4$ã€‚å› æ­¤ï¼Œè½»é‡çº§FFNå°†FFNä¸­çš„å‚æ•°æ•°é‡å‡å°‘äº†$16\times$ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;block/layeræ·±åº¦&lt;/strong&gt;ï¼šDeLighTå—å †å äº†ï¼ˆ1ï¼‰&lt;strong&gt;å…·æœ‰ $N$ä¸ªGLTçš„DeLighT&lt;/strong&gt; ï¼Œï¼ˆ2ï¼‰ä¸‰ä¸ªå¹¶è¡Œçš„ç”¨äºKeyã€Queryå’ŒValueçš„çº¿æ€§å±‚ï¼Œï¼ˆ3ï¼‰ä¸€ä¸ªæŠ•å½±å±‚ï¼Œå’Œï¼ˆ4ï¼‰è½»é‡çº§FFNçš„ä¸¤ä¸ªçº¿æ€§å±‚ã€‚å› æ­¤ï¼ŒDeLighTå—çš„æ·±åº¦ä¸º$N+4$ã€‚ä¸æ ‡å‡†Transformerå—ï¼ˆæ·±åº¦ä¸º4ï¼‰ç›¸æ¯”ï¼ŒDeLighTå—æ›´æ·±ã€‚&lt;/p&gt;
&lt;h3 id=&#34;33-blocklayer-wise-scaling&#34;&gt;3.3 Block/Layer wise scaling&lt;/h3&gt;
&lt;p&gt;æé«˜åºåˆ—æ¨¡å‹æ€§èƒ½çš„æ ‡å‡†æ–¹æ³•åŒ…æ‹¬å¢åŠ æ¨¡å‹ç»´åº¦ï¼ˆå®½åº¦ç¼©æ”¾ï¼‰ã€å †å æ›´å¤šçš„å—ï¼ˆæ·±åº¦ç¼©æ”¾ï¼‰æˆ–ä¸¤è€…å…¼æœ‰ã€‚ç„¶è€Œï¼Œè¿™ç§ç¼©æ”¾åœ¨å°å‹æ•°æ®é›†ä¸Šå¹¶ä¸æ˜¯éå¸¸æœ‰æ•ˆã€‚ä¾‹å¦‚ï¼Œå½“åœ¨WMTâ€™16 En-Roè¯­æ–™åº“ä¸Šå°†Transformer-Baseï¼ˆ$d_m$ = 512ï¼‰ç½‘ç»œæ›¿æ¢ä¸ºTransformer-Largeï¼ˆ$d_m$ = 1024ï¼‰æ—¶ï¼Œå‚æ•°æ•°é‡å¢åŠ äº†å¤§çº¦4å€ï¼Œè€Œæ€§èƒ½å¹¶æ²¡æœ‰æ˜¾è‘—å˜åŒ–ï¼ˆBLEUï¼š34.28 vs. 34.35ï¼‰ã€‚æˆ‘ä»¬å‡è®¾è¿™æ˜¯å› ä¸ºæ¨¡å‹å®½åº¦å’Œæ·±åº¦çš„ç¼©æ”¾æ˜¯åœ¨å—ä¹‹é—´å‡åŒ€åˆ†é…å‚æ•°ï¼Œè¿™å¯èƒ½å¯¼è‡´å­¦ä¹ å†—ä½™å‚æ•°ã€‚ä¸ºäº†åˆ›å»ºæ·±è€Œå®½çš„ç½‘ç»œï¼Œæˆ‘ä»¬å°†æ¨¡å‹ç¼©æ”¾æ‰©å±•åˆ°å—çº§ï¼ˆè§å›¾3ï¼‰ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/paper/transformer/DeLighT/3.png&#34; alt=&#34;image-20240428134732165&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾3ï¼š &lt;strong&gt;å—çº§ç¼©æ”¾(block-wise scaling)&lt;/strong&gt; æœ‰æ•ˆåœ°åˆ†é…å‚æ•°å’Œæ“ä½œåˆ°å„ä¸ªå—ä¸­ï¼Œå¯¼è‡´æ¥è¿‘è¾“å…¥çš„DeLighTå—æ›´æµ…æ›´çª„ï¼Œæ¥è¿‘è¾“å‡ºçš„DeLighTå—æ›´æ·±æ›´å®½ã€‚åœ¨ï¼ˆbï¼‰ä¸­ï¼Œå…·æœ‰ç»Ÿä¸€ç¼©æ”¾ï¼ˆ$N=N_{min}=N_{max}=8$ï¼‰å’Œå—çº§ç¼©æ”¾ï¼ˆ$N_{min}=4$ï¼Œ$N_{max}=8$ï¼‰çš„DeLighTç½‘ç»œæ‹¥æœ‰çº¦16.7ç™¾ä¸‡ä¸ªå‚æ•°å¹¶æ‰§è¡Œ35äº¿æ¬¡æ“ä½œï¼ˆé’ˆå¯¹åºåˆ—é•¿åº¦$n=30$è®¡ç®—ï¼‰,ç„¶è€Œå…·æœ‰å—çº§ç¼©æ”¾çš„DeLighTç½‘ç»œäº¤ä»˜äº†æ›´å¥½çš„å›°æƒ‘åº¦ï¼Œæé«˜äº†2ä¸ªç‚¹ã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;ç¼©æ”¾DeLighTå—&lt;/strong&gt;ï¼š DeLighTå—ä½¿ç”¨DeLighTå­¦ä¹ æ·±åº¦å’Œå®½åº¦å¯å˜çš„è¡¨ç¤ºï¼Œå…¶æ·±åº¦å’Œå®½åº¦ç”±ä¸¤ä¸ªé…ç½®å‚æ•°æ§åˆ¶ï¼šGLTå±‚çš„æ•°é‡$N$å’Œå®½åº¦ä¹˜æ•°$w_m$ï¼ˆå›¾3aï¼‰ã€‚è¿™äº›é…ç½®å‚æ•°å…è®¸æˆ‘ä»¬ç‹¬ç«‹äºè¾“å…¥$d_m$å’Œè¾“å‡º$d_o$ç»´åº¦å¢åŠ DeLighTå—å†…çš„å¯å­¦ä¹ å‚æ•°æ•°é‡ã€‚è¿™ç§æ ¡å‡†åœ¨æ ‡å‡†Transformerå—ä¸­æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºå®ƒä»¬çš„è¡¨è¾¾èƒ½åŠ›å’Œå®¹é‡æ˜¯è¾“å…¥çš„å‡½æ•°ï¼ˆè¾“å…¥ç»´åº¦=å¤´æ•°$\times$å¤´ç»´åº¦ï¼‰ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä»‹ç»äº†å—çº§åˆ«çš„ç¼©æ”¾ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰å¯å˜å¤§å°DeLighTå—çš„ç½‘ç»œï¼Œå°†æµ…å±‚å’Œçª„å±‚çš„DeLighTå—åˆ†é…ç»™è¾“å…¥é™„è¿‘ï¼Œè€Œå°†æ·±å±‚å’Œå®½å±‚çš„DeLighTå—åˆ†é…ç»™è¾“å‡ºé™„è¿‘ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸¤ä¸ªç½‘ç»œèŒƒå›´çš„é…ç½®å‚æ•°ï¼šæœ€å°$N_{min}$å’Œæœ€å¤§$N_{max}$ GLTçš„æ•°é‡ã€‚å¯¹äºç¬¬$b$ä¸ªDeLighTå—ï¼Œæˆ‘ä»¬ä½¿ç”¨çº¿æ€§ç¼©æ”¾è®¡ç®—å¦‚ä¸‹å…¬å¼ä¸­çš„GLTæ•°é‡$N^b$å’Œå®½åº¦ä¹˜æ•°$w_m^b$ã€‚é€šè¿‡è¿™ç§ç¼©æ”¾ï¼Œæ¯ä¸ªDeLighTå—å…·æœ‰ä¸åŒçš„æ·±åº¦å’Œå®½åº¦ï¼ˆè§å›¾3aï¼‰ã€‚
$$
N^{b} = N_{min} + \frac{(N_{max} - N_{min})\ b}{\mathcal{B}-1}, \quad w_m^{b} =  w_m + \frac{(N_{max} - N_{min})\ b}{N_{min}(\mathcal{B}-1)}, \quad 0 \le b \le \mathcal{B}-1
$$
è¿™é‡Œï¼Œ$\mathcal{B}$è¡¨ç¤ºç½‘ç»œä¸­DeLighTå—çš„æ•°é‡ã€‚æˆ‘ä»¬åœ¨GLTå±‚æ•°$N$å’Œå®½åº¦ä¹˜æ•°$w_m$ä¸Šæ·»åŠ ä¸Šæ ‡$b$ï¼Œä»¥è¡¨ç¤ºè¿™äº›å‚æ•°æ˜¯é’ˆå¯¹ç¬¬$b$ä¸ªå—çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç½‘ç»œæ·±åº¦&lt;/strong&gt;ï¼š Transformerå—çš„æ·±åº¦æ˜¯å›ºå®šçš„ï¼Œå³4ã€‚å› æ­¤ï¼Œå…ˆå‰çš„å·¥ä½œï¼ˆRaffel et al., 2019; Brown et al., 2020; Wang et al., 2019ï¼‰å·²ç»å°†åŸºäºTransformerçš„ç½‘ç»œçš„æ·±åº¦ä¸Transformerå—çš„æ•°é‡è”ç³»èµ·æ¥ã€‚åœ¨DeLighTä¸­ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸€ç§ä¸åŒçš„è§†è§’æ¥å­¦ä¹ æ›´æ·±å±‚æ¬¡çš„è¡¨ç¤ºï¼Œå…¶ä¸­æ¯ä¸ªå—çš„å¤§å°æ˜¯å¯å˜çš„ã€‚ä¸ºäº†è®¡ç®—ç½‘ç»œæ·±åº¦ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸åŒé¢†åŸŸï¼ˆåŒ…æ‹¬è®¡ç®—æœºè§†è§‰ï¼Œä¾‹å¦‚Heç­‰äºº2016å¹´çš„ResNetï¼Œä»¥åŠç†è®ºæœºå™¨å­¦ä¹ ï¼Œä¾‹å¦‚Telgarsky, 2016ï¼‰çš„æ ‡å‡†å®šä¹‰ã€‚è¿™äº›å·¥ä½œå°†ç½‘ç»œæ·±åº¦å®šä¹‰ä¸ºè¿ç»­å¯å­¦ä¹ å±‚çš„æ•°é‡ï¼ˆä¾‹å¦‚ï¼Œå·ç§¯ã€çº¿æ€§æˆ–ç»„çº¿æ€§ï¼‰ã€‚ç±»ä¼¼åœ°ï¼Œå…·æœ‰$\mathcal{B}$ä¸ªå—çš„DeLighTå’ŒTransformerç½‘ç»œçš„æ·±åº¦åˆ†åˆ«ä¸º$\sum_{b=0}^{\mathcal{B}-1} (N^b + 4)$å’Œ$4\mathcal{B}$ã€‚&lt;/p&gt;
&lt;h2 id=&#34;4-å®éªŒç»“æœ&#34;&gt;4 å®éªŒç»“æœ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨ä¸¤ä¸ªæ ‡å‡†çš„åºåˆ—å»ºæ¨¡ä»»åŠ¡ä¸Šè¯„ä¼°äº†DeLighTçš„æ€§èƒ½ï¼šï¼ˆ1ï¼‰æœºå™¨ç¿»è¯‘ï¼ˆç¬¬4.1èŠ‚ï¼‰å’Œï¼ˆ2ï¼‰è¯­è¨€å»ºæ¨¡ï¼ˆç¬¬4.2èŠ‚ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id=&#34;41-æœºå™¨ç¿»è¯‘machine-translation&#34;&gt;4.1 æœºå™¨ç¿»è¯‘(machine translation)&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®é›†å’Œè¯„ä¼°&lt;/strong&gt;ï¼šæˆ‘ä»¬åœ¨å››ä¸ªæ•°æ®é›†ä¸Šå¯¹DeLighTæ¨¡å‹è¿›è¡Œäº†åŸºå‡†æµ‹è¯•ï¼šï¼ˆ1ï¼‰IWSLTâ€™14 å¾·è¯­-è‹±è¯­ï¼ˆDe-Enï¼‰ï¼Œï¼ˆ2ï¼‰WMTâ€™16 è‹±è¯­-ç½—é©¬å°¼äºšè¯­ï¼ˆEn-Roï¼‰ï¼Œï¼ˆ3ï¼‰WMTâ€™14 è‹±è¯­-å¾·è¯­ï¼ˆWMTâ€™14 En-Deï¼‰ï¼Œä»¥åŠï¼ˆ4ï¼‰WMTâ€™14 è‹±è¯­-æ³•è¯­ï¼ˆWMTâ€™14 En-Frï¼‰ã€‚å¯¹äºIWSLTâ€™14 De-Enæ•°æ®é›†ï¼Œæˆ‘ä»¬å¤åˆ¶äº†Wuç­‰äººï¼ˆ2019ï¼‰å’ŒEdunovç­‰äººï¼ˆ2018ï¼‰çš„è®¾ç½®ï¼Œä½¿ç”¨160K/7K/7Kå¥å­å¯¹è¿›è¡Œè®­ç»ƒã€éªŒè¯å’Œæµ‹è¯•ï¼Œä»¥åŠå¤§çº¦10Kä¸ªä»¤ç‰Œçš„è”åˆBPEè¯æ±‡è¡¨ã€‚å¯¹äºWMTâ€™14 En-Deæ•°æ®é›†ï¼Œæˆ‘ä»¬éµå¾ªäº†Vaswaniç­‰äººï¼ˆ2017ï¼‰çš„è®¾ç½®ã€‚æ•°æ®é›†åŒ…å«3.9M/39K/3Kå¥å­å¯¹ï¼Œåˆ†åˆ«ç”¨äºè®­ç»ƒã€éªŒè¯å’Œæµ‹è¯•ï¼Œä»¥åŠ44Kçš„è”åˆBPEè¯æ±‡è¡¨å¤§å°ã€‚å¯¹äºWMTâ€™14 En-Fræ•°æ®é›†ï¼Œæˆ‘ä»¬å¤åˆ¶äº†Gehringç­‰äººï¼ˆ2017ï¼‰çš„è®¾ç½®ï¼Œä½¿ç”¨36M/27K/3Kå¥å­å¯¹è¿›è¡Œè®­ç»ƒã€éªŒè¯å’Œæµ‹è¯•ï¼Œä»¥åŠ44Kçš„è”åˆBPEè¯æ±‡è¡¨å¤§å°ï¼ˆæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¸Tensor2Tensoråº“ï¼ˆVaswaniç­‰äººï¼Œ2018ï¼‰å…¼å®¹çš„è®­ç»ƒå’ŒéªŒè¯æ•°æ®ï¼Œä»¥ä¾¿ä¸æœ€è¿‘çš„å·¥ä½œï¼ˆä¾‹å¦‚ï¼Œè¿›åŒ–Transformerï¼‰è¿›è¡Œå…¬å¹³æ¯”è¾ƒï¼‰ã€‚æ€§èƒ½æ˜¯æ ¹æ®æµ‹è¯•é›†ä¸Šçš„BLEUåˆ†æ•°ï¼ˆPapineniç­‰äººï¼Œ2002ï¼‰ï¼ˆåˆ†æ•°è¶Šé«˜è¶Šå¥½ï¼‰æ¥è¯„ä¼°çš„ã€‚æˆ‘ä»¬éµå¾ªWuç­‰äººï¼ˆ2019ï¼‰çš„æŸæœç´¢ç›¸å…³è¶…å‚æ•°è®¾ç½®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¶æ„&lt;/strong&gt;ï¼šæˆ‘ä»¬é‡‡ç”¨äº†Vaswaniç­‰äººï¼ˆ2017ï¼‰çš„å¯¹ç§°ç¼–ç å™¨-è§£ç å™¨æ¶æ„ï¼Œå¹¶ä½¿ç”¨äº†æ­£å¼¦ä½ç½®ç¼–ç ã€‚ç¼–ç å™¨å’Œè§£ç å™¨éƒ½åŒ…å«äº†$\mathcal{B}$ä¸ªDeLighTå—ã€‚è§£ç å™¨å—ä¸ç¼–ç å™¨å—ç›¸åŒï¼ˆè§å›¾1bï¼‰ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒä»¬åœ¨è½»é‡çº§FFNä¹‹å‰æœ‰ä¸€ä¸ªé¢å¤–çš„æº-ç›®æ ‡å•å¤´æ³¨æ„åŠ›å•å…ƒã€‚åœ¨æº-ç›®æ ‡å•å¤´æ³¨æ„åŠ›å•å…ƒä¸­ï¼Œé”®å’Œå€¼æ˜¯å¯¹ç¼–ç å™¨è¾“å‡ºçš„æŠ•å½±ï¼ˆè¯¦ç»†å†…å®¹è§é™„å½•Aï¼‰ã€‚åœ¨æˆ‘ä»¬çš„å®éªŒä¸­ï¼Œæˆ‘ä»¬å¯¹WMTâ€™16 En-Roã€WMTâ€™14 En-Deå’ŒWMTâ€™14 En-Frä½¿ç”¨äº†$w_m=2$, $N_{min}=4$, å’Œ $N_{max}=8$ ï¼›è¿™å¯¼è‡´äº†222å±‚æ·±çš„DeLighTç½‘ç»œã€‚å¯¹äºIWSLTâ€™14 De-Enï¼Œæˆ‘ä»¬ä½¿ç”¨äº†$w_m=1$, $N_{min}=3$, å’Œ $N_{max}=9$ï¼›è¿™å¯¼è‡´äº†289å±‚æ·±çš„ç½‘ç»œã€‚ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬è®¾ç½®äº†$\mathcal{B}=N_{max}$ã€‚æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå¯å­¦ä¹ çš„æŸ¥æ‰¾è¡¨ï¼Œå°†è¯æ±‡è¡¨ä¸­çš„æ¯ä¸ªTokenæ˜ å°„åˆ°ä¸€ä¸ª128ç»´çš„å‘é‡ã€‚æˆ‘ä»¬ä½¿ç”¨Fairseqï¼ˆOttç­‰äººï¼Œ2019ï¼‰å®ç°äº†æˆ‘ä»¬çš„æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨äº†ä»–ä»¬æä¾›çš„è„šæœ¬è¿›è¡Œæ•°æ®é¢„å¤„ç†ã€è®­ç»ƒå’Œè¯„ä¼°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è®­ç»ƒ&lt;/strong&gt;ï¼šå¯¹äºIWSLTâ€™14 De-Enæ¨¡å‹ï¼Œæˆ‘ä»¬éµå¾ªäº†Wuç­‰äººï¼ˆ2019ï¼‰çš„è®¾ç½®ï¼Œå¹¶åœ¨å•ä¸ªNVIDIA GTX 1080 GPUä¸Šï¼Œä»¥4Kä»¤ç‰Œçš„æ‰¹é‡å¤§å°å¯¹æ‰€æœ‰æ¨¡å‹è¿›è¡Œäº†50Kæ¬¡è¿­ä»£çš„è®­ç»ƒã€‚å¯¹äºWMTâ€™16 En-Roï¼Œæˆ‘ä»¬éµå¾ªäº†Ghazvininejadç­‰äººï¼ˆ2019ï¼‰çš„è®­ç»ƒè®¾ç½®ï¼Œå¹¶åœ¨16ä¸ªNVIDIA Tesla V100 GPUä¸Šè¿›è¡Œäº†100Kæ¬¡è¿­ä»£çš„è®­ç»ƒï¼Œæœ‰æ•ˆæ‰¹é‡å¤§å°ä¸º64Kä»¤ç‰Œã€‚å¯¹äºWMTâ€™14 En-Deå’ŒWMTâ€™14 En-Frï¼Œæˆ‘ä»¬éµå¾ªäº†Wuç­‰äººï¼ˆ2019ï¼‰çš„è®­ç»ƒè®¾ç½®ï¼Œå¹¶åœ¨16ä¸ªV100 GPUä¸Šåˆ†åˆ«è¿›è¡Œäº†30Kå’Œ50Kæ¬¡è¿­ä»£çš„è®­ç»ƒã€‚æˆ‘ä»¬ä½¿ç”¨Adamï¼ˆKingmaå’ŒBaï¼Œ2015ï¼‰åœ¨è®­ç»ƒæœŸé—´æœ€å°åŒ–äº¤å‰ç†µæŸå¤±ï¼Œå¹¶ä½¿ç”¨äº†æ ‡ç­¾å¹³æ»‘å€¼ä¸º0.1ã€‚ä¸ºäº†å…¬å¹³æ¯”è¾ƒï¼Œæˆ‘ä»¬è®­ç»ƒåŸºçº¿Transformeræ¨¡å‹æ—¶ä½¿ç”¨äº†ç›¸åŒçš„è®­ç»ƒè®¾ç½®ã€‚&lt;/p&gt;
&lt;h4 id=&#34;411-ç»“æœ&#34;&gt;4.1.1 ç»“æœ&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;ä¸åŸºçº¿Transformerçš„æ¯”è¾ƒ&lt;/strong&gt;ï¼šè¡¨1æ¯”è¾ƒäº†DeLighTä¸Vaswaniç­‰äººï¼ˆ2017ï¼‰åœ¨ä¸åŒè¯­æ–™åº“ä¸Šçš„åŸºçº¿Transformerçš„æ€§èƒ½ã€‚DeLighTåœ¨ä¸åŒè¯­æ–™åº“ä¸Šéƒ½ä»¥æ›´å°‘çš„å‚æ•°å®ç°äº†æ›´å¥½çš„æˆ–ç›¸ä¼¼çš„æ€§èƒ½ã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨èµ„æºè¾ƒå°‘ï¼ˆWMTâ€™16 En-Roï¼‰å’Œèµ„æºä¸°å¯Œï¼ˆWMTâ€™14 En-De &amp;amp; WMTâ€™14 En-Frï¼‰çš„è¯­æ–™åº“ä¸Šï¼ŒDeLighTåˆ†åˆ«ä»¥2.8å€å’Œ1.8å€æ›´å°‘çš„å‚æ•°å®ç°äº†ç›¸ä¼¼æˆ–æ›´å¥½çš„æ€§èƒ½ã€‚å½“å‚æ•°æ•°é‡å¢åŠ æ—¶ï¼ŒDeLighTçš„æ€§èƒ½è¶…è¿‡äº†Transformerã€‚ä¾‹å¦‚ï¼Œåœ¨WMTâ€™14 En-Fræ•°æ®é›†ä¸Šï¼ŒDeLighTæ¯”Transformeræ·±3.7å€ï¼Œæé«˜äº†1.3ä¸ªBLEUåˆ†æ•°ï¼Œä½†å‚æ•°æ•°é‡å°‘äº†1300ä¸‡ï¼Œæ“ä½œæ•°é‡å°‘äº†30äº¿ï¼ˆè§è¡¨2ï¼‰ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å°å‹è¯­æ–™åº“ç»“æœ&#34;&gt;å°å‹è¯­æ–™åº“ç»“æœ&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;WMTâ€™14 En-De&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;WMTâ€™14 En-Fr&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ¨¡å‹&lt;/td&gt;
&lt;td&gt;å‚æ•°æ•°é‡&lt;/td&gt;
&lt;td&gt;æ¯”ç‡&lt;/td&gt;
&lt;td&gt;BLEU&lt;/td&gt;
&lt;td&gt;BLEUå˜åŒ–&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å‚æ•°æ•°é‡&lt;/td&gt;
&lt;td&gt;æ¯”ç‡&lt;/td&gt;
&lt;td&gt;BLEU&lt;/td&gt;
&lt;td&gt;BLEUå˜åŒ–&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Transformer (Vaswani et al., 2017)&lt;/td&gt;
&lt;td&gt;&amp;ndash;&lt;/td&gt;
&lt;td&gt;&amp;ndash;&lt;/td&gt;
&lt;td&gt;34.4$^\dagger$&lt;/td&gt;
&lt;td&gt;&amp;ndash;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;62 M&lt;/td&gt;
&lt;td&gt;&amp;ndash;&lt;/td&gt;
&lt;td&gt;34.3$^\ddagger$&lt;/td&gt;
&lt;td&gt;&amp;ndash;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Transformer (æˆ‘ä»¬çš„å®ç°)&lt;/td&gt;
&lt;td&gt;42 M&lt;/td&gt;
&lt;td&gt;$1.0\times$&lt;/td&gt;
&lt;td&gt;34.3&lt;/td&gt;
&lt;td&gt;&amp;ndash;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;62 M&lt;/td&gt;
&lt;td&gt;$1.0\times$&lt;/td&gt;
&lt;td&gt;34.3&lt;/td&gt;
&lt;td&gt;&amp;ndash;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DeLighT&lt;/td&gt;
&lt;td&gt;14 M&lt;/td&gt;
&lt;td&gt;$0.3\times$&lt;/td&gt;
&lt;td&gt;33.8&lt;/td&gt;
&lt;td&gt;-0.5&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;22 M&lt;/td&gt;
&lt;td&gt;$0.35\times$&lt;/td&gt;
&lt;td&gt;34.3&lt;/td&gt;
&lt;td&gt;0.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DeLighT&lt;/td&gt;
&lt;td&gt;30 M&lt;/td&gt;
&lt;td&gt;$0.7\times$&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;35.3&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;+1.0&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;53 M&lt;/td&gt;
&lt;td&gt;$0.85\times$&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;34.7&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;+0.4&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;å¤§å‹è¯­æ–™åº“ç»“æœ&#34;&gt;å¤§å‹è¯­æ–™åº“ç»“æœ&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;WMTâ€™14 En-De&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;WMTâ€™14 En-Fr&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ¨¡å‹&lt;/td&gt;
&lt;td&gt;å‚æ•°æ•°é‡&lt;/td&gt;
&lt;td&gt;æ¯”ç‡&lt;/td&gt;
&lt;td&gt;BLEU&lt;/td&gt;
&lt;td&gt;BLEUå˜åŒ–&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;å‚æ•°æ•°é‡&lt;/td&gt;
&lt;td&gt;æ¯”ç‡&lt;/td&gt;
&lt;td&gt;BLEU&lt;/td&gt;
&lt;td&gt;BLEUå˜åŒ–&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Transformer (Vaswani et al., 2017)&lt;/td&gt;
&lt;td&gt;62 M&lt;/td&gt;
&lt;td&gt;&amp;ndash;&lt;/td&gt;
&lt;td&gt;27.3&lt;/td&gt;
&lt;td&gt;&amp;ndash;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&amp;ndash;&lt;/td&gt;
&lt;td&gt;62 M&lt;/td&gt;
&lt;td&gt;38.1&lt;/td&gt;
&lt;td&gt;&amp;ndash;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Transformer (æˆ‘ä»¬çš„å®ç°)&lt;/td&gt;
&lt;td&gt;67 M&lt;/td&gt;
&lt;td&gt;$1.0\times$&lt;/td&gt;
&lt;td&gt;27.7&lt;/td&gt;
&lt;td&gt;&amp;ndash;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;67 M&lt;/td&gt;
&lt;td&gt;$1.0\times$&lt;/td&gt;
&lt;td&gt;39.2&lt;/td&gt;
&lt;td&gt;&amp;ndash;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DeLighT&lt;/td&gt;
&lt;td&gt;37 M&lt;/td&gt;
&lt;td&gt;$0.55\times$&lt;/td&gt;
&lt;td&gt;27.6&lt;/td&gt;
&lt;td&gt;-0.1&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;37 M&lt;/td&gt;
&lt;td&gt;$0.55\times$&lt;/td&gt;
&lt;td&gt;39.6&lt;/td&gt;
&lt;td&gt;+0.4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DeLighT&lt;/td&gt;
&lt;td&gt;54 M&lt;/td&gt;
&lt;td&gt;$0.80\times$&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;28.0&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;+0.3&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;54 M&lt;/td&gt;
&lt;td&gt;$0.80\times$&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;40.5&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;+1.3&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¡¨1ï¼š&lt;strong&gt;ä¸åŸºçº¿Transformeråœ¨æœºå™¨ç¿»è¯‘è¯­æ–™åº“ä¸Šçš„æ¯”è¾ƒ&lt;/strong&gt;ã€‚DeLighTæ¨¡å‹éœ€è¦æ˜¾è‘—è¾ƒå°‘çš„å‚æ•°æ¥è¾¾åˆ°ç±»ä¼¼çš„æ€§èƒ½ã€‚è¿™é‡Œï¼Œ$^\dagger$å’Œ$^\ddagger$åˆ†åˆ«è¡¨ç¤ºWu et al. (2019) å’Œ Ghazvininejad et al. (2019),ä¸­æŠ¥å‘Šçš„æœ€ä½³TransformeråŸºçº¿ã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æ¨¡å‹&lt;/th&gt;
&lt;th&gt;æ·±åº¦&lt;/th&gt;
&lt;th&gt;å‚æ•°æ•°é‡&lt;/th&gt;
&lt;th&gt;MACæ•°&lt;/th&gt;
&lt;th&gt;BLEU&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Transformer&lt;/td&gt;
&lt;td&gt;60&lt;/td&gt;
&lt;td&gt;67 M&lt;/td&gt;
&lt;td&gt;11.1 B&lt;/td&gt;
&lt;td&gt;39.2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DeLighT&lt;/td&gt;
&lt;td&gt;222&lt;/td&gt;
&lt;td&gt;37 M&lt;/td&gt;
&lt;td&gt;5.6 B&lt;/td&gt;
&lt;td&gt;39.6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DeLighT&lt;/td&gt;
&lt;td&gt;222&lt;/td&gt;
&lt;td&gt;54 M&lt;/td&gt;
&lt;td&gt;8.1 B&lt;/td&gt;
&lt;td&gt;40.5&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¡¨2ï¼šä¸Transformerç›¸æ¯”ï¼ŒDeLighTç½‘ç»œæ˜¯æ·±åº¦ã€è½»é‡çº§ä¸”é«˜æ•ˆçš„ã€‚BLEUåˆ†æ•°æ˜¯åœ¨WMTâ€™14 En-Fræ•°æ®é›†ä¸ŠæŠ¥å‘Šçš„ã€‚ä¸ºäº†è®¡ç®—ç½‘ç»œæ·±åº¦ï¼Œæˆ‘ä»¬ç»Ÿè®¡äº†ç½‘ç»œä¸­é¡ºåºå±‚çš„æ•°é‡ï¼ˆç¬¬3.3èŠ‚ï¼‰ã€‚æˆ‘ä»¬ä½¿ç”¨äº†20ä¸ªæºTokenå’Œ20ä¸ªç›®æ ‡Tokenæ¥è®¡ç®—ä¹˜åŠ æ“ä½œï¼ˆMACsï¼‰ã€‚è¯¦ç»†ä¿¡æ¯è§é™„å½•Cã€‚&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;ç‰¹åˆ«å€¼å¾—å…³æ³¨çš„æ˜¯åœ¨WMT&#39;14 En-Deè¯­æ–™åº“ä¸Šï¼ˆå¦‚å›¾4ï¼‰ï¼ŒDeLighTä¸Vaswaniç­‰äººï¼ˆ2017å¹´ï¼‰çš„åŸºå‡†Transformerä»¥åŠå…¶ç¥ç»æœç´¢å˜ä½“â€”â€”Soç­‰äººï¼ˆ2019å¹´ï¼‰çš„Evolved Transformeråœ¨ä¸¤ç§ä¸åŒå‚æ•°è®¾ç½®ä¸‹çš„æ€§èƒ½æ¯”è¾ƒã€‚&lt;strong&gt;å¯¹äºå°å‹æ¨¡å‹ï¼ˆå°äº1åƒä¸‡å‚æ•°ï¼‰ï¼ŒDeLighTæ¨¡å‹æä¾›äº†æ›´å¥½çš„æ€§èƒ½ï¼Œå¹¶ä¸”è¦è¾¾åˆ°ä¸è¿™äº›æ¨¡å‹ç›¸åŒçš„æ€§èƒ½æ°´å¹³ï¼ŒDeLighTæ¨¡å‹éœ€è¦æ›´å°‘çš„å‚æ•°&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/paper/transformer/DeLighT/4.png&#34; alt=&#34;image-20240428183808019&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;em&gt;å›¾4ï¼šåœ¨WMT&#39;14 En-Deè¯­æ–™åº“ä¸Šï¼ŒDeLighTä¸Transformerå’ŒEvolved Transformeråœ¨ä¸¤ç§ä¸åŒè®¾ç½®ä¸‹çš„æ¯”è¾ƒï¼šï¼ˆ1ï¼‰å‚æ•°æ•°é‡ç›¸åŒï¼Œï¼ˆ2ï¼‰æ€§èƒ½ç›¸åŒã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;ä¸æœ€å…ˆè¿›æ–¹æ³•çš„æ¯”è¾ƒ&lt;/strong&gt;ï¼šå¤§å¤šæ•°æœ€å…ˆè¿›çš„æ–¹æ³•éƒ½åœ¨WMTâ€™14 En-Deä¸Šè¯„ä¼°äº†æ€§èƒ½ï¼Œä¸€äº›ä¹Ÿåœ¨IWSLTâ€™14 De-Enä¸Šè¿›è¡Œäº†è¯„ä¼°ã€‚è¡¨3æ¯”è¾ƒäº†DeLighTä¸è¿™äº›è¯­æ–™åº“ä¸Šæœ€å…ˆè¿›æ–¹æ³•çš„æ€§èƒ½ã€‚DeLighTå®ç°äº†ä¸ç°æœ‰æ–¹æ³•ç›¸ä¼¼æˆ–æ›´å¥½çš„æ€§èƒ½ã€‚é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œç°æœ‰æ–¹æ³•é€šè¿‡ä¸åŒçš„è®¾è®¡é€‰æ‹©æ”¹è¿›äº†åŸºçº¿Transformerâ€”â€”ä¾‹å¦‚ï¼Œä¸å¯¹ç§°çš„ç¼–ç å™¨-è§£ç å™¨ç»“æ„ï¼ˆWang et al., 2019ï¼‰å’Œç¥ç»æ¶æ„æœç´¢ï¼ˆSo et al., 2019ï¼‰ã€‚æˆ‘ä»¬ç›¸ä¿¡ï¼ŒDeLighTå°†æ¥ä¹Ÿä¼šä»è¿™äº›è®¾è®¡é€‰æ‹©ä¸­å—ç›Šã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;IWSLTâ€™14 De-En&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ¨¡å‹&lt;/td&gt;
&lt;td&gt;å‚æ•°æ•°é‡&lt;/td&gt;
&lt;td&gt;BLEU&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Transformers  (Vaswani et al., 2017)&lt;/td&gt;
&lt;td&gt;42 M&lt;/td&gt;
&lt;td&gt;34.3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Variational Attention (Deng et al., 2018)&lt;/td&gt;
&lt;td&gt;&amp;ndash;&lt;/td&gt;
&lt;td&gt;33.1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Dynamic convolutions (Vaswani et al., 2017)&lt;/td&gt;
&lt;td&gt;43 M&lt;/td&gt;
&lt;td&gt;35.2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Lite Transformer$^\ddagger$ (Wu et al., 2020)&lt;/td&gt;
&lt;td&gt;&amp;ndash;&lt;/td&gt;
&lt;td&gt;33.6&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DeLighT(æˆ‘ä»¬çš„æ¨¡å‹)&lt;/td&gt;
&lt;td&gt;30 M&lt;/td&gt;
&lt;td&gt;35.3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;WMTâ€™14 En-De&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ¨¡å‹&lt;/td&gt;
&lt;td&gt;å‚æ•°æ•°é‡&lt;/td&gt;
&lt;td&gt;BLEU&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Transformer (Vaswani et al., 2017)&lt;/td&gt;
&lt;td&gt;62 M&lt;/td&gt;
&lt;td&gt;27.3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DLCL (Wang et al., 2019)&lt;/td&gt;
&lt;td&gt;62 M&lt;/td&gt;
&lt;td&gt;27.3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Evolved Transformer $^\dagger$ (So et al., 2019)&lt;/td&gt;
&lt;td&gt;46 M&lt;/td&gt;
&lt;td&gt;27.7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Lite Transformer$^\ddagger$ (Wu et al., 2020)&lt;/td&gt;
&lt;td&gt;&amp;ndash;&lt;/td&gt;
&lt;td&gt;26.5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DeLighT(æˆ‘ä»¬çš„æ¨¡å‹)&lt;/td&gt;
&lt;td&gt;37 M&lt;/td&gt;
&lt;td&gt;27.6&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¡¨3ï¼šä¸æœºå™¨ç¿»è¯‘è¯­æ–™åº“ä¸Šçš„æœ€æ–°æ–¹æ³•è¿›è¡Œæ¯”è¾ƒã€‚DeLighTæ¨¡å‹åœ¨å‚æ•°è¾ƒå°‘çš„æƒ…å†µä¸‹æä¾›äº†ä¸æœ€æ–°æ¨¡å‹ç›¸ä¼¼æˆ–æ›´å¥½çš„æ€§èƒ½ã€‚è¿™é‡Œï¼Œ$^\dagger$è¡¨ç¤ºç½‘ç»œä½¿ç”¨ç¥ç»æ¶æ„æœç´¢ï¼ˆNASï¼‰ï¼Œ$^\ddagger$ è¡¨ç¤ºæœªæŠ¥å‘Šå®Œæ•´çš„ç½‘ç»œå‚æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DeLighTæ¨¡å‹çš„æ‰©å±•&lt;/strong&gt;ï¼šå›¾5 æ˜¾ç¤ºäº†éšç€ç½‘ç»œå‚æ•°å¢åŠ ï¼ŒDeLighTæ¨¡å‹çš„æ€§èƒ½æé«˜ï¼›è¡¨æ˜å®ƒä»¬èƒ½å¤Ÿåœ¨ä¸åŒè¯­æ–™åº“ä¸Šå­¦ä¹ è¡¨ç¤ºï¼ŒåŒ…æ‹¬èµ„æºè¾ƒå°‘çš„è¯­æ–™åº“ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/paper/transformer/DeLighT/5.png&#34; alt=&#34;image-20240428184459900&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;å›¾5: &lt;strong&gt;DeLighTæ¨¡å‹çš„è§„æ¨¡æ‰©å±•&lt;/strong&gt;ã€‚éšç€ç½‘ç»œå‚æ•°æ•°é‡çš„å¢åŠ ï¼ŒDeLighTåœ¨ä¸åŒè¯­æ–™åº“ï¼ˆåŒ…æ‹¬ä½èµ„æºè¯­æ–™åº“WMT&#39;16 En-Roï¼‰ä¸Šçš„æ€§èƒ½éƒ½æœ‰æ‰€æé«˜ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;42-è¯­è¨€å»ºæ¨¡language-modeling&#34;&gt;4.2 è¯­è¨€å»ºæ¨¡(language modeling)&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;æ•°æ®é›†å’Œè¯„ä¼°&lt;/strong&gt;ï¼šæˆ‘ä»¬åœ¨WikiText-103æ•°æ®é›†ä¸Šè¿›è¡Œè¯„ä¼°ï¼ˆMerity et al., 2017ï¼‰ï¼Œè¯¥æ•°æ®é›†æœ‰103M/217K/245Kä¸ªTokenç”¨äºè®­ç»ƒã€éªŒè¯å’Œæµ‹è¯•ã€‚å®ƒæœ‰ä¸€ä¸ªå¤§çº¦260Kä¸ªTokençš„è¯çº§è¯æ±‡è¡¨ã€‚æŒ‰ç…§æœ€è¿‘çš„å·¥ä½œï¼ˆBaevskiå’ŒAuliï¼Œ2019ï¼›Daiç­‰äººï¼Œ2019ï¼‰ï¼Œæˆ‘ä»¬åœ¨æµ‹è¯•é›†ä¸Šä»¥å›°æƒ‘åº¦ï¼ˆè¶Šä½è¶Šå¥½ï¼‰æŠ¥å‘Šæ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ¶æ„&lt;/strong&gt;ï¼šæˆ‘ä»¬ä½¿ç”¨Baevskiå’ŒAuliï¼ˆ2019ï¼‰çš„åŸºäºTransformerçš„è§£ç å™¨æ¶æ„ï¼Œå¸¦æœ‰Bä¸ªDeLighTå—ã€‚æˆ‘ä»¬ä½¿ç”¨$w_m$=$2$, $N_{min}$=$4$, å’Œ $N_{max}$=$12$ã€‚æˆ‘ä»¬ä½¿ç”¨è‡ªé€‚åº”è¾“å…¥ï¼ˆBaevskiå’ŒAuliï¼Œ2019ï¼‰ä½œä¸ºæŸ¥æ‰¾è¡¨ï¼Œå¹¶å°†è‡ªé€‚åº”è¾“å‡ºï¼ˆGrave et al., 2017aï¼‰ä½œä¸ºåˆ†ç±»å±‚ï¼Œå…·æœ‰ä¸€ä¸ªå¤´ï¼ˆå¤´ç»´åº¦ä¸º128ï¼‰å’Œä¸¤ä¸ªå°¾éƒ¨ï¼ˆå°¾éƒ¨ç»´åº¦åˆ†åˆ«ä¸º64å’Œ32ï¼‰ã€‚æˆ‘ä»¬è¿˜å…±äº«äº†è¾“å…¥å’Œè¾“å‡ºå±‚ä¹‹é—´çš„æƒé‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è®­ç»ƒ&lt;/strong&gt;ï¼šæˆ‘ä»¬éµå¾ªBaevskiå’ŒAuliï¼ˆ2019ï¼‰çš„è®­ç»ƒè®¾ç½®ï¼Œåªæ˜¯æˆ‘ä»¬æ‰€æœ‰çš„æ¨¡å‹éƒ½åœ¨8ä¸ªNVIDIA Tesla V100 GPUä¸Šè¿›è¡Œäº†100Kæ¬¡è¿­ä»£çš„è®­ç»ƒï¼Œä¸Šä¸‹æ–‡é•¿åº¦ä¸º512ï¼Œæœ‰æ•ˆæ‰¹é‡å¤§å°ä¸º64Kä»¤ç‰Œã€‚æˆ‘ä»¬ä½¿ç”¨Adamè¿›è¡Œè®­ç»ƒï¼Œå¹¶åœ¨æµ‹è¯•æœŸé—´ä½¿ç”¨480çš„ä¸Šä¸‹æ–‡é•¿åº¦ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼šè¡¨4bæ¯”è¾ƒäº†DeLighTä¸ä¹‹å‰æ–¹æ³•åœ¨WikiText-103ä¸Šçš„æ€§èƒ½ã€‚è¡¨4aç»˜åˆ¶äº†DeLighTå’ŒTransformer-XLï¼ˆDai et al., 2019ï¼‰çš„å›°æƒ‘åº¦éšå‚æ•°æ•°é‡å˜åŒ–çš„å›¾è¡¨â€”â€”åè€…è¶…è¿‡äº†å…¶ä»–åŸºäºTransformerçš„å®ç°ï¼ˆä¾‹å¦‚ï¼ŒBaevskiå’ŒAuli 2019ï¼‰ã€‚ä¸¤ä¸ªè¡¨æ ¼éƒ½è¡¨æ˜ï¼ŒDeLighTä»¥æ›´å°‘çš„å‚æ•°æä¾›äº†æ¯”æœ€å…ˆè¿›çš„æ–¹æ³•ï¼ˆåŒ…æ‹¬Transformer-XLï¼‰æ›´å¥½çš„æ€§èƒ½ï¼Œå¹¶ä¸”ä½¿ç”¨äº†æ›´çŸ­çš„ä¸Šä¸‹æ–‡é•¿åº¦ï¼Œè¡¨æ˜DeLighTå˜æ¢æœ‰åŠ©äºå­¦ä¹ å¼ºå¤§çš„ä¸Šä¸‹æ–‡å…³ç³»ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/paper/transformer/DeLighT/6.png&#34; alt=&#34;image-20240428193117942&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;è¡¨4ï¼šåœ¨WikiText-103æ•°æ®é›†ä¸Šçš„ç»“æœã€‚ä¸Transformer-XLç›¸æ¯”ï¼ŒDeLighTåœ¨å‚æ•°è¾ƒå°‘çš„æƒ…å†µä¸‹æä¾›äº†ç›¸ä¼¼æˆ–æ›´å¥½çš„æ€§èƒ½ï¼ˆæ›´ä½çš„å›°æƒ‘åº¦ï¼‰ã€‚â€  å¯¹äºTransformer-XLï¼Œæˆ‘ä»¬ä½¿ç”¨å®˜æ–¹æºä»£ç å¤ç°ç»“æœã€‚å¯¹äºä½¿ç”¨ä¸Šä¸‹æ–‡é•¿åº¦ä¸º480è¯„ä¼°Transformer-XLï¼Œæˆ‘ä»¬åœ¨å®˜æ–¹è¯„ä¼°è„šæœ¬ä¸­å°†mem_lenè¶…å‚æ•°è®¾ç½®ä¸º480ã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;5-è®¡ç®—æ•ˆç‡çš„åˆ†æä¸è®¨è®º&#34;&gt;5 è®¡ç®—æ•ˆç‡çš„åˆ†æä¸è®¨è®º&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;è®­ç»ƒæ—¶é—´å’Œå†…å­˜æ¶ˆè€—&lt;/strong&gt;ï¼šè¡¨5æ¯”è¾ƒäº†DeLighTä¸åŸºçº¿Transformeråœ¨è®­ç»ƒæ—¶é—´å’Œå†…å­˜æ¶ˆè€—æ–¹é¢çš„æƒ…å†µã€‚ä¸ºäº†è¿›è¡Œå…¬å¹³æ¯”è¾ƒï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªæ²¡æœ‰NVIDIAä¸“ç”¨CUDAå†…æ ¸çš„Transformerå•å…ƒï¼Œå¹¶åœ¨16ä¸ªNVIDIA V100 GPUä¸Šå¯¹å…¨ç²¾åº¦ç½‘ç»œè¿›è¡Œäº†30Kæ¬¡è¿­ä»£çš„è®­ç»ƒã€‚Transformerå’ŒDeLighTæ¨¡å‹çš„è®­ç»ƒæ—¶é—´åˆ†åˆ«çº¦ä¸º37å°æ—¶å’Œ23å°æ—¶ï¼ŒGPUå†…å­˜æ¶ˆè€—åˆ†åˆ«çº¦ä¸º12.5 GBå’Œ14.5 GBï¼ˆR1 vs. R2ï¼‰ã€‚å½“æˆ‘ä»¬å¯ç”¨APEXåº“3ä¸ºå¤šå¤´æ³¨æ„åŠ›æä¾›çš„ä¸“ç”¨CUDAå†…æ ¸æ—¶ï¼ŒTransformeræ¨¡å‹çš„è®­ç»ƒæ—¶é—´ä»37å°æ—¶å‡å°‘åˆ°16å°æ—¶ï¼Œè€Œæˆ‘ä»¬æ²¡æœ‰è§‚å¯Ÿåˆ°å†…å­˜æ¶ˆè€—çš„æ˜¾è‘—å˜åŒ–ã€‚å—åˆ°è¿™ä¸€è§‚å¯Ÿç»“æœçš„å¯å‘ï¼Œæˆ‘ä»¬ä¸ºGLTä¸­çš„åˆ†ç»„å’Œååˆ†ç»„å‡½æ•°å®ç°äº†ä¸“ç”¨çš„CUDAå†…æ ¸ï¼ˆè§é™„å½•Eï¼‰ã€‚è¿™äº›æ›´æ”¹ä½¿å¾—DeLighTçš„è®­ç»ƒæ—¶é—´å’ŒGPUå†…å­˜æ¶ˆè€—åˆ†åˆ«å‡å°‘äº†çº¦4å°æ—¶å’Œ3 GBã€‚æˆ‘ä»¬å¼ºè°ƒï¼Œåˆ†ç»„ã€çº¿æ€§å˜æ¢ã€ç‰¹å¾æ´—ç‰Œå’Œååˆ†ç»„å¯ä»¥é€šè¿‡å•ä¸ªCUDAå†…æ ¸é«˜æ•ˆå®ç°ã€‚æœªæ¥ï¼Œæˆ‘ä»¬æœŸæœ›ä¸ºè¿™äº›æ“ä½œæä¾›ä¸“ç”¨çš„CUDAå†…æ ¸ï¼Œè¿™å°†è¿›ä¸€æ­¥å‡å°‘å†…å­˜æ¶ˆè€—ä»¥åŠè®­ç»ƒ/æ¨ç†æ—¶é—´ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Row #&lt;/th&gt;
&lt;th&gt;Model&lt;/th&gt;
&lt;th&gt;# Params (ç™¾ä¸‡)&lt;/th&gt;
&lt;th&gt;BLEU (WMT&#39;14 En-Fr)&lt;/th&gt;
&lt;th&gt;è®­ç»ƒæ—¶é—´&lt;/th&gt;
&lt;th&gt;å†…å­˜ (GB)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;R1&lt;/td&gt;
&lt;td&gt;Transformer (æœªä¼˜åŒ–)&lt;/td&gt;
&lt;td&gt;67 M&lt;/td&gt;
&lt;td&gt;39.2&lt;/td&gt;
&lt;td&gt;37å°æ—¶&lt;/td&gt;
&lt;td&gt;12.5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R2&lt;/td&gt;
&lt;td&gt;DeLighT(æœªä¼˜åŒ–)&lt;/td&gt;
&lt;td&gt;54 M&lt;/td&gt;
&lt;td&gt;40.5&lt;/td&gt;
&lt;td&gt;23å°æ—¶&lt;/td&gt;
&lt;td&gt;14.5&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R3&lt;/td&gt;
&lt;td&gt;Transformer (ä½¿ç”¨&lt;a href=&#34;https://github.com/NVIDIA/apex&#34;&gt;Apex&lt;/a&gt;ä¼˜åŒ–)&lt;/td&gt;
&lt;td&gt;67 M&lt;/td&gt;
&lt;td&gt;39.2&lt;/td&gt;
&lt;td&gt;16å°æ—¶&lt;/td&gt;
&lt;td&gt;11.9&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R4&lt;/td&gt;
&lt;td&gt;DeLighT(ä½¿ç”¨ä¼˜åŒ–çš„åˆ†ç»„)&lt;/td&gt;
&lt;td&gt;54 M&lt;/td&gt;
&lt;td&gt;40.5&lt;/td&gt;
&lt;td&gt;19å°æ—¶&lt;/td&gt;
&lt;td&gt;11.5&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;em&gt;è¡¨5ï¼šä¸åŸºçº¿Transformeråœ¨è®­ç»ƒé€Ÿåº¦å’Œå†…å­˜æ¶ˆè€—æ–¹é¢çš„æ¯”è¾ƒã€‚åœ¨R4ä¸­ï¼Œæˆ‘ä»¬ä»…ä¸ºåˆ†ç»„å’Œå–æ¶ˆåˆ†ç»„åŠŸèƒ½å®ç°äº†CUDAå†…æ ¸ï¼ˆè§é™„å½•Eï¼‰ã€‚æˆ‘ä»¬é¢„è®¡DeLighTå°†æ›´æœ‰æ•ˆç‡ï¼Œå› ä¸ºå®ƒæœ‰ä¸€ä¸ªä¸“ç”¨çš„CUDAå†…æ ¸ç”¨äºåˆ†ç»„ã€è½¬æ¢ã€ç‰¹å¾æ´—ç‰Œå’Œå–æ¶ˆåˆ†ç»„ã€‚å†…å­˜æ¶ˆè€—æ˜¯åœ¨ä¸€å°å•ä¸ªçš„NVIDIA GP100 GPUï¼ˆ16GBå†…å­˜ï¼‰ä¸Šæµ‹é‡çš„ï¼Œæ¯ä¸ªæ‰¹æ¬¡æœ€å¤šæœ‰4096ä¸ªæ ‡è®°ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•æ¢¯åº¦ç§¯ç´¯ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;æ­£åˆ™åŒ–&lt;/strong&gt;ï¼šè¡¨6æ˜¾ç¤ºï¼ŒDeLighTåœ¨å‚æ•°æ•°é‡è¾ƒå°‘çš„æƒ…å†µä¸‹ï¼Œä¸åŸºçº¿Transformerç›¸æ¯”ï¼Œéœ€è¦æ›´å°‘çš„æ­£åˆ™åŒ–å°±èƒ½è¾¾åˆ°ç›¸ä¼¼çš„æ€§èƒ½ã€‚è¿™è¡¨æ˜ï¼Œä½¿ç”¨æ›´å¥½çš„å˜æ¢å‡½æ•°å­¦ä¹ è¡¨ç¤ºå¯ä»¥å‡å°‘å¯¹dropoutçš„éœ€æ±‚ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Model&lt;/th&gt;
&lt;th&gt;Dropout&lt;/th&gt;
&lt;th&gt;BLEU&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Transformer (62 M)&lt;/td&gt;
&lt;td&gt;0.10&lt;/td&gt;
&lt;td&gt;27.3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Transformer (62 M)&lt;/td&gt;
&lt;td&gt;0.30&lt;/td&gt;
&lt;td&gt;27.7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;DeLighT(37 M)&lt;/td&gt;
&lt;td&gt;0.05&lt;/td&gt;
&lt;td&gt;27.6&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;em&gt;è¡¨6ï¼šä¸åŸºçº¿Transformerç›¸æ¯”ï¼ŒDeLighTéœ€è¦æ›´å°‘çš„æ­£åˆ™åŒ–ï¼ˆæ•°æ®é›†ï¼šWMT&#39;14 En-Deï¼‰&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&#34;6-ç»“è®º&#34;&gt;6 ç»“è®º&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡ä»‹ç»äº†ä¸€ç§æ·±åº¦ä¸”è½»é‡çº§çš„Transformeræ¶æ„ï¼ŒDeLighTï¼Œå®ƒåœ¨DeLighTå—å†…éƒ¨ä»¥åŠè·¨DeLighTå—æœ‰æ•ˆåœ°åˆ†é…å‚æ•°ã€‚ä¸æœ€å…ˆè¿›çš„Transformeræ¨¡å‹ç›¸æ¯”ï¼ŒDeLighTæ¨¡å‹ï¼ˆ1ï¼‰æ·±åº¦ä¸”è½»é‡çº§ï¼Œå¹¶ä¸”ï¼ˆ2ï¼‰æä¾›äº†ç›¸ä¼¼æˆ–æ›´å¥½çš„æ€§èƒ½ã€‚æœªæ¥ï¼Œæˆ‘ä»¬è®¡åˆ’å°†DeLighTåº”ç”¨äºå…¶ä»–ä»»åŠ¡ï¼ŒåŒ…æ‹¬è¯­è¨€æ¨¡å‹é¢„è®­ç»ƒã€é—®ç­”å’Œè¯­è¨€ç”Ÿæˆã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è‡´è°¢&lt;/strong&gt;ï¼šæœ¬ç ”ç©¶å¾—åˆ°äº†ONR N00014-18-1-2826ã€DARPA N6600119-2-403ã€NSF (IIS-1616112, IIS1252835)ä»¥åŠAllenæ°å‡ºç ”ç©¶è€…å¥–çš„æ”¯æŒã€‚ä½œè€…è¿˜è¦æ„Ÿè°¢åç››é¡¿å¤§å­¦UW-NLPå’ŒH2Labçš„æˆå‘˜æä¾›çš„å®è´µåé¦ˆå’Œè¯„è®ºã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒæ–‡çŒ®&#34;&gt;å‚è€ƒæ–‡çŒ®&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N. Gomez, Åukasz Kaiser, å’Œ Illia Polosukhin. &amp;ldquo;Attention is all you need.&amp;rdquo; åœ¨ã€Šç¥ç»ä¿¡æ¯å¤„ç†ç³»ç»Ÿè¿›å±•ã€‹ä¸­ï¼Œç¬¬5998â€“6008é¡µï¼Œ2017å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Colin Raffel, Noam Shazeer, Adam Roberts, Katherine Lee, Sharan Narang, Michael Matena, Yanqi Zhou, Wei Li, å’Œ Peter J. Liu. &amp;ldquo;Exploring the limits of transfer learning with a unified text-to-text transformer.&amp;rdquo; arXivé¢„å°æœ¬ arXiv:1910.10683, 2019.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Tom B. Brown, Benjamin Mann, Nick Ryder, Melanie Subbiah, Jared Kaplan, Prafulla Dhariwal, Arvind Neelakantan, Pranav Shyam, Girish Sastry, Amanda Askell, Sandhini Agarwal, Ariel Herbert-Voss, Gretchen Krueger, Tom Henighan, Rewon Child, Aditya Ramesh, Daniel M. Ziegler, Jeffrey Wu, Clemens Winter, Christopher Hesse, Mark Chen, Eric Sigler, Mateusz Litwin, Scott Gray, Benjamin Chess, Jack Clark, Christopher Berner, Sam McCandlish, Alec Radford, Ilya Sutskever, å’Œ Dario Amodei. &amp;ldquo;Language models are few-shot learners.&amp;rdquo; arXivé¢„å°æœ¬ arXiv:2005.14165, 2020.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Jacob Devlin, Ming-Wei Chang, Kenton Lee, å’Œ Kristina Toutanova. &amp;ldquo;BERT: Pre-training of deep bidirectional transformers for language understanding.&amp;rdquo; åœ¨ã€ŠåŒ—ç¾è®¡ç®—è¯­è¨€å­¦åä¼š2019å¹´ä¼šè®®è®ºæ–‡é›†ï¼šäººç±»è¯­è¨€æŠ€æœ¯ã€‹ä¸­ï¼Œç¬¬1å·ï¼ˆé•¿è®ºæ–‡å’ŒçŸ­è®ºæ–‡ï¼‰ï¼Œ2019å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Geoffrey E. Hinton, Nitish Srivastava, Alex Krizhevsky, Ilya Sutskever, å’Œ Ruslan R. Salakhutdinov. &amp;ldquo;Improving neural networks by preventing co-adaptation of feature detectors.&amp;rdquo; arXivé¢„å°æœ¬ arXiv:1207.0580, 2012.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Li Wan, Matthew Zeiler, Sixin Zhang, Yann LeCun, å’Œ Rob Fergus. &amp;ldquo;Regularization of neural networks using dropconnect.&amp;rdquo; åœ¨ã€Šå›½é™…æœºå™¨å­¦ä¹ ä¼šè®®ã€‹ä¸­ï¼Œç¬¬1058â€“1066é¡µï¼Œ2013.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Stephen Merity, Nitish Shirish Keskar, å’Œ Richard Socher. &amp;ldquo;Regularizing and optimizing LSTM language models.&amp;rdquo; åœ¨ã€Šå­¦ä¹ è¡¨ç¤ºå›½é™…ä¼šè®®ã€‹ä¸­ï¼Œ2018a. URL: &lt;a href=&#34;https://openreview.net/forum?id=SyyGPP0TZ&#34;&gt;https://openreview.net/forum?id=SyyGPP0TZ&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Sachin Mehta, Rik Koncel-Kedziorski, Mohammad Rastegari, å’Œ Hannaneh Hajishirzi. &amp;ldquo;Pyramidal recurrent unit for language modeling.&amp;rdquo; åœ¨ã€Šè‡ªç„¶è¯­è¨€å¤„ç†çš„å®è¯æ–¹æ³•ä¼šè®®ã€‹ä¸­ï¼Œ2018å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Xiangyu Zhang, Xinyu Zhou, Mengxiao Lin, å’Œ Jian Sun. &amp;ldquo;Shufflenet: An extremely efficient convolutional neural network for mobile devices.&amp;rdquo; åœ¨ã€ŠIEEEè®¡ç®—æœºè§†è§‰ä¸æ¨¡å¼è¯†åˆ«ä¼šè®®ã€‹ä¸­ï¼Œç¬¬6848â€“6856é¡µï¼Œ2018.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Zihang Dai, Zhilin Yang, Yiming Yang, Jaime Carbonell, Quoc V. Le, å’Œ Ruslan Salakhutdinov. &amp;ldquo;Transformer-xl: Attentive language models beyond a fixed-length context.&amp;rdquo; åœ¨ã€Šè®¡ç®—è¯­è¨€å­¦åä¼šã€‹ä¸­ï¼Œ2019å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Rewon Child, Scott Gray, Alec Radford, å’Œ Ilya Sutskever. &amp;ldquo;Generating long sequences with sparse transformers.&amp;rdquo; arXivé¢„å°æœ¬ arXiv:1904.10509, 2019.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Nikita Kitaev, Lukasz Kaiser, å’Œ Anselm Levskaya. &amp;ldquo;Reformer: The efficient transformer.&amp;rdquo; åœ¨ã€Šå­¦ä¹ è¡¨ç¤ºå›½é™…ä¼šè®®ã€‹ä¸­ï¼Œ2020å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Iz Beltagy, Matthew E. Peters, å’Œ Arman Cohan. &amp;ldquo;Longformer: The long-document transformer.&amp;rdquo; arXiv:2004.05150, 2020.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Alessandro Raganato å’Œ JÃ¶rg Tiedemann. &amp;ldquo;An analysis of encoder representations in transformer-based machine translation.&amp;rdquo; åœ¨ã€Š2018 EMNLP BlackboxNLP: Analyzing and Interpreting Neural Networks for NLPã€‹ç ”è®¨ä¼šè®ºæ–‡é›†ä¸­ï¼Œ2018å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Gino Brunner, Yang Liu, Damian Pascual, Oliver Richter, Massimiliano Ciaramita, å’Œ Roger Wattenhofer. &amp;ldquo;On identifiability in transformers.&amp;rdquo; åœ¨ã€Šå­¦ä¹ è¡¨ç¤ºå›½é™…ä¼šè®®ã€‹ä¸­ï¼Œ2020å¹´. URL: &lt;a href=&#34;https://openreview.net/forum?id=BJg1f6EFDB&#34;&gt;https://openreview.net/forum?id=BJg1f6EFDB&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Elena Voita, Rico Sennrich, å’Œ Ivan Titov. &amp;ldquo;The bottom-up evolution of representations in the transformer: A study with machine translation and language modeling objectives.&amp;rdquo; åœ¨ã€Š2019å¹´è‡ªç„¶è¯­è¨€å¤„ç†å’Œè®¡ç®—è¯­è¨€å­¦ç¬¬ä¹å±Šå›½é™…è”åˆä¼šè®®ï¼ˆEMNLP-IJCNLPï¼‰ã€‹è®ºæ–‡é›†ä¸­ï¼Œ2019aã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Paul Michel, Omer Levy, å’Œ Graham Neubig. &amp;ldquo;Are sixteen heads really better than one?&amp;rdquo; åœ¨ã€Šç¥ç»ä¿¡æ¯å¤„ç†ç³»ç»Ÿè¿›å±•ã€‹ä¸­ï¼Œç¬¬14014â€“14024é¡µï¼Œ2019å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Alessandro Raganato, Yves Scherrer, å’Œ JÃ¶rg Tiedemann. &amp;ldquo;Fixed encoder self-attention patterns in transformer-based machine translation.&amp;rdquo; arXivé¢„å°æœ¬ arXiv:2002.10260, 2020.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Yi Tay, Dara Bahri, Donald Metzler, Da-Cheng Juan, Zhe Zhao, å’Œ Che Zheng. &amp;ldquo;Synthesizer: Rethinking self-attention in transformer models.&amp;rdquo; arXivé¢„å°æœ¬ arXiv:2005.00743, 2020.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Felix Wu, Angela Fan, Alexei Baevski, Yann Dauphin, å’Œ Michael Auli. &amp;ldquo;Pay less attention with lightweight and dynamic convolutions.&amp;rdquo; åœ¨ã€Šå­¦ä¹ è¡¨ç¤ºå›½é™…ä¼šè®®ã€‹ä¸­ï¼Œ2019å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Zhanghao Wu, Zhijian Liu, Ji Lin, Yujun Lin, å’Œ Song Han. &amp;ldquo;Lite transformer with long-short range attention.&amp;rdquo; åœ¨ã€Šå­¦ä¹ è¡¨ç¤ºå›½é™…ä¼šè®®ã€‹ä¸­ï¼Œ2020å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;David So, Quoc Le, å’Œ Chen Liang. &amp;ldquo;The evolved transformer.&amp;rdquo; åœ¨ã€Šç¬¬36å±Šå›½é™…æœºå™¨å­¦ä¹ ä¼šè®®è®ºæ–‡é›†ã€‹ä¸­ï¼Œç¬¬5877â€“5886é¡µï¼Œ2019å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Jonas Gehring, Michael Auli, David Grangier, Denis Yarats, å’Œ Yann N. Dauphin. &amp;ldquo;Convolutional sequence to sequence learning.&amp;rdquo; åœ¨ã€Šç¬¬34å±Šå›½é™…æœºå™¨å­¦ä¹ ä¼šè®®è®ºæ–‡é›†-ç¬¬70å·ã€‹ä¸­ï¼Œç¬¬1243â€“1252é¡µã€‚JMLR. org, 2017.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Yann N. Dauphin, Angela Fan, Michael Auli, å’Œ David Grangier. &amp;ldquo;Language modeling with gated convolutional networks.&amp;rdquo; åœ¨ã€Šç¬¬34å±Šå›½é™…æœºå™¨å­¦ä¹ ä¼šè®®è®ºæ–‡é›†-ç¬¬70å·ã€‹ä¸­ï¼Œç¬¬933â€“941é¡µã€‚JMLR. org, 2017.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Zhenzhong Lan, Mingda Chen, Sebastian Goodman, Kevin Gimpel, Piyush Sharma, å’Œ Radu Soricut. &amp;ldquo;Albert: A lite bert for self-supervised learning of language representations.&amp;rdquo; åœ¨ã€Šå­¦ä¹ è¡¨ç¤ºå›½é™…ä¼šè®®ã€‹ä¸­ï¼Œ2020å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Mohammad Shoeybi, Mostofa Patwary, Raul Puri, Patrick LeGresley, Jared Casper, å’Œ Bryan Catanzaro. &amp;ldquo;Megatron-lm: Training multi-billion parameter language models using gpu model parallelism.&amp;rdquo; arXivé¢„å°æœ¬ arXiv:1909.08053, 2019.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Mingxing Tan å’Œ Quoc V. Le. &amp;ldquo;Efficientnet: Rethinking model scaling for convolutional neural networks.&amp;rdquo; åœ¨Kamalika Chaudhuriå’ŒRuslan Salakhutdinovç¼–è¾‘çš„ã€Šç¬¬36å±Šå›½é™…æœºå™¨å­¦ä¹ ä¼šè®®è®ºæ–‡é›†ã€‹ä¸­ï¼Œç¬¬9-15é¡µï¼Œ2019å¹´6æœˆ9-15æ—¥ï¼ŒåŠ åˆ©ç¦å°¼äºšå·é•¿æ»©ï¼Œç¾å›½ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Qiang Wang, Bei Li, Tong Xiao, Jingbo Zhu, Changliang Li, Derek F. Wong, å’Œ Lidia S. Chao. &amp;ldquo;Learning deep transformer models for machine translation.&amp;rdquo; åœ¨ã€Šç¬¬57å±Šè®¡ç®—è¯­è¨€å­¦åä¼šå¹´ä¼šè®ºæ–‡é›†ã€‹ä¸­ï¼Œ2019å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kaiming He, Xiangyu Zhang, Shaoqing Ren, å’Œ Jian Sun. &amp;ldquo;Deep residual learning for image recognition.&amp;rdquo; åœ¨ã€ŠIEEEè®¡ç®—æœºè§†è§‰ä¸æ¨¡å¼è¯†åˆ«ä¼šè®®ã€‹ä¸­ï¼Œç¬¬770â€“778é¡µï¼Œ2016å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Rico Sennrich, Barry Haddow, å’Œ Alexandra Birch. &amp;ldquo;Neural machine translation of rare words with subword units.&amp;rdquo; åœ¨ã€Šç¬¬54å±Šè®¡ç®—è¯­è¨€å­¦åä¼šå¹´ä¼šè®ºæ–‡é›†ã€‹ç¬¬1å·ï¼ˆé•¿è®ºæ–‡ï¼‰ä¸­ï¼Œ8æœˆ2016å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Alexei Baevski å’Œ Michael Auli. &amp;ldquo;Adaptive input representations for neural language modeling.&amp;rdquo; åœ¨ã€Šå­¦ä¹ è¡¨ç¤ºå›½é™…ä¼šè®®ã€‹ä¸­ï¼Œ2019å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Ã‰douard Grave, Armand Joulin, Moustapha CissÃ©, David Grangier, å’Œ HervÃ© JÃ©gou. &amp;ldquo;Efficient softmax approximation for GPUs.&amp;rdquo; åœ¨ã€Šå›½é™…æœºå™¨å­¦ä¹ ä¼šè®®ã€‹ä¸­ï¼Œ2017aã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Sachin Mehta, Rik Koncel-Kedziorski, Mohammad Rastegari, å’Œ Hannaneh Hajishirzi. &amp;ldquo;DeFINE: Deep Factorized Input Token Embeddings for Neural Sequence Modeling.&amp;rdquo; åœ¨ã€Šå­¦ä¹ è¡¨ç¤ºå›½é™…ä¼šè®®ã€‹ä¸­ï¼Œ2020å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Patrick Chen, Si Si, Yang Li, Ciprian Chelba, å’Œ Cho-Jui Hsieh. &amp;ldquo;Groupreduce: Block-wise low-rank approximation for neural language model shrinking.&amp;rdquo; åœ¨ã€Šç¥ç»ä¿¡æ¯å¤„ç†ç³»ç»Ÿè¿›å±•ã€‹ä¸­ï¼Œ2018å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Zhiqing Sun, Hongkun Yu, Xiaodan Song, Renjie Liu, Yiming Yang, å’Œ Denny Zhou. &amp;ldquo;Mobilebert: a compact task-agnostic bert for resource-limited devices.&amp;rdquo; åœ¨ã€Šè®¡ç®—è¯­è¨€å­¦åä¼šï¼ˆACLï¼‰ã€‹ä¸­ï¼Œ2020å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Song Han, Huizi Mao, å’Œ William J. Dally. &amp;ldquo;Deep compression: Compressing deep neural networks with pruning, trained quantization and huffman coding.&amp;rdquo; åœ¨ã€Šè¡¨ç¤ºå­¦ä¹ å›½é™…ä¼šè®®ã€‹ä¸­ï¼Œ2016å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Elena Voita, David Talbot, Fedor Moiseev, Rico Sennrich, å’Œ Ivan Titov. &amp;ldquo;Analyzing multi-head self-attention: Specialized heads do the heavy lifting, the rest can be pruned.&amp;rdquo; åœ¨ã€Šç¬¬57å±Šè®¡ç®—è¯­è¨€å­¦åä¼šå¹´ä¼šè®ºæ–‡é›†ã€‹ä¸­ï¼Œ2019bã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Geoffrey Hinton, Oriol Vinyals, å’Œ Jeff Dean. &amp;ldquo;Distilling the knowledge in a neural network.&amp;rdquo; åœ¨NIPSæ·±åº¦å­¦ä¹ å’Œè¡¨ç¤ºå­¦ä¹ ç ”è®¨ä¼šä¸­ï¼Œ2015ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Victor Sanh, Lysandre Debut, Julien Chaumond, å’Œ Thomas Wolf. &amp;ldquo;Distilbert, a distilled version of bert: smaller, faster, cheaper and lighter.&amp;rdquo; åœ¨ç¬¬5å±Šèƒ½æºæ•ˆç‡æœºå™¨å­¦ä¹ ä¸è®¤çŸ¥è®¡ç®—NeurIPSç ”è®¨ä¼šä¸­ï¼Œ2019ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Matus Telgarsky. &amp;ldquo;Benefits of depth in neural networks.&amp;rdquo; COLT, 2016.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Sergey Edunov, Myle Ott, Michael Auli, David Grangier, å’Œ Marcâ€™Aurelio Ranzato. &amp;ldquo;Classical structured prediction losses for sequence to sequence learning.&amp;rdquo; åœ¨ã€ŠåŒ—ç¾è®¡ç®—è¯­è¨€å­¦åä¼š2018å¹´ä¼šè®®è®ºæ–‡é›†ï¼šäººç±»è¯­è¨€æŠ€æœ¯ã€‹ç¬¬1å·ï¼ˆé•¿è®ºæ–‡ï¼‰ä¸­ï¼Œ2018å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Ashish Vaswani, Samy Bengio, Eugene Brevdo, Francois Chollet, Aidan N. Gomez, Stephan Gouws, Llion Jones, Åukasz Kaiser, Nal Kalchbrenner, Niki Parmar, Ryan Sepassi, Noam Shazeer, å’Œ Jakob Uszkoreit. &amp;ldquo;Tensor2tensor for neural machine translation.&amp;rdquo; CoRR, abs/1803.07416, 2018. URL: &lt;a href=&#34;http://arxiv.org/abs/1803.07416&#34;&gt;http://arxiv.org/abs/1803.07416&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kishore Papineni, Salim Roukos, Todd Ward, å’Œ Wei-Jing Zhu. &amp;ldquo;BLEU: a method for automatic evaluation of machine translation.&amp;rdquo; åœ¨è®¡ç®—è¯­è¨€å­¦åä¼šç¬¬40å±Šå¹´ä¼šè®ºæ–‡é›†ä¸­ï¼Œç¬¬311â€“318é¡µï¼Œè®¡ç®—è¯­è¨€å­¦åä¼šï¼Œ2002ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Myle Ott, Sergey Edunov, Alexei Baevski, Angela Fan, Sam Gross, Nathan Ng, David Grangier, å’Œ Michael Auli. &amp;ldquo;Fairseq: A fast, extensible toolkit for sequence modeling.&amp;rdquo; åœ¨NAACL-HLT 2019: Demonstrationsä¼šè®®è®ºæ–‡é›†ä¸­ï¼Œ2019å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Marjan Ghazvininejad, Omer Levy, Yinhan Liu, å’Œ Luke Zettlemoyer. &amp;ldquo;Mask-predict: Parallel decoding of conditional masked language models.&amp;rdquo; åœ¨2019å¹´è‡ªç„¶è¯­è¨€å¤„ç†å’Œè®¡ç®—è¯­è¨€å­¦ç¬¬ä¹å±Šå›½é™…è”åˆä¼šè®®ï¼ˆEMNLP-IJCNLPï¼‰è®ºæ–‡é›†ä¸­ï¼Œç¬¬6114â€“6123é¡µï¼Œ2019å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Diederik P. Kingma å’Œ Jimmy Ba. &amp;ldquo;Adam: A method for stochastic optimization.&amp;rdquo; åœ¨å­¦ä¹ è¡¨ç¤ºå›½é™…ä¼šè®®ä¸­ï¼Œ2015å¹´ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;é™„å½•a-delightæ¶æ„ç”¨äºè¯­è¨€å»ºæ¨¡å’Œæœºå™¨ç¿»è¯‘&#34;&gt;&lt;strong&gt;é™„å½•A DeLighTæ¶æ„ç”¨äºè¯­è¨€å»ºæ¨¡å’Œæœºå™¨ç¿»è¯‘&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;DeLighTæ¶æ„ç”¨äºè¯­è¨€å»ºæ¨¡å’Œæœºå™¨ç¿»è¯‘çš„ç¤ºæ„å›¾å±•ç¤ºåœ¨å›¾6ä¸­ã€‚å¯¹äºè¯­è¨€å»ºæ¨¡ï¼Œæˆ‘ä»¬éµå¾ªäº†Baevskiå’ŒAuliï¼ˆ2019ï¼‰çš„æ¶æ„ï¼›è€Œå¯¹äºæœºå™¨ç¿»è¯‘ï¼Œæˆ‘ä»¬éµå¾ªäº†Vaswaniç­‰äººï¼ˆ2017ï¼‰çš„æ¶æ„ã€‚&lt;/p&gt;
&lt;p&gt;**è¯­è¨€å»ºæ¨¡ï¼š**å›¾6aå±•ç¤ºäº†è¯­è¨€å»ºæ¨¡çš„æ¶æ„ã€‚è¯¥æ¶æ„å †å äº†$\mathcal{B}$ä¸ªDeLighTå—ï¼Œæ¯ä¸ªå—çš„é…ç½®æ˜¯ä½¿ç”¨å—çº§ç¼©æ”¾ç¡®å®šçš„ã€‚æ¯ä¸ªå—æœ‰ä¸‰ä¸ªå­å±‚ã€‚ç¬¬ä¸€å±‚æ˜¯DeLighTå˜æ¢ï¼Œå®ƒåœ¨é«˜ç»´ç©ºé—´ä¸­å­¦ä¹ è¡¨ç¤ºã€‚ç¬¬äºŒå±‚æ˜¯å•å¤´æ³¨æ„åŠ›ï¼Œå®ƒç¼–ç ä¸Šä¸‹æ–‡å…³ç³»ã€‚ç¬¬ä¸‰å±‚æ˜¯ä½ç½®æ„ŸçŸ¥çš„è½»é‡çº§å‰é¦ˆç½‘ç»œã€‚ä¸Vaswaniç­‰äººï¼ˆ2017ï¼‰ç›¸ä¼¼ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†æ®‹å·®è¿æ¥ï¼ˆHeç­‰äººï¼Œ2016ï¼‰ã€‚ä¸å…ˆå‰çš„å·¥ä½œï¼ˆBaevskiå’ŒAuliï¼Œ2019ï¼›Daiç­‰äººï¼Œ2019ï¼‰ä¸€æ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨ç»‘å®šçš„è‡ªé€‚åº”è¾“å…¥ï¼ˆBaevskiå’ŒAuliï¼Œ2019ï¼‰å’Œè‡ªé€‚åº”softmaxï¼ˆGraveç­‰äººï¼Œ2017aï¼‰å°†Tokenæ˜ å°„åˆ°å‘é‡å’Œå°†å‘é‡æ˜ å°„åˆ°Tokenã€‚&lt;/p&gt;
&lt;p&gt;**æœºå™¨ç¿»è¯‘ï¼š**å›¾6bå±•ç¤ºäº†æœºå™¨ç¿»è¯‘çš„æ¶æ„ã€‚ç¼–ç å™¨å †å äº†Bä¸ªDeLighTå—ï¼Œæ¯ä¸ªå—çš„é…ç½®ä¹Ÿæ˜¯ä½¿ç”¨å—çº§ç¼©æ”¾ç¡®å®šçš„ã€‚ä¸è¯­è¨€å»ºæ¨¡ç±»ä¼¼ï¼Œæ¯ä¸ªç¼–ç å™¨å—ä¹Ÿæœ‰ä¸‰ä¸ªå­å±‚ã€‚ç¬¬ä¸€å±‚æ˜¯DeLighTå˜æ¢ï¼Œå®ƒåœ¨é«˜ç»´ç©ºé—´ä¸­å­¦ä¹ è¡¨ç¤ºã€‚ç¬¬äºŒå±‚æ˜¯å•å¤´æ³¨æ„åŠ›ï¼Œå®ƒç¼–ç ä¸Šä¸‹æ–‡å…³ç³»ã€‚ç¬¬ä¸‰å±‚æ˜¯ä½ç½®æ„ŸçŸ¥çš„è½»é‡çº§å‰é¦ˆç½‘ç»œã€‚ä¸Vaswaniç­‰äººï¼ˆ2017ï¼‰ç›¸ä¼¼ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†æ®‹å·®è¿æ¥ï¼ˆHeç­‰äººï¼Œ2016ï¼‰ã€‚æˆ‘ä»¬ä½¿ç”¨å¯å­¦ä¹ çš„æŸ¥æ‰¾è¡¨å°†Tokenæ˜ å°„ä¸ºå‘é‡ã€‚ä¸ç¼–ç å™¨ç±»ä¼¼ï¼Œè§£ç å™¨ä¹Ÿå †å äº†$\mathcal{B}$ä¸ªå—ã€‚è§£ç å™¨å—ä¸ç¼–ç å™¨å—ç›¸åŒï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒä»¬åœ¨è½»é‡çº§FFNä¹‹å‰æœ‰ä¸€ä¸ªé¢å¤–çš„æº-ç›®æ ‡å•å¤´æ³¨æ„åŠ›å•å…ƒã€‚æº-ç›®æ ‡å•å¤´æ³¨æ„åŠ›å•å…ƒä¸­çš„é”®å’Œå€¼æ˜¯å¯¹ç¼–ç å™¨è¾“å‡ºçš„æŠ•å½±ã€‚æˆ‘ä»¬ä½¿ç”¨æ ‡å‡†çš„å¯å­¦ä¹ æŸ¥æ‰¾è¡¨å°†Tokenæ˜ å°„ä¸ºå‘é‡ï¼Œå¹¶ä½¿ç”¨çº¿æ€§åˆ†ç±»å±‚å°†å‘é‡æ˜ å°„ä¸ºTokenã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/paper/transformer/DeLighT/7.png&#34; alt=&#34;image-20240428195422419&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾6ï¼šä½¿ç”¨DeLighTè¿›è¡Œåºåˆ—å»ºæ¨¡ã€‚è¿™é‡Œï¼Œç»¿è‰²å…­è¾¹å½¢ä»£è¡¨äº†DeLighTè½¬æ¢ã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;é™„å½•b-å¸¦æœ‰è¾“å…¥æ··åˆå™¨è¿æ¥çš„ç»„çº¿æ€§å˜æ¢&#34;&gt;&lt;strong&gt;é™„å½•B å¸¦æœ‰è¾“å…¥æ··åˆå™¨è¿æ¥çš„ç»„çº¿æ€§å˜æ¢&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;ç»„çº¿æ€§è½¬æ¢ï¼ˆgroup linear transformation GLTï¼‰$\mathcal{F}$ å°†ä¸€ä¸ª $d_m$ ç»´è¾“å…¥ $\mathbf{X}$ åˆ†æˆ $g$ ä¸ªä¸é‡å çš„ç»„ï¼Œä½¿å¾— $\mathbf{X} = \text{Concat}(\mathbf{X}_1, \cdots, \mathbf{X}_g)$ï¼Œå…¶ä¸­ $\mathbf{X}_i$ æ˜¯ä¸€ä¸ª $\frac{d_m}{g}$ ç»´çš„å‘é‡ã€‚ç„¶åï¼Œä½¿ç”¨ $g$ ä¸ªçº¿æ€§å˜æ¢ $\mathbf{W}_i \in \mathbf{R}^{\frac{d_m}{g} \times \frac{d_o}{g}}$ åŒæ—¶å¯¹ $\mathbf{X}_i$ è¿›è¡Œå˜æ¢ï¼Œå¾—åˆ° $g$ ä¸ªè¾“å‡º $\mathbf{Y}_i = \mathbf{X}_i \mathbf{W}_i$ã€‚ç„¶åï¼Œå°† $\mathbf{Y}_i$ è¿›è¡Œä¸²è”ä»¥äº§ç”Ÿæœ€ç»ˆçš„ $d_o$ ç»´è¾“å‡º $\mathbf{Y} = \text{Concat}(\mathbf{Y}_1, \cdots, \mathbf{Y}_g)$ã€‚&lt;/p&gt;
&lt;p&gt;å›¾7aå±•ç¤ºäº†DeLighTå˜æ¢æ‰©å±•é˜¶æ®µä¸­GLTçš„ä¸€ä¸ªä¾‹å­ã€‚ä¸ºäº†è¯´æ˜ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨äº†ç›¸åŒçš„ç»´åº¦ã€‚å›æƒ³ä¸€ä¸‹ï¼Œå½“æˆ‘ä»¬åœ¨æ‰©å±•é˜¶æ®µæ·±å…¥æ—¶ï¼Œç»„çš„æ•°é‡ä¼šå¢åŠ ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€å±‚æœ‰ä¸€ç»„ï¼Œç¬¬äºŒå±‚æœ‰ä¸¤ç»„ï¼Œç¬¬ä¸‰å±‚æœ‰å››ç»„ã€‚GLTå­¦ä¹ ç‰¹å®šäºç»„çš„è¡¨ç¤ºï¼Œå¹¶ä¸”æ˜¯å±€éƒ¨çš„ã€‚ä¸ºäº†å…è®¸GLTå­¦ä¹ å…¨å±€è¡¨ç¤ºï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ç‰¹å¾æ´—ç‰Œã€‚å›¾7bå±•ç¤ºäº†å¸¦æœ‰ç‰¹å¾æ´—ç‰Œçš„GLTçš„ä¸€ä¸ªä¾‹å­ã€‚æ­¤å¤–ï¼Œä»…é€šè¿‡å †å çº¿æ€§æˆ–ç»„çº¿æ€§ï¼ˆæ— è®ºæ˜¯å¦å¸¦æœ‰ç‰¹å¾æ´—ç‰Œï¼‰æ¥è®­ç»ƒæ·±åº¦ç¥ç»ç½‘ç»œæ˜¯å…·æœ‰æŒ‘æˆ˜æ€§çš„ï¼Œå› ä¸ºæ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚Heç­‰äººï¼ˆ2016ï¼‰å¼•å…¥çš„æ®‹å·®è¿æ¥ç¼“è§£äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶æœ‰åŠ©äºè®­ç»ƒæ·±åº¦ç¥ç»ç½‘ç»œã€‚ç„¶è€Œï¼Œå½“è¾“å…¥å’Œè¾“å‡ºç»´åº¦ä¸åŒæ—¶ï¼ˆä¾‹å¦‚ï¼Œåœ¨DeLighTå˜æ¢çš„æ‰©å±•å’Œç¼©å‡é˜¶æ®µï¼‰ï¼Œå°±ä¸èƒ½ä½¿ç”¨è¿™æ ·çš„è¿æ¥ã€‚ä¸ºäº†ç¨³å®šè®­ç»ƒå¹¶å­¦ä¹ æ›´æ·±å±‚æ¬¡çš„è¡¨ç¤ºï¼Œæˆ‘ä»¬ä½¿ç”¨äº†Mehtaç­‰äººï¼ˆ2020ï¼‰çš„è¾“å…¥æ··åˆå™¨è¿æ¥ã€‚å›¾7cå±•ç¤ºäº†å¸¦æœ‰ç‰¹å¾æ´—ç‰Œå’Œè¾“å…¥æ··åˆå™¨è¿æ¥çš„GLTçš„ä¸€ä¸ªä¾‹å­ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/paper/transformer/DeLighT/8.png&#34; alt=&#34;image-20240428195422419&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾ 7ï¼šæœ¬å›¾å±•ç¤ºäº†DeLighTè½¬æ¢ä¸­ä½¿ç”¨çš„ä¸åŒå˜ä½“çš„ç»„çº¿æ€§è½¬æ¢(group linear transformations GLTs)ã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;é™„å½•c-delightä¸­çš„ä¹˜åŠ æ“ä½œ&#34;&gt;&lt;strong&gt;é™„å½•C DeLighTä¸­çš„ä¹˜åŠ æ“ä½œ&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;DeLighTå—æ˜¯ä½¿ç”¨çº¿æ€§å˜æ¢ã€ç»„çº¿æ€§å˜æ¢ï¼ˆGLTsï¼‰å’Œç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›æ„å»ºçš„ã€‚ç½‘ç»œä¸­çš„æ€»ä¹˜åŠ æ“ä½œï¼ˆMACsï¼‰æ•°é‡æ˜¯è¿™äº›å•ç‹¬æ“ä½œçš„ç´¯ç§¯ã€‚&lt;/p&gt;
&lt;p&gt;è®© $n$ è¡¨ç¤ºæºtokençš„æ•°é‡ï¼Œ$m$ è¡¨ç¤ºç›®æ ‡tokençš„æ•°é‡ï¼Œ$d_m$ è¡¨ç¤ºè¾“å…¥ç»´åº¦ï¼Œ$d_o$ è¡¨ç¤ºè¾“å‡ºç»´åº¦ï¼Œ$g$ è¡¨ç¤º GLT ä¸­çš„ç»„æ•°ã€‚ä¸‹é¢æè¿°äº†æ¯ä¸ªæ“ä½œè®¡ç®— MAC æ•°çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç»„çº¿æ€§å˜æ¢ï¼ˆGLTï¼‰&lt;/strong&gt;ï¼šGLT $\mathcal{F}$ æœ‰ $g$ ä¸ªå¯å­¦ä¹ çŸ©é˜µ $\mathbf{W}_i \in \mathbf{R}^{\frac{d_m}{g} \times \frac{d_o}{g}}$ã€‚å› æ­¤ï¼ŒGLT å­¦ä¹ äº† $\frac{d_md_o}{g}$ ä¸ªå‚æ•°ï¼Œå¹¶æ‰§è¡Œäº† $\frac{d_md_o}{g}$ ä¸ª MAC æ“ä½œï¼Œå°† $d_m$ ç»´è¾“å…¥è½¬æ¢ä¸º $d_o$ ç»´è¾“å‡ºã€‚éµå¾ªæ ‡å‡†åšæ³•ï¼Œä¾‹å¦‚ Heç­‰äººï¼ˆ2016ï¼‰çš„ ResNetï¼Œæˆ‘ä»¬å°†åŠ æ³•å’Œä¹˜æ³•è§†ä¸ºä¸€æ¬¡æ“ä½œè€Œä¸æ˜¯ä¸¤æ¬¡æ“ä½œï¼Œå› ä¸ºè¿™äº›æ“ä½œå¯ä»¥åœ¨æœ€æ–°çš„ç¡¬ä»¶ä¸­èåˆã€‚&lt;/p&gt;
&lt;p&gt;é‡è¦çš„æ˜¯ï¼Œå½“ $g=1$ æ—¶ï¼ŒGLT ä¸çº¿æ€§å˜æ¢ç›¸åŒã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DeLighTä¸­çš„è‡ªæ³¨æ„åŠ›&lt;/strong&gt;ï¼šDeLighTä¸­çš„ç¼©æ”¾ç‚¹ç§¯è‡ªæ³¨æ„åŠ›å®šä¹‰ä¸ºï¼š
$$
\begin{equation}
\text{Attention}(\mathbf{K}, \mathbf{Q}, \mathbf{V}) = \text{softmax}\left(\frac{\mathbf{Q}\mathbf{K}^T}{\sqrt{d_o}}\right) \mathbf{V}
\end{equation}
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­$\mathbf{Q} \in \mathbb{R}^{n \times d_o}$, $\mathbf{K} \in \mathbb{R}^{n \times d_o}$, $\mathbf{V} \in \mathbb{R}^{n \times d_o}$åˆ†åˆ«è¡¨ç¤ºæŸ¥è¯¢ã€é”®å’Œå€¼ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„æœºåˆ¶æ¶‰åŠä¸¤ä¸ªç‚¹ç§¯ã€‚ç¬¬ä¸€ä¸ªç‚¹ç§¯æ˜¯åœ¨ $\mathbf{Q}$ å’Œ $\mathbf{K}$ ä¹‹é—´è¿›è¡Œçš„ï¼Œè€Œç¬¬äºŒä¸ªç‚¹ç§¯æ˜¯åœ¨ç¬¬ä¸€ä¸ªç‚¹ç§¯çš„è¾“å‡ºå’Œ $\mathbf{V}$ ä¹‹é—´è¿›è¡Œçš„ã€‚ä¸¤ä¸ªç‚¹ç§¯éƒ½éœ€è¦ $d_on^2$ ä¸ªä¹˜åŠ æ“ä½œï¼ˆMACsï¼‰ã€‚å› æ­¤ï¼Œè®¡ç®—ç¼©æ”¾ç‚¹ç§¯è‡ªæ³¨æ„åŠ›çš„æ€»MACæ•°é‡ä¸º $2d_on^2$ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æº-ç›®æ ‡æ³¨æ„åŠ›ä¸­ï¼ˆæ¯”å¦‚åœ¨æœºå™¨ç¿»è¯‘ä¸­ï¼‰ï¼Œ$\mathbf{K}$ å’Œ $\mathbf{V}$ æ¥è‡ªæºï¼ˆç¼–ç å™¨ï¼‰ï¼Œè€Œ $\mathbf{Q}$ é€æ­¥è§£ç ï¼ˆä¸€æ¬¡ä¸€ä¸ªä»¤ç‰Œï¼‰ã€‚å› æ­¤ï¼Œç»™å®š $n$ ä¸ªæºä»¤ç‰Œï¼Œè§£ç  $m$ ä¸ªç›®æ ‡ä»¤ç‰Œæ‰€éœ€çš„MACæ•°é‡ä¸º $\sum\limits_{k=1}^{m} 2knd_o$&lt;/p&gt;
&lt;h2 id=&#34;é™„å½•d-wikitext-103-æ•°æ®é›†çš„æ¶ˆèablationç ”ç©¶&#34;&gt;&lt;strong&gt;é™„å½•D WikiText-103 æ•°æ®é›†çš„æ¶ˆè(ablation)ç ”ç©¶&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;è¡¨7 ç ”ç©¶äº† WikiText-103 æ•°æ®é›†ä¸Š DeLighTå—å‚æ•°çš„å½±å“ï¼Œå³ (1) GLT çš„æœ€å°æ•°é‡ $N_{min}$ï¼Œ(2) GLT çš„æœ€å¤§æ•°é‡ $N_{max}$ï¼Œ(3) å®½åº¦å€å¢å™¨ $w_m$ï¼Œä»¥åŠ (4) æ¨¡å‹ç»´åº¦ $d_m$ï¼ˆè§å›¾ 1bï¼‰ã€‚å›¾8ã€å›¾9 å’Œå›¾10 æ˜¾ç¤ºäº†DeLighTã€ç‰¹å¾æ´—ç‰Œå’Œè½»é‡çº§ FFN çš„å½±å“ã€‚è¡¨ 8 æ˜¾ç¤ºäº†DeLighTåœ¨ DeLighTå—ä¸­ä½ç½®çš„å½±å“ï¼Œè€Œå›¾12 æ˜¾ç¤ºäº†ç¼©æ”¾ DeLighTç½‘ç»œçš„æ•ˆæœã€‚æˆ‘ä»¬é€‰æ‹©äº† WikiText-103 æ•°æ®é›†è¿›è¡Œæ¶ˆèç ”ç©¶ï¼Œå› ä¸ºä¸å…¶ä»–æ•°æ®é›†ç›¸æ¯”ï¼Œå®ƒçš„è¯æ±‡é‡éå¸¸å¤§ï¼ˆ267K å¯¹æ¯” 30-40Kï¼‰ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿæµ‹è¯•åœ¨å¤§è¯æ±‡é‡çš„æƒ…å†µä¸‹çš„èƒ½åŠ›ã€‚æ€§èƒ½ä»¥éªŒè¯é›†ä¸Šçš„å›°æƒ‘åº¦ï¼ˆè¶Šä½è¶Šå¥½ï¼‰æ¥æŠ¥å‘Šã€‚åœ¨æˆ‘ä»¬çš„æ¶ˆè(ablation)ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸ç¬¬ 4.2 èŠ‚ç›¸åŒçš„è®­ç»ƒè®¾ç½®ï¼Œåªæ˜¯æˆ‘ä»¬åªè®­ç»ƒäº† 50K æ¬¡è¿­ä»£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DeLighT å—&lt;/strong&gt;ï¼šæ€»çš„æ¥è¯´ï¼Œè¡¨7 æ˜¾ç¤ºäº†ä½¿ç”¨DeLighTå’Œå—çº§ç¼©æ”¾(block-wise scaling)æ¥ç¼©æ”¾æ·±åº¦å’Œå®½åº¦çš„æ•ˆæœã€‚æˆ‘ä»¬å¾—å‡ºä»¥ä¸‹è§‚å¯Ÿç»“æœï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å—çº§ç¼©æ”¾ï¼ˆR4ï¼ŒR5ï¼‰ç›¸æ¯”ç»Ÿä¸€ç¼©æ”¾ï¼ˆR1-R3ï¼‰æä¾›äº†æ›´å¥½çš„æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œå…·æœ‰ $N_{min}=4$ å’Œ $N_{max}=8$ çš„ DeLighTï¼ˆR4ï¼‰æ¯”å…·æœ‰ $N_{min}=8$ å’Œ $N_{max}=8$ çš„ DeLighTæ›´æµ… $1.25\times$ï¼Œä½†æ€§èƒ½æ›´å¥½ï¼Œè€Œä¸”å‚æ•°å’Œæ“ä½œæ•°é‡ç›¸ä¼¼ã€‚ç¼©æ”¾ $w_m$ å¯ä»¥æé«˜æ€§èƒ½ï¼ˆR2 vs. R3ï¼‰ï¼Œä½†æ”¹è¿›å¹…åº¦æ˜æ˜¾ä½äºå—çº§ç¼©æ”¾æ¨¡å‹ï¼ˆR3 vs. R5ï¼‰ã€‚è¿™è¡¨æ˜è·¨å—çš„å‚æ•°çš„éå‡åŒ€åˆ†å¸ƒä½¿ç½‘ç»œèƒ½å¤Ÿå­¦ä¹ æ›´å¥½çš„è¡¨ç¤ºã€‚&lt;/li&gt;
&lt;li&gt;ä¸åŒçš„ $N_{max}$ å’Œ $N_{min}$ ä¹‹é—´çš„æ¯”ç‡äº§ç”Ÿä¸åŒçš„ç»“æœã€‚å½“æ¯”ç‡å¤§äºæˆ–ç­‰äºä¸¤å€æ—¶ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°æ€§èƒ½æ˜¾è‘—æå‡ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬å°† $\frac{N_{max}}{N_{min}}$ ä» 2 ç¼©æ”¾åˆ° 3 æ—¶ï¼ˆR6 vs. R8ï¼‰ï¼Œå›°æƒ‘åº¦æé«˜äº†çº¦ 5 ä¸ªç‚¹ï¼Œè€Œç½‘ç»œå‚æ•°ä»…é€‚åº¦å¢åŠ ã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ $\frac{N_{max}}{N_{min}}$ æ¥è¿‘ 1 æ—¶ï¼ˆR6 vs. R7ï¼‰ï¼Œæ€§èƒ½å˜åŒ–ä¸æ˜æ˜¾ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºè·¨å—çš„å‚æ•°åˆ†é…æ¥è¿‘äºå‡åŒ€ï¼ˆEq. \ref{eq:mw}ï¼‰ã€‚è¿™ä¸æˆ‘ä»¬ä¹‹å‰çš„è§‚å¯Ÿä¸€è‡´ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨è¾“å…¥é™„è¿‘å­¦ä¹ æ›´æ·±æ›´å®½çš„è¡¨ç¤ºï¼Œä»¥åŠåœ¨è¾“å‡ºé™„è¿‘å­¦ä¹ æ›´æµ…æ›´çª„çš„è¡¨ç¤ºï¼Œå¯ä»¥å®ç°æ›´å¥½çš„æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬å°† $N_{max}$ ä» 8 ç¼©æ”¾åˆ° 12 å¹¶ä¸” $N_{min}=4$ æ—¶ï¼ˆR6ï¼ŒR8ï¼‰ï¼Œä¸å…·æœ‰ $N_{min}=6$ çš„æ¨¡å‹ç›¸æ¯”ï¼ŒDeLighTä»¥ç›¸ä¼¼æ•°é‡çš„å‚æ•°äº¤ä»˜äº†æ›´å¥½çš„æ€§èƒ½ï¼ˆR7ï¼ŒR9ï¼‰ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºå½“ $N_{min}=4$ æ—¶ï¼Œ$N_{max}$ å’Œ $N_{min}$ çš„æ¯”ç‡è¾ƒé«˜ï¼Œæœ‰åŠ©äºæ›´æœ‰æ•ˆåœ°åˆ†é…æ¯ä¸ªå—çš„å‚æ•°ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨è¾“å…¥é™„è¿‘å­¦ä¹ æ›´æ·±æ›´å®½çš„è¡¨ç¤ºï¼Œè€Œåœ¨è¾“å‡ºé™„è¿‘å­¦ä¹ æ›´æµ…æ›´çª„çš„è¡¨ç¤ºä¼šæŸå®³æ€§èƒ½ï¼ˆR13 vs. R16ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ $w_m$ å’Œ $d_m$ ç¼©æ”¾å®½åº¦å¯ä»¥æé«˜æ€§èƒ½ï¼ˆR10-R15ï¼‰ï¼Œä½†å®ƒä»¬çš„å½±å“æ˜¯ä¸åŒçš„ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬å°† $w_m$ å’Œ $d_m$ ç¼©æ”¾ä¸¤å€æ—¶ï¼Œä¸ $w_m$ ç›¸æ¯”ï¼Œå‚æ•°å’Œæ“ä½œæ•°é‡çš„å¢åŠ é€Ÿåº¦æ›´å¿«ã€‚ DeLighTä»¥ä¸åŒçš„æ–¹å¼å­¦ä¹ æ›´å®½çš„è¡¨ç¤ºå¯èƒ½åœ¨é€‰æ‹©åº”ç”¨ç¨‹åºç‰¹å®šæ¨¡å‹æ—¶å¾ˆæœ‰ç”¨ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Row #&lt;/th&gt;
&lt;th&gt;$N_{min}$&lt;/th&gt;
&lt;th&gt;$N_{max}$&lt;/th&gt;
&lt;th&gt;$w_m$&lt;/th&gt;
&lt;th&gt;$d_m$&lt;/th&gt;
&lt;th&gt;Depth&lt;/th&gt;
&lt;th&gt;Parameters&lt;/th&gt;
&lt;th&gt;MACs&lt;/th&gt;
&lt;th&gt;Perplexity&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;R1&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;256&lt;/td&gt;
&lt;td&gt;43&lt;/td&gt;
&lt;td&gt;14.1 M&lt;/td&gt;
&lt;td&gt;2.96 B&lt;/td&gt;
&lt;td&gt;56.19&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R2&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;256&lt;/td&gt;
&lt;td&gt;115&lt;/td&gt;
&lt;td&gt;16.6 M&lt;/td&gt;
&lt;td&gt;3.49 B&lt;/td&gt;
&lt;td&gt;48.58&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R3&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;256&lt;/td&gt;
&lt;td&gt;115&lt;/td&gt;
&lt;td&gt;22.1 M&lt;/td&gt;
&lt;td&gt;4.64 B&lt;/td&gt;
&lt;td&gt;45.10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R4&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;256&lt;/td&gt;
&lt;td&gt;92&lt;/td&gt;
&lt;td&gt;16.7 M&lt;/td&gt;
&lt;td&gt;3.51 B&lt;/td&gt;
&lt;td&gt;46.30&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R5&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;4&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;12&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;2&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;256&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;158&lt;/td&gt;
&lt;td&gt;21.0 M&lt;/td&gt;
&lt;td&gt;4.41 B&lt;/td&gt;
&lt;td&gt;41.18&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R6&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;256&lt;/td&gt;
&lt;td&gt;92&lt;/td&gt;
&lt;td&gt;16.7 M&lt;/td&gt;
&lt;td&gt;3.51 B&lt;/td&gt;
&lt;td&gt;46.30&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R7&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;8&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;256&lt;/td&gt;
&lt;td&gt;102&lt;/td&gt;
&lt;td&gt;16.5 M&lt;/td&gt;
&lt;td&gt;3.46 B&lt;/td&gt;
&lt;td&gt;46.68&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R8&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;4&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;12&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;2&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;256&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;158&lt;/td&gt;
&lt;td&gt;21.0 M&lt;/td&gt;
&lt;td&gt;4.41 B&lt;/td&gt;
&lt;td&gt;41.18&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R9&lt;/td&gt;
&lt;td&gt;6&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;256&lt;/td&gt;
&lt;td&gt;172&lt;/td&gt;
&lt;td&gt;20.0 M&lt;/td&gt;
&lt;td&gt;4.20 B&lt;/td&gt;
&lt;td&gt;42.26&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R10&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;4&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;12&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;2&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;256&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;158&lt;/td&gt;
&lt;td&gt;21.0 M&lt;/td&gt;
&lt;td&gt;4.41 B&lt;/td&gt;
&lt;td&gt;41.18&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R11&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;3&lt;/td&gt;
&lt;td&gt;256&lt;/td&gt;
&lt;td&gt;158&lt;/td&gt;
&lt;td&gt;23.8 M&lt;/td&gt;
&lt;td&gt;4.99 B&lt;/td&gt;
&lt;td&gt;39.92&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R12&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;256&lt;/td&gt;
&lt;td&gt;158&lt;/td&gt;
&lt;td&gt;27.1 M&lt;/td&gt;
&lt;td&gt;5.69 B&lt;/td&gt;
&lt;td&gt;39.10&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R13&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;4&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;12&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;2&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;256&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;158&lt;/td&gt;
&lt;td&gt;21.0 M&lt;/td&gt;
&lt;td&gt;4.41 B&lt;/td&gt;
&lt;td&gt;41.18&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R14&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;384&lt;/td&gt;
&lt;td&gt;158&lt;/td&gt;
&lt;td&gt;29.9 M&lt;/td&gt;
&lt;td&gt;6.28 B&lt;/td&gt;
&lt;td&gt;35.14&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R15&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;512&lt;/td&gt;
&lt;td&gt;158&lt;/td&gt;
&lt;td&gt;43.8 M&lt;/td&gt;
&lt;td&gt;9.20 B&lt;/td&gt;
&lt;td&gt;30.81&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;R16&lt;/td&gt;
&lt;td&gt;12&lt;/td&gt;
&lt;td&gt;4&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;256&lt;/td&gt;
&lt;td&gt;158&lt;/td&gt;
&lt;td&gt;21.0 M&lt;/td&gt;
&lt;td&gt;4.41 B&lt;/td&gt;
&lt;td&gt;43.10&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;em&gt;è¡¨7 å±•ç¤ºäº†å¯¹DeLighTå—çš„ä¸åŒæ–¹é¢è¿›è¡Œçš„æ¶ˆèç ”ç©¶ï¼ŒåŒ…æ‹¬ç»Ÿä¸€ç¼©æ”¾ä¸å—çº§ç¼©æ”¾ã€æ·±åº¦ç¼©æ”¾å’Œå®½åº¦ç¼©æ”¾ã€‚éƒ¨åˆ†çªå‡ºæ˜¾ç¤ºçš„è¡Œå…·æœ‰ç›¸åŒçš„é…ç½®ï¼ˆé‡å¤ä»¥è¯´æ˜ç»“æœï¼‰ã€‚æˆ‘ä»¬çš„å®éªŒè®¾ç½®ç±»ä¼¼äºç¬¬ 4èŠ‚ï¼Œä½†æˆ‘ä»¬å°†æ¨¡å‹è®­ç»ƒäº† 50K æ¬¡è¿­ä»£ã€‚ä¹˜æ³•å’ŒåŠ æ³•æ“ä½œï¼ˆMACsï¼‰æ˜¯é’ˆå¯¹ 20 ä¸ªæ—¶é—´æ­¥è¿›è¡Œè®¡ç®—çš„ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DeLighTå˜æ¢çš„å½±å“&lt;/strong&gt;ï¼šæˆ‘ä»¬å°†DeLighTå—ä¸­çš„DeLighTå˜æ¢æ›¿æ¢ä¸ºï¼ˆ1ï¼‰DeFINEå˜æ¢å’Œï¼ˆ2ï¼‰çº¿æ€§å±‚å †å ã€‚å›¾8æ˜¾ç¤ºï¼Œä¸DeFINEå•å…ƒå’Œçº¿æ€§å±‚ç›¸æ¯”ï¼ŒDeLighTå˜æ¢ä»¥æ˜¾è‘—æ›´å°‘çš„å‚æ•°æä¾›äº†ç›¸ä¼¼çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/paper/transformer/DeLighT/9.png&#34; alt=&#34;image-20240428220057115&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾ 8: ä¸åŒå˜æ¢çš„å½±å“ã€‚DeLighT å˜æ¢æ¯” DeFINE å’Œçº¿æ€§å˜æ¢æ›´å…·å‚æ•°æ•ˆç‡ã€‚æ›´ä½çš„å›°æƒ‘åº¦å€¼æ„å‘³ç€æ›´å¥½çš„æ€§èƒ½ã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;ç‰¹å¾æ´—ç‰Œ&lt;/strong&gt;ï¼šå›¾9æ˜¾ç¤ºç‰¹å¾æ´—ç‰Œé€šè¿‡1-2ä¸ªå›°æƒ‘åº¦ç‚¹æé«˜äº†DeLighTçš„æ€§èƒ½ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸R13-R15ï¼ˆè¡¨7ï¼‰ç›¸åŒçš„è®¾ç½®ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/paper/transformer/DeLighT/10.png&#34; alt=&#34;image-20240428215843596&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾ 9: ç‰¹å¾é‡æ’çš„å½±å“ã€‚ç‰¹å¾é‡æ’ä½¿æˆ‘ä»¬èƒ½å¤Ÿä»å…¨å±€ä¿¡æ¯ä¸­å­¦ä¹ è¡¨ç¤ºï¼Œå¹¶æé«˜äº†æ€§èƒ½ã€‚æ›´ä½çš„å›°æƒ‘åº¦å€¼æ„å‘³ç€æ›´å¥½çš„æ€§èƒ½ã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;è½»é‡çº§FFN&lt;/strong&gt;ï¼šå›¾10å±•ç¤ºäº†å˜åŒ–è½»é‡çº§FFNä¸­ç¼©å‡å› å­rçš„å½±å“ã€‚æˆ‘ä»¬ä½¿ç”¨äº†ä¸R13ï¼ˆè¡¨7ï¼‰ç›¸åŒçš„è®¾ç½®ã€‚æˆ‘ä»¬æ²¡æœ‰è§‚å¯Ÿåˆ°æ€§èƒ½æœ‰ä»»ä½•æ˜¾è‘—ä¸‹é™ï¼Œç›´åˆ°$r = 4$ã€‚å½“rå¤§äº4æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†æ€§èƒ½çš„ä¸‹é™ï¼ˆå›°æƒ‘åº¦å¢åŠ äº†çº¦2ç‚¹ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè½»é‡çº§FFNçš„å†…éƒ¨ç»´åº¦éå¸¸å°ï¼Œå½±å“äº†æ€§èƒ½ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“$r = 2^{-2}$æ—¶ï¼Œè½»é‡çº§FFNçš„æ€§èƒ½ä¸$r = 2^{-2}$æ—¶ç›¸åŒï¼Œä½†å‚æ•°æ•°é‡å°‘äº†1.28å€ã€‚åœ¨$r = 2^{-2}$æ—¶ï¼Œè½»é‡çº§FFNä¸Vaswaniç­‰äººï¼ˆ2017ï¼‰ä¸­çš„FFNç›¸åŒã€‚è¿™è¡¨æ˜DeLighTå˜æ¢èƒ½å¤Ÿé«˜æ•ˆåœ°åœ¨é«˜ç»´ç©ºé—´ä¸­å­¦ä¹ è¡¨ç¤ºï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå‡è½»FFNçš„è®¡ç®—è´Ÿæ‹…ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/paper/transformer/DeLighT/11.png&#34; alt=&#34;image-20240428215610711&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾ 10: è½»é‡çº§FFNä¸­å‡å°‘å› å­$r$çš„å½±å“ã€‚DeLighTå˜æ¢åœ¨é«˜ç»´ç©ºé—´ä¸­æœ‰æ•ˆå­¦ä¹ è¡¨ç¤ºçš„èƒ½åŠ›ä½¿æˆ‘ä»¬èƒ½å¤Ÿå‡å°‘FFNçš„è®¡ç®—è´Ÿæ‹…ã€‚æ›´ä½çš„å›°æƒ‘åº¦å€¼æ„å‘³ç€æ›´å¥½çš„æ€§èƒ½ã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜æµ‹è¯•äº†å»é™¤è½»é‡çº§FFNï¼Œè™½ç„¶å®ƒå‡å°‘äº†$\sim$0.5-1 Mçš„å‚æ•°ï¼Œä½†æ€§èƒ½ä¸‹é™äº†çº¦2-3ä¸ªå›°æƒ‘åº¦ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å‡åŒ€ç¼©æ”¾ä¸å—çº§ç¼©æ”¾&lt;/strong&gt;ï¼šå›¾11æ¯”è¾ƒäº†DeLighTåœ¨å‡åŒ€ç¼©æ”¾å’Œå—çº§ç¼©æ”¾ä¸‹çš„æ€§èƒ½ã€‚å¯¹äºç»™å®šçš„æ¨¡å‹ç»´åº¦dmï¼Œå…·æœ‰å—çº§ç¼©æ”¾çš„DeLighTæ¨¡å‹æä¾›äº†æ›´å¥½çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/paper/transformer/DeLighT/12.png&#34; alt=&#34;image-20240428215259755&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾ 11:  å‡åŒ€(uniform)å°ºåº¦ä¸åˆ†å—(block-wise)å°ºåº¦å¯¹æ¯”ã€‚(a)å¯¹æ¯”äº†å‡åŒ€å°ºåº¦å’Œåˆ†å—å°ºåº¦æ–¹æ³•ã€‚(b)æ¯”è¾ƒäº†WikiText-103æ•°æ®é›†ä¸ŠDeLighTä¸å‡åŒ€å°ºåº¦å’Œåˆ†å—å°ºåº¦æ–¹æ³•çš„ç»“æœã€‚å¸¦æœ‰åˆ†å—å°ºåº¦çš„DeLighTç½‘ç»œåœ¨ä¸åŒè®¾ç½®ä¸‹æä¾›æ›´å¥½çš„æ€§èƒ½ã€‚æ›´ä½çš„å›°æƒ‘åº¦å€¼æ„å‘³ç€æ›´å¥½çš„æ€§èƒ½ã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;DeLighTå˜æ¢çš„ä½ç½®&lt;/strong&gt;ï¼šæˆ‘ä»¬åœ¨WikiText-103éªŒè¯é›†ä¸Šç ”ç©¶äº†DeLighTå˜æ¢çš„ä¸‰ç§é…ç½®ï¼šï¼ˆ1ï¼‰DeLighTå˜æ¢åè·Ÿå•å¤´æ³¨æ„åŠ›å’Œè½»é‡çº§FFNï¼Œï¼ˆ2ï¼‰å•å¤´æ³¨æ„åŠ›åè·ŸDeLighTå˜æ¢ï¼Œä»¥åŠï¼ˆ3ï¼‰å•å¤´æ³¨æ„åŠ›åè·ŸDeLighTå˜æ¢å’Œè½»é‡çº§FFNã€‚å¯¹äºç›¸ä¼¼æ•°é‡çš„å‚æ•°ï¼Œæˆ‘ä»¬å‘ç°ï¼ˆ2ï¼‰å’Œï¼ˆ3ï¼‰æ˜¾è‘—é™ä½äº†ï¼ˆ1ï¼‰çš„æ€§èƒ½ã€‚è¿™è¡¨æ˜æ›´æ·±å’Œæ›´å®½çš„è¡¨ç¤ºæœ‰åŠ©äºå­¦ä¹ æ›´å¥½çš„ä¸Šä¸‹æ–‡è¡¨ç¤ºï¼›ä½¿æˆ‘ä»¬èƒ½å¤Ÿç”¨å•å¤´æ³¨æ„åŠ›æ›¿ä»£å¤šå¤´æ³¨æ„åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ‰©å±•DeLighT&lt;/strong&gt;ï¼šå›¾12å±•ç¤ºäº†åœ¨å˜åŒ–DeLighTå˜æ¢çš„é…ç½®å‚æ•°ï¼ˆ$N_{min}$={4, 6}, $N_{max}$={8, 12}, $w_m$={2, 3, 4}, and $d_m$={256, 384, 512}ï¼‰åè·å¾—çš„DeLighTæ¨¡å‹çš„ç»“æœã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒåŒæ—¶ä¿æŒå…¶ä»–é…ç½®å‚æ•°ä¸å˜ï¼ˆä¾‹å¦‚ï¼Œ$N_{min}$, $N_{max}$, å’Œ $w_m$ï¼‰ï¼Œåªæ‰©å±•ä¸€ä¸ªé…ç½®å‚æ•°ï¼ˆä¾‹å¦‚ï¼Œ$d_m$ï¼‰å°±èƒ½ä¸€è‡´åœ°æé«˜æ€§èƒ½ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/paper/transformer/DeLighT/13.png&#34; alt=&#34;image-20240428215036835&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾ 12: DeLighTçš„è§„æ¨¡æ‰©å±•ã€‚åœ¨ä¿æŒå…¶ä»–é…ç½®å‚æ•°æ’å®šï¼ˆä¾‹å¦‚ï¼Œ$N_{\text{min}}$ã€$N_{\text{max}}$ã€$w_m$ï¼‰çš„æƒ…å†µä¸‹ï¼Œæ‰©å±•ä¸€ä¸ªé…ç½®å‚æ•°ï¼ˆä¾‹å¦‚ dmï¼‰å§‹ç»ˆä¼šæé«˜æ€§èƒ½ã€‚æ¯ä¸ªæŸ±å­é¡¶éƒ¨çš„æ•°å­—è¡¨ç¤ºç½‘ç»œå‚æ•°ï¼ˆä»¥ç™¾ä¸‡ä¸ºå•ä½ï¼‰ã€‚æ›´ä½çš„å›°æƒ‘åº¦å€¼æ„å‘³ç€æ›´å¥½çš„æ€§èƒ½ã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¿™é¡¹å·¥ä½œé€šè¿‡æ‰‹åŠ¨è°ƒæ•´å‚æ•° $N_{\text{min}}$ã€$N_{\text{max}}$ã€$w_m$ å’Œ $d_m$ï¼Œæ¢ç©¶å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚æˆ‘ä»¬ç›¸ä¿¡ï¼Œé‡‡ç”¨æ›´åŠ åŸç†æ€§çš„æ–¹æ³•ï¼Œä¾‹å¦‚ Tan å’Œ Le (2019) æå‡ºçš„å¤åˆç¼©æ”¾æ–¹æ³•ï¼Œå»ºç«‹è¿™äº›å‚æ•°ä¹‹é—´çš„å…³ç³»ï¼Œå°†ä¼šäº§ç”Ÿæ›´æœ‰æ•ˆå’Œå‡†ç¡®çš„æ¨¡å‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;é™„å½•e-ç»„çº¿æ€§å˜æ¢çš„æºä»£ç &#34;&gt;&lt;strong&gt;é™„å½•E ç»„çº¿æ€§å˜æ¢çš„æºä»£ç &lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;åœ¨PyTorchä¸­å®ç°ç»„çº¿æ€§å˜æ¢ï¼ˆGroup Linear Transformation, GLTï¼‰çš„æºä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚ä¸ºäº†åœ¨GLTä¸­é«˜æ•ˆåœ°å®ç°åˆ†ç»„åŠŸèƒ½ï¼Œæˆ‘ä»¬ç”¨ä¸“ç”¨çš„CUDAå†…æ ¸æ›¿æ¢äº†PyTorchä¸­ç®€å•çš„reshapeå’Œtransposeæ“ä½œï¼Œä»è€Œå‡å°‘äº†å†…å­˜å ç”¨å¹¶åŠ å¿«äº†è®­ç»ƒé€Ÿåº¦ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åˆ—è¡¨1: &amp;ldquo;åœ¨Pytorchä¸­GLTçš„ç®€å•å®ç°&amp;rdquo;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;torch&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;glt_function&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n_groups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;weights&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bias&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&amp;#39;&amp;#39;
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;    :param x: è¾“å…¥å¼ é‡ï¼Œå¤§å°ä¸º [B x N]ï¼Œå…¶ä¸­Bæ˜¯æ‰¹é‡å¤§å°ï¼ŒNæ˜¯è¾“å…¥ç»´åº¦
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;    :param n_groups: GLTä¸­çš„ç»„æ•°
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;    :param weights: gltæƒé‡ [g x N/g x M/g]
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;    :param bias: GLTåç½®ï¼ˆå¯é€‰ï¼‰ï¼Œå¤§å°ä¸º [g x 1 x M/g]
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;    :return: è¾“å‡ºå¼ é‡ï¼Œå¤§å°ä¸º [B x M]
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;    &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;bsz&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;# åˆ†ç»„å‡½æ•°ï¼šå°† [B x N] å¼ é‡è½¬æ¢ä¸º [g x B x N/g]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;contiguous&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;view&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bsz&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;n_groups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# [B x N] --&amp;gt; [B x g x N/g]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;transpose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# è½¬ç½®ï¼Œä½¿ç»„æˆä¸ºç¬¬ä¸€ä¸ªç»´åº¦&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;# å˜æ¢å‡½æ•°ï¼šå°† N/g ç»´ç©ºé—´å˜æ¢ä¸º M/g ç»´ç©ºé—´&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bmm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;weights&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# ä¸æƒé‡ç›¸ä¹˜&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;# å¦‚æœæä¾›äº†åç½®ï¼Œåˆ™æ·»åŠ åç½®&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bias&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bias&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;# é‡æ–°åˆ†ç»„å‡½æ•°ï¼šå°† [g x B x M/g] å¼ é‡è½¬æ¢å› [B x M]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;transpose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# å†æ¬¡è½¬ç½®ï¼Œä½¿æ‰¹é‡å¤§å°æˆä¸ºç¬¬ä¸€ä¸ªç»´åº¦&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;contiguous&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;view&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bsz&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# [B x g x M/g] --&amp;gt; [B x M]&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;åˆ—è¡¨2: &amp;ldquo;CUDAä¸­çš„åˆ†ç»„å†…æ ¸&amp;rdquo;&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-cpp&#34; data-lang=&#34;cpp&#34;&gt;&lt;span class=&#34;cm&#34;&gt;/* åˆ†ç»„å†…æ ¸ï¼šå°†è¾“å…¥ä» [B x N] è½¬æ¢ä¸º [g x B x N/g] */&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typename&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;scalar_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;__global__&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;grouping_kernel_forward&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;scalar_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                                         &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;groups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                                         &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;total_elements&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                                         &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_features&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                                         &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;group_features&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                                         &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;batch_size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                                         &lt;span class=&#34;n&#34;&gt;scalar_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;output&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IMUL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;blockIdx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;blockDim&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;threadIdx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;total_elements&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b_idx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;group_features&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;g_f_idx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;group_features&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;in_offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;out_offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;cp&#34;&gt;#pragma unroll
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;g&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;g&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;groups&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;g&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;in_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b_idx&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_features&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;g&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;group_features&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;g_f_idx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;out_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;g&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;batch_size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;b_idx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;group_features&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;g_f_idx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;output&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;out_offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;in_offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
      
    </item>
    
    <item>
      <title>è§£è¯»è®ºæ–‡ï¼šLeave No Context Behind: Efficient Infinite Context Transformers with Infini-attention</title>
      <link>https://weedge.github.io/post/paper/transformer/infini_attention/</link>
      <pubDate>Fri, 12 Apr 2024 10:26:12 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/paper/transformer/infini_attention/</guid>
      
        <description>&lt;p&gt;&lt;img src=&#34;https://aiptcomics.com/ezoimgfmt/i0.wp.com/aiptcomics.com/wp-content/uploads/2024/04/transformers-7.jpg?w=1500&amp;amp;ssl=1&amp;amp;ezimgfmt=ngcb4/notWebP&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å›¾ç‰‡æ¥æºï¼š &lt;a href=&#34;https://aiptcomics.com/2024/04/10/transformers-7-2024-review/&#34;&gt;https://aiptcomics.com/2024/04/10/transformers-7-2024-review/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ‘˜è¦&lt;/strong&gt;ï¼š æœ¬æ–‡ä»‹ç»äº†ä¸€ç§æœ‰æ•ˆçš„æ–¹æ³•ï¼Œå°†åŸºäºTransformerçš„å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰æ‰©å±•åˆ°æ— é™é•¿çš„è¾“å…¥ï¼ŒåŒæ—¶å—åˆ°å†…å­˜å’Œè®¡ç®—çš„é™åˆ¶ã€‚æˆ‘ä»¬æå‡ºçš„æ–¹æ³•çš„å…³é”®ç»„æˆéƒ¨åˆ†æ˜¯ä¸€ç§æ–°çš„æ³¨æ„åŠ›æŠ€æœ¯ï¼Œç§°ä¸ºInfini-attentionã€‚Infini-attentionå°†ä¸€ç§å‹ç¼©å†…å­˜é›†æˆåˆ°äº†ä¼ ç»Ÿçš„æ³¨æ„åŠ›æœºåˆ¶ä¸­ï¼Œå¹¶åœ¨å•ä¸ªTransformerå—ä¸­æ„å»ºäº†æ©ç å±€éƒ¨æ³¨æ„åŠ›å’Œé•¿æœŸçº¿æ€§æ³¨æ„åŠ›æœºåˆ¶ã€‚æˆ‘ä»¬é€šè¿‡åœ¨é•¿ä¸Šä¸‹æ–‡è¯­è¨€å»ºæ¨¡åŸºå‡†ã€1Måºåˆ—é•¿åº¦çš„å£ä»¤(keypass)ä¸Šä¸‹æ–‡å—æ£€ç´¢å’Œ500Ké•¿åº¦çš„ä¹¦ç±æ‘˜è¦ä»»åŠ¡ä¸­ä½¿ç”¨1Bå’Œ8B LLMsï¼Œå±•ç¤ºäº†æˆ‘ä»¬æ–¹æ³•çš„æœ‰æ•ˆæ€§ã€‚æˆ‘ä»¬çš„æ–¹æ³•å¼•å…¥äº†æœ€å°çš„æœ‰ç•Œå†…å­˜å‚æ•°ï¼Œå¹¶å®ç°äº†LLMsçš„å¿«é€Ÿæµå¼æ¨ç†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šä¸ºè§£å†³å¤§æ¨¡å‹ï¼ˆLLMsï¼‰åœ¨å¤„ç†è¶…é•¿è¾“å…¥åºåˆ—æ—¶é‡åˆ°çš„å†…å­˜é™åˆ¶é—®é¢˜ï¼Œæœ¬æ–‡ä½œè€…æå‡ºäº†ä¸€ç§æ–°å‹æ¶æ„ï¼šInfini-Transformerï¼Œå®ƒå¯ä»¥åœ¨æœ‰é™å†…å­˜æ¡ä»¶ä¸‹ï¼Œè®©åŸºäºTransformerçš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰é«˜æ•ˆå¤„ç†æ— é™é•¿çš„è¾“å…¥åºåˆ—ã€‚å®éªŒç»“æœè¡¨æ˜ï¼šInfini-Transformeråœ¨é•¿ä¸Šä¸‹æ–‡è¯­è¨€å»ºæ¨¡ä»»åŠ¡ä¸Šè¶…è¶Šäº†åŸºçº¿æ¨¡å‹ï¼Œå†…å­˜æœ€é«˜å¯èŠ‚çº¦114å€ã€‚&lt;/p&gt;
&lt;p&gt;æ„Ÿè§‰æœ‰ç§å¤–æŒ‚å­˜å‚¨åº“(ç±»ä¼¼å‘é‡æ•°æ®åº“)åµŒå…¥åˆ°æ¨¡å‹ç»“æ„ä¸­ã€‚æ¯”å¦‚ï¼š &lt;a href=&#34;https://arxiv.org/abs/2203.08913&#34;&gt;Memorizing Transformers&lt;/a&gt; + &lt;a href=&#34;https://github.com/lucidrains/memorizing-transformers-pytorch&#34;&gt;code&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è®ºæ–‡ã€ŠMemorizing Transformersã€‹ä¸­ï¼Œä½œè€…æå‡ºäº†ä¸€ç§æ–°çš„æ³¨æ„åŠ›æœºåˆ¶ï¼Œç§°ä¸ºkNN-augmented attention layerï¼Œå®ƒç»“åˆäº†å±€éƒ¨ä¸Šä¸‹æ–‡çš„å¯†é›†è‡ªæ³¨æ„åŠ›å’Œå¯¹å¤–éƒ¨è®°å¿†çš„è¿‘ä¼¼k-æœ€è¿‘é‚»ï¼ˆkNNï¼‰æœç´¢ã€‚è¿™ä¸ªæœºåˆ¶çš„å…³é”®éƒ¨åˆ†ä¹‹ä¸€æ˜¯ä½¿ç”¨äº†ä¸€ä¸ªé—¨æ§æœºåˆ¶ï¼ˆgating mechanismï¼‰æ¥ç»“åˆå±€éƒ¨æ³¨æ„åŠ›å’Œå¤–éƒ¨è®°å¿†çš„æ³¨æ„åŠ›ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é—¨æ§æœºåˆ¶çš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é—¨æ§åˆ†æ•°ï¼ˆgating scoreï¼‰&lt;/strong&gt;ï¼šå¯¹äºæ¯ä¸ªæ³¨æ„åŠ›å¤´ï¼Œæ¨¡å‹ä¼šå­¦ä¹ ä¸€ä¸ªåç½®ï¼ˆbiasï¼‰$ bg $ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯å­¦ä¹ çš„å‚æ•°ï¼Œç”¨äºæ§åˆ¶æ¯ä¸ªå¤´åœ¨å±€éƒ¨ä¸Šä¸‹æ–‡å’Œå¤–éƒ¨è®°å¿†ä¹‹é—´çš„æ³¨æ„åŠ›åˆ†é…ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é—¨æ§å‡½æ•°ï¼ˆgating functionï¼‰&lt;/strong&gt;ï¼šåç½®$ bg $é€šè¿‡sigmoidå‡½æ•°è¿›è¡Œå¤„ç†ï¼Œå¾—åˆ°é—¨æ§åˆ†æ•°$ g = \sigma(bg) $ã€‚è¿™ä¸ªåˆ†æ•°å†³å®šäº†æ¨¡å‹åœ¨å±€éƒ¨ä¸Šä¸‹æ–‡å’Œå¤–éƒ¨è®°å¿†ä¹‹é—´å¦‚ä½•åˆ†é…å…¶æ³¨æ„åŠ›ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„åŠ›ç»“æœçš„ç»“åˆ&lt;/strong&gt;ï¼šå±€éƒ¨æ³¨æ„åŠ›çš„ç»“æœï¼ˆ$ V_c $ï¼‰å’Œå¤–éƒ¨è®°å¿†æ³¨æ„åŠ›çš„ç»“æœï¼ˆ$ V_m $ï¼‰é€šè¿‡é—¨æ§åˆ†æ•°å’Œä¸€ä¸ªå…ƒç´ çº§åˆ«çš„ä¹˜æ³•æ“ä½œç»“åˆèµ·æ¥ï¼Œå½¢æˆæœ€ç»ˆçš„æ³¨æ„åŠ›è¾“å‡º$ V_a $ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç”¨ä»¥ä¸‹å…¬å¼è¡¨ç¤ºï¼š
$ g = \sigma(bg) $
$ V_a = V_m \odot g + V_c \odot (1 - g) $
å…¶ä¸­ï¼Œ$ \odot $è¡¨ç¤ºå…ƒç´ çº§åˆ«çš„ä¹˜æ³•ï¼Œ$ \sigma $æ˜¯sigmoidå‡½æ•°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¨¡å‹å¯ä»¥åŠ¨æ€åœ°åœ¨å±€éƒ¨å’Œé•¿æœŸè®°å¿†ä¹‹é—´è°ƒæ•´å…¶æ³¨æ„åŠ›ï¼Œä»¥æ›´å¥½åœ°å¤„ç†é•¿åºåˆ—æ•°æ®ã€‚è¿™ç§é—¨æ§æœºåˆ¶ä½¿å¾—Memorizing Transformerèƒ½å¤Ÿæœ‰æ•ˆåœ°åˆ©ç”¨å¤–éƒ¨è®°å¿†æ¥æé«˜å…¶åœ¨å„ç§ä»»åŠ¡ä¸Šçš„æ€§èƒ½ï¼ŒåŒ…æ‹¬ä»£ç ã€æ•°å­¦è®ºæ–‡ã€ä¹¦ç±ç­‰é•¿æ–‡æœ¬æ•°æ®é›†çš„è¯­è¨€å»ºæ¨¡ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨Memorizing TransformersåŸºç¡€ä¸Šï¼Œç»“åˆCompressive Memory + Linear attetionæœºåˆ¶ + å¢é‡è§„åˆ™ =&amp;gt; Infinite Context Transformers&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç›®çš„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é€šè¿‡ç¿»è¯‘é€šè¯»è®ºæ–‡ï¼Œäº†è§£Transformerç›¸å…³ä¼˜åŒ–æ¨¡å‹ç»“æ„è®ºæ–‡æ€è·¯ï¼Œæ¯”å¦‚æ–‡ä¸­å¯¹æ¯”çš„ &lt;a href=&#34;https://arxiv.org/abs/1901.02860&#34;&gt;Transformer-XL&lt;/a&gt; + &lt;a href=&#34;https://github.com/kimiyoung/transformer-xl&#34;&gt;code&lt;/a&gt;ï¼Œ&lt;a href=&#34;https://arxiv.org/abs/1911.05507&#34;&gt;Compressive Transformer&lt;/a&gt; + &lt;a href=&#34;https://github.com/lucidrains/compressive-transformer-pytorch&#34;&gt;code&lt;/a&gt;ï¼Œ&lt;a href=&#34;https://arxiv.org/abs/2207.06881&#34;&gt;Recurrent Memory Transformer(RMT)&lt;/a&gt; + &lt;a href=&#34;https://github.com/booydar/LM-RMT&#34;&gt;code&lt;/a&gt;ï¼Œ &lt;a href=&#34;https://arxiv.org/abs/2203.08913&#34;&gt;Memorizing Transformers&lt;/a&gt; + &lt;a href=&#34;https://github.com/lucidrains/memorizing-transformers-pytorch&#34;&gt;code&lt;/a&gt;ï¼ˆä½¿ç”¨åŸºäºå‘é‡æ£€ç´¢çš„ KV å­˜å‚¨å™¨ï¼Œä¸»è¦æ˜¯åœ¨è¯¥è®ºæ–‡çš„åŸºç¡€ä¸Šå®éªŒï¼‰ï¼Œ&lt;a href=&#34;https://arxiv.org/abs/2305.14788&#34;&gt;Adapting Language Models to Compress Contexts(AutoCompressors)&lt;/a&gt; + &lt;a href=&#34;https://github.com/princeton-nlp/AutoCompressors&#34;&gt;code&lt;/a&gt;ï¼›è¿˜æœ‰ä¸€ç¯‡Jeff Deanä¸»å¯¼çš„æ¨¡å‹æ¨ç†å·¥ç¨‹ä¼˜åŒ–è®ºæ–‡ï¼š&lt;a href=&#34;https://arxiv.org/pdf/2211.05102.pdf&#34;&gt;Efficiently scaling transformer inference&lt;/a&gt;å¯ä»¥é€šè¯»ä¸‹ ã€‚&lt;/li&gt;
&lt;li&gt;æ–‡ä¸­é€šè¿‡æ‘˜è¦ä»»åŠ¡è¿›è¡Œå¯¹æ¯”çš„Unlimiformerï¼Œç†Ÿæ‚‰è®ºæ–‡ï¼š&lt;a href=&#34;https://arxiv.org/abs/2305.01625&#34;&gt;&lt;strong&gt;Unlimiformer: Long-Range Transformers with Unlimited Length Input&lt;/strong&gt;&lt;/a&gt; + &lt;a href=&#34;https://github.com/abertsch72/unlimiformer&#34;&gt;code&lt;/a&gt; ï¼š Unlimiformeré€šè¿‡å°†äº¤å‰æ³¨æ„åŠ›è®¡ç®—å¸è½½åˆ°ä¸€ä¸ªå•ä¸€çš„k-æœ€è¿‘é‚»ï¼ˆkNNï¼‰ç´¢å¼•ä¸­ï¼Œä»è€Œå…è®¸æ¯ä¸ªè§£ç å™¨å±‚ä¸­çš„æ¯ä¸ªæ ‡å‡†äº¤å‰æ³¨æ„åŠ›å¤´åªå…³æ³¨è¾“å…¥åºåˆ—ä¸­çš„top-ké”®ã€‚è¿™ç§æ–¹æ³•å¯ä»¥åœ¨GPUæˆ–CPUå†…å­˜ä¸­å­˜å‚¨kNNç´¢å¼•ï¼Œå¹¶ä»¥äºšçº¿æ€§æ—¶é—´è¿›è¡ŒæŸ¥è¯¢ï¼Œå› æ­¤å¯ä»¥ç´¢å¼•å®é™…ä¸Šæ— é™çš„è¾“å…¥åºåˆ—&lt;/li&gt;
&lt;li&gt;Infini-Transformerè®ºæ–‡ä¸­æåˆ°çš„ä¼˜åŒ–æŠ€æœ¯ï¼šCompressive Memory  è¿˜å¯ä»¥æ•´åˆåˆ°ç°åˆ°Sparse MoE ç›¸å…³çš„æ¨¡å‹ç»“æ„ä¸­ï¼Œæ¯”å¦‚&lt;a href=&#34;https://arxiv.org/abs/2101.03961&#34;&gt;Switch Transformers&lt;/a&gt; , &lt;a href=&#34;https://arxiv.org/abs/2306.04640&#34;&gt;ModuleFormer&lt;/a&gt;ä¸­æåˆ°çš„Sparse MoEä¸­ï¼›è¯¶~æ˜¯ä¸æ˜¯åšåšå®éªŒï¼Œå›°æƒ‘åº¦(perplexity)/loss æ•ˆæœä¸é”™çš„è¯æ˜¯ä¸æ˜¯å¯ä»¥å‘ä¸ªè®ºæ–‡å˜~ï¼›Googleå¤§æ³•ä¸‹äº†ä¸ªä¼˜åŒ–è›‹ï¼Œåé¢è·Ÿç€ä¸€æ‰¹ç»„åˆä¼˜åŒ–è›‹ã€‚æ³•åŠ›æ— è¾¹ï¼Œáƒ¦( Â´ï½¥á´—ï½¥` )æ¯”å¿ƒ~&lt;/li&gt;
&lt;li&gt;å€Ÿé‰´å»ºæ¨¡é¢„è®­ç»ƒå’Œç»§ç»­é¢„è®­ç»ƒå®éªŒæ–¹æ³•ï¼Œä»¥åŠä»»åŠ¡å¾®è°ƒæµ‹è¯•æ–¹æ³•ï¼›å€Ÿé‰´åœ¨å°æ¨¡å‹ä¸Šçš„å®éªŒæ–¹æ³•å’Œè¯„ä¼°æ–¹æ³•ï¼›ä½æˆæœ¬å®ç°æ–¹æ¡ˆå»å¤ç°ã€‚&lt;/li&gt;
&lt;li&gt;scalingåˆ°æ›´é•¿æ–‡æœ¬åºåˆ—é•¿åº¦ã€‚ç†è®ºä¸Šæ²¡æœ‰é™åˆ¶ï¼ŒInfini-attentionä»¥é€’å½’æ–¹å¼å¯¹å›ºå®šæ•°é‡çš„å†…å­˜å‚æ•°è¿›è¡Œå¢é‡å†…å­˜æ›´æ–°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;è®ºæ–‡è§£è¯»ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åŸè®ºæ–‡åœ°å€ï¼š &lt;a href=&#34;https://arxiv.org/pdf/2404.07143.pdf&#34;&gt;https://arxiv.org/pdf/2404.07143.pdf&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;è®ºæ–‡ä¸­æåˆ° Compressive Memory æ¥è‡ªï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Sparse_distributed_memory&#34;&gt;Sparse distributed memory (SDM)&lt;/a&gt;
&lt;ul&gt;
&lt;li&gt;SDM ä¸åŸå§‹attentionçš„ç»“åˆåœ¨GPT2æ¨¡å‹ç»“æ„ä¸­ï¼Œå¯ä»¥çœ‹ä¸‹è¿™ä¸ªè§†é¢‘ï¼š&lt;a href=&#34;https://www.youtube.com/watch?v=THIIk7LR9_8&#34;&gt;Attention Approximates Sparse Distributed Memory&lt;/a&gt; + &lt;a href=&#34;https://github.com/TrentBrick/attention-approximates-sdm&#34;&gt;code&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://papers.nips.cc/paper_files/paper/2019/file/182bd81ea25270b7d1c2fe8353d17fe6-Paper.pdf&#34;&gt;Metalearned neural memory. Advances in Neural Information Processing Systems&lt;/a&gt; | &lt;a href=&#34;https://arxiv.org/abs/2011.07831&#34;&gt;Learning associative inference using fast weight memory&lt;/a&gt; + &lt;a href=&#34;https://github.com/ischlag/Fast-Weight-Memory-public&#34;&gt;code&lt;/a&gt;ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Infini-attentionçš„ä¼˜åŒ–å€Ÿé‰´Linear attetionæœºåˆ¶ + å¢é‡è§„åˆ™ =&amp;gt; æ›´æ–°è§„åˆ™ï¼ˆçº¿æ€§(Linear) + å¢é‡(Delta)ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ›´æ–°è§„åˆ™(Update Rule)&lt;/strong&gt;: å¦‚æœåœ¨KV ç»‘å®šå·²ç»å­˜åœ¨äºå†…å­˜ä¸­ï¼Œåˆ™ä¿æŒå…³è”çŸ©é˜µä¸å˜ï¼ŒåŒæ—¶ï¼Œä»è·Ÿè¸ªä¸å‰ä¸€ä¸ªæ›´æ–°è§„åˆ™ç›¸åŒçš„å½’ä¸€åŒ–é¡¹ï¼ˆçº¿æ€§ï¼‰ä»¥ä¿è¯æ•°å€¼ç¨³å®šæ€§&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://spaces.ac.cn/archives/7546&#34;&gt;Linear attentionçš„æ¢ç´¢ï¼šAttentionå¿…é¡»æœ‰ä¸ªSoftmaxå—ï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/pdf/1812.01243.pdf&#34;&gt;Efficient Attention: Attention with Linear Complexities [v10]&lt;/a&gt; + &lt;a href=&#34;https://github.com/cmsflash/efficient-attention&#34;&gt;code&lt;/a&gt; + &lt;a href=&#34;https://www.youtube.com/watch?v=_wnjhTM04NM&#34;&gt;video&lt;/a&gt; ä¸­çš„çº¿æ€§æ³¨æ„åŠ›(Linear attention)æœºåˆ¶ï¼›å¹¶åˆ©ç”¨ç›¸å…³æ–¹æ³•ä¸­çš„ç¨³å®šè®­ç»ƒæŠ€æœ¯ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2006.16236&#34;&gt;Transformers are RNNs: Fast Autoregressive Transformers with Linear Attention&lt;/a&gt; + &lt;a href=&#34;https://linear-transformers.com/&#34;&gt;website&lt;/a&gt; ä¸­çš„çº¿æ€§æ³¨æ„åŠ›(Linear attention)æœºåˆ¶ï¼›æ›´æ–°è§„åˆ™å’Œæ£€ç´¢æœºåˆ¶ï¼Œä¸»è¦æ˜¯å› ä¸ºå…¶ç®€å•æ€§å’Œç«äº‰æ€§èƒ½ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2009.14794&#34;&gt;Rethinking Attention with Performers&lt;/a&gt; + &lt;a href=&#34;https://research.google/blog/rethinking-attention-with-performers/&#34;&gt;blog&lt;/a&gt; + &lt;a href=&#34;https://github.com/google-research/google-research/blob/master/performer/fast_attention/README.md&#34;&gt;code&lt;/a&gt; + &lt;a href=&#34;https://www.youtube.com/watch?v=xJrKIPwVwGM&#34;&gt;video&lt;/a&gt; è®ºæ–‡ä¸­æœªæåˆ°ï¼Œä½†æ˜¯æ„Ÿè§‰å¯ä»¥åŠ å…¥ä¼˜åŒ–ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://arxiv.org/abs/2305.16300&#34;&gt;Landmark Attention&lt;/a&gt; + &lt;a href=&#34;https://github.com/epfml/landmark-attention&#34;&gt;code&lt;/a&gt; : ç¨€ç–æ€§çº³å…¥æ³¨æ„åŠ›å±‚, äº†è§£æ€è·¯ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Delta_rule&#34;&gt;Delta Rule&lt;/a&gt;: å¢é‡è§„åˆ™å°è¯•é€šè¿‡é¦–å…ˆæ£€ç´¢ç°æœ‰å€¼æ¡ç›®å¹¶å°†å®ƒä»¬ä»æ–°å€¼ä¸­å‡å»ï¼Œç„¶ååº”ç”¨å…³è”ç»‘å®šä½œä¸ºæ–°çš„æ›´æ–°ï¼Œç¨å¾®æ”¹è¿›äº†å†…å­˜æ›´æ–°&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è®ºæ–‡ä½œè€…ï¼š &lt;a href=&#34;https://www.tsendeemts.com/&#34;&gt;Tsendsuren Munkhdalai&lt;/a&gt;  , ä¹Ÿæ˜¯ &lt;strong&gt;Metalearned neural memory&lt;/strong&gt; å’Œ &lt;strong&gt;Learning associative inference using fast weight memory (FWM)&lt;/strong&gt; çš„ä½œè€…ï¼Œæ²¿ç”¨äº†ä»¥å‰çš„ä¼˜åŒ–(ä½œè€…ä»¥å‰åœ¨å¾®è½¯å‘çš„è®ºæ–‡)ï¼Œä¸åŸå§‹attentionç»“æ„ç»“åˆï¼›åœ¨å‹ç¼©å†…å­˜ä¸­å­˜å‚¨é”®å’Œå€¼çŠ¶æ€çš„ç»‘å®šï¼Œå¹¶ä½¿ç”¨æŸ¥è¯¢å‘é‡è¿›è¡Œæ£€ç´¢ã€‚å…¶ä»–ä¸¤ä½ä½œè€…æ˜¯&lt;a href=&#34;bard.google.com&#34;&gt;google bart&lt;/a&gt;(ç°åœ¨çš„geminiæ¨¡å‹)é¡¹ç›®è´Ÿè´£ç ”ç©¶ä¸»ç®¡äººå‘˜ã€‚&lt;/p&gt;
&lt;h2 id=&#34;1-å¼•è¨€&#34;&gt;1 å¼•è¨€&lt;/h2&gt;
&lt;p&gt;å†…å­˜ä½œä¸ºæ™ºèƒ½çš„åŸºçŸ³ï¼Œå®ƒä½¿å¾—é’ˆå¯¹ç‰¹å®šä¸Šä¸‹æ–‡çš„é«˜æ•ˆè®¡ç®—æˆä¸ºå¯èƒ½ã€‚ç„¶è€Œï¼ŒTransformerï¼ˆVaswaniç­‰äººï¼Œ2017å¹´ï¼‰å’ŒåŸºäºTransformerçš„å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰ï¼ˆBrownç­‰äººï¼Œ2020å¹´ï¼›Touvronç­‰äººï¼Œ2023å¹´ï¼›Anilç­‰äººï¼Œ2023å¹´ï¼›Groeneveldç­‰äººï¼Œ2024å¹´ï¼‰ç”±äºæ³¨æ„åŠ›æœºåˆ¶çš„æœ¬è´¨ï¼Œå…·æœ‰å—é™çš„ä¸Šä¸‹æ–‡ä¾èµ–å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;Transformerä¸­çš„æ³¨æ„åŠ›æœºåˆ¶åœ¨å†…å­˜å ç”¨å’Œè®¡ç®—æ—¶é—´ä¸Šè¡¨ç°å‡ºäºŒæ¬¡æ–¹å¤æ‚åº¦ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªæ‰¹é‡å¤§å°ä¸º512ï¼Œä¸Šä¸‹æ–‡é•¿åº¦ä¸º2048çš„500Bæ¨¡å‹ï¼Œæ³¨æ„åŠ›é”®å€¼ï¼ˆKVï¼‰çŠ¶æ€æœ‰3TBçš„å†…å­˜å ç”¨ï¼ˆPopeç­‰äººï¼Œ2023å¹´ï¼‰ã€‚å®é™…ä¸Šï¼Œå°†LLMsæ‰©å±•åˆ°æ›´é•¿çš„åºåˆ—ï¼ˆä¾‹å¦‚1Mä¸ªæ ‡è®°ï¼‰å¯¹äºæ ‡å‡†Transformeræ¶æ„æ¥è¯´æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ï¼Œè€Œä¸”éšç€ä¸Šä¸‹æ–‡æ¨¡å‹å˜å¾—è¶Šæ¥è¶Šé•¿ï¼Œå…¶æœåŠ¡æˆæœ¬ä¹Ÿè¶Šæ¥è¶Šé«˜ã€‚&lt;/p&gt;
&lt;p&gt;å‹ç¼©å†…å­˜(Compressive memory)ç³»ç»Ÿæ‰¿è¯ºæ¯”æ³¨æ„åŠ›æœºåˆ¶æ›´å¯æ‰©å±•å’Œé«˜æ•ˆï¼Œç‰¹åˆ«æ˜¯å¯¹äºæé•¿åºåˆ—ï¼ˆKanervaï¼Œ1988å¹´ï¼›Munkhdalaiç­‰äººï¼Œ2019å¹´ï¼‰ã€‚ä¸éšè¾“å…¥åºåˆ—é•¿åº¦å¢é•¿çš„æ•°ç»„ä¸åŒï¼Œå‹ç¼©å†…å­˜ä¸»è¦é€šè¿‡æ”¹å˜å…¶å‚æ•°æ¥å­˜å‚¨å’Œå›å¿†ä¿¡æ¯ï¼Œä»¥å®ç°æœ‰ç•Œçš„å­˜å‚¨å’Œè®¡ç®—æˆæœ¬ã€‚åœ¨å‹ç¼©å†…å­˜ä¸­ï¼Œé€šè¿‡æ”¹å˜å…¶å‚æ•°æ¥æ·»åŠ æ–°ä¿¡æ¯åˆ°å†…å­˜ä¸­ï¼Œç›®æ ‡æ˜¯ç¨åèƒ½å¤Ÿæ¢å¤è¿™äº›ä¿¡æ¯ã€‚ç„¶è€Œï¼Œç›®å‰çš„LLMsè¿˜æ²¡æœ‰çœ‹åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„ã€å®ç”¨çš„å‹ç¼©å†…å­˜æŠ€æœ¯ï¼Œè¯¥æŠ€æœ¯åœ¨ç®€å•æ€§å’Œè´¨é‡ä¹‹é—´å–å¾—äº†å¹³è¡¡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä¸€ç§æ–°çš„æ–¹æ³•ï¼Œä½¿å¾—Transformer LLMsèƒ½å¤Ÿæœ‰æ•ˆåœ°å¤„ç†æ— é™é•¿çš„è¾“å…¥ï¼ŒåŒæ—¶å†…å­˜å ç”¨å’Œè®¡ç®—èµ„æºæœ‰ç•Œã€‚æˆ‘ä»¬æå‡ºçš„æ–¹æ³•çš„ä¸€ä¸ªå…³é”®ç»„æˆéƒ¨åˆ†æ˜¯ä¸€ä¸ªæ–°çš„æ³¨æ„åŠ›æŠ€æœ¯ï¼Œç§°ä¸ºInfini-attentionï¼ˆå›¾1ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;Infini-attentionå°†å‹ç¼©å†…å­˜æ•´åˆåˆ°ä¼ ç»Ÿçš„æ³¨æ„åŠ›æœºåˆ¶ä¸­ï¼Œå¹¶åœ¨å•ä¸ªTransformerå—ä¸­æ„å»ºäº†æ©è”½çš„å±€éƒ¨æ³¨æ„åŠ›(Causal SDPA)å’Œé•¿æœŸçš„çº¿æ€§æ³¨æ„åŠ›(Linear attention)æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://arxiv.org/html/2404.07143v1/x1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å›¾ 1ï¼šInfini-attention å…·æœ‰ä¸€ä¸ªé¢å¤–çš„å‹ç¼©å†…å­˜ï¼Œä½¿ç”¨çº¿æ€§æ³¨æ„åŠ›å¤„ç†æ— é™é•¿çš„ä¸Šä¸‹æ–‡ã€‚${KV}_{s-1}$  å’Œ ${KV}_s$ åˆ†åˆ«æ˜¯å½“å‰å’Œå‰ä¸€ä¸ªè¾“å…¥ç‰‡æ®µçš„æ³¨æ„åŠ›é”®å’Œå€¼ï¼Œè€Œ  $Q_s$ æ˜¯æ³¨æ„åŠ›æŸ¥è¯¢ã€‚PE è¡¨ç¤ºä½ç½®åµŒå…¥ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§å¯¹Transformeræ³¨æ„åŠ›å±‚çš„å¾®å¦™ä½†å…³é”®çš„ä¿®æ”¹ï¼Œä½¿å¾—ç°æœ‰çš„LLMsèƒ½å¤Ÿé€šè¿‡æŒç»­çš„é¢„è®­ç»ƒå’Œå¾®è°ƒï¼Œè‡ªç„¶åœ°æ‰©å±•åˆ°æ— é™é•¿çš„ä¸Šä¸‹æ–‡ã€‚æˆ‘ä»¬çš„Infini-attentioné‡ç”¨äº†æ ‡å‡†æ³¨æ„åŠ›è®¡ç®—çš„æ‰€æœ‰é”®ã€å€¼å’ŒæŸ¥è¯¢çŠ¶æ€ï¼Œç”¨äºé•¿æœŸå†…å­˜çš„å·©å›ºå’Œæ£€ç´¢ã€‚æˆ‘ä»¬å°†æ³¨æ„åŠ›çš„æ—§KVçŠ¶æ€å­˜å‚¨åœ¨å‹ç¼©å†…å­˜ä¸­ï¼Œè€Œä¸æ˜¯åƒåœ¨æ ‡å‡†æ³¨æ„åŠ›æœºåˆ¶ä¸­é‚£æ ·ä¸¢å¼ƒå®ƒä»¬ã€‚ç„¶åï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨æ³¨æ„åŠ›æŸ¥è¯¢çŠ¶æ€å¤„ç†åç»­åºåˆ—æ—¶ï¼Œä»å†…å­˜ä¸­æ£€ç´¢å€¼ã€‚ä¸ºäº†è®¡ç®—æœ€ç»ˆçš„ä¸Šä¸‹æ–‡è¾“å‡ºï¼ŒInfini-attentionèšåˆäº†é•¿æœŸå†…å­˜æ£€ç´¢åˆ°çš„å€¼å’Œå±€éƒ¨æ³¨æ„åŠ›ä¸Šä¸‹æ–‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çš„å®éªŒä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†æˆ‘ä»¬çš„æ–¹æ³•åœ¨é•¿ä¸Šä¸‹æ–‡è¯­è¨€å»ºæ¨¡åŸºå‡†æµ‹è¯•ä¸­èƒœè¿‡äº†åŸºçº¿æ¨¡å‹ï¼ŒåŒæ—¶åœ¨å†…å­˜å¤§å°ä¸Šå…·æœ‰114å€çš„ç†è§£æ¯”ç‡ã€‚å½“ä½¿ç”¨100Kåºåˆ—é•¿åº¦è¿›è¡Œè®­ç»ƒæ—¶ï¼Œæ¨¡å‹è¾¾åˆ°äº†æ›´ä½çš„å›°æƒ‘åº¦(perplexity)ã€‚ä¸€ä¸ª1B LLMè‡ªç„¶æ‰©å±•åˆ°1Måºåˆ—é•¿åº¦ï¼Œå¹¶åœ¨æ³¨å…¥Infini-attentionåè§£å†³äº†å£ä»¤(passkey)æ£€ç´¢ä»»åŠ¡ã€‚æœ€åï¼Œæˆ‘ä»¬å±•ç¤ºäº†ä¸€ä¸ª8Bæ¨¡å‹åœ¨æŒç»­é¢„è®­ç»ƒå’Œä»»åŠ¡å¾®è°ƒåï¼Œä½¿ç”¨Infini-attentionåœ¨500Ké•¿åº¦çš„ä¹¦ç±æ‘˜è¦ä»»åŠ¡ä¸Šè¾¾åˆ°äº†æ–°çš„SOTAç»“æœã€‚&lt;/p&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œæˆ‘ä»¬çš„å·¥ä½œåšå‡ºäº†ä»¥ä¸‹è´¡çŒ®ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªå®ç”¨è€Œå¼ºå¤§çš„æ³¨æ„åŠ›æœºåˆ¶Infini-attentionï¼Œå®ƒå…·æœ‰é•¿æœŸå‹ç¼©å†…å­˜å’Œå±€éƒ¨å› æœæ³¨æ„åŠ›ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°å»ºæ¨¡é•¿è·ç¦»å’ŒçŸ­è·ç¦»çš„ä¸Šä¸‹æ–‡ä¾èµ–å…³ç³»ã€‚&lt;/li&gt;
&lt;li&gt;Infini-attentionå¯¹æ ‡å‡†çš„ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›è¿›è¡Œäº†æœ€å°çš„æ”¹å˜ï¼Œå¹¶æ”¯æŒå³æ’å³ç”¨çš„æŒç»­é¢„è®­ç»ƒå’Œé•¿ä¸Šä¸‹æ–‡é€‚åº”ã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬çš„æ–¹æ³•ä½¿Transformer LLMsèƒ½å¤Ÿé€šè¿‡æµå¼å¤„ç†æé•¿çš„è¾“å…¥ï¼Œæ‰©å±•åˆ°æ— é™é•¿çš„ä¸Šä¸‹æ–‡ï¼ŒåŒæ—¶ä¿æŒæœ‰ç•Œçš„å†…å­˜å’Œè®¡ç®—èµ„æºã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;2-æ–¹æ³•&#34;&gt;2 æ–¹æ³•&lt;/h2&gt;
&lt;p&gt;å›¾2æ¯”è¾ƒäº†æˆ‘ä»¬çš„æ¨¡å‹Infini-Transformerå’ŒTransformer-XLï¼ˆDaiç­‰äººï¼Œ2019å¹´ï¼‰ã€‚ä¸Transformer-XLç±»ä¼¼ï¼ŒInfini-Transformeråœ¨ä¸€ç³»åˆ—ç‰‡æ®µä¸Šæ“ä½œã€‚æˆ‘ä»¬åœ¨æ¯ä¸ªç‰‡æ®µå†…è®¡ç®—æ ‡å‡†çš„å› æœç‚¹ç§¯æ³¨æ„åŠ›ä¸Šä¸‹æ–‡ã€‚å› æ­¤ï¼Œç‚¹ç§¯æ³¨æ„åŠ›è®¡ç®—åœ¨æŸç§æ„ä¹‰ä¸Šæ˜¯å±€éƒ¨çš„ï¼Œå®ƒæ¶µç›–äº†å½“å‰ç‰‡æ®µSï¼ˆNæ˜¯ç‰‡æ®µé•¿åº¦ï¼‰ï¼Œæ€»å…±Nä¸ªtokenã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://arxiv.org/html/2404.07143v1/x2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å›¾ 2ï¼šInfini-Transformerï¼ˆé¡¶éƒ¨ï¼‰å…·æœ‰å®Œæ•´çš„ä¸Šä¸‹æ–‡å†å²ï¼Œè€Œ Transformer-XLï¼ˆåº•éƒ¨ï¼‰ä¼šä¸¢å¼ƒæ—§çš„ä¸Šä¸‹æ–‡ï¼Œå› ä¸ºå®ƒåªç¼“å­˜äº†æœ€åä¸€ä¸ªç‰‡æ®µçš„ KV çŠ¶æ€ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œå±€éƒ¨æ³¨æ„åŠ›ï¼ˆDaiç­‰äººï¼Œ2019å¹´ï¼‰åœ¨å¤„ç†ä¸‹ä¸€ä¸ªç‰‡æ®µæ—¶ä¼šä¸¢å¼ƒå‰ä¸€ä¸ªç‰‡æ®µçš„æ³¨æ„åŠ›çŠ¶æ€ã€‚åœ¨Infini-Transformersä¸­ï¼Œæˆ‘ä»¬æå‡ºä¸ä»…ä¸ä¸¢å¼ƒæ—§çš„KVæ³¨æ„åŠ›çŠ¶æ€ï¼Œè€Œæ˜¯é‡ç”¨å®ƒä»¬æ¥é€šè¿‡å‹ç¼©å†…å­˜ç»´æŒæ•´ä¸ªä¸Šä¸‹æ–‡å†å²ã€‚å› æ­¤ï¼ŒInfini-Transformersçš„æ¯ä¸ªæ³¨æ„åŠ›å±‚éƒ½å…·æœ‰å…¨å±€å‹ç¼©å’Œå±€éƒ¨ç»†ç²’åº¦çŠ¶æ€ã€‚æˆ‘ä»¬ç§°è¿™ç§é«˜æ•ˆçš„æ³¨æ„åŠ›æœºåˆ¶ä¸ºInfini-attentionï¼Œå¦‚å›¾1æ‰€ç¤ºï¼Œå¹¶åœ¨ä»¥ä¸‹å„èŠ‚ä¸­æ­£å¼æè¿°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;21-infini-attention&#34;&gt;2.1 Infini-attention&lt;/h3&gt;
&lt;p&gt;å¦‚å›¾1æ‰€ç¤ºï¼Œæˆ‘ä»¬çš„Infini-attentionè®¡ç®—å±€éƒ¨å’Œå…¨å±€ä¸Šä¸‹æ–‡çŠ¶æ€ï¼Œå¹¶ç»“åˆå®ƒä»¬è¾“å‡ºã€‚ä¸å¤šå¤´æ³¨æ„åŠ›ï¼ˆMHAï¼‰ç±»ä¼¼ï¼Œå®ƒåœ¨æ¯ä¸ªæ³¨æ„åŠ›å±‚ä¸­ç»´æŠ¤Hä¸ªå¹¶è¡Œçš„å‹ç¼©å†…å­˜ï¼ˆHæ˜¯æ³¨æ„åŠ›å¤´çš„æ•°é‡ï¼‰ï¼Œé™¤äº†ç‚¹ç§¯æ³¨æ„åŠ›å¤–ã€‚&lt;/p&gt;
&lt;h4 id=&#34;211-ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›&#34;&gt;2.1.1 ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›&lt;/h4&gt;
&lt;p&gt;å¤šå¤´ç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›ï¼ˆVaswaniç­‰äººï¼Œ2017å¹´ï¼‰ï¼Œç‰¹åˆ«æ˜¯å…¶è‡ªæ³¨æ„åŠ›å˜ä½“ï¼ˆMunkhdalaiç­‰äººï¼Œ2016å¹´ï¼›Chengç­‰äººï¼Œ2016å¹´ï¼‰ï¼Œå·²æˆä¸ºLLMsçš„ä¸»è¦æ„å»ºå—ã€‚MHAçš„å¼ºå¤§èƒ½åŠ›å¯ä»¥æ¨¡æ‹Ÿä¸Šä¸‹æ–‡ä¾èµ–çš„åŠ¨æ€è®¡ç®—ï¼Œå¹¶ä¸”å…¶æ—¶é—´æ©è”½çš„ä¾¿åˆ©æ€§åœ¨è‡ªå›å½’ç”Ÿæˆæ¨¡å‹ä¸­å¾—åˆ°äº†å¹¿æ³›åˆ©ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ™®é€š MHA ä¸­ï¼Œä¸€ä¸ªå•ç‹¬çš„æ³¨æ„åŠ›å¤´ï¼ˆheadï¼‰ä»è¾“å…¥åºåˆ—æ®µï¼ˆinput segmentsï¼‰$X \in {\rm I!R}^{N \times d_{model}}$ è®¡ç®—å…¶æ³¨æ„åŠ›ä¸Šä¸‹æ–‡ $A_{dot} \in {\rm I!R}^{N \times d_{value}}$ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ã€‚é¦–å…ˆï¼Œå®ƒè®¡ç®—æ³¨æ„åŠ›çš„æŸ¥è¯¢ï¼ˆqueryï¼‰ã€é”®ï¼ˆkeyï¼‰å’Œå€¼ï¼ˆvalueï¼‰çŠ¶æ€ï¼š
$$
K = XW_K, \text{ } V = XW_V \text{ ä¸” } Q = XW_Q.
$$
è¿™é‡Œï¼Œ$W_K \in {\rm I!R}^{d_{model} \times d_{key}}$ã€$W_V \in {\rm I!R}^{d_{model} \times d_{value}}$ å’Œ $W_Q \in {\rm I!R}^{d_{model} \times d_{key}}$ æ˜¯å¯è®­ç»ƒçš„æŠ•å½±çŸ©é˜µã€‚ç„¶åï¼Œæ³¨æ„åŠ›ä¸Šä¸‹æ–‡è¢«è®¡ç®—ä¸ºæ‰€æœ‰å…¶ä»–å€¼çš„åŠ æƒå¹³å‡å€¼ï¼š&lt;/p&gt;
&lt;p&gt;$$
A_{dot} = \text{softmax}\left(\frac{Q K^T}{\sqrt{d_{model}}}\right) V.
$$
å¯¹äº MHAï¼Œæˆ‘ä»¬å¹¶è¡Œåœ°ä¸ºæ¯ä¸ªåºåˆ—å…ƒç´ è®¡ç®— $H$ ä¸ªæ³¨æ„åŠ›ä¸Šä¸‹æ–‡å‘é‡ï¼Œæ²¿ç€ç¬¬äºŒä¸ªç»´åº¦å°†å®ƒä»¬è¿æ¥èµ·æ¥ï¼Œæœ€åå°†è¿æ¥çš„å‘é‡æŠ•å½±åˆ°æ¨¡å‹ç©ºé—´ä»¥è·å¾—æ³¨æ„åŠ›è¾“å‡ºã€‚&lt;/p&gt;
&lt;h4 id=&#34;212-å‹ç¼©å¼å†…å­˜compressive-memory&#34;&gt;2.1.2 å‹ç¼©å¼å†…å­˜ï¼ˆCompressive Memoryï¼‰&lt;/h4&gt;
&lt;p&gt;åœ¨æ— é™æ³¨æ„åŠ›ï¼ˆInfini-attentionï¼‰ä¸­ï¼Œä¸ä¸ºå‹ç¼©å¼å†…å­˜è®¡ç®—æ–°çš„å†…å­˜æ¡ç›®ä¸åŒï¼Œæˆ‘ä»¬é‡å¤ä½¿ç”¨ç‚¹ç§¯æ³¨æ„åŠ›è®¡ç®—ä¸­çš„æŸ¥è¯¢ï¼ˆqueryï¼‰ã€é”®ï¼ˆkeyï¼‰å’Œå€¼ï¼ˆvalueï¼‰çŠ¶æ€ï¼ˆ$Q$ã€$K$ å’Œ $V$ï¼‰ã€‚ç‚¹ç§¯æ³¨æ„åŠ›å’Œå‹ç¼©å†…å­˜ä¹‹é—´çš„çŠ¶æ€å…±äº«å’Œé‡ç”¨ä¸ä»…å®ç°äº†é«˜æ•ˆçš„å³æ’å³ç”¨é•¿ä¸Šä¸‹æ–‡é€‚åº”ï¼Œè¿˜åŠ å¿«äº†è®­ç»ƒå’Œæ¨ç†é€Ÿåº¦ã€‚ä¸ä¹‹å‰çš„å·¥ä½œï¼ˆMunkhdalaiç­‰äººï¼Œ2019å¹´ï¼‰ç±»ä¼¼ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯åœ¨å‹ç¼©å†…å­˜ä¸­å­˜å‚¨é”®å’Œå€¼çŠ¶æ€çš„ç»‘å®šï¼Œå¹¶ä½¿ç”¨æŸ¥è¯¢å‘é‡è¿›è¡Œæ£€ç´¢ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡æ–‡çŒ®ä¸­æå‡ºäº†ä¸åŒå½¢å¼çš„å‹ç¼©å†…å­˜ï¼ˆHopfieldï¼Œ1982å¹´ï¼›Kanervaï¼Œ1988å¹´ï¼›Schlagç­‰äººï¼Œ2019å¹´ï¼›Munkhdalaiç­‰äººï¼Œ2019å¹´ï¼‰ï¼Œä¸ºäº†ç®€å•å’Œè®¡ç®—æ•ˆç‡ï¼Œæˆ‘ä»¬åœ¨è¿™é¡¹å·¥ä½œä¸­ç”¨å…³è”çŸ©é˜µï¼ˆSchlagç­‰äººï¼Œ2020å¹´ï¼‰å‚æ•°åŒ–å†…å­˜ã€‚è¿™ç§æ–¹æ³•è¿›ä¸€æ­¥å…è®¸æˆ‘ä»¬å°†å†…å­˜æ›´æ–°å’Œæ£€ç´¢è¿‡ç¨‹è§†ä¸ºçº¿æ€§æ³¨æ„åŠ›æœºåˆ¶ï¼ˆShenç­‰äººï¼Œ2018å¹´ï¼‰ï¼Œå¹¶åˆ©ç”¨ç›¸å…³æ–¹æ³•ä¸­çš„ç¨³å®šè®­ç»ƒæŠ€æœ¯ã€‚ç‰¹åˆ«æ˜¯ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†Katharopoulosç­‰äººï¼ˆ2020å¹´ï¼‰çš„æ›´æ–°è§„åˆ™å’Œæ£€ç´¢æœºåˆ¶ï¼Œä¸»è¦æ˜¯å› ä¸ºå…¶ç®€å•æ€§å’Œç«äº‰æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å†…å­˜æ£€ç´¢(Memory retrieval)ã€‚&lt;/strong&gt; åœ¨æ— é™æ³¨æ„åŠ›ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨æŸ¥è¯¢ $Q \in {\rm I!R}^{N \times d_{key}}$ ä»å†…å­˜ $M_{s-1} \in {\rm I!R}^{d_{key} \times d_{value}}$ ä¸­æ£€ç´¢æ–°çš„å†…å®¹ $A_{mem} \in {\rm I!R}^{N \times d_{value}}$ï¼Œè®¡ç®—å¦‚ä¸‹ï¼š
$$
A_{mem} =  \frac{\sigma({Q}) M_{s-1}}
{{\sigma(Q)} z_{s-1}}.
$$
è¿™é‡Œï¼Œ$\sigma$ å’Œ $z_{s-1} \in {\rm I!R}^{d_{key}}$ åˆ†åˆ«æ˜¯éçº¿æ€§æ¿€æ´»å‡½æ•°å’Œå½’ä¸€åŒ–é¡¹ã€‚ç”±äºéçº¿æ€§å’Œè§„èŒƒåŒ–æ–¹æ³•çš„é€‰æ‹©å¯¹è®­ç»ƒç¨³å®šæ€§è‡³å…³é‡è¦ï¼Œå› æ­¤æˆ‘ä»¬éµå¾ªKatharopoulosç­‰äººï¼ˆ2020å¹´ï¼‰è®°å½•æ‰€æœ‰é”®çš„æ€»å’Œä½œä¸ºå½’ä¸€åŒ–é¡¹$z_{s-1}$ï¼Œå¹¶ä½¿ç”¨é€å…ƒç´ ELU + 1ä½œä¸ºæ¿€æ´»å‡½æ•°ï¼ˆClevertç­‰äººï¼Œ2015å¹´ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å†…å­˜æ›´æ–°(Memory update)ã€‚&lt;/strong&gt; ä¸€æ—¦æ£€ç´¢å®Œæˆï¼Œæˆ‘ä»¬ä½¿ç”¨æ–°çš„ KV æ¡ç›®æ›´æ–°å†…å­˜å’Œå½’ä¸€åŒ–é¡¹ï¼Œå¹¶è·å¾—ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
$$
M_{s} \leftarrow M_{s-1} + \sigma(K)^T V \text{ å’Œ } z_{s} \leftarrow z_{s-1} + \sum_{t=1}^N \sigma(K_t).
$$
æ–°çš„å†…å­˜çŠ¶æ€ $M_{s}$ å’Œ $z_{s}$ ç„¶åä¼ é€’ç»™ä¸‹ä¸€ä¸ªæ®µ $S+1$ï¼Œåœ¨æ¯ä¸ªæ³¨æ„åŠ›å±‚ä¸­å½¢æˆäº†ä¸€ä¸ªé€’å½’ã€‚å¼ä¸­çš„å³ä¾§é¡¹ $\sigma(K)^T V $ è¢«ç§°ä¸ºå…³è”ç»‘å®šç®—å­ã€‚&lt;/p&gt;
&lt;p&gt;å—åˆ°å¢é‡è§„åˆ™(Delta Rule)çš„æˆåŠŸå¯å‘ï¼Œæˆ‘ä»¬è¿˜å°†å…¶çº³å…¥äº†æˆ‘ä»¬çš„æ— é™æ³¨æ„åŠ›ä¸­ã€‚å¢é‡è§„åˆ™å°è¯•é€šè¿‡é¦–å…ˆæ£€ç´¢ç°æœ‰å€¼æ¡ç›®å¹¶å°†å®ƒä»¬ä»æ–°å€¼ä¸­å‡å»ï¼Œç„¶ååº”ç”¨å…³è”ç»‘å®šä½œä¸ºæ–°çš„æ›´æ–°ï¼Œç¨å¾®æ”¹è¿›äº†å†…å­˜æ›´æ–°ã€‚
$$
M_{s} \leftarrow M_{s-1} + \sigma(K)^T (V - \frac{\sigma({K}) M_{s-1}}
{{\sigma(K)} z_{s-1}}).
$$
æ›´æ–°è§„åˆ™ï¼ˆçº¿æ€§(Linear) + å¢é‡(Delta)ï¼‰ï¼šå¦‚æœåœ¨ KV ç»‘å®šå·²ç»å­˜åœ¨äºå†…å­˜ä¸­ï¼Œåˆ™ä¿æŒå…³è”çŸ©é˜µä¸å˜ï¼ŒåŒæ—¶ï¼Œä»è·Ÿè¸ªä¸å‰ä¸€ä¸ªæ›´æ–°è§„åˆ™ç›¸åŒçš„å½’ä¸€åŒ–é¡¹ï¼ˆçº¿æ€§ï¼‰ä»¥ä¿è¯æ•°å€¼ç¨³å®šæ€§ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é•¿æœŸä¸Šä¸‹æ–‡æ³¨å…¥(Long-term context injection)ã€‚&lt;/strong&gt; æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå­¦ä¹ å¾—åˆ°çš„é—¨æ§æ ‡é‡ $\beta$ èšåˆäº†å±€éƒ¨æ³¨æ„åŠ›çŠ¶æ€ $A_{dot}$ å’Œå†…å­˜æ£€ç´¢çš„å†…å®¹ $A_{mem}$ï¼š
$$
A = \textit{sigmoid} (\beta) \odot A_{mem} + (1 - \textit{sigmoid}(\beta)) \odot A_{dot}.
$$
è¿™ä»…å¢åŠ äº†æ¯ä¸ªå¤´éƒ¨çš„å•ä¸ªæ ‡é‡å€¼ä½œä¸ºè®­ç»ƒå‚æ•°ï¼ŒåŒæ—¶å…è®¸åœ¨æ¨¡å‹ä¸­å­¦ä¹ é•¿æœŸå’Œå±€éƒ¨ä¿¡æ¯æµä¹‹é—´çš„å¯å­¦ä¹ æƒè¡¡ã€‚ä¸æ ‡å‡† MHA ç±»ä¼¼ï¼Œå¯¹äºå¤šå¤´çš„æ— é™æ³¨æ„åŠ›ï¼Œæˆ‘ä»¬å¹¶è¡Œè®¡ç®— $H$ ä¸ªä¸Šä¸‹æ–‡çŠ¶æ€ï¼Œå¹¶å°†å®ƒä»¬è¿æ¥å’ŒæŠ•å½±ä»¥è·å¾—æœ€ç»ˆçš„æ³¨æ„åŠ›è¾“å‡º $O \in  {\rm I!R}^{N \times d_{model}}$ï¼š
$$
O = [A^1; \dotso A^H] W_O
$$&lt;/p&gt;
&lt;p&gt;å…¶ä¸­ $W_O \in {\rm I!R}^{H \times d_{value} \times d_{model}}$ æ˜¯å¯è®­ç»ƒæƒé‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;22-å†…å­˜å’Œæœ‰æ•ˆä¸Šä¸‹æ–‡çª—å£memory-and-effective-context-window&#34;&gt;2.2 å†…å­˜å’Œæœ‰æ•ˆä¸Šä¸‹æ–‡çª—å£(Memory and Effective Context Window)&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Model&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Memory (cache) footprint&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Context length&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Memory update&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Memory retrieval&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Transformer-XL&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;$(d_{key} + d_{value}) \times H \times N \times l$&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;$N \times l$&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Discarded(ä¸¢å¼ƒ)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Dot-product attention&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Compressive Transformer&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;$d_{model} \times (c + N) \times l$&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;$(c \times r + N) \times l$&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Discarded(ä¸¢å¼ƒ)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Dot-product attention&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;Memorizing Transformers&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;$(d_{key} + d_{value}) \times H \times N \times S$&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;$N \times S$&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;None&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;kNN + dot-product attention&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;RMT&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;$d_{model} \times p \times l \times 2$&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;$N \times S$&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Discarded(ä¸¢å¼ƒ)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Soft-prompt input&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;AutoCompressors&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;$d_{model} \times p \times (m + 1) \times l$&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;$N \times S$&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Discarded(ä¸¢å¼ƒ)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Soft-prompt input&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;Infini-Transformers&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;$d_{key} \times (d_{value} + 1) \times H \times l$&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;$N \times S$&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Incremental(å¢é‡)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Linear attention&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;em&gt;è¡¨1:  åˆ—å‡ºäº†ä»¥å‰å…·æœ‰æ®µçº§å†…å­˜çš„ Transformer æ¨¡å‹åŠå…¶ä¸Šä¸‹æ–‡-å†…å­˜å ç”¨(footprint)å’Œæœ‰æ•ˆä¸Šä¸‹æ–‡é•¿åº¦ï¼Œè¿™äº›é•¿åº¦æ˜¯æ ¹æ®æ¨¡å‹å‚æ•°å’Œè¾“å…¥æ®µé•¿åº¦å®šä¹‰çš„ã€‚å¯¹äºæ¯ä¸ªæ¨¡å‹ï¼Œå†…å­˜å¤§å°å’Œæœ‰æ•ˆä¸Šä¸‹æ–‡é•¿åº¦çš„å®šä¹‰å¦‚ä¸‹ï¼š$N$ï¼šè¾“å…¥æ®µé•¿åº¦ï¼Œ$S$ï¼šæ®µçš„æ•°é‡ï¼Œ$l$ï¼šå±‚æ•°ï¼Œ$H$ï¼šæ³¨æ„åŠ›å¤´çš„æ•°é‡ï¼Œ$c$ï¼šå‹ç¼©å¼ Transformer å†…å­˜å¤§å°ï¼Œ$r$ï¼šå‹ç¼©æ¯”ç‡ï¼Œ$p$ï¼šè½¯æç¤ºæ‘˜è¦å‘é‡(soft-prompt summary vectors)çš„æ•°é‡ï¼Œ$m$ï¼šæ‘˜è¦å‘é‡ç§¯ç´¯æ­¥éª¤æ•°ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬çš„ Infini-Transformer èƒ½å¤Ÿä»¥æœ‰é™çš„å†…å­˜å ç”¨å®ç°æ— ç•Œä¸Šä¸‹æ–‡çª—å£ã€‚ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œè¡¨1 åˆ—å‡ºäº†å…ˆå‰å…·æœ‰æ®µçº§å†…å­˜çš„æ¨¡å‹åŠå…¶ä¸Šä¸‹æ–‡-å†…å­˜å ç”¨å’Œæœ‰æ•ˆä¸Šä¸‹æ–‡é•¿åº¦ï¼Œè¿™äº›é•¿åº¦æ˜¯æ ¹æ®æ¨¡å‹å‚æ•°å’Œè¾“å…¥æ®µé•¿åº¦å®šä¹‰çš„ã€‚Infini-Transformer å¯¹äºæ¯ä¸ªå¤´éƒ¨åœ¨å•ä¸ªå±‚ä¸­å­˜å‚¨å‹ç¼©çš„ä¸Šä¸‹æ–‡çš„å†…å­˜å¤æ‚åº¦ä¸º $d_{key} \times d_{value} + d_{key}$ï¼Œè€Œå¯¹äºå…¶ä»–æ¨¡å‹ï¼Œå¤æ‚åº¦éšç€åºåˆ—ç»´åº¦å¢é•¿è€Œå¢åŠ  - å†…å­˜å¤æ‚åº¦è¦ä¹ˆä¾èµ–äºç¼“å­˜å¤§å°ï¼ˆå¦‚ Transformer-XL~(Daiç­‰ï¼Œ2019å¹´)ã€Compressive Transformer~(Raeç­‰ï¼Œ2019å¹´)å’ŒMemorizing Transformers~(Wuç­‰ï¼Œ2022å¹´)ï¼‰ï¼Œè¦ä¹ˆä¾èµ–äºè½¯æç¤ºå¤§å°ï¼ˆå¦‚ RTM~(Bulatovç­‰ï¼Œ2022å¹´) å’Œ AutoCompressors~(Geç­‰ï¼Œ2023å¹´)ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;Transformer-XL åœ¨è®¡ç®—æ³¨æ„åŠ›æ—¶ï¼Œé™¤äº†å½“å‰çŠ¶æ€å¤–ï¼Œè¿˜ä¼šå¯¹ä¸Šä¸€æ®µç¼“å­˜çš„ KV çŠ¶æ€è¿›è¡Œæ³¨æ„åŠ›è®¡ç®—ã€‚ç”±äºè¿™æ˜¯åœ¨æ¯ä¸€å±‚éƒ½è¿›è¡Œçš„æ“ä½œï¼Œå› æ­¤ Transformer-XL å°†ä¸Šä¸‹æ–‡çª—å£ä» $N$ æ‰©å±•åˆ° $N \times l$ ä¸ªæ ‡è®°ï¼Œè€Œé¢å¤–çš„å†…å­˜å ç”¨ä¸º $(d_{key} + d_{value}) \times H \times N \times l$ã€‚Compressive Transformer åœ¨ Transformer-XL çš„åŸºç¡€ä¸Šå¢åŠ äº†ç¬¬äºŒä¸ªç¼“å­˜ï¼Œå¹¶å­˜å‚¨è¿‡å»æ®µæ¿€æ´»çš„å‹ç¼©è¡¨ç¤ºã€‚å› æ­¤ï¼Œå®ƒå°† Transformer-XL çš„ä¸Šä¸‹æ–‡çª—å£æ‰©å±•äº† $c \times r \times l$ï¼Œä½†ä»å…·æœ‰è¾ƒå¤§çš„ä¸Šä¸‹æ–‡-å†…å­˜å¤æ‚åº¦ã€‚Memorizing Transformers é€‰æ‹©å°†æ•´ä¸ª KV çŠ¶æ€ä½œä¸ºè¾“å…¥åºåˆ—çš„ä¸Šä¸‹æ–‡å­˜å‚¨ã€‚ç”±äºåœ¨è¿™ç§æƒ…å†µä¸‹å­˜å‚¨å˜å¾—æˆæœ¬è¿‡é«˜ï¼Œå› æ­¤å®ƒä»¬å°†ä¸Šä¸‹æ–‡è®¡ç®—é™åˆ¶ä¸ºä»…åœ¨å•ä¸ªå±‚ä¸­è¿›è¡Œã€‚&lt;strong&gt;é€šè¿‡åˆ©ç”¨å¿«é€Ÿ kNN æ£€ç´¢å™¨ï¼ŒMemorizing Transformers æ„å»ºä¸€ä¸ªè¦†ç›–æ•´ä¸ªåºåˆ—å†å²çš„ä¸Šä¸‹æ–‡çª—å£ï¼Œé•¿åº¦ä¸º $N \times S$ï¼Œä½†å­˜å‚¨æˆæœ¬å¢åŠ äº†ã€‚æˆ‘ä»¬çš„å®éªŒè¡¨æ˜ï¼Œåœ¨ Memorizing Transformers çš„åŸºç¡€ä¸Šï¼ŒInfini-Transformer LM å¯ä»¥å®ç°è¶…è¿‡ 100 å€çš„å‹ç¼©ç‡ï¼ŒåŒæ—¶è¿›ä¸€æ­¥æ”¹å–„äº†å›°æƒ‘åº¦(perplexity)å¾—åˆ†&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;RMT å’Œ AutoCompressors å…è®¸æ½œåœ¨çš„æ— é™ä¸Šä¸‹æ–‡é•¿åº¦ï¼Œå› ä¸ºå®ƒä»¬å°†è¾“å…¥å‹ç¼©æˆæ‘˜è¦å‘é‡ï¼Œç„¶åå°†å®ƒä»¬ä½œä¸ºé¢å¤–çš„è½¯æç¤ºè¾“å…¥ä¼ é€’ç»™åç»­çš„æ®µè½ã€‚ç„¶è€Œï¼Œåœ¨å®è·µä¸­ï¼Œè¿™äº›æŠ€æœ¯çš„æˆåŠŸç¨‹åº¦é«˜åº¦ä¾èµ–äºè½¯æç¤ºå‘é‡çš„å¤§å°&lt;/strong&gt;ã€‚æ¢å¥è¯è¯´ï¼Œä¸ºäº†ä½¿ AutoCompressors (Chevalier ç­‰ï¼Œ2023å¹´) å®ç°æ›´å¥½çš„æ€§èƒ½ï¼Œéœ€è¦å¢åŠ è½¯æç¤ºï¼ˆæ‘˜è¦ï¼‰å‘é‡çš„æ•°é‡ï¼Œè€Œè¿™æ ·åšä¼šå¯¼è‡´å†…å­˜å’Œè®¡ç®—å¤æ‚åº¦è¿…é€Ÿå¢é•¿ï¼Œä»è€Œé™ä½æ•ˆç‡ã€‚ä¹Ÿè§‚å¯Ÿåˆ°åœ¨ AutoCompressors (Chevalier ç­‰ï¼Œ2023å¹´) ä¸­éœ€è¦ä¸€ä¸ªé«˜æ•ˆçš„å‹ç¼©ç›®æ ‡æ¥è®­ç»ƒè¿™ç§æç¤ºå‹ç¼©æŠ€æœ¯ (Ge ç­‰ï¼Œ2023å¹´)ã€‚&lt;/p&gt;
&lt;h2 id=&#34;3-å®éªŒ&#34;&gt;3 å®éªŒ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨æ¶‰åŠæé•¿è¾“å…¥åºåˆ—çš„åŸºå‡†æ•°æ®é›†ä¸Šè¯„ä¼°äº†æˆ‘ä»¬çš„ Infini-Transformer æ¨¡å‹ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é•¿ä¸Šä¸‹æ–‡è¯­è¨€å»ºæ¨¡ã€100ä¸‡é•¿åº¦å£ä»¤(passkey)å—æ£€ç´¢å’Œ50ä¸‡é•¿åº¦ä¹¦ç±æ‘˜è¦ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºé•¿ä¸Šä¸‹æ–‡è¯­è¨€å»ºæ¨¡åŸºå‡†ï¼Œæˆ‘ä»¬ä»å¤´å¼€å§‹è®­ç»ƒæˆ‘ä»¬çš„æ¨¡å‹ï¼›&lt;/p&gt;
&lt;p&gt;è€Œå¯¹äºå£ä»¤(passkey)å—å’Œä¹¦ç±æ‘˜è¦ä»»åŠ¡ï¼Œæˆ‘ä»¬æŒç»­é¢„è®­ç»ƒç°æœ‰çš„ LLMsï¼Œä»¥çªå‡ºæˆ‘ä»¬æ–¹æ³•çš„æ’æ‹”å¼é•¿ä¸Šä¸‹æ–‡é€‚åº”èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;åŸºå‡†æ•°æ®é›†ï¼š PG19 å’Œ Arxiv-math&lt;/p&gt;
&lt;p&gt;ç»§ç»­é¢„è®­æ•°æ®é›†ï¼šPG19 å’Œ Arxiv-math + é•¿åº¦è¶…è¿‡ 4K tokençš„ C4 æ–‡æœ¬&lt;/p&gt;
&lt;p&gt;å¾®è°ƒæ•°æ®ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;passkeyæ£€ç´¢ä»»åŠ¡æ•°æ® å°†ä¸€ä¸ªéšæœºæ•°å­—éšè—åœ¨ä¸€æ®µé•¿æ–‡æœ¬ä¸­ï¼Œå¹¶è¦æ±‚åœ¨æ¨¡å‹è¾“å‡ºä¸­æ‰¾å›è¯¥æ•°å­—(è„šæœ¬ç”Ÿæˆå³å¯)&lt;/li&gt;
&lt;li&gt;ä¹¦ç±æ‘˜è¦ä»»åŠ¡ BookSum æ•°æ®é›†ï¼š &lt;a href=&#34;https://huggingface.co/datasets/kmfoda/booksum&#34;&gt;https://huggingface.co/datasets/kmfoda/booksum&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;31-é•¿ä¸Šä¸‹æ–‡è¯­è¨€å»ºæ¨¡&#34;&gt;3.1 é•¿ä¸Šä¸‹æ–‡è¯­è¨€å»ºæ¨¡&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨ PG19ï¼ˆRae ç­‰ï¼Œ2019å¹´ï¼‰å’Œ Arxiv-mathï¼ˆWu ç­‰ï¼Œ2022å¹´ï¼‰åŸºå‡†æ•°æ®é›†ä¸Šè®­ç»ƒå’Œè¯„ä¼°äº†å°å‹çš„ Infini-Transformer æ¨¡å‹ã€‚æˆ‘ä»¬çš„è®¾ç½®ä¸ Memorizing Transformersï¼ˆWu ç­‰ï¼Œ2022å¹´ï¼‰éå¸¸ç›¸ä¼¼ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„æ¨¡å‹éƒ½æœ‰ 12 å±‚ï¼Œæ¯å±‚æœ‰ 8 ä¸ªæ³¨æ„åŠ›å¤´ï¼Œæ¯ä¸ªå¤´çš„ç»´åº¦ä¸º 128ï¼Œä»¥åŠéšè—å±‚ä¸º 4096 çš„ FFNsã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°† Infini-attention çš„æ®µé•¿åº¦ $N$ è®¾ç½®ä¸º 2048ï¼Œå¯¹äºæ‰€æœ‰çš„æ³¨æ„åŠ›å±‚&lt;strong&gt;è¾“å…¥åºåˆ—é•¿åº¦è®¾ç½®ä¸º 32768&lt;/strong&gt; è¿›è¡Œè®­ç»ƒã€‚è¿™æ ·å¯ä»¥è®© Infini-attention åœ¨å…³äºå…¶å‹ç¼©å†…å­˜çŠ¶æ€çš„ 16 ä¸ªæ­¥éª¤ä¸Šå±•å¼€ã€‚å¯¹äº RMT åŸºçº¿ï¼Œæˆ‘ä»¬è¿›è¡Œäº†å‡ æ¬¡è¿è¡Œï¼Œæ‘˜è¦æç¤ºé•¿åº¦ä¸º 50ã€100 å’Œ 150ï¼Œåºåˆ—é•¿åº¦åˆ†åˆ«ä¸º 4096ã€8196 å’Œ 32768ã€‚å½“åœ¨é•¿åº¦ä¸º 8196 çš„åºåˆ—ä¸Šè®­ç»ƒæ—¶ï¼ŒRMT ä½¿ç”¨ 100 ä¸ªæ‘˜è¦å‘é‡æ—¶è¾¾åˆ°äº†æœ€ä½³ç»“æœã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Model&lt;/th&gt;
&lt;th&gt;Memory size (comp.)&lt;/th&gt;
&lt;th&gt;XL cache&lt;/th&gt;
&lt;th&gt;Segment length&lt;/th&gt;
&lt;th&gt;PG19&lt;/th&gt;
&lt;th&gt;Arxiv-math&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Transformer-XL&lt;/td&gt;
&lt;td&gt;50M (3.7x)&lt;/td&gt;
&lt;td&gt;2048&lt;/td&gt;
&lt;td&gt;2048&lt;/td&gt;
&lt;td&gt;11.88&lt;/td&gt;
&lt;td&gt;2.42&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Memorizing Transformers&lt;/td&gt;
&lt;td&gt;183M (1x)&lt;/td&gt;
&lt;td&gt;2048&lt;/td&gt;
&lt;td&gt;2048&lt;/td&gt;
&lt;td&gt;11.37&lt;/td&gt;
&lt;td&gt;2.26&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;RMT&lt;/td&gt;
&lt;td&gt;2.5M (73x)&lt;/td&gt;
&lt;td&gt;None&lt;/td&gt;
&lt;td&gt;2048&lt;/td&gt;
&lt;td&gt;13.27&lt;/td&gt;
&lt;td&gt;2.55&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Infini-Transformer (Linear)&lt;/td&gt;
&lt;td&gt;1.6M (114x)&lt;/td&gt;
&lt;td&gt;None&lt;/td&gt;
&lt;td&gt;2048&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;9.65&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;2.24&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Infini-Transformer (Linear + Delta)&lt;/td&gt;
&lt;td&gt;1.6M (114x)&lt;/td&gt;
&lt;td&gt;None&lt;/td&gt;
&lt;td&gt;2048&lt;/td&gt;
&lt;td&gt;9.67&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;2.23&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;em&gt;è¡¨2ï¼šé•¿ä¸Šä¸‹æ–‡è¯­è¨€å»ºæ¨¡ç»“æœä»¥å¹³å‡å•è¯çº§å›°æƒ‘åº¦è¿›è¡Œæ¯”è¾ƒã€‚Comp. è¡¨ç¤ºå‹ç¼©æ¯”ã€‚Infini-Transformer æ¨¡å‹ä¼˜äºå†…å­˜å˜å‹å™¨ï¼ˆMemorizing Transformersï¼‰ï¼Œå…¶å­˜å‚¨å™¨é•¿åº¦ä¸º 65Kï¼Œå¹¶å®ç°äº†114å€çš„å‹ç¼©æ¯”ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;è¯­è¨€å»ºæ¨¡å®éªŒçš„ä¸»è¦ç»“æœæ€»ç»“åœ¨è¡¨2ä¸­ã€‚ &lt;strong&gt;Infini-Transformer åœ¨ä¿æŒæ¯” Memorizing Transformersï¼ˆWu ç­‰ï¼Œ2022å¹´ï¼‰æ¨¡å‹å‚æ•°å°‘ 114 å€çš„æƒ…å†µä¸‹ï¼Œä¼˜äº Transformer-XLï¼ˆDai ç­‰ï¼Œ2019å¹´ï¼‰å’Œ Memorizing Transformers çš„åŸºå‡†æ¨¡å‹ï¼Œåè€…ä½¿ç”¨åŸºäºå‘é‡æ£€ç´¢çš„ KV å­˜å‚¨å™¨ï¼Œåœ¨å…¶ç¬¬9å±‚å…·æœ‰é•¿åº¦ä¸º 65K çš„å­˜å‚¨å™¨&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;100Ké•¿åº¦è®­ç»ƒã€‚&lt;/strong&gt; æˆ‘ä»¬è¿›ä¸€æ­¥å°†&lt;strong&gt;è®­ç»ƒåºåˆ—é•¿åº¦ä»32Kå¢åŠ åˆ°100K&lt;/strong&gt;ï¼Œå¹¶åœ¨ Arxiv-math æ•°æ®é›†ä¸Šå¯¹æ¨¡å‹è¿›è¡Œäº†è®­ç»ƒã€‚100Kçš„è®­ç»ƒè¿›ä¸€æ­¥å°†å›°æƒ‘åº¦åˆ†æ•°é™ä½åˆ° &lt;strong&gt;2.21&lt;/strong&gt; å’Œ &lt;strong&gt;2.20&lt;/strong&gt; åˆ†åˆ«å¯¹äº $Linear$ å’Œ $Linear + Delta$ æ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é—¨æ§åˆ†æ•°å¯è§†åŒ–(Gating score visualization)ã€‚&lt;/strong&gt; å›¾3 å±•ç¤ºäº†æ¯ä¸€å±‚ä¸­æ‰€æœ‰æ³¨æ„åŠ›å¤´çš„å‹ç¼©å†…å­˜çš„é—¨æ§åˆ†æ•° $\textit{sigmoid}(\beta)$ã€‚åœ¨è®­ç»ƒåï¼ŒInfini-attention ä¸­å‡ºç°äº†ä¸¤ç§ç±»å‹çš„å¤´ï¼šé—¨æ§åˆ†æ•°æ¥è¿‘ 0 æˆ– 1 çš„ä¸“ç”¨å¤´å’Œåˆ†æ•°æ¥è¿‘ 0.5 çš„æ··åˆå¤´ã€‚ä¸“ç”¨å¤´é€šè¿‡å±€éƒ¨æ³¨æ„åŠ›è®¡ç®—å¤„ç†ä¸Šä¸‹æ–‡ä¿¡æ¯æˆ–ä»å‹ç¼©å†…å­˜ä¸­æ£€ç´¢ï¼Œè€Œæ··åˆå¤´å°†å½“å‰ä¸Šä¸‹æ–‡ä¿¡æ¯å’Œé•¿æœŸå†…å­˜å†…å®¹åˆå¹¶åˆ°ä¸€ä¸ªè¾“å‡ºä¸­ã€‚æœ‰è¶£çš„æ˜¯ï¼Œæ¯ä¸€å±‚è‡³å°‘æœ‰ä¸€ä¸ªçŸ­ç¨‹å¤´ï¼Œå…è®¸è¾“å…¥ä¿¡å·å‘å‰ä¼ æ’­ç›´è‡³è¾“å‡ºå±‚ã€‚æˆ‘ä»¬è¿˜è§‚å¯Ÿåˆ°åœ¨æ­£å‘è®¡ç®—è¿‡ç¨‹ä¸­é•¿æœŸå’ŒçŸ­æœŸå†…å®¹çš„æ£€ç´¢äº¤é”™è¿›è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://arxiv.org/html/2404.07143v1/x3.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å›¾3ï¼šå›¾ä¸­æ˜¾ç¤ºäº†è®­ç»ƒåï¼Œåœ¨Infini-attentionä¸­å‡ºç°äº†ä¸¤ç§ç±»å‹çš„æ³¨æ„åŠ›å¤´ï¼šå…·æœ‰æ¥è¿‘0æˆ–1çš„é—¨æ§åˆ†æ•°(gating score)çš„ä¸“ç”¨å¤´å’Œæ¥è¿‘0.5çš„æ··åˆå¤´ã€‚ä¸“ç”¨å¤´é€šè¿‡å±€éƒ¨æ³¨æ„åŠ›æœºåˆ¶å¤„ç†ä¸Šä¸‹æ–‡ä¿¡æ¯æˆ–ä»å‹ç¼©å†…å­˜ä¸­æ£€ç´¢ï¼Œè€Œæ··åˆå¤´å°†å½“å‰ä¸Šä¸‹æ–‡ä¿¡æ¯å’Œé•¿æœŸ(long-term)å†…å­˜å†…å®¹èšåˆåˆ°å•ä¸ªè¾“å‡ºä¸­ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&#34;32-llm-æŒç»­é¢„è®­ç»ƒ&#34;&gt;3.2 LLM æŒç»­é¢„è®­ç»ƒ&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å¯¹ç°æœ‰ LLM è¿›è¡Œäº†è½»é‡çº§çš„æŒç»­é¢„è®­ç»ƒï¼Œä»¥é€‚åº”é•¿ä¸Šä¸‹æ–‡ã€‚é¢„è®­ç»ƒæ•°æ®åŒ…æ‹¬ PG19 å’Œ Arxiv-math è¯­æ–™åº“ä»¥åŠé•¿åº¦è¶…è¿‡ 4K tokençš„ C4 æ–‡æœ¬ï¼ˆRaffelç­‰äººï¼Œ2020ï¼‰ã€‚æˆ‘ä»¬çš„å®éªŒä¸­ï¼Œæ®µé•¿åº¦ $N$ è®¾å®šä¸º 2Kã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1M å£ä»¤(passkey)æ£€ç´¢åŸºå‡†æµ‹è¯•&lt;/strong&gt;ã€‚æˆ‘ä»¬å°†ä¸€ä¸ª 10 äº¿å‚æ•°çš„ LLM ä¸­çš„æ™®é€š MHA æ›¿æ¢ä¸º Infini-attentionï¼Œå¹¶ç»§ç»­å¯¹é•¿åº¦ä¸º 4K çš„è¾“å…¥è¿›è¡Œé¢„è®­ç»ƒã€‚&lt;strong&gt;æ¨¡å‹åœ¨è¿›è¡Œ 1M å£ä»¤(passkey)æ£€ç´¢ä»»åŠ¡ fine-tune ä¹‹å‰ï¼Œä»¥æ‰¹é‡å¤§å°ä¸º 64 è¿›è¡Œäº† 30K æ­¥çš„è®­ç»ƒ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;passkeyæ£€ç´¢ä»»åŠ¡å°†ä¸€ä¸ªéšæœºæ•°å­—éšè—åœ¨ä¸€æ®µé•¿æ–‡æœ¬ä¸­ï¼Œå¹¶è¦æ±‚åœ¨æ¨¡å‹è¾“å‡ºä¸­æ‰¾å›è¯¥æ•°å­—ã€‚&lt;strong&gt;å¹²æ‰°æ–‡æœ¬(distraction text)çš„é•¿åº¦é€šè¿‡å¤šæ¬¡é‡å¤æ–‡æœ¬å—æ¥å˜åŒ–&lt;/strong&gt;, æ ·æœ¬å®ä¾‹è§é™„å½•Bã€‚ä¹‹å‰çš„ç ”ç©¶ï¼ˆChenç­‰äººï¼Œ2023aï¼‰è¡¨æ˜ï¼Œå½“ä½¿ç”¨ç›¸åŒé•¿åº¦ä¸º32Kçš„è¾“å…¥è¿›è¡Œå¾®è°ƒæ—¶ï¼Œ8B LLaMAæ¨¡å‹å¯ä»¥è§£å†³é•¿è¾¾32Kçš„ä»»åŠ¡ï¼Œé‡‡ç”¨ä½ç½®æ’å€¼ã€‚æˆ‘ä»¬è¿›ä¸€æ­¥æŒ‘æˆ˜ï¼Œå¹¶&lt;strong&gt;ä»…åœ¨é•¿åº¦ä¸º5Kçš„è¾“å…¥ä¸Šè¿›è¡Œå¾®è°ƒï¼Œä»¥æµ‹è¯•1Mé•¿åº¦èŒƒå›´çš„ä»»åŠ¡&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¡¨3 è¡¨æ˜ä» 32K åˆ° 1M ä¸åŒé•¿åº¦çš„æµ‹è¯•å­é›†çš„tokençº§å‡†ç¡®ç‡ã€‚å¯¹äºæ¯ä¸ªæµ‹è¯•å­é›†ï¼Œæˆ‘ä»¬æ§åˆ¶äº†å£ä»¤(passkey)çš„ä½ç½®ï¼Œä½¿å…¶ä½äºè¾“å…¥åºåˆ—çš„å¼€å§‹ã€ä¸­é—´æˆ–ç»“å°¾é™„è¿‘ã€‚æˆ‘ä»¬æŠ¥å‘Šäº† zero-shot å‡†ç¡®ç‡(accuracy)å’Œ fine-tuning å‡†ç¡®ç‡(accuracy)ã€‚&lt;strong&gt;Infini-Transformers åœ¨ä½¿ç”¨é•¿åº¦ä¸º 5K çš„è¾“å…¥è¿›è¡Œ 400 æ­¥ fine-tune åï¼Œå¯ä»¥è§£å†³é•¿è¾¾ 1M çš„ä»»åŠ¡&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;/th&gt;
&lt;th&gt;Zero-shot&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;/td&gt;
&lt;td&gt;32K&lt;/td&gt;
&lt;td&gt;128K&lt;/td&gt;
&lt;td&gt;256K&lt;/td&gt;
&lt;td&gt;512K&lt;/td&gt;
&lt;td&gt;1M&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Infini-Transformer (Linear)&lt;/td&gt;
&lt;td&gt;14/13/98&lt;/td&gt;
&lt;td&gt;11/14/100&lt;/td&gt;
&lt;td&gt;6/3/100&lt;/td&gt;
&lt;td&gt;6/7/99&lt;/td&gt;
&lt;td&gt;8/6/98&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Infini-Transformer (Linear + Delta)&lt;/td&gt;
&lt;td&gt;13/11/99&lt;/td&gt;
&lt;td&gt;6/9/99&lt;/td&gt;
&lt;td&gt;7/5/99&lt;/td&gt;
&lt;td&gt;6/8/97&lt;/td&gt;
&lt;td&gt;7/6/97&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;FT (400 steps)&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Infini-Transformer (Linear)&lt;/td&gt;
&lt;td&gt;100/100/100&lt;/td&gt;
&lt;td&gt;100/100/100&lt;/td&gt;
&lt;td&gt;100/100/100&lt;/td&gt;
&lt;td&gt;97/99/100&lt;/td&gt;
&lt;td&gt;96/94/100&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Infini-Transformer (Linear + Delta)&lt;/td&gt;
&lt;td&gt;100/100/100&lt;/td&gt;
&lt;td&gt;100/100/99&lt;/td&gt;
&lt;td&gt;100/100/99&lt;/td&gt;
&lt;td&gt;100/100/100&lt;/td&gt;
&lt;td&gt;100/100/100&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;em&gt;è¡¨3ï¼šå½“åœ¨é•¿åº¦ä¸º5Kçš„è¾“å…¥ä¸Šè¿›è¡Œå¾®è°ƒæ—¶ï¼ŒInfini-Transformersè§£å†³äº†å¸¦æœ‰é•¿è¾¾1Mçš„ä¸Šä¸‹æ–‡é•¿åº¦çš„å£ä»¤(passkey)ä»»åŠ¡ã€‚åœ¨é•¿åº¦ä¸º32Kåˆ°1Mçš„é•¿è¾“å…¥ä¸­éšè—çš„å£ä»¤åœ¨tokençº§åˆ«ä¸Šçš„æ£€ç´¢å‡†ç¡®ç‡ï¼Œè¿™äº›passkeyä½äºä¸åŒéƒ¨åˆ†ï¼ˆ&lt;em&gt;å¼€å§‹/ä¸­é—´/ç»“æŸ&lt;/em&gt;ï¼‰ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;500K é•¿åº¦çš„ä¹¦ç±æ‘˜è¦ï¼ˆBookSumï¼‰&lt;/strong&gt;ã€‚æˆ‘ä»¬è¿›ä¸€æ­¥æ‰©å±•äº†æˆ‘ä»¬çš„æ–¹æ³•ï¼Œ&lt;strong&gt;é€šè¿‡å¯¹ 8K è¾“å…¥é•¿åº¦è¿›è¡Œ 30K æ­¥æŒç»­é¢„è®­ç»ƒï¼Œè¿ç»­é¢„è®­ç»ƒäº†ä¸€ä¸ª 80 äº¿å‚æ•°çš„ LLM æ¨¡å‹&lt;/strong&gt;ã€‚ç„¶åæˆ‘ä»¬åœ¨ä¹¦ç±æ‘˜è¦ä»»åŠ¡ BookSumï¼ˆKryscinskiç­‰äººï¼Œ2021ï¼‰ä¸Šè¿›è¡Œäº†å¾®è°ƒï¼Œè¯¥ä»»åŠ¡çš„ç›®æ ‡æ˜¯ç”Ÿæˆæ•´æœ¬ä¹¦çš„æ‘˜è¦ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†è¾“å…¥é•¿åº¦è®¾ç½®ä¸º 32K è¿›è¡Œå¾®è°ƒï¼Œå¹¶å°†å…¶å¢åŠ åˆ° 500K ä»¥è¿›è¡Œè¯„ä¼°ã€‚æˆ‘ä»¬ä½¿ç”¨ç”Ÿæˆæ¸©åº¦temperatureä¸º 0.5 å’Œ $top_{p} = 0.95$ï¼Œå¹¶å°†è§£ç æ­¥éª¤æ•°é‡è®¾ç½®ä¸º 1024ï¼Œä»¥ç”Ÿæˆæ¯æœ¬ä¹¦çš„æ‘˜è¦ã€‚&lt;/p&gt;
&lt;p&gt;è¡¨4 å°†æˆ‘ä»¬çš„æ¨¡å‹ä¸ä¸“é—¨ç”¨äºæ‘˜è¦ä»»åŠ¡çš„ç¼–ç å™¨-è§£ç å™¨æ¨¡å‹ï¼ˆLewisç­‰äººï¼Œ2019ï¼›Xiaoç­‰äººï¼Œ2021ï¼‰åŠå…¶åŸºäºæ£€ç´¢çš„é•¿ä¸Šä¸‹æ–‡æ‰©å±•ï¼ˆBertschç­‰äººï¼Œ2024ï¼‰è¿›è¡Œäº†æ¯”è¾ƒã€‚æˆ‘ä»¬çš„æ¨¡å‹åœ¨ BookSum ä¸Šè¶…è¶Šäº†å…ˆå‰çš„æœ€ä½³ç»“æœï¼Œå¹¶é€šè¿‡å¤„ç†æ•´æœ¬ä¹¦çš„æ–‡æœ¬å®ç°äº† BookSum ä¸Šçš„æ–° SOTAã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;Model&lt;/th&gt;
&lt;th&gt;Rouge-1&lt;/th&gt;
&lt;th&gt;Rouge-2&lt;/th&gt;
&lt;th&gt;Rouge-L&lt;/th&gt;
&lt;th&gt;Overall&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;BART&lt;/td&gt;
&lt;td&gt;36.4&lt;/td&gt;
&lt;td&gt;7.6&lt;/td&gt;
&lt;td&gt;15.3&lt;/td&gt;
&lt;td&gt;16.2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;BART + Unlimiformer&lt;/td&gt;
&lt;td&gt;36.8&lt;/td&gt;
&lt;td&gt;8.3&lt;/td&gt;
&lt;td&gt;15.7&lt;/td&gt;
&lt;td&gt;16.9&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;PRIMERA&lt;/td&gt;
&lt;td&gt;38.6&lt;/td&gt;
&lt;td&gt;7.2&lt;/td&gt;
&lt;td&gt;15.6&lt;/td&gt;
&lt;td&gt;16.3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;PRIMERA + Unlimiformer&lt;/td&gt;
&lt;td&gt;37.9&lt;/td&gt;
&lt;td&gt;8.2&lt;/td&gt;
&lt;td&gt;16.3&lt;/td&gt;
&lt;td&gt;17.2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Infini-Transformers (Linear)&lt;/td&gt;
&lt;td&gt;37.9&lt;/td&gt;
&lt;td&gt;8.7&lt;/td&gt;
&lt;td&gt;17.6&lt;/td&gt;
&lt;td&gt;18.0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;Infini-Transformers (Linear + Delta)&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;40.0&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;8.8&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;17.9&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;18.5&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;em&gt;è¡¨4ï¼š500Ké•¿åº¦çš„ä¹¦ç±æ‘˜è¦ï¼ˆBookSumï¼‰ç»“æœã€‚BARTã€PRIMERA å’Œ Unlimiformer çš„ç»“æœæ¥è‡ª (Bertschç­‰ 2024)ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜åœ¨å›¾4 ä¸­ç»˜åˆ¶äº† BookSum æ•°æ®éªŒè¯é›†ä¸Šçš„æ•´ä½“ ROUGEï¼ˆRecall-Oriented Understudy for Gisting Evaluationï¼‰è¯„ä¼°åˆ†æ•°ã€‚æœ‰ä¸€ä¸ªæ¸…æ™°çš„è¶‹åŠ¿æ˜¾ç¤ºï¼Œéšç€æä¾›ç»™ä¹¦ç±çš„è¾“å…¥æ–‡æœ¬è¶Šæ¥è¶Šå¤šï¼Œæˆ‘ä»¬çš„ Infini-Transformers åœ¨æ‘˜è¦æ€§èƒ½æŒ‡æ ‡ä¸Šæœ‰æ‰€æå‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://arxiv.org/html/2404.07143v1/x4.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;å›¾ 4ï¼šInfini-Transformer ä½¿ç”¨æ›´å¤šçš„ä¹¦ç±æ–‡æœ¬ä½œä¸ºè¾“å…¥è·å¾—æ›´å¥½çš„ Rouge æ€»ä½“åˆ†æ•°ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;h2 id=&#34;4-ç›¸å…³å·¥ä½œ&#34;&gt;4 ç›¸å…³å·¥ä½œ&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;å‹ç¼©å†…å­˜(Compressive memory)ã€‚&lt;/strong&gt; å—ç”Ÿç‰©ç¥ç»å…ƒå¯å¡‘æ€§çš„å¯å‘ï¼ˆMunkhdalaiç­‰äººï¼Œ2017ï¼›Miconiç­‰äººï¼Œ2018ï¼‰ï¼Œå‹ç¼©å†…å­˜æ–¹æ³•å°†å‚æ•°åŒ–å‡½æ•°è§†ä¸ºå†…å­˜æ¥å­˜å‚¨å’Œæ£€ç´¢ä¿¡æ¯ï¼ˆHintonç­‰äººï¼Œ1987ï¼›Schmidhuberï¼Œ1992ï¼›Baå’ŒHintonï¼Œ2016ï¼›Munkhdalaiå’ŒYuï¼Œ2019ï¼‰ã€‚&lt;strong&gt;ä¸Transformer KV å†…å­˜æ•°ç»„ï¼ˆVaswaniç­‰äººï¼Œ2017ï¼›Wuç­‰äººï¼Œ2022ï¼‰ä¸åŒï¼Œåè€…éšç€è¾“å…¥åºåˆ—é•¿åº¦å¢é•¿ï¼Œå‹ç¼©å†…å­˜ç³»ç»Ÿä¿æŒæ’å®šæ•°é‡çš„å†…å­˜å‚æ•°ä»¥æé«˜è®¡ç®—æ•ˆç‡&lt;/strong&gt;ã€‚è¿™äº›å‚æ•°é€šè¿‡æ›´æ–°è§„åˆ™è¿›è¡Œä¿®æ”¹ä»¥å­˜å‚¨ä¿¡æ¯ï¼Œç„¶åé€šè¿‡å†…å­˜è¯»å–æœºåˆ¶æ£€ç´¢ä¿¡æ¯ï¼ˆGravesç­‰äººï¼Œ2014ï¼›Sukhbaatarç­‰äººï¼Œ2015ï¼›Munkhdalaiç­‰äººï¼Œ2017ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;å‹ç¼©çš„è¾“å…¥è¡¨ç¤ºå¯ä»¥è§†ä¸ºè¿‡å»åºåˆ—ç‰‡æ®µçš„æ‘˜è¦ï¼ˆRaeç­‰äººï¼Œ2019ï¼›Chevalierç­‰äººï¼Œ2023ï¼‰ã€‚æ²¿ç€è¿™ä¸ªæ–¹å‘ï¼Œæ›´è¿‘æœŸçš„å·¥ä½œå·²ç»åˆ©ç”¨Transformer LLM æœ¬èº«æ¥å‹ç¼©è¾“å…¥åºåˆ—ï¼Œä»¥å®ç°é«˜æ•ˆçš„é•¿ä¸Šä¸‹æ–‡å»ºæ¨¡ï¼ˆBulatovç­‰äººï¼Œ2022ï¼›Chevalierç­‰äººï¼Œ2023ï¼›Geç­‰äººï¼Œ2023ï¼›Muç­‰äººï¼Œ2024ï¼‰ã€‚ç„¶è€Œï¼Œ&lt;strong&gt;å…ˆå‰çš„æ®µçº§å‹ç¼©æ–¹æ³•ï¼ŒåŒ…æ‹¬å‹ç¼©Transformerï¼ˆRaeç­‰äººï¼Œ2019ï¼‰ï¼Œä»ä¼šä¸¢å¼ƒæ—§æ®µçš„å†…å­˜æ¡ç›®ï¼Œä»¥é‡Šæ”¾ç©ºé—´ç»™æ–°æ®µï¼Œä»è€Œå°†ä¸Šä¸‹æ–‡çª—å£é™åˆ¶ä¸ºæœ€è¿‘çš„æ®µã€‚è¿™ä¸æˆ‘ä»¬çš„Infini-attentionç›¸åï¼Œåè€…ä»¥é€’å½’æ–¹å¼å¯¹å›ºå®šæ•°é‡çš„å†…å­˜å‚æ•°è¿›è¡Œå¢é‡å†…å­˜æ›´æ–°&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é•¿ä¸Šä¸‹æ–‡æŒç»­é¢„è®­ç»ƒ(Long-context continual pre-training)ã€‚&lt;/strong&gt; æœ‰ä¸€ç³»åˆ—å·¥ä½œåœ¨æ‰©å±•ç‚¹ä¹˜æ³¨æ„åŠ›å±‚çš„åŸºç¡€ä¸Šç»§ç»­å¯¹LLM è¿›è¡Œè®­ç»ƒï¼Œä»¥å¤„ç†é•¿ä¸Šä¸‹æ–‡ï¼ˆXiongç­‰äººï¼Œ2023ï¼›Fuç­‰äººï¼Œ2024ï¼‰ã€‚è¿™äº›æ³¨æ„åŠ›æ‰©å±•åŒ…æ‹¬å°†ç¨€ç–æ€§çº³å…¥æ³¨æ„åŠ›å±‚ï¼ˆChenç­‰äººï¼Œ2023ï¼›Ratnerç­‰äººï¼Œ2022ï¼›Mohtashamiç­‰äººï¼Œ2024ï¼‰ï¼Œä»¥åŠæ“çºµä½ç½®ç¼–ç ï¼ˆChenç­‰äººï¼Œ2023ï¼›Pengç­‰äººï¼Œ2023ï¼‰ã€‚&lt;strong&gt;è™½ç„¶åŸºäºä½ç½®ç¼–ç çš„æ–¹æ³•ï¼Œå¦‚ä½ç½®æ’å€¼æŠ€æœ¯ï¼ˆChenç­‰äººï¼Œ2023ï¼‰ï¼Œå¯ä»¥æ˜¯æ•°æ®é«˜æ•ˆçš„ï¼Œå› ä¸ºå®ƒä»¬åªè°ƒæ•´äº†æ³¨æ„åŠ›å±‚ä¸­çš„ä½ç½®åå·®ï¼Œä½†å®ƒä»¬åœ¨æ¨ç†æ–¹é¢ä»ç„¶æ˜‚è´µ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„æœºåˆ¶ä¹Ÿå®¹æ˜“å‡ºç°æ³¨æ„åŠ›èšç„¦(&lt;strong&gt;attention sink&lt;/strong&gt;)é—®é¢˜ï¼ˆXiaoç­‰äººï¼Œ2023ï¼‰å’Œè¿·å¤±åœ¨ä¸­é—´(&lt;strong&gt;lost-in-the-middle&lt;/strong&gt;)é—®é¢˜ï¼ˆLiuç­‰äººï¼Œ2024ï¼‰ã€‚å› æ­¤ï¼Œå®ƒä»¬åœ¨ä¸Šä¸‹æ–‡é•¿åº¦è¶…å‡ºè®­ç»ƒä¸­è§‚å¯Ÿåˆ°çš„é•¿åº¦æ—¶å¾€å¾€ä¼šé‡åˆ°å›°éš¾ã€‚æå‡ºçš„&lt;strong&gt;Infini-attentioné€šè¿‡å¯ç”¨å›ºå®šçš„æœ¬åœ°æ³¨æ„åŠ›çª—å£ï¼Œä»¥æ®µçº§æµå¼è®¡ç®—é•¿åºåˆ—ï¼Œè§£å†³äº†è¿™äº›é—®é¢˜&lt;/strong&gt;ã€‚&lt;strong&gt;Infini-Transformersåœ¨è®­ç»ƒ32Kç”šè‡³5Ké•¿åº¦åºåˆ—æ—¶ï¼ŒæˆåŠŸåœ°æ¨å¹¿åˆ°äº†100ä¸‡é•¿åº¦çš„è¾“å…¥èŒƒå›´&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é«˜æ•ˆçš„æ³¨æ„åŠ›(Efficient attention)ã€‚&lt;/strong&gt; é«˜æ•ˆçš„æ³¨æ„åŠ›æŠ€æœ¯è¯•å›¾é€šè¿‡è¿‘ä¼¼æˆ–ç³»ç»Ÿçº§ä¼˜åŒ–æ¥æ”¹å–„ç‚¹ä¹˜æ³¨æ„åŠ›çš„æ•ˆç‡ã€‚ä¸åŒå½¢å¼çš„é«˜æ•ˆæ³¨æ„åŠ›è¿‘ä¼¼å·²ç»æ¢ç´¢äº†å¤šä¸ªæ–¹å‘ï¼ŒåŒ…æ‹¬åŸºäºç¨€ç–æ€§çš„ï¼ˆChildç­‰äººï¼Œ2019ï¼›Beltagyç­‰äººï¼Œ2020ï¼›Sukhbaatarç­‰äººï¼Œ2021ï¼›Dingç­‰äººï¼Œ2023ï¼‰å’Œçº¿æ€§æ³¨æ„åŠ›è¿‘ä¼¼ï¼ˆShenå’ŒTaoï¼Œ2018ï¼›Katharopouloså’ŒFleuretï¼Œ2020ï¼›Schlagç­‰äººï¼Œ2021ï¼‰ã€‚åœ¨è¿™äº›æ–¹æ³•ä¸­ï¼Œ&lt;strong&gt;çº¿æ€§æ³¨æ„åŠ›å˜ç§ä¸å…³è”å†…å­˜çŸ©é˜µï¼ˆSchlagç­‰äººï¼Œ2020ï¼›Schlagç­‰äººï¼Œ2021ï¼‰å’Œå…ƒå­¦ä¹ ç¥ç»å†…å­˜ï¼ˆMunkhdalaiå’ŒYuï¼Œ2019ï¼‰å¯†åˆ‡ç›¸å…³ï¼Œå…¶ä¸­KV ç»‘å®šï¼ˆSmolenskyï¼Œ1990ï¼‰å­˜å‚¨åœ¨å¿«é€Ÿæƒé‡ï¼ˆHintonç­‰äººï¼Œ1987ï¼›Schmidhuberï¼Œ1992ï¼›Baå’ŒHintonï¼Œ2016ï¼‰ä¸­ï¼Œè¿™äº›æƒé‡æ ¹æ®æ–°çš„ä¸Šä¸‹æ–‡ä¿¡æ¯è¿›è¡Œä¿®æ”¹&lt;/strong&gt;ã€‚æœ€è¿‘ï¼Œé€šè¿‡åˆ©ç”¨ç‰¹å®šç¡¬ä»¶æ¶æ„æ¥ä½¿ç²¾ç¡®çš„æ³¨æ„åŠ›è®¡ç®—æ›´åŠ é«˜æ•ˆï¼Œæå‡ºäº†ç³»ç»Ÿçº§ä¼˜åŒ–æŠ€æœ¯ï¼ˆDaoç­‰äººï¼Œ2022ï¼›Liuç­‰äººï¼Œ2023ï¼‰ã€‚&lt;/p&gt;
&lt;h2 id=&#34;5-ç»“è®º&#34;&gt;5 ç»“è®º&lt;/h2&gt;
&lt;p&gt;æœ‰æ•ˆçš„å†…å­˜ç³»ç»Ÿä¸ä»…å¯¹äºç†è§£LLMä¸­çš„é•¿ä¸Šä¸‹æ–‡è‡³å…³é‡è¦ï¼Œè€Œä¸”å¯¹äºæ¨ç†ã€è§„åˆ’ã€æŒç»­é€‚åº”æ–°çŸ¥è¯†ç”šè‡³å­¦ä¹ å¦‚ä½•å­¦ä¹ ä¹Ÿæ˜¯è‡³å…³é‡è¦çš„ã€‚æœ¬æ–‡ä»‹ç»äº†&lt;strong&gt;å°†å‹ç¼©å†…å­˜æ¨¡å—ç´§å¯†é›†æˆåˆ°æ™®é€šç‚¹ä¹˜æ³¨æ„åŠ›å±‚ä¸­ï¼›è¿™å¯¹æ³¨æ„åŠ›å±‚çš„å¾®å¦™ä½†å…³é”®ä¿®æ”¹ä½¿LLMèƒ½å¤Ÿåœ¨æœ‰ç•Œçš„å†…å­˜å’Œè®¡ç®—èµ„æºä¸‹å¤„ç†æ— é™é•¿çš„ä¸Šä¸‹æ–‡&lt;/strong&gt;ã€‚æˆ‘ä»¬å±•ç¤ºäº†æˆ‘ä»¬çš„æ–¹æ³•å¯ä»¥è‡ªç„¶åœ°æ‰©å±•åˆ°ç™¾ä¸‡é•¿åº¦çš„è¾“å…¥åºåˆ—èŒƒå›´ï¼ŒåŒæ—¶åœ¨é•¿ä¸Šä¸‹æ–‡è¯­è¨€å»ºæ¨¡åŸºå‡†æµ‹è¯•å’Œä¹¦ç±æ‘˜è¦ä»»åŠ¡ä¸Šèƒœè¿‡äº†åŸºçº¿ã€‚æˆ‘ä»¬è¿˜å±•ç¤ºäº†æˆ‘ä»¬æ–¹æ³•çš„æœ‰å¸Œæœ›çš„&lt;strong&gt;é•¿åº¦æ³›åŒ–èƒ½åŠ›&lt;/strong&gt;ã€‚fine-tuneåœ¨é•¿åº¦ä¸º5Kçš„åºåˆ—ä¸Šçš„1Bæ¨¡å‹è§£å†³äº†1Mé•¿åº¦çš„é—®é¢˜(å‡†ç¡®ç‡)ã€‚&lt;/p&gt;
&lt;h2 id=&#34;references&#34;&gt;References&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;R. Anil, A. M. Dai, O. Firat, M. Johnson, D. Lepikhin, A. Passos, S. Shakeri, E. Taropa, P. Bailey, Z. Chen, et al. Palm 2 technical report. arXiv preprint arXiv:2305.10403, 2023.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;J. Ba, G. E. Hinton, V. Mnih, J. Z. Leibo, and C. Ionescu. Using fast weights to attend to the recent past. Advances in neural information processing systems, 29, 2016.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;D. Bahdanau, K. Cho, and Y. Bengio. Neural machine translation by jointly learning to align and translate. arXiv preprint arXiv:1409.0473, 2014.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I. Beltagy, M. E. Peters, and A. Cohan. Longformer: The long-document transformer. arXiv preprint arXiv:2004.05150, 2020.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A. Bertsch, U. Alon, G. Neubig, and M. Gormley. Unlimiformer: Longrange transformers with unlimited length input. Advances in Neural Information Processing Systems, 36, 2024.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;T. Brown, B. Mann, N. Ryder, M. Subbiah, J. D. Kaplan, P. Dhariwal, A. Neelakantan, P. Shyam, G. Sastry, A. Askell, et al. Language models are few-shot learners. Advances in neural information processing systems, 33:1877â€“1901, 2020.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A. Bulatov, Y. Kuratov, and M. Burtsev. Recurrent memory transformer. Advances in Neural Information Processing Systems, 35:11079â€“11091, 2022.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;S. Chen, S. Wong, L. Chen, and Y. Tian. Extending context window of large language models via positional interpolation. arXiv preprint arXiv:2306.15595, 2023a.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Y. Chen, S. Qian, H. Tang, X. Lai, Z. Liu, S. Han, and J. Jia. Longlora: Efficient fine-tuning of long-context large language models. arXiv preprint arXiv:2309.12307, 2023b.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;J. Cheng, L. Dong, and M. Lapata. Long short-term memory-networks for machine reading. arXiv preprint arXiv:1601.06733, 2016.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A. Chevalier, A. Wettig, A. Ajith, and D. Chen. Adapting language models to compress contexts. arXiv preprint arXiv:2305.14788, 2023.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;R. Child, S. Gray, A. Radford, and I. Sutskever. Generating long sequences with sparse transformers. arXiv preprint arXiv:1904.10509, 2019.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;D. Clevert, T. Unterthiner, and S. Hochreiter. Fast and accurate deep network learning by exponential linear units (elus). arXiv preprint arXiv:1511.07289, 2015.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Z. Dai, Z. Yang, Y. Yang, J. Carbonell, Q. V. Le, and R. Salakhutdinov. Transformer-xl: Attentive language models beyond a fixed-length context. arXiv preprint arXiv:1901.02860, 2019.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;T. Dao, D. Fu, S. Ermon, A. Rudra, and C. RÂ´e. Flashattention: Fast and memory-efficient exact attention with io-awareness. Advances in Neural Information Processing Systems, 35:16344â€“16359, 2022.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;J. Ding, S. Ma, L. Dong, X. Zhang, S. Huang, W. Wang, N. Zheng, and F. Wei. Longnet: Scaling transformers to 1,000,000,000 tokens. arXiv preprint arXiv:2307.02486, 2023.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Y. Fu, R. Panda, X. Niu, X. Yue, H. Hajishirzi, Y. Kim, and H. Peng. Data engineering for scaling language models to 128k context. arXiv preprint arXiv:2402.10171, 2024.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;T. Ge, J. Hu, X. Wang, S.-Q. Chen, and F. Wei. In-context autoencoder for context compression in a large language model. arXiv preprint arXiv:2307.06945, 2023.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A. Graves, G. Wayne, and I. Danihelka. Neural turing machines. arXiv preprint arXiv:1410.5401, 2014.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;D. Groeneveld, I. Beltagy, P. Walsh, A. Bhagia, R. Kinney, O. Tafjord, A. H. Jha, H. Ivison, I. Magnusson, Y. Wang, et al. Olmo: Accelerating the science of language models. arXiv preprint arXiv:2402.00838, 2024.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;D. O. Hebb. The organization of behavior: A neuropsychological theory. Psychology press, 2005.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;G. E. Hinton and D. C. Plaut. Using fast weights to deblur old memories. In Proceedings of the ninth annual conference of the Cognitive Science Society, pp. 177â€“186, 1987.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;J. J. Hopfield. Neural networks and physical systems with emergent collective computational abilities. Proceedings of the national academy of sciences, 79(8):2554â€“2558, 1982.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;P. Kanerva. Sparse distributed memory. MIT press, 1988.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A. Katharopoulos, A. Vyas, N. Pappas, and F. Fleuret. Transformers are rnns: Fast autoregressive transformers with linear attention. In International conference on machine learning, pp. 5156â€“5165. PMLR, 2020.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A. Kazemnejad, I. Padhi, K. Natesan Ramamurthy, P. Das, and S. Reddy. The impact of positional encoding on length generalization in transformers. Advances in Neural Information Processing Systems, 36, 2024.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;W. KryÂ´sciÂ´nski, N. Rajani, D. Agarwal, C. Xiong, and D. Radev. Booksum: A collection of datasets for long-form narrative summarization. arXiv preprint arXiv:2105.08209, 2021.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;M. Lewis, Y. Liu, N. Goyal, M. Ghazvininejad, A. Mohamed, O. Levy, V. Stoyanov, and L. Zettlemoyer. Bart: Denoising sequence-to-sequence pre-training for natural language generation, translation, and comprehension. arXiv preprint arXiv:1910.13461, 2019.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;H. Liu, M. Zaharia, and P. Abbeel. Ring attention with blockwise transformers for near-infinite context. arXiv preprint arXiv:2310.01889, 2023.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;N. F. Liu, K. Lin, J. Hewitt, A. Paranjape, M. Bevilacqua, F. Petroni, and P. Liang. Lost in the middle: How language models use long contexts. Transactions of the Association for Computational Linguistics, 12:157â€“173, 2024.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;T. Miconi, K. Stanley, and J. Clune. Differentiable plasticity: training plastic neural networks with backpropagation. In International Conference on Machine Learning, pp. 3559â€“3568. PMLR, 2018.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A. Mohtashami and M. Jaggi. Random-access infinite context length for transformers. Advances in Neural Information Processing Systems, 36, 2024.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;J. Mu, X. Li, and N. Goodman. Learning to compress prompts with gist tokens. Advances in Neural Information Processing Systems, 36, 2024.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;T. Munkhdalai and H. Yu. Meta networks. In International conference on machine learning, pp. 2554â€“2563. PMLR, 2017a.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;T. Munkhdalai and H. Yu. Neural semantic encoders. In Proceedings of the conference. Association for Computational Linguistics. Meeting, volume 1, pp. 397. NIH Public Access, 2017b.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;T. Munkhdalai, J. P. Lalor, and H. Yu. Citation analysis with neural attention models. In Proceedings of the Seventh International Workshop on Health Text Mining and Information Analysis, pp. 69â€“77, 2016.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;T. Munkhdalai, A. Sordoni, T. Wang, and A. Trischler. Metalearned neural memory. Advances in Neural Information Processing Systems, 32, 2019.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;B. Peng, J. Quesnelle, H. Fan, and E. Shippole. Yarn: Efficient context window extension of large language models. arXiv preprint arXiv:2309.00071, 2023.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;R. Pope, S. Douglas, A. Chowdhery, J. Devlin, J. Bradbury, J. Heek, K. Xiao, S. Agrawal, and J. Dean. Efficiently scaling transformer inference. Proceedings of Machine Learning and Systems, 5, 2023.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;O. Press, N. A Smith, and M. Lewis. Train short, test long: Attention with linear biases enables input length extrapolation. arXiv preprint arXiv:2108.12409, 2021.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;J. W Rae, A. Potapenko, S. M Jayakumar, and T. P Lillicrap. Compressive transformers for long-range sequence modelling. arXiv preprint arXiv:1911.05507, 2019.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;C. Raffel, N. Shazeer, A. Roberts, K. Lee, S. Narang, M. Matena, Y. Zhou, W. Li, and P. J Liu. Exploring the limits of transfer learning with a unified text-to-text transformer. The Journal of Machine Learning Research, 21(1):5485â€“5551, 2020.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;N. Ratner, Y. Levine, Y. Belinkov, O. Ram, O. Abend, E. Karpas, A. Shashua, K. Leyton-Brown, and Y. Shoham. Parallel context windows improve in-context learning of large language models. arXiv preprint arXiv:2212.10947, 2022.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I. Schlag, P. Smolensky, R. Fernandez, N. Jojic, J. Schmidhuber, and J. Gao. Enhancing the transformer with explicit relational encoding for math problem solving. arXiv preprint arXiv:1910.06611, 2019.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I. Schlag, T. Munkhdalai, and J. Schmidhuber. Learning associative inference using fast weight memory. arXiv preprint arXiv:2011.07831, 2020.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I. Schlag, K. Irie, and J. Schmidhuber. Linear transformers are secretly fast weight programmers. In International Conference on Machine Learning, pp. 9355â€“9366. PMLR, 2021.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;J. Schmidhuber. Learning to control fast-weight memories: An alternative to dynamic recurrent networks. Neural Computation, 4(1):131â€“139, 1992.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;N. Shazeer and M. Stern. Adafactor: Adaptive learning rates with sublinear memory cost. In International Conference on Machine Learning, pp. 4596â€“4604. PMLR, 2018.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Z. Shen, M. Zhang, H. Zhao, S. Yi, and H. Li. Efficient attention: Attention with linear complexities. arXiv preprint arXiv:1812.01243, 2018.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;P. Smolensky. Tensor product variable binding and the representation of symbolic structures in connectionist systems. Artificial intelligence, 46(1-2):159â€“216, 1990.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;S. Sukhbaatar, J. Weston, R. Fergus, et al. End-to-end memory networks. Advances in neural information processing systems, 28, 2015.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;S. Sukhbaatar, D. Ju, S. Poff, S. Roller, A. Szlam, J. Weston, and A. Fan. Not all memories are created equal: Learning to forget by expiring. In International Conference on Machine Learning, pp. 9902â€“9912. PMLR, 2021.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;H. Touvron, L. Martin, K. Stone, P. Albert, A. Almahairi, Y. Babaei, N. Bashlykov, S. Batra, P. Bhargava, S. Bhosale, et al. Llama 2: Open foundation and fine-tuned chat models. arXiv preprint arXiv:2307.09288, 2023.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A. Vaswani, N. Shazeer, N. Parmar, J. Uszkoreit, L. Jones, A. N Gomez, Å. Kaiser, and I. Polosukhin. Attention is all you need. Advances in neural information processing systems, 30, 2017.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Y. Wu, M. N Rabe, D. Hutchins, and C. Szegedy. Memorizing transformers. arXiv preprint arXiv:2203.08913, 2022.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;G. Xiao, Y. Tian, B. Chen, S. Han, and M. Lewis. Efficient streaming language models with attention sinks. arXiv preprint arXiv:2309.17453, 2023.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;W. Xiao, I. Beltagy, G. Carenini, and A. Cohan. Primera: Pyramidbased masked sentence pre-training for multi-document summarization. arXiv preprint arXiv:2110.08499, 2021.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;W. Xiong, J. Liu, I. Molybog, H. Zhang, P. Bhargava, R. Hou, L. Martin, R. Rungta, K. Sankararaman, B. Oguz, et al. Effective long-context scaling of foundation models. arXiv preprint arXiv:2309.16039, 2023.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;é™„å½•&#34;&gt;é™„å½•&lt;/h2&gt;
&lt;h3 id=&#34;a-é¢å¤–çš„è®­ç»ƒç»†èŠ‚&#34;&gt;A é¢å¤–çš„è®­ç»ƒç»†èŠ‚&lt;/h3&gt;
&lt;p&gt;å¯¹äºé•¿ä¸Šä¸‹æ–‡è¯­è¨€å»ºæ¨¡ä»»åŠ¡ï¼Œæˆ‘ä»¬å°†&lt;strong&gt;å­¦ä¹ ç‡è®¾ç½®ä¸º0.01ï¼Œé€šè¿‡å¯¹0.003ã€0.005ã€0.01å’Œ0.03çš„å€¼è¿›è¡Œå°èŒƒå›´æœç´¢&lt;/strong&gt;ã€‚æˆ‘ä»¬ä½¿ç”¨&lt;strong&gt;Adafactorä¼˜åŒ–å™¨&lt;/strong&gt;ï¼ˆShazeerå’ŒSternï¼Œ2018ï¼‰ï¼Œå…¶ä¸­åŒ…æ‹¬&lt;strong&gt;çº¿æ€§é¢„çƒ­1000æ­¥ï¼Œç„¶åæ˜¯ä½™å¼¦è¡°å‡(cosine decay)&lt;/strong&gt;ã€‚æˆ‘ä»¬åœ¨æ¯ä¸ªæ®µä¹‹ååº”ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹ä»¥èŠ‚çœå†…å­˜ã€‚&lt;strong&gt;æ‰¹é‡å¤§å°è®¾ç½®ä¸º64&lt;/strong&gt;ã€‚å¯¹äºLLMå®éªŒï¼Œæˆ‘ä»¬åœ¨&lt;strong&gt;æŒç»­é¢„è®­ç»ƒå’Œä»»åŠ¡å¾®è°ƒæœŸé—´å°†å­¦ä¹ ç‡è®¾ç½®ä¸º0.0001&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id=&#34;b-å£ä»¤passkeyæ£€ç´¢ä»»åŠ¡&#34;&gt;&lt;strong&gt;B å£ä»¤(passkey)æ£€ç´¢ä»»åŠ¡&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;ä¸‹é¢æ˜¯å£ä»¤(passkey)ä»»åŠ¡çš„è¾“å…¥æ ¼å¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;There is an important info hidden inside a lot of irrelevant text. Find it and memorize them. I
will quiz you about the important information there. The grass is green. The sky is blue. The sun
is yellow. Here we go. There and back again. (repeat x times) The pass key is 9054. Remember
it. 9054 is the pass key. The grass is green. The sky is blue. The sun is yellow. Here we go.
There and ack again. (repeat y times) What is the pass key? The pass key is
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;åœ¨è®¸å¤šæ— å…³æ–‡æœ¬ä¸­éšè—äº†é‡è¦ä¿¡æ¯ã€‚æ‰¾åˆ°å®ƒå¹¶è®°ä½å®ƒä»¬ã€‚æˆ‘å°†åœ¨é‚£é‡Œè¯¢é—®ä½ å…³äºé‡è¦ä¿¡æ¯ã€‚è‰æ˜¯ç»¿è‰²çš„ã€‚å¤©ç©ºæ˜¯è“è‰²çš„ã€‚å¤ªé˜³æ˜¯é»„è‰²çš„ã€‚æˆ‘ä»¬å¼€å§‹å§ã€‚å†æ¥ä¸€æ¬¡ã€‚ (é‡å¤ x æ¬¡) å£ä»¤æ˜¯ 9054ã€‚è®°ä½å®ƒã€‚9054 å°±æ˜¯å£ä»¤ã€‚è‰æ˜¯ç»¿è‰²çš„ã€‚å¤©ç©ºæ˜¯è“è‰²çš„ã€‚å¤ªé˜³æ˜¯é»„è‰²çš„ã€‚æˆ‘ä»¬å¼€å§‹å§ã€‚å†æ¥ä¸€æ¬¡ã€‚ (é‡å¤ y æ¬¡) å£ä»¤æ˜¯ä»€ä¹ˆï¼Ÿå£ä»¤æ˜¯
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
      
    </item>
    
    <item>
      <title>ç¿»è¯‘æ¨¡å‹ inference å’Œ å¾®è°ƒ</title>
      <link>https://weedge.github.io/post/nlp/translate_model_inference_and_finetune/</link>
      <pubDate>Thu, 28 Mar 2024 21:51:52 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/nlp/translate_model_inference_and_finetune/</guid>
      
        <description>&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/nlp/translate_model_inference_and_finetune/1.png&#34; alt=&#34;image-20240328231303644&#34;&gt;&lt;/p&gt;
&lt;p&gt;æƒ³æŠŠ HuggingFaceTB/cosmopedia è‹±æ–‡æ•°æ®ä¸­çš„promptå’Œtext ç¿»è¯‘æˆ ä¸­æ–‡ï¼Œ ç„¶åçœ‹äº†ä¸‹pythonåº“ &lt;a href=&#34;https://github.com/nidhaloff/deep-translator&#34;&gt;deep_translator&lt;/a&gt;çš„å®ç°ï¼Œ ç¿»è¯‘è°ƒç”¨çš„æ˜¯ä¸‰æ–¹æ¥å£é›†æˆåº“ï¼Œ äºæ˜¯ä½¿ç”¨è¿™ä¸ªåº“å°è£…çš„è°·æ­Œç¿»è¯‘æ¥å£æ¥ç¿»è¯‘ï¼Œä½†æ˜¯ä¸‰æ–¹å¹³å°æ¥å£å¤šä¼šæœ‰é™æµå’Œæ¥å£è°ƒç”¨é¢‘ç‡é™åˆ¶ï¼Œå³ä½¿åœ¨ä»£ç ä¸­æœ‰å®¹é”™å¤„ç†ï¼Œ æ¯”å¦‚å¸¸è§„çš„sleepä¸‹å†è°ƒç”¨ï¼Œä¸å½±å“æ•´ç†å¤„ç†æµç¨‹ï¼Œä½†æ˜¯æ•´ä½“å¤„ç†æ—¶é—´å—æ¥å£é™åˆ¶ï¼Œå³ä½¿ç”¨æ‰¹å¤„ç†ä¹Ÿå¦‚æ­¤ï¼Œè¿™ä¸ªåœ¨å¤§è§„æ¨¡æ•°æ®å¤„ç†ä¸­ä½¿ç”¨ä¸‰æ–¹æ¥å£æ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°çš„é—®é¢˜ï¼Œç”¨çš„ä¸‰æ–¹æœåŠ¡ï¼Œå¦‚æœä¸å‡çº§æ¥å£æœåŠ¡ï¼Œåœ¨æŠ€æœ¯ä¸Šä¸å¤ªå¥½è§£å†³ï¼› äºæ˜¯é€‰æ‹©å¦å¤–ä¸€ç§æ–¹æ¡ˆï¼Œçœ‹æ˜¯å¦æœ‰å¼€æºçš„ç¿»è¯‘æ¨¡å‹ï¼Œåº•å±‚æ¨¡å‹ç»“æ„ä¸€èˆ¬ä¹Ÿæ˜¯Transformæ¶æ„ Encoder-Decoder model ï¼Œä¹Ÿç§°sequence-to-sequence modelï¼› æ¯”å¦‚ è°·æ­Œçš„T5æ¨¡å‹ï¼Œ ä½†æ˜¯æ¨ç†é€Ÿåº¦å—ç¡¬ä»¶æ¡ä»¶å½±å“ï¼Œæ¯”è¾ƒæ…¢ï¼Œè€Œä¸”åŸå§‹æ¨¡å‹ä¸æ”¯æŒè‹±æ–‡ç¿»è¯‘æˆä¸­æ–‡ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åçœ‹äº†ä¸‹meta nllb æ¨¡å‹ï¼Œä¸“é—¨ç”¨æ¥å¤„ç†ç¿»è¯‘çš„æ¨¡å‹ï¼Œå•ä¸ª AI æ¨¡å‹ä¸­æ”¯æŒ 200 ç§è¯­è¨€ï¼Œå¼€æºåœ°å€ï¼š &lt;a href=&#34;https://github.com/facebookresearch/fairseq/tree/nllb&#34;&gt;https://github.com/facebookresearch/fairseq/tree/nllb&lt;/a&gt; æ¨¡å‹ç›¸å¯¹ç°åœ¨çš„LLMå‚æ•°é‡å°ä¸€äº›ï¼Œä¹Ÿåœ¨huggingfaceçš„Transformsåº“ä¸­é›†æˆ nllb-200-distilled-600Mï¼Œç›´æ¥å¯ä»¥loadä½¿ç”¨ï¼Œ ç­‰ç­‰ã€‚ã€‚ã€‚ æ—¢ç„¶llmæ¨ç†å¯ä»¥é€šè¿‡æƒ³llama.cppé€šè¿‡åŠ è½½ggmlæ ¼å¼è¿›è¡Œé‡åŒ–ï¼Œåœ¨æ€§èƒ½æœ‰å°‘è®¸æŠ˜æŸçš„æƒ…å†µä¸‹é™ä½æ¨ç†æˆæœ¬ï¼Œä½†æ˜¯ggml ggufæ ¼å¼è¿˜ä¸æ”¯æŒnllbæ¨¡å‹æƒé‡æ–‡ä»¶(è²Œä¼¼llama.cppåªæ”¯æŒTransform Decoderæ¨¡å‹ç»“æ„)ï¼›é‚£å°±ç›´æ¥ç”¨Transformsåº“æ¥åŠ è½½facebook/nllb-200-distilled-600M æ¨¡å‹æ¥æ‰¹é‡ç¿»è¯‘è¯•è¯•çœ‹ï¼›åç»­è¿˜å°è¯•ä½¿ç”¨ &lt;a href=&#34;https://huggingface.co/Helsinki-NLP/opus-mt-en-zh&#34;&gt;Helsinki-NLP/opus-mt-en-zh&lt;/a&gt; æ¨¡å‹ï¼Œè¿›è¡Œäº†ç®€å•å¯¹æ¯”ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨å·²æœ‰ç¿»è¯‘æ¨¡å‹æ¨ç†&#34;&gt;ä½¿ç”¨å·²æœ‰ç¿»è¯‘æ¨¡å‹æ¨ç†&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆæŠŠä¾èµ–å®‰è£…ä¸Š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;!pip install -q -U datasets deep-translator transformers
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½å¤‡å¥½å®éªŒæ•°æ®, ä½¿ç”¨ HuggingFaceTB/cosmopedia stories æ•°æ®ï¼Œè¿™é‡Œç›´æ¥ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œç”¨äºæµ‹è¯•&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;!huggingface-cli login

!huggingface-cli download &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --repo-type dataset HuggingFaceTB/cosmopedia data/stories/train-00000-of-00043.parquet &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --local-dir ./datas/datasets/HuggingFaceTB/cosmopedia &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --local-dir-use-symlinks False
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åœ¨çº¿æœåŠ¡è°ƒç”¨deep_translator&#34;&gt;åœ¨çº¿æœåŠ¡è°ƒç”¨(deep_translator)&lt;/h3&gt;
&lt;p&gt;è¿™é‡Œä»storiesæ•°æ®æ–‡ä»¶ä¸­å–å‡º100ä¸ªåšä¸ºæµ‹è¯•æ•°æ®ï¼Œå…·ä½“æ–‡ä»¶ï¼š&lt;code&gt;translate.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# https://huggingface.co/learn/nlp-course/chapter5/&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;deep_translator&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GoogleTranslator&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;datasets&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;load_dataset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;load_from_disk&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;argparse&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;time&lt;/span&gt;


&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;translate_en2cn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;translated&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;try_cn&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;try_cn&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;try&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;translated_prompt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GoogleTranslator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;en&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;zh-CN&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;translate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
                &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;prompt&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;translated_text&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;GoogleTranslator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;en&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;target&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;zh-CN&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;translate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
                &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;text&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
            &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;except&lt;/span&gt; &lt;span class=&#34;ne&#34;&gt;Exception&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
            &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;An error occurred:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;try_cn&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;text_zh&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;translated_text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;prompt_zh&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;translated_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;


&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;batch_check_data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;batch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;text_zh&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]]&lt;/span&gt;


&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;translate2save&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;src_dataset_dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;target_dataset_dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;load_dataset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;src_dataset_dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;train[:100]&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;translate_en2cn&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;batched&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;save_to_disk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target_dataset_dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;


&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;load2check&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dataset_dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;load_from_disk&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dataset_dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;filter before&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch_check_data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;batched&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;filter after&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;


&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;__name__&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;__main__&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;parser&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argparse&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ArgumentParser&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;parser&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;add_argument&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;stage&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;choices&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;translate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;check&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;parser&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;add_argument&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;-s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;--src_dir&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                        &lt;span class=&#34;n&#34;&gt;help&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;path to src dataset dir &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;parser&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;add_argument&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;-t&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;--target_dir&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                        &lt;span class=&#34;n&#34;&gt;help&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;path to target dataset dir &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;required&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;lambda&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;not&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;parser&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parse_args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stage&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;translate&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;translate2save&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;src_dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target_dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;elif&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stage&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;check&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;load2check&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target_dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œç¿»è¯‘&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# translate2save(&amp;#34;./datas/datasets/HuggingFaceTB/cosmopedia/data/stories&amp;#34;,&amp;#34;/datas/datasets/HuggingFaceTB/cosmopedia_zh&amp;#34;)&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;python&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;translate&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;py&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;translate&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;./&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;datas&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;datasets&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HuggingFaceTB&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cosmopedia&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stories&lt;/span&gt; \
  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;./&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;datas&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;datasets&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HuggingFaceTB&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cosmopedia_zh&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ£€æŸ¥ç¿»è¯‘&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#load2check(&amp;#34;/datas/datasets/HuggingFaceTB/cosmopedia_zh&amp;#34;)&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;python&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;translate&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;py&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;check&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;./&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;datas&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;datasets&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HuggingFaceTB&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cosmopedia_zh&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä½¿ç”¨-facebooknllb-ç¿»è¯‘æ¨¡å‹&#34;&gt;ä½¿ç”¨ facebook/nllb ç¿»è¯‘æ¨¡å‹&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨ facebook/nllb-200-distilled-600M æ¨¡å‹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoModelForSeq2SeqLM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoTokenizer&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoTokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_pretrained&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;facebook/nllb-200-distilled-600M&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;use_auth_token&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;src_lang&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;eng_Latn&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target_lang&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;zho_Hans&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;model&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoModelForSeq2SeqLM&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_pretrained&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;facebook/nllb-200-distilled-600M&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;use_auth_token&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¨¡å‹ç»“æ„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;M2M100ForConditionalGeneration(
  (model): M2M100Model(
    (shared): Embedding(256206, 1024, padding_idx=1)
    (encoder): M2M100Encoder(
      (embed_tokens): Embedding(256206, 1024, padding_idx=1)
      (embed_positions): M2M100SinusoidalPositionalEmbedding()
      (layers): ModuleList(
        (0-11): 12 x M2M100EncoderLayer(
          (self_attn): M2M100Attention(
            (k_proj): Linear(in_features=1024, out_features=1024, bias=True)
            (v_proj): Linear(in_features=1024, out_features=1024, bias=True)
            (q_proj): Linear(in_features=1024, out_features=1024, bias=True)
            (out_proj): Linear(in_features=1024, out_features=1024, bias=True)
          )
          (self_attn_layer_norm): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
          (activation_fn): ReLU()
          (fc1): Linear(in_features=1024, out_features=4096, bias=True)
          (fc2): Linear(in_features=4096, out_features=1024, bias=True)
          (final_layer_norm): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
        )
      )
      (layer_norm): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
    )
    (decoder): M2M100Decoder(
      (embed_tokens): Embedding(256206, 1024, padding_idx=1)
      (embed_positions): M2M100SinusoidalPositionalEmbedding()
      (layers): ModuleList(
        (0-11): 12 x M2M100DecoderLayer(
          (self_attn): M2M100Attention(
            (k_proj): Linear(in_features=1024, out_features=1024, bias=True)
            (v_proj): Linear(in_features=1024, out_features=1024, bias=True)
            (q_proj): Linear(in_features=1024, out_features=1024, bias=True)
            (out_proj): Linear(in_features=1024, out_features=1024, bias=True)
          )
          (activation_fn): ReLU()
          (self_attn_layer_norm): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
          (encoder_attn): M2M100Attention(
            (k_proj): Linear(in_features=1024, out_features=1024, bias=True)
            (v_proj): Linear(in_features=1024, out_features=1024, bias=True)
            (q_proj): Linear(in_features=1024, out_features=1024, bias=True)
            (out_proj): Linear(in_features=1024, out_features=1024, bias=True)
          )
          (encoder_attn_layer_norm): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
          (fc1): Linear(in_features=1024, out_features=4096, bias=True)
          (fc2): Linear(in_features=4096, out_features=1024, bias=True)
          (final_layer_norm): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
        )
      )
      (layer_norm): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
    )
  )
  (lm_head): Linear(in_features=1024, out_features=256206, bias=False)
)

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿›è¡Œæ‰¹é‡æ¨ç†ç¿»è¯‘&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;o&#34;&gt;%%&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;time&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;article&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    Dr. Mitchell nodded approvingly. &amp;#34;Yes, indeed! Fatty fish boast rich stores of omega-3 fatty acids â€“ specifically EPA and DHA â€“ which work miracles within our bodies. 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    Amongst numerous benefits, they decrease triglyceride levels, lower blood pressure, discourage plaque formation, and even suppress irregular heartbeats.&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    An intriguing idea took root in Alex&amp;#39;s mind, blossoming rapidly into resolve. If these simple changes could make such profound differences in his life, 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    why stop there? Why not share this gift with others â€“ friends, colleagues, strangers who might also benefit from understanding how food choices impact heart health? 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    Perhaps he could host educational events, cooking demonstrations, or write articles championing these powerful culinary tools. 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    Yes, he decided, that would be his mission â€“ to spread awareness and inspire change, one plate at a time.
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    His thoughts must have shown on his face because Dr. Mitchell suddenly grinned, leaning back in her chair with satisfaction. 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    &amp;#34;Ah, I see the wheels turning in that brilliant mind of yours, Alex. Go ahead, run with it!&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;article&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
  &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;inputs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;article&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;return_tensors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;pt&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;padding&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;truncation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;translated_tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;**&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inputs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;forced_bos_token_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lang_code_to_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;zho_Hans&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_new_tokens&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch_decode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;translated_tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;skip_special_tokens&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä½¿ç”¨-helsinki-nlpopus-mt-en-zh-æ¨¡å‹&#34;&gt;ä½¿ç”¨ Helsinki-NLP/opus-mt-en-zh æ¨¡å‹&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoTokenizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoModelForSeq2SeqLM&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;model_checkpoint&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Helsinki-NLP/opus-mt-en-zh&amp;#34;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoTokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_pretrained&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;model_checkpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;model&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoModelForSeq2SeqLM&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_pretrained&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;model_checkpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¨¡å‹ç»“æ„&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;MarianMTModel(
  (model): MarianModel(
    (shared): Embedding(65001, 512, padding_idx=65000)
    (encoder): MarianEncoder(
      (embed_tokens): Embedding(65001, 512, padding_idx=65000)
      (embed_positions): MarianSinusoidalPositionalEmbedding(512, 512)
      (layers): ModuleList(
        (0-5): 6 x MarianEncoderLayer(
          (self_attn): MarianAttention(
            (k_proj): Linear(in_features=512, out_features=512, bias=True)
            (v_proj): Linear(in_features=512, out_features=512, bias=True)
            (q_proj): Linear(in_features=512, out_features=512, bias=True)
            (out_proj): Linear(in_features=512, out_features=512, bias=True)
          )
          (self_attn_layer_norm): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
          (activation_fn): SiLU()
          (fc1): Linear(in_features=512, out_features=2048, bias=True)
          (fc2): Linear(in_features=2048, out_features=512, bias=True)
          (final_layer_norm): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
        )
      )
    )
    (decoder): MarianDecoder(
      (embed_tokens): Embedding(65001, 512, padding_idx=65000)
      (embed_positions): MarianSinusoidalPositionalEmbedding(512, 512)
      (layers): ModuleList(
        (0-5): 6 x MarianDecoderLayer(
          (self_attn): MarianAttention(
            (k_proj): Linear(in_features=512, out_features=512, bias=True)
            (v_proj): Linear(in_features=512, out_features=512, bias=True)
            (q_proj): Linear(in_features=512, out_features=512, bias=True)
            (out_proj): Linear(in_features=512, out_features=512, bias=True)
          )
          (activation_fn): SiLU()
          (self_attn_layer_norm): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
          (encoder_attn): MarianAttention(
            (k_proj): Linear(in_features=512, out_features=512, bias=True)
            (v_proj): Linear(in_features=512, out_features=512, bias=True)
            (q_proj): Linear(in_features=512, out_features=512, bias=True)
            (out_proj): Linear(in_features=512, out_features=512, bias=True)
          )
          (encoder_attn_layer_norm): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
          (fc1): Linear(in_features=512, out_features=2048, bias=True)
          (fc2): Linear(in_features=2048, out_features=512, bias=True)
          (final_layer_norm): LayerNorm((512,), eps=1e-05, elementwise_affine=True)
        )
      )
    )
  )
  (lm_head): Linear(in_features=512, out_features=65001, bias=False)
)

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰¹é‡æ¨ç†ç¿»è¯‘&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;o&#34;&gt;%%&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;time&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#text = [&amp;#34;In terms of time, the Chinese space station was built more than 20 years later than the International Space Station.&amp;#34;,&amp;#34;hello world.&amp;#34;]&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;article&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    Dr. Mitchell nodded approvingly. &amp;#34;Yes, indeed! Fatty fish boast rich stores of omega-3 fatty acids â€“ specifically EPA and DHA â€“ which work miracles within our bodies. 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    Amongst numerous benefits, they decrease triglyceride levels, lower blood pressure, discourage plaque formation, and even suppress irregular heartbeats.&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    An intriguing idea took root in Alex&amp;#39;s mind, blossoming rapidly into resolve. If these simple changes could make such profound differences in his life, 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    why stop there? Why not share this gift with others â€“ friends, colleagues, strangers who might also benefit from understanding how food choices impact heart health? 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    Perhaps he could host educational events, cooking demonstrations, or write articles championing these powerful culinary tools. 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    Yes, he decided, that would be his mission â€“ to spread awareness and inspire change, one plate at a time.
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    His thoughts must have shown on his face because Dr. Mitchell suddenly grinned, leaning back in her chair with satisfaction. 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    &amp;#34;Ah, I see the wheels turning in that brilliant mind of yours, Alex. Go ahead, run with it!&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;article&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
  &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Tokenize the text&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;inputs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;article&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;return_tensors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;pt&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;padding&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;truncation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_ids&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Perform the translation and decode the output&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;translation&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inputs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_new_tokens&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;512&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;do_sample&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;top_k&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;top_p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.95&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch_decode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;translation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;skip_special_tokens&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;pipeline é€‚åˆç¦»çº¿ä»»åŠ¡æµï¼Œæ‰¹é‡ç¿»è¯‘&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;o&#34;&gt;%%&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;time&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pipeline&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;article&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    Dr. Mitchell nodded approvingly. &amp;#34;Yes, indeed! Fatty fish boast rich stores of omega-3 fatty acids â€“ specifically EPA and DHA â€“ which work miracles within our bodies. 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    Amongst numerous benefits, they decrease triglyceride levels, lower blood pressure, discourage plaque formation, and even suppress irregular heartbeats.&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    An intriguing idea took root in Alex&amp;#39;s mind, blossoming rapidly into resolve. If these simple changes could make such profound differences in his life, 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    why stop there? Why not share this gift with others â€“ friends, colleagues, strangers who might also benefit from understanding how food choices impact heart health? 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    Perhaps he could host educational events, cooking demonstrations, or write articles championing these powerful culinary tools. 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    Yes, he decided, that would be his mission â€“ to spread awareness and inspire change, one plate at a time.
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    His thoughts must have shown on his face because Dr. Mitchell suddenly grinned, leaning back in her chair with satisfaction. 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    &amp;#34;Ah, I see the wheels turning in that brilliant mind of yours, Alex. Go ahead, run with it!&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;item&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;article&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
  &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;item&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;translator&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pipeline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;translation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;model_checkpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_length&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;translator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;article&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœåœ¨ç¿»è¯‘è¿‡ç¨‹ä¸­ï¼Œå‘ç°ä¸€äº›badcase, å¯ä»¥åœ¨å·²æœ‰é¢„è®­ç»ƒå¥½æ¨¡å‹çš„åŸºç¡€ä¸Šè¿›è¡Œå¾®è°ƒï¼Œæ¯”å¦‚è¿™é‡Œä½¿ç”¨çš„ Helsinki-NLP/opus-mt-en-zh&lt;/p&gt;
&lt;h2 id=&#34;ä½¿ç”¨wmt19æ•°æ®é›†å¾®è°ƒè®­ç»ƒ-helsinki-nlpopus-mt-en-zh-ç¿»è¯‘æ¨¡å‹&#34;&gt;ä½¿ç”¨WMT19æ•°æ®é›†å¾®è°ƒè®­ç»ƒ Helsinki-NLP/opus-mt-en-zh ç¿»è¯‘æ¨¡å‹&lt;/h2&gt;
&lt;p&gt;æœ¬èŠ‚å°†ä»‹ç»å¦‚ä½•ä¸ºç¿»è¯‘ä»»åŠ¡å¾®è°ƒä¸€ä¸ª&lt;a href=&#34;https://github.com/huggingface/transformers&#34;&gt;ğŸ¤—Transformers&lt;/a&gt;æ¨¡å‹ã€‚æˆ‘ä»¬å°†ä½¿ç”¨&lt;a href=&#34;https://www.statmt.org/wmt19/&#34;&gt;WMT19æ•°æ®é›†&lt;/a&gt;ï¼Œè¿™æ˜¯ä¸€ä¸ªç”±å„ç§æ¥æºç»„æˆçš„æœºå™¨ç¿»è¯‘æ•°æ®é›†ï¼ŒåŒ…æ‹¬æ–°é—»è¯„è®ºå’Œè®®ä¼šä¼šè®®è®°å½•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®‰è£…ä¾èµ–&#34;&gt;å®‰è£…ä¾èµ–&lt;/h3&gt;
&lt;p&gt;å®‰è£…ğŸ¤— Transformerså’ŒğŸ¤— Datasets ä»¥åŠæ¨¡å‹è®­ç»ƒç¿»è¯‘è¯„ä¼°evaluate sacrebleuï¼Œ ç”¨äºåŠ é€Ÿè®­ç»ƒçš„ accelerateï¼›è¿˜æœ‰ä¸ªæœºå™¨ç¿»è¯‘çš„ sacremosesåº“, éœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;err&#34;&gt;!&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pip&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;install&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;q&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;datasets&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;evaluate&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sacrebleu&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;accelerate&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sacremoses&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæ‚¨åœ¨æœ¬åœ°æ‰“å¼€è¿™ä¸ªç¬”è®°æœ¬ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç¯å¢ƒå·²ç»å®‰è£…äº†è¿™äº›åº“çš„æœ€æ–°ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†èƒ½å¤Ÿé€šè¿‡æ¨ç†APIä¸ç¤¾åŒºå…±äº«æ‚¨çš„æ¨¡å‹å¹¶ç”Ÿæˆå¦‚ä¸‹å›¾æ‰€ç¤ºçš„ç»“æœï¼Œæ‚¨è¿˜éœ€è¦éµå¾ªä¸€äº›é¢å¤–çš„æ­¥éª¤ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;éœ€è¦ä»Hugging Faceç½‘ç«™å­˜å‚¨æ‚¨çš„è®¤è¯ä»¤ç‰Œï¼Œç„¶åæ‰§è¡Œä¸‹é¢çš„å•å…ƒæ ¼å¹¶è¾“å…¥æ‚¨çš„ç”¨æˆ·åå’Œå¯†ç ï¼›æˆ–è€…åœ¨colabä¸­æ‰§è¡Œæ—¶åŠ å…¥ç§˜é’¥ HF_TOKEN&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¥ä¸‹æ¥éœ€è¦å®‰è£…Git-LFS: &lt;code&gt;apt install git-lfs&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¯·ç¡®ä¿ä½ ä½¿ç”¨çš„transformersç‰ˆæœ¬ä¸ä½äº4.11.0ï¼Œå› ä¸ºè¯¥åŠŸèƒ½æ˜¯åœ¨4.11.0ç‰ˆæœ¬ä¸­å¼•å…¥çš„:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;transformers&lt;/span&gt;

&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;transformers&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;__version__&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯ä»¥åœ¨&lt;a href=&#34;https://github.com/huggingface/transformers/tree/master/examples/seq2seq&#34;&gt;è¿™é‡Œ&lt;/a&gt;æ‰¾åˆ°æ­¤ç¬”è®°æœ¬çš„è„šæœ¬ç‰ˆæœ¬ï¼Œä»¥åˆ†å¸ƒå¼æ–¹å¼ä½¿ç”¨å¤šä¸ªgpuæˆ–tpuå¾®è°ƒæ‚¨çš„æ¨¡å‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸Šä¼ ä¸€äº›ç›‘æ§æ•°æ®(telemetry)â€”â€”è¿™å‘Šè¯‰æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨å“ªäº›ç¤ºä¾‹å’Œè½¯ä»¶ç‰ˆæœ¬ï¼Œä»¥ä¾¿æˆ‘ä»¬çŸ¥é“åœ¨å“ªé‡Œä¼˜å…ˆè¿›è¡Œç»´æŠ¤å·¥ä½œã€‚æˆ‘ä»¬ä¸æ”¶é›†(æˆ–å…³å¿ƒ)ä»»ä½•ä¸ªäººèº«ä»½ä¿¡æ¯ï¼Œä½†å¦‚æœæ‚¨å¸Œæœ›ä¸è¢«è®¡ç®—åœ¨å†…ï¼Œè¯·éšæ—¶è·³è¿‡æ­¤æ­¥éª¤æˆ–å®Œå…¨åˆ é™¤æ­¤å•å…ƒæ ¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;transformers.utils&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;send_example_telemetry&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;send_example_telemetry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;translation_notebook&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;framework&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;pytorch&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;åŠ è½½wmt19æ•°æ®é›†&#34;&gt;åŠ è½½wmt19æ•°æ®é›†&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä½¿ç”¨&lt;a href=&#34;https://github.com/huggingface/datasets&#34;&gt;ğŸ¤—Datasets&lt;/a&gt;åº“ä¸‹è½½æ•°æ®å¹¶è·å¾—æˆ‘ä»¬éœ€è¦ç”¨äºè¯„ä¼°çš„æŒ‡æ ‡(å°†æˆ‘ä»¬çš„æ¨¡å‹ä¸åŸºå‡†è¿›è¡Œæ¯”è¾ƒ)ã€‚è¿™å¯ä»¥é€šè¿‡&lt;code&gt;load_dataset&lt;/code&gt;å’Œ&lt;code&gt;load_metric&lt;/code&gt;å‡½æ•°è½»æ¾å®ç°ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨&lt;a href=&#34;https://huggingface.co/datasets/wmt19&#34;&gt;haggingface datasets WMT19æ•°æ®é›†&lt;/a&gt;çš„è‹±è¯­/ä¸­æ–‡(zh-en)éƒ¨åˆ† 19M æ¡æ•°æ®, è¿™é‡Œä½¿ç”¨train è®­ç»ƒæ•°æ®é›†çš„å‰100,0000æ¡ä½œä¸ºè®­ç»ƒæ•°æ®ï¼Œ å…¶ä¸­20%çš„æ•°æ®ç”¨äºæµ‹è¯•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;datasets&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;load_dataset&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;raw_datasets&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;load_dataset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;wmt19&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;zh-en&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#raw_datasets = load_dataset(&amp;#34;wmt19&amp;#34;, &amp;#34;zh-en&amp;#34;,split=&amp;#34;train[:1000]&amp;#34;)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#raw_datasets = load_dataset(&amp;#34;wmt19&amp;#34;, &amp;#34;zh-en&amp;#34;,split=&amp;#34;train[:1000000]&amp;#34;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;raw_datasets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# å–æ ·ä¸€éƒ¨åˆ†ç”¨æ¥è®­ç»ƒæµ‹è¯•&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;train_datasets&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;raw_datasets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;train&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;train_test_split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;train_size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;train_datasets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;validation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;raw_datasets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;validation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;train_datasets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;#è¦è®¿é—®ä¸€ä¸ªå®é™…çš„å…ƒç´ ï¼Œé¦–å…ˆéœ€è¦é€‰æ‹©ä¸€ä¸ªåˆ‡åˆ†ï¼Œç„¶åç»™å‡ºä¸€ä¸ªç´¢å¼•:&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;train_datasets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;train&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;train_datasets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;test&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;train_datasets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;validation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†å¯¹æ•°æ®çš„å½¢çŠ¶æœ‰ä¸€ä¸ªå¤§è‡´çš„äº†è§£ï¼Œä¸‹é¢çš„å‡½æ•°å°†å±•ç¤ºä¸€äº›ä»æ•°æ®é›†ä¸­éšæœºé€‰å–çš„ç¤ºä¾‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;datasets&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;random&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;pandas&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;pd&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;IPython.display&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;display&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HTML&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;show_random_elements&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dataset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_examples&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_examples&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dataset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Can&amp;#39;t pick more elements than there are in the dataset.&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;picks&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_examples&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;pick&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;random&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;randint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dataset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pick&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;picks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;pick&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;random&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;randint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dataset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;picks&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pick&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;df&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pd&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DataFrame&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dataset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;picks&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;column&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;typ&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dataset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;features&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;isinstance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;typ&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;datasets&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ClassLabel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;df&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;column&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;df&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;column&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;transform&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;lambda&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;typ&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;names&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;display&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HTML&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;df&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_html&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()))&lt;/span&gt;
    
&lt;span class=&#34;n&#34;&gt;show_random_elements&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;train_datasets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;train&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;show_random_elements&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;train_datasets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;test&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;show_random_elements&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;train_datasets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;validation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;load_metric è¿”å›&lt;code&gt;datasets.Metric&lt;/code&gt;å®ä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;datasets&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;load_metric&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;metric&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;load_metric&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;sacrebleu&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;metric&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨Hugging Faceçš„Datasetsåº“ä¸­ï¼Œ&lt;code&gt;datasets.Metric&lt;/code&gt;æ˜¯ä¸€ä¸ªç”¨äºè¯„ä¼°æ¨¡å‹æ€§èƒ½çš„ç±»ã€‚å®ƒæä¾›äº†ä¸€ç§æ ‡å‡†åŒ–çš„æ–¹å¼æ¥è®¡ç®—å’ŒæŠ¥å‘Šæ¨¡å‹åœ¨ç‰¹å®šä»»åŠ¡ä¸Šçš„æ€§èƒ½æŒ‡æ ‡ï¼Œä¾‹å¦‚å‡†ç¡®åº¦ã€ç²¾ç¡®åº¦ã€å¬å›ç‡æˆ–F1åˆ†æ•°ç­‰ã€‚ é€šè¿‡ä½¿ç”¨&lt;code&gt;datasets.Metric&lt;/code&gt;ç±»ï¼Œæ‚¨å¯ä»¥ç¡®ä¿æ‚¨çš„è¯„ä¼°è¿‡ç¨‹ä¸å…¶ä»–äººçš„å·¥ä½œä¿æŒä¸€è‡´ï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾åœ°ä¸å…¶ä»–æ¨¡å‹æˆ–ç»“æœè¿›è¡Œæ¯”è¾ƒã€‚è¿™ä¸ªç±»å°è£…äº†è®¡ç®—æŒ‡æ ‡æ‰€éœ€çš„æ‰€æœ‰é€»è¾‘ï¼Œå› æ­¤æ‚¨åªéœ€è¦æä¾›æ¨¡å‹çš„é¢„æµ‹ç»“æœå’ŒçœŸå®çš„æ ‡ç­¾ï¼Œå®ƒå°±ä¼šä¸ºæ‚¨è®¡ç®—å‡ºç›¸åº”çš„æ€§èƒ½æŒ‡æ ‡ã€‚ æ­¤å¤–ï¼Œ&lt;code&gt;datasets.Metric&lt;/code&gt;ç±»è¿˜æ”¯æŒå¤šç§ä¸åŒçš„è¯„ä¼°æŒ‡æ ‡ï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾åœ°æ‰©å±•ä»¥æ”¯æŒæ›´å¤šçš„æŒ‡æ ‡ã€‚è¿™ä½¿å¾—å®ƒæˆä¸ºä¸€ä¸ªéå¸¸çµæ´»å’Œå¼ºå¤§çš„å·¥å…·ï¼Œé€‚ç”¨äºå„ç§ä¸åŒçš„è‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡å’Œè¯„ä¼°åœºæ™¯ã€‚&lt;/p&gt;
&lt;p&gt;æ‚¨å¯ä»¥ä½¿ç”¨æ‚¨çš„é¢„æµ‹ç»“æœå’Œæ ‡ç­¾è°ƒç”¨å…¶&lt;code&gt;compute&lt;/code&gt;æ–¹æ³•ï¼Œè¿™äº›é¢„æµ‹ç»“æœå’Œæ ‡ç­¾éœ€è¦æ˜¯è§£ç åçš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ˆlabelsä¸ºåˆ—è¡¨çš„åˆ—è¡¨ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;fake_preds&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;hello there&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;general kenobi&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;fake_labels&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;hello there&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;general kenobi&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]]&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;metric&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;compute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;predictions&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fake_preds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;references&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fake_labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­åŒ…å«ä¸€ä¸ªåº¦é‡æ ‡å‡†é€šå¸¸æœ‰åŠ©äºè¯„ä¼°æ¨¡å‹çš„æ€§èƒ½ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ ğŸ¤— &lt;a href=&#34;https://huggingface.co/docs/evaluate/index&#34;&gt;Evaluate&lt;/a&gt; åº“å¿«é€ŸåŠ è½½ä¸€ä¸ªè¯„ä¼°æ–¹æ³•ã€‚å¯¹äºè¿™ä¸ªä»»åŠ¡ï¼ŒåŠ è½½ &lt;a href=&#34;https://huggingface.co/spaces/evaluate-metric/sacrebleu&#34;&gt;SacreBLEU&lt;/a&gt; åº¦é‡æ ‡å‡†ï¼ˆæŸ¥çœ‹ ğŸ¤— Evaluate &lt;a href=&#34;https://huggingface.co/docs/evaluate/a_quick_tour&#34;&gt;å¿«é€Ÿå…¥é—¨&lt;/a&gt; ä»¥äº†è§£å¦‚ä½•åŠ è½½å’Œè®¡ç®—åº¦é‡æ ‡å‡†ï¼‰;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šéªŒè¯/æµ‹è¯•å¾ªç¯è´Ÿè´£è¯„ä¼°æ¨¡å‹çš„æ€§èƒ½ã€‚å¯¹äºç¿»è¯‘ä»»åŠ¡ï¼Œç»å…¸çš„è¯„ä¼°æŒ‡æ ‡æ˜¯ Kishore Papineni ç­‰äººåœ¨&lt;a href=&#34;https://aclanthology.org/P02-1040.pdf&#34;&gt;ã€ŠBLEU: a Method for Automatic Evaluation of Machine Translationã€‹&lt;/a&gt;ä¸­æå‡ºçš„ &lt;a href=&#34;https://en.wikipedia.org/wiki/BLEU&#34;&gt;BLEU å€¼&lt;/a&gt;ï¼Œç”¨äºåº¦é‡ä¸¤ä¸ªè¯è¯­åºåˆ—ä¹‹é—´çš„ä¸€è‡´æ€§ï¼Œä½†æ˜¯å…¶å¹¶ä¸ä¼šè¡¡é‡è¯­ä¹‰è¿è´¯æ€§æˆ–è€…è¯­æ³•æ­£ç¡®æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºè®¡ç®— BLEU å€¼éœ€è¦è¾“å…¥åˆ†å¥½è¯çš„æ–‡æœ¬ï¼Œè€Œä¸åŒçš„åˆ†è¯æ–¹å¼ä¼šå¯¹ç»“æœé€ æˆå½±å“ï¼Œå› æ­¤ç°åœ¨æ›´å¸¸ç”¨çš„è¯„ä¼°æŒ‡æ ‡æ˜¯ &lt;a href=&#34;https://github.com/mjpost/sacrebleu&#34;&gt;SacreBLEU&lt;/a&gt;ï¼Œå®ƒå¯¹åˆ†è¯çš„è¿‡ç¨‹è¿›è¡Œäº†æ ‡å‡†åŒ–ã€‚SacreBLEU ç›´æ¥ä»¥æœªåˆ†è¯çš„æ–‡æœ¬ä½œä¸ºè¾“å…¥ï¼Œå¹¶ä¸”å¯¹äºåŒä¸€ä¸ªè¾“å…¥å¯ä»¥æ¥å—å¤šä¸ªç›®æ ‡ä½œä¸ºå‚è€ƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;é¢„å¤„ç†æ•°æ®&#34;&gt;é¢„å¤„ç†æ•°æ®&lt;/h3&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬å°†è¿™äº›æ–‡æœ¬è¾“å…¥æ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé¢„å¤„ç†ã€‚è¿™æ˜¯é€šè¿‡ğŸ¤— Transformersçš„&lt;code&gt;Tokenizer&lt;/code&gt;å®Œæˆçš„ï¼Œå®ƒå°†ï¼ˆæ­£å¦‚å…¶åç§°æ‰€ç¤ºï¼‰å¯¹è¾“å…¥è¿›è¡Œåˆ†è¯ï¼ˆåŒ…æ‹¬å°†åˆ†è¯è½¬æ¢ä¸ºé¢„è®­ç»ƒè¯æ±‡è¡¨ä¸­å¯¹åº”çš„IDï¼‰å¹¶å°†å…¶ç½®äºæ¨¡å‹æœŸæœ›çš„æ ¼å¼ä¸­ï¼ŒåŒæ—¶ç”Ÿæˆæ¨¡å‹æ‰€éœ€çš„å…¶ä»–è¾“å…¥ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å®Œæˆæ‰€æœ‰è¿™äº›å·¥ä½œï¼Œæˆ‘ä»¬ä½¿ç”¨&lt;code&gt;AutoTokenizer.from_pretrained&lt;/code&gt;æ–¹æ³•å®ä¾‹åŒ–æˆ‘ä»¬çš„åˆ†è¯å™¨ï¼Œè¿™å°†ç¡®ä¿ï¼š&lt;/p&gt;
&lt;p&gt;- æˆ‘ä»¬è·å¾—ä¸æˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„æ¨¡å‹æ¶æ„ç›¸å¯¹åº”çš„åˆ†è¯å™¨ï¼Œ&lt;/p&gt;
&lt;p&gt;- æˆ‘ä»¬ä¸‹è½½äº†é¢„è®­ç»ƒè¿™ä¸ªç‰¹å®šæ£€æŸ¥ç‚¹æ—¶ä½¿ç”¨çš„è¯æ±‡è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªè¯æ±‡è¡¨å°†è¢«ç¼“å­˜ï¼Œå› æ­¤ä¸‹æ¬¡æˆ‘ä»¬è¿è¡Œå•å…ƒæ ¼æ—¶ä¸ä¼šå†æ¬¡ä¸‹è½½ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä½¿ç”¨&lt;code&gt;AutoTokenizer.from_pretrained&lt;/code&gt;æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åŠ è½½ä¸ç‰¹å®šæ¨¡å‹æ¶æ„ç›¸åŒ¹é…çš„åˆ†è¯å™¨ï¼Œè€Œæ— éœ€æ‹…å¿ƒè¯æ±‡è¡¨çš„ä¸‹è½½å’Œå¤„ç†ã€‚è¿™ä¸ä»…ç®€åŒ–äº†é¢„å¤„ç†æ­¥éª¤ï¼Œè¿˜æé«˜äº†æ•ˆç‡ï¼Œå› ä¸ºç¼“å­˜çš„è¯æ±‡è¡¨å¯ä»¥åœ¨åç»­çš„è¿è¡Œä¸­é‡å¤ä½¿ç”¨ï¼Œé¿å…äº†é‡å¤ä¸‹è½½çš„å¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€æ—¦æˆ‘ä»¬æœ‰äº†åˆ†è¯å™¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹æ•°æ®é›†ä¸­çš„æ–‡æœ¬è¿›è¡Œåˆ†è¯å¤„ç†ï¼Œå°†å®ƒä»¬è½¬æ¢æˆæ¨¡å‹èƒ½å¤Ÿç†è§£çš„æ ¼å¼ã€‚è¿™é€šå¸¸åŒ…æ‹¬å°†æ–‡æœ¬åˆ†å‰²æˆå•ç‹¬çš„å•è¯æˆ–å­è¯å•å…ƒï¼ˆtokensï¼‰ï¼Œå°†è¿™äº›å•å…ƒè½¬æ¢ä¸ºæ•°å€¼IDï¼Œå¹¶å°†å®ƒä»¬ç»„åˆæˆé€‚åˆæ¨¡å‹è¾“å…¥çš„æ‰¹æ¬¡ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œåˆ†è¯å™¨è¿˜å¯ä»¥å¤„ç†å…¶ä»–ä¸æ¨¡å‹è¾“å…¥ç›¸å…³çš„ä»»åŠ¡ï¼Œä¾‹å¦‚æ·»åŠ å¿…è¦çš„ç‰¹æ®Šæ ‡è®°ï¼ˆå¦‚å¼€å§‹ã€ç»“æŸæˆ–åˆ†éš”ç¬¦æ ‡è®°ï¼‰ï¼Œå¡«å……æˆ–æˆªæ–­åºåˆ—ä»¥ç¡®ä¿ä¸€è‡´çš„è¾“å…¥é•¿åº¦ï¼Œä»¥åŠç”Ÿæˆæ³¨æ„åŠ›æ©ç ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œåˆ†è¯å™¨åœ¨å°†åŸå§‹æ–‡æœ¬æ•°æ®è½¬æ¢ä¸ºæ¨¡å‹å¯ä»¥å¤„ç†çš„æ ¼å¼æ–¹é¢å‘æŒ¥ç€å…³é”®ä½œç”¨ï¼Œæ˜¯è‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚é€šè¿‡ä½¿ç”¨Hugging Faceçš„Transformersåº“ä¸­çš„&lt;code&gt;AutoTokenizer&lt;/code&gt;ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ä¸ºå„ç§æ¨¡å‹æ¶æ„è¿›è¡Œé«˜æ•ˆçš„æ–‡æœ¬é¢„å¤„ç†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoTokenizer&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoTokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_pretrained&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;model_checkpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Hello, this one sentence!&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸Šé¢çš„è°ƒç”¨å°†ä½¿ç”¨ğŸ¤—tokenizersåº“ä¸­çš„ä¸€ä¸ªå¿«é€Ÿåˆ†è¯å™¨(åº•å±‚ç”±&lt;a href=&#34;https://github.com/huggingface/tokenizers&#34;&gt;Rustå°è£…æ”¯æŒ&lt;/a&gt; )ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ®æ‚¨é€‰æ‹©çš„æ¨¡å‹ï¼Œæ‚¨å°†åœ¨ä¸Šè¿°å•å…ƒæ ¼è¿”å›çš„å­—å…¸ä¸­çœ‹åˆ°ä¸åŒçš„é”®ã€‚å¯¹äºæˆ‘ä»¬åœ¨è¿™é‡Œè¦åšçš„äº‹æƒ…ï¼Œå®ƒä»¬å¹¶ä¸é‡è¦ï¼ˆåªéœ€çŸ¥é“å®ƒä»¬æ˜¯æˆ‘ä»¬ç¨åå°†å®ä¾‹åŒ–çš„æ¨¡å‹æ‰€éœ€çš„ï¼‰ï¼Œå¦‚æœæ‚¨æ„Ÿå…´è¶£ï¼Œå¯ä»¥åœ¨&lt;a href=&#34;https://huggingface.co/transformers/preprocessing.html&#34;&gt;è¿™ä¸ªæ•™ç¨‹&lt;/a&gt;ä¸­äº†è§£æ›´å¤šå…³äºå®ƒä»¬çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥ä¼ é€’ä¸€ä¸ªå¥å­åˆ—è¡¨ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªå¥å­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;test_token&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Hello, this one sentence!&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;This is another sentence.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;hello&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;return_tensors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;pt&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;padding&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;truncation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_ids&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æ¨¡å‹é¢„æµ‹å‡ºçš„æ ‡ç­¾åºåˆ—ä¸ç­”æ¡ˆæ ‡ç­¾åºåˆ—ä¹‹é—´è®¡ç®—æŸå¤±æ¥è°ƒæ•´æ¨¡å‹å‚æ•°ï¼Œå› æ­¤æˆ‘ä»¬åŒæ ·éœ€è¦å°†å¡«å……çš„ pad å­—ç¬¦è®¾ç½®ä¸º -100ï¼Œä»¥ä¾¿åœ¨ä½¿ç”¨äº¤å‰ç†µè®¡ç®—åºåˆ—æŸå¤±æ—¶å°†å®ƒä»¬å¿½ç•¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;torch&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_token&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pad_token_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;test_token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;end_token_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_token&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;eos_token_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_token_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;idx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end_idx&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;enumerate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_token_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;idx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_idx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;test_token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;idx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_idx&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;test_token&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†å‡†å¤‡æˆ‘ä»¬æ¨¡å‹çš„ç›®æ ‡åºåˆ—ï¼Œæˆ‘ä»¬éœ€è¦åœ¨&lt;code&gt;as_target_tokenizer&lt;/code&gt;ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸­å¯¹å®ƒä»¬è¿›è¡Œåˆ†è¯ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åˆ†è¯å™¨ä½¿ç”¨ä¸ç›®æ ‡ç›¸å¯¹åº”çš„ç‰¹æ®Šæ ‡è®°ï¼š&lt;/p&gt;
&lt;p&gt;åœ¨è¿›è¡Œæœºå™¨ç¿»è¯‘æˆ–å…¶ä»–åºåˆ—åˆ°åºåˆ—ä»»åŠ¡æ—¶ï¼Œé€šå¸¸éœ€è¦å¯¹ç›®æ ‡åºåˆ—ï¼ˆä¾‹å¦‚ï¼Œç¿»è¯‘ç›®æ ‡è¯­è¨€çš„å¥å­ï¼‰è¿›è¡Œåˆ†è¯å¤„ç†ã€‚ä¸ºäº†ç¡®ä¿ç›®æ ‡åºåˆ—çš„åˆ†è¯æ­£ç¡®åœ°ä½¿ç”¨äº†ç‰¹æ®Šæ ‡è®°ï¼ˆå¦‚å¼€å§‹ã€ç»“æŸã€åˆ†éš”ç¬¦ç­‰ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;code&gt;as_target_tokenizer&lt;/code&gt;ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€‚
ä¸‹é¢æ˜¯ä¸€ä¸ªå¦‚ä½•ä½¿ç”¨&lt;code&gt;as_target_tokenizer&lt;/code&gt;æ¥å¯¹ç›®æ ‡åºåˆ—è¿›è¡Œåˆ†è¯çš„ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoTokenizer&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# å‡è®¾æ‚¨å·²ç»åŠ è½½äº†é€‚åˆæ‚¨æ¨¡å‹çš„åˆ†è¯å™¨&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoTokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_pretrained&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;model-name-or-path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# ç›®æ ‡åºåˆ—åˆ—è¡¨&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;targets&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;The translated sentence.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Another translated sentence.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# ä½¿ç”¨as_target_tokenizerä¸Šä¸‹æ–‡ç®¡ç†å™¨è¿›è¡Œåˆ†è¯&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;as_target_tokenizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# å¯¹ç›®æ ‡åºåˆ—è¿›è¡Œåˆ†è¯&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;encoded_targets&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;targets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;padding&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;truncation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;return_tensors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;pt&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    
&lt;span class=&#34;c1&#34;&gt;# åç»­transformså‡çº§ä½¿ç”¨ text_target å‚æ•°&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# print(tokenizer(text_target=[&amp;#34;Hello, this one sentence!&amp;#34;, &amp;#34;This is another sentence.&amp;#34;],return_tensors=&amp;#34;pt&amp;#34;,padding=True,truncation=True))&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# ç°åœ¨encoded_targetsåŒ…å«äº†åˆ†è¯åçš„ç›®æ ‡åºåˆ—ï¼Œå¯ä»¥ä½¿ç”¨å®ƒä»¬ä½œä¸ºæ¨¡å‹çš„ç›®æ ‡è¾“å…¥&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåŠ è½½äº†ä¸€ä¸ªé€‚åˆæˆ‘ä»¬æ¨¡å‹çš„åˆ†è¯å™¨ã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«ç›®æ ‡åºåˆ—çš„åˆ—è¡¨&lt;code&gt;targets&lt;/code&gt;ã€‚é€šè¿‡ä½¿ç”¨&lt;code&gt;as_target_tokenizer&lt;/code&gt;ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œæˆ‘ä»¬ç¡®ä¿äº†åœ¨å¯¹ç›®æ ‡åºåˆ—è¿›è¡Œåˆ†è¯æ—¶ï¼Œåˆ†è¯å™¨ä½¿ç”¨äº†æ­£ç¡®çš„ç‰¹æ®Šæ ‡è®°ã€‚
åœ¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„ä½œç”¨ä¸‹ï¼Œæˆ‘ä»¬è°ƒç”¨äº†&lt;code&gt;tokenizer&lt;/code&gt;æ–¹æ³•å¯¹ç›®æ ‡åºåˆ—è¿›è¡Œåˆ†è¯ï¼Œå¹¶é€šè¿‡&lt;code&gt;padding&lt;/code&gt;å‚æ•°å¯¹åºåˆ—è¿›è¡Œå¡«å……ï¼Œ&lt;code&gt;truncation&lt;/code&gt;å‚æ•°æˆªæ–­è¾ƒé•¿çš„åºåˆ—ï¼Œ&lt;code&gt;return_tensors&lt;/code&gt;å‚æ•°è®¾ç½®ä¸º&lt;code&gt;&amp;quot;pt&amp;quot;&lt;/code&gt;è¡¨ç¤ºè¿”å›çš„æ˜¯PyTorchå¼ é‡æ ¼å¼ã€‚
æœ€åï¼Œ&lt;code&gt;encoded_targets&lt;/code&gt;å°†åŒ…å«åˆ†è¯åçš„ç›®æ ‡åºåˆ—ï¼Œå®ƒä»¬å·²ç»è½¬æ¢æˆäº†æ¨¡å‹æ‰€éœ€çš„æ ¼å¼ï¼Œå¯ä»¥ç›´æ¥ç”¨äºæ¨¡å‹è®­ç»ƒæˆ–è¯„ä¼°æ—¶çš„ç›®æ ‡è¾“å…¥ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿ç›®æ ‡åºåˆ—çš„åˆ†è¯ä¸æ¨¡å‹çš„æœŸæœ›ç›¸åŒ¹é…ï¼Œä»è€Œæé«˜æ¨¡å‹çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥é¢„å¤„ç†æˆ‘ä»¬çš„æ ·æœ¬ã€‚æˆ‘ä»¬åªéœ€å°†å®ƒä»¬ä¼ é€’ç»™&lt;code&gt;tokenizer&lt;/code&gt;ï¼Œå¹¶ä½¿ç”¨å‚æ•°&lt;code&gt;truncation=True&lt;/code&gt;ã€‚è¿™å°†ç¡®ä¿å¦‚æœè¾“å…¥é•¿åº¦è¶…è¿‡äº†æ¨¡å‹èƒ½å¤Ÿå¤„ç†çš„æœ€å¤§é•¿åº¦ï¼Œå®ƒå°†è¢«æˆªæ–­åˆ°æ¨¡å‹æ‰€èƒ½æ¥å—çš„æœ€å¤§é•¿åº¦ã€‚å¡«å……æ“ä½œå°†åœ¨åç»­å¤„ç†ä¸­è¿›è¡Œï¼ˆé€šè¿‡æ•°æ®æ•´ç†å™¨ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€å°†æ ·æœ¬å¡«å……åˆ°æ‰¹æ¬¡ä¸­çš„æœ€é•¿é•¿åº¦ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ•°æ®é›†çš„é•¿åº¦ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ä¸€ä¸ªé¢„å¤„ç†æ ·æœ¬çš„å‡½æ•°ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoTokenizer&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# å‡è®¾æ‚¨å·²ç»åŠ è½½äº†é€‚åˆæ‚¨æ¨¡å‹çš„åˆ†è¯å™¨&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoTokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_pretrained&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;model-name-or-path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;preprocess_samples&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;samples&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    å¯¹æ ·æœ¬åˆ—è¡¨è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬åˆ†è¯å’Œæˆªæ–­ã€‚
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    å‚æ•°:
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;        samples (list): è¦é¢„å¤„ç†çš„æ ·æœ¬åˆ—è¡¨ã€‚
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    è¿”å›:
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;        list: é¢„å¤„ç†åçš„æ ·æœ¬åˆ—è¡¨ã€‚
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# ä½¿ç”¨åˆ†è¯å™¨å¯¹æ ·æœ¬è¿›è¡Œåˆ†è¯å’Œæˆªæ–­&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;encoded_inputs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;samples&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;truncation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;padding&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;max_length&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_length&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;512&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;return_tensors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;pt&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;encoded_inputs&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# ç¤ºä¾‹ï¼šé¢„å¤„ç†ä¸€äº›æ ·æœ¬&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;samples&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;The first sample text.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;A longer sample text that might need to be truncated.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;preprocessed_samples&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;preprocess_samples&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;samples&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# é¢„å¤„ç†åçš„æ ·æœ¬ç°åœ¨å¯ä»¥ç›´æ¥ç”¨äºæ¨¡å‹çš„è¾“å…¥&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåŠ è½½äº†ä¸€ä¸ªé€‚åˆæˆ‘ä»¬æ¨¡å‹çš„åˆ†è¯å™¨ã€‚ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª&lt;code&gt;preprocess_samples&lt;/code&gt;å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªæ ·æœ¬åˆ—è¡¨ä½œä¸ºè¾“å…¥ï¼Œä½¿ç”¨åˆ†è¯å™¨å¯¹æ¯ä¸ªæ ·æœ¬è¿›è¡Œåˆ†è¯å’Œæˆªæ–­ã€‚
æˆ‘ä»¬é€šè¿‡è®¾ç½®&lt;code&gt;padding=&#39;max_length&#39;&lt;/code&gt;æ¥æŒ‡å®šæ‰€æœ‰æ ·æœ¬éƒ½åº”è¯¥å¡«å……åˆ°æ‰¹æ¬¡ä¸­çš„æœ€å¤§é•¿åº¦ï¼Œè€Œ&lt;code&gt;max_length&lt;/code&gt;å‚æ•°è®¾ç½®äº†è¿™ä¸ªé•¿åº¦çš„å…·ä½“å€¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†å…¶è®¾ç½®ä¸º512ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„é•¿åº¦é™åˆ¶å€¼ï¼Œä½†æ‚¨åº”è¯¥æ ¹æ®æ‚¨çš„æ¨¡å‹å’Œä»»åŠ¡éœ€æ±‚æ¥è°ƒæ•´è¿™ä¸ªå€¼ã€‚
&lt;code&gt;return_tensors=&amp;quot;pt&amp;quot;&lt;/code&gt;å‚æ•°è¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›è¿”å›çš„æ˜¯PyTorchå¼ é‡æ ¼å¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å°†é¢„å¤„ç†åçš„æ•°æ®ä¼ é€’ç»™PyTorchæ¨¡å‹ã€‚
æœ€åï¼Œ&lt;code&gt;preprocessed_samples&lt;/code&gt;å°†åŒ…å«é¢„å¤„ç†åçš„æ ·æœ¬ï¼Œå®ƒä»¬å·²ç»è½¬æ¢æˆäº†æ¨¡å‹æ‰€éœ€çš„æ ¼å¼ï¼Œå¯ä»¥ç›´æ¥ç”¨äºæ¨¡å‹çš„è¾“å…¥ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿æ‰€æœ‰è¾“å…¥æ•°æ®éƒ½ç¬¦åˆæ¨¡å‹çš„é¢„æœŸæ ¼å¼ï¼Œå¹¶ä¸”å¤„ç†äº†è¿‡é•¿çš„è¾“å…¥ï¼Œä½¿å¾—æ¨¡å‹èƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†å®ƒä»¬ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“å®ç°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;torch&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;max_input_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;512&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;max_target_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;512&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;source_lang&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;en&amp;#34;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;target_lang&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;zh&amp;#34;&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;preprocess_function&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;examples&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;inputs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source_lang&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ex&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;examples&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;translation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;targets&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target_lang&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ex&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;examples&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;translation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;model_inputs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inputs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_length&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;max_input_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;truncation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;padding&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;return_tensors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;pt&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;# Setup the tokenizer for targets&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;as_target_tokenizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;labels_input_ids&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;targets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_length&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;max_target_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;truncation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;padding&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;return_tensors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;pt&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_ids&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;end_token_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;labels_input_ids&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;eos_token_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;idx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end_idx&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;enumerate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_token_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;labels_input_ids&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;idx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_idx&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;
        
    &lt;span class=&#34;n&#34;&gt;model_inputs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;labels&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;labels_input_ids&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;model_inputs&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¦å°†æ­¤å‡½æ•°åº”ç”¨äºæ•°æ®é›†ä¸­çš„æ‰€æœ‰å¥å­å¯¹ï¼Œæˆ‘ä»¬åªéœ€ä½¿ç”¨ä¹‹å‰åˆ›å»ºçš„&lt;code&gt;dataset&lt;/code&gt;å¯¹è±¡çš„&lt;code&gt;map&lt;/code&gt;æ–¹æ³•ã€‚è¿™å°†å¯¹&lt;code&gt;dataset&lt;/code&gt;ä¸­æ‰€æœ‰åˆ’åˆ†çš„æ‰€æœ‰å…ƒç´ åº”ç”¨è¯¥å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬çš„è®­ç»ƒã€éªŒè¯å’Œæµ‹è¯•æ•°æ®å°†åœ¨ä¸€ä¸ªå‘½ä»¤ä¸­é¢„å¤„ç†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;tokenized_datasets&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;raw_datasets&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;map&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;preprocess_function&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;batched&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;load_from_cache_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;remove_columns&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;translation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tokenized_datasets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;DatasetDict({
    train: Dataset({
        features: [&amp;#39;input_ids&amp;#39;, &amp;#39;attention_mask&amp;#39;, &amp;#39;labels&amp;#39;],
        num_rows: 100000
    })
    test: Dataset({
        features: [&amp;#39;input_ids&amp;#39;, &amp;#39;attention_mask&amp;#39;, &amp;#39;labels&amp;#39;],
        num_rows: 1000
    })
    validation: Dataset({
        features: [&amp;#39;input_ids&amp;#39;, &amp;#39;attention_mask&amp;#39;, &amp;#39;labels&amp;#39;],
        num_rows: 3981
    })
})
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ›´å¥½çš„æ˜¯ï¼ŒğŸ¤—æ•°æ®é›†åº“ä¼šè‡ªåŠ¨ç¼“å­˜ç»“æœï¼Œä»¥é¿å…ä¸‹æ¬¡è¿è¡Œç¬”è®°æœ¬æ—¶åœ¨è¿™ä¸€æ­¥ä¸ŠèŠ±è´¹æ—¶é—´ã€‚ğŸ¤—æ•°æ®é›†åº“é€šå¸¸è¶³å¤Ÿæ™ºèƒ½ï¼Œå¯ä»¥æ£€æµ‹ä¼ é€’ç»™mapçš„å‡½æ•°ä½•æ—¶å‘ç”Ÿäº†å˜åŒ–(å› æ­¤éœ€è¦ä¸ä½¿ç”¨ç¼“å­˜æ•°æ®)ã€‚ä¾‹å¦‚ï¼Œå®ƒä¼šæ­£ç¡®åœ°æ£€æµ‹ä½ æ˜¯å¦æ›´æ”¹äº†ç¬¬ä¸€ä¸ªå•å…ƒæ ¼ä¸­çš„ä»»åŠ¡å¹¶é‡æ–°è¿è¡Œnotebookã€‚ğŸ¤—æ•°æ®é›†è­¦å‘Šæ‚¨ï¼Œå½“å®ƒä½¿ç”¨ç¼“å­˜æ–‡ä»¶æ—¶ï¼Œæ‚¨å¯ä»¥åœ¨è°ƒç”¨&lt;code&gt;map&lt;/code&gt;æ—¶ä¼ é€’&lt;code&gt;load_from_cache_file=False&lt;/code&gt;ï¼Œä»¥ä¸ä½¿ç”¨ç¼“å­˜æ–‡ä»¶ï¼Œå¹¶å¼ºåˆ¶å†æ¬¡åº”ç”¨é¢„å¤„ç†ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼Œæˆ‘ä»¬ä¼ å…¥&lt;code&gt;batched=True&lt;/code&gt;æ¥å°†æ–‡æœ¬æŒ‰æ‰¹æ¬¡ç¼–ç åœ¨ä¸€èµ·ã€‚è¿™æ˜¯ä¸ºäº†å……åˆ†åˆ©ç”¨å‰é¢åŠ è½½çš„å¿«é€Ÿåˆ†è¯å™¨çš„ä¼˜åŠ¿ï¼Œå®ƒå°†ä½¿ç”¨å¤šçº¿ç¨‹å¹¶å‘åœ°å¤„ç†ä¸€æ‰¹æ–‡æœ¬ã€‚æ›´å¤šæ“ä½œè§NLPè¯¾ç¨‹ä¸­çš„datasetsåº“æ“ä½œ &lt;a href=&#34;https://huggingface.co/learn/nlp-course/chapter5/&#34;&gt;&lt;strong&gt;Huggingface NLP course datasets lib&lt;/strong&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;å¾®è°ƒæ¨¡å‹&#34;&gt;å¾®è°ƒæ¨¡å‹&lt;/h3&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬çš„æ•°æ®å·²ç»å‡†å¤‡å¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹å¹¶å¯¹å…¶è¿›è¡Œå¾®è°ƒã€‚ç”±äºæˆ‘ä»¬çš„ä»»åŠ¡æ˜¯åºåˆ—åˆ°åºåˆ—çš„ç±»å‹ï¼Œæˆ‘ä»¬ä½¿ç”¨&lt;code&gt;AutoModelForSeq2SeqLM&lt;/code&gt;ç±»ã€‚ä¸tokenizerä¸€æ ·ï¼Œ&lt;code&gt;from_pretrained&lt;/code&gt;æ–¹æ³•å°†ä¸ºæˆ‘ä»¬ä¸‹è½½å¹¶ç¼“å­˜æ¨¡å‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoModelForSeq2SeqLM&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DataCollatorForSeq2Seq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Seq2SeqTrainingArguments&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Seq2SeqTrainer&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;model&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoModelForSeq2SeqLM&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_pretrained&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;model_checkpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é¦–å…ˆç”¨wmt19æœ¬èº«çš„éªŒè¯é›†æ¥æ¥æµ‹è¯•ä¸‹æœªå¾®è°ƒçš„æ¨¡å‹ BLEUå¾—åˆ†ï¼ŒSacreBLEU é»˜è®¤ä¼šé‡‡ç”¨ mteval-v13a.pl åˆ†è¯å™¨å¯¹æ–‡æœ¬è¿›è¡Œåˆ†è¯ï¼Œä½†æ˜¯å®ƒæ— æ³•å¤„ç†ä¸­æ–‡ã€æ—¥æ–‡ç­‰éæ‹‰ä¸ç³»è¯­è¨€ã€‚å¯¹äºä¸­æ–‡å°±éœ€è¦è®¾ç½®å‚æ•° tokenize=&amp;lsquo;zh&amp;rsquo; æ‰‹åŠ¨ä½¿ç”¨ä¸­æ–‡åˆ†è¯å™¨ï¼Œå¦åˆ™ä¼šè®¡ç®—å‡ºä¸æ­£ç¡®çš„ BLEU å€¼ï¼Œä»¥ä¸‹æ˜¯ä½¿ç”¨ åŸå§‹çš„ sacrebleuåº“ä¸­metrics BLEUæ¥è¯„ä¼°å¤„ç†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;sacrebleu.metrics&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BLEU&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;tqdm&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tqdm&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;bleu&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BLEU&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tokenize&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;zh&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;#åº”è¯¥ä½¿ç”¨æ‰¹å¤„ç†æ–¹å¼ï¼ŒéªŒè¯æ•°æ®é›†å‰100ä¸ªè¿›è¡Œè¯„ä¼°&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;validation_examples&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;train_datasets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;validation&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;batch_data&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;preprocess_function&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;validation_examples&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch_data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;input_ids&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shape&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;generated_tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch_data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;input_ids&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;cuda&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_new_tokens&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;do_sample&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;top_k&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;top_p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.95&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;label_tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;batch_data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;labels&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
        
&lt;span class=&#34;n&#34;&gt;decoded_preds&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch_decode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generated_tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;skip_special_tokens&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;label_tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;np&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;label_tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;label_tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pad_token_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;decoded_labels&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch_decode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;label_tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;skip_special_tokens&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;preds&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pred&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pred&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decoded_preds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;labels&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;label&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()]&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;label&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decoded_labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;bleu_score&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bleu&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;corpus_score&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;preds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;score&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;BLEU: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bleu_score&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;gt;0.2f&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;BLEU: 12.70
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¯¥æ•°æ®é›†æµ‹è¯•ä¸‹åˆ†æ•°ä¸é«˜&lt;/p&gt;
&lt;p&gt;å¯ä»¥ç›´æ¥ä½¿ç”¨HFçš„ evaluateåº“ï¼Œé€šè¿‡åŠ è½½éªŒè¯æ•°æ®é›†ï¼Œå¯¹æ¨¡å‹è¿›è¡Œæ‰“åˆ†ï¼Œå…·ä½“æ“ä½œè§æ–‡æ¡£ï¼šhttps://huggingface.co/docs/evaluate/indexï¼Œæ“ä½œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pipeline&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;datasets&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;load_dataset&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;evaluate&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;evaluator&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;evaluate&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;#pipe = pipeline(&amp;#34;translation&amp;#34;, model=model_checkpoint, device=0)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#data = raw_datasets[&amp;#34;validation&amp;#34;].shuffle().select(range(1000))&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#metric = load_metric(&amp;#34;sacrebleu&amp;#34;)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#eval = evaluator(&amp;#34;translation&amp;#34;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;#results = eval.compute(model_or_pipeline=model, data=train_datasets[&amp;#34;validation&amp;#34;], metric=metric)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;#print(results)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼š &lt;a href=&#34;https://huggingface.co/docs/evaluate/considerations&#34;&gt;https://huggingface.co/docs/evaluate/considerations&lt;/a&gt; è¯„ä¼°æ³¨æ„äº‹é¡¹&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼Œæˆ‘ä»¬æ²¡æœ‰åƒåˆ†ç±»ç¤ºä¾‹é‚£æ ·å¾—åˆ°è­¦å‘Šã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä½¿ç”¨äº†é¢„è®­ç»ƒæ¨¡å‹çš„æ‰€æœ‰æƒé‡ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ²¡æœ‰éšæœºåˆå§‹åŒ–å¤´éƒ¨ã€‚&lt;/p&gt;
&lt;p&gt;è¦å®ä¾‹åŒ–ä¸€ä¸ª&lt;code&gt;Seq2SeqTrainer&lt;/code&gt;ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®šä¹‰ä¸‰ä»¶äº‹ã€‚æœ€é‡è¦çš„æ˜¯&lt;a href=&#34;https://huggingface.co/transformers/main_classes/trainer.html#transformers.Seq2SeqTrainingArguments&#34;&gt;&lt;code&gt;Seq2SeqTrainingArguments&lt;/code&gt;&lt;/a&gt;ï¼Œè¿™æ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰è‡ªå®šä¹‰è®­ç»ƒå±æ€§çš„ç±»ã€‚å®ƒéœ€è¦ä¸€ä¸ªæ–‡ä»¶å¤¹åï¼Œç”¨äºä¿å­˜æ¨¡å‹çš„æ£€æŸ¥ç‚¹ï¼Œå…¶ä»–æ‰€æœ‰å‚æ•°éƒ½æ˜¯å¯é€‰çš„:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;batch_size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;model_name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;model_checkpoint&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Seq2SeqTrainingArguments&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;model_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;-finetuned-&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source_lang&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;-to-&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;target_lang&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;evaluation_strategy&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;epoch&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;learning_rate&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;2e-5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;per_device_train_batch_size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch_size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;per_device_eval_batch_size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch_size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;weight_decay&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.01&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;save_total_limit&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;num_train_epochs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;predict_with_generate&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;fp16&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;push_to_hub&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è¯„ä¼°è®¾ç½®ä¸ºåœ¨æ¯ä¸ªepochç»“æŸæ—¶å®Œæˆï¼Œè°ƒæ•´å­¦ä¹ ç‡ï¼Œä½¿ç”¨å•å…ƒé¡¶éƒ¨å®šä¹‰çš„&lt;code&gt;batch_size&lt;/code&gt;å¹¶è‡ªå®šä¹‰æƒé‡è¡°å‡ã€‚ç”±äº&lt;code&gt;Seq2SeqTrainer&lt;/code&gt;å°†å®šæœŸä¿å­˜æ¨¡å‹ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„æ•°æ®é›†éå¸¸å¤§ï¼Œæˆ‘ä»¬å‘Šè¯‰å®ƒæœ€å¤šä¿å­˜ä¸‰æ¬¡ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨&lt;code&gt;predict_with_generate&lt;/code&gt;é€‰é¡¹(ä»¥æ­£ç¡®åœ°ç”Ÿæˆæ‘˜è¦)å¹¶æ¿€æ´»æ··åˆç²¾åº¦è®­ç»ƒ(ä»¥æ›´å¿«ä¸€äº›)ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é™„&lt;/strong&gt;ï¼šé—®chatGPTå‚æ•°å›ç­”å†…å®¹ï¼š(ç›¸å¯¹äºæŸ¥æ–‡æ¡£æ–¹ä¾¿å¾ˆå¤šï¼Œå¦‚æœå…¬å…±æ•°æ®å¦‚æœèƒ½è¢«chatGPTå­¦ä¹ åˆ°ï¼Œå¯¹äºå¤æ‚é—®é¢˜æ£€ç´¢æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œæ²¡æœ‰çš„è¯éœ€è¦å¤–æŒ‚æ£€ç´¢ç³»ç»Ÿå¸®å¿™å¡«å……ä¸Šä¸‹æ–‡æ¥Q&amp;amp;A)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-markdown&#34; data-lang=&#34;markdown&#34;&gt;è¿™äº›å‚æ•°æ˜¯ç”¨äºé…ç½®åºåˆ—åˆ°åºåˆ—ï¼ˆSeq2Seqï¼‰è®­ç»ƒçš„ç›¸å…³è®¾ç½®ã€‚ä¸‹é¢æ˜¯å„ä¸ªå‚æ•°çš„å«ä¹‰ï¼š

&lt;span class=&#34;k&#34;&gt;1.&lt;/span&gt; &lt;span class=&#34;sb&#34;&gt;`output_dir`&lt;/span&gt;: æ¨¡å‹å’Œè®­ç»ƒè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ–‡ä»¶çš„è¾“å‡ºç›®å½•ã€‚æ¨¡å‹è®­ç»ƒå®Œæˆåï¼Œè®­ç»ƒçš„æƒé‡ã€æ—¥å¿—æ–‡ä»¶ç­‰å°†ä¿å­˜åœ¨è¯¥ç›®å½•ä¸‹ã€‚

&lt;span class=&#34;k&#34;&gt;2.&lt;/span&gt; &lt;span class=&#34;sb&#34;&gt;`evaluation_strategy`&lt;/span&gt;: è¯„ä¼°ç­–ç•¥ï¼ŒæŒ‡å®šæ¨¡å‹ä½•æ—¶è¿›è¡Œè¯„ä¼°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­è®¾ç½®ä¸º &lt;span class=&#34;sb&#34;&gt;`&amp;#34;epoch&amp;#34;`&lt;/span&gt;ï¼Œè¡¨ç¤ºæ¯ä¸ªè®­ç»ƒè½®æ¬¡ç»“æŸæ—¶è¿›è¡Œä¸€æ¬¡è¯„ä¼°ã€‚å…¶ä»–é€‰é¡¹è¿˜åŒ…æ‹¬ &lt;span class=&#34;sb&#34;&gt;`&amp;#34;steps&amp;#34;`&lt;/span&gt;ï¼ˆæ ¹æ®æ­¥æ•°è¿›è¡Œè¯„ä¼°ï¼‰å’Œ &lt;span class=&#34;sb&#34;&gt;`&amp;#34;no&amp;#34;`&lt;/span&gt;ï¼ˆä¸è¿›è¡Œè¯„ä¼°ï¼‰ã€‚

&lt;span class=&#34;k&#34;&gt;3.&lt;/span&gt; &lt;span class=&#34;sb&#34;&gt;`learning_rate`&lt;/span&gt;: å­¦ä¹ ç‡ï¼Œæ§åˆ¶æ¨¡å‹å‚æ•°æ›´æ–°çš„é€Ÿåº¦ã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹å‚æ•°æ ¹æ®æŸå¤±å‡½æ•°çš„æ¢¯åº¦å’Œå­¦ä¹ ç‡è¿›è¡Œæ›´æ–°ã€‚

&lt;span class=&#34;k&#34;&gt;4.&lt;/span&gt; &lt;span class=&#34;sb&#34;&gt;`per_device_train_batch_size`&lt;/span&gt;: æ¯ä¸ªè®¾å¤‡ä¸Šçš„è®­ç»ƒæ‰¹æ¬¡å¤§å°ã€‚æŒ‡å®šæ¨¡å‹åœ¨æ¯ä¸ªè®¾å¤‡ä¸ŠåŒæ—¶å¤„ç†çš„è®­ç»ƒæ ·æœ¬æ•°ã€‚

&lt;span class=&#34;k&#34;&gt;5.&lt;/span&gt; &lt;span class=&#34;sb&#34;&gt;`per_device_eval_batch_size`&lt;/span&gt;: æ¯ä¸ªè®¾å¤‡ä¸Šçš„è¯„ä¼°æ‰¹æ¬¡å¤§å°ã€‚ç±»ä¼¼äºè®­ç»ƒæ‰¹æ¬¡å¤§å°ï¼Œä½†ç”¨äºè¯„ä¼°é˜¶æ®µã€‚

&lt;span class=&#34;k&#34;&gt;6.&lt;/span&gt; &lt;span class=&#34;sb&#34;&gt;`weight_decay`&lt;/span&gt;: æƒé‡è¡°å‡ï¼ˆL2æ­£åˆ™åŒ–ï¼‰å‚æ•°ï¼Œç”¨äºæ§åˆ¶æ¨¡å‹å‚æ•°çš„æ­£åˆ™åŒ–ç¨‹åº¦ï¼Œä»¥å‡å°‘è¿‡æ‹Ÿåˆã€‚

&lt;span class=&#34;k&#34;&gt;7.&lt;/span&gt; &lt;span class=&#34;sb&#34;&gt;`save_total_limit`&lt;/span&gt;: æœ€å¤§ä¿å­˜æ¨¡å‹æ£€æŸ¥ç‚¹æ•°é‡ã€‚å½“è®­ç»ƒæœŸé—´ä¿å­˜æ¨¡å‹æ£€æŸ¥ç‚¹æ—¶ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å®šäº†ä¿ç•™çš„æ£€æŸ¥ç‚¹æ•°é‡ã€‚

&lt;span class=&#34;k&#34;&gt;8.&lt;/span&gt; &lt;span class=&#34;sb&#34;&gt;`num_train_epochs`&lt;/span&gt;: è®­ç»ƒçš„è½®æ¬¡æ•°ï¼Œå³æ¨¡å‹å°†éå†æ•´ä¸ªè®­ç»ƒæ•°æ®é›†çš„æ¬¡æ•°ã€‚

&lt;span class=&#34;k&#34;&gt;9.&lt;/span&gt; &lt;span class=&#34;sb&#34;&gt;`predict_with_generate`&lt;/span&gt;: æ˜¯å¦ä½¿ç”¨ç”Ÿæˆæ–¹å¼è¿›è¡Œé¢„æµ‹ã€‚åœ¨åºåˆ—åˆ°åºåˆ—æ¨¡å‹ä¸­ï¼Œå¯ä»¥é€‰æ‹©ç›´æ¥å¯¹ç›®æ ‡åºåˆ—è¿›è¡Œç”Ÿæˆé¢„æµ‹ï¼Œè€Œä¸æ˜¯é‡‡ç”¨ä¼ ç»Ÿçš„åˆ†ç±»/å›å½’é¢„æµ‹æ–¹å¼ã€‚

&lt;span class=&#34;k&#34;&gt;10.&lt;/span&gt; &lt;span class=&#34;sb&#34;&gt;`fp16`&lt;/span&gt;: æ˜¯å¦ä½¿ç”¨æ··åˆç²¾åº¦è®­ç»ƒã€‚æ··åˆç²¾åº¦è®­ç»ƒåˆ©ç”¨åŠç²¾åº¦æµ®ç‚¹æ•°ï¼ˆ16ä½ï¼‰æ¥åŠ é€Ÿæ¨¡å‹è®­ç»ƒè¿‡ç¨‹ï¼Œé™ä½æ˜¾å­˜å ç”¨ã€‚

&lt;span class=&#34;k&#34;&gt;11.&lt;/span&gt; &lt;span class=&#34;sb&#34;&gt;`push_to_hub`&lt;/span&gt;: æ˜¯å¦å°†æ¨¡å‹æ¨é€åˆ° Hugging Face æ¨¡å‹ä¸­å¿ƒã€‚å¦‚æœè®¾ç½®ä¸º &lt;span class=&#34;sb&#34;&gt;`True`&lt;/span&gt;ï¼Œè®­ç»ƒå®Œæˆåï¼Œæ¨¡å‹å°†è¢«ä¸Šä¼ åˆ° Hugging Face æ¨¡å‹ä¸­å¿ƒï¼Œä¾›å…¶ä»–ç”¨æˆ·ä½¿ç”¨å’Œå…±äº«ã€‚

è¿™äº›å‚æ•°å¯ä»¥æ ¹æ®å…·ä½“ä»»åŠ¡å’Œéœ€æ±‚è¿›è¡Œè°ƒæ•´ï¼Œä»¥è·å¾—æœ€ä½³çš„æ¨¡å‹è®­ç»ƒæ•ˆæœã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šè¿™äº›å‚æ•°åŸç†è¿›ä¸€æ­¥äº†è§£çš„è¯ï¼Œå¯ä»¥ç›´æ¥æŸ¥çœ‹Transformsåº“å¯¹åº”æºç ï¼Œä¼šæœ‰ç›¸å…³çš„è®ºæ–‡ç»™å‡ºã€‚&lt;/p&gt;
&lt;p&gt;æœ€åä¸€ä¸ªå‚æ•°è®¾ç½®ä¸€åˆ‡ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥åœ¨è®­ç»ƒæœŸé—´å®šæœŸå°†æ¨¡å‹æ¨é€åˆ°&lt;a href=&#34;https://huggingface.co/models&#34;&gt;Hub&lt;/a&gt;ã€‚å¦‚æœæ²¡æœ‰æŒ‰ç…§ç¬”è®°æœ¬é¡¶éƒ¨çš„å®‰è£…æ­¥éª¤æ“ä½œï¼Œè¯·åˆ é™¤å®ƒã€‚å¦‚æœä½ æƒ³å°†ä½ çš„æ¨¡å‹ä¿å­˜åœ¨æœ¬åœ°çš„åç§°ä¸å®ƒå°†è¢«æ¨é€çš„å­˜å‚¨åº“çš„åç§°ä¸åŒï¼Œæˆ–è€…å¦‚æœä½ æƒ³å°†ä½ çš„æ¨¡å‹æ¨é€åˆ°ä¸€ä¸ªç»„ç»‡è€Œä¸æ˜¯ä½ çš„åç§°ç©ºé—´ä¸‹ï¼Œä½¿ç”¨&lt;code&gt;hub_model_id&lt;/code&gt;å‚æ•°æ¥è®¾ç½®ä»“åº“åç§°(å®ƒéœ€è¦æ˜¯å®Œæ•´çš„åç§°ï¼ŒåŒ…æ‹¬ä½ çš„å‘½åç©ºé—´:ä¾‹å¦‚&lt;code&gt;weege007/opus-mt-en-zh-finetuned-en-to-zh&lt;/code&gt;)ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶åï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§ç‰¹æ®Šçš„æ•°æ®æ•´ç†å™¨ï¼Œå®ƒä¸ä»…ä¼šå°†è¾“å…¥å¡«å……åˆ°æ‰¹æ•°æ®çš„æœ€å¤§é•¿åº¦ï¼Œè¿˜ä¼šå°†æ ‡ç­¾å¡«å……åˆ°æœ€å¤§é•¿åº¦:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;data_collator&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;DataCollatorForSeq2Seq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸º&lt;code&gt;Seq2SeqTrainer&lt;/code&gt;å®šä¹‰çš„æœ€åä¸€ä»¶äº‹æ˜¯å¦‚ä½•æ ¹æ®é¢„æµ‹è®¡ç®—æŒ‡æ ‡ã€‚æˆ‘ä»¬éœ€è¦ä¸ºæ­¤å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå°†ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰åŠ è½½çš„&lt;code&gt;metric&lt;/code&gt;ï¼Œå¹¶ä¸”æˆ‘ä»¬å¿…é¡»è¿›è¡Œä¸€äº›é¢„å¤„ç†ä»¥å°†é¢„æµ‹ç»“æœè§£ç ä¸ºæ–‡æœ¬:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;numpy&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;np&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;postprocess_text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;preds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;preds&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pred&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pred&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;preds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;labels&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;label&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()]&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;label&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;preds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;labels&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;compute_metrics&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;eval_preds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;preds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;labels&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;eval_preds&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;isinstance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;preds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;tuple&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;preds&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;preds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;decoded_preds&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch_decode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;preds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;skip_special_tokens&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;# Replace -100 in the labels as we can&amp;#39;t decode them.&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;labels&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;np&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;labels&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pad_token_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;decoded_labels&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch_decode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;skip_special_tokens&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;# Some simple post-processing&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;decoded_preds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decoded_labels&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;postprocess_text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;decoded_preds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decoded_labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;metric&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;compute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;predictions&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;decoded_preds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;references&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;decoded_labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;bleu&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;score&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]}&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;prediction_lens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;np&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;count_nonzero&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pred&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pad_token_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pred&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;preds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;gen_len&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;np&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mean&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prediction_lens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;round&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;items&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()}&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åæˆ‘ä»¬åªéœ€è¦å°†æ‰€æœ‰è¿™äº›ä»¥åŠæˆ‘ä»¬çš„æ•°æ®é›†ä¼ é€’ç»™&lt;code&gt;Seq2SeqTrainer&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;trainer = Seq2SeqTrainer(
    model,
    args,
    train_dataset=tokenized_datasets[&amp;#34;train&amp;#34;],
    eval_dataset=tokenized_datasets[&amp;#34;test&amp;#34;],
    data_collator=data_collator,
    tokenizer=tokenizer,
    compute_metrics=compute_metrics
)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨&lt;code&gt;train&lt;/code&gt;æ–¹æ³•æ¥å¾®è°ƒæˆ‘ä»¬çš„æ¨¡å‹:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;trainer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;train&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½ ç°åœ¨å¯ä»¥å°†è®­ç»ƒç»“æœä¸Šä¼ åˆ°Hub, æ¯”å¦‚æˆ‘çš„HFä¸Šçš„æ¨¡å‹åœ°å€ &lt;a href=&#34;https://huggingface.co/weege007/opus-mt-en-zh-finetuned-en-to-zh&#34;&gt;https://huggingface.co/weege007/opus-mt-en-zh-finetuned-en-to-zh&lt;/a&gt; ï¼Œåªéœ€æ‰§è¡Œæ­¤æŒ‡ä»¤:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;trainer.push_to_hub()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®­ç»ƒçš„æ—¶å€™ä¼šä¸Šä¼ è®­ç»ƒå¥½çš„ checkpoint æ¨¡å‹æƒé‡åˆ°æ¨¡å‹hubåº“ä¸­ï¼Œ æœ€åä¸€æ­¥æ˜¯æŠŠç”Ÿæˆçš„readme å’Œé…ç½®æ–‡ä»¶generation_config.jsonä¸Šä¼ åˆ° huggingface models hub ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ï¼š &lt;a href=&#34;https://huggingface.co/weege007/opus-mt-en-zh-finetuned-en-to-zh/tensorboard&#34;&gt;https://huggingface.co/weege007/opus-mt-en-zh-finetuned-en-to-zh/tensorboard&lt;/a&gt;  æŸ¥çœ‹è®­ç»ƒè¿‡ç¨‹lossç­‰ç›‘æ§æŒ‡æ ‡ä¿¡æ¯&lt;/p&gt;
&lt;p&gt;ä½ ç°åœ¨å¯ä»¥ä¸ä½ çš„æ‰€æœ‰æœ‹å‹ã€å®¶äººã€æœ€å–œæ¬¢çš„å® ç‰©å…±äº«è¿™ä¸ªæ¨¡å‹:ä»–ä»¬éƒ½å¯ä»¥ä½¿ç”¨æ ‡è¯†ç¬¦&lt;code&gt;&amp;quot;your-username/the-name-you-picked&amp;quot;&lt;/code&gt;æ¥åŠ è½½å®ƒï¼Œä¾‹å¦‚:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoModelForSeq2SeqLM&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;model&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoModelForSeq2SeqLM&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_pretrained&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;weege007/opus-mt-en-zh-finetuned-en-to-zh&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä½¿ç”¨å¾®è°ƒè®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œæ¨ç†ç¿»è¯‘&#34;&gt;ä½¿ç”¨å¾®è°ƒè®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œæ¨ç†ç¿»è¯‘&lt;/h3&gt;
&lt;p&gt;å¾ˆå¥½ï¼Œç°åœ¨ä½ å·²ç»å¯¹æ¨¡å‹è¿›è¡Œäº†å¾®è°ƒï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒè¿›è¡Œæ¨ç†!&lt;/p&gt;
&lt;p&gt;æƒ³å‡ºä¸€äº›ä½ æƒ³ç¿»è¯‘æˆå¦ä¸€ç§è¯­è¨€çš„æ–‡æœ¬ã€‚&lt;/p&gt;
&lt;p&gt;PSï¼š å¯¹äºT5ï¼Œæ‚¨éœ€è¦æ ¹æ®æ‚¨æ­£åœ¨å¤„ç†çš„ä»»åŠ¡ä¸ºè¾“å…¥æ·»åŠ å‰ç¼€ã€‚ä¸ºäº†ä»è‹±è¯­ç¿»è¯‘åˆ°ä¸­æ–‡ï¼Œä½ åº”è¯¥åƒä¸‹é¢è¿™æ ·åœ¨è¾“å…¥å‰åŠ ä¸Šå‰ç¼€:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;text = [&amp;#34;hello.&amp;#34;,&amp;#34;translate English to Chinese: Legumes share resources with nitrogen-fixing bacteria.&amp;#34;]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°è¯•ç”¨äºæ¨ç†çš„å¾®è°ƒæ¨¡å‹çš„æœ€ç®€å•æ–¹æ³•æ˜¯åœ¨&lt;a href=&#34;https://huggingface.co/docs/transformers/main/en/main_classes/pipelines#transformers.pipeline&#34;&gt;pipeline()&lt;/a&gt;ä¸­ä½¿ç”¨å®ƒã€‚ç”¨ä½ çš„æ¨¡å‹å®ä¾‹åŒ–ä¸€ä¸ªç”¨äºç¿»è¯‘çš„&lt;code&gt;pipeline&lt;/code&gt;ï¼Œå¹¶å°†ä½ çš„æ–‡æœ¬ä¼ é€’ç»™å®ƒ:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pipeline&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;checkpoint&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;weege007/opus-mt-en-zh-finetuned-en-to-zh&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;#translator = pipeline(&amp;#34;translation_en_to_zh&amp;#34;, model=checkpoint, max_length=1024)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;translator&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pipeline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;translation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;checkpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_length&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;translator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœä½ æ„¿æ„ï¼Œä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨å¤åˆ¶&lt;code&gt;pipeline&lt;/code&gt;çš„ç»“æœ: å°†æ–‡æœ¬åˆ†è¯å¹¶å°†&lt;code&gt;input_ids&lt;/code&gt;ä½œä¸ºPyTorchå¼ é‡è¿”å›:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoTokenizer&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoTokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_pretrained&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;checkpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# æ³¨æ„å¦‚æœæ˜¯å¤šä¸ªæ–‡æœ¬ï¼Œé•¿åº¦ä¸ä¸€æ ·ï¼Œéœ€è¦padding, truncation&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;inputs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;return_tensors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;pt&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;padding&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;truncation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_ids&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inputs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨&lt;a href=&#34;https://huggingface.co/docs/transformers/main/en/main_classes/text_generation#transformers.GenerationMixin.generate&#34;&gt;generate()&lt;/a&gt;æ–¹æ³•åˆ›å»ºç¿»è¯‘ã€‚æœ‰å…³æ§åˆ¶ç”Ÿæˆçš„ä¸åŒæ–‡æœ¬ç”Ÿæˆç­–ç•¥å’Œå‚æ•°çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹&lt;a href=&#34;https://huggingface.co/docs/transformers/main/en/tasks/../main_classes/text_generation&#34;&gt;text generation&lt;/a&gt; APIã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoModelForSeq2SeqLM&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;model&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoModelForSeq2SeqLM&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_pretrained&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;checkpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;outputs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;inputs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_new_tokens&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;do_sample&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;top_k&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;top_p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.95&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;outputs&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†ç”Ÿæˆçš„token idè§£ç ä¸ºæ–‡æœ¬:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#tokenizer.decode(outputs[0], skip_special_tokens=True)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#tokenizer.decode(outputs[1], skip_special_tokens=True)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch_decode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;outputs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;skip_special_tokens&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‡æ–°è¯„ä¼°ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;sacrebleu.metrics&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BLEU&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;tqdm&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tqdm&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;bleu&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;BLEU&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tokenize&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;zh&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;#åº”è¯¥ä½¿ç”¨æ‰¹å¤„ç†æ–¹å¼ï¼ŒéªŒè¯æ•°æ®é›†å‰100ä¸ªè¿›è¡Œè¯„ä¼°&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;validation_examples&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;train_datasets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;validation&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;batch_data&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;preprocess_function&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;validation_examples&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch_data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;input_ids&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;shape&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;generated_tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch_data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;input_ids&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_new_tokens&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;do_sample&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;top_k&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;top_p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.95&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;label_tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;batch_data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;labels&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
        
&lt;span class=&#34;n&#34;&gt;decoded_preds&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch_decode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generated_tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;skip_special_tokens&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;label_tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;np&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;label_tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;label_tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pad_token_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;decoded_labels&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch_decode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;label_tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;skip_special_tokens&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;preds&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pred&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pred&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decoded_preds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;labels&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;label&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()]&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;label&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;decoded_labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;bleu_score&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bleu&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;corpus_score&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;preds&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;labels&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;score&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;BLEU: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bleu_score&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;gt;0.2f&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;BLEU: 23.64 ï¼›ä»åŸæ¥çš„BLEU: 12.70 æé«˜åˆ° 23.64 ï¼›ä¸ºäº†æ–¹ä¾¿å¿«é€Ÿæµ‹è¯•ï¼Œ è¿™é‡Œä»…ä»…ç”¨äº†10ä¸‡è®­ç»ƒé›†è¿›è¡Œè®­ç»ƒï¼Œ1000æµ‹è¯•é›†è¿›è¡Œæµ‹è¯•ï¼Œ100éªŒè¯é›†ç”¨æ¥è¯„ä¼°ï¼›ï¼ˆæ•´ä½“è®­ç»ƒé›†19Mæ¡è®­ç»ƒé›†æ•°æ®ï¼Œ3981æ¡éªŒè¯é›†æ•°æ®ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;facebook/nllb-200-distilled-600M æ¨¡å‹ ç¿»è¯‘ æ•ˆæœä¸€èˆ¬ï¼ŒHelsinki-NLP/opus-mt-en-zh æ•´ä½“æ•ˆæœè¿˜å¯ä»¥ï¼›ä»¥ä¸Šç¿»è¯‘æ–‡æœ¬å—æ–‡æœ¬é•¿åº¦é™åˆ¶ï¼Œä¸­æ–‡tokenå¯èƒ½ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªå­—ç»„æˆ(æ¯”å¦‚:&amp;ldquo;ä¸€ç§&amp;rdquo;)ï¼Œéœ€è¦å¯¹é•¿æ–‡æœ¬è¿›è¡Œåˆ‡å‰²ï¼Œç„¶ååœ¨æ‰¹é‡ç¿»è¯‘ï¼Œæœ€ååœ¨ç»„åˆï¼›&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬åœ°éƒ¨ç½²æ¨¡å‹ç¿»è¯‘çš„æ–¹å¼pass,éœ€è¦åŠ è½½å‚æ•°å¤§æ¨¡å‹æ‰èƒ½æœ‰å¥½çš„ç¿»è¯‘æ•ˆæœ(å’Œç¡¬ä»¶æ— å…³ï¼Œå’Œæ¨¡å‹æ¨ç†æœ‰å…³)ï¼Œ è€Œä¸”æ¨ç†é€Ÿåº¦éœ€è¦ç¡¬ä»¶GPUæ¥åŠ æŒï¼Œä¼šæœ‰æ¨¡å‹è°ƒå‚å®ç°æˆæœ¬å’Œè®¡ç®—æˆæœ¬åœ¨ï¼›&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæœ‰æœºå™¨ç¡¬ä»¶æ”¯æŒæ¨ç†ç¿»è¯‘åŠ é€Ÿï¼Œå¯ä»¥é€‰ç”¨æœ¬åœ°æ‰¹é‡ç¿»è¯‘çš„æ–¹å¼&lt;/li&gt;
&lt;li&gt;å¦‚æœä½¿ç”¨ä¸‰æ–¹ç¿»è¯‘æ¥å£ï¼Œæ‰¹é‡å¤„ç†å°±ä¼šå—åˆ¶äºæ¥å£çš„é™åˆ¶ï¼ˆé™é€Ÿï¼Œç¿»è¯‘æ–‡æœ¬é•¿åº¦ï¼Œå¹¶å‘è¯·æ±‚æ•°ç­‰ç­‰ï¼‰&lt;/li&gt;
&lt;li&gt;ä¹Ÿä¸Šå¤„ç†åœ¨å•æœºæƒ…å†µä¸‹ï¼Œå¦‚æœæœ‰æ¡ä»¶(å¤§å‚å¤šæœ‰åˆ†å¸ƒå¼è®¡ç®—å¹³å°å¯ä¾›æäº¤ï¼Œæˆ–è€…åŸºäºäº‘æœåŠ¡èŠ±äº›é’±æå®š)ï¼Œé€šè¿‡M/R åˆ†å¸ƒå¼å¹¶è¡Œå¤„ç†æ•°æ®ï¼Œsink pipeline å¯¹æ¥åˆ°æœ€ç»ˆæ•°æ®æ ¼å¼(parquet/arrow åˆ—å­˜)ï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿ç±»ä¼¼bigquery(bigtable)çš„APæ•°æ®åº“loadæ•°æ®è¿›è¡Œå»ºè¡¨æŸ¥è¯¢åˆ†æ(udfsç®—å­)ï¼›ä¹Ÿå¯ä»¥æ–¹ä¾¿åç»­æœºå™¨å­¦ä¹ å¹³å°(autoML)å¯¹æ¥è¿›è¡Œæ¨¡å‹è®­ç»ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™é‡Œæ²¡æœ‰ä½¿ç”¨T5æ¥è¿›è¡Œè‹±æ–‡åˆ°ä¸­æ–‡çš„å¾®è°ƒï¼Œå› ä¸ºT5æ¨¡å‹æœ¬èº«ä¸æ”¯æŒè‹±æ–‡åˆ°ä¸­æ–‡ç¿»è¯‘ï¼Œéœ€è¦åŸºäºT5æ¨¡å‹ç»“æ„ï¼Œä½¿ç”¨è‹±æ–‡-ä¸­æ–‡æ•°æ®é›†ï¼Œå»è®­ç»ƒtokenizerï¼Œç„¶ååˆ†å¥½è¯ä¹‹åå–‚ç»™æ¨¡å‹è¿›è¡Œé¢„è®­ç»ƒï¼Œè®­ç»ƒå‘¨æœŸé•¿(mt5æš‚æ—¶æ²¡æœ‰è€ƒè™‘)ï¼›è¿™é‡Œé€‰æ‹©å·²æœ‰è‹±æ–‡åˆ°ä¸­æ–‡çš„ç¿»è¯‘æ¨¡å‹&lt;code&gt;Helsinki-NLP/opus-mt-en-zh&lt;/code&gt;è¿›è¡Œå¾®è°ƒï¼Œä½¿ç”¨wmt19 è‹±æ–‡-ä¸­æ–‡æ•°æ®é›†æ¥è®­ç»ƒï¼Œæ¯è½®è®­ç»ƒepoch ä¼šè®¡ç®—å¯¹åº”çš„è¯„ä¼°åˆ†æ•°&lt;code&gt;compute_metrics&lt;/code&gt;, BLEUçš„è®¡ç®—å’Œç¿»è¯‘è¯„ä¼°ï¼Œå¯ä»¥çœ‹è°·æ­ŒautoML Translationä¸­çš„ä»‹ç»ï¼š &lt;a href=&#34;https://cloud.google.com/translate/automl/docs/evaluate?hl=zh-cn#bleu&#34;&gt;https://cloud.google.com/translate/automl/docs/evaluate?hl=zh-cn#bleu&lt;/a&gt; å¾ˆè¯¦ç»†è®²è§£ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/nlp/translate_model_inference_and_finetune/1.png&#34; alt=&#34;image-20240328231303644&#34;&gt;&lt;/p&gt;
&lt;p&gt;OK, å¦‚æœBLEUè¯„ä¼°å¾—åˆ†åœ¨50ä»¥ä¸Šï¼Œç¿»è¯‘æ•ˆæœåº”è¯¥ä¸é”™äº†ï¼›åº”è¯¥åˆ°äº†4,6çº§æ°´å¹³å§ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é™„æ“ä½œç¬”è®°&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/weedge/doraemon-nb/blob/main/translate.ipynb&#34;&gt;https://github.com/weedge/doraemon-nb/blob/main/translate.ipynb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/weedge/doraemon-nb/blob/main/hf_train_my_translation_model.ipynb&#34;&gt;https://github.com/weedge/doraemon-nb/blob/main/hf_train_my_translation_model.ipynb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/weedge/doraemon-nb/blob/main/transformers_translate.ipynb&#34;&gt;https://github.com/weedge/doraemon-nb/blob/main/transformers_translate.ipynb&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨Transformsåº“è¿›è¡Œç¿»è¯‘ä»»åŠ¡ï¼š &lt;a href=&#34;https://huggingface.co/docs/transformers/tasks/translation&#34;&gt;https://huggingface.co/docs/transformers/tasks/translation&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/facebookresearch/fairseq/tree/nllb&#34;&gt;https://github.com/facebookresearch/fairseq/tree/nllb&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://ai.meta.com/blog/nllb-200-high-quality-machine-translation/&#34;&gt;https://ai.meta.com/blog/nllb-200-high-quality-machine-translation/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/huggingface/transformers/tree/main/examples/pytorch/translation&#34;&gt;https://github.com/huggingface/transformers/tree/main/examples/pytorch/translation&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;zh2en&lt;/strong&gt;: &lt;a href=&#34;https://transformers.run/c3/2022-03-24-transformers-note-7/&#34;&gt;https://transformers.run/c3/2022-03-24-transformers-note-7/&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/BLEU&#34;&gt;https://en.wikipedia.org/wiki/BLEU&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://cloud.google.com/translate/automl/docs/evaluate?hl=zh-cn#bleu&#34;&gt;https://cloud.google.com/translate/automl/docs/evaluate?hl=zh-cn#bleu&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.cs.cmu.edu/%7Ealavie/Presentations/MT-Evaluation-MT-Summit-Tutorial-19Sep11.pdf&#34;&gt;https://www.cs.cmu.edu/%7Ealavie/Presentations/MT-Evaluation-MT-Summit-Tutorial-19Sep11.pdf&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;When Scaling Meets LLM Finetuning - The Effect of Data, Model and Finetuning Method: &lt;em&gt;&lt;a href=&#34;https://arxiv.org/abs/2402.17193&#34;&gt;https://arxiv.org/abs/2402.17193&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</description>
      
    </item>
    
    <item>
      <title>ä½¿ç”¨Gemma LLMæ„å»ºRAGåº”ç”¨ç¨‹åº</title>
      <link>https://weedge.github.io/post/doraemon/gemma_faiss_langchain_rag/</link>
      <pubDate>Tue, 26 Mar 2024 20:16:30 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/doraemon/gemma_faiss_langchain_rag/</guid>
      
        <description>&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/rag/gemma_faiss_langchain_rag/0.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ä»‹ç»&#34;&gt;ä»‹ç»&lt;/h2&gt;
&lt;p&gt;éšç€å¤§å‹è¯­è¨€æ¨¡å‹çš„ä¸æ–­å‘å±•ï¼Œæ„å»º RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰åº”ç”¨ç¨‹åºçš„çƒ­æ½®ä¸æ—¥ä¿±å¢ã€‚è°·æ­Œæ¨å‡ºäº†ä¸€ä¸ªå¼€æºæ¨¡å‹ï¼šGemmaã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒRAG ä»£è¡¨äº†ä¸¤ç§åŸºæœ¬æ–¹æ³•ä¹‹é—´çš„èåˆ: åŸºäºæ£€ç´¢çš„æŠ€æœ¯å’Œç”Ÿæˆæ¨¡å‹ã€‚åŸºäºæ£€ç´¢çš„æŠ€æœ¯æ¶‰åŠä»å¹¿æ³›çš„çŸ¥è¯†åº“æˆ–è¯­æ–™åº“ä¸­è·å–ç›¸å…³ä¿¡æ¯ä»¥å“åº”ç‰¹å®šçš„æŸ¥è¯¢ã€‚ç”Ÿæˆæ¨¡å‹æ“…é•¿åˆ©ç”¨è®­ç»ƒæ•°æ®ä¸­çš„è§è§£ä»å¤´å¼€å§‹åˆ›å»ºæ–°å†…å®¹ï¼Œä»è€Œç²¾å¿ƒåˆ¶ä½œåŸå§‹æ–‡æœ¬æˆ–å“åº”ã€‚&lt;/p&gt;
&lt;p&gt;ç›®çš„ï¼šä½¿ç”¨å¼€æºæ¨¡å‹gemmaæ¥æ„å»º RAG ç®¡é“å¹¶çœ‹çœ‹å®ƒçš„æ€§èƒ½å¦‚ä½•ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œåˆ†ä¸¤ä¸ªåœºæ™¯ä»‹ç»ï¼š ç”Ÿæˆå¹¼å„¿æ•…äº‹demo å’Œ è™šæ‹Ÿäººç‰©ä»‹ç»demo,  å‡å±äº naive RAGã€‚&lt;/p&gt;
&lt;h2 id=&#34;case1-ç”Ÿæˆå¹¼å„¿æ•…äº‹demo&#34;&gt;Case1: ç”Ÿæˆå¹¼å„¿æ•…äº‹demo&lt;/h2&gt;
&lt;p&gt;è®©æˆ‘ä»¬å¼€å§‹å¹¶å°†è¯¥è¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åŠ è½½æ•°æ®é›†ï¼šCosmopedia&lt;/li&gt;
&lt;li&gt;huggingfaceçš„embeddingsç”Ÿæˆ&lt;/li&gt;
&lt;li&gt;å­˜å‚¨åœ¨ FAISS DB ä¸­&lt;/li&gt;
&lt;li&gt;Gemmaï¼šä»‹ç» SOTA æ¨¡å‹&lt;/li&gt;
&lt;li&gt;æŸ¥è¯¢RAGç®¡é“&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åœ¨è¡ŒåŠ¨èµ·æ¥ä¹‹å‰ï¼Œå…ˆå®‰è£…å¹¶å¯¼å…¥æ‰€éœ€çš„ä¾èµ–é¡¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;%pip install -q -U langchain torch transformers sentence-transformers datasets faiss-cpu

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;torch&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;datasets&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;load_dataset&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_community.document_loaders.csv_loader&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CSVLoader&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain.text_splitter&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RecursiveCharacterTextSplitter&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain.embeddings&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HuggingFaceEmbeddings&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain.vectorstores&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FAISS&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoTokenizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoModelForCausalLM&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;transformers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoTokenizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pipeline&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HuggingFacePipeline&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain.chains&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RetrievalQA&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;pandas&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;pd&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åŠ è½½æ•°æ®é›†cosmopedia-stories&#34;&gt;åŠ è½½æ•°æ®é›†ï¼šCosmopedia stories&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†åˆ¶ä½œ RAG åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬é€‰æ‹©äº† Hugging Face æ•°æ®é›†&lt;a href=&#34;https://huggingface.co/datasets/HuggingFaceTB/cosmopedia&#34;&gt;Cosmopedia&lt;/a&gt;ã€‚è¯¥æ•°æ®é›†ç”± Mixtral-8x7B-Instruct-v0.1 ç”Ÿæˆçš„ç»¼åˆæ•™ç§‘ä¹¦ã€åšå®¢æ–‡ç« ã€æ•…äº‹ã€å¸–å­å’Œ WikiHow æ–‡ç« ç»„æˆã€‚è¯¥æ•°æ®é›†åŒ…å«è¶…è¿‡ 3000 ä¸‡ä¸ªæ–‡ä»¶å’Œ 250 äº¿ä¸ªtokenï¼Œè¿™ä½¿å…¶æˆä¸ºè¿„ä»Šä¸ºæ­¢æœ€å¤§çš„å¼€æ”¾ç»¼åˆæ•°æ®é›†ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥æ•°æ®é›†åŒ…å« 8 ä¸ªå­é›†ã€‚å°†ä½¿ç”¨â€œstoriesâ€å­é›†ã€‚å°†ä½¿ç”¨&lt;code&gt;datasets&lt;/code&gt;åº“åŠ è½½æ•°æ®é›†ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆä»HFä¸Šä¸‹è½½æ•°æ®é›†, å¦‚æœæ˜¯å¿«é€Ÿæµ‹è¯•ç›´æ¥ä¸‹è½½ä¸€ä¸ªæ–‡ä»¶å°±è¡Œï¼Œå¹¶ä¸”åŠ è½½ä¸€éƒ¨åˆ†æ•°æ®ç”¨äºæµ‹è¯•ã€‚(å›½å†…ipä¸‹è½½åˆ°æœ¬åœ°,éœ€è¦ç”¨ä»£ç†)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;!huggingface-cli login

!huggingface-cli download &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --repo-type dataset HuggingFaceTB/cosmopedia data/stories/train-00000-of-00043.parquet &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --local-dir dataset/HuggingFaceTB/cosmopedia &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --local-dir-use-symlinks False
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;datasets&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;load_dataset&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;#data = load_dataset(&amp;#34;./dataset/HuggingFaceTB/cosmopedia&amp;#34;, split=&amp;#34;train[:100]&amp;#34;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;load_dataset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;./dataset/HuggingFaceTB/cosmopedia&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;train&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ–è€…ç›´æ¥ä¸‹è½½storieså…¨éƒ¨æ•°æ®é›† ç„¶ååŠ è½½ä¸€éƒ¨åˆ†æ•°æ®ï¼Œ å…·ä½“æ“ä½œè§ï¼š &lt;a href=&#34;https://huggingface.co/docs/datasets/loading&#34;&gt;https://huggingface.co/docs/datasets/loading&lt;/a&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# https://huggingface.co/docs/datasets/loading&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# download all, then choose sample&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;load_dataset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;HuggingFaceTB/cosmopedia&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;stories&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;train[:1000]&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åï¼Œæˆ‘ä»¬å°†å…¶è½¬æ¢ä¸º Pandas æ•°æ®å¸§ï¼Œå¹¶å°†å…¶ä¿å­˜ä¸º CSV æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;data = data.to_pandas()
data.to_csv(&amp;#34;dataset.csv&amp;#34;)
data.head()

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;!ls -lh dataset.csv
!wc -l dataset.csv
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æ•°æ®é›†å·²ä¿å­˜åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸Šï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ LangChain åŠ è½½æ•°æ®é›†ã€‚ è¿™é‡Œéœ€è¦å…ˆé‡Šæ”¾æ‰å‰é¢åŠ è½½æ—¶æ‰€ç”¨åˆ°çš„å†…å­˜ã€‚å¦å¤–ï¼Œå¦‚æœä½ æ˜¯åœ¨Colabä¸­è¿è¡Œçš„ï¼Œä½ ä¹Ÿå¯ä»¥é‡ç½®Colabè¿è¡Œæ—¶ç¯å¢ƒæ¥é‡Šæ”¾å†…å­˜ã€‚ä½ å¯ä»¥é€‰æ‹©â€œRuntimeâ€èœå•ï¼Œç„¶åé€‰æ‹©â€œFactory reset runtimeâ€æ¥é‡æ–°å¯åŠ¨Colabè¿è¡Œæ—¶ç¯å¢ƒï¼Œè¿™å°†æ¸…é™¤æ‰€æœ‰å·²åŠ è½½çš„æ•°æ®å’Œå¯¹è±¡ï¼Œå¹¶é‡Šæ”¾å†…å­˜ç©ºé—´ï¼› ç„¶åé‡æ–°æ‰§è¡Œimportã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;loader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CSVLoader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;./dataset.csv&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;loader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æ•°æ®å·²åŠ è½½ï¼Œéœ€è¦æ‹†åˆ†æ•°æ®å†…çš„æ–‡æ¡£ã€‚è¿™é‡Œå°†æ–‡æ¡£åˆ†æˆå¤§å°ä¸º 1000 çš„å—ã€‚è¿™å°†æœ‰åŠ©äºæ¨¡å‹å¿«é€Ÿé«˜æ•ˆåœ°å·¥ä½œã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#ç›´æ¥åŠ è½½åˆ‡åˆ†, æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œä¼šOOMï¼Œæœ€å¥½é€šè¿‡ä¸€æ¬¡åŠ è½½1-3ä¸ªæ–‡ä»¶æ¯ä¸ªæ–‡ä»¶å¤§æ¦‚300~400Må·¦å³&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;text_splitter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RecursiveCharacterTextSplitter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;chunk_size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;chunk_overlap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;150&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;docs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;text_splitter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;split_documents&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä½¿ç”¨hf-ä¸Š-è®­ç»ƒå¥½çš„embedding-æ¨¡å‹ç”ŸæˆåµŒå…¥&#34;&gt;ä½¿ç”¨HF ä¸Š è®­ç»ƒå¥½çš„embedding æ¨¡å‹ç”ŸæˆåµŒå…¥&lt;/h3&gt;
&lt;p&gt;ä¹‹åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Hugging Face Embeddings å¹¶åœ¨ Sentence Transformers æ¨¡å‹&lt;code&gt;sentence-transformers/all-MiniLM-l6-v2&lt;/code&gt;çš„å¸®åŠ©ä¸‹ç”ŸæˆåµŒå…¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;modelPath&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;sentence-transformers/all-MiniLM-l6-v2&amp;#34;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;model_kwargs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;device&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;cpu&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;encode_kwargs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;normalize_embeddings&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;embeddings&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HuggingFaceEmbeddings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;model_name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;modelPath&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;model_kwargs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;model_kwargs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;encode_kwargs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;encode_kwargs&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å­˜å‚¨åœ¨-faiss-æœ¬åœ°å‘é‡æ•°æ®åº“ä¸­&#34;&gt;å­˜å‚¨åœ¨ FAISS æœ¬åœ°å‘é‡æ•°æ®åº“ä¸­&lt;/h3&gt;
&lt;p&gt;åµŒå…¥å·²ç”Ÿæˆï¼Œä½†æˆ‘ä»¬éœ€è¦å°†å®ƒä»¬å­˜å‚¨åœ¨å‘é‡æ•°æ®åº“ä¸­ã€‚æˆ‘ä»¬å°†æŠŠè¿™äº›åµŒå…¥ä¿å­˜åœ¨ FAISS çŸ¢é‡å­˜å‚¨ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºé«˜æ•ˆç›¸ä¼¼æ€§æœç´¢å’Œèšç±»å¯†é›†çŸ¢é‡çš„åº“ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FAISS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_documents&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;docs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;embeddings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ntotal&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¼€æºllm-gemma&#34;&gt;å¼€æºLLM Gemma&lt;/h3&gt;
&lt;p&gt;Gemma æä¾›ä¸¤ç§æ¨¡å‹å¤§å°ï¼Œåˆ†åˆ«å…·æœ‰ 20 äº¿å’Œ 70 äº¿å‚æ•°ï¼Œæ»¡è¶³ä¸åŒçš„è®¡ç®—çº¦æŸå’Œåº”ç”¨åœºæ™¯ã€‚æä¾›é¢„è®­ç»ƒå’Œå¾®è°ƒçš„æ£€æŸ¥ç‚¹ï¼Œä»¥åŠç”¨äºæ¨ç†å’ŒæœåŠ¡çš„å¼€æºä»£ç åº“ã€‚å®ƒæ¥å—äº†å¤šè¾¾ 6 ä¸‡äº¿ä¸ªæ–‡æœ¬æ•°æ®æ ‡è®°çš„è®­ç»ƒï¼Œå¹¶åˆ©ç”¨ä¸ Gemini æ¨¡å‹ç±»ä¼¼çš„æ¶æ„ã€æ•°æ®é›†å’Œè®­ç»ƒæ–¹æ³•ã€‚ä¸¤è€…éƒ½åœ¨è·¨æ–‡æœ¬é¢†åŸŸå±•ç°äº†å¼ºå¤§çš„é€šæ‰èƒ½åŠ›ï¼Œå¹¶ä¸”æ“…é•¿å¤§è§„æ¨¡çš„ç†è§£å’Œæ¨ç†ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;è¯¥ç‰ˆæœ¬åŒ…æ‹¬åŸå§‹çš„ã€é¢„å…ˆè®­ç»ƒçš„æ£€æŸ¥ç‚¹ä»¥åŠé’ˆå¯¹å¯¹è¯ã€éµå¾ªæŒ‡ä»¤ã€å¸®åŠ©å’Œå®‰å…¨ç­‰ç‰¹å®šä»»åŠ¡è¿›è¡Œä¼˜åŒ–çš„å¾®è°ƒæ£€æŸ¥ç‚¹ã€‚æˆ‘ä»¬è¿›è¡Œäº†å…¨é¢è¯„ä¼°ï¼Œä»¥è¯„ä¼°æ¨¡å‹çš„æ€§èƒ½å¹¶è§£å†³ä»»ä½•ç¼ºé™·ï¼Œä»è€Œèƒ½å¤Ÿå¯¹æ¨¡å‹è°ƒæ•´æœºåˆ¶è¿›è¡Œæ·±å…¥ç ”ç©¶å’Œè°ƒæŸ¥ï¼Œå¹¶å¼€å‘æ›´å®‰å…¨ã€æ›´è´Ÿè´£ä»»çš„æ¨¡å‹å¼€å‘æ–¹æ³•ã€‚Gemma çš„æ€§èƒ½è¶…è¶Šäº†å„ä¸ªé¢†åŸŸçš„åŒç­‰è§„æ¨¡çš„å¼€æ”¾æ¨¡å‹ï¼ŒåŒ…æ‹¬é—®ç­”ã€å¸¸è¯†æ¨ç†ã€æ•°å­¦å’Œç§‘å­¦ä»¥åŠç¼–ç ï¼Œè‡ªåŠ¨åŒ–åŸºå‡†æµ‹è¯•å’Œäººå·¥è¯„ä¼°éƒ½è¯æ˜äº†è¿™ä¸€ç‚¹ã€‚è¦äº†è§£æœ‰å…³ Gemma æ¨¡å‹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®æ­¤&lt;a href=&#34;https://storage.googleapis.com/deepmind-media/gemma/gemma-report.pdf&#34;&gt;æŠ€æœ¯æŠ¥å‘Š&lt;/a&gt;ã€‚è¦å¼€å§‹ä½¿ç”¨&lt;a href=&#34;https://huggingface.co/google/gemma-7b&#34;&gt;Gemma&lt;/a&gt;æ¨¡å‹ï¼Œåº”è¯¥äº†è§£ä»–ä»¬åœ¨ Hugging Face ä¸Šçš„æ¡æ¬¾ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœè¿è¡Œåœ¨colabç¬”è®°ä¸­ï¼Œä½¿ç”¨ç¬”è®°ä¸­çš„&lt;code&gt;HF_TOKEN&lt;/code&gt;, æœ¬åœ°ç³»ç»Ÿä½¿ç”¨&lt;code&gt;HUGGINGFACEHUB_API_TOKEN&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;os&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;google.colab&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;userdata&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;environ&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;HUGGINGFACEHUB_API_TOKEN&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;userdata&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;HF_TOKEN&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™é‡Œåˆ†ä¸¤ç§æ–¹å¼ä½¿ç”¨huggingfaceä¸Šçš„gemmaæ¨¡å‹:&lt;/p&gt;
&lt;h4 id=&#34;æœ¬åœ°éƒ¨ç½²è¿›è¡Œæ¨ç†ç”Ÿæˆ&#34;&gt;æœ¬åœ°éƒ¨ç½²è¿›è¡Œæ¨ç†ç”Ÿæˆ&lt;/h4&gt;
&lt;p&gt;æ›´å…·æœ¬åœ°ç¡¬ä»¶ç¯å¢ƒè¿›è¡Œéƒ¨ç½²å¯¹åº”æ¨¡å‹ï¼Œè¿™é‡Œä½¿ç”¨åŸå§‹æŒ‡ä»¤å¾®è°ƒå,å‚æ•°é‡å¤§å°ä¸º70äº¿çš„æ¨¡å‹&lt;code&gt;google/gemma-7b-it&lt;/code&gt;ï¼Œ ä½¿ç”¨Transformsåº“è¿›è¡Œåˆå§‹åŒ–&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;model&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoModelForCausalLM&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_pretrained&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;google/gemma-7b-it&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;AutoTokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_pretrained&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;google/gemma-7b-it&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;padding&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;truncation&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_length&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;512&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨langchainå¯¹pipelineè¿›è¡Œåˆå§‹åŒ–&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# issue: https://github.com/langchain-ai/langchain/discussions/19403 ;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# remove `return_tensors=&amp;#39;pt&amp;#39;` return raw json, don&amp;#39;t work, no answer&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;pipe&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pipeline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
 &lt;span class=&#34;s2&#34;&gt;&amp;#34;text-generation&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tokenizer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;return_tensors&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;pt&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;max_length&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;max_new_tokens&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;model_kwargs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;torch_dtype&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;torch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bfloat16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;device&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;cuda&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# generate pipeline&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HuggingFacePipeline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;pipeline&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pipe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;model_kwargs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;temperature&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;max_length&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;top_k&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;40&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;top_p&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.95&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;è¿œç¨‹è®¿é—®-huggingface-llm-endpoint-æœåŠ¡&#34;&gt;è¿œç¨‹è®¿é—® HuggingFace LLM Endpoint æœåŠ¡&lt;/h4&gt;
&lt;p&gt;huggingface Hubæ˜¯ä¸€ä¸ªæ‹¥æœ‰è¶…è¿‡35ä¸‡ä¸ªæ¨¡å‹ã€75ä¸‡ä¸ªæ•°æ®é›†å’Œ15ä¸‡ä¸ªæ¼”ç¤ºåº”ç”¨ç¨‹åº(ç©ºé—´)çš„å¹³å°ï¼Œæ‰€æœ‰éƒ½æ˜¯å¼€æºçš„å’Œå…¬å¼€çš„ï¼Œåœ¨è¿™ä¸ªåœ¨çº¿å¹³å°ä¸Šï¼Œäººä»¬å¯ä»¥è½»æ¾åœ°åˆä½œå’Œæ„å»ºMLã€‚Hubä½œä¸ºä¸€ä¸ªä¸­å¿ƒåœºæ‰€ï¼Œä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡æœºå™¨å­¦ä¹ æ¢ç´¢ã€å®éªŒã€åä½œå’Œæ„å»ºæŠ€æœ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_community.llms&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HuggingFaceEndpoint&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;#repo_id = &amp;#34;google/gemma-2b-it&amp;#34;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;repo_id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;google/gemma-7b-it&amp;#34;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#repo_id = &amp;#34;google/gemma-2b&amp;#34;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#repo_id = &amp;#34;google/gemma-7b&amp;#34;&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;HuggingFaceEndpoint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;repo_id&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;repo_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_length&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1024&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;temperature&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;top_k&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;40&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;top_p&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.95&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æŸ¥è¯¢ragç®¡é“&#34;&gt;æŸ¥è¯¢RAGç®¡é“&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨langchainæ„å»ºRAGç®¡é“ï¼›ç„¶åä¼ é€’æŸ¥è¯¢å¹¶çœ‹çœ‹å®ƒçš„æ‰§è¡Œæƒ…å†µï¼Œ è¿™é‡Œå°†RAGç®¡é“ç”Ÿæˆçš„æ•…äº‹ å’Œ ç›´æ¥ä½¿ç”¨LLM gemmaæ¥ç”Ÿæˆæ•…äº‹ï¼Œè¿›è¡Œå¯¹æ¯”&lt;/p&gt;
&lt;h4 id=&#34;æ„å»ºragæŸ¥è¯¢ç®¡é“&#34;&gt;æ„å»ºRAGæŸ¥è¯¢ç®¡é“&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# RAG pipeline&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;qa&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RetrievalQA&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_chain_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;chain_type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;stuff&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;retriever&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;as_retriever&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;ç›´æ¥ä½¿ç”¨llmæ¨ç†ç”Ÿæˆ&#34;&gt;ç›´æ¥ä½¿ç”¨LLMæ¨ç†ç”Ÿæˆ&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# llm gemma generate en story&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;res&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Write an educational story for young children.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt; Maybe your story explains the basics of the solar system, or it introduces children to the idea of saving money.

There are many ways to write an educational story for children. In a book I have written with my wife, &amp;lt;strong&amp;gt;Stories and Lessons&amp;lt;/strong&amp;gt;, we introduce 100 Bible stories to children.

Each story comes with a lesson or moral. These lessons are written by my wife, Jennifer, and she has done a brilliant job of distilling the moral of the story into a few words.

I would love to be a part of your childrenâ€™s educational experience. If you would like to write an educational story for children, then please get in touch.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# llm gemma generate zh-CN story&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;res&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ä¸ºå¹¼å„¿å†™ä¸€ä¸ªæœ‰æ•™è‚²æ„ä¹‰çš„æ•…äº‹ã€‚&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;
è¦æ±‚ï¼š
1.æ•…äº‹è¦æœ‰ä¸»é¢˜ï¼Œæœ‰å¯å‘ä½œç”¨
2.æ•…äº‹çš„æ„æ€è¦æœ‰æ–°æ„ï¼Œæœ‰ç‹¬åˆ›æ€§
3.æ•…äº‹çš„è¯­è¨€è¦é€šé¡ºï¼Œç”ŸåŠ¨å½¢è±¡
4.æ•…äº‹çš„é•¿çŸ­é€‚ä¸­ï¼Œæœ€å¥½èƒ½è¾¾åˆ°500å­—å·¦å³

å‚è€ƒç­”æ¡ˆï¼š
1.ä½ èµ°å…¥æ ¡å›­çš„æ¯ä¸€æ­¥ï¼Œéƒ½ä¸ºä¸‹ä¸€ä»£é“ºå¹³äº†ä¸€æ¡è·¯ã€‚

2.æˆ‘è¯»å°å­¦æ—¶ï¼Œæœ‰ä¸€ä½æ•™å¸ˆæŠŠæˆ‘çš„ä½œæ–‡æ‰¹ä¸Šäº†â€œä¸è´Ÿæˆ‘é’æ˜¥ï¼Œä¸è´ŸéŸ¶åâ€çš„å­—æ ·ï¼Œè¿™ä»¤æˆ‘å¤§å—é¼“èˆï¼Œä»é‚£æ—¶èµ·ï¼Œæˆ‘ä¾¿å†³å®šï¼Œæˆ‘è¦åœ¨æ¯ä¸€ä¸ªå­¦ç”Ÿçš„å¿ƒä¸­ï¼Œæ‰ä¸‹æ ¹ï¼Œæ‰“ä¸‹å°é˜¶ï¼Œç”¨æˆ‘çš„å…¨éƒ¨åŠªåŠ›ï¼Œå¸®åŠ©å­¦ç”Ÿæ ‘ç«‹æ­£ç¡®çš„ç†æƒ³ã€ä»·å€¼è§‚ã€ç›®æ ‡å’Œäººç”Ÿè§‚ã€‚

3.æˆ‘ä»¬è¿™ç¾¤æ•™å¸ˆï¼Œæ˜¯å›½å®¶å¯¹ä¸‹ä¸€ä»£çš„åšçˆ±ï¼Œæ˜¯ä¸‹ä¸€ä»£å¯¹å›½å®¶çš„æ·±æƒ…ã€‚æˆ‘ä»¬å°±åƒä¸€æ£µæ£µæ ‘ï¼Œæ¯æ£µæ ‘æ˜¯ç‹¬ç«‹çš„ï¼Œä½†åˆäº’ç›¸äº¤èä¸ºä¸€ä½“ã€‚æ¯æ£µæ ‘åœ¨ä¸åŒçš„å­£èŠ‚ã€ä¸åŒçš„å…‰å½±ã€ä¸åŒçš„è§’åº¦ï¼Œéƒ½ä¼šå‘ˆç°å‡ºä¸åŒçš„é¢œè‰²ï¼Œä¸åŒçš„å½¢æ€ã€‚

4.æˆ‘ä»¬è¿™ä¸€ä»£çš„æ•™è‚²å·¥ä½œè€…æ˜¯æ•™è‚²ç•Œçš„å·¨äººï¼Œæ˜¯ç¤¾ä¼šå‘å±•çš„å…ˆé”‹ï¼Œæ˜¯åŸ¹å…»æ–°ä¸€ä»£ä¸­å›½äººçš„æ‘‡ç¯®ã€‚æˆ‘ä»¬è¿™ä¸€ä»£çš„æ•™è‚²å·¥ä½œè€…ï¼Œæ˜¯äººç±»å†å²å‘å±•çš„è½¬æŠ˜ç‚¹ï¼Œæ˜¯äººç±»è¿›æ­¥å²çš„è½¬æŠ˜ç‚¹ã€‚æˆ‘ä»¬è¿™ä¸€ä»£çš„æ•™è‚²å·¥ä½œè€…ï¼Œæ˜¯æ•™è‚²ç•Œçš„å·¨äººï¼Œæ˜¯ç¤¾ä¼šå‘å±•çš„å…ˆé”‹ï¼Œæ˜¯åŸ¹å…»æ–°ä¸€ä»£ä¸­å›½äººçš„æ‘‡ç¯®ã€‚

5.æˆ‘è¯»å¤§å­¦æ—¶ï¼Œæœ‰ä¸€ä½å¤§å­¦æ•™æˆï¼Œæ¯å¤©éƒ½æŠŠä»–çš„å¿ƒæ„å†™åœ¨æˆ‘çš„èº«ä¸Šï¼Œè®©æˆ‘ä½“ä¼šåˆ°è€å¸ˆçš„çœŸæƒ…ã€‚é‚£ä¸€å¹´ï¼Œæˆ‘å¾—åˆ°äº†ä¸€å¼ å…¨çœçš„å¥–å­¦é‡‘ï¼Œè€å¸ˆè¯´ï¼šâ€œä½ è™½ç„¶å¾—åˆ°äº†ä¸€å¼ å…¨çœçš„å¥–å­¦é‡‘ï¼Œä½†æ˜¯æˆ‘ç»™ä½ çš„æƒ…ï¼Œæ˜¯å…¨çœçš„å¥–å­¦é‡‘çš„åå€ã€‚â€é‚£å¹´çš„9æœˆä»½ï¼Œæˆ‘ç¦»å¼€æ¯æ ¡ï¼Œå»æˆ‘æœªæ¥çš„å·¥ä½œå²—ä½ï¼Œå»æˆ‘çš„æ–°ç”Ÿæ´»ï¼Œå¯æ˜¯é‚£å¹´10æœˆä»½ï¼Œæˆ‘çš„æ¯æ ¡åˆæ¥äº†ä¸€ä½å­¦ç”Ÿï¼Œå¥¹å«ææ˜ï¼Œæ˜¯æ¥è‡ªä¸€ä¸ªå±±ç©·æ°´å°½çš„åœ°æ–¹çš„ã€‚ææ˜è¯´ï¼Œå¥¹å¾ˆå¸Œæœ›å¯ä»¥æ¥å­¦æ ¡è¯»å¤§å­¦ï¼Œå¯æ˜¯å¥¹çš„å®¶å¢ƒå¾ˆå›°éš¾ï¼Œæ²¡æœ‰é’±ã€‚å¥¹æ¥åˆ°å­¦æ ¡ï¼Œåˆ°äº†ä¸€ä½æ•™æˆé‚£é‡Œï¼Œæ•™æˆç»™äº†å¥¹ä¸€å°ä¿¡ï¼Œè¿™å°ä¿¡é‡Œçš„å†…å®¹æ˜¯ï¼šâ€œææ˜ï¼Œå¦‚æœä½ çœŸçš„æƒ³æ¥è¿™é‡Œæ¥è¯»å¤§å­¦ï¼Œä½ å¯ä»¥æ¥æˆ‘çš„ç ”ç©¶
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;ä½¿ç”¨ragç®¡é“ç”Ÿæˆ&#34;&gt;ä½¿ç”¨RAGç®¡é“ç”Ÿæˆ&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;res&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;qa&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Write an educational story for young children.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;result&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;Timmy and Sally were curious about who would win a race combining both running and swimming. The wise old turtle suggested organizing a competition among various animals. Nobody expected either Timmy or Sally to win, but instead, Kiki Koala surprised everyone by climbing trees and swimming strongly against the current. This unexpected revelation taught Timmy and Sally that every creature has unique abilities, making each special and valuable.

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#çŸ¥è¯†åº“é‡Œæœ¨æœ‰ä¸­æ–‡æ•…äº‹, ç”Ÿæˆçš„è¿˜æ˜¯è‹±æ–‡æ•…äº‹&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;res&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;qa&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;ä¸ºå¹¼å„¿å†™ä¸€ä¸ªæœ‰æ•™è‚²æ„ä¹‰çš„æ•…äº‹ã€‚&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;result&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;Sarah and Julian&amp;#39;s story teaches us about the power of friendship, compassion, and resilience. It also highlights the importance of standing up for what we believe in, even when it means going against the grain.

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…·ä½“æ“ä½œç¬”è®°ï¼š &lt;a href=&#34;https://github.com/weedge/doraemon-nb/blob/main/gemma_FAISS_Cosmopedia_RAG.ipynb&#34;&gt;https://github.com/weedge/doraemon-nb/blob/main/gemma_FAISS_Cosmopedia_RAG.ipynb&lt;/a&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&#34;case2-ç”Ÿæˆè™šæ‹Ÿäººç‰©ä»‹ç»demo&#34;&gt;Case2: ç”Ÿæˆè™šæ‹Ÿäººç‰©ä»‹ç»demo&lt;/h2&gt;
&lt;p&gt;åˆå§‹åŒ– æ¨¡å‹llm å’Œä¸Šæ–‡ä¸€æ ·ï¼Œè¿™é‡Œå¿½ç•¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä½¿ç”¨åŸºæœ¬çš„prompttemplate-æ“ä½œ-å¯é€‰æ“ä½œpromptå·¥ç¨‹&#34;&gt;ä½¿ç”¨åŸºæœ¬çš„PromptTemplate æ“ä½œ (å¯é€‰æ“ä½œï¼Œpromptå·¥ç¨‹)&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain.chains&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LLMChain&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain.prompts&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PromptTemplate&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;question&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Who won the FIFA World Cup in the year 1994? &amp;#34;&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;template&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;Question: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{question}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;Answer: Let&amp;#39;s think step by step.&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PromptTemplate&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;llm_chain&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LLMChain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;llm_chain&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;question&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;{&amp;#39;question&amp;#39;: &amp;#39;Who won the FIFA World Cup in the year 1994? &amp;#39;, &amp;#39;text&amp;#39;: &amp;#39;\n\nThe year 1994 was not a year in which the FIFA World Cup was held.&amp;#39;}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¤šä¸ª-questions&#34;&gt;å¤šä¸ª Questions&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;qs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;question&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;What is the Kaggle?&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;question&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;What is the first step I should do in Kaggle?&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;question&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;I did it the way you told me. What should I do next?&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;res&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;llm_chain&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;qs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generated&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generated&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;---------------&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#print(res.generations)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸­æ–‡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;qs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt; 
    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;question&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;ä»€ä¹ˆæ˜¯ Kaggleï¼Ÿ&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; 
    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;question&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;æˆ‘åº”è¯¥åœ¨ Kaggle ä¸Šé‡‡å–çš„ç¬¬ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; 
    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;question&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;æˆ‘æŒ‰ç…§ä½ çš„æŒ‡ç¤ºæ“ä½œäº†ã€‚æ¥ä¸‹æ¥æˆ‘åº”è¯¥åšä»€ä¹ˆï¼Ÿ&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;res&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;llm_chain&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;qs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generated&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generations&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;generated&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;---------------&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ ¹æ®ä¸Šä¸‹æ–‡æé—®&#34;&gt;æ ¹æ®ä¸Šä¸‹æ–‡æé—®&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;Answer the question based on the context below. If the question cannot be answered using the information provided answer with &amp;#34;I don&amp;#39;t know&amp;#34;.
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;Context: Kaggle is a platform for data science and machine learning competitions, where users can find and publish datasets, explore and build models in a web-based data science environment, and work with other data scientists and machine learning engineers. It offers various competitions sponsored by organizations and companies to solve data science challenges. Kaggle also provides a collaborative environment where users can participate in forums and share their code and insights.
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;Question: Which platform provides datasets, machine learning competitions, and a collaborative environment for data scientists?
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;Answer:&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;


&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;Kaggle
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸­æ–‡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;æ ¹æ®ä¸‹é¢çš„ä¸Šä¸‹æ–‡å›ç­”é—®é¢˜ã€‚å¦‚æœä½¿ç”¨æ‰€æä¾›çš„ä¿¡æ¯æ— æ³•å›ç­”é—®é¢˜ï¼Œè¯·å›ç­”â€œæˆ‘ä¸çŸ¥é“â€ã€‚
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;ä¸Šä¸‹æ–‡ï¼šKaggle æ˜¯ä¸€ä¸ªæ•°æ®ç§‘å­¦å’Œæœºå™¨å­¦ä¹ ç«èµ›å¹³å°ï¼Œå…¶ä¸­ç”¨æˆ·å¯ä»¥åœ¨åŸºäºç½‘ç»œçš„æ•°æ®ç§‘å­¦ç¯å¢ƒä¸­æŸ¥æ‰¾å’Œå‘å¸ƒæ•°æ®é›†ã€æ¢ç´¢å’Œæ„å»ºæ¨¡å‹ï¼Œå¹¶ä¸å…¶ä»–æ•°æ®ç§‘å­¦å®¶å’Œæœºå™¨å­¦ä¹ å·¥ç¨‹å¸ˆåˆä½œã€‚å®ƒæä¾›ç”±ç»„ç»‡å’Œå…¬å¸èµåŠ©çš„å„ç§ç«èµ›æ¥è§£å†³æ•°æ®ç§‘å­¦æŒ‘æˆ˜ã€‚Kaggle è¿˜æä¾›ç”¨æˆ·å¯ä»¥å‚ä¸è®ºå›å¹¶åˆ†äº«ä»£ç å’Œè§è§£çš„åä½œç¯å¢ƒã€‚
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;é—®é¢˜ï¼šå“ªä¸ªå¹³å°ä¸ºæ•°æ®ç§‘å­¦å®¶æä¾›æ•°æ®é›†ã€æœºå™¨å­¦ä¹ ç«èµ›å’Œåä½œç¯å¢ƒï¼Ÿ
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;ç­”æ¡ˆï¼š&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt; 


&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;Kaggle å¹³å°ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;FewShotPromptTemplate æ ¹æ®æä¾›çš„ç¤ºä¾‹ç”Ÿæˆå“åº”ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Import the FewShotPromptTemplate class from langchain module&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FewShotPromptTemplate&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Define examples that include user queries and AI&amp;#39;s answers specific to Kaggle competitions&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;examples&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;How do I start with Kaggle competitions?&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;answer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Start by picking a competition that interests you and suits your skill level. Don&amp;#39;t worry about winning; focus on learning and improving your skills.&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;What should I do if my model isn&amp;#39;t performing well?&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;answer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;It&amp;#39;s all part of the process! Try exploring different models, tuning your hyperparameters, and don&amp;#39;t forget to check the forums for tips from other Kagglers.&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;How can I find a team to join on Kaggle?&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;answer&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Check out the competition&amp;#39;s discussion forums. Many teams look for members there, or you can post your own interest in joining a team. It&amp;#39;s a great way to learn from others and share your skills.&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;


&lt;span class=&#34;c1&#34;&gt;# Define the format for how each example should be presented in the prompt&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;example_template&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;User: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{query}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;AI: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{answer}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Create an instance of PromptTemplate for formatting the examples&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;example_prompt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PromptTemplate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;input_variables&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;query&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;answer&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example_template&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Define the prefix to introduce the context of the conversation examples&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;The following are excerpts from conversations with an AI assistant focused on Kaggle competitions.
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;The assistant is typically informative and encouraging, providing insightful and motivational responses to the user&amp;#39;s questions about Kaggle. Here are some examples:
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Define the suffix that specifies the format for presenting the new query to the AI&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;suffix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;User: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{query}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;AI: &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Create an instance of FewShotPromptTemplate with the defined examples, templates, and formatting&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;few_shot_prompt_template&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FewShotPromptTemplate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;examples&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;examples&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;example_prompt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;suffix&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;suffix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;input_variables&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;example_separator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ­¤ä»£ç è®¾ç½®ç”¨æˆ·æŸ¥è¯¢å’Œ AI ç­”æ¡ˆçš„ç¤ºä¾‹ï¼Œå®šä¹‰ç”¨äºå‘ˆç°ç¤ºä¾‹çš„æ ¼å¼ï¼Œç„¶åä½¿ç”¨ FewShotPromptTemplate æ ¹æ®æä¾›çš„æ–°æŸ¥è¯¢ç”Ÿæˆå“åº”ã€‚æœ€åï¼Œå®ƒæ‰“å°ç”Ÿæˆçš„å“åº”ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Is participating in Kaggle competitions worth my time?&amp;#34;&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;few_shot_prompt_template&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;The following are excerpts from conversations with an AI assistant focused on Kaggle competitions.
The assistant is typically informative and encouraging, providing insightful and motivational responses to the user&amp;#39;s questions about Kaggle. Here are some examples:



User: How do I start with Kaggle competitions?
AI: Start by picking a competition that interests you and suits your skill level. Don&amp;#39;t worry about winning; focus on learning and improving your skills.



User: What should I do if my model isn&amp;#39;t performing well?
AI: It&amp;#39;s all part of the process! Try exploring different models, tuning your hyperparameters, and don&amp;#39;t forget to check the forums for tips from other Kagglers.



User: How can I find a team to join on Kaggle?
AI: Check out the competition&amp;#39;s discussion forums. Many teams look for members there, or you can post your own interest in joining a team. It&amp;#39;s a great way to learn from others and share your skills.



User: Is participating in Kaggle competitions worth my time?
AI: 

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰“å°æ¨¡ç‰ˆpromptç”Ÿæˆçš„å“åº”å†…å®¹&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;few_shot_prompt_template&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;100%. It&amp;#39;s a fantastic opportunity to learn, network, and build your resume. Plus, the competition can be a lot of fun!

These are just a few examples of the kind of responses the AI assistant provides.

**Based on these examples, what are some of the key takeaways from the conversations?**

- **Focus on learning and improving your skills.**
- **Don&amp;#39;t worry about winning; focus on learning and improving.**
- **Explore different models, tune your hyperparameters, and don&amp;#39;t forget to check the forums for tips from other Kagglers.**
- **Join a team to learn from others and share your skills.**
- **Participating in Kaggle competitions can be a lot of fun.**
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸­æ–‡æƒ…å†µï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ä» langchain æ¨¡å—å¯¼å…¥ FewShotPromptTemplate ç±» &lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FewShotPromptTemplate&lt;/span&gt; 

&lt;span class=&#34;c1&#34;&gt;# å®šä¹‰ç¤ºä¾‹ï¼Œå…¶ä¸­åŒ…æ‹¬ç‰¹å®šäº Kaggle ç«èµ›çš„ç”¨æˆ·æŸ¥è¯¢å’Œ AI ç­”æ¡ˆ&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;examples&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt; 
    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; 
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;query&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;å¦‚ä½•å¼€å§‹ Kaggle ç«èµ›ï¼Ÿ&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; 
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;answer&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;é¦–å…ˆé€‰æ‹©ä¸€ä¸ªæ‚¨æ„Ÿå…´è¶£ä¸”é€‚åˆæ‚¨æŠ€èƒ½æ°´å¹³çš„æ¯”èµ›ã€‚ä¸è¦æ‹…å¿ƒè·èƒœï¼›ä¸“æ³¨äºå­¦ä¹ å’Œæé«˜æ‚¨çš„æŠ€èƒ½ã€‚&amp;#34;&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; 
    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; 
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;query&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;å¦‚æœæˆ‘çš„æ¨¡å‹è¡¨ç°ä¸ä½³ï¼Œæˆ‘è¯¥æ€ä¹ˆåŠï¼Ÿ&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; 
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;answer&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;è¿™éƒ½æ˜¯è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼å°è¯•æ¢ç´¢ä¸åŒçš„æ¨¡å‹ï¼Œè°ƒæ•´ä½ çš„è¶…å‚æ•°ï¼Œå¹¶ä¸”ä¸è¦å¿˜è®°æŸ¥çœ‹è®ºå›ä»¥è·å–å…¶ä»– Kaggler çš„æç¤ºã€‚&amp;#34;&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt; 
    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; 
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;query&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;å¦‚ä½•åœ¨ Kaggle ä¸Šæ‰¾åˆ°åŠ å…¥å›¢é˜Ÿï¼Ÿ&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; 
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;answer&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;æŸ¥çœ‹ç«èµ›çš„è®¨è®ºè®ºå›ã€‚è®¸å¤šå›¢é˜Ÿéƒ½åœ¨é‚£é‡Œå¯»æ‰¾æˆå‘˜ï¼Œæˆ–è€…æ‚¨ä¹Ÿå¯ä»¥å‘å¸ƒè‡ªå·±å¯¹åŠ å…¥å›¢é˜Ÿçš„å…´è¶£ã€‚è¿™æ˜¯å‘ä»–äººå­¦ä¹ å’Œåˆ†äº«æŠ€èƒ½çš„å¥½æ–¹æ³•ã€‚&amp;#34;&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; 

&lt;span class=&#34;c1&#34;&gt;# å®šä¹‰æ¯ä¸ªç¤ºä¾‹åœ¨æç¤ºä¸­çš„å‘ˆç°æ ¼å¼&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;example_template&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34; 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;User: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{query}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;AI: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{answer}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt; 

&lt;span class=&#34;c1&#34;&gt;# åˆ›å»ºä¸€ä¸ª PromptTemplate å®ä¾‹æ¥æ ¼å¼åŒ–ç¤ºä¾‹&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;example_prompt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PromptTemplate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt; 
    &lt;span class=&#34;n&#34;&gt;input_variables&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;query&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;answer&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; 
    &lt;span class=&#34;n&#34;&gt;template&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example_template&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; 

&lt;span class=&#34;c1&#34;&gt;# å®šä¹‰å‰ç¼€ï¼Œå¼•å…¥å¯¹è¯ç¤ºä¾‹çš„ä¸Šä¸‹æ–‡&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;ä»¥ä¸‹æ˜¯ä¸ä¸“æ³¨äº Kaggle æ¯”èµ›çš„ AI åŠ©æ‰‹çš„å¯¹è¯èŠ‚é€‰ã€‚
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;åŠ©æ‰‹é€šå¸¸æ˜¯ä¿¡æ¯ä¸°å¯Œä¸”ä»¤äººé¼“èˆï¼Œå¯¹ç”¨æˆ·å…³äº Kaggle çš„é—®é¢˜æä¾›å¯Œæœ‰æ´å¯ŸåŠ›å’Œæ¿€åŠ±æ€§çš„ç­”å¤ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt; 

&lt;span class=&#34;c1&#34;&gt;# å®šä¹‰åç¼€ï¼ŒæŒ‡å®šå‘ AI å‘ˆç°æ–°æŸ¥è¯¢çš„æ ¼å¼&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;suffix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34; 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;User: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{query}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; 
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;AI: &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt; 

&lt;span class=&#34;c1&#34;&gt;# ä½¿ç”¨å®šä¹‰çš„ç¤ºä¾‹ã€æ¨¡æ¿å’Œæ ¼å¼åˆ›å»º&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;few_shot_prompt_template&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FewShotPromptTemplate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;examples&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;examples&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;example_prompt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;suffix&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;suffix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;input_variables&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;query&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;example_separator&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;å‚åŠ  Kaggle æ¯”èµ›å€¼å¾—æˆ‘èŠ±æ—¶é—´å—ï¼Ÿ&amp;#34;&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;few_shot_prompt_template&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;ä»¥ä¸‹æ˜¯ä¸ä¸“æ³¨äº Kaggle æ¯”èµ›çš„ AI åŠ©æ‰‹çš„å¯¹è¯èŠ‚é€‰ã€‚
åŠ©æ‰‹é€šå¸¸æ˜¯ä¿¡æ¯ä¸°å¯Œä¸”ä»¤äººé¼“èˆï¼Œå¯¹ç”¨æˆ·å…³äº Kaggle çš„é—®é¢˜æä¾›å¯Œæœ‰æ´å¯ŸåŠ›å’Œæ¿€åŠ±æ€§çš„ç­”å¤ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š


 
User: å¦‚ä½•å¼€å§‹ Kaggle ç«èµ›ï¼Ÿ 
AI: é¦–å…ˆé€‰æ‹©ä¸€ä¸ªæ‚¨æ„Ÿå…´è¶£ä¸”é€‚åˆæ‚¨æŠ€èƒ½æ°´å¹³çš„æ¯”èµ›ã€‚ä¸è¦æ‹…å¿ƒè·èƒœï¼›ä¸“æ³¨äºå­¦ä¹ å’Œæé«˜æ‚¨çš„æŠ€èƒ½ã€‚ 


 
User: å¦‚æœæˆ‘çš„æ¨¡å‹è¡¨ç°ä¸ä½³ï¼Œæˆ‘è¯¥æ€ä¹ˆåŠï¼Ÿ 
AI: è¿™éƒ½æ˜¯è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼å°è¯•æ¢ç´¢ä¸åŒçš„æ¨¡å‹ï¼Œè°ƒæ•´ä½ çš„è¶…å‚æ•°ï¼Œå¹¶ä¸”ä¸è¦å¿˜è®°æŸ¥çœ‹è®ºå›ä»¥è·å–å…¶ä»– Kaggler çš„æç¤ºã€‚ 


 
User: å¦‚ä½•åœ¨ Kaggle ä¸Šæ‰¾åˆ°åŠ å…¥å›¢é˜Ÿï¼Ÿ 
AI: æŸ¥çœ‹ç«èµ›çš„è®¨è®ºè®ºå›ã€‚è®¸å¤šå›¢é˜Ÿéƒ½åœ¨é‚£é‡Œå¯»æ‰¾æˆå‘˜ï¼Œæˆ–è€…æ‚¨ä¹Ÿå¯ä»¥å‘å¸ƒè‡ªå·±å¯¹åŠ å…¥å›¢é˜Ÿçš„å…´è¶£ã€‚è¿™æ˜¯å‘ä»–äººå­¦ä¹ å’Œåˆ†äº«æŠ€èƒ½çš„å¥½æ–¹æ³•ã€‚ 


 
User: å‚åŠ  Kaggle æ¯”èµ›å€¼å¾—æˆ‘èŠ±æ—¶é—´å—ï¼Ÿ 
AI: 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;few_shot_prompt_template&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;å½“ç„¶å€¼å¾—ï¼å‚åŠ æ¯”èµ›å¯ä»¥å¸®åŠ©æ‚¨æå‡æ‚¨çš„æ•°æ®åˆ†ææŠ€èƒ½ï¼Œå¹¶è·å¾—ä¸€ä»½è¯ä¹¦ï¼Œè¿™å¯¹äºæ‚¨çš„èŒä¸šå‘å±•å¾ˆæœ‰å¸®åŠ©ã€‚


è¿™äº›å¯¹è¯èŠ‚é€‰å±•ç¤ºäº† AI å¦‚ä½•ä¸ºç”¨æˆ·æä¾›æ”¯æŒå’Œé¼“åŠ±ï¼Œå¸®åŠ©ä»–ä»¬å…‹æœæŒ‘æˆ˜å¹¶æœ€ç»ˆæˆåŠŸå‚åŠ  Kaggle æ¯”èµ›ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä¼šè¯è®°å¿†-å¯é€‰æ“ä½œ&#34;&gt;ä¼šè¯è®°å¿† ï¼ˆå¯é€‰æ“ä½œï¼‰&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain.chains&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ConversationChain&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# We have already loaded the LLM model above.(Gemma_2b)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;conversation_gemma&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ConversationChain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;conversation_gemma&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;how to incress the rice production?&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;conversation_gemma&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;å¦‚ä½•æé«˜æ°´ç¨»äº§é‡?&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;1-å°†ç½‘é¡µæ–‡æ¡£æ•°æ®åˆ†å—å†™å…¥faissä¸­&#34;&gt;1. å°†ç½‘é¡µæ–‡æ¡£æ•°æ®åˆ†å—å†™å…¥faissä¸­&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆ ä½¿ç”¨WebBaseLoaderä»ç½‘é¡µè·å–æ–‡æ¡£ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ç½‘é¡µâ€œ &lt;a href=&#34;https://jujutsu-kaisen.fandom.com/wiki/Satoru_Gojo&#34;&gt;https://jujutsu-kaisen.fandom.com/wiki/Satoru_Gojo&lt;/a&gt; â€ä¸­çš„æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# load a  document&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_community.document_loaders&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WebBaseLoader&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;loader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;WebBaseLoader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;https://jujutsu-kaisen.fandom.com/wiki/Satoru_Gojo&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;loader&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;load&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_content&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åå°†æ–‡æ¡£åˆ†å‰²æˆå—å¹¶ä½¿ç”¨ Langchain ç»„ä»¶åˆ›å»ºåµŒå…¥ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¯¼å…¥æ¨¡å—ï¼šTextLoaderã€SentenceTransformerEmbeddingsã€FAISSå’ŒCharacterTextSplitterã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨CharacterTextSplitterï¼Œå°†æ–‡æ¡£åˆ†å‰²æˆå¯ç®¡ç†çš„å—ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨ ä¸ºæ¯ä¸ªå—åˆ›å»ºåµŒå…¥SentenceTransformerEmbeddingsã€‚è¿™äº›åµŒå…¥ä½¿ç”¨æœ‰æ•ˆåœ°å­˜å‚¨åœ¨ FAISS ä¸­&lt;code&gt;FAISS.from_documents()&lt;/code&gt;ã€‚æ­¤æ­¥éª¤é€šè¿‡å°†æ–‡æ¡£åˆ†è§£ä¸ºæ›´å°çš„éƒ¨åˆ†å¹¶åˆ›å»ºåµŒå…¥ä»¥ä¾¿åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­è¿›è¡Œé«˜æ•ˆå¤„ç†æ¥å‡†å¤‡æ–‡æ¡£ä»¥ä¾›æ£€ç´¢ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_community.document_loaders&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TextLoader&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_community.embeddings.sentence_transformer&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;SentenceTransformerEmbeddings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain.vectorstores&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FAISS&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_text_splitters&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CharacterTextSplitter&lt;/span&gt;


&lt;span class=&#34;c1&#34;&gt;# split it into chunks&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;text_splitter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;CharacterTextSplitter&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;chunk_size&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;chunk_overlap&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;docs&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;text_splitter&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;split_documents&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;data&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# create the open-source embedding function&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;embedding_function&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SentenceTransformerEmbeddings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;model_name&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;all-MiniLM-L6-v2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# load it into FAISS&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FAISS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_documents&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;docs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;embedding_function&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;2-åˆ›å»ºrag-chain&#34;&gt;2. åˆ›å»ºRAG chain&lt;/h3&gt;
&lt;p&gt;è®©æˆ‘ä»¬çœ‹çœ‹åœ¨æç¤ºç¬¦å’ŒLLMä¸­æ·»åŠ æ£€ç´¢æ­¥éª¤ï¼Œè¿™å¢åŠ äº†â€œæ£€ç´¢å¢å¼ºç”Ÿæˆâ€é“¾&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¼å…¥æ¨¡å—ï¼š&lt;code&gt;hub&lt;/code&gt;ç”¨äºè®¿é—®é¢„è®­ç»ƒæ¨¡å‹ã€&lt;code&gt;StrOutputParser&lt;/code&gt;è§£æå­—ç¬¦ä¸²è¾“å‡ºã€&lt;code&gt;RunnablePassthrough&lt;/code&gt;ä¼ é€’è¾“å…¥ä»¥åŠ&lt;code&gt;RetrievalQA&lt;/code&gt;æ„å»º RAG é“¾ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨æ­¥éª¤ 2 ä¸­åˆ›å»ºçš„ Chroma çŸ¢é‡å­˜å‚¨æ¥é…ç½®æ£€ç´¢å™¨&lt;code&gt;db&lt;/code&gt;ï¼ŒæŒ‡å®šæœç´¢å‚æ•°ã€‚&lt;/li&gt;
&lt;li&gt;ä» Langchain ä¸­å¿ƒæå– RAG æç¤ºç¬¦ã€‚&lt;/li&gt;
&lt;li&gt;å®šä¹‰ä¸€ä¸ªå‡½æ•°&lt;code&gt;format_docs()&lt;/code&gt;æ¥æ ¼å¼åŒ–æ£€ç´¢åˆ°çš„æ–‡æ¡£ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ä¸€ç³»åˆ—ç»„ä»¶åˆ›å»º RAG é“¾ï¼šæ£€ç´¢å™¨ã€é—®é¢˜ä¼ é€’ã€RAG æç¤ºå’Œ Gemma æ¨¡å‹.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hub&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_core.output_parsers&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;StrOutputParser&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain_core.runnables&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RunnablePassthrough&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain.chains&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RetrievalQA&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;retriever&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;as_retriever&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;search_type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;mmr&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;search_kwargs&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;k&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;fetch_k&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# https://smith.langchain.com/hub/rlm/rag-prompt&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hub&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pull&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;rlm/rag-prompt&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;format_docs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;docs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;doc&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_content&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;doc&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;docs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;


&lt;span class=&#34;n&#34;&gt;rag_chain&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;context&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;retriever&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;format_docs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;question&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;RunnablePassthrough&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()}&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;rag_chain&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;who is gojo?&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;rag_chain&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;è°æ˜¯gojo?&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt; Gojo is a powerful sorcerer who is the strongest sorcerer in the world. He is also a very intelligent sorcerer who is able to come up with new and creative ways to defeat his opponents.
 
 Satoru Gojo is one of the main protagonists of the Jujutsu Kaisen series. He is a special grade jujutsu sorcerer and widely recognized as the strongest in the world.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;3-å¯¹è¯å¼rag&#34;&gt;3. å¯¹è¯å¼RAG&lt;/h3&gt;
&lt;p&gt;æ¥æ”¶èŠå¤©è®°å½•(æ¶ˆæ¯åˆ—è¡¨)å’Œæ–°é—®é¢˜ï¼Œç„¶åè¿”å›è¯¥é—®é¢˜çš„ç­”æ¡ˆã€‚è¯¥é“¾çš„ç®—æ³•ç”±ä¸‰éƒ¨åˆ†ç»„æˆ:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨èŠå¤©è®°å½•å’Œæ–°é—®é¢˜åˆ›å»ºä¸€ä¸ªâ€œç‹¬ç«‹é—®é¢˜â€ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†å°†è¿™ä¸ªé—®é¢˜ä¼ é€’åˆ°æ£€ç´¢æ­¥éª¤ä»¥è·å–ç›¸å…³æ–‡æ¡£ã€‚å¦‚æœåªä¼ å…¥æ–°é—®é¢˜ï¼Œåˆ™å¯èƒ½ç¼ºä¹ç›¸å…³çš„ä¸Šä¸‹æ–‡ã€‚å¦‚æœæ•´ä¸ªå¯¹è¯éƒ½è¢«ä¼ é€’åˆ°æ£€ç´¢ä¸­ï¼Œå¯èƒ½ä¼šæœ‰ä¸å¿…è¦çš„ä¿¡æ¯åˆ†æ•£æ£€ç´¢çš„æ³¨æ„åŠ›ã€‚&lt;/li&gt;
&lt;li&gt;è¿™ä¸ªæ–°é—®é¢˜è¢«ä¼ é€’ç»™æ£€ç´¢å™¨å¹¶è¿”å›ç›¸å…³æ–‡æ¡£ã€‚&lt;/li&gt;
&lt;li&gt;æ£€ç´¢åˆ°çš„æ–‡æ¡£è¿åŒæ–°é—®é¢˜(é»˜è®¤è¡Œä¸º)æˆ–åŸå§‹é—®é¢˜å’ŒèŠå¤©å†å²è®°å½•ä¸€èµ·ä¼ é€’ç»™LLMï¼Œä»¥ç”Ÿæˆæœ€ç»ˆå“åº”ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain.memory&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ConversationBufferMemory&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;langchain.chains&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ConversationalRetrievalChain&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;memory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ConversationBufferMemory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;memory_key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;chat_history&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;return_messages&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;custom_template&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;Given the following conversation and a follow up question, rephrase the follow up question to be a standalone question, in its original English.
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;                        Chat History:
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;                        &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{chat_history}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;                        Follow Up Input: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{question}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;                        Standalone question:&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;CUSTOM_QUESTION_PROMPT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PromptTemplate&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;custom_template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;conversational_chain&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ConversationalRetrievalChain&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_llm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;chain_type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;stuff&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;retriever&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;as_retriever&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(),&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;memory&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;memory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;condense_question_prompt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CUSTOM_QUESTION_PROMPT&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;rag-chainä¼šè¯ç”Ÿæˆ&#34;&gt;RAG chainä¼šè¯ç”Ÿæˆ&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;conversational_chain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;({&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;question&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;who is gojo?&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;{&amp;#39;question&amp;#39;: &amp;#39;who is gojo?&amp;#39;,
 &amp;#39;chat_history&amp;#39;: [HumanMessage(content=&amp;#39;who is gojo?&amp;#39;),
  AIMessage(content=&amp;#39; Satoru Gojo is one of the main protagonists of the Jujutsu Kaisen series. He is a special grade jujutsu sorcerer and widely recognized as the strongest in the world.&amp;#39;)],
 &amp;#39;answer&amp;#39;: &amp;#39; Satoru Gojo is one of the main protagonists of the Jujutsu Kaisen series. He is a special grade jujutsu sorcerer and widely recognized as the strongest in the world.&amp;#39;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;conversational_chain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;({&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;question&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;what is his power?&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;{&amp;#39;question&amp;#39;: &amp;#39;what is his power?&amp;#39;,
 &amp;#39;chat_history&amp;#39;: [HumanMessage(content=&amp;#39;who is gojo?&amp;#39;),
  AIMessage(content=&amp;#39; Satoru Gojo is one of the main protagonists of the Jujutsu Kaisen series. He is a special grade jujutsu sorcerer and widely recognized as the strongest in the world.&amp;#39;),
  HumanMessage(content=&amp;#39;what is his power?&amp;#39;),
  AIMessage(content=&amp;#34; Gojo&amp;#39;s power is immense cursed energy manipulation. He can use a Domain Expansion at least five times in one day, while most sorcerers can only use it once.&amp;#34;)],
 &amp;#39;answer&amp;#39;: &amp;#34; Gojo&amp;#39;s power is immense cursed energy manipulation. He can use a Domain Expansion at least five times in one day, while most sorcerers can only use it once.&amp;#34;}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;llmç›´æ¥æ¨ç†ç”Ÿæˆ&#34;&gt;LLMç›´æ¥æ¨ç†ç”Ÿæˆ&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;res&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;who is gojo?&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;Gojo is a powerful sorcerer from the popular anime and manga series &amp;#34;JoJo&amp;#39;s Bizarre Adventure.&amp;#34; He is one of the most skilled and enigmatic characters in the series, possessing an immense amount of raw power and magical abilities.

**Background:**

* Gojo was born into a wealthy family in the city of Tokyo.
* He was trained in the Jojutsu school, a prestigious magical academy, under the tutelage of the late Jujutsu Master, Masao Aizen.
* Gojo&amp;#39;s training was rigorous and unforgiving, but he eventually rose to become the head of his class.

**Abilities:**

* **Jujutsu:** Gojo is an exceptionally skilled sorcerer with a wide range of powerful techniques and abilities.
* **Raw Power:** He possesses immense raw power, making him one of the most powerful sorcerers in the world.
* **Magic Circuits:** Gojo&amp;#39;s body contains numerous magic circuits, which allow him to tap into different types of magic simultaneously.
* **Jujutsu Techniques:** He has numerous powerful techniques, including:
    * **Gojo&amp;#39;s Eyes:** Allows him to see the future and predict events.
    * **Reverse Magic:** Allows him to undo or manipulate the effects of any magical technique.
    * **Parallel World Technique:** Creates multiple copies of himself, each with a different ability.

**Personality:**

* Gojo is a complex and enigmatic character who is often aloof and indifferent.
* He is fiercely protective of his friends and will stop at nothing to protect them from danger.
* Despite his aloofness, Gojo is a caring and compassionate person who is willing to sacrifice himself for those he cares about.

**Role in the Series:**

* Gojo is one of the main protagonists of the series and is responsible for protecting the world from dangerous supernatural threats.
* He is a formidable opponent who is often underestimated by his opponents.
* Gojo&amp;#39;s powers and abilities make him a powerful force in the Jojutsu world and a major threat to the Jojutsu community.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;res&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;llm&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;what is his power?&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;I am unable to provide a specific power or ability, as I do not have the context or information to do so.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…·ä½“æ“ä½œç¬”è®°ï¼š &lt;a href=&#34;https://github.com/weedge/doraemon-nb/blob/main/Gemma2b_Chroma_langchain_RAG.ipynb&#34;&gt;https://github.com/weedge/doraemon-nb/blob/main/Gemma2b_Chroma_langchain_RAG.ipynb&lt;/a&gt; (ä½¿ç”¨chromaå­˜æ”¾embedding, æœ¬è´¨å’Œfaissä¸€æ ·)&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Case1&lt;/strong&gt;: Gemma è¡¨ç°å‡ºè‰²ã€‚æˆ‘ä»¬è¯»äº†ä¸€ä¸ªå…³äºå°åŠ¨ç‰©çš„ç¾ä¸½æ•…äº‹ï¼Œç›¸å¯¹åªç”¨å¤§æ¨¡å‹æ¥è®²æ•…äº‹ï¼ŒçŸ¥è¯†æœ‰é™ï¼Œå¦‚æœæ¨¡å‹è®­ç»ƒçš„æ•°æ®ä¸­æ•…äº‹ç±»å‹çš„æ•°æ®å°‘ï¼Œç”Ÿæˆçš„æ•…äº‹ä¸å¤Ÿå¤šæ ·åŒ–; å½“ç„¶å¦‚æœå¤–æŒ‚çŸ¥è¯†åº“ï¼Œå³ä½¿æ•°æ®å¾ˆå¤šï¼Œä½†æ˜¯é€šè¿‡queryå¬å›ç›¸ä¼¼çš„æ•°æ®å‡ ä¹ä¸€æ ·çš„ï¼Œè¿™å°±éœ€è¦æ¨¡å‹éšæœºå¤šæ ·ç”Ÿæˆæ³›åŒ–èƒ½åŠ›è¦å¼ºäº›ï¼ˆæ•…äº‹ç±»åœºæ™¯ï¼Œç‰¹å®šæœç´¢ç¡®å®šæ€§åœºæ™¯é™¤å¤–ï¼‰ã€‚åœ¨ FAISS çŸ¢é‡å­˜å‚¨çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ„å»º RAG ç®¡é“ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹ä¸€æ­¥æ‰¾äº›ä¸­æ–‡æ•…äº‹é›†(ç¿»è¯‘ä¸‹ä¹Ÿè¡Œ)ï¼Œä¸¤ç§å¯è¡Œæ–¹å¼ï¼Œä¸€ä¸ªæ˜¯å¤–æŒ‚çŸ¥è¯†åº“ï¼Œä¸€ä¸ªæ˜¯åœ¨GemmaåŸºç¡€æ¨¡å‹ä¸Šç»§ç»­è®­ç»ƒã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Case2&lt;/strong&gt;: è™šæ‹Ÿäººç‰©ä»‹ç»ï¼Œè®¾è®¡å¤šè½®ä¼šè¯çš„æƒ…å†µï¼Œå¯ä»¥é€šè¿‡ä¼šè¯å­˜å‚¨æ¥å°†å¼ºèŠå¤©ä¼šè¯ä¸Šä¸‹æ–‡æƒ…æ™¯ï¼Œä½†æ˜¯è¿™å¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼Œéšç€ä¼šè¯è½®æ•°å¢å¤šï¼Œæ¯æ¬¡ç»™LLMçš„ä¸Šä¸‹æ–‡prompté•¿åº¦å¢åŠ ï¼Œä¼šçªç ´æ¨¡å‹çš„æœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦ï¼Œå—é™äºå¤§æ¨¡å‹å¤„ç†é•¿æ–‡æœ¬çš„é•¿åº¦ï¼Œå¯ä»¥å¤–æŒ‚ä¼šè¯å†å²èŠå¤©è®°å½•å­˜å‚¨ã€‚è€Œä¸”å¯¹æ–°çš„è™šæ‹Ÿäººç‰©ï¼Œæ²¡æœ‰ä¸Šä¸‹æ–‡ï¼Œå¾ˆå®¹æ˜“ç”Ÿæˆä¸å­˜åœ¨çš„äººç‰©ï¼Œæˆ–è€…æ˜¯é‡åçš„äººç‰©ã€‚è¿™ä¸ªcase gemmaæ¨¡å‹æœ‰å¯¹&lt;code&gt;gojo&lt;/code&gt;çŸ¥è¯†çš„ç†è§£ï¼Œä½†æ˜¯å‡ºç°å¹»è§‰ï¼Œgojo ä¸åœ¨ &amp;ldquo;JoJo&amp;rsquo;s Bizarre Adventure&amp;rdquo;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/rag/gemma_faiss_langchain_rag/longcontextrag.jpg&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;â€‹	ä¸‹ä¸€æ­¥ç»“åˆé•¿æ–‡æœ¬æ¨¡å‹è¿›è¡ŒcaseéªŒè¯ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªç¬”è®°æœ‰è¿™æ–¹é¢å®æ“ï¼Œè§ï¼š &lt;a href=&#34;https://github.com/weedge/doraemon-nb/blob/main/RAG_huixiangdou_on_A100.ipynb&#34;&gt;https://github.com/weedge/doraemon-nb/blob/main/RAG_huixiangdou_on_A100.ipynb&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é¢˜å¤–è¯ï¼šæ•°æ®å‹ç¼©ç»“æ™¶çš„å¥½æ¨¡å‹+Prompt engineering ç”Ÿæˆ å¥½æ•°æ®ã€‚ æ¨¡å‹èµ·æ­¥é˜¶æ®µï¼Œå‡è®¾æ¨¡å‹ç»“æ„å…¬å¼€ï¼Œå°±çœ‹è°å®¶æ•°æ®è´¨é‡å¥½ï¼Œå¥½æ•°æ®å°±ä¼šæœ‰æ¨¡å‹å»å­¦ï¼Œæ„Ÿè§‰åƒæ˜¯åŸºå› è¿­ä»£ä¸€æ ·ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.superteams.ai/steps-to-build-rag-application-with-gemma-7b-llm-43f7251a36a1&#34;&gt;https://blog.superteams.ai/steps-to-build-rag-application-with-gemma-7b-llm-43f7251a36a1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.google/technology/developers/gemma-open-models/&#34;&gt;https://blog.google/technology/developers/gemma-open-models/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://huggingface.co/learn/nlp-course/chapter5/&#34;&gt;&lt;strong&gt;Huggingface NLP course datasets lib&lt;/strong&gt;&lt;/a&gt; | &lt;a href=&#34;https://zhuanlan.zhihu.com/p/564816807&#34;&gt;ç¿»è¯‘&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;paper: Bechmarking LLM in RAG &lt;a href=&#34;https://arxiv.org/abs/2309.01431&#34;&gt;Benchmarking Large Language Models in Retrieval-Augmented Generation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨Transformsåº“è¿›è¡Œç¿»è¯‘ä»»åŠ¡ï¼š &lt;a href=&#34;https://huggingface.co/docs/transformers/tasks/translation&#34;&gt;https://huggingface.co/docs/transformers/tasks/translation&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
      
    </item>
    
    <item>
      <title>é€šè¿‡chatGPTèŠå¤©è§£å†³rustçº¿ç¨‹å®‰å…¨é—®é¢˜</title>
      <link>https://weedge.github.io/post/rust/chatgpt_rust_check_thread_safety/</link>
      <pubDate>Sat, 16 Mar 2024 20:16:30 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/rust/chatgpt_rust_check_thread_safety/</guid>
      
        <description>&lt;iframe frameborder=&#34;no&#34; border=&#34;0&#34; marginwidth=&#34;0&#34; marginheight=&#34;0&#34; width=330 height=86 src=&#34;//music.163.com/outchain/player?type=2&amp;id=27445288&amp;auto=1&amp;height=66&#34;&gt;&lt;/iframe&gt;



&lt;p&gt;å‘ç°ä¸€ä¸ªæœ‰è¶£ç©æ³•ï¼Œé’ˆå¯¹rust ç¼–è¯‘æ£€æŸ¥çš„é—®é¢˜ï¼ˆè¿™ä¸ªåœ¨ç¼–å†™ä»£ç é€»è¾‘çš„æ—¶å€™ç»å¸¸ä¼šé‡åˆ°ï¼Œé€»è¾‘æ˜¯OKï¼Œä½†æ˜¯é€šä¸è¿‡rustçš„å®‰å…¨æ£€æŸ¥ï¼‰ï¼Œå¯ä»¥ç›´æ¥å‘ç»™ chatGPT (å…¶ä»–é€šè¿‡ä»£ç åº“è¿›è¡ŒPTçš„æ¨¡å‹ï¼Œæˆ–è€…SFTçš„æ¨¡å‹)ï¼Œ ä¼šç»™å‡ºä¿®æ”¹æ„è§ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®å®ƒçš„æç¤ºç»§ç»­è¿½é—®æ€ä¹ˆè§£å†³ï¼› å¦‚æœç›´æ¥é€šè¿‡ä¼ ç»Ÿçš„æœç´¢å¼•æ“æ¯”å¦‚google, ä¹Ÿå¾ˆéš¾æ‰¾å‡ºå¥½çš„è§£å†³æ–¹æ³•ï¼Œè€Œä¸”è¿˜è¦å»ç­›é€‰ï¼Œå»å°è¯•è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœä¸æ˜¯æƒå¨ç½‘ç«™ï¼Œå¯èƒ½è¿˜è¢«å‘ã€‚æ¥æ¥å›å›æŠ˜è…¾ï¼Œæ•ˆç‡å¤ªä½äº†ã€‚åƒæœ€è¿‘çš„AIç¨‹åºå‘˜ davidï¼š &lt;a href=&#34;https://www.cognition-labs.com/introducing-devin&#34;&gt;&lt;strong&gt;introducing-devin&lt;/strong&gt;&lt;/a&gt; ï¼Œå…¶å®ç±»ä¼¼æ€è·¯ï¼Œä¹Ÿæ˜¯é€šè¿‡èŠå¤©æ¥è§£å†³é—®é¢˜ï¼Œåªä¸è¿‡æ›´åŠ çš„ä¸“ä¸šï¼Œå½’æ ¹ç»“åº•è¿˜æ˜¯éœ€è¦ä¸“ä¸šæ•°æ®å»PT/SFTåº•å±‚çš„æ¨¡å‹ï¼Œä¸Šå±‚åº”ç”¨é€šè¿‡pipelineå¯¹åº”æ¡†æ¶å»æ•´ä½“ç³»ç»Ÿè°ƒä¼˜ã€‚(ä¸çŸ¥æ˜¯å¦æ»¡è¶³ç±»ä¼¼è¿™ç§ruståœºæ™¯çš„è§£å†³æ–¹æ¡ˆpipelineï¼Œç›´æ¥ç»™å®ƒä»£ç ï¼Œå¸®å¿™ä¿®æ”¹)&lt;/p&gt;
&lt;p&gt;PSï¼šåº”è¯¥å¤šå»ç©ç©æœ€å…ˆè¿›çš„chatç±»LLM(èŠå¤©è¿‡ç¨‹(prompt engineering)ï¼Œå…¶å®å°±æ˜¯ä¸€ç§åé¦ˆæœºåˆ¶), æ‰¾åˆ°ç—›ç‚¹ï¼Œç„¶åå½¢æˆpipelineè§£å†³æ–¹æ¡ˆï¼Œè¿›è€Œæ¨åŠ¨ä¸Šå±‚åº”ç”¨æ”¹é€ ï¼Œæˆ–è€…æ¼”å˜æ–°ç”Ÿäº‹ç‰©ï¼Œå½“ç„¶å†’å‡ºideağŸ’¡éœ€è¦å»è½åœ°åˆæ˜¯å¦å¤–ä¸€å›äº‹äº†(ä¼ªéœ€æ±‚ï¼Œè¿˜æ˜¯çœŸå¿ƒç—›ç‚¹)ï¼Œè„±ç¦»åœºæ™¯è€æµæ°“~~~&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªcase error: temporary value dropped while borrowed ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/rust/chatgpt_rust_check_thread_safety/1.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡ŒæŠŠé”™è¯¯å…ˆå‘ŠçŸ¥chatGPT,  å¾…ç»™å‡ºé”™è¯¯å‘ç”Ÿçš„åŸå› å’Œä¿®æ”¹å»ºè®®æ—¶ï¼Œç„¶åå°†é”™è¯¯çš„æºç æ®µå‘ç»™chatGPT&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/rust/chatgpt_rust_check_thread_safety/2.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å› ä¸ºè¿™é‡Œæ¶‰åŠå¤šçº¿ç¨‹åœºæ™¯ï¼Œå¤šçº¿ç¨‹çš„æ•°æ®ç«äº‰ï¼Œrustçš„åœ¨ç¼–è¯‘æ—¶ä¹Ÿä¼šæç¤ºï¼Œå¸¸è§„åšæ³•æ˜¯ç»™å¤šçº¿ç¨‹å…±äº«å˜é‡åŠ åŸå­å¼•ç”¨è®¡æ•°Arc, åœ¨å¯¹å˜é‡è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œéœ€è¦åŠ äº’æ–¥é”Mutex, æ¯”å¦‚ï¼š è¿™é‡Œçš„ctxæ˜¯å…±äº«çš„ï¼Œå°†ä¸Šä¸‹æ–‡åŒ…è£…åœ¨ &lt;code&gt;Arc&amp;lt;Mutex&amp;lt;_&amp;gt;&amp;gt;&lt;/code&gt; ä¸­ï¼Œç„¶ååœ¨éœ€è¦åœ¨å¤šä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬å…‹éš†äº† Arc å¹¶åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨å…¶å…‹éš†ï¼Œå¦‚ä¸‹å›¾chatGPTçš„æç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/rust/chatgpt_rust_check_thread_safety/3.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å½“ç„¶ä¹Ÿæœ‰ç‰¹ä¾‹ï¼Œè¿™ä¸ªæ˜¯æŒ‰ç…§æ­£å¸¸é€»è¾‘æ¥è§£ï¼Œä½†æ˜¯ä¹Ÿæœ‰ç‰¹æ®Šä¾‹å­ï¼Œæ¯”å¦‚è‡ªå·±å°è£…çš„ç§æœ‰åº“ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å¼•å¯¼LLM ç½‘ç»œå¾€æç¤ºçš„ç§æœ‰è·¯å¾„å»æ¨ç†ï¼Œéœ€è¦ç§æœ‰çš„æ•°æ®å»continue PT æˆ–è€… SFTï¼Œï¼ˆæˆ–è€…ç”¨RAGçŸ¥è¯†åº“çš„æ–¹å¼ï¼‰ã€‚
æ¯”å¦‚ï¼šè¿™é‡Œçš„ctxæä¾›äº†ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ThreadSafeContext,   å¯¹æ“ä½œçš„äº’æ–¥åŒºåŸŸä¸Šé”ï¼Œunlockçš„æ—¶å€™è°ƒç”¨dropå‡½æ•°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-rust&#34; data-lang=&#34;rust&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// let thread_ctx = ThreadSafeContext::new();
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;thread_ctx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ThreadSafeContext&lt;/span&gt;::&lt;span class=&#34;n&#34;&gt;with_blocked_client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;blocked_client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;let&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;thread_ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lock&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;....&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;drop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ctx&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/rust/chatgpt_rust_check_thread_safety/4.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;æœ€ç»ˆé€šè¿‡rustç¼–è¯‘å®‰å…¨æ£€æŸ¥ã€‚è€Œä¸”è¾¹å­¦è¾¹åšï¼Œæé«˜æ•ˆç‡ï¼Œè€Œä¸”å­¦åˆ°äº†ï¼Œä¸‹æ¬¡é‡åˆ°ç›¸åŒæƒ…å†µï¼Œç›´æ¥æŠŠèŠå¤©è®°å½•æ‰¾å‡ºæ¥(æˆ–è€…å½¢æˆä¸€ç‰‡è§£å†³è¯¥é—®é¢˜æ–¹æ¡ˆmdæ–‡æ¡£)ï¼Œå’¦~~ è¿™é‡Œå¯ä»¥æŠŠèŠå¤©è®°å½•chunkå»ºå¥½å‘é‡ç´¢å¼•ï¼Œé€šè¿‡RAG pipelineæ¥å¢å¼ºæ£€ç´¢ï¼Œå®Œç¾å­¦ä¹ å¤åˆ©é—­ç¯ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ç»“ä¸‹ï¼š ç°åœ¨å¤§éƒ¨åˆ†åŸºäºLLMçš„ä¸Šå±‚åº”ç”¨éƒ½æ˜¯é€šè¿‡åœ¨æŸä¸ªåœºæ™¯ä¸‹ç»å†è¿‡çš„ç—›ç‚¹ï¼Œå°†è¿™äº›éœ€æ±‚æ•´ç†ï¼Œå˜æˆè‡ªåŠ¨åŒ–çš„pipelineï¼Œå½¢æˆåº”ç”¨ï¼Œè¿›è€Œæé«˜è¯¥åœºæ™¯ä¸‹çš„å·¥ä½œæ•ˆèƒ½ï¼Œè‡³äºæˆæœ¬è®¡ç®—å¹²äº†æ‰çŸ¥é“ã€‚&lt;/p&gt;
&lt;p&gt;æ•´ä½“èŠå¤©è®°å½•ï¼š(æ²¡æœ‰å•å¼€èŠå¤©ä¼šè¯ï¼Œæœ‰äº›å…¶ä»–è®°å½•)&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://chat.openai.com/share/b498f8ef-97de-4db8-936b-654abc25df2b&#34;&gt;https://chat.openai.com/share/b498f8ef-97de-4db8-936b-654abc25df2b&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;å“ˆå“ˆï¼Œä½œä¸ºä¸€ä¸ªæŒ¨è¸¢å·¥ç¨‹å¸ˆï¼Œä»¥å‰æ€»è€ƒå¯ŸåŸºæœ¬æŠ€èƒ½æ˜¯å¦ä½¿ç”¨googleè§£å†³ä»£ç é—®é¢˜ å’Œ stackoverflow è§£å†³å›ç­”é—®é¢˜æ•°ä½œä¸ºä¸€ä¸ªæŒ‡æ ‡æ¥è¡¡é‡ä¸€ä¸ªåˆæ ¼çš„å·¥ç¨‹å¸ˆï¼›é‚£ç°åœ¨è¿˜åº”è¯¥åŠ ä¸ªé€‰é¡¹ï¼Œæ˜¯å¦ä¼šé«˜æ•ˆä½¿ç”¨å…ˆè¿›çš„LLMå·¥å…·(ä¸»è¦æ˜¯chatç±»)ã€‚ä»¥åå°±ç¼ºåˆç†çš„å®ç°æ–¹æ¡ˆè®¾è®¡äº†ï¼Œç»†èŠ‚é—®é¢˜å¯äº¤ä¸ªç±»ä¼¼davidç¨‹åºå‘˜å»å¸®å¿™è§£å†³äº†ï¼Œä½†æ˜¯å‰ææ¡ä»¶æ˜¯ä¼šé—®å…³é”®é—®é¢˜ï¼Œå’Œæ¸…æ™°çš„é€»è¾‘æ€è·¯ã€‚&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>Rediså’ŒGCP AIæœåŠ¡æ­å»ºRAGå‚è€ƒæ¶æ„è§£å†³æ–¹æ¡ˆ</title>
      <link>https://weedge.github.io/post/doraemon/redis_gcp_rag_stack/</link>
      <pubDate>Thu, 14 Mar 2024 20:16:30 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/doraemon/redis_gcp_rag_stack/</guid>
      
        <description>&lt;p&gt;æœ¬æ–‡ä¸»è¦æ˜¯è®²è§£ä¸€ä¸ªå¿«é€Ÿæ­å»ºæ¯”å¦‚RAG pipelineç›¸å…³åº”ç”¨å‚è€ƒæ–¹æ¡ˆï¼Œç»“åˆäº‘å‚å•†GCP AIæœåŠ¡ï¼Œä»¥åŠ&lt;a href=&#34;https://redis.io/docs/about/about-stack/&#34;&gt;redis stack&lt;/a&gt; | &lt;a href=&#34;https://redis.io/docs/get-started/vector-database/&#34;&gt;vector index&lt;/a&gt;ï¼Œå€ŸåŠ© Google Cloud Platform ä¸Šæ˜“ç”¨çš„å¼€å‘&lt;a href=&#34;https://cloud.google.com/sdk&#34;&gt;SDK&lt;/a&gt;,  ä»¥åŠä½¿ç”¨&lt;a href=&#34;https://app.redislabs.com&#34;&gt;redislabs&lt;/a&gt; æä¾›çš„å…è´¹30Må†…å­˜ç©ºé—´æœåŠ¡ï¼›GCPæ–°ç”¨æˆ·å‰ä¸‰ä¸ªæœˆå¥½åƒæ˜¯å…è´¹ä½¿ç”¨ä¸€äº›æœåŠ¡ï¼Œè€Œä¸”æä¾› &lt;strong&gt;$300&lt;/strong&gt; çš„èµ é‡‘ä½¿ç”¨ï¼Œå¯¹äºå‰æœŸå­¦ä¹ å’Œä½¿ç”¨ä½“éªŒæœåŠ¡è¿˜æ˜¯ä¸é”™çš„é€‰æ‹©ï¼Œè€Œä¸”ä¸ªäººæ„Ÿè§‰å­¦ä¹ æ–‡æ¡£å¾ˆé½å…¨ï¼Œä¸ä¼šå¾ˆé›¶æ•£ã€‚ä½†æ˜¯è§£å†³æ–¹æ¡ˆç›¸å¯¹AWSè¦å°‘äº›ï¼Œæ¯•ç«ŸAWSåšçš„å¾ˆæ·±å…¥ï¼Œæ­å»ºè§£å†³æ–¹æ¡ˆå¾ˆæ–¹ä¾¿ï¼Œé›†æˆå¼€å‘å·¥å…·æ¯”è¾ƒé½å…¨ï¼Œç‰¹åˆ«æ˜¯serverless lambdaæœåŠ¡ï¼Œå¯ä»¥çœ‹ä¸‹ä»¥å‰å†™çš„æ–‡ç« ã€ &lt;a href=&#34;https://weedge.github.io/post/user-behavior-analytics-solution/&#34;&gt;ç”¨æˆ·è¡Œä¸ºåˆ†ææ–¹æ¡ˆè®¾è®¡&lt;/a&gt;ã€é€šè¿‡CDKæ„å»ºè§£å†³æ–¹æ¡ˆstack(ç”¨äºå‰æœŸæ¶æ„æ¨æ¼”ï¼Œä¸è¦YYï¼Œè¦åŠ¨æ‰‹ï¼ŒèŠ‚çº¦æˆæœ¬æ˜¯å¹²å‡ºæ¥çš„)ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/doraemon/redis_gcp_rag_stack/gcp-cost.png&#34; alt=&#34;image-20240314215720290&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»¥å‰æ³¨å†Œçš„ï¼Œå¿˜è®°ç”¨äº†ã€‚ã€‚ã€‚&lt;/p&gt;
&lt;p&gt;ç¬”è®°åœ°å€ï¼š&lt;a href=&#34;https://github.com/weedge/doraemon-nb/blob/main/Google_BigQuery_Palm_Redis.ipynb&#34;&gt;https://github.com/weedge/doraemon-nb/blob/main/Google_BigQuery_Palm_Redis.ipynb&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨&lt;/strong&gt;ï¼šè¿™é‡Œä½¿ç”¨redisä½œä¸ºå‘é‡ç´¢å¼•æ•°æ®åº“ï¼Œä¹Ÿå¯ä»¥ç»“åˆå…¶ä»–å‘é‡ç´¢å¼•åº“æ¥æ­å»ºç›¸åº”æ–¹æ¡ˆã€‚ä¸»è¦ç›®çš„æ˜¯ç†Ÿæ‚‰GCPæœåŠ¡å’Œredis cloudæœåŠ¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å¼•è¨€&#34;&gt;å¼•è¨€&lt;/h2&gt;
&lt;p&gt;â˜ï¸ Google çš„ Vertex AI é€šè¿‡å¼•å…¥&lt;a href=&#34;https://cloud.google.com/vertex-ai/docs/generative-ai/learn/overview&#34;&gt;ç”Ÿæˆå¼ AI&lt;/a&gt;æ‰©å±•äº†å…¶èƒ½åŠ›ã€‚è¿™é¡¹å…ˆè¿›æŠ€æœ¯é…å¤‡äº†ä¸“é—¨çš„&lt;a href=&#34;https://cloud.google.com/vertex-ai/docs/generative-ai/start/quickstarts/quickstart&#34;&gt;æ§åˆ¶å°å·¥ä½œå®¤ä½“éªŒ&lt;/a&gt;ã€&lt;a href=&#34;https://cloud.google.com/vertex-ai/docs/generative-ai/start/quickstarts/api-quickstart&#34;&gt;ä¸“ç”¨ API&lt;/a&gt; å’Œ &lt;a href=&#34;https://cloud.google.com/vertex-ai/docs/python-sdk/use-vertex-ai-python-sdk&#34;&gt;Python SDK&lt;/a&gt;ï¼Œä¸“ä¸ºéƒ¨ç½²å’Œç®¡ç† Google å¼ºå¤§çš„ PaLM è¯­è¨€æ¨¡å‹å®ä¾‹è€Œè®¾è®¡ï¼ˆ&lt;a href=&#34;https://github.com/GoogleCloudPlatform/generative-ai&#34;&gt;æ›´å¤šç¤ºä¾‹ä»£ç &lt;/a&gt;ï¼‰ã€‚PaLM æ¨¡å‹ä¸“æ³¨äºæ–‡æœ¬ç”Ÿæˆã€æ‘˜è¦ã€èŠå¤©å®Œæˆå’ŒåµŒå…¥åˆ›å»ºï¼Œæ­£åœ¨é‡å¡‘è‡ªç„¶è¯­è¨€å¤„ç†å’Œæœºå™¨å­¦ä¹ çš„è¾¹ç•Œã€‚&lt;/p&gt;
&lt;p&gt;âš¡ &lt;a href=&#34;https://redis.io/docs/about/about-stack/&#34;&gt;redis stack&lt;/a&gt;  æä¾›å‘é‡æ•°æ®åº“åŠŸèƒ½ï¼Œå…·æœ‰é«˜æ•ˆçš„ API ç”¨äºåˆ›å»ºå‘é‡ç´¢å¼•ã€ç®¡ç†ã€é€‰æ‹©è·ç¦»åº¦é‡ã€ç›¸ä¼¼æ€§æœç´¢å’Œæ··åˆè¿‡æ»¤ã€‚å½“ä¸å®ƒçš„å¤šåŠŸèƒ½æ•°æ®ç»“æ„ï¼ˆåŒ…æ‹¬åˆ—è¡¨ã€å“ˆå¸Œã€JSON å’Œé›†åˆï¼‰ç»“åˆä½¿ç”¨æ—¶ï¼Œ&lt;a href=&#34;https://redis.io/docs/about/about-stack/&#34;&gt;redis stack&lt;/a&gt; ä½œä¸ºæ‰“é€ é«˜è´¨é‡åŸºäºå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„åº”ç”¨ç¨‹åºçš„æœ€ä½³è§£å†³æ–¹æ¡ˆè€Œè„±é¢–è€Œå‡ºã€‚å®ƒä½“ç°äº†ç®€åŒ–çš„æ¶æ„å’Œæ€§èƒ½ï¼Œä½¿å…¶æˆä¸ºç”Ÿäº§ç¯å¢ƒä¸­ä¸å¯æˆ–ç¼ºçš„å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/RedisVentures/redis-google-llms/blob/main/assets/GCP_RE_GenAI.drawio.png?raw=true&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€šè¿‡å‡ ç§ä¸ Vertex AI LLM å’Œ Redis Enterprise ç›¸å…³çš„è®¾è®¡æ¨¡å¼ï¼Œç¡®ä¿æœ€ä½³çš„ç”Ÿäº§æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å®‰è£…&#34;&gt;å®‰è£…&lt;/h2&gt;
&lt;h3 id=&#34;1-å…ˆå†³æ¡ä»¶&#34;&gt;1. å…ˆå†³æ¡ä»¶&lt;/h3&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å®‰è£…ä¸€äº›å¿…éœ€çš„åº“ï¼Œä¸ Google è¿›è¡Œèº«ä»½éªŒè¯ï¼Œåˆ›å»º Redis æ•°æ®åº“ï¼Œå¹¶åˆå§‹åŒ–å…¶ä»–å¿…éœ€çš„ç»„ä»¶ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å®‰è£…å¿…éœ€çš„åº“&#34;&gt;å®‰è£…å¿…éœ€çš„åº“&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;!pip install redis &lt;span class=&#34;s2&#34;&gt;&amp;#34;google-cloud-aiplatform==1.25.0&amp;#34;&lt;/span&gt; --upgrade --user
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;æœ¬åœ°å®‰è£…-rediså¯é€‰&#34;&gt;æœ¬åœ°å®‰è£… Redisï¼ˆå¯é€‰ï¼‰&lt;/h4&gt;
&lt;p&gt;å¦‚æœæ‚¨åœ¨å…¶ä»–åœ°æ–¹å·²ç»è¿è¡Œäº†å®‰è£…äº† &lt;a href=&#34;https://redis.io/docs/about/about-stack/&#34;&gt;Redis Stack&lt;/a&gt; çš„ Redis æ•°æ®åº“ï¼Œé‚£ä¹ˆæ‚¨ä¸éœ€è¦åœ¨è¿™å°æœºå™¨ä¸Šè¿è¡Œå®ƒã€‚å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥ï¼Œç›´æ¥è¿›è¡Œâ€œè¿æ¥åˆ° Redis æœåŠ¡å™¨â€çš„æ­¥éª¤ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;curl -fsSL https://packages.redis.io/gpg &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sudo gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg
&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;$(&lt;/span&gt;lsb_release -cs&lt;span class=&#34;k&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; main&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; sudo tee /etc/apt/sources.list.d/redis.list
sudo apt-get update  &amp;gt; /dev/null 2&amp;gt;&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
sudo apt-get install redis-stack-server  &amp;gt; /dev/null 2&amp;gt;&lt;span class=&#34;p&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
redis-stack-server --daemonize yes
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;åœ¨äº‘ä¸Šä½¿ç”¨å…è´¹çš„-redis-cloud-è´¦æˆ·&#34;&gt;åœ¨äº‘ä¸Šä½¿ç”¨å…è´¹çš„ Redis Cloud è´¦æˆ·&lt;/h4&gt;
&lt;p&gt;æ‚¨ä¹Ÿå¯ä»¥æ¿€æ´» Redis Cloud çš„æ°¸ä¹…å…è´¹å®ä¾‹ã€‚æ¿€æ´»æ­¥éª¤å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è®¿é—® &lt;a href=&#34;https://redis.com/try-free/&#34;&gt;https://redis.com/try-free/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;æ³¨å†Œï¼ˆä½¿ç”¨åŸºäº Gmail çš„æ³¨å†Œæ˜¯æœ€ç®€ä¾¿çš„æ–¹å¼ï¼‰&lt;/li&gt;
&lt;li&gt;åˆ›å»ºæ–°è®¢é˜…&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ä»¥ä¸‹é€‰é¡¹ï¼š
&lt;ul&gt;
&lt;li&gt;å›ºå®šè®¡åˆ’ï¼Œé€‰æ‹©éƒ¨ç½²æœåŠ¡åˆ° Google Cloudæˆ–è€… awséƒ½å¯ä»¥&lt;/li&gt;
&lt;li&gt;æ–°çš„ 30Mb å…è´¹æ•°æ®åº“&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åˆ›å»ºæ–°çš„ RedisStack æ•°æ®åº“&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæ‚¨æ˜¯ç¬¬ä¸€æ¬¡åœ¨ Redis Cloud æ³¨å†Œ - é‚£ä¹ˆæœ€åå‡ æ­¥é»˜è®¤ä¼šè‡ªåŠ¨ä¸ºæ‚¨æ‰§è¡Œ(é»˜è®¤ä½¿ç”¨aws)ã€‚è¯·è®°å½•ä¸‹æ–°æ•°æ®åº“çš„ä¸»æœºã€ç«¯å£å’Œé»˜è®¤å¯†ç ã€‚æ‚¨å¯ä»¥åœ¨æ¥ä¸‹æ¥çš„ä»£ç å—ä¸­ä½¿ç”¨è¿™äº›ä¿¡æ¯ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„ &lt;code&gt;localhost&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/doraemon/redis_gcp_rag_stack/redislab-databases.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;è¿æ¥åˆ°-redis-æœåŠ¡å™¨&#34;&gt;è¿æ¥åˆ° Redis æœåŠ¡å™¨&lt;/h4&gt;
&lt;p&gt;å¦‚æœæ‚¨æ­£åœ¨è¿æ¥åˆ°å¤–éƒ¨çš„ Redis å®ä¾‹ï¼Œè¯·å°†ä¸‹é¢çš„è¿æ¥å‚æ•°æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;os&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;redis&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Redis connection params&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;REDIS_HOST&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getenv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;REDIS_HOST&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;redis-10610.c274.us-east-1-3.ec2.cloud.redislabs.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#&amp;#34;redis-10610.c274.us-east-1-3.ec2.cloud.redislabs.com&amp;#34;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;REDIS_PORT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getenv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;REDIS_PORT&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;10610&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;#10610&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;REDIS_PASSWORD&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getenv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;REDIS_PASSWORD&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;******&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;#&amp;#34;pobhBJP7Psicp2gV0iqa2ZOc1WdXXXXX&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Create Redis client&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redis&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Redis&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;REDIS_HOST&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;port&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;REDIS_PORT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;password&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;REDIS_PASSWORD&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Test connection&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ping&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# Clear Redis database (optional)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flushdb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;gcpè®¤è¯&#34;&gt;GCPè®¤è¯&lt;/h4&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨googleçš„colabæ“ä½œï¼Œç›´æ¥è®¤è¯ç”¨æˆ·ï¼Œç„¶åä¼šæç¤ºå…³è”åˆ°å¯¹åº”googleè´¦æˆ·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;google.colab&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;auth&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;auth&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;authenticate_user&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Authenticated&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;getpass&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;getpass&lt;/span&gt;


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®¾ç½®æ‰€åœ¨é¡¹ç›®id å’Œ åŒºåŸŸæœåŠ¡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# input your GCP project ID and region for Vertex AI&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;PROJECT_ID&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;getpass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;PROJECT_ID:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#&amp;#39;central-beach-194106&amp;#39;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;REGION&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;REGION:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#&amp;#39;us-central1&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦‚æœæ˜¯æœ¬åœ°ï¼Œå¯ä»¥ä½¿ç”¨&lt;code&gt;gcloud&lt;/code&gt; cliæ¥æ“ä½œ (ç±»ä¼¼ &lt;code&gt;aws&lt;/code&gt; cliå·¥å…·)&lt;/p&gt;
&lt;h4 id=&#34;åˆå§‹-vertex-ai-ç»„ä»¶&#34;&gt;åˆå§‹ Vertex AI ç»„ä»¶&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;vertexai&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;vertexai&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;init&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;project&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PROJECT_ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;location&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;REGION&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;2-åˆ›å»º-bigquery-è¡¨&#34;&gt;2. åˆ›å»º BigQuery è¡¨&lt;/h3&gt;
&lt;p&gt;ç¬¬äºŒæ­¥æ¶‰åŠåˆ°ä¸ºæˆ‘ä»¬çš„ LLM åº”ç”¨ç¨‹åºå‡†å¤‡æ•°æ®é›†ã€‚æˆ‘ä»¬ä½¿ç”¨äº†æ¥è‡ª &lt;strong&gt;Google BigQuery&lt;/strong&gt; çš„ä¸€ä¸ªå…è´¹ï¼ˆå…¬å¼€ï¼‰çš„é»‘å®¢æ–°é—»æ•°æ®é›†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;em&gt;åˆ©ç”¨ BigQuery æ„å»ºæœºå™¨å­¦ä¹ åº”ç”¨ç¨‹åºæ˜¯ä¸€ç§å¸¸è§æ¨¡å¼ï¼Œå› ä¸ºå®ƒå…·æœ‰å¼ºå¤§çš„æŸ¥è¯¢å’Œåˆ†æèƒ½åŠ›ã€‚&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†ä»ä¸ºè¿™ä¸ªæ•°æ®é›†åˆ›å»ºæˆ‘ä»¬è‡ªå·±çš„ BigQuery è¡¨å¼€å§‹ã€‚æ­¤å¤–ï¼Œå¦‚æœæ‚¨æœ‰ä¸åŒçš„æ•°æ®é›†è¦å¤„ç†ï¼Œæ‚¨å¯ä»¥éµå¾ªç±»ä¼¼çš„æ¨¡å¼ï¼Œç”šè‡³å¯ä»¥å°† CSV ä» Google Cloud Storage å­˜å‚¨æ¡¶åŠ è½½åˆ° BigQuery ä¸­ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åˆ›å»ºæºè¡¨&#34;&gt;åˆ›å»ºæºè¡¨&lt;/h4&gt;
&lt;p&gt;ç¬¬ä¸€æ­¥æ˜¯ä»å…¬å…±æ•°æ®æºåˆ›å»ºä¸€ä¸ªæ–°è¡¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;google.cloud&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bigquery&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Create bigquery client&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;bq&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bigquery&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;project&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PROJECT_ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;TABLE_NAME&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Input a Big Query TABLE_NAME:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#hackernews&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;DATASET_ID&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PROJECT_ID&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;.google_redis_llms&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Create dataset&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;dataset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bigquery&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Dataset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DATASET_ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;dataset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;location&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;US&amp;#34;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;dataset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;create_dataset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dataset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;timeout&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;exists_ok&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Define table ID&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;TABLE_ID&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DATASET_ID&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TABLE_NAME&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Create source table&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;create_source_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;create_job&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&amp;#39;
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;      CREATE OR REPLACE TABLE `&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table_id&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;` AS (
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;        SELECT
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;          title, text, time, timestamp, id
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;        FROM `bigquery-public-data.hacker_news.full`
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;        WHERE
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;          type =&amp;#39;story&amp;#39;
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;        LIMIT 1000
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;      )
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;    &amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;res&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_job&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# Make an API request&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Create table&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_source_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TABLE_ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# List schema&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;schema&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸Šé¢çš„æ•°æ®é›†åŒ…å«é»‘å®¢æ–°é—»å¸–å­çš„è®°å½•ï¼ŒåŒ…æ‹¬&lt;strong&gt;æ ‡é¢˜&lt;/strong&gt;ã€&lt;strong&gt;æ–‡æœ¬&lt;/strong&gt;ã€&lt;strong&gt;æ—¶é—´&lt;/strong&gt;ã€&lt;strong&gt;id&lt;/strong&gt;å’Œ&lt;strong&gt;æ—¶é—´æˆ³&lt;/strong&gt;ã€‚è®©æˆ‘ä»¬æå–ä¸€äº›ç¤ºä¾‹è¡Œå¹¶è¿›è¡Œæ£€æŸ¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Query 5 sample records from BQ&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;query_job&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&amp;#39;
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;SELECT *
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;FROM &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TABLE_ID&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;LIMIT 5
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;query_job&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_dataframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…·ä½“è¡¨æ ¼æ•°æ®è§&lt;a href=&#34;https://github.com/weedge/doraemon-nb/blob/main/Google_BigQuery_Palm_Redis.ipynb&#34;&gt;æ“ä½œç¬”è®°&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;3-ç”Ÿæˆ-embeddings&#34;&gt;3. ç”Ÿæˆ Embeddings&lt;/h3&gt;
&lt;h4 id=&#34;ä½¿ç”¨-vertex-ai-åµŒå…¥æ¨¡å‹åˆ›å»ºæ–‡æœ¬åµŒå…¥&#34;&gt;ä½¿ç”¨ Vertex AI åµŒå…¥æ¨¡å‹åˆ›å»ºæ–‡æœ¬åµŒå…¥&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨ Google å¼€å‘çš„ &lt;a href=&#34;https://cloud.google.com/vertex-ai/docs/generative-ai/embeddings/get-text-embeddings&#34;&gt;Vertex AI API for text embeddings&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚éœ€è¯¦ç»†äº†è§£åµŒå…¥ï¼Œè¯·å‚é˜… &lt;a href=&#34;https://cloud.google.com/blog/topics/developers-practitioners/meet-ais-multitool-vector-embeddings?hl=zh-cn&#34;&gt;Meet AI çš„å¤šå·¥å…·ï¼šå‘é‡åµŒå…¥&lt;/a&gt;ã€‚å¦‚éœ€å­¦ä¹ æœ‰å…³åµŒå…¥çš„åŸºç¡€æœºå™¨å­¦ä¹ é€Ÿæˆè¯¾ç¨‹ï¼Œè¯·å‚é˜…&lt;a href=&#34;https://developers.google.com/machine-learning/crash-course/embeddings/video-lecture?hl=zh-cn&#34;&gt;åµŒå…¥&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä½¿ç”¨gpc è¿›è¡Œç›¸å…³embeddingsçš„case: &lt;a href=&#34;https://github.com/GoogleCloudPlatform/generative-ai/tree/main/embeddings&#34;&gt;https://github.com/GoogleCloudPlatform/generative-ai/tree/main/embeddings&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ–‡æœ¬åµŒå…¥æ˜¯å†…å®¹çš„å¯†é›†å‘é‡è¡¨ç¤ºï¼Œå¦‚æœä¸¤ä¸ªå†…å®¹åœ¨è¯­ä¹‰ä¸Šç›¸ä¼¼ï¼Œå®ƒä»¬å„è‡ªçš„åµŒå…¥åœ¨åµŒå…¥å‘é‡ç©ºé—´ä¸­çš„ä½ç½®ä¹Ÿç›¸è¿‘ã€‚è¿™ç§è¡¨ç¤ºå¯ä»¥ç”¨æ¥è§£å†³å¸¸è§çš„è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯­ä¹‰æœç´¢&lt;/strong&gt;ï¼šæ ¹æ®è¯­ä¹‰ç›¸ä¼¼æ€§å¯¹æœç´¢æ–‡æœ¬è¿›è¡Œæ’åã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¨è&lt;/strong&gt;ï¼šè¿”å›ä¸ç»™å®šæ–‡æœ¬å…·æœ‰ç›¸ä¼¼æ–‡æœ¬å±æ€§çš„é¡¹ç›®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ†ç±»&lt;/strong&gt;ï¼šè¿”å›ä¸ç»™å®šæ–‡æœ¬ç›¸ä¼¼çš„æ–‡æœ¬å±æ€§çš„é¡¹ç›®ç±»åˆ«ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èšç±»&lt;/strong&gt;ï¼šå¯¹ä¸ç»™å®šæ–‡æœ¬çš„æ–‡æœ¬å±æ€§ç›¸ä¼¼çš„é¡¹ç›®è¿›è¡Œèšç±»ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼‚å¸¸æ£€æµ‹&lt;/strong&gt;ï¼šè¿”å›ä¸ç»™å®šæ–‡æœ¬çš„æ–‡æœ¬å±æ€§å…³ç³»æœ€å°çš„é¡¹ç›®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;textembedding-gecko&lt;/code&gt; æ¨¡å‹æ¥å—æœ€å¤š 3,072 ä¸ªè¾“å…¥æ ‡è®°ï¼ˆå³å•è¯ï¼‰ï¼Œå¹¶è¾“å‡º 768 ç»´çš„å‘é‡åµŒå…¥ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å®šä¹‰åµŒå…¥è¾…åŠ©å‡½æ•°&#34;&gt;å®šä¹‰åµŒå…¥è¾…åŠ©å‡½æ•°&lt;/h4&gt;
&lt;p&gt;æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè¾…åŠ©å‡½æ•° &lt;code&gt;embedding_model_with_backoff&lt;/code&gt;ï¼Œç”¨äºä»æ–‡æœ¬åˆ—è¡¨åˆ›å»ºåµŒå…¥ï¼ŒåŒæ—¶é€šè¿‡&lt;a href=&#34;https://en.wikipedia.org/wiki/Exponential_backoff&#34;&gt;æŒ‡æ•°é€€é¿&lt;/a&gt;æ¥ä½¿å…¶å¯¹&lt;a href=&#34;https://cloud.google.com/vertex-ai/docs/quotas&#34;&gt;Vertex AI API é…é¢&lt;/a&gt;å…·æœ‰å¼¹æ€§ï¼Œä½¿ç”¨&lt;a href=&#34;https://github.com/jd/tenacity&#34;&gt;tenacity&lt;/a&gt;åº“ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ç§æ–¹æ³•ï¼Œå°†æµ®ç‚¹æ•°æ•°ç»„è½¬æ¢ä¸ºå­—èŠ‚å­—ç¬¦ä¸²ï¼Œä»¥ä¾¿åœ¨ Redis ä¸­é«˜æ•ˆå­˜å‚¨ï¼ˆç¨åä½¿ç”¨ï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;typing&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Generator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Any&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;tenacity&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;retry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stop_after_attempt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wait_random_exponential&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;vertexai.preview.language_models&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TextEmbeddingModel&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Embedding model definition from VertexAI PaLM API&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;embedding_model&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TextEmbeddingModel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_pretrained&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;textembedding-gecko@001&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;VECTOR_DIMENSIONS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;768&lt;/span&gt;

&lt;span class=&#34;nd&#34;&gt;@retry&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wait&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;wait_random_exponential&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;min&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;max&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stop&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stop_after_attempt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;embed_text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;embeddings&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;embedding_model&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_embeddings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;each&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;values&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;each&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;embeddings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Convert embeddings to bytes for Redis storage&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;convert_embedding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;emb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;float&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]):&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;np&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;emb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;astype&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;np&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;float32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tobytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;åµŒå…¥æ–‡æœ¬æ•°æ®&#34;&gt;åµŒå…¥æ–‡æœ¬æ•°æ®&lt;/h4&gt;
&lt;p&gt;ç›®å‰ï¼Œæˆ‘ä»¬åœ¨ BigQuery ä¸­åˆ›å»ºçš„è¡¨ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼‰åŒ…å«äº†æˆ‘ä»¬å¸Œæœ›åµŒå…¥å¹¶ä¸ºå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰æä¾›å¯ç”¨çš„é»‘å®¢æ–°é—»æ–‡ç« è®°å½•ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†èŠ‚çœè¿™å°æœºå™¨çš„ RAM ä½¿ç”¨é‡ï¼Œæˆ‘ä»¬å°†åˆ†æ‰¹æ¬¡è¿­ä»£ BigQuery ä¸­çš„æ–‡ç« ï¼Œåˆ›å»ºåµŒå…¥ï¼Œå¹¶å°†å®ƒä»¬å†™å…¥ Redisï¼ŒRedis åœ¨æ­¤è¢«ç”¨ä½œ&lt;a href=&#34;https://redis.com/solutions/use-cases/vector-database&#34;&gt;å‘é‡æ•°æ®åº“&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;pandas&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;pd&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;numpy&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;np&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;QUERY_TEMPLATE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;SELECT id, title, text
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;FROM &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TABLE_ID&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;LIMIT &lt;/span&gt;&lt;span class=&#34;se&#34;&gt;{{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;limit&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;}}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; OFFSET &lt;/span&gt;&lt;span class=&#34;se&#34;&gt;{{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;}}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;query_bigquery_batches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;max_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;rows_per_batch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;start_batch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Generator&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pd&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DataFrame&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Any&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;None&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]:&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# Generate batches from a table in big query&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start_batch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rows_per_batch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;QUERY_TEMPLATE&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;limit&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows_per_batch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;query_job&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;query_job&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;df&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_dataframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;# Join title and text fields&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;df&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;df&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;apply&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;lambda&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Title: &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;title&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;. Content: &amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;r&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;axis&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;yield&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;df&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ä¸‹é¢ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€äº›è¾…åŠ©å‡½æ•°ï¼Œç”¨äºå¤„ç†å•ä¸ªæ•°æ®è¡Œã€å°†æ‰¹æ¬¡å†™å…¥ &lt;strong&gt;Redis&lt;/strong&gt;ã€ä» &lt;strong&gt;BigQuery&lt;/strong&gt; æŸ¥è¯¢æºæ•°æ®ï¼Œä»¥åŠä½¿ç”¨ &lt;strong&gt;Vertex AI&lt;/strong&gt; åˆ›å»ºæ–‡æœ¬åµŒå…¥ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;math&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;tqdm.auto&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tqdm&lt;/span&gt;


&lt;span class=&#34;c1&#34;&gt;# Redis key helper function&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;redis_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key_prefix&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Process a single dataset record&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;process_record&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;record&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;dict&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;dict&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;s1&#34;&gt;&amp;#39;id&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;record&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;id&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
      &lt;span class=&#34;s1&#34;&gt;&amp;#39;embedding&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;record&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;embedding&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
      &lt;span class=&#34;s1&#34;&gt;&amp;#39;text&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;record&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;text&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
      &lt;span class=&#34;s1&#34;&gt;&amp;#39;title&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;record&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;title&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Load batch of data into Redis as HASH objects&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;load_redis_batch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redis&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Redis&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;dataset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;key_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;doc&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;id_column&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;pipe&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pipeline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;record&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;enumerate&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;tqdm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dataset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)):&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;record&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;process_record&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;record&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redis_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key_prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;record&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id_column&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;pipe&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mapping&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;record&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;pipe&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;execute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Run the entire process&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;create_embeddings_bigquery_redis&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# Create generator from BigQuery&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;max_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;rows_per_batch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;bq_content_query&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;query_bigquery_batches&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;max_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rows_per_batch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;batch&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;tqdm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bq_content_query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;# Split batch into smaller chunks for embedding generation&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;batch_splits&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;np&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;array_split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;batch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ceil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows_per_batch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;# Create embeddings&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;batch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;embedding&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
          &lt;span class=&#34;n&#34;&gt;convert_embedding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;embedding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
          &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;split&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;batch_splits&lt;/span&gt;
          &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;embedding&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;embed_text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;content&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
      &lt;span class=&#34;c1&#34;&gt;# Write batch to Redis&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;batch&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;batch&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to_dict&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;records&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;load_redis_batch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;batch&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/doraemon/redis_gcp_rag_stack/redis-insights-vector.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;4-åŠ è½½åµŒå…¥&#34;&gt;4. åŠ è½½åµŒå…¥&lt;/h3&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªå‡½æ•°æ¥ç”Ÿæˆ BigQuery æ‰¹æ¬¡ã€åˆ›å»ºæ–‡æœ¬åµŒå…¥ä»¥åŠå°†æ‰¹æ¬¡å†™å…¥ Redisï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œè¿™ä¸€ä¸ªå‡½æ•°æ¥å¤„ç†æˆ‘ä»¬æ•´ä¸ªæ•°æ®é›†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;create_embeddings_bigquery_redis&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# Validate how many records are stored in Redis&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dbsize&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;5-åˆ›å»ºå‘é‡ç´¢å¼•&#34;&gt;5. åˆ›å»ºå‘é‡ç´¢å¼•&lt;/h3&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä»£è¡¨æˆ‘ä»¬æ•°æ®é›†ä¸­æ–‡æœ¬çš„åµŒå…¥ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨ Redis ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªè¾…åŠ©ç´¢å¼•ï¼Œä»¥å®ç°å¯¹åµŒå…¥çš„é«˜æ•ˆæœç´¢ã€‚è¦äº†è§£æ›´å¤šå…³äº Redis ä¸­å‘é‡ç›¸ä¼¼æ€§åŠŸèƒ½çš„ä¿¡æ¯ï¼Œ&lt;a href=&#34;https://redis.io/docs/interact/search-and-query/search/vectors/&#34;&gt;è¯·æŸ¥çœ‹è¿™äº›æ–‡æ¡£&lt;/a&gt; ä»¥åŠ &lt;a href=&#34;https://github.com/RedisVentures/redis-ai-resources&#34;&gt;è¿™äº› Redis AI èµ„æº&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å¯ç”¨æœç´¢åŠŸèƒ½å‘¢ï¼Ÿ&lt;/strong&gt;
ä½¿ç”¨ Redis è¿›è¡Œå‘é‡ç›¸ä¼¼æ€§æœç´¢å¯ä»¥è®©æˆ‘ä»¬æ£€ç´¢ä¸è¾“å…¥é—®é¢˜æˆ–æŸ¥è¯¢&lt;strong&gt;ç›¸ä¼¼&lt;/strong&gt;æˆ–&lt;strong&gt;ç›¸å…³&lt;/strong&gt;çš„æ–‡æœ¬æ•°æ®å—ã€‚è¿™å¯¹äºæˆ‘ä»¬çš„ç¤ºä¾‹ç”Ÿæˆå¼ AI / LLM åº”ç”¨ç¨‹åºæ¥è¯´å°†éå¸¸æœ‰å¸®åŠ©ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;redis.commands.search.field&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;NumericField&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;TagField&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;TextField&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;VectorField&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;redis.commands.search.indexDefinition&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IndexDefinition&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IndexType&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;redis.commands.search.query&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Query&lt;/span&gt;


&lt;span class=&#34;n&#34;&gt;INDEX_NAME&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;google:idx&amp;#34;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;PREFIX&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;doc:&amp;#34;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;VECTOR_FIELD_NAME&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;embedding&amp;#34;&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Store vectors in redis and create index&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# å¯¹hashä¸­çš„ embeddingå­—æ®µå»ºå‘é‡ç´¢å¼•FLAT,ç»´åº¦768,ç›¸ä¼¼åº¦æµ‹é‡æ–¹æ³•:cosine&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;create_redis_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redis&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Redis&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;vector_field_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;VECTOR_FIELD_NAME&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;index_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INDEX_NAME&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;list&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PREFIX&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;dim&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;VECTOR_DIMENSIONS&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#768&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;# Construct index&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;try&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Existing index found. Dropping and recreating the index&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flush&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dropindex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;delete_documents&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;except&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Creating new index&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flush&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;# Create new index&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;create_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;VectorField&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
                &lt;span class=&#34;n&#34;&gt;vector_field_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;FLAT&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;TYPE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;FLOAT32&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;DIM&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;dim&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                    &lt;span class=&#34;s2&#34;&gt;&amp;#34;DISTANCE_METRIC&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;COSINE&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
            &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;definition&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IndexDefinition&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index_type&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;IndexType&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;HASH&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Create index&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;create_redis_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# Inspect index attributes&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;INDEX_NAME&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;info&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Retreive single HASH from Redis&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hgetall&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/doraemon/redis_gcp_rag_stack/redis-vector-index.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Redis&lt;/strong&gt;æ•°æ®å­˜å‚¨å®Œå…¨åŠ è½½äº†æ¥è‡ª&lt;strong&gt;BigQuery&lt;/strong&gt;çš„æ•°æ®å­é›†ï¼ŒåŒ…æ‹¬ä½¿ç”¨&lt;strong&gt;Vertex AI&lt;/strong&gt; PaLM apiåˆ›å»ºçš„æ–‡æœ¬åµŒå…¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ„å»º-llm-åº”ç”¨ç¨‹åº&#34;&gt;æ„å»º LLM åº”ç”¨ç¨‹åº&lt;/h2&gt;
&lt;p&gt;éšç€ Redis ä½œä¸ºå‘é‡æ•°æ®åº“å®Œå…¨åŠ è½½ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¼ºå¤§çš„ PaLM APIï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæŠ€æœ¯æ ˆä¸Šæ„å»ºè®¸å¤š AI åº”ç”¨ç¨‹åºã€‚ä¸‹é¢æˆ‘ä»¬å°†ç®€è¦æè¿°æ¯ä¸ªåº”ç”¨ç¨‹åºåŠå…¶ç”¨ä¾‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ–‡æ¡£æ£€ç´¢&lt;/strong&gt; - æœç´¢æ–‡æ¡£ï¼Œåªè¿”å›ä¸ç»™å®šæŸ¥è¯¢æœ€ç›¸å…³çš„æ–‡æ¡£ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;äº§å“æ¨è&lt;/strong&gt; - æ ¹æ®è´­ç‰©è€…å–œæ¬¢çš„äº§å“çš„å±æ€§å’Œæè¿°ï¼Œæ¨èå…·æœ‰ç›¸ä¼¼å±æ€§å’Œæè¿°çš„äº§å“ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;èŠå¤©æœºå™¨äºº&lt;/strong&gt; - æä¾›ä¸€ä¸ªå¯¹è¯å¼ç•Œé¢ï¼Œç”¨äºä¿¡æ¯æ£€ç´¢æˆ–å®¢æˆ·æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–‡æœ¬æ‘˜è¦ä¸ç”Ÿæˆ&lt;/strong&gt; - ä»ç›¸å…³ä¿¡æ¯æºç”Ÿæˆæ–°çš„å†…å®¹ï¼Œä»¥åŠ é€Ÿå›¢é˜Ÿäº§å‡ºã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ¬ºè¯ˆ/å¼‚å¸¸æ£€æµ‹&lt;/strong&gt; - åŸºäºä¸å…¶ä»–å·²çŸ¥å®ä½“çš„å±æ€§ç›¸ä¼¼æ€§ï¼Œè¯†åˆ«å¼‚å¸¸å’Œæ½œåœ¨çš„æ¬ºè¯ˆäº‹ä»¶ã€äº¤æ˜“æˆ–é¡¹ç›®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ›´å¤šåº”ç”¨caseè§ï¼š&lt;a href=&#34;https://github.com/redis-developer/redis-ai-resources&#34;&gt;https://github.com/redis-developer/redis-ai-resources&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;llm-è®¾è®¡æ¨¡å¼&#34;&gt;LLM è®¾è®¡æ¨¡å¼&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†æ„å»ºè¿™ç±»åº”ç”¨ç¨‹åºï¼Œä¸‹é¢æˆ‘ä»¬å¼ºè°ƒäº†å››ç§æŠ€æœ¯è®¾è®¡æ¨¡å¼å’ŒæŠ€å·§ï¼ŒRedis Enterprise åœ¨è¿™äº›æ–¹é¢éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥æå‡ LLM çš„æ€§èƒ½ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;è¯­ä¹‰æœç´¢&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRetrieval Augmented Generationï¼ŒRAGï¼‰&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç¼“å­˜&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç»“åˆè¿™äº›æ¨¡å¼çš„æŸç§ç»„åˆæ˜¯æ¨èçš„æœ€ä½³å®è·µï¼Œè¿™äº›å®è·µæ¥è‡ªäºå…¨çƒå„åœ°ä¼ä¸šç”¨ä¾‹å’Œå¼€æºç”¨æˆ·çš„ç»éªŒå’Œæ€»ç»“ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç®€å•çš„è¯­ä¹‰æœç´¢&#34;&gt;ç®€å•çš„è¯­ä¹‰æœç´¢&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;è¯­ä¹‰æœç´¢&lt;/strong&gt;ï¼Œåœ¨å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰çš„èƒŒæ™¯ä¸‹ï¼Œæ˜¯ä¸€ç§å¤æ‚çš„æœç´¢æŠ€æœ¯ï¼Œå®ƒè¶…è¶Šäº†å­—é¢ä¸Šçš„å…³é”®è¯åŒ¹é…ï¼Œä»¥ç†è§£ç”¨æˆ·æŸ¥è¯¢èƒŒåçš„ä¸Šä¸‹æ–‡å«ä¹‰å’Œæ„å›¾ã€‚åˆ©ç”¨ Google Vertex AI å¹³å°çš„å¼ºå¤§èƒ½åŠ›å’Œ Redis å‘é‡æ•°æ®åº“çš„åŠŸèƒ½ï¼Œè¯­ä¹‰æœç´¢å¯ä»¥ä»å¤§é‡æ–‡æœ¬æ•°æ®é›†ä¸­æ˜ å°„å’Œæå–æ·±å±‚æ¬¡çš„çŸ¥è¯†ï¼ŒåŒ…æ‹¬ç»†å¾®çš„å…³ç³»å’Œéšè—çš„æ¨¡å¼ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä½¿å¾—åº”ç”¨ç¨‹åºèƒ½å¤Ÿè¿”å›åœ¨ä¸Šä¸‹æ–‡ä¸­ç›¸å…³çš„æœç´¢ç»“æœï¼Œé€šè¿‡æä¾›æœ‰æ„ä¹‰çš„å›åº”ï¼Œå¢å¼ºäº†ç”¨æˆ·ä½“éªŒï¼Œå³ä½¿æ˜¯å¯¹å¤æ‚æˆ–æ¨¡ç³Šçš„æœç´¢è¯ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å› æ­¤ï¼Œè¯­ä¹‰æœç´¢ä¸ä»…æé«˜äº†æœç´¢ç»“æœçš„å‡†ç¡®æ€§å’Œç›¸å…³æ€§ï¼Œè¿˜ä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿä»¥æ›´ç±»ä¼¼äººç±»ã€ç›´è§‚çš„æ–¹å¼ä¸ç”¨æˆ·äº’åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;è¯­ä¹‰æœç´¢çš„ä¸€èˆ¬è¿‡ç¨‹åŒ…æ‹¬ä¸‰ä¸ªæ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºæŸ¥è¯¢å‘é‡&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œå‘é‡æœç´¢&lt;/li&gt;
&lt;li&gt;å®¡æŸ¥å¹¶è¿”å›ç»“æœ&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 1. Create query vector&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;What is the best computer operating system for software dev?&amp;#34;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;query_vector&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;embed_text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Our query has been converted to a list of floats (this is a truncated view)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;query_vector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;


&lt;span class=&#34;c1&#34;&gt;# Helper method to perform KNN similarity search in Redis&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;similarity_search&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;return_fields&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;tuple&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INDEX_NAME&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# create embedding from query text&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;query_vector&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;embed_text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# create redis query object&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;redis_query&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;Query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;*=&amp;gt;[KNN &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; @&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;VECTOR_FIELD_NAME&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; $embedding AS score]&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sort_by&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;score&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;return_fields&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;return_fields&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;paging&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
            &lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dialect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# execute the search&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;results&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ft&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;index_name&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;search&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;redis_query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;query_params&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;embedding&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;convert_embedding&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query_vector&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)}&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pd&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DataFrame&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;vm&#34;&gt;__dict__&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;t&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;results&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;docs&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;drop&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;columns&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;payload&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;

  
&lt;span class=&#34;c1&#34;&gt;# 2. Perform vector similarity search with given query&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;results&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;similarity_search&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;return_fields&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;score&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;title&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;text&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;


&lt;span class=&#34;c1&#34;&gt;# 3. Review and return the results&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;display&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;results&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…·ä½“è¡¨æ ¼æ•°æ®è§&lt;a href=&#34;https://github.com/weedge/doraemon-nb/blob/main/Google_BigQuery_Palm_Redis.ipynb&#34;&gt;æ“ä½œç¬”è®°&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šè¿°ç»“æœè¡¨æ˜ï¼Œæˆ‘ä»¬é’ˆå¯¹è½¯ä»¶å¼€å‘è€…æ¨èçš„æ“ä½œç³»ç»Ÿçš„æœç´¢ï¼Œæ‰¾åˆ°äº†ä¸€äº›å¯èƒ½æœ‰åŠ©äºå›ç­”è¿™ä¸ªé—®é¢˜çš„ Hacker News çš„å¸–å­ã€‚å¯å°è¯•ä½¿ç”¨ä¸åŒçš„&lt;a href=&#34;https://redis.io/docs/interact/search-and-query/advanced-concepts/vectors/#creation-attributes-per-algorithm&#34;&gt;ç´¢å¼•ç±»å‹å’Œè·ç¦»åº¦é‡&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ£€ç´¢å¢å¼ºç”Ÿæˆrag&#34;&gt;æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;æ£€ç´¢å¢å¼ºç”Ÿæˆ&lt;/strong&gt;ï¼ˆRetrieval Augmented Generationï¼ŒRAGï¼‰åœ¨å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰çš„èŒƒå›´å†…ï¼Œæ˜¯ä¸€ç§ç»“åˆç‰¹å®šé¢†åŸŸæ•°æ®çŸ¥è¯†å’Œç”Ÿæˆæ¨¡å‹çš„æŠ€æœ¯ï¼Œç”¨äºå¢å¼ºäº§ç”Ÿä¸°å¯Œä¸Šä¸‹æ–‡é—®é¢˜å›ç­”çš„èƒ½åŠ›ã€‚æœ¬è´¨ä¸Šï¼Œ&lt;em&gt;RAG&lt;/em&gt; é€šè¿‡ä»æ–‡æ¡£æˆ–æ•°æ®çš„çŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯ï¼Œç„¶åå†ç”Ÿæˆå›ç­”çš„æ–¹å¼è¿›è¡Œå·¥ä½œã€‚è¿™ä½¿å¾—é€šç”¨çš„åŸºç¡€æ¨¡å‹èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶è®¿é—®è¿™äº›æ•°æ®æºï¼Œè¿™ä¸å¾®è°ƒä¸æ˜¯åŒä¸€å›äº‹ã€‚&lt;/p&gt;
&lt;p&gt;RAG åˆ©ç”¨ Redis ä½œä¸ºä½å»¶è¿Ÿå‘é‡æ•°æ®åº“çš„ä¼˜åŠ¿è¿›è¡Œé«˜æ•ˆçš„æ£€ç´¢æ“ä½œï¼Œä»¥åŠåˆ©ç”¨ Google çš„ Vertex AI ç”Ÿæˆè¿è´¯çš„æ–‡æœ¬å›ç­”ã€‚åœ¨ LLM åº”ç”¨ç¨‹åºä¸­ï¼ŒRAG ä½¿å¾—å¯¹ä¸Šä¸‹æ–‡çš„æ·±å…¥ç†è§£æˆä¸ºå¯èƒ½ï¼Œå³ä½¿æ˜¯å¯¹å¤æ‚çš„æŸ¥è¯¢ä¹Ÿèƒ½è¿”å›é«˜åº¦ç»†è…»çš„å›ç­”ã€‚è¿™ç§æ¨¡å¼å¢å¼ºäº†åº”ç”¨ç¨‹åºçš„äº¤äº’èƒ½åŠ›ï¼Œæä¾›äº†æ›´ç²¾ç¡®å’Œä¿¡æ¯ä¸°å¯Œçš„å›ç­”ï¼Œä»è€Œæ˜¾è‘—ä¸°å¯Œäº†ç”¨æˆ·ä½“éªŒã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ„å»ºä¸€ä¸ªç”¨äºé—®ç­”çš„RAGç®¡é“ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Vertex PaLM APIæ¥ç”Ÿæˆæ–‡æœ¬(&lt;code&gt;text-bison@001&lt;/code&gt;)ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;vertexai.preview.language_models&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TextGenerationModel&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Define generation model&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;generation_model&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TextGenerationModel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;from_pretrained&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;text-bison@001&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generation_model&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;predict&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;What is a large language model?&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Example response:&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†èƒ½å¤Ÿ&lt;strong&gt;åœ¨å¼•ç”¨ç‰¹å®šé¢†åŸŸçš„æ¥æº&lt;/strong&gt;ï¼ˆå¦‚æˆ‘ä»¬çš„ç¤ºä¾‹ hackernews æ•°æ®é›†ï¼‰çš„åŒæ—¶å›ç­”é—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»æ„å»ºä¸€ä¸ª RAG ç®¡é“ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;é¦–å…ˆåœ¨çŸ¥è¯†åº“ï¼ˆå­˜å‚¨åœ¨ Redis ä¸­ï¼‰ä¸Šä½¿ç”¨ç”¨æˆ·æŸ¥è¯¢è¿›è¡Œ&lt;strong&gt;è¯­ä¹‰æœç´¢&lt;/strong&gt;ï¼Œä»¥æ‰¾åˆ°æœ‰åŠ©äºè¯­è¨€æ¨¡å‹æ™ºèƒ½å›ç­”çš„ç›¸å…³æ¥æºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿™äº›æ¥æºï¼ˆç§°ä¸ºä¸Šä¸‹æ–‡ï¼‰è¢«â€œå¡å…¥â€æç¤ºï¼ˆè¾“å…¥ï¼‰ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœ€åï¼Œå®Œæ•´çš„æç¤ºè¢«ä¼ é€’ç»™è¯­è¨€æ¨¡å‹è¿›è¡Œæ–‡æœ¬ç”Ÿæˆã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;create_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prompt_template&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;**&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kwargs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prompt_template&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;format&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;**&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kwargs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;rag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;verbose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    Simple pipeline for performing retrieval augmented generation with
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    Google Vertex PaLM API and Redis Enterprise.
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;    &amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# Perform a vector similarity search in Redis&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;verbose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Pulling relevant data sources from Redis&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flush&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;relevant_sources&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;similarity_search&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;return_fields&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;text&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,))&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;verbose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Relevant sources found!&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flush&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# Combine the relevant sources and inject into the prompt&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;sources_text&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;-&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;relevant_sources&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;full_prompt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;prompt_template&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;sources&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sources_text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;
      &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;verbose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;Full prompt:&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;full_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;flush&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;# Perform text generation to get a response from PaLM API&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;generation_model&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;predict&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;full_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹æç¤ºæ¨¡æ¿ã€‚æ‚¨å¯ä»¥éšæ„ç¼–è¾‘å’Œè°ƒæ•´ä¸ºè¯­è¨€æ¨¡å‹è®¾ç½®ä¸Šä¸‹æ–‡çš„åˆå§‹å¥å­ï¼Œä»¥æ‰§è¡Œæˆ‘ä»¬é¢„æœŸçš„æ“ä½œã€‚å¯¹æç¤ºè®¾è®¡è¿›è¡Œè°ƒæ•´å’Œè¿­ä»£çš„è¿‡ç¨‹é€šå¸¸è¢«ç§°ä¸ºâ€œæç¤ºå·¥ç¨‹â€ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;PROMPT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;You are a helpful virtual technology and IT assistant. Use the hacker news posts below as relevant context and sources to help answer the user question. Don&amp;#39;t blindly make things up.
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;SOURCES:
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{sources}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;QUESTION:
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{query}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;?
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;ANSWER:&amp;#34;&amp;#34;&amp;#34;&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;What are the best operating systems for software development?&amp;#34;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PROMPT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;What are some commonly reported problems with MacBooks and MacOS for software dev purposes?&amp;#34;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PROMPT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ˜¾ç„¶ï¼Œè¿™ä¸ªç¤ºä¾‹æ•°æ®é›†(hackernews)å¹¶ä¸æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨çš„å”¯ä¸€ç¤ºä¾‹ï¼Œå®ƒå½“ç„¶ä¹Ÿä¸æ˜¯ç°æˆçš„â€œproductionâ€ã€‚è¿™ä¹Ÿåªæ˜¯ä¸ºäº†æ•™å­¦ç›®çš„è€Œä½¿ç”¨äº†å®é™…æ•°æ®çš„ä¸€ä¸ªå­é›†(1000æ¡è®°å½•)ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯ï¼Œè¿™ä¸ªç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•å°†å¤–éƒ¨æ•°æ®æºå’Œllmç»“åˆèµ·æ¥ï¼Œä»¥æ˜¾ç¤ºæ›´æœ‰ç”¨çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;llm-ç¼“å­˜&#34;&gt;LLM ç¼“å­˜&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;LLM ç¼“å­˜&lt;/strong&gt;æ˜¯ä¸€ç§ç”¨äºä¼˜åŒ–å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰åº”ç”¨ç¨‹åºæ€§èƒ½çš„é«˜çº§ç­–ç•¥ã€‚åˆ©ç”¨ Redis çš„è¶…å¿«é€Ÿå†…å­˜æ•°æ®å­˜å‚¨åŠŸèƒ½ï¼ŒLLM ç¼“å­˜èƒ½å¤Ÿå­˜å‚¨å¹¶å¿«é€Ÿæ£€ç´¢ç”± Google çš„ Vertex AIï¼ˆPaLMï¼‰ç”Ÿæˆçš„é¢„å…ˆè®¡ç®—çš„å“åº”ã€‚è¿™æ„å‘³ç€ï¼Œå°¤å…¶æ˜¯å¯¹äºé‡å¤æŸ¥è¯¢ï¼Œç”Ÿæˆå“åº”çš„è®¡ç®—æˆæœ¬é«˜æ˜‚çš„è¿‡ç¨‹è¢«æ˜¾è‘—å‡å°‘ï¼Œä»è€Œå®ç°æ›´å¿«çš„å“åº”æ—¶é—´å’Œé«˜æ•ˆçš„èµ„æºåˆ©ç”¨ã€‚å› æ­¤ï¼Œå°† Google å¼ºå¤§çš„ç”Ÿæˆå¼ AI èƒ½åŠ›ä¸ Redis é«˜æ€§èƒ½çš„ç¼“å­˜ç³»ç»Ÿç›¸ç»“åˆï¼Œä¸º LLM åº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªæ›´å…·å¯æ‰©å±•æ€§å’Œæ€§èƒ½çš„æ¶æ„ï¼Œæé«˜äº†æ•´ä½“ç”¨æˆ·ä½“éªŒå’Œåº”ç”¨ç¨‹åºçš„å¯é æ€§ã€‚&lt;/p&gt;
&lt;p&gt;LLM çš„ç¼“å­˜ä¸»è¦æœ‰ä¸¤ç§æ¨¡å¼ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ ‡å‡†ç¼“å­˜&lt;/li&gt;
&lt;li&gt;è¯­ä¹‰ç¼“å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;æ ‡å‡†ç¼“å­˜&#34;&gt;æ ‡å‡†ç¼“å­˜&lt;/h4&gt;
&lt;p&gt;LLM çš„æ ‡å‡†ç¼“å­˜æ¶‰åŠç®€å•åœ°åŒ¹é…ä»¥å‰æä¾›è¿‡çš„ç¡®åˆ‡çŸ­è¯­æˆ–æç¤ºã€‚æˆ‘ä»¬å¯ä»¥è¿”å›ä¹‹å‰ä½¿ç”¨çš„ LLM å“åº”ï¼Œä»¥åŠ å¿«ç³»ç»Ÿçš„æ•´ä½“ååé‡å¹¶å‡å°‘å†—ä½™è®¡ç®—ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Some boiler plate helper methods&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;hashlib&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;hash_input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prefix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hashlib&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sha256&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_input&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;encode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;utf-8&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hexdigest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;standard_check&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
  &lt;span class=&#34;c1&#34;&gt;# function to perform a standard cache check&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;res&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hgetall&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;res&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;response&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;decode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;utf-8&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cache_response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hash_input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;llmcache:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;hset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;mapping&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;prompt&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;response&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;})&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# LLM Cache wrapper / decorator function&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;standard_llmcache&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;llm_callable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;wrapper&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;**&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kwargs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;# Check LLM Cache first&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;hash_input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;llmcache:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;**&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kwargs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;standard_check&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;# Check if we have a cached response we can use&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
            &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;
        &lt;span class=&#34;c1&#34;&gt;# Otherwise execute the llm callable here&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;llm_callable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;**&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kwargs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;cache_response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;wrapper&lt;/span&gt;
  
&lt;span class=&#34;c1&#34;&gt;# Define a function that invokes the PaLM API wrapped with a cache check&lt;/span&gt;
&lt;span class=&#34;nd&#34;&gt;@standard_llmcache&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;ask_palm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PROMPT&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;verbose&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;What are the best operating systems for software development?&amp;#34;&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;ask_palm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬å†é—®åŒæ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬åº”è¯¥ä¼šå¾—åˆ°å‡ ä¹å®æ—¶çš„ç›¸åŒå›ç­”ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;o&#34;&gt;%%&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;time&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;# for ipynb&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;ask_palm&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;è¯­ä¹‰ç¼“å­˜-semantic-caching&#34;&gt;è¯­ä¹‰ç¼“å­˜ (Semantic Caching)&lt;/h4&gt;
&lt;p&gt;è¯­ä¹‰ç¼“å­˜åŸºäºä¸Šè¿°ç›¸åŒçš„æ¦‚å¿µï¼Œä½†åˆ©ç”¨ Redis çš„å‘é‡æ•°æ®åº“ç‰¹æ€§æ¥æŸ¥æ‰¾ä»¥å‰åº”ç”¨è¿‡çš„è¯­ä¹‰ä¸Šç›¸ä¼¼çš„æç¤ºâ€”â€”è¿™ä½¿å¾—ç¼“å­˜é‚£äº›åœ¨æ„ä¹‰ä¸Šéå¸¸ç›¸ä¼¼ä½†ä¸ä¸€å®šä½¿ç”¨å®Œå…¨ç›¸åŒå•è¯å’ŒçŸ­è¯­çš„æŸ¥è¯¢çš„å“åº”æˆä¸ºå¯èƒ½ã€‚è¿™æé«˜äº†â€œå‘½ä¸­ç‡â€ï¼Œä½¿å¾— LLM ç¼“å­˜åœ¨å®è·µä¸­æ›´åŠ æœ‰æ•ˆã€‚&lt;/p&gt;
&lt;p&gt;åœ¨langchainå¼€å‘æ¡†æ¶ä¸­é›†æˆï¼š&lt;a href=&#34;https://python.langchain.com/docs/integrations/llms/llm_caching#semantic-cache&#34;&gt;https://python.langchain.com/docs/integrations/llms/llm_caching#semantic-cache&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;å†å²è®°å½•&#34;&gt;å†å²è®°å½•&lt;/h3&gt;
&lt;p&gt;ä¸ºåº”ç”¨ç¨‹åºæä¾›å¯¹â€œå†å²è®°å½•â€çš„è®¿é—®ï¼Œä»¥è®°å½•èŠå¤©å†å²ï¼Œæ˜¯ä¸€ç§å¸¸è§çš„æŠ€æœ¯ï¼Œç”¨äºæé«˜æ¨¡å‹æ¨ç†æœ€è¿‘æˆ–è¿‡å»å¯¹è¯çš„èƒ½åŠ›ï¼Œä»ä¹‹å‰çš„å›ç­”ä¸­è·å¾—ä¸Šä¸‹æ–‡ï¼Œä»è€Œæä¾›æ›´å‡†ç¡®å’Œå¯æ¥å—çš„å›åº”ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æˆ‘ä»¬è®¾ç½®äº†ç®€å•çš„è¾…åŠ©å‡½æ•°æ¥åœ¨Redis Listæ•°æ®ç»“æ„ä¸­æŒä¹…åŒ–å’ŒåŠ è½½ä¼šè¯å†å²è®°å½•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;json&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;add_message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;str&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;msg&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;prompt&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;response&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lpush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;chat-history&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;json&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dumps&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;get_messages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;json&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;loads&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;msg&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;msg&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lrange&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;chat-history&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
  

&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Do you have any advice for getting started in the tech field as a software dev?&amp;#34;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PROMPT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;verbose&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;add_message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;What if I am still in college, any tips there?&amp;#34;&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rag&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PROMPT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;verbose&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;False&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;add_message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;query&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;get_messages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/doraemon/redis_gcp_rag_stack/redis-list-chat-records.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç»“æŸå·¥ä½œ&#34;&gt;ç»“æŸå·¥ä½œ&lt;/h2&gt;
&lt;p&gt;æ¸…ç†bigquery åˆ›å»ºçš„è¡¨&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Clean up bigquery&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;bq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;delete_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TABLE_ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;not_found_ok&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;bq&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;delete_dataset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;DATASET_ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;delete_contents&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;not_found_ok&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/doraemon/redis_gcp_rag_stack/bigquery-table-del.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ¸…ç†redisä¸­çš„æ•°æ®ï¼Œå…³é—­æœåŠ¡&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Clean up redis&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;#!redis-stack-server stop&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flushdb&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;redis_client&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/RedisVentures/gcp-redis-llm-stack&#34;&gt;https://github.com/RedisVentures/gcp-redis-llm-stack&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://redis.io/docs/get-started/vector-database/&#34;&gt;https://redis.io/docs/get-started/vector-database/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://redis.com/solutions/use-cases/vector-database/&#34;&gt;https://redis.com/solutions/use-cases/vector-database/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/redis-developer/redis-ai-resources&#34;&gt;https://github.com/redis-developer/redis-ai-resources&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://console.cloud.google.com/apis/library&#34;&gt;https://console.cloud.google.com/apis/library&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/GoogleCloudPlatform/generative-ai&#34;&gt;https://github.com/GoogleCloudPlatform/generative-ai&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloud.google.com/blog/topics/developers-practitioners/meet-ais-multitool-vector-embeddings&#34;&gt;https://cloud.google.com/blog/topics/developers-practitioners/meet-ais-multitool-vector-embeddings&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloud.google.com/vertex-ai/pricing?hl=zh-cn#generative_ai_models&#34;&gt;https://cloud.google.com/vertex-ai/pricing?hl=zh-cn#generative_ai_models&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/weedge/doraemon-nb/blob/main/Langchain_RAG.ipynb&#34;&gt;https://github.com/weedge/doraemon-nb/blob/main/Langchain_RAG.ipynb&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
      
    </item>
    
    <item>
      <title>è®ºæ–‡ï¼šRetrieval-Augmented Generation for Large Language Models: A Survey [v4]</title>
      <link>https://weedge.github.io/post/paper/rag/rag-for-llms-a-survey/</link>
      <pubDate>Fri, 08 Mar 2024 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/paper/rag/rag-for-llms-a-survey/</guid>
      
        <description>&lt;p&gt;å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰å±•ç¤ºäº†æ˜¾è‘—çš„èƒ½åŠ›ï¼Œä½†é¢ä¸´ç€å¹»è§‰ã€è¿‡æ—¶çŸ¥è¯†å’Œä¸é€æ˜ã€ä¸å¯è¿½è¸ªçš„æ¨ç†è¿‡ç¨‹ç­‰æŒ‘æˆ˜ã€‚æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰å·²ç»æˆä¸ºä¸€ä¸ªæœ‰å‰é€”çš„è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡æ•´åˆå¤–éƒ¨æ•°æ®åº“çš„çŸ¥è¯†ã€‚è¿™å¢å¼ºäº†æ¨¡å‹çš„å‡†ç¡®æ€§å’Œå¯ä¿¡åº¦ï¼Œç‰¹åˆ«é€‚ç”¨äºçŸ¥è¯†å¯†é›†å‹ä»»åŠ¡ï¼Œå¹¶å…è®¸æŒç»­çš„çŸ¥è¯†æ›´æ–°å’Œé¢†åŸŸç‰¹å®šä¿¡æ¯çš„æ•´åˆã€‚RAGé€šè¿‡å°†LLMsçš„å†…åœ¨çŸ¥è¯†ä¸åºå¤§ã€åŠ¨æ€çš„å¤–éƒ¨æ•°æ®åº“èµ„æºç›¸ç»“åˆï¼Œäº§ç”Ÿäº†ååŒæ•ˆåº”ã€‚è¿™ç¯‡ç»¼è¿°è®ºæ–‡è¯¦ç»†è€ƒå¯Ÿäº†RAGèŒƒå¼çš„å‘å±•ï¼ŒåŒ…æ‹¬æœ´ç´ RAGã€é«˜çº§RAGå’Œæ¨¡å—åŒ–RAGã€‚å®ƒå¯¹RAGæ¡†æ¶çš„ä¸‰æ–¹åŸºç¡€è¿›è¡Œäº†ç»†è‡´çš„äº†è§£ï¼Œå…¶ä¸­åŒ…æ‹¬æ£€ç´¢ã€ç”Ÿæˆå’Œå¢å¼ºæŠ€æœ¯ã€‚è¯¥è®ºæ–‡å¼ºè°ƒåµŒå…¥(embedding)åœ¨æ¯ä¸ªå…³é”®ç»„æˆéƒ¨åˆ†çš„æœ€å…ˆè¿›æŠ€æœ¯ï¼Œå¹¶æå¯¹RAGç³»ç»Ÿè¿›å±•çš„æ·±å…¥ç ”ç©¶äº†è§£ã€‚æ­¤å¤–ï¼Œè¯¥è®ºæ–‡ä»‹ç»äº†è¯„ä¼°RAGæ¨¡å‹çš„æŒ‡æ ‡å’ŒåŸºå‡†ï¼Œä»¥åŠæœ€æ–°çš„è¯„ä¼°æ¡†æ¶ã€‚æœ€åï¼Œè¯¥è®ºæ–‡è®²äº†ä¸€äº›ç ”ç©¶å‰æ™¯ï¼ŒåŒ…æ‹¬æœªæ¥æŒ‘æˆ˜ã€å¤šæ¨¡æ€çš„æ‰©å±•ä»¥åŠRAGåŸºç¡€è®¾æ–½åŠå…¶ç”Ÿæ€ç³»ç»Ÿçš„è¿›å±•&lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è®ºæ–‡åœ°å€:  &lt;a href=&#34;https://arxiv.org/pdf/2312.10997.pdf&#34;&gt;Retrieval-Augmented Generation for Large Language Models: A Survey&lt;/a&gt; |  &lt;a href=&#34;https://github.com/Tongji-KGLLM/RAG-Survey/blob/main/assets/RAG_Slide_ENG.pdf&#34;&gt;PPT&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ³¨ï¼š ä¸»è¦æ˜¯äº†è§£RAGçš„å‘å±•è¿‡ç¨‹(å¬å›ç‡)ï¼Œä»¥åŠå¯¹ç›¸å…³å­æ¨¡å—é¢†åŸŸçš„ç°é˜¶æ®µäº†è§£ï¼Œå¦‚æœæ„Ÿå…´è¶£ï¼Œé€šè¿‡ç´¢å¼•åˆ°è®ºæ–‡å¼•ç”¨å¤„è¿›ä¸€æ­¥äº†è§£ã€‚(æé«˜çœ‹ç›¸åº”è®ºæ–‡çš„å‡†ç¡®ç‡)&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬1ç« å¼•è¨€&#34;&gt;ç¬¬1ç« ï¼šå¼•è¨€&lt;/h2&gt;
&lt;p&gt;å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰å¦‚GPTç³»åˆ—å’ŒLLamaç³»åˆ—åœ¨è‡ªç„¶è¯­è¨€å¤„ç†æ–¹é¢å–å¾—äº†æ˜¾è‘—çš„æˆåŠŸï¼Œå±•ç¤ºäº†åœ¨å„ç§åŸºå‡†æµ‹è¯•ä¸­çš„å“è¶Šæ€§èƒ½ï¼ŒåŒ…æ‹¬SuperGLUEã€MMLUå’ŒBIG-benchã€‚å°½ç®¡å–å¾—äº†è¿™äº›è¿›æ­¥ï¼ŒLLMsåœ¨å¤„ç†ç‰¹å®šé¢†åŸŸæˆ–é«˜åº¦ä¸“ä¸šåŒ–çš„æŸ¥è¯¢æ—¶è¡¨ç°å‡ºæ˜æ˜¾çš„å±€é™æ€§ã€‚ä¸€ä¸ªå¸¸è§é—®é¢˜æ˜¯ç”Ÿæˆé”™è¯¯ä¿¡æ¯ï¼Œæˆ–ç§°ä¸ºâ€œå¹»è§‰â€ï¼Œå°¤å…¶æ˜¯å½“æŸ¥è¯¢è¶…å‡ºæ¨¡å‹çš„è®­ç»ƒæ•°æ®æˆ–éœ€è¦æœ€æ–°ä¿¡æ¯æ—¶ã€‚è¿™äº›ç¼ºç‚¹å¼ºè°ƒäº†åœ¨æ²¡æœ‰é¢å¤–ä¿éšœæªæ–½çš„æƒ…å†µä¸‹ï¼Œå°†LLMsä½œä¸ºé»‘ç›’è§£å†³æ–¹æ¡ˆéƒ¨ç½²åœ¨ç°å®ä¸–ç•Œç”Ÿäº§ç¯å¢ƒä¸­çš„ä¸åˆ‡å®é™…æ€§ã€‚ç¼“è§£è¿™äº›å±€é™æ€§çš„ä¸€ä¸ªæœ‰å‰æ™¯çš„æ–¹æ³•æ˜¯æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRetrieval-Augmented Generation, RAGï¼‰ï¼Œå®ƒé€šè¿‡å°†å¤–éƒ¨æ•°æ®æ£€ç´¢æ•´åˆåˆ°ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œä»è€Œå¢å¼ºäº†æ¨¡å‹æä¾›å‡†ç¡®å’Œç›¸å…³å“åº”çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;RAGç”±Lewisç­‰äººåœ¨2020å¹´ä¸­æœŸå¼•å…¥ï¼Œä½œä¸ºLLMsé¢†åŸŸå†…çš„ä¸€ç§èŒƒå¼ï¼Œå¢å¼ºäº†ç”Ÿæˆä»»åŠ¡ã€‚å…·ä½“æ¥è¯´ï¼ŒRAGæ¶‰åŠä¸€ä¸ªåˆå§‹æ£€ç´¢æ­¥éª¤ï¼Œå…¶ä¸­LLMsæŸ¥è¯¢å¤–éƒ¨æ•°æ®æºä»¥è·å–ç›¸å…³ä¿¡æ¯ï¼Œç„¶åå†è¿›è¡Œå›ç­”é—®é¢˜æˆ–ç”Ÿæˆæ–‡æœ¬ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸ä»…ä¸ºåç»­çš„ç”Ÿæˆé˜¶æ®µæä¾›ä¿¡æ¯ï¼Œè¿˜ç¡®ä¿å“åº”åŸºäºæ£€ç´¢åˆ°çš„è¯æ®ï¼Œä»è€Œæ˜¾è‘—æé«˜äº†è¾“å‡ºçš„å‡†ç¡®æ€§å’Œç›¸å…³æ€§ã€‚åœ¨æ¨ç†é˜¶æ®µä»çŸ¥è¯†åº“åŠ¨æ€æ£€ç´¢ä¿¡æ¯å…è®¸RAGè§£å†³ç”Ÿæˆäº‹å®ä¸Šä¸æ­£ç¡®å†…å®¹çš„é—®é¢˜ï¼Œé€šå¸¸ç§°ä¸ºâ€œå¹»è§‰â€ã€‚å°†RAGæ•´åˆåˆ°LLMsä¸­å·²ç»è¿…é€Ÿè¢«é‡‡ç”¨ï¼Œå¹¶æˆä¸ºå®Œå–„èŠå¤©æœºå™¨äººèƒ½åŠ›å’Œä½¿LLMsæ›´é€‚ç”¨äºå®é™…åº”ç”¨çš„å…³é”®æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;p&gt;RAGçš„å‘å±•è½¨è¿¹ç»å†äº†å››ä¸ªä¸åŒçš„é˜¶æ®µï¼Œå¦‚å›¾1æ‰€ç¤ºã€‚åœ¨å…¶2017å¹´çš„èµ·æºæ—¶ï¼Œä¸Transformeræ¶æ„çš„å‡ºç°ç›¸ä¸€è‡´ï¼Œä¸»è¦é‡ç‚¹æ˜¯é€šè¿‡é¢„è®­ç»ƒæ¨¡å‹ï¼ˆPTMï¼‰å¸æ”¶é¢å¤–çš„çŸ¥è¯†æ¥å¢å¼ºè¯­è¨€æ¨¡å‹ã€‚è¿™ä¸ªæ—¶æœŸè§è¯äº†RAGçš„åŸºç¡€å·¥ä½œä¸»è¦é›†ä¸­åœ¨ä¼˜åŒ–é¢„è®­ç»ƒæ–¹æ³•ä¸Šã€‚åœ¨chatGPTå‡ºç°ä¹‹å‰ï¼Œæœ‰ä¸€ä¸ªç›¸å¯¹ä¼‘çœ çš„æ—¶æœŸï¼ŒRAGç›¸å…³ç ”ç©¶çš„è¿›å±•å¾ˆå°‘ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/rag/RAG_for_LLMs_A_Survey/1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;éšåchatGPTçš„åˆ°æ¥æ ‡å¿—ç€RAGå‘å±•è½¨è¿¹ä¸­çš„ä¸€ä¸ªå…³é”®æ—¶åˆ»ï¼Œå°†LLMsæ¨å‘äº†å‰æ²¿ã€‚ç¤¾åŒºçš„ç„¦ç‚¹è½¬å‘åˆ©ç”¨LLMsçš„èƒ½åŠ›ä»¥å®ç°æ›´é«˜çš„å¯æ§æ€§å¹¶æ»¡è¶³ä¸æ–­æ¼”å˜çš„éœ€æ±‚ã€‚å› æ­¤ï¼Œå¤§éƒ¨åˆ†RAGå·¥ä½œé›†ä¸­åœ¨æ¨ç†ä¸Šï¼Œå°‘æ•°è‡´åŠ›äºå¾®è°ƒè¿‡ç¨‹ã€‚éšç€LLMsèƒ½åŠ›çš„æŒç»­è¿›æ­¥ï¼Œç‰¹åˆ«æ˜¯éšç€GPT-4çš„å¼•å…¥ï¼ŒRAGæŠ€æœ¯é¢†åŸŸç»å†äº†é‡å¤§å˜é©ã€‚é‡ç‚¹å‘å±•æˆä¸ºä¸€ç§æ··åˆæ–¹æ³•ï¼Œç»“åˆäº†RAGå’Œå¾®è°ƒçš„ä¼˜åŠ¿ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€å°éƒ¨åˆ†ç»§ç»­ä¸“æ³¨äºä¼˜åŒ–é¢„è®­ç»ƒæ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡RAGç ”ç©¶è¿…é€Ÿå¢é•¿ï¼Œä½†è¯¥é¢†åŸŸç¼ºä¹ç³»ç»Ÿçš„æ•´åˆå’ŒæŠ½è±¡ï¼Œè¿™åœ¨ç†è§£RAGè¿›æ­¥çš„å…¨é¢æ™¯è§‚æ–¹é¢å¸¦æ¥äº†æŒ‘æˆ˜ã€‚æœ¬ç»¼è¿°æ—¨åœ¨æ¦‚è¿°æ•´ä¸ªRAGè¿‡ç¨‹ï¼Œå¹¶åŒ…å«RAGç ”ç©¶çš„å½“å‰å’Œæœªæ¥æ–¹å‘ï¼Œé€šè¿‡å…¨é¢æ£€æŸ¥LLMsä¸­çš„æ£€ç´¢å¢å¼ºã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œæœ¬æ–‡æ—¨åœ¨å…¨é¢æ€»ç»“å’Œç»„ç»‡æŠ€æœ¯åŸç†ã€å‘å±•å†å²ã€å†…å®¹ï¼Œç‰¹åˆ«æ˜¯RAGçš„ç›¸å…³æ–¹æ³•å’Œåº”ç”¨ï¼Œä»¥åŠè¯„ä¼°æ–¹æ³•å’Œåº”ç”¨åœºæ™¯ã€‚å®ƒæ—¨åœ¨ä¸ºè¯»è€…å’Œå®è·µè€…æä¾›ä¸€ä¸ªå…¨é¢å’Œç³»ç»Ÿçš„ç†è§£å’Œåˆ†æå¤§å‹æ¨¡å‹å’ŒRAGï¼Œé˜æ˜æ£€ç´¢å¢å¼ºçš„è¿›å±•å’Œå…³é”®æŠ€æœ¯ï¼Œæ˜ç¡®å„ç§æŠ€æœ¯çš„ä¼˜ç¼ºç‚¹åŠå…¶é€‚ç”¨èƒŒæ™¯ï¼Œå¹¶é¢„æµ‹æ½œåœ¨çš„æœªæ¥å‘å±•ã€‚æˆ‘ä»¬çš„è´¡çŒ®å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘ä»¬å¯¹æœ€å…ˆè¿›çš„RAGè¿›è¡Œäº†å…¨é¢å’Œç³»ç»Ÿçš„å›é¡¾ï¼Œæè¿°äº†å…¶é€šè¿‡åŒ…æ‹¬æœ´ç´ RAGã€é«˜çº§RAGå’Œæ¨¡å—åŒ–RAGåœ¨å†…çš„èŒƒå¼çš„å‘å±•ã€‚è¿™ä¸ªå›é¡¾å°†RAGç ”ç©¶çš„æ›´å¹¿æ³›èŒƒå›´ç½®äºLLMsçš„æ™¯è§‚ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬ç¡®å®šå¹¶è®¨è®ºäº†RAGè¿‡ç¨‹ä¸­ä¸å¯æˆ–ç¼ºçš„æ ¸å¿ƒæŠ€æœ¯ï¼Œç‰¹åˆ«å…³æ³¨â€œæ£€ç´¢â€ã€â€œç”Ÿæˆå™¨â€å’Œâ€œå¢å¼ºâ€æ–¹é¢ï¼Œå¹¶æ·±å…¥æ¢è®¨å®ƒä»¬çš„ååŒä½œç”¨ï¼Œé˜æ˜è¿™äº›ç»„ä»¶å¦‚ä½•å¤æ‚åœ°åä½œå½¢æˆä¸€ä¸ªè¿è´¯æœ‰æ•ˆçš„RAGæ¡†æ¶ã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªå…¨é¢çš„RAGè¯„ä¼°æ¡†æ¶ï¼Œæ¦‚è¿°äº†è¯„ä¼°ç›®æ ‡å’ŒæŒ‡æ ‡ã€‚æˆ‘ä»¬çš„æ¯”è¾ƒåˆ†æä»å„ç§è§’åº¦æ¾„æ¸…äº†RAGä¸å¾®è°ƒç›¸æ¯”çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬é¢„æµ‹äº†RAGçš„æœªæ¥æ–¹å‘ï¼Œå¼ºè°ƒäº†è§£å†³å½“å‰æŒ‘æˆ˜ã€æ‰©å±•åˆ°å¤šæ¨¡æ€è®¾ç½®å’Œå…¶ç”Ÿæ€ç³»ç»Ÿå‘å±•çš„æ½œåœ¨å¢å¼ºã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ¬æ–‡çš„ç»“æ„å¦‚ä¸‹ï¼šç¬¬2å’Œ3èŠ‚å®šä¹‰äº†RAGå¹¶è¯¦ç»†æè¿°äº†å…¶å‘å±•è¿‡ç¨‹ã€‚ç¬¬4è‡³6èŠ‚æ¢è®¨äº†æ ¸å¿ƒç»„ä»¶â€”â€”æ£€ç´¢ã€â€œç”Ÿæˆâ€å’Œâ€œå¢å¼ºâ€â€”â€”çªå‡ºäº†åµŒå…¥çš„å„ç§æŠ€æœ¯ã€‚ç¬¬7èŠ‚ä¸“æ³¨äºRAGçš„è¯„ä¼°ç³»ç»Ÿã€‚ç¬¬8èŠ‚å°†RAGä¸å…¶ä»–LLMä¼˜åŒ–æ–¹æ³•è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶æå‡ºå…¶å‘å±•çš„æ½œåœ¨æ–¹å‘ã€‚æœ¬æ–‡åœ¨ç¬¬9èŠ‚ç»“æŸã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬2ç« å®šä¹‰&#34;&gt;ç¬¬2ç« ï¼šå®šä¹‰&lt;/h2&gt;
&lt;p&gt;RAGçš„å®šä¹‰å¯ä»¥ä»å…¶å·¥ä½œæµç¨‹ä¸­æ€»ç»“å‡ºæ¥ã€‚å›¾2å±•ç¤ºäº†ä¸€ä¸ªå…¸å‹çš„RAGåº”ç”¨å·¥ä½œæµç¨‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·è¯¢é—®ChatGPTå…³äºä¸€ä¸ªæœ€è¿‘å¼•èµ·å…¬ä¼—å¹¿æ³›è®¨è®ºçš„é«˜è°ƒäº‹ä»¶ï¼ˆå³OpenAIé¦–å¸­æ‰§è¡Œå®˜çš„çªç„¶è§£é›‡å’Œé‡æ–°ä»»å‘½ï¼‰ã€‚ä½œä¸ºæœ€è‘—åå’Œå¹¿æ³›ä½¿ç”¨çš„LLMï¼ŒChatGPTå—é™äºå…¶é¢„è®­ç»ƒæ•°æ®ï¼Œç¼ºä¹å¯¹æœ€è¿‘äº‹ä»¶çš„äº†è§£ã€‚RAGé€šè¿‡ä»å¤–éƒ¨çŸ¥è¯†åº“æ£€ç´¢æœ€æ–°çš„æ–‡æ¡£æ‘˜è¦æ¥è§£å†³è¿™ä¸€å·®è·ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒè·å–äº†ä¸æŸ¥è¯¢ç›¸å…³çš„æ–°é—»æ–‡ç« é€‰æ‹©ã€‚è¿™äº›æ–‡ç« ä»¥åŠåˆå§‹é—®é¢˜éšåè¢«åˆå¹¶åˆ°ä¸€ä¸ªä¸°å¯Œçš„æç¤ºä¸­ï¼Œä½¿ChatGPTèƒ½å¤Ÿåˆæˆä¸€ä¸ªçŸ¥æƒ…çš„å›åº”ã€‚è¿™ä¸ªä¾‹å­è¯´æ˜äº†RAGè¿‡ç¨‹ï¼Œå±•ç¤ºäº†å®ƒé€šè¿‡å®æ—¶ä¿¡æ¯æ£€ç´¢å¢å¼ºæ¨¡å‹å“åº”çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/rag/RAG_for_LLMs_A_Survey/2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;æŠ€æœ¯ä¸Šï¼ŒRAGé€šè¿‡å„ç§åˆ›æ–°æ–¹æ³•å¾—åˆ°ä¸°å¯Œï¼Œè§£å†³äº†å…³é”®é—®é¢˜ï¼Œå¦‚â€œæ£€ç´¢ä»€ä¹ˆâ€ã€â€œä½•æ—¶æ£€ç´¢â€å’Œâ€œå¦‚ä½•ä½¿ç”¨æ£€ç´¢åˆ°çš„ä¿¡æ¯â€ã€‚å¯¹äºâ€œæ£€ç´¢ä»€ä¹ˆâ€ï¼Œç ”ç©¶å·²ç»ä»ç®€å•çš„token[Khandelwalç­‰äººï¼Œ2019]å’Œå®ä½“æ£€ç´¢[Nishikawaç­‰äººï¼Œ2022]å‘å±•åˆ°æ›´å¤æ‚çš„ç»“æ„ï¼Œå¦‚å—[Ramç­‰äººï¼Œ2023]å’ŒçŸ¥è¯†å›¾è°±[Kangç­‰äººï¼Œ2023]ï¼Œç ”ç©¶é›†ä¸­åœ¨æ£€ç´¢ç²’åº¦å’Œæ•°æ®ç»“æ„æ°´å¹³ä¸Šã€‚ç²—ç²’åº¦å¸¦æ¥æ›´å¤šä¿¡æ¯ï¼Œä½†ç²¾åº¦è¾ƒä½ã€‚æ£€ç´¢ç»“æ„åŒ–æ–‡æœ¬æä¾›æ›´å¤šä¿¡æ¯ï¼Œä½†ç‰ºç‰²æ•ˆç‡ã€‚å…³äºâ€œä½•æ—¶æ£€ç´¢â€çš„é—®é¢˜å¯¼è‡´äº†ä»å•ä¸€[Wangç­‰äººï¼Œ2023e, Shiç­‰äººï¼Œ2023]åˆ°è‡ªé€‚åº”[Jiangç­‰äººï¼Œ2023b, Huangç­‰äººï¼Œ2023]å’Œå¤šæ¬¡æ£€ç´¢[Izacardç­‰äººï¼Œ2022]ç­–ç•¥ã€‚é«˜é¢‘ç‡çš„æ£€ç´¢å¸¦æ¥æ›´å¤šä¿¡æ¯å’Œæ›´ä½çš„æ•ˆç‡ã€‚è‡³äºâ€œå¦‚ä½•ä½¿ç”¨â€æ£€ç´¢åˆ°çš„æ•°æ®ï¼Œé›†æˆæŠ€æœ¯å·²ç»å¼€å‘åˆ°æ¨¡å‹æ¶æ„çš„å„ä¸ªå±‚æ¬¡ï¼ŒåŒ…æ‹¬è¾“å…¥[Khattabç­‰äººï¼Œ2022]ã€ä¸­é—´[Borgeaudç­‰äººï¼Œ2022]å’Œè¾“å‡ºå±‚[Liangç­‰äººï¼Œ2023]ã€‚å°½ç®¡â€œä¸­é—´â€å’Œâ€œè¾“å‡ºå±‚â€æ›´æœ‰æ•ˆï¼Œä½†å­˜åœ¨è®­ç»ƒéœ€æ±‚å’Œä½æ•ˆç‡çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;RAGæ˜¯ä¸€ç§é€šè¿‡æ•´åˆå¤–éƒ¨çŸ¥è¯†åº“æ¥å¢å¼ºLLMsçš„èŒƒå¼ã€‚å®ƒé‡‡ç”¨ååŒæ–¹æ³•ï¼Œç»“åˆä¿¡æ¯æ£€ç´¢æœºåˆ¶å’Œä¸Šä¸‹æ–‡å­¦ä¹ ï¼ˆIn-Context Learning, ICLï¼‰æ¥å¢å¼ºLLMçš„æ€§èƒ½ã€‚åœ¨è¿™ä¸ªæ¡†æ¶ä¸­ï¼Œç”¨æˆ·å‘èµ·çš„æŸ¥è¯¢é€šè¿‡æœç´¢ç®—æ³•æ£€ç´¢ç›¸å…³ä¿¡æ¯ã€‚ç„¶åå°†è¿™äº›ä¿¡æ¯ç¼–ç»‡åˆ°LLMçš„æç¤ºä¸­ï¼Œä¸ºç”Ÿæˆè¿‡ç¨‹æä¾›é¢å¤–çš„ä¸Šä¸‹æ–‡ã€‚RAGçš„å…³é”®ä¼˜åŠ¿åœ¨äºå®ƒæ¶ˆé™¤äº†ä¸ºç‰¹å®šä»»åŠ¡é‡æ–°è®­ç»ƒLLMsçš„éœ€è¦ã€‚å¼€å‘è€…å¯ä»¥æ·»åŠ ä¸€ä¸ªå¤–éƒ¨çŸ¥è¯†åº“ï¼Œä¸°å¯Œè¾“å…¥ï¼Œä»è€Œæé«˜æ¨¡å‹è¾“å‡ºçš„ç²¾ç¡®åº¦ã€‚RAGå·²ç»æˆä¸ºLLMsç³»ç»Ÿä¸­æœ€å—æ¬¢è¿çš„æ¶æ„ä¹‹ä¸€ï¼Œç”±äºå…¶é«˜å®ç”¨æ€§å’Œä½é—¨æ§›ï¼Œè®¸å¤šå¯¹è¯äº§å“å‡ ä¹å®Œå…¨å»ºç«‹åœ¨RAGä¹‹ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;RAGå·¥ä½œæµç¨‹åŒ…æ‹¬ä¸‰ä¸ªå…³é”®æ­¥éª¤ã€‚é¦–å…ˆï¼Œå°†è¯­æ–™åº“åˆ†å‰²æˆç¦»æ•£çš„å—ï¼Œç„¶åä½¿ç”¨ç¼–ç æ¨¡å‹æ„å»ºå‘é‡ç´¢å¼•ã€‚å…¶æ¬¡ï¼ŒRAGæ ¹æ®æŸ¥è¯¢å’Œç´¢å¼•å—çš„å‘é‡ç›¸ä¼¼æ€§è¯†åˆ«å’Œæ£€ç´¢å—ã€‚æœ€åï¼Œæ¨¡å‹æ ¹æ®ä»æ£€ç´¢åˆ°çš„å—ä¸­è·å¾—çš„ä¸Šä¸‹æ–‡ä¿¡æ¯åˆæˆå“åº”ã€‚è¿™äº›æ­¥éª¤æ„æˆäº†RAGè¿‡ç¨‹çš„åŸºç¡€æ¡†æ¶ï¼Œæ”¯æ’‘å…¶ä¿¡æ¯æ£€ç´¢å’Œä¸Šä¸‹æ–‡æ„ŸçŸ¥ç”Ÿæˆèƒ½åŠ›ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä»‹ç»RAGç ”ç©¶æ¡†æ¶ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬3ç« ragæ¡†æ¶&#34;&gt;ç¬¬3ç« ï¼šRAGæ¡†æ¶&lt;/h2&gt;
&lt;p&gt;RAGç ”ç©¶èŒƒå¼ä¸æ–­å‘å±•ï¼Œæœ¬èŠ‚ä¸»è¦æè¿°å…¶è¿›å±•ã€‚æˆ‘ä»¬å°†å…¶åˆ†ç±»ä¸ºä¸‰ç§ç±»å‹ï¼šNaive RAGã€Advanced RAGå’ŒModular RAGã€‚è™½ç„¶RAGå…·æœ‰æˆæœ¬æ•ˆç›Šå¹¶è¶…è¶Šäº†åŸç”ŸLLMçš„æ€§èƒ½ï¼Œä½†å®ƒä»¬ä¹Ÿè¡¨ç°å‡ºå‡ ä¸ªå±€é™æ€§ã€‚é«˜çº§RAGå’Œæ¨¡å—åŒ–RAGçš„å‘å±•æ˜¯ä¸ºäº†åº”å¯¹æœ´ç´ RAGä¸­çš„å…·ä½“ç¼ºç‚¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;31-æœ´ç´ ragnaive-rag&#34;&gt;3.1 æœ´ç´ RAG(&lt;strong&gt;Naive RAG&lt;/strong&gt;)&lt;/h3&gt;
&lt;p&gt;æœ´ç´ RAGç ”ç©¶èŒƒå¼ä»£è¡¨äº†æœ€æ—©çš„æ–¹æ³•ï¼Œå®ƒåœ¨ChatGPTå¹¿æ³›é‡‡ç”¨åä¸ä¹…è·å¾—äº†æ˜¾è‘—åœ°ä½ã€‚æœ´ç´ RAGéµå¾ªä¸€ä¸ªä¼ ç»Ÿçš„æµç¨‹ï¼ŒåŒ…æ‹¬ç´¢å¼•ã€æ£€ç´¢å’Œç”Ÿæˆã€‚å®ƒä¹Ÿè¢«ç§°ä¸ºâ€œæ£€ç´¢-é˜…è¯»â€æ¡†æ¶[Maç­‰äººï¼Œ2023a]ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ç´¢å¼•indexing&#34;&gt;ç´¢å¼•(&lt;strong&gt;Indexing&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;ç´¢å¼•è¿‡ç¨‹æ˜¯æ•°æ®å‡†å¤‡ä¸­çš„å…³é”®åˆå§‹æ­¥éª¤ï¼Œå®ƒåœ¨ç¦»çº¿æ—¶è¿›è¡Œï¼Œå¹¶æ¶‰åŠå‡ ä¸ªé˜¶æ®µã€‚å®ƒä»æ•°æ®ç´¢å¼•å¼€å§‹ï¼ŒåŸå§‹æ•°æ®è¢«æ¸…ç†å’Œæå–ï¼Œå„ç§æ–‡ä»¶æ ¼å¼ï¼ˆå¦‚PDFã€HTMLã€Wordå’ŒMarkdownï¼‰è¢«è½¬æ¢ä¸ºæ ‡å‡†åŒ–çš„çº¯æ–‡æœ¬ã€‚ä¸ºäº†é€‚åº”è¯­è¨€æ¨¡å‹çš„ä¸Šä¸‹æ–‡é™åˆ¶ï¼Œè¿™äº›æ–‡æœ¬éšåè¢«åˆ†å‰²æˆæ›´å°ã€æ›´æ˜“ç®¡ç†çš„å—ï¼Œè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºåˆ†å—ã€‚è¿™äº›å—éšåé€šè¿‡åµŒå…¥æ¨¡å‹è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºï¼Œè¯¥æ¨¡å‹åœ¨æ¨ç†æ•ˆç‡å’Œæ¨¡å‹å¤§å°ä¹‹é—´å–å¾—äº†å¹³è¡¡ã€‚è¿™ä¾¿äºåœ¨æ£€ç´¢é˜¶æ®µè¿›è¡Œç›¸ä¼¼æ€§æ¯”è¾ƒã€‚æœ€åï¼Œåˆ›å»ºä¸€ä¸ªç´¢å¼•æ¥å­˜å‚¨è¿™äº›æ–‡æœ¬å—åŠå…¶å‘é‡åµŒå…¥ä½œä¸ºé”®å€¼å¯¹ï¼Œå…è®¸é«˜æ•ˆå’Œå¯æ‰©å±•çš„æœç´¢èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ£€ç´¢retrieval&#34;&gt;æ£€ç´¢(&lt;strong&gt;Retrieval&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;åœ¨æ”¶åˆ°ç”¨æˆ·æŸ¥è¯¢åï¼Œç³»ç»Ÿä½¿ç”¨ä¸ç´¢å¼•é˜¶æ®µç›¸åŒçš„ç¼–ç æ¨¡å‹å°†è¾“å…¥è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºã€‚ç„¶åï¼Œå®ƒè®¡ç®—æŸ¥è¯¢å‘é‡ä¸ç´¢å¼•è¯­æ–™åº“ä¸­å‘é‡åŒ–å—ä¹‹é—´çš„ç›¸ä¼¼åº¦åˆ†æ•°ã€‚ç³»ç»Ÿä¼˜å…ˆæ£€ç´¢ä¸æŸ¥è¯¢æœ€ç›¸ä¼¼çš„å‰Kä¸ªå—ã€‚è¿™äº›å—éšåè¢«ç”¨ä½œè§£å†³ç”¨æˆ·è¯·æ±‚çš„æ‰©å±•ä¸Šä¸‹æ–‡åŸºç¡€ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ç”Ÿæˆgeneration&#34;&gt;ç”Ÿæˆ(&lt;strong&gt;Generation&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;æå‡ºçš„æŸ¥è¯¢å’Œé€‰å®šçš„æ–‡æ¡£è¢«åˆæˆä¸ºä¸€ä¸ªè¿è´¯çš„æç¤ºï¼Œå¤§å‹è¯­è¨€æ¨¡å‹è¢«è¦æ±‚åˆ¶å®šä¸€ä¸ªå›åº”ã€‚æ¨¡å‹å›ç­”é—®é¢˜çš„æ–¹æ³•å¯èƒ½å› ä»»åŠ¡ç‰¹å®šæ ‡å‡†è€Œæœ‰æ‰€ä¸åŒï¼Œå…è®¸å®ƒè¦ä¹ˆåˆ©ç”¨å…¶å›ºæœ‰çš„å‚æ•°çŸ¥è¯†ï¼Œè¦ä¹ˆå°†å…¶å“åº”é™åˆ¶åœ¨æä¾›çš„æ–‡æ¡£æ‰€åŒ…å«çš„ä¿¡æ¯ä¹‹å†…ã€‚åœ¨æŒç»­å¯¹è¯çš„æƒ…å†µä¸‹ï¼Œä»»ä½•ç°æœ‰çš„å¯¹è¯å†å²éƒ½å¯ä»¥é›†æˆåˆ°æç¤ºä¸­ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿæœ‰æ•ˆåœ°è¿›è¡Œå¤šè½®å¯¹è¯äº’åŠ¨ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æœ´ç´ ragçš„ç¼ºé™·&#34;&gt;æœ´ç´ RAGçš„ç¼ºé™·&lt;/h4&gt;
&lt;p&gt;æœ´ç´ RAGåœ¨ä¸‰ä¸ªå…³é”®é¢†åŸŸé¢ä¸´é‡å¤§æŒ‘æˆ˜ï¼šâ€œæ£€ç´¢â€ã€â€œç”Ÿæˆâ€å’Œâ€œå¢å¼ºâ€ã€‚æ£€ç´¢è´¨é‡æå‡ºäº†å¤šæ ·åŒ–çš„æŒ‘æˆ˜ï¼ŒåŒ…æ‹¬ä½ç²¾åº¦ï¼Œå¯¼è‡´æ£€ç´¢åˆ°çš„å—ä¸æŸ¥è¯¢ä¸ä¸€è‡´ï¼Œå¯èƒ½äº§ç”Ÿå¹»è§‰æˆ–ä¸­é€”æ¶ˆå¤±çš„é—®é¢˜ã€‚ä½å¬å›ç‡ä¹Ÿä¼šå‡ºç°ï¼Œå¯¼è‡´æœªèƒ½æ£€ç´¢åˆ°æ‰€æœ‰ç›¸å…³å—ï¼Œä»è€Œé˜»ç¢LLMsåˆ¶å®šå…¨é¢å“åº”ã€‚è¿‡æ—¶çš„ä¿¡æ¯è¿›ä¸€æ­¥åŠ å‰§äº†é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´ä¸å‡†ç¡®çš„æ£€ç´¢ç»“æœã€‚å“åº”ç”Ÿæˆè´¨é‡æå‡ºäº†å¹»è§‰æŒ‘æˆ˜ï¼Œæ¨¡å‹ç”Ÿæˆçš„ç­”æ¡ˆæ²¡æœ‰åŸºäºæä¾›çš„ä¸Šä¸‹æ–‡ï¼Œä»¥åŠæ¨¡å‹è¾“å‡ºä¸­çš„ä¸ç›¸å…³ä¸Šä¸‹æ–‡å’Œæ½œåœ¨çš„æœ‰å®³æˆ–åè§é—®é¢˜ã€‚å¢å¼ºè¿‡ç¨‹åœ¨å°†æ£€ç´¢åˆ°çš„æ®µè½ä¸Šä¸‹æ–‡ä¸å½“å‰ç”Ÿæˆä»»åŠ¡æœ‰æ•ˆæ•´åˆæ–¹é¢ä¹Ÿé¢ä¸´æŒ‘æˆ˜ï¼Œå¯èƒ½å¯¼è‡´ä¸è¿è´¯æˆ–ä¸ä¸€è‡´çš„è¾“å‡ºã€‚å†—ä½™å’Œé‡å¤ä¹Ÿæ˜¯é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å½“å¤šä¸ªæ£€ç´¢åˆ°çš„æ®µè½åŒ…å«ç›¸ä¼¼ä¿¡æ¯æ—¶ï¼Œä¼šå¯¼è‡´ç”Ÿæˆå“åº”ä¸­çš„é‡å¤å†…å®¹ã€‚è¾¨åˆ«å¤šä¸ªæ£€ç´¢åˆ°çš„æ®µè½å¯¹ç”Ÿæˆä»»åŠ¡çš„é‡è¦æ€§å’Œç›¸å…³æ€§æ˜¯å¦ä¸€ä¸ªæŒ‘æˆ˜ï¼Œéœ€è¦é€‚å½“å¹³è¡¡æ¯ä¸ªæ®µè½çš„ä»·å€¼ã€‚æ­¤å¤–ï¼Œè°ƒå’Œä¸åŒå†™ä½œé£æ ¼å’Œè¯­è°ƒçš„å·®å¼‚ä»¥ç¡®ä¿è¾“å‡ºçš„ä¸€è‡´æ€§è‡³å…³é‡è¦ã€‚æœ€åï¼Œç”Ÿæˆæ¨¡å‹è¿‡åº¦ä¾èµ–å¢å¼ºä¿¡æ¯çš„é£é™©ï¼Œå¯èƒ½å¯¼è‡´è¾“å‡ºä»…é‡å¤æ£€ç´¢åˆ°çš„å†…å®¹ï¼Œè€Œæ²¡æœ‰æä¾›æ–°çš„ä»·å€¼æˆ–ç»¼åˆä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;32-é«˜çº§rag-advanced-rag&#34;&gt;3.2 é«˜çº§RAG( &lt;strong&gt;Advanced RAG&lt;/strong&gt;)&lt;/h3&gt;
&lt;p&gt;é«˜çº§RAGæ˜¯ä¸ºäº†é’ˆå¯¹æ€§åœ°å¢å¼ºæœ´ç´ RAGçš„ä¸è¶³è€Œå¼€å‘çš„ã€‚åœ¨æ£€ç´¢è´¨é‡æ–¹é¢ï¼Œé«˜çº§RAGå®æ–½äº†é¢„æ£€ç´¢å’Œåæ£€ç´¢ç­–ç•¥ã€‚ä¸ºäº†åº”å¯¹æœ´ç´ RAGåœ¨ç´¢å¼•æ–¹é¢çš„æŒ‘æˆ˜ï¼Œé«˜çº§RAGé€šè¿‡ä½¿ç”¨æ»‘åŠ¨çª—å£ã€ç»†ç²’åº¦åˆ†å‰²å’Œå…ƒæ•°æ®ç­‰æŠ€æœ¯æ”¹è¿›äº†å…¶ç´¢å¼•æ–¹æ³•ã€‚å®ƒè¿˜å¼•å…¥äº†å„ç§æ–¹æ³•æ¥ä¼˜åŒ–æ£€ç´¢è¿‡ç¨‹[ILIN, 2023]ã€‚&lt;/p&gt;
&lt;h4 id=&#34;é¢„æ£€ç´¢è¿‡ç¨‹pre-retrieval-process&#34;&gt;é¢„æ£€ç´¢è¿‡ç¨‹(&lt;strong&gt;Pre-Retrieval Process&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;ä¼˜åŒ–æ•°æ®ç´¢å¼•&lt;/strong&gt;(&lt;em&gt;Optimizing Data Indexing&lt;/em&gt;)ã€‚ä¼˜åŒ–æ•°æ®ç´¢å¼•çš„ç›®æ ‡æ˜¯æé«˜è¢«ç´¢å¼•å†…å®¹çš„è´¨é‡ã€‚è¿™æ¶‰åŠäº”ä¸ªä¸»è¦ç­–ç•¥ï¼šå¢å¼ºæ•°æ®ç²’åº¦(enhancing data granularity)ã€ä¼˜åŒ–ç´¢å¼•ç»“æ„(optimizing index structures)ã€æ·»åŠ å…ƒæ•°æ®(adding metadata)ã€å¯¹é½ä¼˜åŒ–(alignment optimization)å’Œæ··åˆæ£€ç´¢(mixed retrieval)ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¢å¼ºæ•°æ®ç²’åº¦æ—¨åœ¨æé«˜æ–‡æœ¬æ ‡å‡†åŒ–ã€ä¸€è‡´æ€§ã€äº‹å®å‡†ç¡®æ€§å’Œä¸°å¯Œä¸Šä¸‹æ–‡ï¼Œä»¥æé«˜RAGç³»ç»Ÿçš„æ€§èƒ½ã€‚è¿™åŒ…æ‹¬å»é™¤æ— å…³ä¿¡æ¯ã€æ¶ˆé™¤å®ä½“å’Œæœ¯è¯­çš„æ­§ä¹‰ã€ç¡®è®¤äº‹å®å‡†ç¡®æ€§ã€ä¿æŒä¸Šä¸‹æ–‡å’Œæ›´æ–°è¿‡æ—¶æ–‡æ¡£ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¼˜åŒ–ç´¢å¼•ç»“æ„æ¶‰åŠè°ƒæ•´å—çš„å¤§å°ä»¥æ•è·ç›¸å…³ä¸Šä¸‹æ–‡ï¼Œè·¨å¤šä¸ªç´¢å¼•è·¯å¾„æŸ¥è¯¢ï¼Œå¹¶åˆ©ç”¨å›¾æ•°æ®ç´¢å¼•ä¸­çš„èŠ‚ç‚¹å…³ç³»æ¥æ•è·ç›¸å…³ä¸Šä¸‹æ–‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ·»åŠ å…ƒæ•°æ®ä¿¡æ¯æ¶‰åŠå°†å¼•ç”¨çš„å…ƒæ•°æ®ï¼ˆå¦‚æ—¥æœŸå’Œç›®çš„ï¼‰é›†æˆåˆ°å—ä¸­ä»¥è¿›è¡Œè¿‡æ»¤ï¼Œå¹¶ç»“åˆå…ƒæ•°æ®ï¼ˆå¦‚å‚è€ƒç« èŠ‚å’Œå°èŠ‚ï¼‰ä»¥æé«˜æ£€ç´¢æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¯¹é½ä¼˜åŒ–é€šè¿‡åœ¨æ–‡æ¡£ä¸­å¼•å…¥â€œå‡è®¾æ€§é—®é¢˜â€[Liç­‰äººï¼Œ2023d]æ¥è§£å†³æ–‡æ¡£ä¹‹é—´çš„å¯¹é½é—®é¢˜å’Œå·®å¼‚ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;æ£€ç´¢retrieval-1&#34;&gt;æ£€ç´¢(&lt;strong&gt;Retrieval&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;åœ¨æ£€ç´¢é˜¶æ®µï¼Œä¸»è¦å…³æ³¨çš„æ˜¯è®¡ç®—æŸ¥è¯¢å’Œå—ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œä»¥è¯†åˆ«é€‚å½“çš„ä¸Šä¸‹æ–‡ã€‚åµŒå…¥æ¨¡å‹åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­èµ·ç€æ ¸å¿ƒä½œç”¨ã€‚åœ¨é«˜çº§RAGä¸­ï¼ŒåµŒå…¥æ¨¡å‹çš„ä¼˜åŒ–æ˜¯å¯èƒ½çš„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¾®è°ƒåµŒå…¥&lt;/strong&gt;(&lt;em&gt;Fine-tuning Embedding&lt;/em&gt;)ã€‚å¾®è°ƒåµŒå…¥æ¨¡å‹æ˜¾è‘—å½±å“RAGç³»ç»Ÿä¸­æ£€ç´¢å†…å®¹çš„ç›¸å…³æ€§ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠå®šåˆ¶åµŒå…¥æ¨¡å‹ä»¥å¢å¼ºç‰¹å®šé¢†åŸŸèƒŒæ™¯ä¸‹çš„æ£€ç´¢ç›¸å…³æ€§ï¼Œç‰¹åˆ«æ˜¯å¯¹äºæ¶‰åŠä¸æ–­å‘å±•æˆ–ç½•è§æœ¯è¯­çš„ä¸“ä¸šé¢†åŸŸã€‚BGEåµŒå…¥æ¨¡å‹[BAAI, 2023]ï¼Œå¦‚BAAIå¼€å‘çš„BGE-large-EN&lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;ï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½åµŒå…¥æ¨¡å‹ï¼Œå¯ä»¥å¾®è°ƒä»¥ä¼˜åŒ–æ£€ç´¢ç›¸å…³æ€§ã€‚å¾®è°ƒçš„è®­ç»ƒæ•°æ®å¯ä»¥ä½¿ç”¨åƒGPT-3.5-turboè¿™æ ·çš„è¯­è¨€æ¨¡å‹ç”Ÿæˆï¼Œä»¥åˆ¶å®šåŸºäºæ–‡æ¡£å—çš„é—®é¢˜ï¼Œç„¶åç”¨ä½œå¾®è°ƒå¯¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åŠ¨æ€åµŒå…¥&lt;/strong&gt;(&lt;em&gt;Dynamic Embedding&lt;/em&gt;)é€‚åº”å•è¯ä½¿ç”¨çš„ä¸Šä¸‹æ–‡ï¼Œä¸é™æ€åµŒå…¥ä¸åŒï¼Œé™æ€åµŒå…¥ä¸ºæ¯ä¸ªå•è¯ä½¿ç”¨å•ä¸€å‘é‡[Karpukhinç­‰äººï¼Œ2020]ã€‚ä¾‹å¦‚ï¼Œåœ¨åƒBERTè¿™æ ·çš„å˜æ¢å™¨æ¨¡å‹ä¸­ï¼ŒåŒä¸€ä¸ªå•è¯å¯ä»¥æ ¹æ®å‘¨å›´çš„å•è¯æœ‰ä¸åŒçš„åµŒå…¥ã€‚OpenAIçš„embeddings-ada-02æ¨¡å‹&lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;ï¼ŒåŸºäºåƒGPTè¿™æ ·çš„LLMsçš„åŸåˆ™ï¼Œæ˜¯ä¸€ä¸ªå¤æ‚çš„åŠ¨æ€åµŒå…¥æ¨¡å‹ï¼Œèƒ½å¤Ÿæ•æ‰ä¸Šä¸‹æ–‡ç†è§£ã€‚ç„¶è€Œï¼Œå®ƒå¯èƒ½æ²¡æœ‰æœ€æ–°çš„å…¨å°ºå¯¸è¯­è¨€æ¨¡å‹ï¼ˆå¦‚GPT-4ï¼‰å¯¹ä¸Šä¸‹æ–‡çš„æ•æ„Ÿæ€§ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åæ£€ç´¢è¿‡ç¨‹post-retrieval-process&#34;&gt;åæ£€ç´¢è¿‡ç¨‹(&lt;strong&gt;Post-Retrieval Process&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;åœ¨ä»æ•°æ®åº“æ£€ç´¢åˆ°æœ‰ä»·å€¼çš„ä¸Šä¸‹æ–‡åï¼Œå°†å…¶ä¸æŸ¥è¯¢åˆå¹¶ä¸ºLLMsçš„è¾“å…¥ï¼ŒåŒæ—¶è§£å†³ä¸Šä¸‹æ–‡çª—å£é™åˆ¶å¸¦æ¥çš„æŒ‘æˆ˜ï¼Œè¿™æ˜¯è‡³å…³é‡è¦çš„ã€‚ç®€å•åœ°ä¸€æ¬¡æ€§å‘LLMså‘ˆç°æ‰€æœ‰ç›¸å…³æ–‡æ¡£å¯èƒ½ä¼šè¶…è¿‡ä¸Šä¸‹æ–‡çª—å£é™åˆ¶ï¼Œå¼•å…¥å™ªå£°ï¼Œå¹¶é˜»ç¢å¯¹å…³é”®ä¿¡æ¯çš„å…³æ³¨ã€‚å¯¹æ£€ç´¢åˆ°çš„å†…å®¹è¿›è¡Œé¢å¤–å¤„ç†æ˜¯å¿…è¦çš„ï¼Œä»¥è§£å†³è¿™äº›é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é‡æ–°æ’å&lt;/strong&gt;(&lt;em&gt;Re-Ranking&lt;/em&gt;)ã€‚å°†æ£€ç´¢åˆ°çš„ä¿¡æ¯é‡æ–°æ’åï¼Œå°†æœ€ç›¸å…³çš„å†…å®¹é‡æ–°å®šä½åˆ°æç¤ºçš„è¾¹ç¼˜ï¼Œæ˜¯ä¸€ä¸ªå…³é”®ç­–ç•¥ã€‚è¿™ä¸ªæ¦‚å¿µå·²ç»åœ¨LlamaIndex&lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;ã€LangChain&lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;å’ŒHayStack[Blagojevi, 2023]ç­‰æ¡†æ¶ä¸­å®æ–½ã€‚ä¾‹å¦‚ï¼ŒDiversity Ranker&lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt;æ ¹æ®æ–‡æ¡£å¤šæ ·æ€§ä¼˜å…ˆé‡æ–°æ’åºï¼Œè€ŒLostInTheMiddleRankeråœ¨ä¸Šä¸‹æ–‡çª—å£çš„å¼€å¤´å’Œç»“å°¾äº¤æ›¿æ”¾ç½®æœ€ä½³æ–‡æ¡£ã€‚æ­¤å¤–ï¼ŒåƒcohereAI rerank[Cohere, 2023]ã€bge-rerank&lt;sup id=&#34;fnref:7&#34;&gt;&lt;a href=&#34;#fn:7&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;7&lt;/a&gt;&lt;/sup&gt;å’ŒLongLLMLingua[Jiangç­‰äººï¼Œ2023a]è¿™æ ·çš„æ–¹æ³•é‡æ–°è®¡ç®—ç›¸å…³æ–‡æœ¬å’ŒæŸ¥è¯¢ä¹‹é—´çš„è¯­ä¹‰ç›¸ä¼¼åº¦ï¼Œè§£å†³äº†è§£é‡ŠåŸºäºå‘é‡çš„æ¨¡æ‹Ÿæœç´¢çš„è¯­ä¹‰ç›¸ä¼¼åº¦çš„æŒ‘æˆ˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æç¤ºå‹ç¼©&lt;/strong&gt;(&lt;em&gt;Prompt Compression&lt;/em&gt;)ã€‚ç ”ç©¶è¡¨æ˜ï¼Œæ£€ç´¢æ–‡æ¡£ä¸­çš„å™ªå£°å¯¹RAGæ€§èƒ½äº§ç”Ÿä¸åˆ©å½±å“ã€‚åœ¨åå¤„ç†ä¸­ï¼Œé‡ç‚¹æ˜¯å‹ç¼©ä¸ç›¸å…³çš„ä¸Šä¸‹æ–‡ï¼Œçªå‡ºå…³é”®æ®µè½ï¼Œå¹¶å‡å°‘æ•´ä½“ä¸Šä¸‹æ–‡é•¿åº¦ã€‚åƒSelective Contextå’ŒLLMLingua[Litmanç­‰äººï¼Œ2020, Andersonç­‰äººï¼Œ2022]è¿™æ ·çš„æ–¹æ³•åˆ©ç”¨å°å‹è¯­è¨€æ¨¡å‹è®¡ç®—æç¤ºäº’ä¿¡æ¯æˆ–å›°æƒ‘åº¦ï¼Œä¼°è®¡å…ƒç´ é‡è¦æ€§ã€‚Recomp[Xuç­‰äººï¼Œ2023a]é€šè¿‡åœ¨ä¸åŒç²’åº¦ä¸Šè®­ç»ƒå‹ç¼©å™¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè€ŒLong Context[Xuç­‰äººï¼Œ2023b]å’Œâ€œWalking in the Memory Mazeâ€[Chenç­‰äººï¼Œ2023a]è®¾è®¡äº†æ€»ç»“æŠ€æœ¯ï¼Œä»¥å¢å¼ºLLMçš„å…³é”®ä¿¡æ¯æ„ŸçŸ¥ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¹¿æ³›ä¸Šä¸‹æ–‡æ—¶ã€‚&lt;/p&gt;
&lt;h3 id=&#34;33-æ¨¡å—åŒ–ragmodular-rag&#34;&gt;3.3 æ¨¡å—åŒ–RAG(&lt;strong&gt;Modular RAG&lt;/strong&gt;)&lt;/h3&gt;
&lt;p&gt;æ¨¡å—åŒ–RAGç»“æ„ä¸ä¼ ç»Ÿçš„æœ´ç´ RAGæ¡†æ¶ä¸åŒï¼Œæä¾›äº†æ›´å¤§çš„çµæ´»æ€§å’Œçµæ´»æ€§ã€‚å®ƒæ•´åˆäº†å„ç§æ–¹æ³•æ¥å¢å¼ºåŠŸèƒ½æ¨¡å—ï¼Œä¾‹å¦‚ç»“åˆæœç´¢æ¨¡å—è¿›è¡Œç›¸ä¼¼æ€§æ£€ç´¢ï¼Œå¹¶åœ¨æ£€ç´¢å™¨ä¸­åº”ç”¨å¾®è°ƒæ–¹æ³•[Linç­‰äººï¼Œ2023]ã€‚é‡ç»„çš„RAGæ¨¡å—[Yuç­‰äººï¼Œ2022]å’Œè¿­ä»£æ–¹æ³•[Shaoç­‰äººï¼Œ2023]å·²ç»è¢«å¼€å‘å‡ºæ¥ä»¥è§£å†³ç‰¹å®šé—®é¢˜ã€‚æ¨¡å—åŒ–RAGèŒƒå¼åœ¨RAGé¢†åŸŸè¶Šæ¥è¶Šæˆä¸ºå¸¸æ€ï¼Œå…è®¸åœ¨å¤šä¸ªæ¨¡å—ä¹‹é—´è¿›è¡Œä¸²è¡Œç®¡é“æˆ–ç«¯åˆ°ç«¯è®­ç»ƒã€‚ä¸‰ç§RAGèŒƒå¼çš„æ¯”è¾ƒå¦‚å›¾3æ‰€ç¤ºã€‚ç„¶è€Œï¼Œæ¨¡å—åŒ–RAGå¹¶éç‹¬ç«‹å­˜åœ¨ã€‚é«˜çº§RAGæ˜¯æ¨¡å—åŒ–RAGçš„ä¸€ç§ä¸“é—¨å½¢å¼ï¼Œè€Œè¿›ä¸€æ­¥åœ°ï¼Œæœ´ç´ RAGæœ¬èº«æ˜¯é«˜çº§RAGçš„ä¸€ä¸ªç‰¹æ®Šæƒ…å†µã€‚è¿™ä¸‰ç§èŒƒå¼ä¹‹é—´çš„å…³ç³»æ˜¯ç»§æ‰¿å’Œå‘å±•çš„å…³ç³»ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/rag/RAG_for_LLMs_A_Survey/3.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;æ–°æ¨¡å—new-modules&#34;&gt;æ–°æ¨¡å—(&lt;strong&gt;New Modules&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;æœç´¢æ¨¡å—&lt;/strong&gt;(&lt;em&gt;Search Module&lt;/em&gt;)ã€‚ä¸æœ´ç´ /é«˜çº§RAGä¸­çš„ç›¸ä¼¼æ€§æ£€ç´¢ä¸åŒï¼Œæœç´¢æ¨¡å—é’ˆå¯¹ç‰¹å®šåœºæ™¯è¿›è¡Œå®šåˆ¶ï¼Œå¹¶ç»“åˆç›´æ¥åœ¨é¢å¤–çš„è¯­æ–™åº“ä¸Šè¿›è¡Œæœç´¢ã€‚è¿™ç§æ•´åˆæ˜¯é€šè¿‡LLMç”Ÿæˆçš„ä»£ç ã€SQLæˆ–Cypherç­‰æŸ¥è¯¢è¯­è¨€ä»¥åŠå…¶ä»–è‡ªå®šä¹‰å·¥å…·å®ç°çš„ã€‚è¿™äº›æœç´¢çš„æ•°æ®æºå¯ä»¥åŒ…æ‹¬æœç´¢å¼•æ“ã€æ–‡æœ¬æ•°æ®ã€è¡¨æ ¼æ•°æ®å’ŒçŸ¥è¯†å›¾è°±[Wangç­‰äººï¼Œ2023d]ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è®°å¿†æ¨¡å—&lt;/strong&gt;(&lt;em&gt;Memory Module&lt;/em&gt;)ã€‚è¿™ä¸ªæ¨¡å—åˆ©ç”¨LLMçš„è®°å¿†èƒ½åŠ›æ¥æŒ‡å¯¼æ£€ç´¢ã€‚è¯¥æ–¹æ³•æ¶‰åŠè¯†åˆ«ä¸å½“å‰è¾“å…¥æœ€ç›¸ä¼¼çš„è®°å¿†ã€‚Selfmem[Chengç­‰äººï¼Œ2023b]åˆ©ç”¨æ£€ç´¢å¢å¼ºçš„ç”Ÿæˆå™¨è¿­ä»£åœ°åˆ›å»ºä¸€ä¸ªæ— ç•Œè®°å¿†æ± ï¼Œç»“åˆâ€œåŸå§‹é—®é¢˜â€å’Œâ€œåŒé‡é—®é¢˜â€ã€‚é€šè¿‡ä½¿ç”¨æ£€ç´¢å¢å¼ºçš„ç”Ÿæˆæ¨¡å‹ï¼Œè¯¥æ¨¡å‹ä½¿ç”¨è‡ªå·±çš„è¾“å‡ºæ¥æ”¹è¿›è‡ªå·±ï¼Œæ–‡æœ¬åœ¨æ¨ç†è¿‡ç¨‹ä¸­ä¸æ•°æ®åˆ†å¸ƒæ›´åŠ ä¸€è‡´ã€‚å› æ­¤ï¼Œæ¨¡å‹çš„è¾“å‡ºè¢«ç”¨æ¥ä»£æ›¿è®­ç»ƒæ•°æ®[Wangç­‰äººï¼Œ2022a]ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;èåˆ&lt;/strong&gt;(&lt;em&gt;Fusion&lt;/em&gt;)ã€‚RAG-Fusion[Raudaschlï¼Œ2023]é€šè¿‡å¤šæŸ¥è¯¢æ–¹æ³•å¢å¼ºäº†ä¼ ç»Ÿæœç´¢ç³»ç»Ÿï¼Œè¯¥æ–¹æ³•å°†ç”¨æˆ·æŸ¥è¯¢æ‰©å±•åˆ°å¤šä¸ªä¸åŒçš„è§†è§’ï¼Œä½¿ç”¨LLMã€‚è¿™ç§æ–¹æ³•ä¸ä»…æ•è·ç”¨æˆ·å¯»æ±‚çš„æ˜¾å¼ä¿¡æ¯ï¼Œè¿˜æ­ç¤ºäº†æ›´æ·±å±‚æ¬¡çš„ã€å˜é©æ€§çš„çŸ¥è¯†ã€‚èåˆè¿‡ç¨‹æ¶‰åŠåŸå§‹æŸ¥è¯¢å’Œæ‰©å±•æŸ¥è¯¢çš„å¹¶è¡Œå‘é‡æœç´¢ï¼Œæ™ºèƒ½é‡æ–°æ’åä»¥ä¼˜åŒ–ç»“æœï¼Œå¹¶å°†æœ€ä½³ç»“æœä¸æ–°æŸ¥è¯¢é…å¯¹ã€‚è¿™ç§å¤æ‚æ–¹æ³•ç¡®ä¿æœç´¢ç»“æœä¸ç”¨æˆ·çš„æ˜¾å¼å’Œéšå¼æ„å›¾ç´§å¯†å¯¹é½ï¼Œä»è€Œå‘ç°æ›´æœ‰æ´å¯ŸåŠ›å’Œç›¸å…³çš„ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è·¯ç”±&lt;/strong&gt;(&lt;em&gt;Routing&lt;/em&gt;)ã€‚RAGç³»ç»Ÿçš„æ£€ç´¢è¿‡ç¨‹åˆ©ç”¨äº†ä¸åŒé¢†åŸŸã€è¯­è¨€å’Œæ ¼å¼çš„å¤šæ ·åŒ–æ¥æºï¼Œè¿™äº›æ¥æºå¯ä»¥æ ¹æ®æƒ…å†µäº¤æ›¿æˆ–åˆå¹¶[Liç­‰äººï¼Œ2023b]ã€‚æŸ¥è¯¢è·¯ç”±å™¨å†³å®šç”¨æˆ·æŸ¥è¯¢çš„åç»­æ“ä½œï¼Œé€‰é¡¹åŒ…æ‹¬æ‘˜è¦ã€æœç´¢ç‰¹å®šæ•°æ®åº“æˆ–å°†ä¸åŒè·¯å¾„åˆå¹¶ä¸ºå•ä¸ªå“åº”ã€‚æŸ¥è¯¢è·¯ç”±å™¨è¿˜é€‰æ‹©é€‚å½“çš„æ•°æ®å­˜å‚¨ç”¨äºæŸ¥è¯¢ï¼Œå¯èƒ½åŒ…æ‹¬å„ç§æ¥æºï¼Œå¦‚å‘é‡å­˜å‚¨ã€å›¾æ•°æ®åº“æˆ–å…³ç³»æ•°æ®åº“ï¼Œæˆ–ç´¢å¼•çš„å±‚æ¬¡ç»“æ„â€”â€”ä¾‹å¦‚ï¼Œç”¨äºå¤šæ–‡æ¡£å­˜å‚¨çš„æ‘˜è¦ç´¢å¼•å’Œæ–‡æ¡£å—å‘é‡ç´¢å¼•ã€‚æŸ¥è¯¢è·¯ç”±å™¨çš„å†³ç­–æ˜¯é¢„å…ˆå®šä¹‰çš„ï¼Œå¹¶é€šè¿‡LLMsè°ƒç”¨æ‰§è¡Œï¼Œå°†æŸ¥è¯¢å®šå‘åˆ°æ‰€é€‰ç´¢å¼•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é¢„æµ‹&lt;/strong&gt;(&lt;em&gt;Predict&lt;/em&gt;)ã€‚å®ƒè§£å†³äº†æ£€ç´¢å†…å®¹ä¸­çš„å†—ä½™å’Œå™ªå£°é—®é¢˜ã€‚ä¸ç›´æ¥ä»æ•°æ®æºæ£€ç´¢ä¸åŒï¼Œè¿™ä¸ªæ¨¡å—ä½¿ç”¨LLMç”Ÿæˆå¿…è¦çš„ä¸Šä¸‹æ–‡[Yuç­‰äººï¼Œ2022]ã€‚LLMç”Ÿæˆçš„å†…å®¹æ›´æœ‰å¯èƒ½åŒ…å«ç›¸å…³ä¿¡æ¯ï¼Œè€Œä¸æ˜¯é€šè¿‡ç›´æ¥æ£€ç´¢è·å¾—çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä»»åŠ¡é€‚é…å™¨&lt;/strong&gt;(&lt;em&gt;Task Adapter&lt;/em&gt;)ã€‚è¿™ä¸ªæ¨¡å—ä¸“æ³¨äºå°†RAGé€‚åº”äºå„ç§ä¸‹æ¸¸ä»»åŠ¡ã€‚UPRISEè‡ªåŠ¨åŒ–äº†ä»é¢„æ„å»ºçš„æ•°æ®æ± ä¸­æ£€ç´¢é›¶æ¬¡ä»»åŠ¡è¾“å…¥çš„æç¤ºï¼Œä»è€Œæé«˜äº†è·¨ä»»åŠ¡å’Œæ¨¡å‹çš„é€šç”¨æ€§[Chengç­‰äººï¼Œ2023a]ã€‚åŒæ—¶ï¼ŒPROMPTAGATOR[Daiç­‰äººï¼Œ2022]åˆ©ç”¨LLMä½œä¸ºå°‘æ¬¡æŸ¥è¯¢ç”Ÿæˆå™¨ï¼Œå¹¶æ ¹æ®ç”Ÿæˆçš„æ•°æ®åˆ›å»ºç‰¹å®šä»»åŠ¡çš„æ£€ç´¢å™¨ã€‚é€šè¿‡åˆ©ç”¨LLMçš„æ³›åŒ–èƒ½åŠ›ï¼Œå®ƒä½¿å¾—å¼€å‘å…·æœ‰æœ€å°ç¤ºä¾‹çš„ç‰¹å®šä»»åŠ¡ç«¯åˆ°ç«¯æ£€ç´¢å™¨æˆä¸ºå¯èƒ½ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ–°æ¨¡å¼new-patterns&#34;&gt;æ–°æ¨¡å¼(New Patterns)&lt;/h4&gt;
&lt;p&gt;æ¨¡å—åŒ–RAGçš„ç»„ç»‡ç»“æ„é«˜åº¦é€‚åº”æ€§ï¼Œå…è®¸åœ¨RAGè¿‡ç¨‹ä¸­æ›¿æ¢æˆ–é‡æ–°æ’åˆ—æ¨¡å—ä»¥é€‚åº”ç‰¹å®šçš„é—®é¢˜èƒŒæ™¯ã€‚&lt;/p&gt;
&lt;p&gt;æœ´ç´ RAGå’Œé«˜çº§RAGéƒ½å¯ä»¥è¢«è§†ä¸ºç”±ä¸€äº›å›ºå®šæ¨¡å—ç»„æˆã€‚å¦‚å›¾3æ‰€ç¤ºï¼Œæœ´ç´ RAGä¸»è¦ç”±â€œæ£€ç´¢â€å’Œâ€œé˜…è¯»â€æ¨¡å—ç»„æˆã€‚é«˜çº§RAGçš„å…¸å‹æ¨¡å¼åœ¨æœ´ç´ RAGçš„åŸºç¡€ä¸Šå¢åŠ äº†â€œé‡å†™â€å’Œâ€œé‡æ–°æ’åâ€æ¨¡å—ã€‚ç„¶è€Œï¼Œæ€»çš„æ¥è¯´ï¼Œæ¨¡å—åŒ–RAGäº«æœ‰æ›´å¤§çš„å¤šæ ·æ€§å’Œçµæ´»æ€§ã€‚&lt;/p&gt;
&lt;p&gt;å½“å‰çš„ç ”ç©¶ä¸»è¦æ¢ç´¢ä¸¤ç§ç»„ç»‡èŒƒå¼ã€‚ç¬¬ä¸€ç§æ¶‰åŠæ·»åŠ æˆ–æ›¿æ¢æ¨¡å—ï¼Œè€Œç¬¬äºŒç§ä¸“æ³¨äºè°ƒæ•´æ¨¡å—ä¹‹é—´çš„ç»„ç»‡æµç¨‹ã€‚è¿™ç§çµæ´»æ€§ä½¿å¾—RAGè¿‡ç¨‹èƒ½å¤Ÿæœ‰æ•ˆåœ°è§£å†³å¹¿æ³›çš„ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ·»åŠ æˆ–æ›¿æ¢æ¨¡å—&lt;/strong&gt;(&lt;em&gt;Adding or Replacing Modules&lt;/em&gt;)ã€‚å¼•å…¥æˆ–æ›¿æ¢æ¨¡å—çš„ç­–ç•¥æ¶‰åŠåœ¨ä¿æŒæ£€ç´¢-é˜…è¯»è¿‡ç¨‹çš„æ ¸å¿ƒç»“æ„çš„åŒæ—¶ï¼Œæ•´åˆé¢å¤–çš„æ¨¡å—ä»¥å¢å¼ºç‰¹å®šåŠŸèƒ½ã€‚RRRæ¨¡å‹[Maç­‰äººï¼Œ2023a]å¼•å…¥äº†é‡å†™-æ£€ç´¢-é˜…è¯»è¿‡ç¨‹ï¼Œåˆ©ç”¨LLMæ€§èƒ½ä½œä¸ºé‡å†™æ¨¡å—çš„å¼ºåŒ–å­¦ä¹ æ¿€åŠ±ã€‚è¿™ä½¿å¾—é‡å†™å™¨èƒ½å¤Ÿå¾®è°ƒæ£€ç´¢æŸ¥è¯¢ï¼Œä»è€Œæé«˜ä¸‹æ¸¸ä»»åŠ¡çš„è¯»è€…æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ç±»ä¼¼åœ°ï¼Œæ¨¡å—å¯ä»¥åœ¨åƒGenerate-Read[Yuç­‰äººï¼Œ2022]è¿™æ ·çš„æ–¹æ³•ä¸­é€‰æ‹©æ€§åœ°äº¤æ¢ï¼Œå…¶ä¸­LLMçš„ç”Ÿæˆæ¨¡å—å–ä»£äº†æ£€ç´¢æ¨¡å—ã€‚Recite-Readæ–¹æ³•[Sunç­‰äººï¼Œ2022]å°†å¤–éƒ¨æ£€ç´¢è½¬åŒ–ä¸ºæ¨¡å‹æƒé‡çš„æ£€ç´¢ï¼Œè¦æ±‚LLMé¦–å…ˆè®°ä½ç‰¹å®šä»»åŠ¡çš„ä¿¡æ¯ï¼Œç„¶åäº§ç”Ÿèƒ½å¤Ÿå¤„ç†çŸ¥è¯†å¯†é›†å‹è‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡çš„è¾“å‡ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è°ƒæ•´æ¨¡å—ä¹‹é—´çš„æµç¨‹&lt;/strong&gt;(&lt;em&gt;Adjusting the Flow between Modules&lt;/em&gt;)ã€‚åœ¨æ¨¡å—æµç¨‹è°ƒæ•´é¢†åŸŸï¼Œé‡ç‚¹æ˜¯å¢å¼ºè¯­è¨€æ¨¡å‹å’Œæ£€ç´¢æ¨¡å‹ä¹‹é—´çš„äº’åŠ¨ã€‚DSP[Khattabç­‰äººï¼Œ2022]å¼•å…¥äº†DemonstrateSearch-Predictæ¡†æ¶ï¼Œå°†ä¸Šä¸‹æ–‡å­¦ä¹ ç³»ç»Ÿè§†ä¸ºä¸€ä¸ªæ˜ç¡®çš„ç¨‹åºï¼Œè€Œä¸æ˜¯æœ€ç»ˆä»»åŠ¡æç¤ºï¼Œä»è€Œæ›´æœ‰æ•ˆåœ°å¤„ç†çŸ¥è¯†å¯†é›†å‹ä»»åŠ¡ã€‚ITER-RETGEN[Shaoç­‰äººï¼Œ2023]æ–¹æ³•åˆ©ç”¨ç”Ÿæˆçš„å†…å®¹æŒ‡å¯¼æ£€ç´¢ï¼Œåœ¨æ£€ç´¢-é˜…è¯»-æ£€ç´¢-é˜…è¯»æµç¨‹ä¸­è¿­ä»£å®æ–½â€œæ£€ç´¢å¢å¼ºç”Ÿæˆâ€å’Œâ€œç”Ÿæˆå¢å¼ºæ£€ç´¢â€ã€‚è¿™ç§æ–¹æ³•å±•ç¤ºäº†ä¸€ç§åˆ›æ–°çš„ä½¿ç”¨ä¸€ä¸ªæ¨¡å—çš„è¾“å‡ºæ¥æ”¹è¿›å¦ä¸€ä¸ªæ¨¡å—åŠŸèƒ½çš„æ–¹å¼ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ä¼˜åŒ–ragæµç¨‹optimizing-the-rag-pipeline&#34;&gt;ä¼˜åŒ–RAGæµç¨‹(&lt;strong&gt;Optimizing the RAG Pipeline&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;æ£€ç´¢è¿‡ç¨‹çš„ä¼˜åŒ–æ—¨åœ¨æé«˜RAGç³»ç»Ÿä¸­ä¿¡æ¯çš„æ•ˆç‡å’Œè´¨é‡ã€‚å½“å‰çš„ç ”ç©¶é›†ä¸­åœ¨æ•´åˆå¤šæ ·åŒ–çš„æœç´¢æŠ€æœ¯ã€å®Œå–„æ£€ç´¢æ­¥éª¤ã€çº³å…¥è®¤çŸ¥å›æº¯ã€å®æ–½å¤šåŠŸèƒ½æŸ¥è¯¢ç­–ç•¥å’Œåˆ©ç”¨åµŒå…¥ç›¸ä¼¼åº¦ã€‚è¿™äº›åŠªåŠ›å…±åŒè‡´åŠ›äºåœ¨RAGç³»ç»Ÿä¸­å®ç°æ£€ç´¢æ•ˆç‡å’Œä¸Šä¸‹æ–‡ä¿¡æ¯æ·±åº¦ä¹‹é—´çš„å¹³è¡¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ··åˆæœç´¢æ¢ç´¢&lt;/strong&gt;(&lt;em&gt;Hybrid Search Exploration&lt;/em&gt;)ã€‚RAGç³»ç»Ÿé€šè¿‡æ™ºèƒ½æ•´åˆå„ç§æŠ€æœ¯ï¼ŒåŒ…æ‹¬åŸºäºå…³é”®è¯çš„æœç´¢ã€è¯­ä¹‰æœç´¢å’Œå‘é‡æœç´¢ï¼Œæ¥ä¼˜åŒ–å…¶æ€§èƒ½ã€‚è¿™ç§æ–¹æ³•åˆ©ç”¨æ¯ç§æ–¹æ³•çš„ç‹¬ç‰¹ä¼˜åŠ¿ï¼Œä»¥é€‚åº”å¤šæ ·åŒ–çš„æŸ¥è¯¢ç±»å‹å’Œä¿¡æ¯éœ€æ±‚ï¼Œç¡®ä¿æ£€ç´¢åˆ°é«˜åº¦ç›¸å…³å’Œä¸Šä¸‹æ–‡ä¸°å¯Œçš„ä¿¡æ¯ã€‚æ··åˆæœç´¢çš„ä½¿ç”¨ä½œä¸ºæ£€ç´¢ç­–ç•¥çš„æœ‰åŠ›è¡¥å……ï¼Œä»è€Œæé«˜äº†RAGæµç¨‹çš„æ•´ä½“æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é€’å½’æ£€ç´¢å’ŒæŸ¥è¯¢å¼•æ“&lt;/strong&gt;(&lt;em&gt;Recursive Retrieval and Query Engine&lt;/em&gt;)ã€‚é€’å½’æ£€ç´¢æ¶‰åŠåœ¨åˆå§‹æ£€ç´¢é˜¶æ®µè·å–è¾ƒå°çš„å—ä»¥æ•è·å…³é”®è¯­ä¹‰å«ä¹‰ã€‚éšåï¼Œåœ¨è¿‡ç¨‹çš„åæœŸé˜¶æ®µå‘LLMæä¾›åŒ…å«æ›´å¤šä¸Šä¸‹æ–‡ä¿¡æ¯çš„è¾ƒå¤§å—ã€‚è¿™ç§ä¸¤æ­¥æ£€ç´¢æ–¹æ³•æœ‰åŠ©äºåœ¨æ•ˆç‡å’Œæä¾›ä¸Šä¸‹æ–‡ä¸°å¯Œå“åº”ä¹‹é—´å–å¾—å¹³è¡¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;StepBack-prompt&lt;/strong&gt;ã€‚è¯¥æ–¹æ³•é¼“åŠ±LLMè¿œç¦»å…·ä½“å®ä¾‹ï¼Œå›´ç»•æ›´å¹¿æ³›çš„æ¦‚å¿µå’ŒåŸåˆ™è¿›è¡Œæ¨ç†[Zhengç­‰äººï¼Œ2023]ã€‚å®éªŒç»“æœè¡¨æ˜ï¼Œå½“ä½¿ç”¨å‘åæç¤ºæ—¶ï¼Œå„ç§å…·æœ‰æŒ‘æˆ˜æ€§çš„ã€åŸºäºæ¨ç†çš„ä»»åŠ¡çš„æ€§èƒ½æ˜¾è‘—æé«˜ï¼Œçªæ˜¾äº†å®ƒä»¬å¯¹RAGæµç¨‹çš„è‡ªç„¶é€‚åº”æ€§ã€‚è¿™äº›æ£€ç´¢å¢å¼ºæ­¥éª¤æ—¢å¯ä»¥åº”ç”¨äºç”Ÿæˆå¯¹å‘åæç¤ºçš„å“åº”ï¼Œä¹Ÿå¯ä»¥åº”ç”¨äºæœ€ç»ˆçš„é—®é¢˜å›ç­”è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å­æŸ¥è¯¢&lt;/strong&gt;(&lt;em&gt;Sub-Queries&lt;/em&gt;)ã€‚æ ¹æ®åœºæ™¯ï¼Œå¯ä»¥é‡‡ç”¨å„ç§æŸ¥è¯¢ç­–ç•¥ï¼Œä¾‹å¦‚ä½¿ç”¨LlamaIndexç­‰æ¡†æ¶æä¾›çš„æŸ¥è¯¢å¼•æ“ï¼Œåˆ©ç”¨æ ‘æŸ¥è¯¢ï¼Œä½¿ç”¨å‘é‡æŸ¥è¯¢ï¼Œæˆ–æ‰§è¡Œå—çš„ç®€å•é¡ºåºæŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å‡è®¾æ–‡æ¡£åµŒå…¥&lt;/strong&gt;(&lt;em&gt;Hypothetical Document Embeddings&lt;/em&gt;)ã€‚HyDEåŸºäºè¿™æ ·ä¸€ä¸ªä¿¡å¿µï¼šç”Ÿæˆçš„ç­”æ¡ˆå¯èƒ½åœ¨åµŒå…¥ç©ºé—´ä¸­æ¯”ç›´æ¥æŸ¥è¯¢æ›´æ¥è¿‘ã€‚ä½¿ç”¨LLMï¼ŒHyDEåˆ›å»ºä¸€ä¸ªå‡è®¾çš„æ–‡æ¡£ï¼ˆç­”æ¡ˆï¼‰æ¥å“åº”æŸ¥è¯¢ï¼ŒåµŒå…¥è¿™ä¸ªæ–‡æ¡£ï¼Œå¹¶ä½¿ç”¨ç»“æœåµŒå…¥æ¥æ£€ç´¢ä¸å‡è®¾æ–‡æ¡£ç›¸ä¼¼çš„çœŸå®æ–‡æ¡£ã€‚è¿™ç§æ–¹æ³•ä¸æ˜¯åŸºäºæŸ¥è¯¢çš„åµŒå…¥ç›¸ä¼¼åº¦ï¼Œè€Œæ˜¯ä¸“æ³¨äºä»ä¸€ä¸ªç­”æ¡ˆåˆ°å¦ä¸€ä¸ªç­”æ¡ˆçš„åµŒå…¥ç›¸ä¼¼åº¦[Gaoç­‰äººï¼Œ2022]ã€‚ç„¶è€Œï¼Œå®ƒå¯èƒ½ä¸ä¼šå§‹ç»ˆäº§ç”Ÿç†æƒ³çš„ç»“æœï¼Œç‰¹åˆ«æ˜¯å½“è¯­è¨€æ¨¡å‹å¯¹ä¸»é¢˜ä¸ç†Ÿæ‚‰æ—¶ï¼Œå¯èƒ½å¯¼è‡´æ›´å¤šé”™è¯¯å®ä¾‹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬4ç« æ£€ç´¢&#34;&gt;ç¬¬4ç« ï¼šæ£€ç´¢&lt;/h2&gt;
&lt;p&gt;åœ¨RAGçš„èƒŒæ™¯ä¸‹ï¼Œä»æ•°æ®æºé«˜æ•ˆåœ°æ£€ç´¢ç›¸å…³æ–‡æ¡£è‡³å…³é‡è¦ã€‚ç„¶è€Œï¼Œåˆ›å»ºä¸€ä¸ªç†Ÿç»ƒçš„æ£€ç´¢å™¨é¢ä¸´ç€é‡å¤§æŒ‘æˆ˜ã€‚æœ¬èŠ‚å°†æ¢è®¨ä¸‰ä¸ªåŸºæœ¬é—®é¢˜ï¼š1ï¼‰æˆ‘ä»¬å¦‚ä½•å®ç°å‡†ç¡®çš„è¯­ä¹‰è¡¨ç¤ºï¼Ÿ2ï¼‰å“ªäº›æ–¹æ³•å¯ä»¥å¯¹é½æŸ¥è¯¢å’Œæ–‡æ¡£çš„è¯­ä¹‰ç©ºé—´ï¼Ÿ3ï¼‰æ£€ç´¢å™¨çš„è¾“å‡ºå¦‚ä½•ä¸å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„åå¥½å¯¹é½ï¼Ÿ&lt;/p&gt;
&lt;h3 id=&#34;41-å¢å¼ºè¯­ä¹‰è¡¨ç¤ºenhancing-semantic-representations&#34;&gt;4.1 å¢å¼ºè¯­ä¹‰è¡¨ç¤º(&lt;strong&gt;Enhancing Semantic Representations&lt;/strong&gt;)&lt;/h3&gt;
&lt;p&gt;åœ¨RAGä¸­ï¼Œè¯­ä¹‰ç©ºé—´è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒæ¶‰åŠæŸ¥è¯¢å’Œæ–‡æ¡£çš„å¤šç»´æ˜ å°„ã€‚åœ¨è¿™ä¸ªè¯­ä¹‰ç©ºé—´ä¸­çš„æ£€ç´¢å‡†ç¡®æ€§æ˜¾è‘—å½±å“RAGçš„ç»“æœã€‚æœ¬èŠ‚å°†ä»‹ç»æ„å»ºå‡†ç¡®è¯­ä¹‰ç©ºé—´çš„ä¸¤ç§æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å—ä¼˜åŒ–chunk-optimization&#34;&gt;å—ä¼˜åŒ–(&lt;strong&gt;Chunk optimization&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;åœ¨å¤„ç†å¤–éƒ¨æ–‡æ¡£æ—¶ï¼Œåˆå§‹æ­¥éª¤æ¶‰åŠå°†å®ƒä»¬åˆ†è§£æˆè¾ƒå°çš„å—ä»¥æå–ç»†ç²’åº¦ç‰¹å¾ï¼Œç„¶ååµŒå…¥è¿™äº›ç‰¹å¾ä»¥è¡¨ç¤ºå®ƒä»¬çš„è¯­ä¹‰ã€‚ç„¶è€Œï¼ŒåµŒå…¥è¿‡å¤§æˆ–è¿‡å°çš„æ–‡æœ¬å—å¯èƒ½ä¼šå¯¼è‡´æ¬¡ä¼˜ç»“æœã€‚å› æ­¤ï¼Œç¡®å®šæ–‡æ¡£è¯­æ–™åº“ä¸­æ–‡æ¡£çš„æœ€ä½³å—å¤§å°å¯¹äºç¡®ä¿æ£€ç´¢ç»“æœçš„å‡†ç¡®æ€§å’Œç›¸å…³æ€§è‡³å…³é‡è¦ã€‚é€‰æ‹©åˆé€‚çš„åˆ†å—ç­–ç•¥éœ€è¦ä»”ç»†è€ƒè™‘å‡ ä¸ªå…³é”®å› ç´ ï¼Œä¾‹å¦‚ç´¢å¼•å†…å®¹çš„æ€§è´¨ã€åµŒå…¥æ¨¡å‹åŠå…¶æœ€ä½³å—å¤§å°ã€ç”¨æˆ·æŸ¥è¯¢çš„é¢„æœŸé•¿åº¦å’Œå¤æ‚æ€§ï¼Œä»¥åŠåº”ç”¨ç¨‹åºå¯¹æ£€ç´¢ç»“æœçš„å…·ä½“ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œé€‰æ‹©åˆ†å—æ¨¡å‹åº”åŸºäºå†…å®¹çš„é•¿åº¦â€”â€”æ— è®ºæ˜¯æ›´é•¿è¿˜æ˜¯æ›´çŸ­ã€‚æ­¤å¤–ï¼Œä¸åŒçš„åµŒå…¥æ¨¡å‹åœ¨ä¸åŒçš„å—å¤§å°ä¸‹è¡¨ç°å‡ºä¸åŒçš„æ€§èƒ½ç‰¹å¾ã€‚ä¾‹å¦‚ï¼Œsentence-transformeråœ¨å¤„ç†å•ä¸ªå¥å­æ—¶è¡¨ç°æ›´å¥½ï¼Œè€Œtext-embedding-ada-002åœ¨å¤„ç†åŒ…å«256æˆ–512ä¸ªtokençš„å—æ—¶è¡¨ç°å‡ºè‰²ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œç”¨æˆ·è¾“å…¥é—®é¢˜çš„é•¿åº¦å’Œå¤æ‚æ€§ä»¥åŠåº”ç”¨ç¨‹åºï¼ˆä¾‹å¦‚è¯­ä¹‰æœç´¢æˆ–é—®ç­”ï¼‰å¯¹æ£€ç´¢ç»“æœçš„å…·ä½“éœ€æ±‚ä¹Ÿä¼šå½±å“å—å¤§å°çš„é€‰æ‹©ã€‚å®é™…ä¸Šï¼Œè·å¾—ç²¾ç¡®çš„æŸ¥è¯¢ç»“æœæ¶‰åŠçµæ´»åº”ç”¨ä¸åŒçš„åˆ†å—ç­–ç•¥ã€‚æ²¡æœ‰ä¸€ç§â€œæœ€ä½³â€ç­–ç•¥é€‚ç”¨äºæ‰€æœ‰æƒ…å†µï¼Œåªæœ‰ç‰¹å®šæƒ…å¢ƒä¸‹æœ€åˆé€‚çš„ç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;å½“å‰RAGé¢†åŸŸçš„ç ”ç©¶æ¢ç´¢äº†å„ç§å—ä¼˜åŒ–æŠ€æœ¯ï¼Œæ—¨åœ¨æé«˜æ£€ç´¢æ•ˆç‡å’Œå‡†ç¡®æ€§ã€‚å…¶ä¸­ä¸€ç§æ–¹æ³•æ¶‰åŠä½¿ç”¨æ»‘åŠ¨çª—å£æŠ€æœ¯ï¼Œé€šè¿‡åˆå¹¶å¤šä¸ªæ£€ç´¢è¿‡ç¨‹ä¸­çš„å…¨å±€ç›¸å…³ä¿¡æ¯æ¥å®ç°åˆ†å±‚æ£€ç´¢ã€‚å¦ä¸€ç§ç­–ç•¥ï¼Œç§°ä¸ºâ€œsmall2bigâ€æ–¹æ³•ï¼Œåˆ©ç”¨å°æ–‡æœ¬å—è¿›è¡Œåˆå§‹æœç´¢é˜¶æ®µï¼Œç„¶ååœ¨åç»­é˜¶æ®µå‘è¯­è¨€æ¨¡å‹æä¾›è¾ƒå¤§çš„ç›¸å…³æ–‡æœ¬å—ã€‚&lt;/p&gt;
&lt;p&gt;æŠ½è±¡åµŒå…¥æŠ€æœ¯ä¼˜å…ˆè€ƒè™‘åŸºäºæ–‡æ¡£æ‘˜è¦ï¼ˆæˆ–æ‘˜è¦ï¼‰çš„Top Kæ£€ç´¢ï¼Œæä¾›å¯¹æ•´ä¸ªæ–‡æ¡£ä¸Šä¸‹æ–‡çš„å…¨é¢ç†è§£ã€‚æ­¤å¤–ï¼Œå…ƒæ•°æ®è¿‡æ»¤æŠ€æœ¯åˆ©ç”¨æ–‡æ¡£å…ƒæ•°æ®æ¥å¢å¼ºè¿‡æ»¤è¿‡ç¨‹ã€‚ä¸€ç§åˆ›æ–°çš„æ–¹æ³•ï¼Œå›¾ç´¢å¼•æŠ€æœ¯ï¼Œå°†å®ä½“å’Œå…³ç³»è½¬åŒ–ä¸ºèŠ‚ç‚¹å’Œè¿æ¥ï¼Œæ˜¾è‘—æé«˜äº†ç›¸å…³æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤šè·³é—®é¢˜çš„èƒŒæ™¯ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›å¤šæ ·åŒ–æ–¹æ³•çš„ç»“åˆå¯¼è‡´äº†æ˜¾è‘—çš„è¿›æ­¥ï¼Œä»è€Œæé«˜äº†æ£€ç´¢ç»“æœå’ŒRAGæ€§èƒ½ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å¾®è°ƒåµŒå…¥æ¨¡å‹fine-tuning-embedding-models&#34;&gt;å¾®è°ƒåµŒå…¥æ¨¡å‹(&lt;strong&gt;Fine-tuning Embedding Models&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;ä¸€æ—¦ç¡®å®šäº†é€‚å½“çš„å—å¤§å°ï¼Œä¸‹ä¸€æ­¥å…³é”®æ˜¯ä½¿ç”¨åµŒå…¥æ¨¡å‹å°†è¿™äº›å—å’ŒæŸ¥è¯¢åµŒå…¥åˆ°è¯­ä¹‰ç©ºé—´ä¸­ã€‚åµŒå…¥çš„æœ‰æ•ˆæ€§è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒå½±å“æ¨¡å‹è¡¨ç¤ºè¯­æ–™åº“çš„èƒ½åŠ›ã€‚æœ€è¿‘çš„ç ”ç©¶å¼•å…¥äº†è‘—åçš„åµŒå…¥æ¨¡å‹ï¼Œå¦‚AngIEã€Voyageã€BGEç­‰[Liå’ŒLiï¼Œ2023ï¼ŒVoyageAIï¼Œ2023ï¼ŒBAAIï¼Œ2023]ã€‚è¿™äº›æ¨¡å‹å·²ç»åœ¨å¹¿æ³›çš„è¯­æ–™åº“ä¸Šè¿›è¡Œäº†é¢„è®­ç»ƒã€‚ç„¶è€Œï¼Œå½“åº”ç”¨äºç‰¹å®šé¢†åŸŸæ—¶ï¼Œå®ƒä»¬å‡†ç¡®æ•æ‰é¢†åŸŸç‰¹å®šä¿¡æ¯çš„èƒ½åŠ›å¯èƒ½å—åˆ°é™åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œé’ˆå¯¹ç‰¹å®šä»»åŠ¡å¯¹åµŒå…¥æ¨¡å‹è¿›è¡Œå¾®è°ƒå¯¹äºç¡®ä¿æ¨¡å‹ç†è§£ç”¨æˆ·æŸ¥è¯¢çš„å†…å®¹ç›¸å…³æ€§è‡³å…³é‡è¦ã€‚æ²¡æœ‰ç»è¿‡å¾®è°ƒçš„æ¨¡å‹å¯èƒ½æ— æ³•å……åˆ†æ»¡è¶³ç‰¹å®šä»»åŠ¡çš„è¦æ±‚ã€‚å› æ­¤ï¼Œå¯¹äºä¸‹æ¸¸åº”ç”¨æ¥è¯´ï¼Œå¾®è°ƒåµŒå…¥æ¨¡å‹å˜å¾—è‡³å…³é‡è¦ã€‚åµŒå…¥å¾®è°ƒæ–¹æ³•ä¸»è¦æœ‰ä¸¤ç§èŒƒå¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é¢†åŸŸçŸ¥è¯†å¾®è°ƒ&lt;/strong&gt;(&lt;em&gt;Domain Knowledge Fine-tuning&lt;/em&gt;)ã€‚ä¸ºäº†ç¡®ä¿åµŒå…¥æ¨¡å‹å‡†ç¡®æ•æ‰é¢†åŸŸç‰¹å®šä¿¡æ¯ï¼Œåˆ©ç”¨é¢†åŸŸç‰¹å®šæ•°æ®é›†è¿›è¡Œå¾®è°ƒè‡³å…³é‡è¦ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸æ ‡å‡†è¯­è¨€æ¨¡å‹å¾®è°ƒçš„ä¸»è¦åŒºåˆ«åœ¨äºæ¶‰åŠçš„æ•°æ®é›†çš„æ€§è´¨ã€‚é€šå¸¸ï¼ŒåµŒå…¥æ¨¡å‹å¾®è°ƒçš„æ•°æ®é›†åŒ…æ‹¬ä¸‰ä¸ªä¸»è¦å…ƒç´ ï¼šæŸ¥è¯¢ã€è¯­æ–™åº“å’Œç›¸å…³æ–‡æ¡£ã€‚æ¨¡å‹ä½¿ç”¨è¿™äº›æŸ¥è¯¢åœ¨è¯­æ–™åº“ä¸­è¯†åˆ«ç›¸å…³æ–‡æ¡£ã€‚ç„¶åæ ¹æ®æ¨¡å‹æ£€ç´¢è¿™äº›ç›¸å…³æ–‡æ¡£å¯¹æŸ¥è¯¢çš„èƒ½åŠ›æ¥è¯„ä¼°å…¶æœ‰æ•ˆæ€§ã€‚æ•°æ®é›†æ„å»ºã€æ¨¡å‹å¾®è°ƒå’Œè¯„ä¼°é˜¶æ®µå„è‡ªé¢ä¸´ä¸åŒçš„æŒ‘æˆ˜ã€‚LlamaIndex[Liuï¼Œ2023]å¼•å…¥äº†ä¸€ç³»åˆ—å…³é”®çš„ç±»å’Œå‡½æ•°ï¼Œæ—¨åœ¨ç®€åŒ–åµŒå…¥æ¨¡å‹å¾®è°ƒå·¥ä½œæµç¨‹ï¼Œä»è€Œç®€åŒ–è¿™äº›å¤æ‚çš„è¿‡ç¨‹ã€‚é€šè¿‡ç­–åˆ’ä¸€ä¸ªå……æ»¡é¢†åŸŸçŸ¥è¯†çš„è¯­æ–™åº“å¹¶åˆ©ç”¨æä¾›çš„æ–¹æ³•ï¼Œå¯ä»¥å·§å¦™åœ°å¾®è°ƒåµŒå…¥æ¨¡å‹ï¼Œä½¿å…¶ç´§å¯†ç¬¦åˆç›®æ ‡é¢†åŸŸçš„ç‰¹å®šè¦æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é’ˆå¯¹ä¸‹æ¸¸ä»»åŠ¡çš„å¾®è°ƒ&lt;/strong&gt;(&lt;em&gt;Fine-tuning for Downstream Tasks&lt;/em&gt;)ã€‚é’ˆå¯¹ä¸‹æ¸¸ä»»åŠ¡å¾®è°ƒåµŒå…¥æ¨¡å‹æ˜¯æé«˜æ¨¡å‹æ€§èƒ½çš„å…³é”®æ­¥éª¤ã€‚åœ¨åˆ©ç”¨RAGå¤„ç†è¿™äº›ä»»åŠ¡çš„é¢†åŸŸä¸­ï¼Œå‡ºç°äº†åˆ›æ–°çš„æ–¹æ³•ï¼Œåˆ©ç”¨LLMsçš„èƒ½åŠ›å¯¹åµŒå…¥æ¨¡å‹è¿›è¡Œå¾®è°ƒã€‚ä¾‹å¦‚ï¼ŒPROMPTAGATOR[Daiç­‰äººï¼Œ2022]åˆ©ç”¨LLMä½œä¸ºå°‘æ¬¡æŸ¥è¯¢ç”Ÿæˆå™¨æ¥åˆ›å»ºç‰¹å®šä»»åŠ¡çš„æ£€ç´¢å™¨ï¼Œè§£å†³äº†ç›‘ç£å¾®è°ƒä¸­çš„æŒ‘æˆ˜ï¼Œç‰¹åˆ«æ˜¯åœ¨æ•°æ®ç¨€ç¼ºçš„é¢†åŸŸã€‚å¦ä¸€ç§æ–¹æ³•ï¼ŒLLM-Embedder[Zhangç­‰äººï¼Œ2023a]ï¼Œåˆ©ç”¨LLMsä¸ºå¤šä¸ªä¸‹æ¸¸ä»»åŠ¡çš„æ•°æ®ç”Ÿæˆå¥–åŠ±ä¿¡å·ã€‚æ£€ç´¢å™¨é€šè¿‡ä¸¤ç§ç±»å‹çš„ç›‘ç£ä¿¡å·è¿›è¡Œå¾®è°ƒï¼šæ•°æ®é›†çš„ç¡¬æ ‡ç­¾å’ŒLLMsçš„è½¯å¥–åŠ±ã€‚è¿™ç§åŒä¿¡å·æ–¹æ³•ä¿ƒè¿›äº†æ›´æœ‰æ•ˆçš„å¾®è°ƒè¿‡ç¨‹ï¼Œä½¿åµŒå…¥æ¨¡å‹é€‚åº”äºå¤šæ ·åŒ–çš„ä¸‹æ¸¸åº”ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡è¿™äº›æ–¹æ³•é€šè¿‡ç»“åˆé¢†åŸŸçŸ¥è¯†å’Œé’ˆå¯¹ç‰¹å®šä»»åŠ¡çš„å¾®è°ƒæé«˜äº†è¯­ä¹‰è¡¨ç¤ºï¼Œä½†æ£€ç´¢å™¨å¯èƒ½å¹¶ä¸æ€»æ˜¯ä¸æŸäº›LLMsè¡¨ç°å‡ºæœ€ä½³å…¼å®¹æ€§ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€äº›ç ”ç©¶äººå‘˜æ¢ç´¢äº†ä½¿ç”¨LLMsçš„åé¦ˆç›´æ¥ç›‘ç£å¾®è°ƒè¿‡ç¨‹ã€‚è¿™ç§ç›´æ¥ç›‘ç£æ—¨åœ¨ä½¿æ£€ç´¢å™¨æ›´ç´§å¯†åœ°ä¸LLMå¯¹é½ï¼Œä»è€Œæé«˜ä¸‹æ¸¸ä»»åŠ¡çš„æ€§èƒ½ã€‚å…³äºè¿™ä¸ªä¸»é¢˜çš„æ›´å…¨é¢è®¨è®ºå°†åœ¨ç¬¬4.3èŠ‚ä¸­ä»‹ç»ã€‚&lt;/p&gt;
&lt;h3 id=&#34;42-å¯¹é½æŸ¥è¯¢å’Œæ–‡æ¡£aligning-queries-and-documents&#34;&gt;4.2 å¯¹é½æŸ¥è¯¢å’Œæ–‡æ¡£(&lt;strong&gt;Aligning Queries and Documents&lt;/strong&gt;)&lt;/h3&gt;
&lt;p&gt;åœ¨RAGåº”ç”¨çš„èƒŒæ™¯ä¸‹ï¼Œæ£€ç´¢å™¨å¯èƒ½ä½¿ç”¨å•ä¸€åµŒå…¥æ¨¡å‹å¯¹ç¼–ç æŸ¥è¯¢å’Œæ–‡æ¡£ï¼Œæˆ–è€…ä¸ºæ¯ä¸ªä½¿ç”¨å•ç‹¬çš„æ¨¡å‹ã€‚æ­¤å¤–ï¼Œç”¨æˆ·çš„åŸå§‹æŸ¥è¯¢å¯èƒ½ç”±äºè¡¨è¿°ä¸ç²¾ç¡®å’Œç¼ºä¹è¯­ä¹‰ä¿¡æ¯è€Œå—åˆ°å½±å“ã€‚å› æ­¤ï¼Œå°†ç”¨æˆ·æŸ¥è¯¢çš„è¯­ä¹‰ç©ºé—´ä¸æ–‡æ¡£çš„è¯­ä¹‰ç©ºé—´å¯¹é½è‡³å…³é‡è¦ã€‚æœ¬èŠ‚ä»‹ç»äº†ä¸¤ç§æ—¨åœ¨å®ç°è¿™ç§å¯¹é½çš„åŸºæœ¬æŠ€æœ¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æŸ¥è¯¢é‡å†™query-rewriting&#34;&gt;æŸ¥è¯¢é‡å†™(&lt;strong&gt;Query Rewriting&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;æŸ¥è¯¢é‡å†™æ˜¯å°†æŸ¥è¯¢å’Œæ–‡æ¡£çš„è¯­ä¹‰å¯¹é½çš„åŸºæœ¬æ–¹æ³•ã€‚Query2Docå’ŒITER-RETGENç­‰æ–¹æ³•åˆ©ç”¨LLMsé€šè¿‡ç»“åˆåŸå§‹æŸ¥è¯¢å’Œé¢å¤–æŒ‡å¯¼æ¥åˆ›å»ºä¼ªæ–‡æ¡£[Wangç­‰äººï¼Œ2023cï¼ŒShaoç­‰äººï¼Œ2023]ã€‚HyDEåˆ©ç”¨æ–‡æœ¬çº¿ç´¢æ„å»ºæŸ¥è¯¢å‘é‡ï¼Œä»¥ç”Ÿæˆæ•è·åŸºæœ¬æ¨¡å¼çš„â€œå‡è®¾â€æ–‡æ¡£[Gaoç­‰äººï¼Œ2022]ã€‚RRRå¼•å…¥äº†ä¸€ä¸ªæ¡†æ¶ï¼Œé¢ è¦†äº†ä¼ ç»Ÿçš„æ£€ç´¢å’Œé˜…è¯»é¡ºåºï¼Œä¸“æ³¨äºæŸ¥è¯¢é‡å†™[Maç­‰äººï¼Œ2023a]ã€‚STEP-BACKPROMPTINGä½¿LLMsèƒ½å¤Ÿæ‰§è¡ŒåŸºäºé«˜å±‚æ¬¡æ¦‚å¿µçš„æŠ½è±¡æ¨ç†å’Œæ£€ç´¢[Zhengç­‰äººï¼Œ2023]ã€‚æ­¤å¤–ï¼Œå¤šæŸ¥è¯¢æ£€ç´¢æ–¹æ³•åˆ©ç”¨LLMsåŒæ—¶ç”Ÿæˆå’Œæ‰§è¡Œå¤šä¸ªæœç´¢æŸ¥è¯¢ï¼Œå¯¹äºè§£å†³å…·æœ‰å¤šä¸ªå­é—®é¢˜çš„å¤æ‚é—®é¢˜ç‰¹åˆ«æœ‰åˆ©ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åµŒå…¥è½¬æ¢embedding-transformation&#34;&gt;åµŒå…¥è½¬æ¢(&lt;strong&gt;Embedding Transformation&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;é™¤äº†åƒæŸ¥è¯¢é‡å†™è¿™æ ·çš„å¹¿æ³›ç­–ç•¥å¤–ï¼Œè¿˜æœ‰ä¸€äº›æ›´ç²¾ç»†çš„æŠ€æœ¯ä¸“é—¨è®¾è®¡ç”¨äºåµŒå…¥è½¬æ¢ã€‚LlamaIndex[Liuï¼Œ2023]é€šè¿‡å¼•å…¥ä¸€ä¸ªé€‚é…å™¨æ¨¡å—æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œè¯¥æ¨¡å—å¯ä»¥åœ¨æŸ¥è¯¢ç¼–ç å™¨ä¹‹åé›†æˆã€‚è¿™ä¸ªé€‚é…å™¨ä¿ƒè¿›äº†å¾®è°ƒï¼Œä»è€Œä¼˜åŒ–äº†æŸ¥è¯¢åµŒå…¥çš„è¡¨ç¤ºï¼Œå°†å®ƒä»¬æ˜ å°„åˆ°ä¸é¢„æœŸä»»åŠ¡æ›´ç´§å¯†å¯¹é½çš„æ½œåœ¨ç©ºé—´ã€‚SANTA[Liç­‰äººï¼Œ2023d]è§£å†³äº†ä¸ç»“æ„åŒ–å¤–éƒ¨æ–‡æ¡£å¯¹é½æŸ¥è¯¢çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å¤„ç†ç»“æ„åŒ–å’Œéç»“æ„åŒ–æ•°æ®ä¹‹é—´çš„ä¸ä¸€è‡´æ€§ã€‚å®ƒé€šè¿‡ä¸¤ç§é¢„è®­ç»ƒç­–ç•¥å¢å¼ºäº†æ£€ç´¢å™¨å¯¹ç»“æ„åŒ–ä¿¡æ¯çš„æ•æ„Ÿæ€§ï¼šé¦–å…ˆï¼Œé€šè¿‡åˆ©ç”¨ç»“æ„åŒ–å’Œéç»“æ„åŒ–æ•°æ®ä¹‹é—´çš„å›ºæœ‰å¯¹é½æ¥æŒ‡å¯¼å¯¹æ¯”å­¦ä¹ çš„ç»“æ„æ„ŸçŸ¥é¢„è®­ç»ƒæ–¹æ¡ˆï¼›å…¶æ¬¡ï¼Œé€šè¿‡å®æ–½Masked Entity Predictionã€‚åè€…åˆ©ç”¨ä»¥å®ä½“ä¸ºä¸­å¿ƒçš„æ©è”½ç­–ç•¥ï¼Œé¼“åŠ±è¯­è¨€æ¨¡å‹é¢„æµ‹å¹¶å¡«å†™æ©è”½çš„å®ä½“ï¼Œä»è€Œä¿ƒè¿›å¯¹ç»“æ„åŒ–æ•°æ®çš„æ›´æ·±å…¥ç†è§£ã€‚&lt;/p&gt;
&lt;h3 id=&#34;43-å¯¹é½æ£€ç´¢å™¨å’Œllmaligning-retriever-and-llm&#34;&gt;4.3 å¯¹é½æ£€ç´¢å™¨å’ŒLLM(&lt;strong&gt;Aligning Retriever and LLM&lt;/strong&gt;)&lt;/h3&gt;
&lt;p&gt;åœ¨RAGæµç¨‹ä¸­ï¼Œé€šè¿‡å„ç§æŠ€æœ¯æé«˜æ£€ç´¢å‘½ä¸­ç‡å¯èƒ½å¹¶ä¸ä¸€å®šæ”¹å–„æœ€ç»ˆç»“æœï¼Œå› ä¸ºæ£€ç´¢åˆ°çš„æ–‡æ¡£å¯èƒ½ä¸LLMsçš„ç‰¹å®šè¦æ±‚ä¸ä¸€è‡´ã€‚å› æ­¤ï¼Œæœ¬èŠ‚ä»‹ç»äº†ä¸¤ç§æ—¨åœ¨å°†æ£€ç´¢å™¨è¾“å‡ºä¸LLMsåå¥½å¯¹é½çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å¾®è°ƒæ£€ç´¢å™¨fine-tuning-retrievers&#34;&gt;å¾®è°ƒæ£€ç´¢å™¨(&lt;strong&gt;Fine-tuning Retrievers&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;ä¸€äº›ç ”ç©¶åˆ©ç”¨LLMsçš„åé¦ˆä¿¡å·æ¥å®Œå–„æ£€ç´¢æ¨¡å‹ã€‚ä¾‹å¦‚ï¼ŒAAR[Yuç­‰äººï¼Œ2023b]é€šè¿‡ä½¿ç”¨ç¼–ç å™¨-è§£ç å™¨æ¶æ„ä¸ºé¢„è®­ç»ƒæ£€ç´¢å™¨å¼•å…¥ç›‘ç£ä¿¡å·ã€‚è¿™æ˜¯é€šè¿‡è¯†åˆ«LMçš„é¦–é€‰æ–‡æ¡£é€šè¿‡FiDäº¤å‰æ³¨æ„åŠ›åˆ†æ•°å®ç°çš„ã€‚éšåï¼Œæ£€ç´¢å™¨é€šè¿‡ç¡¬è´Ÿé‡‡æ ·å’Œæ ‡å‡†äº¤å‰ç†µæŸå¤±è¿›è¡Œå¾®è°ƒã€‚æœ€ç»ˆï¼Œç»è¿‡æ”¹è¿›çš„æ£€ç´¢å™¨å¯ä»¥ç›´æ¥åº”ç”¨äºå¢å¼ºç›®æ ‡LLMsï¼Œåœ¨ç›®æ ‡ä»»åŠ¡ä¸­å®ç°æ›´å¥½çš„æ€§èƒ½ã€‚æ­¤å¤–ï¼Œæœ‰äººå»ºè®®LLMså¯èƒ½æ›´å–œæ¬¢å…³æ³¨å¯è¯»æ€§è€Œä¸æ˜¯ä¿¡æ¯ä¸°å¯Œçš„æ–‡æ¡£ã€‚REPLUG[Shiç­‰äººï¼Œ2023]åˆ©ç”¨æ£€ç´¢å™¨å’ŒLLMæ¥è®¡ç®—æ£€ç´¢æ–‡æ¡£çš„æ¦‚ç‡åˆ†å¸ƒï¼Œç„¶åé€šè¿‡è®¡ç®—KLæ•£åº¦è¿›è¡Œç›‘ç£è®­ç»ƒã€‚è¿™ç§ç®€å•æœ‰æ•ˆçš„è®­ç»ƒæ–¹æ³•é€šè¿‡ä½¿ç”¨LMä½œä¸ºç›‘ç£ä¿¡å·æ¥æé«˜æ£€ç´¢æ¨¡å‹çš„æ€§èƒ½ï¼Œæ¶ˆé™¤äº†å¯¹ç‰¹å®šäº¤å‰æ³¨æ„åŠ›æœºåˆ¶çš„éœ€æ±‚ã€‚UPRISE[Chengç­‰äººï¼Œ2023a]ä¹Ÿåˆ©ç”¨å†»ç»“çš„LLMsæ¥å¾®è°ƒæç¤ºæ£€ç´¢å™¨ã€‚LLMå’Œæ£€ç´¢å™¨éƒ½ä»¥æç¤ºè¾“å…¥å¯¹ä½œä¸ºè¾“å…¥ï¼Œå¹¶åˆ©ç”¨LLMæä¾›çš„åˆ†æ•°æ¥ç›‘ç£æ£€ç´¢å™¨çš„è®­ç»ƒï¼Œæœ‰æ•ˆåœ°å°†LLMè§†ä¸ºæ•°æ®é›†æ ‡ç­¾å™¨ã€‚æ­¤å¤–ï¼ŒAtlas[Izacardç­‰äººï¼Œ2022]æå‡ºäº†å››ç§ç›‘ç£å¾®è°ƒåµŒå…¥æ¨¡å‹çš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ³¨æ„åŠ›è’¸é¦(&lt;em&gt;Attention Distillation&lt;/em&gt;)ã€‚è¿™ç§æ–¹æ³•åˆ©ç”¨LLMåœ¨è¾“å‡ºæœŸé—´ç”Ÿæˆçš„äº¤å‰æ³¨æ„åŠ›åˆ†æ•°æ¥æç‚¼æ¨¡å‹çš„çŸ¥è¯†ã€‚&lt;/li&gt;
&lt;li&gt;EMDR2ã€‚é€šè¿‡ä½¿ç”¨æœŸæœ›æœ€å¤§åŒ–ç®—æ³•ï¼Œè¿™ç§æ–¹æ³•ä½¿ç”¨æ£€ç´¢æ–‡æ¡£ä½œä¸ºæ½œåœ¨å˜é‡æ¥è®­ç»ƒæ¨¡å‹ã€‚&lt;/li&gt;
&lt;li&gt;å›°æƒ‘åº¦è’¸é¦(&lt;em&gt;Perplexity Distillation&lt;/em&gt;)ç›´æ¥ä½¿ç”¨ç”Ÿæˆæ ‡è®°çš„å›°æƒ‘åº¦ä½œä¸ºæŒ‡æ ‡æ¥è®­ç»ƒæ¨¡å‹ã€‚&lt;/li&gt;
&lt;li&gt;LOOPã€‚è¿™ç§æ–¹æ³•æå‡ºäº†ä¸€ç§åŸºäºæ–‡æ¡£åˆ é™¤å¯¹LLMé¢„æµ‹å½±å“çš„æ–°æŸå¤±å‡½æ•°ï¼Œæä¾›äº†ä¸€ç§æœ‰æ•ˆçš„è®­ç»ƒç­–ç•¥ï¼Œä»¥æ›´å¥½åœ°é€‚åº”ç‰¹å®šä»»åŠ¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™äº›æ–¹æ³•æ—¨åœ¨æ”¹å–„æ£€ç´¢å™¨å’ŒLLMä¹‹é—´çš„ååŒä½œç”¨ï¼Œä»è€Œæé«˜æ£€ç´¢æ€§èƒ½å¹¶æ›´å‡†ç¡®åœ°å“åº”ç”¨æˆ·æŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;h4 id=&#34;é€‚é…å™¨adapters&#34;&gt;é€‚é…å™¨(&lt;strong&gt;Adapters&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;å¾®è°ƒæ¨¡å‹å¯èƒ½ä¼šå¸¦æ¥æŒ‘æˆ˜ï¼Œä¾‹å¦‚é€šè¿‡APIæ•´åˆåŠŸèƒ½æˆ–è§£å†³ç”±äºæœ¬åœ°è®¡ç®—èµ„æºæœ‰é™è€Œäº§ç”Ÿçš„çº¦æŸã€‚å› æ­¤ï¼Œä¸€äº›æ–¹æ³•é€‰æ‹©åŠ å…¥å¤–éƒ¨é€‚é…å™¨æ¥å¸®åŠ©å¯¹é½ã€‚&lt;/p&gt;
&lt;p&gt;PRCAé€šè¿‡ä¸Šä¸‹æ–‡æå–é˜¶æ®µå’Œå¥–åŠ±é©±åŠ¨é˜¶æ®µè®­ç»ƒé€‚é…å™¨ã€‚ç„¶åä½¿ç”¨åŸºäºæ ‡è®°çš„è‡ªå›å½’ç­–ç•¥ä¼˜åŒ–æ£€ç´¢å™¨çš„è¾“å‡º[Yangç­‰äººï¼Œ2023b]ã€‚æ ‡è®°è¿‡æ»¤æ–¹æ³•åˆ©ç”¨äº¤å‰æ³¨æ„åŠ›åˆ†æ•°æœ‰æ•ˆåœ°è¿‡æ»¤æ ‡è®°ï¼Œä»…é€‰æ‹©å¾—åˆ†æœ€é«˜çš„è¾“å…¥æ ‡è®°[Berchanskyç­‰äººï¼Œ2023]ã€‚&lt;/p&gt;
&lt;p&gt;RECOMPå¼•å…¥äº†æå–æ€§å’Œç”Ÿæˆæ€§å‹ç¼©å™¨ç”¨äºæ‘˜è¦ç”Ÿæˆã€‚è¿™äº›å‹ç¼©å™¨è¦ä¹ˆé€‰æ‹©ç›¸å…³å¥å­ï¼Œè¦ä¹ˆåˆæˆæ–‡æ¡£ä¿¡æ¯ï¼Œåˆ›å»ºé’ˆå¯¹å¤šæ–‡æ¡£æŸ¥è¯¢é‡èº«å®šåˆ¶çš„æ‘˜è¦[Xuç­‰äººï¼Œ2023a]ã€‚æ­¤å¤–ï¼ŒPKGé€šè¿‡æŒ‡ä»¤å¾®è°ƒå¼•å…¥äº†ä¸€ç§åˆ›æ–°çš„æ–¹æ³•ï¼Œå°†çŸ¥è¯†é›†æˆåˆ°ç™½ç›’æ¨¡å‹ä¸­[Luoç­‰äººï¼Œ2023]ã€‚åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæ£€ç´¢å™¨æ¨¡å—è¢«ç›´æ¥æ›¿æ¢ä¸ºæ ¹æ®æŸ¥è¯¢ç”Ÿæˆç›¸å…³æ–‡æ¡£ã€‚è¿™ç§æ–¹æ³•æœ‰åŠ©äºè§£å†³å¾®è°ƒè¿‡ç¨‹ä¸­é‡åˆ°çš„å›°éš¾ï¼Œå¹¶æé«˜æ¨¡å‹æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬5ç« ç”Ÿæˆ&#34;&gt;ç¬¬5ç« ï¼šç”Ÿæˆ&lt;/h2&gt;
&lt;p&gt;RAGçš„ä¸€ä¸ªå…³é”®ç»„æˆéƒ¨åˆ†æ˜¯å…¶ç”Ÿæˆå™¨ï¼Œå®ƒè´Ÿè´£å°†æ£€ç´¢åˆ°çš„ä¿¡æ¯è½¬æ¢ä¸ºè¿è´¯æµç•…çš„æ–‡æœ¬ã€‚ä¸ä¼ ç»Ÿçš„è¯­è¨€æ¨¡å‹ä¸åŒï¼ŒRAGçš„ç”Ÿæˆå™¨é€šè¿‡æ•´åˆæ£€ç´¢åˆ°çš„æ•°æ®æ¥æé«˜å‡†ç¡®æ€§å’Œç›¸å…³æ€§ã€‚åœ¨RAGä¸­ï¼Œç”Ÿæˆå™¨çš„è¾“å…¥ä¸ä»…åŒ…æ‹¬å…¸å‹çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè¿˜åŒ…æ‹¬é€šè¿‡æ£€ç´¢å™¨è·å–çš„ç›¸å…³æ–‡æœ¬ç‰‡æ®µã€‚è¿™ç§å…¨é¢çš„è¾“å…¥ä½¿ç”Ÿæˆå™¨èƒ½å¤Ÿæ·±å…¥äº†è§£é—®é¢˜çš„ä¸Šä¸‹æ–‡ï¼Œä»è€Œäº§ç”Ÿæ›´å…·ä¿¡æ¯æ€§å’Œä¸Šä¸‹æ–‡ç›¸å…³æ€§çš„å“åº”ã€‚æ­¤å¤–ï¼Œç”Ÿæˆå™¨å—åˆ°æ£€ç´¢åˆ°çš„æ–‡æœ¬çš„æŒ‡å¯¼ï¼Œä»¥ç¡®ä¿ç”Ÿæˆçš„å†…å®¹ä¸è·å–çš„ä¿¡æ¯ä¿æŒä¸€è‡´ã€‚å¤šæ ·åŒ–çš„è¾“å…¥æ•°æ®å¯¼è‡´äº†ç”Ÿæˆé˜¶æ®µçš„é’ˆå¯¹æ€§åŠªåŠ›ï¼Œæ—¨åœ¨å®Œå–„å¤§å‹æ¨¡å‹å¯¹æ¥è‡ªæŸ¥è¯¢å’Œæ–‡æ¡£çš„è¾“å…¥æ•°æ®çš„é€‚åº”ã€‚åœ¨ä»¥ä¸‹å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡æ·±å…¥æ¢è®¨åæ£€ç´¢å¤„ç†å’Œå¾®è°ƒæ–¹é¢ï¼Œä»‹ç»ç”Ÿæˆå™¨çš„å¼•å…¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;51-åæ£€ç´¢å¤„ç†ä¸å†»ç»“çš„llmpost-retrieval-with-frozen-llm&#34;&gt;5.1 åæ£€ç´¢å¤„ç†ä¸å†»ç»“çš„LLM(&lt;strong&gt;Post-retrieval with Frozen LLM&lt;/strong&gt;)&lt;/h3&gt;
&lt;p&gt;åœ¨ä¸å¯è°ƒçš„LLMé¢†åŸŸï¼Œè®¸å¤šç ”ç©¶ä¾èµ–äºåƒGPT-4è¿™æ ·çš„æˆç†Ÿæ¨¡å‹ï¼Œåˆ©ç”¨å®ƒä»¬å…¨é¢çš„å†…éƒ¨çŸ¥è¯†æ¥ç³»ç»Ÿåœ°ç»¼åˆæ¥è‡ªå„ç§æ–‡æ¡£çš„æ£€ç´¢ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œè¿™äº›å¤§å‹æ¨¡å‹ä»ç„¶å­˜åœ¨æŒ‘æˆ˜ï¼ŒåŒ…æ‹¬ä¸Šä¸‹æ–‡é•¿åº¦çš„é™åˆ¶å’Œå¯¹å†—ä½™ä¿¡æ¯çš„æ•æ„Ÿæ€§ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒæŸäº›ç ”ç©¶å·¥ä½œè½¬å‘äº†åæ£€ç´¢å¤„ç†ã€‚åæ£€ç´¢å¤„ç†æ¶‰åŠå¤„ç†ã€è¿‡æ»¤æˆ–ä¼˜åŒ–æ£€ç´¢å™¨ä»å¤§å‹æ–‡æ¡£æ•°æ®åº“æ£€ç´¢åˆ°çš„ç›¸å…³ä¿¡æ¯ã€‚å…¶ä¸»è¦ç›®æ ‡æ˜¯æé«˜æ£€ç´¢ç»“æœçš„è´¨é‡ï¼Œä½¿å…¶æ›´è´´è¿‘ç”¨æˆ·éœ€æ±‚æˆ–åç»­ä»»åŠ¡ã€‚å®ƒå¯ä»¥è¢«è§†ä¸ºå¯¹æ£€ç´¢é˜¶æ®µè·å¾—çš„æ–‡æ¡£è¿›è¡Œçš„å†å¤„ç†ã€‚å¸¸è§çš„åæ£€ç´¢å¤„ç†æ“ä½œé€šå¸¸åŒ…æ‹¬ä¿¡æ¯å‹ç¼©å’Œç»“æœé‡æ–°æ’åã€‚&lt;/p&gt;
&lt;h4 id=&#34;ä¿¡æ¯å‹ç¼©information-compression&#34;&gt;ä¿¡æ¯å‹ç¼©(&lt;strong&gt;Information Compression&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;æ£€ç´¢å™¨æ“…é•¿ä»åºå¤§çš„çŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯ï¼Œä½†ç®¡ç†æ£€ç´¢æ–‡æ¡£ä¸­çš„å¤§é‡ä¿¡æ¯æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚æ­£åœ¨è¿›è¡Œçš„ç ”ç©¶æ—¨åœ¨æ‰©å±•å¤§å‹è¯­è¨€æ¨¡å‹çš„ä¸Šä¸‹æ–‡é•¿åº¦ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç„¶è€Œï¼Œå½“å‰çš„å¤§å‹æ¨¡å‹ä»ç„¶éš¾ä»¥åº”å¯¹ä¸Šä¸‹æ–‡é™åˆ¶ã€‚å› æ­¤ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå‹ç¼©ä¿¡æ¯å˜å¾—å¿…è¦ã€‚ä¿¡æ¯å‹ç¼©å¯¹äºå‡å°‘å™ªå£°ã€è§£å†³ä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶å’Œå¢å¼ºç”Ÿæˆæ•ˆæœè‡³å…³é‡è¦ã€‚&lt;/p&gt;
&lt;p&gt;PRCAé€šè¿‡è®­ç»ƒä¸€ä¸ªä¿¡æ¯æå–å™¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜[Yangç­‰äººï¼Œ2023b]ã€‚åœ¨ä¸Šä¸‹æ–‡æå–é˜¶æ®µï¼Œå½“æä¾›è¾“å…¥æ–‡æœ¬$S_{input}$æ—¶ï¼Œå®ƒèƒ½å¤Ÿäº§ç”Ÿä¸€ä¸ªè¾“å‡ºåºåˆ—$C_{extracted}$ï¼Œä»£è¡¨è¾“å…¥æ–‡æ¡£çš„å‹ç¼©ä¸Šä¸‹æ–‡ã€‚è®­ç»ƒè¿‡ç¨‹æ—¨åœ¨æœ€å°åŒ–$C_{extracted}$å’Œå®é™…ä¸Šä¸‹æ–‡$C_{truth}$ä¹‹é—´çš„å·®å¼‚ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ ·ï¼ŒRECOMPé‡‡ç”¨ç±»ä¼¼çš„æ–¹æ³•ï¼Œé€šè¿‡å¯¹æ¯”å­¦ä¹ è®­ç»ƒä¸€ä¸ªä¿¡æ¯å‹ç¼©å™¨[Xuç­‰äººï¼Œ2023a]ã€‚æ¯ä¸ªè®­ç»ƒæ•°æ®ç‚¹åŒ…æ‹¬ä¸€ä¸ªæ­£æ ·æœ¬å’Œäº”ä¸ªè´Ÿæ ·æœ¬ï¼Œç¼–ç å™¨åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ä½¿ç”¨å¯¹æ¯”æŸå¤±è¿›è¡Œè®­ç»ƒ[Karpukhinç­‰äººï¼Œ2020]ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€é¡¹ç ”ç©¶é‡‡å–äº†ä¸åŒçš„æ–¹æ³•ï¼Œæ—¨åœ¨å‡å°‘æ–‡æ¡£æ•°é‡ä»¥æé«˜æ¨¡å‹ç­”æ¡ˆçš„å‡†ç¡®æ€§ã€‚åœ¨[Maç­‰äººï¼Œ2023b]çš„ç ”ç©¶ä¸­ï¼Œä»–ä»¬æå‡ºäº†â€œFilter-Rerankerâ€èŒƒå¼ï¼Œç»“åˆäº†LLMså’Œå°å‹è¯­è¨€æ¨¡å‹ï¼ˆSLMsï¼‰çš„ä¼˜åŠ¿ã€‚åœ¨è¿™ä¸ªèŒƒå¼ä¸­ï¼ŒSLMså……å½“è¿‡æ»¤å™¨ï¼Œè€ŒLLMså……å½“é‡æ–°æ’åºä»£ç†ã€‚ç ”ç©¶è¡¨æ˜ï¼ŒæŒ‡å¯¼LLMsé‡æ–°æ’åˆ—SLMsè¯†åˆ«å‡ºçš„å…·æœ‰æŒ‘æˆ˜æ€§çš„æ ·æœ¬ï¼Œå¯ä»¥åœ¨å„ç§ä¿¡æ¯æå–ï¼ˆIEï¼‰ä»»åŠ¡ä¸­å–å¾—æ˜¾è‘—æ”¹è¿›ã€‚&lt;/p&gt;
&lt;h4 id=&#34;é‡æ–°æ’åreranking&#34;&gt;é‡æ–°æ’å(&lt;strong&gt;Reranking&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;é‡æ–°æ’åæ¨¡å‹åœ¨ä¼˜åŒ–æ£€ç´¢å™¨æ£€ç´¢åˆ°çš„æ–‡æ¡£é›†ä¸­èµ·ç€å…³é”®ä½œç”¨ã€‚è¯­è¨€æ¨¡å‹åœ¨å¼•å…¥é¢å¤–ä¸Šä¸‹æ–‡æ—¶ç»å¸¸é¢ä¸´æ€§èƒ½ä¸‹é™ï¼Œé‡æ–°æ’åæœ‰æ•ˆåœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚æ ¸å¿ƒæ¦‚å¿µæ¶‰åŠé‡æ–°æ’åˆ—æ–‡æ¡£è®°å½•ï¼Œä»¥ä¼˜å…ˆè€ƒè™‘æœ€ç›¸å…³çš„é¡¹ç›®ï¼Œä»è€Œé™åˆ¶æ–‡æ¡£æ€»æ•°ã€‚è¿™ä¸ä»…è§£å†³äº†æ£€ç´¢è¿‡ç¨‹ä¸­ä¸Šä¸‹æ–‡çª—å£æ‰©å±•çš„æŒ‘æˆ˜ï¼Œè¿˜æé«˜äº†æ£€ç´¢æ•ˆç‡å’Œå“åº”æ€§ã€‚&lt;/p&gt;
&lt;p&gt;é‡æ–°æ’åæ¨¡å‹åœ¨ä¿¡æ¯æ£€ç´¢è¿‡ç¨‹ä¸­æ‰®æ¼”åŒé‡è§’è‰²ï¼Œæ—¢æ˜¯ä¼˜åŒ–å™¨åˆæ˜¯ç²¾ç‚¼å™¨ã€‚å®ƒä¸ºåç»­çš„è¯­è¨€æ¨¡å‹å¤„ç†æä¾›äº†æ›´æœ‰æ•ˆå’Œå‡†ç¡®çš„è¾“å…¥[Zhuangç­‰äººï¼Œ2023]ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šä¸‹æ–‡å‹ç¼©è¢«çº³å…¥é‡æ–°æ’åºè¿‡ç¨‹ä¸­ï¼Œä»¥æä¾›æ›´ç²¾ç¡®çš„æ£€ç´¢ä¿¡æ¯ã€‚è¿™ç§æ–¹æ³•æ¶‰åŠå‡å°‘å•ä¸ªæ–‡æ¡£çš„å†…å®¹å’Œè¿‡æ»¤æ•´ä¸ªæ–‡æ¡£ï¼Œæœ€ç»ˆç›®æ ‡æ˜¯åœ¨æœç´¢ç»“æœä¸­å‘ˆç°æœ€ç›¸å…³çš„ä¿¡æ¯ï¼Œä»¥ä¾¿æ›´ä¸“æ³¨å’Œå‡†ç¡®åœ°æ˜¾ç¤ºç›¸å…³å†…å®¹ã€‚&lt;/p&gt;
&lt;h3 id=&#34;52-ä¸ºragå¾®è°ƒllm-fine-tuning-llm-for-rag&#34;&gt;5.2 ä¸ºRAGå¾®è°ƒLLM( &lt;strong&gt;Fine-tuning LLM for RAG&lt;/strong&gt;)&lt;/h3&gt;
&lt;p&gt;ä¼˜åŒ–RAGæ¨¡å‹ä¸­çš„ç”Ÿæˆå™¨æ˜¯å…¶æ¶æ„çš„å…³é”®æ–¹é¢ã€‚ç”Ÿæˆå™¨çš„è§’è‰²æ˜¯æ¥æ”¶æ£€ç´¢åˆ°çš„ä¿¡æ¯å¹¶ç”Ÿæˆç›¸å…³æ–‡æœ¬ï¼Œå½¢æˆæ¨¡å‹çš„æœ€ç»ˆè¾“å‡ºã€‚ç”Ÿæˆå™¨çš„ä¼˜åŒ–æ—¨åœ¨ç¡®ä¿ç”Ÿæˆçš„æ–‡æœ¬æ—¢è‡ªç„¶åˆæœ‰æ•ˆåœ°åˆ©ç”¨æ£€ç´¢åˆ°çš„æ–‡æ¡£ï¼Œä»¥æ›´å¥½åœ°æ»¡è¶³ç”¨æˆ·çš„æŸ¥è¯¢éœ€æ±‚ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ ‡å‡†çš„LLMç”Ÿæˆä»»åŠ¡ä¸­ï¼Œè¾“å…¥é€šå¸¸åŒ…æ‹¬ä¸€ä¸ªæŸ¥è¯¢ã€‚RAGé€šè¿‡å°†æŸ¥è¯¢å’Œæ£€ç´¢å™¨æ£€ç´¢åˆ°çš„å„ç§æ–‡æ¡£ï¼ˆç»“æ„åŒ–/éç»“æ„åŒ–ï¼‰æ•´åˆåˆ°è¾“å…¥ä¸­è€Œè„±é¢–è€Œå‡ºã€‚è¿™ç§é¢å¤–çš„ä¿¡æ¯å¯ä»¥æ˜¾è‘—å½±å“æ¨¡å‹çš„ç†è§£ï¼Œå°¤å…¶æ˜¯å¯¹äºè¾ƒå°çš„æ¨¡å‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¾®è°ƒæ¨¡å‹ä»¥é€‚åº”æŸ¥è¯¢å’Œæ£€ç´¢åˆ°çš„æ–‡æ¡£çš„è¾“å…¥å˜å¾—è‡³å…³é‡è¦ã€‚åœ¨å°†è¾“å…¥å‘ˆç°ç»™å¾®è°ƒæ¨¡å‹ä¹‹å‰ï¼Œé€šå¸¸ä¼šå¯¹æ£€ç´¢å™¨æ£€ç´¢åˆ°çš„æ–‡æ¡£è¿›è¡Œåæ£€ç´¢å¤„ç†ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒRAGä¸­ç”Ÿæˆå™¨çš„å¾®è°ƒæ–¹æ³•ä¸LLMsçš„ä¸€èˆ¬å¾®è°ƒæ–¹æ³•ä¸€è‡´ã€‚ä»¥ä¸‹ï¼Œæˆ‘ä»¬å°†ç®€è¦æè¿°ä¸€äº›æ¶‰åŠæ•°æ®ï¼ˆæ ¼å¼åŒ–/éæ ¼å¼åŒ–ï¼‰å’Œä¼˜åŒ–åŠŸèƒ½çš„ä»£è¡¨æ€§å·¥ä½œã€‚&lt;/p&gt;
&lt;h4 id=&#34;ä¸€èˆ¬ä¼˜åŒ–è¿‡ç¨‹general-optimization-process&#34;&gt;ä¸€èˆ¬ä¼˜åŒ–è¿‡ç¨‹(&lt;strong&gt;General Optimization Process&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;ä½œä¸ºä¸€èˆ¬ä¼˜åŒ–è¿‡ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œè®­ç»ƒæ•°æ®é€šå¸¸åŒ…æ‹¬è¾“å…¥-è¾“å‡ºå¯¹ï¼Œæ—¨åœ¨è®­ç»ƒæ¨¡å‹åœ¨ç»™å®šè¾“å…¥xçš„æƒ…å†µä¸‹äº§ç”Ÿè¾“å‡ºyã€‚åœ¨Self-Mem[Chengç­‰äººï¼Œ2023b]çš„å·¥ä½œä¸­ï¼Œé‡‡ç”¨äº†ä¼ ç»Ÿçš„è®­ç»ƒè¿‡ç¨‹ï¼Œå…¶ä¸­ç»™å®šè¾“å…¥xï¼Œæ£€ç´¢ç›¸å…³æ–‡æ¡£zï¼ˆåœ¨è®ºæ–‡ä¸­é€‰æ‹©Top-1ï¼‰ï¼Œå¹¶åœ¨æ•´åˆï¼ˆxï¼Œzï¼‰åï¼Œæ¨¡å‹ç”Ÿæˆè¾“å‡ºyã€‚è¯¥è®ºæ–‡åˆ©ç”¨äº†ä¸¤ç§å¸¸è§çš„å¾®è°ƒèŒƒå¼ï¼Œå³Joint-Encoderå’ŒDual-Encoder[Aroraç­‰äººï¼Œ2023ï¼ŒWangç­‰äººï¼Œ2022bï¼ŒLewisç­‰äººï¼Œ2020ï¼ŒXiaç­‰äººï¼Œ2019ï¼ŒCaiç­‰äººï¼Œ2021ï¼ŒChengç­‰äººï¼Œ2022]ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Joint-EncoderèŒƒå¼ä¸­ï¼Œä½¿ç”¨åŸºäºç¼–ç å™¨-è§£ç å™¨çš„æ ‡å‡†æ¨¡å‹ã€‚è¿™é‡Œï¼Œç¼–ç å™¨é¦–å…ˆç¼–ç è¾“å…¥ï¼Œç„¶åè§£ç å™¨é€šè¿‡æ³¨æ„åŠ›æœºåˆ¶ç»“åˆç¼–ç ç»“æœä»¥è‡ªå›å½’æ–¹å¼ç”Ÿæˆæ ‡è®°ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨Dual-EncoderèŒƒå¼ä¸­ï¼Œç³»ç»Ÿè®¾ç½®ä¸¤ä¸ªç‹¬ç«‹çš„ç¼–ç å™¨ï¼Œæ¯ä¸ªç¼–ç å™¨åˆ†åˆ«ç¼–ç è¾“å…¥ï¼ˆæŸ¥è¯¢ï¼Œä¸Šä¸‹æ–‡ï¼‰å’Œæ–‡æ¡£ã€‚ç„¶åï¼Œè§£ç å™¨æŒ‰é¡ºåºå¯¹è¿™ä¸¤ä¸ªè¾“å‡ºè¿›è¡ŒåŒå‘äº¤å‰æ³¨æ„åŠ›å¤„ç†ã€‚è¿™ä¸¤ç§æ¶æ„éƒ½ä½¿ç”¨Transformer[Vaswaniç­‰äººï¼Œ2017]ä½œä¸ºåŸºç¡€å—ï¼Œå¹¶ä½¿ç”¨&lt;strong&gt;è´Ÿå¯¹æ•°ä¼¼ç„¶æŸå¤±&lt;/strong&gt;(Negative Log-Likelihood loss)è¿›è¡Œä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;h4 id=&#34;åˆ©ç”¨å¯¹æ¯”å­¦ä¹ utilizing-contrastive-learning&#34;&gt;åˆ©ç”¨å¯¹æ¯”å­¦ä¹ (&lt;strong&gt;Utilizing Contrastive Learning&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;åœ¨ä¸ºè¯­è¨€æ¨¡å‹å‡†å¤‡è®­ç»ƒæ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ä¼šåˆ›å»ºè¾“å…¥å’Œè¾“å‡ºçš„äº¤äº’å¯¹ã€‚è¿™ç§ä¼ ç»Ÿæ–¹æ³•å¯èƒ½å¯¼è‡´â€œæ›å…‰åå·®(exposure bias)â€ï¼Œå³æ¨¡å‹ä»…åœ¨è®­ç»ƒæ•°æ®ä¸­é‡åˆ°çš„ä¸ªåˆ«æ­£ç¡®è¾“å‡ºç¤ºä¾‹ä¸Šè¿›è¡Œè®­ç»ƒï¼Œä»è€Œé™åˆ¶äº†æ¨¡å‹åœ¨å„ç§å¯èƒ½è¾“å‡ºä¸­çš„æ³›åŒ–èƒ½åŠ›ã€‚è¿™ç§é™åˆ¶å¯èƒ½ä¼šé€šè¿‡ä½¿æ¨¡å‹è¿‡åº¦æ‹Ÿåˆè®­ç»ƒé›†ä¸­çš„ç‰¹å®šç¤ºä¾‹ï¼Œä»è€Œé™ä½æ¨¡å‹åœ¨ç°å®ä¸–ç•Œæ€§èƒ½ä¸­çš„æ³›åŒ–èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç¼“è§£æ›å…‰åå·®ï¼ŒSURGE[Kangç­‰äººï¼Œ2023]æå‡ºäº†ä½¿ç”¨å›¾-æ–‡æœ¬å¯¹æ¯”å­¦ä¹ ã€‚è¿™ç§æ–¹æ³•åŒ…æ‹¬ä¸€ä¸ªå¯¹æ¯”å­¦ä¹ ç›®æ ‡ï¼Œä¿ƒä½¿æ¨¡å‹äº§ç”Ÿä¸€ç³»åˆ—åˆç†ä¸”è¿è´¯çš„å“åº”ï¼Œè¶…è¶Šäº†è®­ç»ƒæ•°æ®ä¸­é‡åˆ°çš„å®ä¾‹ã€‚è¿™ç§æ–¹æ³•å¯¹äºå‡å°‘è¿‡æ‹Ÿåˆå¹¶åŠ å¼ºæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›è‡³å…³é‡è¦ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºæ¶‰åŠç»“æ„åŒ–æ•°æ®çš„æ£€ç´¢ä»»åŠ¡ï¼ŒSANTAæ¡†æ¶[Liç­‰äººï¼Œ2023d]å®æ–½äº†ä¸‰éƒ¨åˆ†è®­ç»ƒæ–¹æ¡ˆï¼Œæœ‰æ•ˆåœ°å°è£…äº†ç»“æ„å’Œè¯­ä¹‰ç»†èŠ‚ã€‚åˆå§‹é˜¶æ®µä¸“æ³¨äºæ£€ç´¢å™¨ï¼Œå…¶ä¸­å¯¹æ¯”å­¦ä¹ è¢«ç”¨æ¥å®Œå–„æŸ¥è¯¢å’Œæ–‡æ¡£åµŒå…¥ã€‚&lt;/p&gt;
&lt;p&gt;éšåï¼Œç”Ÿæˆå™¨çš„åˆæ­¥è®­ç»ƒé˜¶æ®µä½¿ç”¨å¯¹æ¯”å­¦ä¹ å°†ç»“æ„åŒ–æ•°æ®ä¸å…¶éç»“æ„åŒ–æ–‡æ¡£æè¿°å¯¹é½ã€‚åœ¨ç”Ÿæˆå™¨è®­ç»ƒçš„è¿›ä¸€æ­¥é˜¶æ®µï¼Œæ¨¡å‹è®¤è¯†åˆ°å®ä½“è¯­ä¹‰åœ¨æ–‡æœ¬æ•°æ®è¡¨ç¤ºå­¦ä¹ ä¸­çš„å…³é”®ä½œç”¨ï¼Œå¦‚[Sciavolinoç­‰äººï¼Œ2021ï¼ŒZhangç­‰äººï¼Œ2019]æ‰€å¼ºè°ƒã€‚è¿™ä¸ªè¿‡ç¨‹ä»è¯†åˆ«ç»“æ„åŒ–æ•°æ®ä¸­çš„å®ä½“å¼€å§‹ï¼Œç„¶ååœ¨ç”Ÿæˆå™¨çš„è¾“å…¥æ•°æ®ä¸­å¯¹è¿™äº›å®ä½“åº”ç”¨æ©ç ï¼Œä¸ºæ¨¡å‹é¢„æµ‹å’Œé¢„æµ‹è¿™äº›æ©è”½å…ƒç´ åšå¥½å‡†å¤‡ã€‚&lt;/p&gt;
&lt;p&gt;è®­ç»ƒæ–¹æ¡ˆéšç€æ¨¡å‹å­¦ä¹ åˆ©ç”¨ä¸Šä¸‹æ–‡ä¿¡æ¯é‡å»ºæ©è”½å®ä½“è€Œè¿›å±•ã€‚è¿™ç§ç»ƒä¹ åŸ¹å…»äº†æ¨¡å‹å¯¹æ–‡æœ¬æ•°æ®ç»“æ„è¯­ä¹‰çš„ç†è§£ï¼Œå¹¶ä¿ƒè¿›äº†ç»“æ„åŒ–æ•°æ®ä¸­ç›¸å…³å®ä½“çš„å¯¹é½ã€‚æ€»ä½“ä¼˜åŒ–ç›®æ ‡æ˜¯è®­ç»ƒè¯­è¨€æ¨¡å‹å‡†ç¡®åœ°æ¢å¤è¢«æ©ç›–çš„è·¨åº¦ï¼Œä»è€Œä¸°å¯Œå…¶å¯¹å®ä½“è¯­ä¹‰çš„ç†è§£[Yeç­‰äººï¼Œ2020]ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬6ç« ragä¸­çš„å¢å¼º&#34;&gt;ç¬¬6ç« ï¼šRAGä¸­çš„å¢å¼º&lt;/h2&gt;
&lt;p&gt;æœ¬èŠ‚å›´ç»•ä¸‰ä¸ªå…³é”®æ–¹é¢å±•å¼€ï¼šå¢å¼ºé˜¶æ®µã€å¢å¼ºæ•°æ®çš„æ¥æºå’Œå¢å¼ºè¿‡ç¨‹ã€‚è¿™äº›æ–¹é¢é˜æ˜äº†å¯¹RAGå‘å±•è‡³å…³é‡è¦çš„å…³é”®æŠ€æœ¯ã€‚RAGæ ¸å¿ƒç»„ä»¶çš„åˆ†ç±»å¦‚å›¾4æ‰€ç¤ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/rag/RAG_for_LLMs_A_Survey/4.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;61-rag-å¢å¼ºé˜¶æ®µ-rag-in-augmentation-stages&#34;&gt;6.1 RAG å¢å¼ºé˜¶æ®µ( &lt;strong&gt;RAG in Augmentation Stages&lt;/strong&gt;)&lt;/h3&gt;
&lt;p&gt;RAGæ˜¯ä¸€ä¸ªçŸ¥è¯†å¯†é›†å‹çš„åŠªåŠ›(knowledge-intensive endeavor)ï¼Œå®ƒåœ¨è¯­è¨€æ¨¡å‹è®­ç»ƒçš„é¢„è®­ç»ƒã€å¾®è°ƒå’Œæ¨ç†é˜¶æ®µé‡‡ç”¨äº†å„ç§æŠ€æœ¯æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h4 id=&#34;é¢„è®­ç»ƒé˜¶æ®µpre-training-stage&#34;&gt;é¢„è®­ç»ƒé˜¶æ®µ(&lt;strong&gt;Pre-training Stage&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;åœ¨é¢„è®­ç»ƒé˜¶æ®µï¼Œç ”ç©¶äººå‘˜å·²ç»ç ”ç©¶äº†é€šè¿‡åŸºäºæ£€ç´¢çš„ç­–ç•¥æ¥å¢å¼ºå¼€æ”¾é¢†åŸŸé—®ç­”ï¼ˆQAï¼‰çš„é¢„è®­ç»ƒæ¨¡å‹ï¼ˆPTMsï¼‰çš„æ–¹æ³•ã€‚REALMæ¨¡å‹é‡‡ç”¨äº†ä¸€ç§ç»“æ„åŒ–ã€å¯è§£é‡Šçš„çŸ¥è¯†åµŒå…¥æ–¹æ³•ï¼Œå°†é¢„è®­ç»ƒå’Œå¾®è°ƒæ¡†å®šä¸ºåœ¨æ©ç è¯­è¨€æ¨¡å‹ï¼ˆMLMï¼‰æ¡†æ¶å†…çš„æ£€ç´¢ç„¶åé¢„æµ‹çš„å·¥ä½œæµç¨‹[Aroraç­‰äººï¼Œ2023]ã€‚&lt;/p&gt;
&lt;p&gt;RETRO[Borgeaudç­‰äººï¼Œ2022]åˆ©ç”¨æ£€ç´¢å¢å¼ºè¿›è¡Œå¤§è§„æ¨¡é¢„è®­ç»ƒï¼Œå®ç°äº†æ¨¡å‹å‚æ•°çš„å‡å°‘ï¼ŒåŒæ—¶åœ¨å›°æƒ‘åº¦æ–¹é¢è¶…è¶Šäº†æ ‡å‡†GPTæ¨¡å‹ã€‚RETROçš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºå®ƒè®¾è®¡äº†ä¸€ä¸ªé¢å¤–çš„ç¼–ç å™¨æ¥å¤„ç†ä»å¤–éƒ¨çŸ¥è¯†åº“æ£€ç´¢åˆ°çš„å®ä½“çš„ç‰¹å¾ï¼Œè¿™æ˜¯åœ¨GPTæ¨¡å‹çš„åŸºç¡€ä¸Šæ„å»ºçš„ã€‚&lt;/p&gt;
&lt;p&gt;Atlas[Izacardç­‰äººï¼Œ2022]ä¹Ÿåœ¨T5æ¶æ„çš„é¢„è®­ç»ƒå’Œå¾®è°ƒé˜¶æ®µå¼•å…¥äº†æ£€ç´¢æœºåˆ¶ã€‚å®ƒä½¿ç”¨é¢„è®­ç»ƒçš„T5æ¥åˆå§‹åŒ–ç¼–ç å™¨-è§£ç å™¨è¯­è¨€æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨é¢„è®­ç»ƒçš„Contrieverä½œä¸ºå¯†é›†æ£€ç´¢å™¨ï¼Œæé«˜äº†å…¶åœ¨å¤æ‚è¯­è¨€å»ºæ¨¡ä»»åŠ¡ä¸­çš„æ•ˆç‡ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼ŒCOG[Lanç­‰äººï¼Œ2022]å¼•å…¥äº†ä¸€ç§æ–°é¢–çš„æ–‡æœ¬ç”Ÿæˆæ–¹æ³•ï¼Œæ¨¡ä»¿ä»é¢„å…ˆå­˜åœ¨çš„é›†åˆä¸­å¤åˆ¶æ–‡æœ¬ç‰‡æ®µã€‚åˆ©ç”¨é«˜æ•ˆçš„å‘é‡æœç´¢å·¥å…·ï¼ŒCOGè®¡ç®—å¹¶ç´¢å¼•æ–‡æœ¬ç‰‡æ®µçš„ä¸Šä¸‹æ–‡æ„ä¹‰è¡¨ç¤ºï¼Œåœ¨é—®ç­”å’Œé¢†åŸŸé€‚åº”ç­‰åŸŸä¸­è¡¨ç°å‡ºä¼˜äºRETROçš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;éšç€è§„æ¨¡æ³•åˆ™çš„å‡ºç°ï¼Œæ¨¡å‹å‚æ•°çš„å¢é•¿æ¨åŠ¨äº†è‡ªå›å½’æ¨¡å‹æˆä¸ºä¸»æµã€‚ç ”ç©¶äººå‘˜æ­£åœ¨å°†RAGæ–¹æ³•æ‰©å±•åˆ°æ›´å¤§çš„é¢„è®­ç»ƒæ¨¡å‹ï¼ŒRETRO++å°±æ˜¯è¿™ä¸€è¶‹åŠ¿çš„å…¸èŒƒï¼Œå®ƒæ‰©å¤§äº†æ¨¡å‹å‚æ•°ï¼ŒåŒæ—¶ä¿æŒæˆ–æé«˜äº†æ€§èƒ½[Wangç­‰äººï¼Œ2023b]ã€‚&lt;/p&gt;
&lt;p&gt;å®è¯è¯æ®å¼ºè°ƒäº†åœ¨æ–‡æœ¬ç”Ÿæˆè´¨é‡ã€äº‹å®å‡†ç¡®æ€§ã€å‡å°‘æ¯’æ€§() reduced toxicityå’Œä¸‹æ¸¸ä»»åŠ¡ç†Ÿç»ƒåº¦æ–¹é¢çš„æ˜¾è‘—æ”¹è¿›ï¼Œç‰¹åˆ«æ˜¯åœ¨å¼€æ”¾é¢†åŸŸé—®ç­”ç­‰çŸ¥è¯†å¯†é›†å‹åº”ç”¨ä¸­ã€‚è¿™äº›ç»“æœè¡¨æ˜ï¼Œå°†æ£€ç´¢æœºåˆ¶æ•´åˆåˆ°è‡ªå›å½’è¯­è¨€æ¨¡å‹çš„é¢„è®­ç»ƒä¸­æ˜¯ä¸€ä¸ªæœ‰å‰æ™¯çš„é€”å¾„ï¼Œå°†å¤æ‚çš„æ£€ç´¢æŠ€æœ¯ä¸åºå¤§çš„è¯­è¨€æ¨¡å‹ç›¸ç»“åˆï¼Œä»¥äº§ç”Ÿæ›´ç²¾ç¡®ã€æ›´é«˜æ•ˆçš„è¯­è¨€ç”Ÿæˆã€‚&lt;/p&gt;
&lt;p&gt;å¢å¼ºé¢„è®­ç»ƒçš„å¥½å¤„åŒ…æ‹¬ä¸€ä¸ªå¼ºå¤§çš„åŸºç¡€æ¨¡å‹ï¼Œå…¶åœ¨å›°æƒ‘åº¦ã€æ–‡æœ¬ç”Ÿæˆè´¨é‡å’Œç‰¹å®šä»»åŠ¡æ€§èƒ½æ–¹é¢éƒ½ä¼˜äºæ ‡å‡†GPTæ¨¡å‹ï¼ŒåŒæ—¶ä½¿ç”¨çš„å‚æ•°æ›´å°‘ã€‚è¿™ç§æ–¹æ³•ç‰¹åˆ«æ“…é•¿å¤„ç†çŸ¥è¯†å¯†é›†å‹ä»»åŠ¡ï¼Œå¹¶æœ‰åŠ©äºé€šè¿‡åœ¨ä¸“ä¸šè¯­æ–™åº“ä¸Šè¿›è¡Œè®­ç»ƒæ¥å¼€å‘é¢†åŸŸç‰¹å®šæ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡è¿™ç§æ–¹æ³•é¢ä¸´è¯¸å¦‚éœ€è¦å¤§é‡é¢„è®­ç»ƒæ•°æ®é›†å’Œèµ„æºä»¥åŠéšç€æ¨¡å‹å¤§å°å¢åŠ æ›´æ–°é¢‘ç‡é™ä½ç­‰æŒ‘æˆ˜ï¼Œä½†è¿™ç§æ–¹æ³•åœ¨æ¨¡å‹éŸ§æ€§æ–¹é¢æä¾›äº†æ˜¾è‘—çš„ä¼˜åŠ¿ã€‚ä¸€æ—¦è®­ç»ƒå®Œæˆï¼Œå¢å¼ºæ£€ç´¢æ¨¡å‹å¯ä»¥ç‹¬ç«‹äºå¤–éƒ¨åº“è¿è¡Œï¼Œæé«˜ç”Ÿæˆé€Ÿåº¦å’Œæ“ä½œæ•ˆç‡ã€‚è¿™äº›æ½œåœ¨çš„æ”¶ç›Šä½¿å¾—è¿™ç§æ–¹æ³•æˆä¸ºäººå·¥æ™ºèƒ½å’Œæœºå™¨å­¦ä¹ ä¸­æŒç»­ç ”ç©¶å’Œåˆ›æ–°çš„ä¸€ä¸ªå¼•äººå…¥èƒœçš„ä¸»é¢˜ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å¾®è°ƒé˜¶æ®µfine-tuning-stage&#34;&gt;å¾®è°ƒé˜¶æ®µ(&lt;strong&gt;Fine-tuning Stage&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;RAGå’Œå¾®è°ƒæ˜¯å¢å¼ºLLMsçš„å¼ºå¤§å·¥å…·ï¼Œå°†ä¸¤è€…ç»“åˆèµ·æ¥å¯ä»¥æ»¡è¶³æ›´ç‰¹å®šåœºæ™¯çš„éœ€æ±‚ã€‚ä¸€æ–¹é¢ï¼Œå¾®è°ƒå…è®¸æ£€ç´¢å…·æœ‰ç‹¬ç‰¹é£æ ¼çš„æ–‡æ¡£ï¼Œå®ç°æ›´å¥½çš„è¯­ä¹‰è¡¨è¾¾ï¼Œå¹¶è°ƒæ•´æŸ¥è¯¢å’Œæ–‡æ¡£ä¹‹é—´çš„å·®å¼‚ã€‚è¿™ç¡®ä¿äº†æ£€ç´¢å™¨çš„è¾“å‡ºæ›´é€‚åˆå½“å‰åœºæ™¯ã€‚å¦ä¸€æ–¹é¢ï¼Œå¾®è°ƒå¯ä»¥æ»¡è¶³ç”Ÿæˆéœ€æ±‚ï¼Œè¿›è¡Œé£æ ¼åŒ–å’Œé’ˆå¯¹æ€§çš„è°ƒæ•´ã€‚æ­¤å¤–ï¼Œå¾®è°ƒè¿˜å¯ä»¥ç”¨äºè°ƒæ•´æ£€ç´¢å™¨å’Œç”Ÿæˆå™¨ï¼Œä»¥æé«˜æ¨¡å‹çš„ååŒä½œç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å¾®è°ƒæ£€ç´¢å™¨çš„ä¸»è¦ç›®æ ‡æ˜¯æé«˜è¯­ä¹‰è¡¨ç¤ºçš„è´¨é‡ï¼Œé€šè¿‡ç›´æ¥å¾®è°ƒåµŒå…¥æ¨¡å‹æ¥å®ç°ï¼Œä½¿ç”¨è¯­æ–™åº“[Liuï¼Œ2023]ã€‚é€šè¿‡åé¦ˆä¿¡å·å°†æ£€ç´¢å™¨çš„èƒ½åŠ›ä¸LLMsçš„åå¥½å¯¹é½ï¼Œä¸¤è€…å¯ä»¥æ›´å¥½åœ°åè°ƒ[Yuç­‰äººï¼Œ2023bï¼ŒIzacardç­‰äººï¼Œ2022ï¼ŒYangç­‰äººï¼Œ2023bï¼ŒShiç­‰äººï¼Œ2023]ã€‚é’ˆå¯¹ç‰¹å®šä¸‹æ¸¸ä»»åŠ¡å¾®è°ƒæ£€ç´¢å™¨å¯ä»¥æé«˜é€‚åº”æ€§ã€‚å¼•å…¥ä»»åŠ¡æ— å…³çš„å¾®è°ƒæ—¨åœ¨æé«˜æ£€ç´¢å™¨åœ¨å¤šä»»åŠ¡åœºæ™¯ä¸­çš„å¤šåŠŸèƒ½æ€§[Chengç­‰äººï¼Œ2023a]ã€‚&lt;/p&gt;
&lt;p&gt;å¾®è°ƒç”Ÿæˆå™¨å¯ä»¥äº§ç”Ÿæ›´é£æ ¼åŒ–å’Œå®šåˆ¶åŒ–çš„è¾“å‡ºã€‚ä¸€æ–¹é¢ï¼Œå®ƒå…è®¸é’ˆå¯¹ä¸åŒçš„è¾“å…¥æ•°æ®æ ¼å¼è¿›è¡Œä¸“é—¨çš„é€‚åº”ã€‚ä¾‹å¦‚ï¼Œå¾®è°ƒLLMsä»¥é€‚åº”çŸ¥è¯†å›¾çš„ç»“æ„[Kangç­‰äººï¼Œ2023]ï¼Œæ–‡æœ¬å¯¹çš„ç»“æ„[Kangç­‰äººï¼Œ2023ï¼ŒChengç­‰äººï¼Œ2023b]ï¼Œä»¥åŠå…¶ä»–ç‰¹å®šç»“æ„[Liç­‰äººï¼Œ2023d]ã€‚å¦ä¸€æ–¹é¢ï¼Œé€šè¿‡æ„å»ºæŒ‡ä»¤æ•°æ®é›†ï¼Œå¯ä»¥è¦æ±‚LLMsç”Ÿæˆç‰¹å®šæ ¼å¼çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œåœ¨é€‚åº”æ€§æˆ–è¿­ä»£æ£€ç´¢åœºæ™¯ä¸­ï¼ŒLLMsè¢«å¾®è°ƒä»¥ç”Ÿæˆæœ‰åŠ©äºç¡®å®šä¸‹ä¸€æ­¥è¡ŒåŠ¨æ—¶æœºçš„å†…å®¹[Jiangç­‰äººï¼Œ2023bï¼ŒAsaiç­‰äººï¼Œ2023]ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ååŒå¾®è°ƒæ£€ç´¢å™¨å’Œç”Ÿæˆå™¨ï¼Œæˆ‘ä»¬å¯ä»¥æé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼Œé¿å…å› å•ç‹¬è®­ç»ƒå®ƒä»¬è€Œå¯èƒ½å‡ºç°çš„è¿‡æ‹Ÿåˆã€‚ç„¶è€Œï¼Œè”åˆå¾®è°ƒä¹Ÿå¯¼è‡´äº†èµ„æºæ¶ˆè€—çš„å¢åŠ ã€‚RA-DIT[Linç­‰äººï¼Œ2023]æå‡ºäº†ä¸€ä¸ªè½»é‡çº§çš„åŒæŒ‡ä»¤å¾®è°ƒæ¡†æ¶ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ä¸ºä»»ä½•LLMsæ·»åŠ æ£€ç´¢èƒ½åŠ›ã€‚æ£€ç´¢å¢å¼ºçš„æŒ‡ä»¤å¾®è°ƒæ›´æ–°LLMï¼Œå¼•å¯¼å®ƒæ›´æœ‰æ•ˆåœ°åˆ©ç”¨æ£€ç´¢åˆ°çš„ä¿¡æ¯ï¼Œå¹¶å¿½ç•¥åˆ†æ•£æ³¨æ„åŠ›çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;å°½ç®¡å®ƒå…·æœ‰ä¼˜åŠ¿ï¼Œä½†å¾®è°ƒä¹Ÿæœ‰å±€é™æ€§ï¼ŒåŒ…æ‹¬éœ€è¦ä¸“é—¨çš„RAGå¾®è°ƒæ•°æ®é›†å’Œå¤§é‡çš„è®¡ç®—èµ„æºã€‚ç„¶è€Œï¼Œè¿™ä¸ªé˜¶æ®µå…è®¸æ ¹æ®ç‰¹å®šéœ€æ±‚å’Œæ•°æ®æ ¼å¼å®šåˆ¶æ¨¡å‹ï¼Œå¯èƒ½ä¸é¢„è®­ç»ƒé˜¶æ®µç›¸æ¯”å‡å°‘èµ„æºä½¿ç”¨ï¼ŒåŒæ—¶ä»èƒ½å¤Ÿå¾®è°ƒæ¨¡å‹çš„è¾“å‡ºé£æ ¼ã€‚&lt;/p&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œå¾®è°ƒé˜¶æ®µå¯¹äºRAGæ¨¡å‹é€‚åº”ç‰¹å®šä»»åŠ¡è‡³å…³é‡è¦ï¼Œå®ƒå¢å¼ºäº†æ£€ç´¢å™¨å’Œç”Ÿæˆå™¨çš„å¤šåŠŸèƒ½æ€§å’Œé€‚åº”æ€§ï¼Œå°½ç®¡èµ„æºå’Œæ•°æ®é›†è¦æ±‚å¸¦æ¥äº†æŒ‘æˆ˜ã€‚RAGæ¨¡å‹çš„æˆ˜ç•¥å¾®è°ƒå› æ­¤æ˜¯å¼€å‘é«˜æ•ˆã€æœ‰æ•ˆçš„æ£€ç´¢å¢å¼ºç³»ç»Ÿçš„å…³é”®ç»„æˆéƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ¨ç†é˜¶æ®µinference-stage&#34;&gt;æ¨ç†é˜¶æ®µ(&lt;strong&gt;Inference Stage&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;RAGæ¨¡å‹çš„æ¨ç†é˜¶æ®µè‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒæ¶‰åŠä¸LLMsçš„å¹¿æ³›é›†æˆã€‚ä¼ ç»Ÿçš„RAGæ–¹æ³•ï¼Œä¹Ÿç§°ä¸ºæœ´ç´ RAGï¼Œæ¶‰åŠåœ¨è¿™ä¸ªé˜¶æ®µå°†æ£€ç´¢å†…å®¹æ•´åˆåˆ°ç”Ÿæˆè¿‡ç¨‹ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å…‹æœæœ´ç´ RAGçš„å±€é™æ€§ï¼Œå…ˆè¿›æŠ€æœ¯åœ¨æ¨ç†è¿‡ç¨‹ä¸­å¼•å…¥äº†æ›´ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚DSPæ¡†æ¶[Khattabç­‰äººï¼Œ2022]åˆ©ç”¨å†»ç»“çš„LMså’Œæ£€ç´¢æ¨¡å‹ï¼ˆRMsï¼‰ä¹‹é—´çš„å¤æ‚è‡ªç„¶è¯­è¨€æ–‡æœ¬äº¤æ¢ï¼Œä¸°å¯Œäº†ä¸Šä¸‹æ–‡ï¼Œä»è€Œæé«˜äº†ç”Ÿæˆç»“æœã€‚PKG[Luoç­‰äººï¼Œ2023]æ–¹æ³•ä¸ºLLMsé…å¤‡äº†ä¸€ä¸ªçŸ¥è¯†å¼•å¯¼æ¨¡å—ï¼Œå…è®¸æ£€ç´¢ç›¸å…³ä¿¡æ¯ï¼Œè€Œæ— éœ€ä¿®æ”¹LMsçš„å‚æ•°ï¼Œä½¿æ›´å¤æ‚çš„ä»»åŠ¡æ‰§è¡Œæˆä¸ºå¯èƒ½ã€‚CREAICL[Liç­‰äººï¼Œ2023b]é‡‡ç”¨è·¨è¯­è¨€çŸ¥è¯†çš„åŒæ­¥æ£€ç´¢æ¥å¢å¼ºä¸Šä¸‹æ–‡ï¼Œè€ŒRECITE[Sunç­‰äººï¼Œ2022]é€šè¿‡ç›´æ¥ä»LLMsä¸­é‡‡æ ·æ®µè½æ¥ç”Ÿæˆä¸Šä¸‹æ–‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨éœ€è¦å¤šæ­¥æ¨ç†çš„ä»»åŠ¡ä¸­ï¼Œè¿­ä»£æ£€ç´¢æ–¹æ³•è¿›ä¸€æ­¥æé«˜äº†RAGè¿‡ç¨‹çš„ç²¾ç»†åŒ–ã€‚ITRG[Fengç­‰äººï¼Œ2023]è¿­ä»£æ£€ç´¢ä¿¡æ¯ä»¥ç¡®å®šæ­£ç¡®çš„æ¨ç†è·¯å¾„ï¼Œä»è€Œæé«˜äº†ä»»åŠ¡é€‚åº”æ€§ã€‚ITERRETGEN[Shaoç­‰äººï¼Œ2023]éµå¾ªè¿­ä»£ç­–ç•¥ï¼Œå°†æ£€ç´¢å’Œç”Ÿæˆåˆå¹¶åœ¨ä¸€ä¸ªå¾ªç¯è¿‡ç¨‹ä¸­ï¼Œäº¤æ›¿è¿›è¡Œâ€œæ£€ç´¢å¢å¼ºç”Ÿæˆâ€å’Œâ€œç”Ÿæˆå¢å¼ºæ£€ç´¢â€ã€‚å¯¹äºéçŸ¥è¯†å¯†é›†å‹ï¼ˆNKIï¼‰ä»»åŠ¡ï¼ŒPGRA[Guoç­‰äººï¼Œ2023]æå‡ºäº†ä¸€ä¸ªä¸¤é˜¶æ®µæ¡†æ¶ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªä»»åŠ¡æ— å…³çš„æ£€ç´¢å™¨ï¼Œç„¶åæ˜¯ä¸€ä¸ªæç¤ºå¼•å¯¼çš„é‡æ’å™¨ï¼Œç”¨äºé€‰æ‹©å’Œä¼˜å…ˆè€ƒè™‘è¯æ®ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒIRCOT[Trivediç­‰äººï¼Œ2022]å°†RAGä¸æ€ç»´é“¾ï¼ˆCoTï¼‰æ–¹æ³•ç›¸ç»“åˆï¼Œäº¤æ›¿è¿›è¡ŒCoTå¼•å¯¼çš„æ£€ç´¢å’Œæ£€ç´¢ä¿¡æ¯çš„CoTè¿‡ç¨‹ï¼Œæ˜¾è‘—æé«˜äº†GPT-3åœ¨å„ç§é—®ç­”ä»»åŠ¡ä¸­çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬è´¨ä¸Šï¼Œè¿™äº›æ¨ç†é˜¶æ®µçš„å¢å¼ºæä¾›äº†è½»é‡çº§ã€æˆæœ¬æ•ˆç›Šé«˜çš„é€‰æ‹©ï¼Œåˆ©ç”¨é¢„è®­ç»ƒæ¨¡å‹çš„èƒ½åŠ›ï¼Œè€Œæ— éœ€è¿›ä¸€æ­¥è®­ç»ƒã€‚ä¸»è¦ä¼˜åŠ¿æ˜¯åœ¨ä¿æŒé™æ€LLMå‚æ•°çš„åŒæ—¶æä¾›ä¸ä¸Šä¸‹æ–‡ç›¸å…³çš„ä¿¡æ¯ä»¥æ»¡è¶³ç‰¹å®šä»»åŠ¡éœ€æ±‚ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•å¹¶éæ²¡æœ‰å±€é™æ€§ï¼Œå› ä¸ºå®ƒéœ€è¦ç²¾å¿ƒçš„æ•°æ®å¤„ç†å’Œä¼˜åŒ–ï¼Œå¹¶ä¸”å—åˆ°åŸºç¡€æ¨¡å‹å†…åœ¨èƒ½åŠ›çš„çº¦æŸã€‚ä¸ºäº†æœ‰æ•ˆåœ°åº”å¯¹å¤šæ ·åŒ–çš„ä»»åŠ¡éœ€æ±‚ï¼Œè¿™ç§æ–¹æ³•é€šå¸¸ä¸ç¨‹åºä¼˜åŒ–æŠ€æœ¯ï¼ˆå¦‚é€æ­¥æ¨ç†ã€è¿­ä»£æ£€ç´¢å’Œè‡ªé€‚åº”æ£€ç´¢ç­–ç•¥ï¼‰ç»“åˆä½¿ç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;62-å¢å¼ºæ¥æºaugmentation-source&#34;&gt;6.2 å¢å¼ºæ¥æº(&lt;strong&gt;Augmentation Source&lt;/strong&gt;)&lt;/h3&gt;
&lt;p&gt;RAGæ¨¡å‹çš„æœ‰æ•ˆæ€§åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå—åˆ°å¢å¼ºæ•°æ®æºé€‰æ‹©çš„å½±å“ã€‚ä¸åŒå±‚æ¬¡çš„çŸ¥è¯†å’Œç»´åº¦éœ€è¦ä¸åŒçš„å¤„ç†æŠ€æœ¯ã€‚å®ƒä»¬è¢«å½’ç±»ä¸ºéç»“æ„åŒ–æ•°æ®ã€ç»“æ„åŒ–æ•°æ®å’Œç”±LLMsç”Ÿæˆçš„å†…å®¹ã€‚å›¾5å±•ç¤ºäº†å…·æœ‰ä¸åŒå¢å¼ºæ–¹é¢çš„ä»£è¡¨æ€§RAGç ”ç©¶çš„æŠ€æœ¯æ ‘ã€‚å¶å­ä»¥ä¸‰ç§ä¸åŒçš„é¢œè‰²è¡¨ç¤ºï¼Œä»£è¡¨ä½¿ç”¨å„ç§ç±»å‹æ•°æ®çš„å¢å¼ºï¼šéç»“æ„åŒ–æ•°æ®ã€ç»“æ„åŒ–æ•°æ®å’Œç”±LLMsç”Ÿæˆçš„å†…å®¹ã€‚å›¾è¡¨æ¸…æ¥šåœ°è¡¨æ˜ï¼Œæœ€åˆï¼Œå¢å¼ºä¸»è¦æ˜¯é€šè¿‡éç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚çº¯æ–‡æœ¬ï¼‰å®ç°çš„ã€‚è¿™ç§æ–¹æ³•åæ¥æ‰©å±•åˆ°åŒ…æ‹¬ä½¿ç”¨ç»“æ„åŒ–æ•°æ®ï¼ˆä¾‹å¦‚çŸ¥è¯†å›¾è°±ï¼‰ä»¥è¿›ä¸€æ­¥æ”¹è¿›ã€‚æœ€è¿‘ï¼Œç ”ç©¶ä¸­å‡ºç°äº†ä¸€ä¸ªè¶‹åŠ¿ï¼Œå³ä½¿ç”¨LLMsè‡ªèº«ç”Ÿæˆçš„å†…å®¹è¿›è¡Œæ£€ç´¢å’Œå¢å¼ºã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/rag/RAG_for_LLMs_A_Survey/5.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;ä½¿ç”¨éç»“æ„åŒ–æ•°æ®å¢å¼ºaugmented-with-unstructured-data&#34;&gt;ä½¿ç”¨éç»“æ„åŒ–æ•°æ®å¢å¼º(&lt;strong&gt;Augmented with Unstructured Data&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;éç»“æ„åŒ–æ–‡æœ¬ä»è¯­æ–™åº“ä¸­æ”¶é›†ï¼Œä¾‹å¦‚ç”¨äºå¾®è°ƒå¤§å‹æ¨¡å‹çš„æç¤ºæ•°æ®[Chengç­‰äººï¼Œ2023a]å’Œè·¨è¯­è¨€æ•°æ®[Liç­‰äººï¼Œ2023b]ã€‚æ£€ç´¢å•å…ƒä»æ ‡è®°ï¼ˆä¾‹å¦‚kNN-LM[Khandelwalç­‰äººï¼Œ2019]ï¼‰åˆ°çŸ­è¯­ï¼ˆä¾‹å¦‚NPMï¼ŒCOG[Leeç­‰äººï¼Œ2020ï¼ŒLanç­‰äººï¼Œ2022]ï¼‰å’Œæ–‡æ¡£æ®µè½ï¼Œæ›´ç»†çš„ç²’åº¦æä¾›äº†ç²¾ç¡®åº¦ï¼Œä½†ä»£ä»·æ˜¯æ£€ç´¢å¤æ‚æ€§çš„å¢åŠ ã€‚&lt;/p&gt;
&lt;p&gt;FLARE[Jiangç­‰äººï¼Œ2023b]å¼•å…¥äº†ä¸€ç§ä¸»åŠ¨æ£€ç´¢æ–¹æ³•ï¼Œç”±LMç”Ÿæˆä½æ¦‚ç‡è¯è§¦å‘ã€‚å®ƒåˆ›å»ºä¸€ä¸ªä¸´æ—¶å¥å­ç”¨äºæ–‡æ¡£æ£€ç´¢ï¼Œç„¶åä½¿ç”¨æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡é‡æ–°ç”Ÿæˆå¥å­ä»¥é¢„æµ‹åç»­å¥å­ã€‚RETROä½¿ç”¨å‰ä¸€ä¸ªå—æ¥æ£€ç´¢å—çº§åˆ«çš„æœ€è¿‘é‚»ï¼Œç»“åˆå‰ä¸€ä¸ªå—çš„ä¸Šä¸‹æ–‡ï¼ŒæŒ‡å¯¼ä¸‹ä¸€ä¸ªå—çš„ç”Ÿæˆã€‚ä¸ºäº†ä¿æŒå› æœå…³ç³»ï¼Œä¸‹ä¸€ä¸ªå—Ciçš„ç”Ÿæˆä»…ä½¿ç”¨å‰ä¸€ä¸ªå—N(Ciâˆ’1)çš„æœ€è¿‘é‚»ï¼Œè€Œä¸æ˜¯N(Ci)ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ä½¿ç”¨ç»“æ„åŒ–æ•°æ®å¢å¼ºaugmented-with-structured-data&#34;&gt;ä½¿ç”¨ç»“æ„åŒ–æ•°æ®å¢å¼º(&lt;strong&gt;Augmented with Structured Data&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;ç»“æ„åŒ–æ•°æ®ï¼Œå¦‚çŸ¥è¯†å›¾è°±ï¼ˆKGsï¼‰ï¼Œæä¾›é«˜è´¨é‡çš„ä¸Šä¸‹æ–‡å¹¶å‡è½»æ¨¡å‹å¹»è§‰ã€‚RET-LLMs[Modarressiç­‰äººï¼Œ2023]ä¸ºæœªæ¥å‚è€ƒæ„å»ºäº†ä¸€ä¸ªç”±è¿‡å»å¯¹è¯ç»„æˆçš„çŸ¥è¯†å›¾è°±è®°å¿†ã€‚SUGRE[Kangç­‰äººï¼Œ2023]åˆ©ç”¨å›¾ç¥ç»ç½‘ç»œï¼ˆGNNsï¼‰ç¼–ç ç›¸å…³çš„KGå­å›¾ï¼Œé€šè¿‡å¤šæ¨¡æ€å¯¹æ¯”å­¦ä¹ ç¡®ä¿æ£€ç´¢åˆ°çš„äº‹å®ä¸ç”Ÿæˆæ–‡æœ¬çš„ä¸€è‡´æ€§ã€‚KnowledgeGPT[Wangç­‰äººï¼Œ2023d]ç”ŸæˆKBæœç´¢æŸ¥è¯¢å¹¶å°†çŸ¥è¯†å­˜å‚¨åœ¨ä¸ªæ€§åŒ–æ•°æ®åº“ä¸­ï¼Œå¢å¼ºäº†RAGæ¨¡å‹çš„çŸ¥è¯†ä¸°å¯Œæ€§å’Œä¸Šä¸‹æ–‡æ€§ã€‚&lt;/p&gt;
&lt;h4 id=&#34;llmsç”Ÿæˆçš„å†…å®¹åœ¨ragä¸­llms-generated-content-in-rag&#34;&gt;LLMsç”Ÿæˆçš„å†…å®¹åœ¨RAGä¸­(&lt;strong&gt;LLMs-Generated Content in RAG&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;ä¸ºäº†è§£å†³RAGä¸­å¤–éƒ¨è¾…åŠ©ä¿¡æ¯çš„å±€é™æ€§ï¼Œä¸€äº›ç ”ç©¶ä¸“æ³¨äºåˆ©ç”¨LLMsçš„å†…éƒ¨çŸ¥è¯†ã€‚SKR[Wangç­‰äººï¼Œ2023e]å°†é—®é¢˜åˆ†ç±»ä¸ºå·²çŸ¥æˆ–æœªçŸ¥ï¼Œå¹¶æœ‰é€‰æ‹©åœ°åº”ç”¨æ£€ç´¢å¢å¼ºã€‚GenRead[Yuç­‰äººï¼Œ2022]ç”¨LLMç”Ÿæˆå™¨æ›¿æ¢æ£€ç´¢å™¨ï¼Œå‘ç°ç”±äºä¸å› æœè¯­è¨€å»ºæ¨¡çš„é¢„è®­ç»ƒç›®æ ‡æ›´å¥½åœ°å¯¹é½ï¼ŒLLMç”Ÿæˆçš„ä¸Šä¸‹æ–‡é€šå¸¸åŒ…å«æ›´å‡†ç¡®çš„ç­”æ¡ˆã€‚Selfmem[Chengç­‰äººï¼Œ2023b]ä½¿ç”¨æ£€ç´¢å¢å¼ºçš„ç”Ÿæˆå™¨è¿­ä»£åˆ›å»ºä¸€ä¸ªæ— ç•Œè®°å¿†æ± ï¼Œä½¿ç”¨è®°å¿†é€‰æ‹©å™¨é€‰æ‹©ä½œä¸ºåŸå§‹é—®é¢˜çš„åŒé‡é—®é¢˜çš„è¾“å‡ºï¼Œä»è€Œè‡ªæˆ‘å¢å¼ºç”Ÿæˆæ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›æ–¹æ³•å¼ºè°ƒäº†åœ¨RAGä¸­åˆ›æ–°æ•°æ®æºåˆ©ç”¨çš„å¹¿åº¦ï¼ŒåŠªåŠ›æé«˜æ¨¡å‹æ€§èƒ½å’Œä»»åŠ¡æ•ˆæœã€‚&lt;/p&gt;
&lt;h3 id=&#34;63-å¢å¼ºè¿‡ç¨‹augmentation-process&#34;&gt;6.3 å¢å¼ºè¿‡ç¨‹(&lt;strong&gt;Augmentation Process&lt;/strong&gt;)&lt;/h3&gt;
&lt;p&gt;åœ¨RAGé¢†åŸŸï¼Œæ ‡å‡†åšæ³•é€šå¸¸æ¶‰åŠå•ä¸€æ£€ç´¢æ­¥éª¤ï¼Œç„¶åè¿›è¡Œç”Ÿæˆï¼Œè¿™å¯èƒ½å¯¼è‡´æ•ˆç‡ä½ä¸‹ã€‚ä¸€ä¸ªå€¼å¾—æ³¨æ„çš„é—®é¢˜ï¼Œç§°ä¸ºâ€œä¸­é—´ä¸¢å¤±â€ç°è±¡ï¼Œå‡ºç°åœ¨å•ä¸€æ£€ç´¢äº§ç”Ÿå†—ä½™å†…å®¹æ—¶ï¼Œå¯èƒ½ä¼šç¨€é‡Šæˆ–ä¸å…³é”®ä¿¡æ¯ç›¸çŸ›ç›¾ï¼Œä»è€Œé™ä½ç”Ÿæˆè´¨é‡[Liuç­‰äººï¼Œ2023a]ã€‚æ­¤å¤–ï¼Œè¿™ç§å•ä¸€æ£€ç´¢é€šå¸¸ä¸è¶³ä»¥åº”å¯¹éœ€è¦å¤šæ­¥æ¨ç†çš„å¤æ‚é—®é¢˜ï¼Œå› ä¸ºå®ƒæä¾›çš„ä¿¡æ¯èŒƒå›´æœ‰é™[Yoranç­‰äººï¼Œ2023]ã€‚å¦‚å›¾5æ‰€ç¤ºï¼Œä¸ºäº†è§„é¿è¿™äº›æŒ‘æˆ˜ï¼Œå½“ä»£ç ”ç©¶æå‡ºäº†æ”¹è¿›æ£€ç´¢è¿‡ç¨‹çš„æ–¹æ³•ï¼šè¿­ä»£æ£€ç´¢ã€é€’å½’æ£€ç´¢å’Œè‡ªé€‚åº”æ£€ç´¢ã€‚è¿­ä»£æ£€ç´¢å…è®¸æ¨¡å‹åŸºäºåˆå§‹æŸ¥è¯¢å’Œè¿„ä»Šä¸ºæ­¢ç”Ÿæˆçš„æ–‡æœ¬é‡å¤æ”¶é›†æ–‡æ¡£ï¼Œä¸ºLLMsæä¾›æ›´å…¨é¢çš„çŸ¥è¯†åº“[Borgeaudç­‰äººï¼Œ2022ï¼ŒAroraç­‰äººï¼Œ2023]ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§æ–¹æ³•å·²è¢«è¯æ˜é€šè¿‡æä¾›é¢å¤–çš„ä¸Šä¸‹æ–‡å‚è€ƒï¼Œå¢å¼ºäº†åç»­ç­”æ¡ˆç”Ÿæˆçš„é²æ£’æ€§ã€‚ç„¶è€Œï¼Œå®ƒå¯èƒ½å—åˆ°è¯­ä¹‰ä¸è¿ç»­æ€§å’Œæ— å…³ä¿¡æ¯ç§¯ç´¯çš„å½±å“ï¼Œå› ä¸ºå®ƒé€šå¸¸ä¾èµ–äºä¸€ä¸ªåºåˆ—çš„nä¸ªæ ‡è®°æ¥åˆ’åˆ†ç”Ÿæˆæ–‡æœ¬å’Œæ£€ç´¢æ–‡æ¡£ä¹‹é—´çš„è¾¹ç•Œã€‚ä¸ºäº†è§£å†³ç‰¹å®šçš„æ•°æ®åœºæ™¯ï¼Œä½¿ç”¨äº†é€’å½’æ£€ç´¢å’Œå¤šè·³æ£€ç´¢æŠ€æœ¯ã€‚é€’å½’æ£€ç´¢æ¶‰åŠä½¿ç”¨ç»“æ„åŒ–ç´¢å¼•ä»¥åˆ†å±‚æ–¹å¼å¤„ç†å’Œæ£€ç´¢æ•°æ®ï¼Œè¿™å¯èƒ½åŒ…æ‹¬åœ¨æ‰§è¡ŒåŸºäºæ­¤æ‘˜è¦çš„æ£€ç´¢ä¹‹å‰å¯¹æ–‡æ¡£æˆ–é•¿ç¯‡PDFçš„éƒ¨åˆ†è¿›è¡Œæ€»ç»“ã€‚éšåï¼Œåœ¨æ–‡æ¡£å†…è¿›è¡Œçš„äºŒæ¬¡æ£€ç´¢ç»†åŒ–äº†æœç´¢ï¼Œä½“ç°äº†è¿‡ç¨‹çš„é€’å½’æ€§è´¨ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¤šè·³æ£€ç´¢æ—¨åœ¨æ·±å…¥æŒ–æ˜å›¾ç»“æ„åŒ–æ•°æ®æºï¼Œæå–ç›¸äº’å…³è”çš„ä¿¡æ¯[Liç­‰äººï¼Œ2023c]ã€‚æ­¤å¤–ï¼Œä¸€äº›æ–¹æ³•æ•´åˆäº†æ£€ç´¢å’Œç”Ÿæˆçš„æ­¥éª¤ã€‚ITER-RETGEN[Shaoç­‰äººï¼Œ2023]é‡‡ç”¨äº†ä¸€ç§ååŒæ–¹æ³•ï¼Œåˆ©ç”¨â€œæ£€ç´¢å¢å¼ºç”Ÿæˆâ€å’Œâ€œç”Ÿæˆå¢å¼ºæ£€ç´¢â€æ¥å¤„ç†éœ€è¦å¤åˆ¶ç‰¹å®šä¿¡æ¯çš„ä»»åŠ¡ã€‚è¯¥æ¨¡å‹åˆ©ç”¨æ‰€éœ€çš„å†…å®¹ä½œä¸ºæ£€ç´¢ç›¸å…³çŸ¥è¯†çš„ä¸Šä¸‹æ–‡åŸºç¡€ï¼Œè¿™åè¿‡æ¥åˆä¿ƒè¿›äº†åç»­è¿­ä»£ä¸­æ”¹è¿›å“åº”çš„ç”Ÿæˆã€‚&lt;/p&gt;
&lt;h4 id=&#34;è¿­ä»£æ£€ç´¢iterative-retrieval&#34;&gt;è¿­ä»£æ£€ç´¢(&lt;strong&gt;Iterative Retrieval&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;è¿­ä»£æ£€ç´¢æ˜¯RAGæ¨¡å‹ä¸­çš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œå…¶ä¸­æ–‡æ¡£ä¼šåŸºäºåˆå§‹æŸ¥è¯¢å’Œè¿„ä»Šä¸ºæ­¢ç”Ÿæˆçš„æ–‡æœ¬é‡å¤æ”¶é›†ï¼Œä¸ºLLMsæä¾›æ›´å…¨é¢çš„çŸ¥è¯†åº“[Borgeaudç­‰äººï¼Œ2022ï¼ŒAroraç­‰äººï¼Œ2023]ã€‚è¿™ç§æ–¹æ³•å·²è¢«è¯æ˜å¯ä»¥é€šè¿‡æä¾›é¢å¤–çš„ä¸Šä¸‹æ–‡å‚è€ƒï¼Œå¢å¼ºåç»­ç­”æ¡ˆç”Ÿæˆçš„é²æ£’æ€§ã€‚ç„¶è€Œï¼Œå®ƒå¯èƒ½å—åˆ°è¯­ä¹‰ä¸è¿ç»­æ€§å’Œæ— å…³ä¿¡æ¯ç§¯ç´¯çš„å½±å“ï¼Œå› ä¸ºå®ƒé€šå¸¸ä¾èµ–äºä¸€ä¸ªåºåˆ—çš„nä¸ªæ ‡è®°æ¥åˆ’åˆ†ç”Ÿæˆæ–‡æœ¬å’Œæ£€ç´¢æ–‡æ¡£ä¹‹é—´çš„è¾¹ç•Œã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†è§£å†³ç‰¹å®šçš„æ•°æ®åœºæ™¯ï¼Œä½¿ç”¨äº†é€’å½’æ£€ç´¢å’Œå¤šè·³æ£€ç´¢æŠ€æœ¯ã€‚é€’å½’æ£€ç´¢æ¶‰åŠä½¿ç”¨ç»“æ„åŒ–ç´¢å¼•ä»¥åˆ†å±‚æ–¹å¼å¤„ç†å’Œæ£€ç´¢æ•°æ®ï¼Œè¿™å¯èƒ½åŒ…æ‹¬åœ¨æ‰§è¡ŒåŸºäºæ­¤æ‘˜è¦çš„æ£€ç´¢ä¹‹å‰å¯¹æ–‡æ¡£æˆ–é•¿ç¯‡PDFçš„éƒ¨åˆ†è¿›è¡Œæ€»ç»“ã€‚éšåï¼Œåœ¨æ–‡æ¡£å†…è¿›è¡Œçš„äºŒæ¬¡æ£€ç´¢ç»†åŒ–äº†æœç´¢ï¼Œä½“ç°äº†è¿‡ç¨‹çš„é€’å½’æ€§è´¨ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¤šè·³æ£€ç´¢æ—¨åœ¨æ·±å…¥æŒ–æ˜å›¾ç»“æ„åŒ–æ•°æ®æºï¼Œæå–ç›¸äº’å…³è”çš„ä¿¡æ¯[Liç­‰äººï¼Œ2023c]ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œä¸€äº›æ–¹æ³•æ•´åˆäº†æ£€ç´¢å’Œç”Ÿæˆçš„æ­¥éª¤ã€‚ITER-RETGEN[Shaoç­‰äººï¼Œ2023]é‡‡ç”¨äº†ä¸€ç§ååŒæ–¹æ³•ï¼Œåˆ©ç”¨â€œæ£€ç´¢å¢å¼ºç”Ÿæˆâ€å’Œâ€œç”Ÿæˆå¢å¼ºæ£€ç´¢â€æ¥å¤„ç†éœ€è¦å¤åˆ¶ç‰¹å®šä¿¡æ¯çš„ä»»åŠ¡ã€‚è¯¥æ¨¡å‹åˆ©ç”¨æ‰€éœ€çš„å†…å®¹ä½œä¸ºæ£€ç´¢ç›¸å…³çŸ¥è¯†çš„ä¸Šä¸‹æ–‡åŸºç¡€ï¼Œè¿™åè¿‡æ¥åˆä¿ƒè¿›äº†åç»­è¿­ä»£ä¸­æ”¹è¿›å“åº”çš„ç”Ÿæˆã€‚&lt;/p&gt;
&lt;h4 id=&#34;é€’å½’æ£€ç´¢recursive-retrieval&#34;&gt;é€’å½’æ£€ç´¢(&lt;strong&gt;Recursive Retrieval&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;é€’å½’æ£€ç´¢é€šå¸¸ç”¨äºä¿¡æ¯æ£€ç´¢å’Œè‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ï¼Œä»¥æé«˜æœç´¢ç»“æœçš„æ·±åº¦å’Œç›¸å…³æ€§ã€‚
è¯¥è¿‡ç¨‹æ¶‰åŠæ ¹æ®å‰ä¸€æ¬¡æœç´¢çš„ç»“æœè¿­ä»£åœ°å®Œå–„æœç´¢æŸ¥è¯¢ã€‚é€’å½’æ£€ç´¢æ—¨åœ¨é€šè¿‡åé¦ˆå¾ªç¯é€æ­¥æ”¶æ•›åˆ°æœ€ç›¸å…³çš„ä¿¡æ¯ï¼Œä»è€Œå¢å¼ºæœç´¢ä½“éªŒã€‚IRCoT[Trivediç­‰äººï¼Œ2022]ä½¿ç”¨æ€ç»´é“¾æ¥æŒ‡å¯¼æ£€ç´¢è¿‡ç¨‹ï¼Œå¹¶ä½¿ç”¨æ£€ç´¢ç»“æœå®Œå–„CoTã€‚ToC[Kimç­‰äººï¼Œ2023]åˆ›å»ºäº†ä¸€ä¸ªæ¾„æ¸…æ ‘ï¼Œç³»ç»Ÿåœ°ä¼˜åŒ–æŸ¥è¯¢ä¸­çš„æ¨¡ç³Šéƒ¨åˆ†ã€‚å®ƒåœ¨ç”¨æˆ·éœ€æ±‚ä¸€å¼€å§‹å°±ä¸å®Œå…¨æ¸…æ¥šæˆ–æ‰€å¯»æ±‚çš„ä¿¡æ¯éå¸¸ä¸“ä¸šæˆ–å¾®å¦™çš„å¤æ‚æœç´¢åœºæ™¯ä¸­ç‰¹åˆ«æœ‰ç”¨ã€‚è¯¥è¿‡ç¨‹çš„é€’å½’æ€§è´¨å…è®¸å¯¹ç”¨æˆ·éœ€æ±‚è¿›è¡ŒæŒç»­å­¦ä¹ å’Œé€‚åº”ï¼Œé€šå¸¸ä¼šå¯¼è‡´å¯¹æœç´¢ç»“æœçš„æ»¡æ„åº¦æé«˜ã€‚&lt;/p&gt;
&lt;h4 id=&#34;è‡ªé€‚åº”æ£€ç´¢adaptive-retrieval&#34;&gt;è‡ªé€‚åº”æ£€ç´¢(&lt;strong&gt;Adaptive Retrieval&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;è‡ªé€‚åº”æ£€ç´¢æ–¹æ³•ï¼Œå¦‚Flareå’ŒSelfRAG[Jiangç­‰äººï¼Œ2023bï¼ŒAsaiç­‰äººï¼Œ2023]ï¼Œé€šè¿‡ä½¿LLMsèƒ½å¤Ÿä¸»åŠ¨ç¡®å®šæ£€ç´¢çš„æœ€ä½³æ—¶æœºå’Œå†…å®¹ï¼Œä»è€Œæé«˜RAGæ¡†æ¶çš„æ•ˆç‡å’Œç›¸å…³ä¿¡æ¯çš„æ¥æºã€‚&lt;/p&gt;
&lt;p&gt;è¿™äº›æ–¹æ³•æ˜¯LLMsåœ¨å…¶æ“ä½œä¸­é‡‡ç”¨ä¸»åŠ¨åˆ¤æ–­çš„æ›´å¹¿æ³›è¶‹åŠ¿çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚AutoGPTã€Toolformerå’ŒGraph-Toolformerç­‰æ¨¡å‹ä»£ç†[Yangç­‰äººï¼Œ2023cï¼ŒSchickç­‰äººï¼Œ2023]ã€‚ä¾‹å¦‚ï¼ŒGraph-Toolformerå°†å…¶æ£€ç´¢è¿‡ç¨‹åˆ†ä¸ºä¸åŒçš„æ­¥éª¤ï¼Œå…¶ä¸­LLMsä¸»åŠ¨ä½¿ç”¨æ£€ç´¢å™¨ï¼Œåº”ç”¨Self-AskæŠ€æœ¯ï¼Œå¹¶ä½¿ç”¨å°‘æ¬¡æç¤ºæ¥å¯åŠ¨æœç´¢æŸ¥è¯¢ã€‚è¿™ç§ä¸»åŠ¨ç«‹åœºä½¿LLMsèƒ½å¤Ÿå†³å®šä½•æ—¶æœç´¢æ‰€éœ€çš„ä¿¡æ¯ï¼Œç±»ä¼¼äºä»£ç†å¦‚ä½•ä½¿ç”¨å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;WebGPT[Nakanoç­‰äººï¼Œ2021]é›†æˆäº†ä¸€ä¸ªå¼ºåŒ–å­¦ä¹ æ¡†æ¶ï¼Œä»¥åœ¨æ–‡æœ¬ç”Ÿæˆè¿‡ç¨‹ä¸­è®­ç»ƒGPT-3æ¨¡å‹è‡ªä¸»ä½¿ç”¨æœç´¢å¼•æ“ã€‚å®ƒä½¿ç”¨ç‰¹æ®Šæ ‡è®°æ¥ä¿ƒè¿›å¦‚æœç´¢å¼•æ“æŸ¥è¯¢ã€æµè§ˆç»“æœå’Œå¼•ç”¨å‚è€ƒç­‰æ“ä½œï¼Œä»è€Œé€šè¿‡ä½¿ç”¨å¤–éƒ¨æœç´¢å¼•æ“æ‰©å±•GPT-3çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;Flareé€šè¿‡ç›‘æ§ç”Ÿæˆè¿‡ç¨‹ä¸­ç”Ÿæˆæœ¯è¯­çš„æ¦‚ç‡æ¥è‡ªåŠ¨åŒ–æ£€ç´¢æ—¶æœº[Jiangç­‰äººï¼Œ2023b]ã€‚å½“æ¦‚ç‡ä½äºæŸä¸ªé˜ˆå€¼æ—¶ï¼Œä¼šæ¿€æ´»æ£€ç´¢ç³»ç»Ÿä»¥æ”¶é›†ç›¸å…³ä¿¡æ¯ï¼Œä»è€Œä¼˜åŒ–æ£€ç´¢å‘¨æœŸã€‚&lt;/p&gt;
&lt;p&gt;Self-RAG[Asaiç­‰äººï¼Œ2023]å¼•å…¥äº†â€œåæ€æ ‡è®°â€ï¼Œå…è®¸æ¨¡å‹åæ€å…¶è¾“å‡ºã€‚è¿™äº›æ ‡è®°æœ‰ä¸¤ç§ç±»å‹ï¼šâ€œæ£€ç´¢â€å’Œâ€œæ‰¹è¯„â€ã€‚æ¨¡å‹å¯ä»¥è‡ªä¸»å†³å®šä½•æ—¶æ¿€æ´»æ£€ç´¢ï¼Œæˆ–è€…é¢„å®šä¹‰çš„é˜ˆå€¼å¯èƒ½ä¼šè§¦å‘è¯¥è¿‡ç¨‹ã€‚åœ¨æ£€ç´¢æœŸé—´ï¼Œç”Ÿæˆå™¨åœ¨å¤šä¸ªæ®µè½ä¸­è¿›è¡Œç‰‡æ®µçº§åˆ«çš„æŸæœç´¢ï¼Œä»¥å¾—å‡ºæœ€è¿è´¯çš„åºåˆ—ã€‚æ‰¹è¯„åˆ†æ•°ç”¨äºæ›´æ–°ç»†åˆ†åˆ†æ•°ï¼Œå…·æœ‰åœ¨æ¨ç†æœŸé—´è°ƒæ•´è¿™äº›æƒé‡çš„çµæ´»æ€§ï¼Œä»¥å®šåˆ¶æ¨¡å‹çš„è¡Œä¸ºã€‚Self-RAGçš„è®¾è®¡æ¶ˆé™¤äº†å¯¹é¢å¤–åˆ†ç±»å™¨æˆ–ä¾èµ–è‡ªç„¶è¯­è¨€æ¨ç†ï¼ˆNLIï¼‰æ¨¡å‹çš„éœ€æ±‚ï¼Œä»è€Œç®€åŒ–äº†å†³å®šä½•æ—¶å‚ä¸æ£€ç´¢æœºåˆ¶çš„å†³ç­–è¿‡ç¨‹ï¼Œå¹¶æé«˜äº†æ¨¡å‹åœ¨ç”Ÿæˆå‡†ç¡®å“åº”æ–¹é¢çš„è‡ªä¸»åˆ¤æ–­èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºLLMçš„æ—¥ç›Šæ™®åŠï¼ŒLLMä¼˜åŒ–å—åˆ°äº†æ˜¾è‘—å…³æ³¨ã€‚æç¤ºå·¥ç¨‹ã€å¾®è°ƒï¼ˆFTï¼‰å’ŒRAGç­‰æŠ€æœ¯å„æœ‰ç‰¹ç‚¹ï¼Œå¦‚å›¾6æ‰€ç¤ºã€‚è™½ç„¶æç¤ºå·¥ç¨‹åˆ©ç”¨äº†æ¨¡å‹çš„å›ºæœ‰èƒ½åŠ›ï¼Œä½†ä¼˜åŒ–LLMé€šå¸¸éœ€è¦åº”ç”¨RAGå’ŒFTæ–¹æ³•ã€‚RAGå’ŒFTçš„é€‰æ‹©åº”åŸºäºåœºæ™¯çš„å…·ä½“è¦æ±‚å’Œæ¯ç§æ–¹æ³•çš„å›ºæœ‰å±æ€§ã€‚è¡¨1æä¾›äº†RAGå’ŒFTçš„è¯¦ç»†æ¯”è¾ƒã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/rag/RAG_for_LLMs_A_Survey/6.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;64-ragä¸å¾®è°ƒrag-vs-fine-tuning&#34;&gt;6.4 RAGä¸å¾®è°ƒ(&lt;strong&gt;RAG vs Fine-Tuning&lt;/strong&gt;)&lt;/h3&gt;
&lt;p&gt;RAGå°±åƒç»™æ¨¡å‹ä¸€æœ¬æ•™ç§‘ä¹¦ï¼Œç”¨äºç‰¹å®šæŸ¥è¯¢çš„ä¿¡æ¯æ£€ç´¢ï¼Œéå¸¸é€‚åˆç‰¹å®šæŸ¥è¯¢ã€‚å¦ä¸€æ–¹é¢ï¼ŒFTå°±åƒå­¦ç”Ÿéšç€æ—¶é—´çš„æ¨ç§»å†…åŒ–çŸ¥è¯†ï¼Œæ›´é€‚åˆå¤åˆ¶ç‰¹å®šçš„ç»“æ„ã€é£æ ¼æˆ–æ ¼å¼ã€‚FTå¯ä»¥é€šè¿‡åŠ å¼ºåŸºç¡€æ¨¡å‹çŸ¥è¯†ã€è°ƒæ•´è¾“å‡ºå’Œæ•™æˆå¤æ‚æŒ‡ä»¤æ¥æé«˜æ¨¡å‹çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚ç„¶è€Œï¼Œå®ƒåœ¨æ•´åˆæ–°çŸ¥è¯†æˆ–å¿«é€Ÿè¿­ä»£æ–°ç”¨ä¾‹æ–¹é¢å¹¶ä¸æ“…é•¿ã€‚&lt;/p&gt;
&lt;p&gt;RAGå’ŒFTè¿™ä¸¤ç§æ–¹æ³•å¹¶ä¸äº’ç›¸æ’æ–¥ï¼Œå¯ä»¥åœ¨ä¸åŒå±‚æ¬¡ä¸Šäº’è¡¥ï¼Œå¢å¼ºæ¨¡å‹çš„èƒ½åŠ›ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ƒä»¬çš„ç»“åˆä½¿ç”¨å¯èƒ½ä¼šäº§ç”Ÿæœ€ä½³æ€§èƒ½ã€‚æ¶‰åŠRAGå’ŒFTçš„ä¼˜åŒ–è¿‡ç¨‹å¯èƒ½éœ€è¦å¤šæ¬¡è¿­ä»£æ‰èƒ½è¾¾åˆ°æ»¡æ„çš„ç»“æœã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/rag/RAG_for_LLMs_A_Survey/tab1.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬7ç« ragè¯„ä¼°&#34;&gt;ç¬¬7ç« ï¼šRAGè¯„ä¼°&lt;/h2&gt;
&lt;p&gt;RAGåœ¨è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰é¢†åŸŸçš„å¿«é€Ÿå‘å±•å’Œæ—¥ç›Šå¹¿æ³›çš„åº”ç”¨æ¨åŠ¨äº†LLMsç¤¾åŒºå¯¹RAGæ¨¡å‹è¯„ä¼°çš„ç ”ç©¶ã€‚è¯„ä¼°çš„ä¸»è¦ç›®æ ‡æ˜¯ç†è§£å’Œä¼˜åŒ–RAGæ¨¡å‹åœ¨ä¸åŒåº”ç”¨åœºæ™¯ä¸‹çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ä»å†å²ä¸Šçœ‹ï¼ŒRAGæ¨¡å‹çš„è¯„ä¼°ä¸»è¦é›†ä¸­åœ¨å…¶åœ¨ç‰¹å®šä¸‹æ¸¸ä»»åŠ¡ä¸­çš„æ‰§è¡Œä¸Šã€‚è¿™äº›è¯„ä¼°é‡‡ç”¨é€‚åˆæ‰‹å¤´ä»»åŠ¡çš„æ—¢å®šæŒ‡æ ‡ã€‚ä¾‹å¦‚ï¼Œé—®ç­”è¯„ä¼°å¯èƒ½ä¾èµ–äºEMå’ŒF1åˆ†æ•°[Wangç­‰äººï¼Œ2023a, Shiç­‰äººï¼Œ2023, Fengç­‰äººï¼Œ2023, Maç­‰äººï¼Œ2023a]ï¼Œè€Œäº‹å®æ ¸æŸ¥ä»»åŠ¡é€šå¸¸ä»¥å‡†ç¡®æ€§ä¸ºä¸»è¦æŒ‡æ ‡[Lewisç­‰äººï¼Œ2020, Izacardç­‰äººï¼Œ2022, Shaoç­‰äººï¼Œ2023]ã€‚ä¸ºRAGåº”ç”¨è®¾è®¡çš„è‡ªåŠ¨è¯„ä¼°å·¥å…·ï¼Œå¦‚RALLEï¼ŒåŒæ ·åŸºäºè¿™äº›ç‰¹å®šäºä»»åŠ¡çš„æŒ‡æ ‡è¿›è¡Œè¯„ä¼°[Hoshiç­‰äººï¼Œ2023]ã€‚å°½ç®¡å¦‚æ­¤ï¼Œä¸“é—¨è¯„ä¼°RAGæ¨¡å‹ç‹¬ç‰¹ç‰¹æ€§çš„ç ”ç©¶ä»ç„¶å¾ˆå°‘ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹éƒ¨åˆ†å°†ä»ä»»åŠ¡ç‰¹å®šè¯„ä¼°æ–¹æ³•å’ŒæŒ‡æ ‡çš„ç„¦ç‚¹è½¬ç§»åˆ°ç°æœ‰æ–‡çŒ®çš„ç»¼åˆä¸Šï¼Œè¿™äº›æ–‡çŒ®åŸºäºå®ƒä»¬çš„ç‹¬ç‰¹å±æ€§ã€‚è¿™ä¸€æ¢ç´¢æ¶µç›–äº†RAGè¯„ä¼°çš„ç›®æ ‡ã€è¯„ä¼°è¿™äº›æ¨¡å‹çš„æ–¹é¢ä»¥åŠå¯ç”¨äºæ­¤ç±»è¯„ä¼°çš„åŸºå‡†å’Œå·¥å…·ã€‚ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªå…¨é¢çš„RAGæ¨¡å‹è¯„ä¼°æ¦‚è¿°ï¼Œæ¦‚è¿°ä¸“é—¨é’ˆå¯¹è¿™äº›å…ˆè¿›ç”Ÿæˆç³»ç»Ÿçš„ç‹¬ç‰¹æ–¹é¢çš„è¯„ä¼°æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h3 id=&#34;71-è¯„ä¼°ç›®æ ‡evaluation-targets&#34;&gt;7.1 è¯„ä¼°ç›®æ ‡(&lt;strong&gt;Evaluation Targets&lt;/strong&gt;)&lt;/h3&gt;
&lt;p&gt;RAGæ¨¡å‹çš„è¯„ä¼°ä¸»è¦å›´ç»•ä¸¤ä¸ªå…³é”®ç»„ä»¶ï¼šæ£€ç´¢å’Œç”Ÿæˆæ¨¡å—ã€‚è¿™ç§åˆ’åˆ†ç¡®ä¿äº†å¯¹æ£€ç´¢å™¨ç»„ä»¶æä¾›çš„ä¸Šä¸‹æ–‡è´¨é‡å’Œç”Ÿæˆå™¨äº§ç”Ÿçš„å†…å®¹è´¨é‡è¿›è¡Œå…¨é¢è¯„ä¼°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ£€ç´¢è´¨é‡retrieval-quality&#34;&gt;æ£€ç´¢è´¨é‡(&lt;strong&gt;Retrieval Quality&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;è¯„ä¼°æ£€ç´¢è´¨é‡å¯¹äºç¡®å®šæ£€ç´¢å™¨ç»„ä»¶æä¾›çš„ä¸Šä¸‹æ–‡çš„æœ‰æ•ˆæ€§è‡³å…³é‡è¦ã€‚è¯„ä¼°RAGæ£€ç´¢æ¨¡å—çš„æ€§èƒ½é€šå¸¸é‡‡ç”¨æœç´¢å¼•æ“ã€æ¨èç³»ç»Ÿå’Œä¿¡æ¯æ£€ç´¢ç³»ç»Ÿä¸­çš„æ ‡å‡†æŒ‡æ ‡ã€‚å¸¸ç”¨çš„æŒ‡æ ‡åŒ…æ‹¬å‘½ä¸­ç‡ã€MRRå’ŒNDCG[Liuï¼Œ2023, Nguyenï¼Œ2023]ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ç”Ÿæˆè´¨é‡generation-quality&#34;&gt;ç”Ÿæˆè´¨é‡(&lt;strong&gt;Generation Quality&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;ç”Ÿæˆè´¨é‡çš„è¯„ä¼°é›†ä¸­åœ¨ç”Ÿæˆå™¨ä»æ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ä¸­åˆæˆè¿è´¯å’Œç›¸å…³ç­”æ¡ˆçš„èƒ½åŠ›ä¸Šã€‚è¿™ç§è¯„ä¼°å¯ä»¥æ ¹æ®å†…å®¹çš„ç›®æ ‡åˆ†ä¸ºä¸¤ç±»ï¼šæœªæ ‡è®°å’Œå·²æ ‡è®°å†…å®¹ã€‚å¯¹äºæœªæ ‡è®°å†…å®¹ï¼Œè¯„ä¼°åŒ…æ‹¬ç”Ÿæˆç­”æ¡ˆçš„çœŸå®æ€§ã€ç›¸å…³æ€§å’Œæ— å®³æ€§ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¯¹äºå·²æ ‡è®°å†…å®¹ï¼Œé‡ç‚¹æ˜¯è¯„ä¼°æ¨¡å‹äº§ç”Ÿçš„ä¿¡æ¯çš„å‡†ç¡®æ€§[Liuï¼Œ2023]ã€‚æ­¤å¤–ï¼Œæ£€ç´¢å’Œç”Ÿæˆè´¨é‡è¯„ä¼°ä¹Ÿå¯ä»¥é€šè¿‡æ‰‹åŠ¨æˆ–è‡ªåŠ¨è¯„ä¼°æ–¹æ³•è¿›è¡Œ[Liuï¼Œ2023, Lanç­‰äººï¼Œ2022, Lengç­‰äººï¼Œ2023]ã€‚&lt;/p&gt;
&lt;h3 id=&#34;72-è¯„ä¼°æ–¹é¢evaluation-aspects&#34;&gt;7.2 è¯„ä¼°æ–¹é¢(&lt;strong&gt;Evaluation Aspects&lt;/strong&gt;)&lt;/h3&gt;
&lt;p&gt;å½“ä»£RAGæ¨¡å‹çš„è¯„ä¼°å®è·µå¼ºè°ƒä¸‰ä¸ªä¸»è¦è´¨é‡åˆ†æ•°å’Œå››ç§åŸºæœ¬èƒ½åŠ›ï¼Œè¿™äº›å…±åŒæ„æˆäº†å¯¹RAGæ¨¡å‹ä¸¤ä¸ªä¸»è¦ç›®æ ‡ï¼šæ£€ç´¢å’Œç”Ÿæˆçš„è¯„ä¼°ã€‚&lt;/p&gt;
&lt;h4 id=&#34;è´¨é‡åˆ†æ•°quality-scores&#34;&gt;è´¨é‡åˆ†æ•°(&lt;strong&gt;Quality Scores&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;è´¨é‡åˆ†æ•°åŒ…æ‹¬ä¸Šä¸‹æ–‡ç›¸å…³æ€§ã€ç­”æ¡ˆçœŸå®æ€§å’Œç­”æ¡ˆç›¸å…³æ€§ã€‚è¿™äº›è´¨é‡åˆ†æ•°ä»ä¸åŒè§’åº¦è¯„ä¼°RAGæ¨¡å‹åœ¨ä¿¡æ¯æ£€ç´¢å’Œç”Ÿæˆè¿‡ç¨‹ä¸­çš„æ•ˆç‡[Esç­‰äººï¼Œ2023, Saad-Falconç­‰äººï¼Œ2023, Jarviså’ŒAllardï¼Œ2023]ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸Šä¸‹æ–‡ç›¸å…³æ€§&lt;/strong&gt;(&lt;em&gt;Context Relevance&lt;/em&gt;)è¯„ä¼°æ£€ç´¢ä¸Šä¸‹æ–‡çš„ç²¾ç¡®æ€§å’Œç‰¹å¼‚æ€§ï¼Œç¡®ä¿ç›¸å…³æ€§å¹¶æœ€å°åŒ–ä¸æ— å…³å†…å®¹ç›¸å…³çš„å¤„ç†æˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç­”æ¡ˆçœŸå®æ€§&lt;/strong&gt;(&lt;em&gt;Answer Faithfulness&lt;/em&gt;)ç¡®ä¿ç”Ÿæˆçš„ç­”æ¡ˆå¿ å®äºæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ï¼Œä¿æŒä¸€è‡´æ€§å¹¶é¿å…çŸ›ç›¾ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç­”æ¡ˆç›¸å…³æ€§&lt;/strong&gt;(&lt;em&gt;Answer Relevance&lt;/em&gt;)è¦æ±‚ç”Ÿæˆçš„ç­”æ¡ˆç›´æ¥ç›¸å…³äºæå‡ºçš„é—®é¢˜ï¼Œæœ‰æ•ˆåœ°è§£å†³æ ¸å¿ƒæŸ¥è¯¢ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æ‰€éœ€èƒ½åŠ›required-abilities&#34;&gt;æ‰€éœ€èƒ½åŠ›(&lt;strong&gt;Required Abilities&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;RAGè¯„ä¼°è¿˜æ¶‰åŠå››ç§èƒ½åŠ›ï¼Œè¡¨æ˜å…¶é€‚åº”æ€§å’Œæ•ˆç‡ï¼šå™ªå£°é²æ£’æ€§ã€è´Ÿé¢æ‹’ç»ã€ä¿¡æ¯æ•´åˆå’Œåäº‹å®é²æ£’æ€§[Chenç­‰äººï¼Œ2023b, Liuç­‰äººï¼Œ2023b]ã€‚è¿™äº›èƒ½åŠ›å¯¹äºæ¨¡å‹åœ¨å„ç§æŒ‘æˆ˜å’Œå¤æ‚åœºæ™¯ä¸‹çš„æ€§èƒ½è‡³å…³é‡è¦ï¼Œå½±å“è´¨é‡åˆ†æ•°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å™ªå£°é²æ£’æ€§&lt;/strong&gt;(&lt;em&gt;Noise Robustness&lt;/em&gt;)è¯„ä¼°æ¨¡å‹å¤„ç†ä¸é—®é¢˜ç›¸å…³çš„ä½†ç¼ºä¹å®è´¨æ€§ä¿¡æ¯çš„å™ªå£°æ–‡æ¡£çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è´Ÿé¢æ‹’ç»&lt;/strong&gt;(&lt;em&gt;Negative Rejection&lt;/em&gt;)è¯„ä¼°æ¨¡å‹åœ¨æ£€ç´¢åˆ°çš„æ–‡æ¡£ä¸åŒ…å«å›ç­”é—®é¢˜æ‰€éœ€çš„çŸ¥è¯†æ—¶é¿å…å“åº”çš„è¾¨åˆ«åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¿¡æ¯æ•´åˆ&lt;/strong&gt;(&lt;em&gt;Information Integration&lt;/em&gt;)è¯„ä¼°æ¨¡å‹ä»å¤šä¸ªæ–‡æ¡£ä¸­ç»¼åˆä¿¡æ¯ä»¥è§£å†³å¤æ‚é—®é¢˜çš„èƒ½åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åäº‹å®é²æ£’æ€§&lt;/strong&gt;(&lt;em&gt;Counterfactual Robustness&lt;/em&gt;)æµ‹è¯•æ¨¡å‹è¯†åˆ«å¹¶å¿½ç•¥æ–‡æ¡£ä¸­å·²çŸ¥ä¸å‡†ç¡®æ€§çš„èƒ½åŠ›ï¼Œå³ä½¿åœ¨è¢«å‘ŠçŸ¥æ½œåœ¨çš„é”™è¯¯ä¿¡æ¯æ—¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚&lt;/p&gt;
&lt;p&gt;ä¸Šä¸‹æ–‡ç›¸å…³æ€§å’Œå™ªå£°é²æ£’æ€§å¯¹äºè¯„ä¼°æ£€ç´¢è´¨é‡å¾ˆé‡è¦ï¼Œè€Œç­”æ¡ˆçœŸå®æ€§ã€ç­”æ¡ˆç›¸å…³æ€§ã€è´Ÿé¢æ‹’ç»ã€ä¿¡æ¯æ•´åˆå’Œåäº‹å®é²æ£’æ€§å¯¹äºè¯„ä¼°ç”Ÿæˆè´¨é‡å¾ˆé‡è¦ã€‚æ¯ä¸ªè¯„ä¼°æ–¹é¢çš„å…·ä½“æŒ‡æ ‡æ€»ç»“åœ¨è¡¨2ä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›æŒ‡æ ‡æ¥æºäºç›¸å…³å·¥ä½œï¼Œå°šæœªä»£è¡¨é‡åŒ–RAGè¯„ä¼°æ–¹é¢çš„æˆç†Ÿæˆ–æ ‡å‡†åŒ–æ–¹æ³•ã€‚ä¸€äº›è¯„ä¼°ç ”ç©¶è¿˜å¼€å‘äº†é’ˆå¯¹RAGæ¨¡å‹ç»†å¾®å·®åˆ«çš„å®šåˆ¶æŒ‡æ ‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/rag/RAG_for_LLMs_A_Survey/tab2.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;73-è¯„ä¼°åŸºå‡†å’Œå·¥å…·evaluation-benchmarks-and-tools&#34;&gt;7.3 è¯„ä¼°åŸºå‡†å’Œå·¥å…·(&lt;strong&gt;Evaluation Benchmarks and Tools&lt;/strong&gt;)&lt;/h3&gt;
&lt;p&gt;æœ¬èŠ‚æè¿°äº†RAGæ¨¡å‹çš„è¯„ä¼°æ¡†æ¶ï¼ŒåŒ…æ‹¬åŸºå‡†æµ‹è¯•å’Œè‡ªåŠ¨åŒ–è¯„ä¼°å·¥å…·ã€‚è¿™äº›å·¥å…·æä¾›äº†é‡åŒ–æŒ‡æ ‡ï¼Œä¸ä»…è¡¡é‡RAGæ¨¡å‹çš„æ€§èƒ½ï¼Œè¿˜å¢å¼ºäº†å¯¹æ¨¡å‹åœ¨å„ç§è¯„ä¼°æ–¹é¢èƒ½åŠ›çš„ç†è§£ã€‚è‘—åçš„åŸºå‡†æµ‹è¯•ï¼Œå¦‚RGBå’ŒRECALL[Chenç­‰äººï¼Œ2023b, Liuç­‰äººï¼Œ2023b]ï¼Œä¸“æ³¨äºè¯„ä¼°RAGæ¨¡å‹çš„åŸºæœ¬èƒ½åŠ›ã€‚åŒæ—¶ï¼Œæœ€å…ˆè¿›çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œå¦‚RAGAS[Esç­‰äººï¼Œ2023]ã€ARES[Saad-Falconç­‰äººï¼Œ2023]å’ŒTruLens&lt;sup id=&#34;fnref:8&#34;&gt;&lt;a href=&#34;#fn:8&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;8&lt;/a&gt;&lt;/sup&gt;ï¼Œåˆ©ç”¨LLMsæ¥è¯„åˆ¤è´¨é‡åˆ†æ•°ã€‚è¿™äº›å·¥å…·å’ŒåŸºå‡†å…±åŒæ„æˆäº†ä¸€ä¸ªå¼ºå¤§çš„æ¡†æ¶ï¼Œç”¨äºç³»ç»Ÿåœ°è¯„ä¼°RAGæ¨¡å‹ï¼Œå¦‚è¡¨3æ‰€æ€»ç»“ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/rag/RAG_for_LLMs_A_Survey/tab3.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬8ç« æœªæ¥å‰æ™¯&#34;&gt;ç¬¬8ç« ï¼šæœªæ¥å‰æ™¯&lt;/h2&gt;
&lt;p&gt;æœ¬èŠ‚æ¢è®¨äº†RAGçš„ä¸‰ä¸ªæœªæ¥å‰æ™¯ï¼šæœªæ¥çš„æŒ‘æˆ˜ã€æ¨¡æ€æ‰©å±•å’ŒRAGç”Ÿæ€ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;h3 id=&#34;81-ragçš„æœªæ¥æŒ‘æˆ˜future-challenges-of-rag&#34;&gt;8.1 RAGçš„æœªæ¥æŒ‘æˆ˜(&lt;strong&gt;Future Challenges of RAG&lt;/strong&gt;)&lt;/h3&gt;
&lt;p&gt;å°½ç®¡RAGæŠ€æœ¯å–å¾—äº†æ˜¾è‘—è¿›å±•ï¼Œä½†ä»å­˜åœ¨å‡ ä¸ªæŒ‘æˆ˜éœ€è¦æ·±å…¥ç ”ç©¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ä¸Šä¸‹æ–‡é•¿åº¦&lt;/strong&gt;(&lt;em&gt;Context Length&lt;/em&gt;)ï¼šRAGçš„æœ‰æ•ˆæ€§å—åˆ°å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰ä¸Šä¸‹æ–‡çª—å£å¤§å°çš„é™åˆ¶ã€‚å¹³è¡¡çª—å£é•¿åº¦è¿‡çŸ­å¯èƒ½å¯¼è‡´ä¿¡æ¯ä¸è¶³ï¼Œè¿‡é•¿å¯èƒ½å¯¼è‡´ä¿¡æ¯ç¨€é‡Šï¼Œè¿™æ˜¯è‡³å…³é‡è¦çš„ã€‚éšç€åŠªåŠ›æ‰©å¤§LLMä¸Šä¸‹æ–‡çª—å£åˆ°å‡ ä¹æ— é™å¤§ï¼Œé€‚åº”è¿™äº›å˜åŒ–å¯¹RAGæå‡ºäº†é‡è¦çš„ç ”ç©¶é—®é¢˜[Xuç­‰äººï¼Œ2023cï¼ŒPackerç­‰äººï¼Œ2023ï¼ŒXiaoç­‰äººï¼Œ2023]ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é²æ£’æ€§&lt;/strong&gt;(&lt;em&gt;Robustness&lt;/em&gt;)ï¼šæ£€ç´¢è¿‡ç¨‹ä¸­å­˜åœ¨çš„å™ªå£°æˆ–çŸ›ç›¾ä¿¡æ¯å¯èƒ½å¯¹RAGçš„è¾“å‡ºè´¨é‡äº§ç”Ÿä¸åˆ©å½±å“ã€‚æé«˜RAGå¯¹è¿™ç§å¯¹æŠ—æ€§æˆ–è™šå‡è¾“å…¥çš„æŠµæŠ—åŠ›æ­£åœ¨è·å¾—ç ”ç©¶åŠ¨åŠ›ï¼Œå¹¶å·²æˆä¸ºå…³é”®çš„æ€§èƒ½æŒ‡æ ‡[Yuç­‰äººï¼Œ2023aï¼ŒGlassç­‰äººï¼Œ2021ï¼ŒBaekç­‰äººï¼Œ2023]ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ··åˆæ–¹æ³•&lt;/strong&gt;(&lt;em&gt;Hybrid Approaches&lt;/em&gt; RAG+FT)ï¼šå°†RAGä¸å¾®è°ƒç›¸ç»“åˆæ­£æˆä¸ºä¸€ç§é¢†å…ˆç­–ç•¥ã€‚ç¡®å®šRAGå’Œå¾®è°ƒçš„æœ€ä½³æ•´åˆæ–¹å¼ï¼Œæ— è®ºæ˜¯é¡ºåºã€äº¤æ›¿è¿˜æ˜¯é€šè¿‡ç«¯åˆ°ç«¯çš„è”åˆè®­ç»ƒï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨å‚æ•°åŒ–å’Œéå‚æ•°åŒ–çš„ä¼˜åŠ¿ï¼Œéƒ½æ˜¯å€¼å¾—æ¢ç´¢çš„é¢†åŸŸ[Linç­‰äººï¼Œ2023]ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ‰©å±•LLMè§’è‰²&lt;/strong&gt;(&lt;em&gt;Expanding LLM Roles&lt;/em&gt;)ï¼šé™¤äº†ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆå¤–ï¼ŒLLMsåœ¨RAGæ¡†æ¶ä¸­ä¹Ÿè¢«ç”¨äºæ£€ç´¢å’Œè¯„ä¼°ã€‚è¯†åˆ«è¿›ä¸€æ­¥è§£é”RAGç³»ç»Ÿä¸­LLMsæ½œåŠ›çš„æ–¹æ³•æ˜¯ä¸€ä¸ªä¸æ–­å¢é•¿çš„ç ”ç©¶æ–¹å‘ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è§„æ¨¡æ³•åˆ™&lt;/strong&gt;(&lt;em&gt;Scaling Laws&lt;/em&gt;)ï¼šè™½ç„¶LLMsçš„è§„æ¨¡æ³•åˆ™å·²ç»ç¡®ç«‹[Kaplanç­‰äººï¼Œ2020å¹´]ï¼Œä½†å…¶å¯¹RAGçš„é€‚ç”¨æ€§ä»ä¸ç¡®å®šã€‚åˆæ­¥ç ”ç©¶å·²ç»å¼€å§‹è§£å†³è¿™ä¸ªé—®é¢˜[Wangç­‰äººï¼Œ2023b]ï¼Œä½†RAGæ¨¡å‹çš„å‚æ•°æ•°é‡ä»ç„¶è½åäºLLMsã€‚è¾ƒå°æ¨¡å‹åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼˜äºè¾ƒå¤§æ¨¡å‹çš„é€†è§„æ¨¡æ³•åˆ™ç‰¹åˆ«å¼•äººå…¥èƒœ&lt;sup id=&#34;fnref:9&#34;&gt;&lt;a href=&#34;#fn:9&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;9&lt;/a&gt;&lt;/sup&gt;ï¼Œå€¼å¾—è¿›ä¸€æ­¥è°ƒæŸ¥ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç”Ÿäº§å°±ç»ªçš„RAG&lt;/strong&gt;(&lt;em&gt;Production-Ready RAG&lt;/em&gt;)ï¼šRAGçš„å®ç”¨æ€§å’Œä¸å·¥ç¨‹éœ€æ±‚çš„ä¸€è‡´æ€§ä¿ƒè¿›äº†å…¶é‡‡ç”¨ã€‚ç„¶è€Œï¼Œæé«˜æ£€ç´¢æ•ˆç‡ã€æ”¹å–„å¤§å‹çŸ¥è¯†åº“ä¸­çš„æ–‡æ¡£å¬å›ç‡ä»¥åŠç¡®ä¿æ•°æ®å®‰å…¨ï¼ˆä¾‹å¦‚é˜²æ­¢LLMsæ— æ„ä¸­æŠ«éœ²æ–‡æ¡£æ¥æºæˆ–å…ƒæ•°æ®ï¼‰ç­‰å…³é”®å·¥ç¨‹æŒ‘æˆ˜ä»æœ‰å¾…è§£å†³[Alonç­‰äººï¼Œ2022å¹´]ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;æ¨¡æ€æ‰©å±•çš„ragmodality-extension-of-rag&#34;&gt;æ¨¡æ€æ‰©å±•çš„RAG(&lt;strong&gt;Modality Extension of RAG&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;RAGå·²ç»è¶…è¶Šäº†å…¶æœ€åˆçš„åŸºäºæ–‡æœ¬çš„é—®ç­”é™åˆ¶ï¼Œæ‹¥æŠ±äº†å„ç§æ¨¡æ€æ•°æ®ã€‚è¿™ç§æ‰©å±•å‚¬ç”Ÿäº†åˆ›æ–°çš„å¤šæ¨¡æ€æ¨¡å‹ï¼Œè¿™äº›æ¨¡å‹åœ¨å„ä¸ªé¢†åŸŸæ•´åˆäº†RAGæ¦‚å¿µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å›¾åƒ&lt;/strong&gt;(&lt;em&gt;Image&lt;/em&gt;)ã€‚RA-CM3[Yasunagaç­‰äººï¼Œ2022]æ˜¯ä¸€ç§å…ˆè¿›çš„å¤šæ¨¡æ€æ¨¡å‹ï¼Œèƒ½å¤Ÿæ£€ç´¢å’Œç”Ÿæˆæ–‡æœ¬å’Œå›¾åƒã€‚BLIP-2[Liç­‰äººï¼Œ2023a]åˆ©ç”¨å†»ç»“çš„å›¾åƒç¼–ç å™¨ä¸LLMsä¸€èµ·è¿›è¡Œé«˜æ•ˆçš„è§†è§‰è¯­è¨€é¢„è®­ç»ƒï¼Œå®ç°äº†é›¶-shotå›¾åƒåˆ°æ–‡æœ¬çš„è½¬æ¢ã€‚â€œåœ¨å†™ä¹‹å‰è¿›è¡Œå¯è§†åŒ–â€æ–¹æ³•[Zhuç­‰äººï¼Œ2022]åˆ©ç”¨å›¾åƒç”Ÿæˆæ¥å¼•å¯¼LMçš„æ–‡æœ¬ç”Ÿæˆï¼Œåœ¨å¼€æ”¾å¼æ–‡æœ¬ç”Ÿæˆä»»åŠ¡ä¸­è¡¨ç°å‡ºæ½œåŠ›ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;éŸ³é¢‘å’Œè§†é¢‘&lt;/strong&gt;(&lt;em&gt;Audio and Video&lt;/em&gt;)ã€‚GSSæ–¹æ³•æ£€ç´¢å¹¶æ‹¼æ¥éŸ³é¢‘ç‰‡æ®µï¼Œå°†æœºå™¨ç¿»è¯‘æ•°æ®è½¬æ¢ä¸ºè¯­éŸ³ç¿»è¯‘æ•°æ®[Zhaoç­‰äººï¼Œ2022]ã€‚UEOPé€šè¿‡å¼•å…¥å¤–éƒ¨çš„ç¦»çº¿ç­–ç•¥ï¼Œç”¨äºè¯­éŸ³è½¬æ–‡æœ¬è½¬æ¢ï¼Œå®ç°äº†ç«¯åˆ°ç«¯è‡ªåŠ¨è¯­éŸ³è¯†åˆ«çš„é‡å¤§è¿›æ­¥[Chanç­‰äººï¼Œ2023]ã€‚æ­¤å¤–ï¼ŒåŸºäºKNNçš„æ³¨æ„åŠ›èåˆåˆ©ç”¨éŸ³é¢‘åµŒå…¥å’Œè¯­ä¹‰ç›¸å…³çš„æ–‡æœ¬åµŒå…¥æ¥æ”¹è¿›ASRï¼Œä»è€ŒåŠ é€Ÿé¢†åŸŸé€‚åº”ã€‚Vid2Seqé€šè¿‡å¼•å…¥ä¸“é—¨çš„æ—¶é—´æ ‡è®°ï¼Œä¸ºè¯­è¨€æ¨¡å‹å¢åŠ äº†è¯­ä¹‰ï¼Œä»¥ä¾¿åœ¨ç»Ÿä¸€çš„è¾“å‡ºåºåˆ—ä¸­é¢„æµ‹äº‹ä»¶è¾¹ç•Œå’Œæ–‡æœ¬æè¿°[Yangç­‰äººï¼Œ2023a]ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä»£ç &lt;/strong&gt;(&lt;em&gt;Code&lt;/em&gt;)ã€‚RBPS[Nashidç­‰äººï¼Œ2023]åœ¨å°è§„æ¨¡å­¦ä¹ ä»»åŠ¡ä¸­è¡¨ç°å‡ºè‰²ï¼Œé€šè¿‡ç¼–ç å’Œé¢‘ç‡åˆ†ææ£€ç´¢ä¸å¼€å‘äººå‘˜ç›®æ ‡ä¸€è‡´çš„ä»£ç ç¤ºä¾‹ã€‚è¿™ç§æ–¹æ³•åœ¨æµ‹è¯•æ–­è¨€ç”Ÿæˆå’Œç¨‹åºä¿®å¤ç­‰ä»»åŠ¡ä¸­å·²ç»è¯æ˜äº†å…¶æœ‰æ•ˆæ€§ã€‚å¯¹äºç»“æ„åŒ–çŸ¥è¯†ï¼ŒCoKæ–¹æ³•[Liç­‰äººï¼Œ2023c]é¦–å…ˆä»çŸ¥è¯†å›¾è°±ä¸­æå–ä¸è¾“å…¥æŸ¥è¯¢ç›¸å…³çš„äº‹å®ï¼Œç„¶åå°†è¿™äº›äº‹å®ä½œä¸ºæç¤ºé›†æˆåˆ°è¾“å…¥ä¸­ï¼Œåœ¨çŸ¥è¯†å›¾è°±é—®ç­”ä»»åŠ¡ä¸­æé«˜äº†æ€§èƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;82-ragç”Ÿæ€ç³»ç»Ÿ-ecosystem-of-rag&#34;&gt;8.2 RAGç”Ÿæ€ç³»ç»Ÿ( &lt;strong&gt;Ecosystem of RAG&lt;/strong&gt;)&lt;/h3&gt;
&lt;h4 id=&#34;ä¸‹æ¸¸ä»»åŠ¡å’Œè¯„ä¼°downstream-tasks-and-evaluation&#34;&gt;ä¸‹æ¸¸ä»»åŠ¡å’Œè¯„ä¼°(&lt;strong&gt;Downstream Tasks and Evaluation&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;RAGåœ¨ä¸°å¯Œè¯­è¨€æ¨¡å‹å¤„ç†å¤æ‚æŸ¥è¯¢å’Œç”Ÿæˆè¯¦ç»†å“åº”çš„èƒ½åŠ›æ–¹é¢æ˜¾ç¤ºå‡ºç›¸å½“çš„å‰æ™¯ã€‚RAGä¸ä»…å¢å¼ºäº†å“åº”çš„ç²¾ç¡®æ€§å’Œç›¸å…³æ€§ï¼Œè¿˜å¢å¼ºäº†å…¶å¤šæ ·æ€§å’Œæ·±åº¦ã€‚RAGåœ¨å¤šä¸ªé¢†åŸŸçš„å¯æ‰©å±•æ€§å’Œå¤šåŠŸèƒ½æ€§éœ€è¦è¿›ä¸€æ­¥ç ”ç©¶ï¼Œç‰¹åˆ«æ˜¯åœ¨åŒ»å­¦ã€æ³•å¾‹å’Œæ•™è‚²ç­‰ä¸“ä¸šé¢†åŸŸã€‚åœ¨è¿™äº›é¢†åŸŸï¼ŒRAGå¯èƒ½æ¯”ä¼ ç»Ÿçš„å¾®è°ƒæ–¹æ³•æ›´èƒ½é™ä½è®­ç»ƒæˆæœ¬å¹¶æé«˜æ€§èƒ½ã€‚åŒæ—¶ï¼Œå®Œå–„RAGçš„è¯„ä¼°æ¡†æ¶å¯¹äºæœ€å¤§åŒ–å…¶åœ¨ä¸åŒä»»åŠ¡ä¸­çš„æœ‰æ•ˆæ€§å’Œå®ç”¨æ€§è‡³å…³é‡è¦ã€‚è¿™éœ€è¦å¼€å‘èƒ½å¤Ÿè¡¡é‡ä¸Šä¸‹æ–‡ç›¸å…³æ€§ã€å†…å®¹åˆ›é€ æ€§å’Œéæ¶æ„æ€§ç­‰æ–¹é¢ç»†å¾®å·®åˆ«çš„æŒ‡æ ‡å’Œè¯„ä¼°å·¥å…·ã€‚æ­¤å¤–ï¼Œæé«˜RAGé©±åŠ¨æ¨¡å‹çš„å¯è§£é‡Šæ€§ä»ç„¶æ˜¯ä¸€ä¸ªå…³é”®ç›®æ ‡ã€‚è¿™æ ·åšå°†å…è®¸ç”¨æˆ·ç†è§£æ¨¡å‹ç”Ÿæˆå“åº”èƒŒåçš„æ¨ç†è¿‡ç¨‹ï¼Œä»è€Œä¿ƒè¿›å¯¹RAGåº”ç”¨çš„ä¿¡ä»»å’Œé€æ˜åº¦ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æŠ€æœ¯æ ˆtechnical-stack&#34;&gt;æŠ€æœ¯æ ˆ(&lt;strong&gt;Technical Stack&lt;/strong&gt;)&lt;/h4&gt;
&lt;p&gt;RAGç”Ÿæ€ç³»ç»Ÿçš„å‘å±•å—åˆ°å…¶æŠ€æœ¯æ ˆè¿›å±•çš„æå¤§å½±å“ã€‚åƒLangChainå’ŒLLamaIndexè¿™æ ·çš„å…³é”®å·¥å…·éšç€ChatGPTçš„å‡ºç°è¿…é€Ÿæµè¡Œï¼Œæä¾›äº†å¹¿æ³›çš„RAGç›¸å…³APIï¼Œå¹¶æˆä¸ºLLMsé¢†åŸŸçš„é‡è¦å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;æ–°å…´çš„æŠ€æœ¯æ ˆï¼Œè™½ç„¶åŠŸèƒ½ä¸å¦‚LangChainå’ŒLLamaIndexä¸°å¯Œï¼Œä½†ä»¥å…¶ä¸“ä¸šæœåŠ¡è„±é¢–è€Œå‡ºã€‚ä¾‹å¦‚ï¼ŒFlowise AI&lt;sup id=&#34;fnref:10&#34;&gt;&lt;a href=&#34;#fn:10&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;10&lt;/a&gt;&lt;/sup&gt;ä¼˜å…ˆè€ƒè™‘ä½ä»£ç æ–¹æ³•ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡ç”¨æˆ·å‹å¥½çš„æ‹–æ”¾ç•Œé¢éƒ¨ç½²AIåº”ç”¨ï¼ŒåŒ…æ‹¬RAGã€‚å…¶ä»–æŠ€æœ¯å¦‚HayStackã€Meltano&lt;sup id=&#34;fnref:11&#34;&gt;&lt;a href=&#34;#fn:11&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;11&lt;/a&gt;&lt;/sup&gt;å’ŒCohere Coral&lt;sup id=&#34;fnref:12&#34;&gt;&lt;a href=&#34;#fn:12&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;12&lt;/a&gt;&lt;/sup&gt;ä¹Ÿå› å…¶åœ¨è¯¥é¢†åŸŸçš„ç‰¹æ®Šè´¡çŒ®è€Œå—åˆ°å…³æ³¨ã€‚&lt;/p&gt;
&lt;p&gt;é™¤äº†AIä¸“ä¸šæä¾›å•†å¤–ï¼Œä¼ ç»Ÿçš„è½¯ä»¶å’Œäº‘æœåŠ¡æä¾›å•†ä¹Ÿåœ¨æ‰©å±•å…¶äº§å“ï¼ŒåŒ…æ‹¬ä»¥RAGä¸ºä¸­å¿ƒçš„æœåŠ¡ã€‚Weaviateçš„Verba&lt;sup id=&#34;fnref:13&#34;&gt;&lt;a href=&#34;#fn:13&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;13&lt;/a&gt;&lt;/sup&gt;ä¸“ä¸ºä¸ªäººåŠ©ç†åº”ç”¨è®¾è®¡ï¼Œè€ŒAmazonçš„Kendraæä¾›æ™ºèƒ½ä¼ä¸šæœç´¢æœåŠ¡ï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨å†…ç½®è¿æ¥å™¨æµè§ˆå„ç§å†…å®¹åº“ã€‚åœ¨RAGæŠ€æœ¯æ™¯è§‚çš„æ¼”å˜è¿‡ç¨‹ä¸­ï¼Œæ˜æ˜¾å‡ºç°äº†ä¸åŒçš„ä¸“ä¸šåŒ–æ–¹å‘ï¼Œä¾‹å¦‚ï¼š1ï¼‰å®šåˆ¶åŒ–ã€‚æ ¹æ®ç‰¹å®šè¦æ±‚å®šåˆ¶RAGã€‚2ï¼‰ç®€åŒ–ã€‚ä½¿RAGæ›´æ˜“äºä½¿ç”¨ï¼Œä»è€Œé™ä½åˆå§‹å­¦ä¹ æ›²çº¿ã€‚3ï¼‰ä¸“ä¸šåŒ–ã€‚ä¼˜åŒ–RAGä»¥æ›´æœ‰æ•ˆåœ°æœåŠ¡äºç”Ÿäº§ç¯å¢ƒã€‚&lt;/p&gt;
&lt;p&gt;RAGæ¨¡å‹åŠå…¶æŠ€æœ¯æ ˆçš„ç›¸äº’å¢é•¿æ˜¾è€Œæ˜“è§ï¼›æŠ€æœ¯è¿›æ­¥ä¸æ–­ä¸ºç°æœ‰åŸºç¡€è®¾æ–½è®¾å®šæ–°çš„æ ‡å‡†ã€‚åè¿‡æ¥ï¼ŒæŠ€æœ¯æ ˆçš„å¢å¼ºæ¨åŠ¨äº†RAGèƒ½åŠ›çš„è¿›åŒ–ã€‚RAGå·¥å…·åŒ…æ­£åœ¨æ±‡èšæˆä¸€ä¸ªåŸºç¡€æŠ€æœ¯æ ˆï¼Œä¸ºå…ˆè¿›çš„ä¼ä¸šåº”ç”¨å¥ å®šåŸºç¡€ã€‚ç„¶è€Œï¼Œä¸€ä¸ªå®Œå…¨é›†æˆçš„ã€å…¨é¢å¹³å°çš„æ¦‚å¿µä»ç„¶åœ¨åœ°å¹³çº¿ä¸Šï¼Œç­‰å¾…è¿›ä¸€æ­¥çš„åˆ›æ–°å’Œå‘å±•ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬9ç« ç»“è®º&#34;&gt;ç¬¬9ç« ï¼šç»“è®º&lt;/h2&gt;
&lt;p&gt;æœ¬æ–‡çš„æ€»ç»“ï¼Œå¦‚å›¾7æ‰€ç¤ºï¼Œçªå‡ºäº†RAGåœ¨é€šè¿‡æ•´åˆæ¥è‡ªè¯­è¨€æ¨¡å‹çš„å‚æ•°åŒ–çŸ¥è¯†ä¸æ¥è‡ªå¤–éƒ¨çŸ¥è¯†åº“çš„éå‚æ•°åŒ–æ•°æ®ï¼Œæ˜¾è‘—æå‡äº†LLMsçš„èƒ½åŠ›ã€‚æˆ‘ä»¬çš„ç»¼è¿°å±•ç¤ºäº†RAGæŠ€æœ¯çš„æ¼”å˜åŠå…¶å¯¹çŸ¥è¯†å¯†é›†å‹ä»»åŠ¡çš„å½±å“ã€‚æˆ‘ä»¬çš„åˆ†ææç»˜äº†RAGæ¡†æ¶å†…çš„ä¸‰ä¸ªå‘å±•èŒƒå¼ï¼šæœ´ç´ RAGã€é«˜çº§RAGå’Œæ¨¡å—åŒ–RAGï¼Œæ¯ä¸ªéƒ½æ ‡å¿—ç€å¯¹å…¶å‰èº«çš„é€æ­¥å¢å¼ºã€‚é«˜çº§RAGèŒƒå¼é€šè¿‡å¼•å…¥å¤æ‚çš„æ¶æ„å…ƒç´ ï¼Œå¦‚æŸ¥è¯¢é‡å†™ã€å—é‡æ’å’Œæç¤ºæ‘˜è¦ï¼Œè¶…è¶Šäº†æœ´ç´ æ–¹æ³•ã€‚è¿™äº›åˆ›æ–°å¯¼è‡´äº†æ›´ç»†è‡´å’Œæ¨¡å—åŒ–çš„æ¶æ„ï¼Œæé«˜äº†LLMsçš„æ€§èƒ½å’Œå¯è§£é‡Šæ€§ã€‚RAGä¸å…¶ä»–AIæ–¹æ³•ï¼ˆå¦‚å¾®è°ƒå’Œå¼ºåŒ–å­¦ä¹ ï¼‰çš„æŠ€æœ¯æ•´åˆè¿›ä¸€æ­¥æ‰©å±•äº†å…¶èƒ½åŠ›ã€‚åœ¨å†…å®¹æ£€ç´¢æ–¹é¢ï¼Œä¸€ç§æ··åˆæ–¹æ³•æ­£åœ¨å…´èµ·ï¼Œå®ƒåˆ©ç”¨ç»“æ„åŒ–å’Œéç»“æ„åŒ–æ•°æ®æºï¼Œæä¾›äº†æ›´ä¸°å¯Œçš„æ£€ç´¢è¿‡ç¨‹ã€‚RAGæ¡†æ¶å†…çš„æœ€æ–°ç ”ç©¶æ­£åœ¨æ¢ç´¢è¯¸å¦‚ä»LLMsè‡ªæˆ‘æ£€ç´¢å’Œä¿¡æ¯æ£€ç´¢çš„åŠ¨æ€æ—¶æœºç­‰æ–°æ¦‚å¿µã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/weedge/mypic/raw/master/rag/RAG_for_LLMs_A_Survey/7.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å°½ç®¡RAGæŠ€æœ¯å–å¾—äº†è¿›æ­¥ï¼Œä½†åœ¨æé«˜å…¶é²æ£’æ€§å’Œç®¡ç†æ‰©å±•ä¸Šä¸‹æ–‡çš„èƒ½åŠ›æ–¹é¢ä»æœ‰è®¸å¤šç ”ç©¶æœºä¼šã€‚RAGçš„åº”ç”¨èŒƒå›´ä¹Ÿåœ¨å‘å¤šæ¨¡æ€é¢†åŸŸæ‰©å±•ï¼Œå°†å…¶åŸç†é€‚åº”äºè§£é‡Šå’Œå¤„ç†å„ç§æ•°æ®å½¢å¼ï¼Œå¦‚å›¾åƒã€è§†é¢‘å’Œä»£ç ã€‚è¿™ç§æ‰©å±•å¼ºè°ƒäº†RAGåœ¨AIéƒ¨ç½²ä¸­çš„é‡è¦å®é™…æ„ä¹‰ï¼Œå¸å¼•äº†å­¦æœ¯ç•Œå’Œå·¥ä¸šç•Œçš„å…³æ³¨ã€‚RAGçš„ç”Ÿæ€ç³»ç»Ÿæ­£åœ¨å¢é•¿ï¼ŒRAGä¸­å¿ƒçš„AIåº”ç”¨å’Œæ”¯æŒå·¥å…·çš„æŒç»­å¼€å‘ã€‚ç„¶è€Œï¼Œéšç€RAGåº”ç”¨é¢†åŸŸçš„æ‰©å¤§ï¼Œè¿«åˆ‡éœ€è¦å®Œå–„è¯„ä¼°æ–¹æ³•ä»¥è·Ÿä¸Šå…¶å‘å±•çš„æ­¥ä¼ã€‚ç¡®ä¿æ€§èƒ½è¯„ä¼°ä¿æŒå‡†ç¡®å’Œä»£è¡¨æ€§å¯¹äºæ•æ‰RAGå¯¹AIç ”ç©¶å’Œå‘å±•ç¤¾åŒºçš„è´¡çŒ®è‡³å…³é‡è¦ã€‚&lt;/p&gt;
&lt;h2 id=&#34;references&#34;&gt;References&lt;/h2&gt;
&lt;p&gt;[Alonç­‰äººï¼Œ2022] Uri Alon, Frank Xu, Junxian He, Sudipta Sengupta, Dan Roth, and Graham Neubig. Neurosymbolic language modeling with automaton-augmented retrieval. In International Conference on Machine Learning, pages 468â€“485. PMLR, 2022.&lt;/p&gt;
&lt;p&gt;[Andersonç­‰äººï¼Œ2022] Nathan Anderson, Caleb Wilson, and Stephen D. Richardson. Lingua: Addressing scenarios for live interpretation and automatic dubbing. In Janice Campbell, Stephen Larocca, Jay Marciano, Konstantin Savenkov, and Alex Yanishevsky, editors, Proceedings of the 15th Biennial Conference of the Association for Machine Translation in the Americas (Volume 2: Users and Providers Track and Government Track), pages 202â€“209, Orlando, USA, September 2022. Association for Machine Translation in the Americas.&lt;/p&gt;
&lt;p&gt;[Aroraç­‰äººï¼Œ2023] Daman Arora, Anush Kini, Sayak Ray Chowdhury, Nagarajan Natarajan, Gaurav Sinha, and Amit Sharma. Gar-meets-rag paradigm for zero-shot information retrieval. arXiv preprint arXiv:2310.20158, 2023.&lt;/p&gt;
&lt;p&gt;[Asaiç­‰äººï¼Œ2023] Akari Asai, Zeqiu Wu, Yizhong Wang, Avirup Sil, and Hannaneh Hajishirzi. Self-rag: Learning to retrieve, generate, and critique through self-reflection. arXiv preprint arXiv:2310.11511, 2023.&lt;/p&gt;
&lt;p&gt;[BAAI, 2023] BAAI. Flagembedding. &lt;a href=&#34;https://github.com/FlagOpen/FlagEmbedding&#34;&gt;https://github.com/FlagOpen/FlagEmbedding&lt;/a&gt;, 2023.&lt;/p&gt;
&lt;p&gt;[Baekç­‰äººï¼Œ2023] Jinheon Baek, Soyeong Jeong, Minki Kang, Jong C Park, and Sung Ju Hwang. Knowledge-augmented language model verification. arXiv preprint arXiv:2310.12836, 2023.&lt;/p&gt;
&lt;p&gt;[Berchanskyç­‰äººï¼Œ2023] Moshe Berchansky, Peter Izsak, Avi Caciularu, Ido Dagan, and Moshe Wasserblat. Optimizing retrieval-augmented reader models via token elimination. arXiv preprint arXiv:2310.13682, 2023.&lt;/p&gt;
&lt;p&gt;[Blagojevi, 2023] Vladimir Blagojevi. Enhancing rag pipelines in haystack: Introducing diversityranker and lostinthemiddleranker. &lt;a href=&#34;https://towardsdatascience.com/enhancing-rag-pipelines-in-haystack-45f14e2bc9f5&#34;&gt;https://towardsdatascience.com/enhancing-rag-pipelines-in-haystack-45f14e2bc9f5&lt;/a&gt;, 2023.&lt;/p&gt;
&lt;p&gt;[Borgeaudç­‰äººï¼Œ2022] Sebastian Borgeaud, Arthur Mensch, Jordan Hoffmann, Trevor Cai, Eliza Rutherford, Katie Millican, George Bm Van Den Driessche, Jean-Baptiste Lespiau, Bogdan Damoc, Aidan Clark, et al. Improving language models by retrieving from trillions of tokens. In International conference on machine learning, pages 2206â€“2240. PMLR, 2022.&lt;/p&gt;
&lt;p&gt;[Brownç­‰äººï¼Œ2020] Tom Brown, Benjamin Mann, Nick Ryder, Melanie Subbiah, Jared D Kaplan, Prafulla Dhariwal, Arvind Neelakantan, Pranav Shyam, Girish Sastry, Amanda Askell, et al. Language models are few-shot learners. Advances in neural information processing systems, 33:1877â€“1901, 2020.&lt;/p&gt;
&lt;p&gt;[Caiç­‰äººï¼Œ2021] Deng Cai, Yan Wang, Huayang Li, Wai Lam, and Lemao Liu. Neural machine translation with monolingual translation memory. arXiv preprint arXiv:2105.11269, 2021.&lt;/p&gt;
&lt;p&gt;[Chanç­‰äººï¼Œ2023] David M Chan, Shalini Ghosh, Ariya Rastrow, and BjÃ¶rn Hoffmeister. Using external off-policy speech-to-text mappings in contextual end-to-end automated speech recognition. arXiv preprint arXiv:2301.02736, 2023.&lt;/p&gt;
&lt;p&gt;[Chenç­‰äººï¼Œ2023a] Howard Chen, Ramakanth Pasunuru, Jason Weston, and Asli Celikyilmaz. Walking down the memory maze: Beyond context limit through interactive reading. arXiv preprint arXiv:2310.05029, 2023.&lt;/p&gt;
&lt;p&gt;[Chenç­‰äººï¼Œ2023b] Jiawei Chen, Hongyu Lin, Xianpei Han, and Le Sun. Benchmarking large language models in retrieval-augmented generation. arXiv preprint arXiv:2309.01431, 2023.&lt;/p&gt;
&lt;p&gt;[Chengç­‰äººï¼Œ2022] Xin Cheng, Shen Gao, Lemao Liu, Dongyan Zhao, and Rui Yan. Neural machine translation with contrastive translation memories. arXiv preprint arXiv:2212.03140, 2022.&lt;/p&gt;
&lt;p&gt;[Chengç­‰äººï¼Œ2023a] Daixuan Cheng, Shaohan Huang, Junyu Bi, Yuefeng Zhan, Jianfeng Liu, Yujing Wang, Hao Sun, Furu Wei, Denvy Deng, and Qi Zhang. Uprise: Universal prompt retrieval for improving zero-shot evaluation. arXiv preprint arXiv:2303.08518, 2023.&lt;/p&gt;
&lt;p&gt;[Chengç­‰äººï¼Œ2023b] Xin Cheng, Di Luo, Xiuying Chen, Lemao Liu, Dongyan Zhao, and Rui Yan. Lift yourself up: Retrieval-augmented text generation with self memory. arXiv preprint arXiv:2305.02437, 2023.&lt;/p&gt;
&lt;p&gt;[Cohere, 2023] Cohere. Say goodbye to irrelevant search results: Cohere rerank is here. &lt;a href=&#34;https://txt.cohere.com/rerank/&#34;&gt;https://txt.cohere.com/rerank/&lt;/a&gt;, 2023.&lt;/p&gt;
&lt;p&gt;[Daiç­‰äººï¼Œ2022] Zhuyun Dai, Vincent Y Zhao, Ji Ma, Yi Luan, Jianmo Ni, Jing Lu, Anton Bakalov, Kelvin Guu, Keith B Hall, and Ming-Wei Chang. Promptagator: Few-shot dense retrieval from 8 examples. arXiv preprint arXiv:2209.11755, 2022.&lt;/p&gt;
&lt;p&gt;[Esç­‰äººï¼Œ2023] Shahul Es, Jithin James, Luis EspinosaAnke, and Steven Schockaert. Ragas: Automated evaluation of retrieval augmented generation. arXiv preprint arXiv:2309.15217, 2023.&lt;/p&gt;
&lt;p&gt;[Fengç­‰äººï¼Œ2023] Zhangyin Feng, Xiaocheng Feng, Dezhi Zhao, Maojin Yang, and Bing Qin. Retrieval-generation synergy augmented large language models. arXiv preprint arXiv:2310.05149, 2023.&lt;/p&gt;
&lt;p&gt;[Gaoç­‰äººï¼Œ2022] Luyu Gao, Xueguang Ma, Jimmy Lin, and Jamie Callan. Precise zero-shot dense retrieval without relevance labels. arXiv preprint arXiv:2212.10496, 2022.&lt;/p&gt;
&lt;p&gt;[Glassç­‰äººï¼Œ2021] Michael Glass, Gaetano Rossiello, Md Faisal Mahbub Chowdhury, and Alfio Gliozzo. Robust retrieval augmented generation for zero-shot slot filling. arXiv preprint arXiv:2108.13934, 2021.&lt;/p&gt;
&lt;p&gt;[Google, 2023] Google. Gemini: A family of highly capable multimodal models. &lt;a href=&#34;https://goo.gle/GeminiPaper&#34;&gt;https://goo.gle/GeminiPaper&lt;/a&gt;, 2023.&lt;/p&gt;
&lt;p&gt;[Guoç­‰äººï¼Œ2023] Zhicheng Guo, Sijie Cheng, Yile Wang, Peng Li, and Yang Liu. Prompt-guided retrieval augmentation for non-knowledge-intensive tasks. arXiv preprint arXiv:2305.17653, 2023.&lt;/p&gt;
&lt;p&gt;[Hendrycksç­‰äººï¼Œ2020] Dan Hendrycks, Collin Burns, Steven Basart, Andy Zou, Mantas Mazeika, Dawn Song, and Jacob Steinhardt. Measuring massive multitask language understanding. arXiv preprint arXiv:2009.03300, 2020.&lt;/p&gt;
&lt;p&gt;[Hoshiç­‰äººï¼Œ2023] Yasuto Hoshi, Daisuke Miyashita, Youyang Ng, Kento Tatsuno, Yasuhiro Morioka, Osamu Torii, and Jun Deguchi. Ralle: A framework for developing and evaluating retrieval-augmented large language models. arXiv preprint arXiv:2308.10633, 2023.&lt;/p&gt;
&lt;p&gt;[Huangç­‰äººï¼Œ2023] Jie Huang, Wei Ping, Peng Xu, Mohammad Shoeybi, Kevin Chen-Chuan Chang, and Bryan Catanzaro. Raven: In-context learning with retrieval augmented encoder-decoder language models. arXiv preprint arXiv:2308.07922, 2023.&lt;/p&gt;
&lt;p&gt;[ILIN, 2023] IVAN ILIN. Advanced rag techniques: an illustrated overview. &lt;a href=&#34;https://pub.towardsai.net/advanced-rag-techniques-an-illustrated-overview-04d193d8fec6&#34;&gt;https://pub.towardsai.net/advanced-rag-techniques-an-illustrated-overview-04d193d8fec6&lt;/a&gt;, 2023.&lt;/p&gt;
&lt;p&gt;[Izacardç­‰äººï¼Œ2022] Gautier Izacard, Patrick Lewis, Maria Lomeli, Lucas Hosseini, Fabio Petroni, Timo Schick, Jane Dwivedi-Yu, Armand Joulin, Sebastian Riedel, and Edouard Grave. Few-shot learning with retrieval augmented language models. arXiv preprint arXiv:2208.03299, 2022.&lt;/p&gt;
&lt;p&gt;[Jarviså’ŒAllardï¼Œ2023] Colin Jarvis and John Allard. A survey of techniques for maximizing LLM performance. &lt;a href=&#34;https://community.openai.com/t/openai-dev-day-2023-breakout-sessions/505213#a-survey-of-techniques-for-maximizing-llm-performance-2&#34;&gt;https://community.openai.com/t/openai-dev-day-2023-breakout-sessions/505213#a-survey-of-techniques-for-maximizing-llm-performance-2&lt;/a&gt;, 2023.&lt;/p&gt;
&lt;p&gt;[Jiangç­‰äººï¼Œ2023a] Huiqiang Jiang, Qianhui Wu, Chin-Yew Lin, Yuqing Yang, and Lili Qiu. Llmlingua: Compressing prompts for accelerated inference of large language models. arXiv preprint arXiv:2310.05736, 2023.&lt;/p&gt;
&lt;p&gt;[Jiangç­‰äººï¼Œ2023b] Zhengbao Jiang, Frank F Xu, Luyu Gao, Zhiqing Sun, Qian Liu, Jane Dwivedi-Yu, Yiming Yang, Jamie Callan, and Graham Neubig. Active retrieval augmented generation. arXiv preprint arXiv:2305.06983, 2023.&lt;/p&gt;
&lt;p&gt;[Kandpalç­‰äººï¼Œ2023] Nikhil Kandpal, Haikang Deng, Adam Roberts, Eric Wallace, and Colin Raffel. Large language models struggle to learn long-tail knowledge. In International Conference on Machine Learning, pages 15696â€“15707. PMLR, 2023.&lt;/p&gt;
&lt;p&gt;[Kangç­‰äººï¼Œ2023] Minki Kang, Jin Myung Kwak, Jinheon Baek, and Sung Ju Hwang. Knowledge graph-augmented language models for knowledge-grounded dialogue generation. arXiv preprint arXiv:2305.18846, 2023.&lt;/p&gt;
&lt;p&gt;[Kaplanç­‰äººï¼Œ2020] Jared Kaplan, Sam McCandlish, Tom Henighan, Tom B Brown, Benjamin Chess, Rewon Child, Scott Gray, Alec Radford, Jeffrey Wu, and Dario Amodei. Scaling laws for neural language models. arXiv preprint arXiv:2001.08361, 2020.&lt;/p&gt;
&lt;p&gt;[Karpukhinç­‰äººï¼Œ2020] Vladimir Karpukhin, Barlas OË˜guz, Sewon Min, Patrick Lewis, Ledell Wu, Sergey Edunov, Danqi Chen, and Wen-tau Yih. Dense passage retrieval for open-domain question answering. arXiv preprint arXiv:2004.04906, 2020.&lt;/p&gt;
&lt;p&gt;[Khandelwalç­‰äººï¼Œ2019] Urvashi Khandelwal, Omer Levy, Dan Jurafsky, Luke Zettlemoyer, and Mike Lewis. Generalization through memorization: Nearest neighbor language models. arXiv preprint arXiv:1911.00172, 2019.&lt;/p&gt;
&lt;p&gt;[Khattabç­‰äººï¼Œ2022] Omar Khattab, Keshav Santhanam, Xiang Lisa Li, David Hall, Percy Liang, Christopher Potts, and Matei Zaharia. Demonstrate-search-predict: Composing retrieval and language models for knowledge-intensive nlp. arXiv preprint arXiv:2212.14024, 2022.&lt;/p&gt;
&lt;p&gt;[Kimç­‰äººï¼Œ2023] Gangwoo Kim, Sungdong Kim, Byeongguk Jeon, Joonsuk Park, and Jaewoo Kang. Tree of clarifications: Answering ambiguous questions with retrieval-augmented large language models. arXiv preprint arXiv:2310.14696, 2023.&lt;/p&gt;
&lt;p&gt;[Lanç­‰äººï¼Œ2022] Tian Lan, Deng Cai, Yan Wang, Heyan Huang, and Xian-Ling Mao. Copy is all you need. In The Eleventh International Conference on Learning Representations, 2022.&lt;/p&gt;
&lt;p&gt;[Leeç­‰äººï¼Œ2020] Jinhyuk Lee, Mujeen Sung, Jaewoo Kang, and Danqi Chen. Learning dense representations of phrases at scale. arXiv preprint arXiv:2012.12624, 2020.&lt;/p&gt;
&lt;p&gt;[Lengç­‰äººï¼Œ2023] Quinn Leng, Kasey Uhlenhuth, and Alkis Polyzotis. Best practices for LLM evaluation of RAG applications. &lt;a href=&#34;https://www.databricks.com/blog/LLM-auto-eval-best-practices-RAG&#34;&gt;https://www.databricks.com/blog/LLM-auto-eval-best-practices-RAG&lt;/a&gt;, 2023.&lt;/p&gt;
&lt;p&gt;[Lewisç­‰äººï¼Œ2020] Patrick Lewis, Ethan Perez, Aleksandra Piktus, Fabio Petroni, Vladimir Karpukhin, Naman Goyal, Heinrich KÂ¨uttler, Mike Lewis, Wen-tau Yih, Tim RocktÂ¨aschel, et al. Retrieval-augmented generation for knowledge-intensive nlp tasks. Advances in Neural Information Processing Systems, 33:9459â€“9474, 2020.&lt;/p&gt;
&lt;p&gt;[Li and Li, 2023] Xianming Li and Jing Li. Angle-optimized text embeddings. arXiv preprint arXiv:2309.12871, 2023.&lt;/p&gt;
&lt;p&gt;[Liç­‰äººï¼Œ2023a] Junnan Li, Dongxu Li, Silvio Savarese, and Steven Hoi. Blip-2: Bootstrapping language-image pretraining with frozen image encoders and large language models. arXiv preprint arXiv:2301.12597, 2023.&lt;/p&gt;
&lt;p&gt;[Liç­‰äººï¼Œ2023b] Xiaoqian Li, Ercong Nie, and Sheng Liang. From classification to generation: Insights into crosslingual retrieval augmented ICL. arXiv preprint arXiv:2311.06595, 2023.&lt;/p&gt;
&lt;p&gt;[Liç­‰äººï¼Œ2023c] Xingxuan Li, Ruochen Zhao, Yew Ken Chia, Bosheng Ding, Lidong Bing, Shafiq Joty, and Soujanya Poria. Chain of knowledge: A framework for grounding large language models with structured knowledge bases. arXiv preprint arXiv:2305.13269, 2023.&lt;/p&gt;
&lt;p&gt;[Liç­‰äººï¼Œ2023d] Xinze Li, Zhenghao Liu, Chenyan Xiong, Shi Yu, Yu Gu, Zhiyuan Liu, and Ge Yu. Structure-aware language model pretraining improves dense retrieval on structured data. arXiv preprint arXiv:2305.19912, 2023.&lt;/p&gt;
&lt;p&gt;[Liangç­‰äººï¼Œ2023] Han Liang, Wenqian Zhang, Wenxuan Li, Jingyi Yu, and Lan Xu. Intergen: Diffusion-based multi-human motion generation under complex interactions. arXiv preprint arXiv:2304.05684, 2023.&lt;/p&gt;
&lt;p&gt;[Linç­‰äººï¼Œ2023] Xi Victoria Lin, Xilun Chen, Mingda Chen, Weijia Shi, Maria Lomeli, Rich James, Pedro Rodriguez, Jacob Kahn, Gergely Szilvasy, Mike Lewis, et al. Ra-dit: Retrieval-augmented dual instruction tuning. arXiv preprint arXiv:2310.01352, 2023.&lt;/p&gt;
&lt;p&gt;[Litmanç­‰äººï¼Œ2020] Ron Litman, Oron Anschel, Shahar Tsiper, Roee Litman, Shai Mazor, and R Manmatha. Scatter: selective context attentional scene text recognizer. In proceedings of the IEEE/CVF conference on computer vision and pattern recognition, pages 11962â€“11972, 2020.&lt;/p&gt;
&lt;p&gt;[Liuç­‰äººï¼Œ2023a] Nelson F Liu, Kevin Lin, John Hewitt, Ashwin Paranjape, Michele Bevilacqua, Fabio Petroni, and Percy Liang. Lost in the middle: How language models use long contexts. arXiv preprint arXiv:2307.03172, 2023.&lt;/p&gt;
&lt;p&gt;[Liuç­‰äººï¼Œ2023b] Yi Liu, Lianzhe Huang, Shicheng Li, Sishuo Chen, Hao Zhou, Fandong Meng, Jie Zhou, and Xu Sun. Recall: A benchmark for LLMs robustness against external counterfactual knowledge. arXiv preprint arXiv:2311.08147, 2023.&lt;/p&gt;
&lt;p&gt;[Liu, 2023] Jerry Liu. Building production-ready RAG applications. &lt;a href=&#34;https://www.ai.engineer/summit/schedule/building-production-ready-rag-applications&#34;&gt;https://www.ai.engineer/summit/schedule/building-production-ready-rag-applications&lt;/a&gt;, 2023.&lt;/p&gt;
&lt;p&gt;[Luoç­‰äººï¼Œ2023] Ziyang Luo, Can Xu, Pu Zhao, Xiubo Geng, Chongyang Tao, Jing Ma, Qingwei Lin, and Daxin Jiang. Augmented large language models with parametric knowledge guiding. arXiv preprint arXiv:2305.04757, 2023.&lt;/p&gt;
&lt;p&gt;[Maç­‰äººï¼Œ2023a] Xinbei Ma, Yeyun Gong, PengchengHe, Hai Zhao, and Nan Duan. Query rewriting for retrieval-augmented large language models. arXiv preprint arXiv:2305.14283, 2023.&lt;/p&gt;
&lt;p&gt;[Maç­‰äººï¼Œ2023b] Yubo Ma, Yixin Cao, YongChing Hong, and Aixin Sun. Large language model is not a good few-shot information extractor, but a good reranker for hard samples! ArXiv, abs/2303.08559, 2023.&lt;/p&gt;
&lt;p&gt;[Modarressiç­‰äººï¼Œ2023] Ali Modarressi, Ayyoob Imani, Mohsen Fayyaz, and Hinrich SchÃ¼tze. Ret-llm: Towards a general read-write memory for large language models. arXiv preprint arXiv:2305.14322, 2023.&lt;/p&gt;
&lt;p&gt;[Nakanoç­‰äººï¼Œ2021] Reiichiro Nakano, Jacob Hilton, Suchir Balaji, Jeff Wu, Long Ouyang, Christina Kim, Christopher Hesse, Shantanu Jain, Vineet Kosaraju, William Saunders, et al. Webgpt: Browser-assisted question-answering with human feedback. arXiv preprint arXiv:2112.09332, 2021.&lt;/p&gt;
&lt;p&gt;[Nashidç­‰äººï¼Œ2023] Noor Nashid, Mifta Sintaha, and Ali Mesbah. Retrieval-based prompt selection for code-related few-shot learning. In 2023 IEEE/ACM 45th International Conference on Software Engineering (ICSE), pages 2450â€“ 2462, 2023.&lt;/p&gt;
&lt;p&gt;[Nguyen, 2023] Isabelle Nguyen. Evaluating RAG part i: How to evaluate document retrieval. &lt;a href=&#34;https://www.deepset.ai/&#34;&gt;https://www.deepset.ai/&lt;/a&gt; blog/rag-evaluation-retrieval, 2023.&lt;/p&gt;
&lt;p&gt;[Nishikawaç­‰äººï¼Œ2022] Sosuke Nishikawa, Ryokan Ri, Ikuya Yamada, Yoshimasa Tsuruoka, and Isao Echizen. EASE: Entity-aware contrastive learning of sentence embedding. arXiv preprint arXiv:2205.04260, 2022.&lt;/p&gt;
&lt;p&gt;[OpenAI, 2023] OpenAI. GPT-4 technical report. https://cdn. openai.com/papers/gpt-4.pdf, 2023.&lt;/p&gt;
&lt;p&gt;[Packerç­‰äººï¼Œ2023] Charles Packer, Vivian Fang, Shishir G Patil, Kevin Lin, Sarah Wooders, and Joseph E Gonzalez. Memgpt: Towards LLMs as operating systems. arXiv preprint arXiv:2310.08560, 2023.&lt;/p&gt;
&lt;p&gt;[Raffelç­‰äººï¼Œ2020] Colin Raffel, Noam Shazeer, Adam Roberts, Katherine Lee, Sharan Narang, Michael Matena, Yanqi Zhou, Wei Li, and Peter J Liu. Exploring the limits of transfer learning with a unified text-to-text transformer. The Journal of Machine Learning Research, 21(1):5485â€“ 5551, 2020.&lt;/p&gt;
&lt;p&gt;[Ramç­‰äººï¼Œ2023] Ori Ram, Yoav Levine, Itay Dalmedigos, Dor Muhlgay, Amnon Shashua, Kevin Leyton-Brown, and Yoav Shoham. In-context retrieval-augmented language models. arXiv preprint arXiv:2302.00083, 2023.&lt;/p&gt;
&lt;p&gt;[Raudaschl, 2023] Adrian H. Raudaschl. Forget RAG, the future is RAG-Fusion. &lt;a href=&#34;https://towardsdatascience.com/&#34;&gt;https://towardsdatascience.com/&lt;/a&gt; forget-RAG-the-future-is-RAG-Fusion-1147298d8ad1, 2023.&lt;/p&gt;
&lt;p&gt;[Saad-Falconç­‰äººï¼Œ2023] Jon Saad-Falcon, Omar Khattab, Christopher Potts, and Matei Zaharia. Ares: An automated evaluation framework for retrieval-augmented generation systems. arXiv preprint arXiv:2311.09476, 2023.&lt;/p&gt;
&lt;p&gt;[Schickç­‰äººï¼Œ2023] Timo Schick, Jane Dwivedi-Yu, Roberto Dess`Ä±, Roberta Raileanu, Maria Lomeli, Luke Zettlemoyer, Nicola Cancedda, and Thomas Scialom. Toolformer: Language models can teach themselves to use tools. arXiv preprint arXiv:2302.04761, 2023.&lt;/p&gt;
&lt;p&gt;[Sciavolinoç­‰äººï¼Œ2021] Christopher Sciavolino, Zexuan Zhong, Jinhyuk Lee, and Danqi Chen. Simple entity-centric questions challenge dense retrievers. arXiv preprint arXiv:2109.08535, 2021.&lt;/p&gt;
&lt;p&gt;[Shaoç­‰äººï¼Œ2023] Zhihong Shao, Yeyun Gong, Yelong Shen, Minlie Huang, Nan Duan, and Weizhu Chen. Enhancing retrieval-augmented large language models with iterative retrieval-generation synergy. arXiv preprint arXiv:2305.15294, 2023.&lt;/p&gt;
&lt;p&gt;[Shiç­‰äººï¼Œ2023] Weijia Shi, Sewon Min, Michihiro Yasunaga, Minjoon Seo, Rich James, Mike Lewis, Luke Zettlemoyer, and Wen-tau Yih. Replug: Retrieval-augmented black-box language models. arXiv preprint arXiv:2301.12652, 2023.&lt;/p&gt;
&lt;p&gt;[Srivastavaç­‰äººï¼Œ2022] Aarohi Srivastava, Abhinav Rastogi, Abhishek Rao, Abu Awal Md Shoeb, Abubakar Abid, Adam Fisch, Adam R Brown, Adam Santoro, Aditya Gupta, Adri`a Garriga-Alonso, et al. Beyond the imitation game: Quantifying and extrapolating the capabilities of language models. arXiv preprint arXiv:2206.04615, 2022.&lt;/p&gt;
&lt;p&gt;[Sunç­‰äººï¼Œ2022] Zhiqing Sun, Xuezhi Wang, Yi Tay, Yiming Yang, and Denny Zhou. Recitation-augmented language models. arXiv preprint arXiv:2210.01296, 2022.&lt;/p&gt;
&lt;p&gt;[Touvronç­‰äººï¼Œ2023] Hugo Touvron, Louis Martin, Kevin Stone, Peter Albert, Amjad Almahairi, Yasmine Babaei, Nikolay Bashlykov, Soumya Batra, Prajjwal Bhargava, Shruti Bhosale, et al. Llama 2: Open foundation and fine-tuned chat models. arXiv preprint arXiv:2307.09288, 2023.&lt;/p&gt;
&lt;p&gt;[Trivediç­‰äººï¼Œ2022] Harsh Trivedi, Niranjan Balasubramanian, Tushar Khot, and Ashish Sabharwal. Interleaving retrieval with chain-of-thought reasoning for knowledge-intensive multi-step questions. arXiv preprint arXiv:2212.10509, 2022.&lt;/p&gt;
&lt;p&gt;[Vaswaniç­‰äººï¼Œ2017] Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N Gomez, Åukasz Kaiser, and Illia Polosukhin. Attention is all you need. Advances in neural information processing systems, 30, 2017.&lt;/p&gt;
&lt;p&gt;[VoyageAI, 2023] VoyageAI. Voyageâ€™s embedding models. &lt;a href=&#34;https://docs.voyageai.com/embeddings/&#34;&gt;https://docs.voyageai.com/embeddings/&lt;/a&gt;, 2023.&lt;/p&gt;
&lt;p&gt;[Wangç­‰äººï¼Œ2019] Alex Wang, Yada Pruksachatkun, Nikita Nangia, Amanpreet Singh, Julian Michael, Felix Hill, Omer Levy, and Samuel Bowman. SuperGLUE: A stickier benchmark for general-purpose language understanding systems. Advances in neural information processing systems, 32, 2019.&lt;/p&gt;
&lt;p&gt;[Wangç­‰äººï¼Œ2022a] Shuohang Wang, Yichong Xu, Yuwei Fang, Yang Liu, Siqi Sun, Ruochen Xu, Chenguang Zhu, and Michael Zeng. Training data is more valuable than you think: A simple and effective method by retrieving from training data. arXiv preprint arXiv:2203.08773, 2022.&lt;/p&gt;
&lt;p&gt;[Wangç­‰äººï¼Œ2022b] Shuohang Wang, Yichong Xu, Yuwei Fang, Yang Liu, Siqi Sun, Ruochen Xu, Chenguang Zhu, and Michael Zeng. Training data is more valuable than you think: A simple and effective method by retrieving from training data. In Smaranda Muresan, Preslav Nakov, and Aline Villavicencio, editors, Proceedings of the 60th Annual Meeting of the Association for Computational Linguistics (Volume 1: Long Papers), pages 3170â€“ 3179, Dublin, Ireland, May 2022. Association for Computational Linguistics.&lt;/p&gt;
&lt;p&gt;[Wangç­‰äººï¼Œ2023a] Boxin Wang, Wei Ping, Lawrence McAfee, Peng Xu, Bo Li, Mohammad Shoeybi, and Bryan Catanzaro. Instructretro: Instruction tuning post retrieval-augmented pretraining. arX-print arXiv:2310.07713, 2023.&lt;/p&gt;
&lt;p&gt;[Wangç­‰äººï¼Œ2023b] Boxin Wang, Wei Ping, Peng Xu, Lawrence McAfee, Zihan Liu, Mohammad Shoeybi, Yi Dong, Oleksii Kuchaiev, Bo Li, Chaowei Xiao, et al. Shall we pretrain autoregressive language models with retrieval? A comprehensive study. arXiv preprint arXiv:2304.06762, 2023.&lt;/p&gt;
&lt;p&gt;[Wangç­‰äººï¼Œ2023c] Liang Wang, Nan Yang, and Furu Wei. Query2doc: Query expansion with large language models. arXiv preprint arXiv:2303.07678, 2023.&lt;/p&gt;
&lt;p&gt;[Wangç­‰äººï¼Œ2023d] Xintao Wang, Qianwen Yang, Yongting Qiu, Jiaqing Liang, Qianyu He, Zhouhong Gu, Yanghua Xiao, and Wei Wang. Knowledgpt: Enhancing large language models with retrieval and storage access on knowledge bases. arXiv preprint arXiv:2308.11761, 2023.&lt;/p&gt;
&lt;p&gt;[Wangç­‰äººï¼Œ2023e] Yile Wang, Peng Li, Maosong Sun, and Yang Liu. Self-knowledge guided retrieval augmentation for large language models. arXiv preprint arXiv:2310.05002, 2023.&lt;/p&gt;
&lt;p&gt;[Xiaç­‰äººï¼Œ2019] Mengzhou Xia, Guoping Huang, Lemao Liu, and Shuming Shi. Graph based translation memory for neural machine translation. In Proceedings of the AAAI conference on artificial intelligence, volume 33, pages 7297â€“7304, 2019.&lt;/p&gt;
&lt;p&gt;[Xiaoç­‰äººï¼Œ2023] Guangxuan Xiao, Yuandong Tian, Beidi Chen, Song Han, and Mike Lewis. Efficient streaming language models with attention sinks. arXiv preprint arXiv:2309.17453, 2023.&lt;/p&gt;
&lt;p&gt;[Xuç­‰äººï¼Œ2023a] Fangyuan Xu, Weijia Shi, and Eunsol Choi. Recomp: Improving retrieval-augmented LMs with compression and selective augmentation. arXiv preprint arXiv:2310.04408, 2023.&lt;/p&gt;
&lt;p&gt;[Xuç­‰äººï¼Œ2023b] Peng Xu, Wei Ping, Xianchao Wu, Lawrence McAfee, Chen Zhu, Zihan Liu, Sandeep Subramanian, Evelina Bakhturina, Mohammad Shoeybi, and Bryan Catanzaro. Retrieval meets long context large language models. arXiv preprint arXiv:2310.03025, 2023.&lt;/p&gt;
&lt;p&gt;[Xuç­‰äººï¼Œ2023c] Peng Xu, Wei Ping, Xianchao Wu, Lawrence McAfee, Chen Zhu, Zihan Liu, Sandeep Subramanian, Evelina Bakhturina, Mohammad Shoeybi, and Bryan Catanzaro. Retrieval meets long context large language models. arXiv preprint arXiv:2310.03025, 2023.&lt;/p&gt;
&lt;p&gt;[Yangç­‰äººï¼Œ2023a] Antoine Yang, Arsha Nagrani, Paul Hongsuck Seo, Antoine Miech, Jordi Pont-Tuset, Ivan Laptev, Josef Sivic, and Cordelia Schmid. Vid2seq: Large-scale pretraining of a visual language model for dense video captioning. In Proceedings of the IEEE/CVF Conference on Computer Vision and Pattern Recognition, pages 10714â€“10726, 2023.&lt;/p&gt;
&lt;p&gt;[Yangç­‰äººï¼Œ2023b] Haoyan Yang, Zhitao Li, Yong Zhang, Jianzong Wang, Ning Cheng, Ming Li, and Jing Xiao. PRCA: Fitting black-box large language models for retrieval question answering via pluggable reward-driven contextual adapter. arXiv preprint arXiv:2310.18347, 2023.&lt;/p&gt;
&lt;p&gt;[Yangç­‰äººï¼Œ2023c] Hui Yang, Sifu Yue, and Yunzhong He. Auto-gpt for online decision making: Benchmarks and additional opinions. arXiv preprint arXiv:2306.02224, 2023.&lt;/p&gt;
&lt;p&gt;[Yasunagaç­‰äººï¼Œ2022] Michihiro Yasunaga, Armen Aghajanyan, Weijia Shi, Rich James, Jure Leskovec, Percy Liang, Mike Lewis, Luke Zettlemoyer, and Wen-tau Yih. Retrieval-augmented multimodal language modeling. arXiv preprint arXiv:2211.12561, 2022.&lt;/p&gt;
&lt;p&gt;[Yeç­‰äººï¼Œ2020] Deming Ye, Yankai Lin, Jiaju Du, Zhenghao Liu, Peng Li, Maosong Sun, and Zhiyuan Liu. Coreferential reasoning learning for language representation. arXiv preprint arXiv:2004.06870, 2020.&lt;/p&gt;
&lt;p&gt;[Yoranç­‰äººï¼Œ2023] Ori Yoran, Tomer Wolfson, Ori Ram, and Jonathan Berant. Making retrieval-augmented language models robust to irrelevant context. arXiv preprint arXiv:2310.01558, 2023.&lt;/p&gt;
&lt;p&gt;[Yuç­‰äººï¼Œ2022] Wenhao Yu, Dan Iter, Shuohang Wang, Yichong Xu, Mingxuan Ju, Soumya Sanyal, Chenguang Zhu, Michael Zeng, and Meng Jiang. Generate rather than retrieve: Large language models are strong context generators. arXiv preprint arXiv:2209.10063, 2022.&lt;/p&gt;
&lt;p&gt;[Yuç­‰äººï¼Œ2023a] Wenhao Yu, Hongming Zhang, Xiaoman Pan, Kaixin Ma, Hongwei Wang, and Dong Yu. Chainof-note: Enhancing robustness in retrieval-augmented language models. arXiv preprint arXiv:2311.09210, 2023.&lt;/p&gt;
&lt;p&gt;[Yuç­‰äººï¼Œ2023b] Zichun Yu, Chenyan Xiong, Shi Yu, and Zhiyuan Liu. Augmentation-adapted retriever improves generalization of language models as generic plug-in. arXiv preprint arXiv:2305.17331, 2023.&lt;/p&gt;
&lt;p&gt;[Zhangç­‰äººï¼Œ2019] Zhengyan Zhang, Xu Han, Zhiyuan Liu, Xin Jiang, Maosong Sun, and Qun Liu. ERNIE: Enhanced language representation with informative entities. arXiv preprint arXiv:1905.07129, 2019.&lt;/p&gt;
&lt;p&gt;[Zhangç­‰äººï¼Œ2023a] Peitian Zhang, Shitao Xiao, Zheng Liu, Zhicheng Dou, and Jian-Yun Nie. Retrieve anything to augment large language models. arXiv preprint arXiv:2310.07554, 2023.&lt;/p&gt;
&lt;p&gt;[Zhangç­‰äººï¼Œ2023b] Yue Zhang, Yafu Li, Leyang Cui, Deng Cai, Lemao Liu, Tingchen Fu, Xinting Huang, Enbo Zhao, Yu Zhang, Yulong Chen, et al. Sirenâ€™s song in the AI ocean: A survey on hallucination in large language models. arXiv preprint arXiv:2309.01219, 2023.&lt;/p&gt;
&lt;p&gt;[Zhang, 2023] Jiawei Zhang. Graph-toolformer: To empower LLMs with graph reasoning ability via prompt augmented by ChatGPT. arXiv preprint arXiv:2304.11116, 2023.&lt;/p&gt;
&lt;p&gt;[Zhaoç­‰äººï¼Œ2022] Jinming Zhao, Gholamreza Haffar, and Ehsan Shareghi. Generating synthetic speech from spoken-vocab for speech translation. arXiv preprint arXiv:2210.08174, 2022.&lt;/p&gt;
&lt;p&gt;[Zhengç­‰äººï¼Œ2023] Huaixiu Steven Zheng, Swaroop Mishra, Xinyun Chen, Heng-Tze Cheng, Ed H Chi, Quoc V Le, and Denny Zhou. Take a step back: Evoking reasoning via abstraction in large language models. arXiv preprint arXiv:2310.06117, 2023.&lt;/p&gt;
&lt;p&gt;[Zhuç­‰äººï¼Œ2022] Wanrong Zhu, An Yan, Yujie Lu, Wenda Xu, Xin Eric Wang, Miguel Eckstein, and William Yang Wang. Visualize before you write: Imagination-guided open-ended text generation. arXiv preprint arXiv:2210.03765, 2022.&lt;/p&gt;
&lt;p&gt;[Zhuangç­‰äººï¼Œ2023] Shengyao Zhuang, Bing Liu, Bevan Koopman, and Guido Zuccon. Open-source large language models are strong zero-shot query likelihood models for document ranking. arXiv preprint arXiv:2310.13243, 2023.&lt;/p&gt;
&lt;section class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/Tongji-KGLLM/RAG-Survey&#34;&gt;https://github.com/Tongji-KGLLM/RAG-Survey&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://huggingface.co/BAAI/bge-large-en&#34;&gt;https://huggingface.co/BAAI/bge-large-en&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://platform.openai.com/docs/guides/embeddings&#34;&gt;https://platform.openai.com/docs/guides/embeddings&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:4&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://www.llamaindex.ai&#34;&gt;https://www.llamaindex.ai&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:5&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://www.langchain.com/&#34;&gt;https://www.langchain.com/&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:5&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:6&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://haystack.deepset.ai/blog/enhancing-rag-pipelines-in-haystack&#34;&gt;https://haystack.deepset.ai/blog/enhancing-rag-pipelines-in-haystack&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:6&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:7&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://huggingface.co/BAAI/bge-reranker-large&#34;&gt;https://huggingface.co/BAAI/bge-reranker-large&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:7&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:8&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://www.trulens.org/trulens_eval/core_concepts_rag_triad/&#34;&gt;https://www.trulens.org/trulens_eval/core_concepts_rag_triad/&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:8&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:9&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/inverse-scaling/prize&#34;&gt;https://github.com/inverse-scaling/prize&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:9&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:10&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://flowiseai.com&#34;&gt;https://flowiseai.com&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:10&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:11&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://meltano.com&#34;&gt;https://meltano.com&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:11&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:12&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://cohere.com/coral&#34;&gt;https://cohere.com/coral&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:12&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:13&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/weaviate/Verba&#34;&gt;https://github.com/weaviate/Verba&lt;/a&gt;&amp;#160;&lt;a href=&#34;#fnref:13&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;</description>
      
    </item>
    
    <item>
      <title>è¯‘ï¼šå†…å­˜åˆ†æ</title>
      <link>https://weedge.github.io/post/cpu/memory_profiling/</link>
      <pubDate>Sun, 03 Mar 2024 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/cpu/memory_profiling/</guid>
      
        <description>&lt;h3 id=&#34;å†…å­˜åˆ†æç®€ä»‹&#34;&gt;å†…å­˜åˆ†æç®€ä»‹&lt;/h3&gt;
&lt;p&gt;åœ¨è¿™ä¸ªç³»åˆ—çš„&lt;a href=&#34;https://easyperf.net/blog/2024/02/12/Memory-Profiling-Part1&#34;&gt;åŸæ–‡åšå®¢æ–‡ç« &lt;/a&gt;ä¸­ï¼Œä½ å°†å­¦ä¹ å¦‚ä½•æ”¶é›†æœ‰å…³ç¨‹åºä¸å†…å­˜äº¤äº’çš„é«˜å±‚æ¬¡ä¿¡æ¯ã€‚è¿™ä¸ªè¿‡ç¨‹é€šå¸¸è¢«ç§°ä¸º&lt;em&gt;å†…å­˜åˆ†æ&lt;/em&gt;ã€‚å†…å­˜åˆ†æå¸®åŠ©ä½ ç†è§£åº”ç”¨ç¨‹åºéšæ—¶é—´å˜åŒ–çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¹¶å¸®åŠ©ä½ æ„å»ºç¨‹åºè¡Œä¸ºçš„æ­£ç¡®å¿ƒç†æ¨¡å‹ã€‚ä»¥ä¸‹æ˜¯å®ƒå¯ä»¥å›ç­”çš„ä¸€äº›é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¨‹åºçš„æ€»å†…å­˜æ¶ˆè€—æ˜¯å¤šå°‘ï¼Œä»¥åŠå®ƒéšæ—¶é—´å¦‚ä½•å˜åŒ–ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ç¨‹åºä½•æ—¶ä½•åœ°è¿›è¡Œå †åˆ†é…ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å“ªäº›ä»£ç ä½ç½®åˆ†é…äº†æœ€å¤§é‡çš„å†…å­˜ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ç¨‹åºæ¯ç§’è®¿é—®å¤šå°‘å†…å­˜ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“å¼€å‘è€…è°ˆè®ºå†…å­˜æ¶ˆè€—æ—¶ï¼Œä»–ä»¬é€šå¸¸æŒ‡çš„æ˜¯å †ä½¿ç”¨æƒ…å†µã€‚å®é™…ä¸Šï¼Œå †æ˜¯å¤§å¤šæ•°åº”ç”¨ç¨‹åºä¸­æœ€å¤§çš„å†…å­˜æ¶ˆè´¹è€…ï¼Œå› ä¸ºå®ƒå®¹çº³äº†æ‰€æœ‰åŠ¨æ€åˆ†é…çš„å¯¹è±¡ã€‚ä½†å †å¹¶ä¸æ˜¯å”¯ä¸€çš„å†…å­˜æ¶ˆè´¹è€…ã€‚ä¸ºäº†å®Œæ•´æ€§ï¼Œè®©æˆ‘ä»¬æåŠå…¶ä»–å†…å­˜æ¶ˆè´¹è€…ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ ˆï¼šåº”ç”¨ç¨‹åºä¸­å¸§æ ˆä½¿ç”¨çš„å†…å­˜ã€‚åº”ç”¨ç¨‹åºä¸­çš„æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æ ˆå†…å­˜ç©ºé—´ã€‚é€šå¸¸ï¼Œæ ˆçš„å¤§å°åªæœ‰å‡ MBï¼Œå¦‚æœè¶…å‡ºé™åˆ¶ï¼Œåº”ç”¨ç¨‹åºå°†å´©æºƒã€‚æ€»çš„æ ˆå†…å­˜æ¶ˆè€—ä¸ç³»ç»Ÿä¸­è¿è¡Œçš„çº¿ç¨‹æ•°é‡æˆæ­£æ¯”ã€‚&lt;/li&gt;
&lt;li&gt;ä»£ç ï¼šç”¨äºå­˜å‚¨åº”ç”¨ç¨‹åºåŠå…¶åº“çš„ä»£ç ï¼ˆæŒ‡ä»¤ï¼‰çš„å†…å­˜ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒå¯¹å†…å­˜æ¶ˆè€—çš„è´¡çŒ®ä¸å¤§ï¼Œä½†ä¹Ÿæœ‰ä¾‹å¤–ã€‚ä¾‹å¦‚ï¼ŒClang C++ç¼–è¯‘å™¨å’ŒChromeæµè§ˆå™¨æ‹¥æœ‰åºå¤§çš„ä»£ç åº“ï¼Œå®ƒä»¬çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æœ‰æ•°åMBçš„ä»£ç æ®µã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä»‹ç»&lt;em&gt;å†…å­˜ä½¿ç”¨(memory usage)&lt;em&gt;å’Œ&lt;/em&gt;å†…å­˜è¶³è¿¹(memory footprint)&lt;em&gt;æˆ–è€…ç¿»è¯‘æˆ&lt;/em&gt;å†…å­˜å ç”¨&lt;/em&gt;è¿™ä¸¤ä¸ªæœ¯è¯­ï¼Œå¹¶çœ‹çœ‹å¦‚ä½•å¯¹å®ƒä»¬è¿›è¡Œåˆ†æã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨ï¼š&lt;/strong&gt; ä¸»è¦æ˜¯é€šè¿‡å·¥å…·åˆ†æå†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå°½é‡åˆ©ç”¨å±€éƒ¨æ€§åŸç†ï¼šæ—¶é—´å±€éƒ¨æ€§å’Œç©ºé—´å±€éƒ¨æ€§ï¼Œæé«˜æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h3 id=&#34;1-å†…å­˜ä½¿ç”¨å’Œè¶³è¿¹&#34;&gt;1. å†…å­˜ä½¿ç”¨å’Œè¶³è¿¹&lt;/h3&gt;
&lt;p&gt;å†…å­˜ä½¿ç”¨é€šå¸¸ç”±è™šæ‹Ÿå†…å­˜å¤§å°ï¼ˆVirtual Memory Size, VSZï¼‰å’Œå¸¸é©»é›†å¤§å°ï¼ˆResident Set Size, RSSï¼‰æ¥æè¿°ã€‚VSZåŒ…æ‹¬è¿›ç¨‹å¯ä»¥è®¿é—®çš„æ‰€æœ‰å†…å­˜ï¼Œä¾‹å¦‚æ ˆã€å †ã€ç”¨äºç¼–ç å¯æ‰§è¡Œæ–‡ä»¶æŒ‡ä»¤çš„å†…å­˜ï¼Œä»¥åŠæ¥è‡ªé“¾æ¥çš„å…±äº«åº“çš„æŒ‡ä»¤ï¼ŒåŒ…æ‹¬è¢«äº¤æ¢åˆ°ç£ç›˜çš„å†…å­˜ã€‚å¦ä¸€æ–¹é¢ï¼ŒRSSè¡¡é‡åˆ†é…ç»™è¿›ç¨‹å¹¶å®é™…é©»ç•™åœ¨RAMä¸­çš„å†…å­˜é‡ã€‚å› æ­¤ï¼ŒRSSä¸åŒ…æ‹¬è¢«äº¤æ¢å‡ºå»çš„å†…å­˜æˆ–è¿›ç¨‹ä»æœªè§¦åŠè¿‡çš„å†…å­˜ã€‚æ­¤å¤–ï¼ŒRSSä¸åŒ…æ‹¬æœªåŠ è½½åˆ°å†…å­˜ä¸­çš„å…±äº«åº“çš„å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;è€ƒè™‘ä¸€ä¸ªä¾‹å­ã€‚è¿›ç¨‹&lt;code&gt;A&lt;/code&gt;æœ‰200Kçš„æ ˆå’Œå †åˆ†é…ï¼Œå…¶ä¸­100Ké©»ç•™åœ¨ä¸»å†…å­˜ä¸­ï¼Œå…¶ä½™çš„è¢«äº¤æ¢å‡ºå»æˆ–æœªè¢«ä½¿ç”¨ã€‚å®ƒæœ‰ä¸€ä¸ª500Kçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå…¶ä¸­åªæœ‰400Kè¢«è§¦åŠã€‚è¿›ç¨‹&lt;code&gt;A&lt;/code&gt;é“¾æ¥äº†2500Kçš„å…±äº«åº“ï¼Œå¹¶ä¸”åªæœ‰1000KåŠ è½½åˆ°äº†ä¸»å†…å­˜ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;VSZ: 200K + 500K + 2500K = 3200K
RSS: 100K + 400K + 1000K = 1500K
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å›¾1å±•ç¤ºäº†ä¸€ä¸ªå‡è®¾ç¨‹åºçš„å†…å­˜ä½¿ç”¨å’Œè¶³è¿¹çš„å¯è§†åŒ–ç¤ºä¾‹ã€‚è¿™é‡Œçš„æ„å›¾ä¸æ˜¯æ£€æŸ¥ç‰¹å®šç¨‹åºçš„ç»Ÿè®¡æ•°æ®ï¼Œè€Œæ˜¯ä¸ºåˆ†æå†…å­˜åˆ†æå»ºç«‹æ¡†æ¶ã€‚åœ¨åé¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ£€æŸ¥ä¸€äº›å…è®¸æˆ‘ä»¬æ”¶é›†æ­¤ç±»ä¿¡æ¯çš„å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆçœ‹çœ‹å†…å­˜ä½¿ç”¨ï¼ˆä¸Šé¢çš„ä¸¤è¡Œï¼‰ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€é¢„æœŸçš„ï¼ŒRSSæ€»æ˜¯å°äºæˆ–ç­‰äºVSZã€‚ä»å›¾è¡¨ä¸­çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ç¨‹åºçš„å››ä¸ªé˜¶æ®µã€‚é˜¶æ®µ1æ˜¯ç¨‹åºçš„å¯åŠ¨é˜¶æ®µï¼Œåœ¨è¿™ä¸ªé˜¶æ®µå®ƒåˆ†é…å†…å­˜ã€‚é˜¶æ®µ2æ˜¯ç®—æ³•å¼€å§‹ä½¿ç”¨è¿™äº›å†…å­˜ï¼Œæ³¨æ„å†…å­˜ä½¿ç”¨ä¿æŒæ’å®šã€‚åœ¨é˜¶æ®µ3ï¼Œç¨‹åºé‡Šæ”¾äº†éƒ¨åˆ†å†…å­˜ï¼Œç„¶ååˆ†é…äº†ç•¥é«˜é‡çš„å†…å­˜ã€‚é˜¶æ®µ4æ¯”é˜¶æ®µ2æ›´åŠ æ··ä¹±ï¼Œæœ‰è®¸å¤šå¯¹è±¡è¢«åˆ†é…å’Œé‡Šæ”¾ã€‚æ³¨æ„ï¼ŒVSZçš„å³°å€¼å¹¶ä¸ä¸€å®šä¼´éšç€RSSçš„ç›¸åº”å³°å€¼ã€‚è¿™å¯èƒ½å‘ç”Ÿåœ¨å†…å­˜è¢«å¯¹è±¡é¢„ç•™ä½†ä»æœªä½¿ç”¨çš„æƒ…å†µä¸‹ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://easyperf.net/img/posts/MemoryProfiling/MemoryUsageAndFootprint.png&#34;&gt;&lt;img src=&#34;https://easyperf.net/img/posts/MemoryProfiling/MemoryUsageAndFootprint.png&#34; alt=&#34;img&#34;&gt;&lt;/a&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾1. å†…å­˜ä½¿ç”¨å’Œè¶³è¿¹çš„ç¤ºä¾‹ï¼ˆå‡è®¾åœºæ™¯ï¼‰&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ç°åœ¨è®©æˆ‘ä»¬è½¬å‘*å†…å­˜è¶³è¿¹ã€‚å®ƒå®šä¹‰äº†åœ¨ä¸€æ®µæ—¶é—´å†…è¿›ç¨‹å ç”¨äº†å¤šå°‘å†…å­˜ï¼Œä¾‹å¦‚æ¯ç§’çš„MBæ•°ã€‚åœ¨æˆ‘ä»¬çš„å‡è®¾æƒ…æ™¯ä¸­ï¼Œå¦‚å›¾1æ‰€ç¤ºï¼Œæˆ‘ä»¬ç»˜åˆ¶æ¯100æ¯«ç§’ï¼ˆæ¯ç§’10æ¬¡ï¼‰çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚å®çº¿è·Ÿè¸ªæ¯ä¸ª100æ¯«ç§’é—´éš”æœŸé—´è®¿é—®çš„å­—èŠ‚æ•°ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸è®¡ç®—æŸä¸ªå†…å­˜ä½ç½®è¢«è®¿é—®çš„æ¬¡æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨100æ¯«ç§’é—´éš”æœŸé—´åŠ è½½äº†æŸä¸ªå†…å­˜ä½ç½®ä¸¤æ¬¡ï¼Œæˆ‘ä»¬åªè®¡ç®—å ç”¨åˆ°çš„å†…å­˜ä¸€æ¬¡ã€‚å‡ºäºåŒæ ·çš„åŸå› ï¼Œæˆ‘ä»¬ä¸èƒ½åˆå¹¶æ—¶é—´é—´éš”ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨ç¬¬2é˜¶æ®µï¼Œç¨‹åºæ¯100æ¯«ç§’å¤§çº¦å ç”¨äº†10MBã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¸èƒ½å°†è¿ç»­çš„10ä¸ª100æ¯«ç§’é—´éš”ç›¸åŠ ï¼Œå¹¶è¯´å†…å­˜å ç”¨é‡ä¸ºæ¯ç§’100MBï¼Œå› ä¸ºåŒä¸€å†…å­˜ä½ç½®å¯èƒ½åœ¨ç›¸é‚»çš„100æ¯«ç§’æ—¶é—´é—´éš”å†…åŠ è½½ã€‚åªæœ‰åœ¨ç¨‹åºåœ¨æ¯ä¸ª1ç§’é—´éš”å†…ä¸é‡å¤å†…å­˜è®¿é—®æ—¶æ‰ä¼šæˆç«‹ã€‚&lt;/p&gt;
&lt;p&gt;è™šçº¿è·Ÿè¸ªè‡ªç¨‹åºå¼€å§‹ä»¥æ¥è®¿é—®çš„æ–°æ•°æ®å¤§å°ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬è®¡ç®—åœ¨æ¯ä¸ª100æ¯«ç§’é—´éš”æœŸé—´ä»æœªè¢«ç¨‹åºå ç”¨è¿‡çš„å­—èŠ‚æ•°ã€‚åœ¨ç¨‹åºç”Ÿå‘½å‘¨æœŸçš„å‰ä¸€ç§’ï¼Œå¤§å¤šæ•°è®¿é—®éƒ½æ˜¯æ–°çš„ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€é¢„æœŸçš„ã€‚åœ¨ç¬¬äºŒé˜¶æ®µï¼Œç®—æ³•å¼€å§‹ä½¿ç”¨åˆ†é…çš„ç¼“å†²åŒºã€‚åœ¨1.3ç§’åˆ°1.8ç§’çš„æ—¶é—´é—´éš”å†…ï¼Œç¨‹åºè®¿é—®äº†ç¼“å†²åŒºä¸­çš„å¤§å¤šæ•°ä½ç½®ï¼Œä¾‹å¦‚ï¼Œè¿™æ˜¯ç®—æ³•ä¸­å¾ªç¯çš„ç¬¬ä¸€æ¬¡è¿­ä»£ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä»1.3ç§’åˆ°1.8ç§’çœ‹åˆ°æ–°çœ‹åˆ°çš„å†…å­˜ä½ç½®æœ‰ä¸€ä¸ªå¤§å³°å€¼ï¼Œä½†åœ¨é‚£ä¹‹åæˆ‘ä»¬çœ‹ä¸åˆ°å¾ˆå¤šæ–°çš„è®¿é—®ã€‚ä»2ç§’çš„æ—¶é—´æˆ³åˆ°5ç§’ï¼Œç®—æ³•ä¸»è¦åˆ©ç”¨å·²ç»çœ‹åˆ°çš„å†…å­˜ç¼“å†²åŒºï¼Œå¹¶æ²¡æœ‰è®¿é—®ä»»ä½•æ–°æ•°æ®ã€‚ç„¶è€Œï¼Œé˜¶æ®µ4çš„è¡Œä¸ºä¸é˜¶æ®µ2ä¸åŒã€‚é¦–å…ˆï¼Œåœ¨é˜¶æ®µ4ï¼Œç®—æ³•æ¯”é˜¶æ®µ2æ›´æ¶ˆè€—å†…å­˜ï¼Œå› ä¸ºæ€»å†…å­˜è¶³è¿¹ï¼ˆå®çº¿ï¼‰å¤§çº¦æ˜¯æ¯100æ¯«ç§’15MBã€‚å…¶æ¬¡ï¼Œç®—æ³•ä»¥ç›¸å¯¹è¾ƒå¤§çš„çˆ†å‘è®¿é—®æ–°æ•°æ®ï¼ˆè™šçº¿ï¼‰ã€‚è¿™æ ·çš„çˆ†å‘å¯èƒ½ä¸åˆ†é…æ–°å†…å­˜åŒºåŸŸã€åœ¨å…¶ä¸Šå·¥ä½œï¼Œç„¶åé‡Šæ”¾å®ƒä»¬æœ‰å…³ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„ä¸¤ä¸ªæ¡ˆä¾‹ç ”ç©¶ä¸­å±•ç¤ºå¦‚ä½•è·å¾—è¿™æ ·çš„å›¾è¡¨ï¼Œä½†ç°åœ¨ï¼Œä½ å¯èƒ½ä¼šæƒ³çŸ¥é“è¿™äº›æ•°æ®å¦‚ä½•ä½¿ç”¨ã€‚å—¯ï¼Œé¦–å…ˆï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ¯ä¸ªé—´éš”æœŸé—´è®¿é—®çš„æ–°å­—èŠ‚ï¼ˆç‚¹çº¿ï¼‰æ€»å’Œï¼Œæˆ‘ä»¬å°†å¾—åˆ°ç¨‹åºçš„æ€»å†…å­˜è¶³è¿¹ã€‚æ­¤å¤–ï¼Œé€šè¿‡æŸ¥çœ‹å›¾è¡¨ï¼Œä½ å¯ä»¥è§‚å¯Ÿé˜¶æ®µå¹¶å°†å…¶ä¸æ­£åœ¨è¿è¡Œçš„ä»£ç ç›¸å…³è”ã€‚é—®é—®è‡ªå·±ï¼šâ€œå®ƒæ˜¯å¦ç¬¦åˆä½ çš„é¢„æœŸï¼Œæˆ–è€…å·¥ä½œè´Ÿè½½æ­£åœ¨åšä¸€äº›ç‹¡çŒ¾çš„äº‹æƒ…ï¼Ÿâ€ä½ å¯èƒ½ä¼šåœ¨å†…å­˜è¶³è¿¹ä¸­é‡åˆ°æ„å¤–çš„å³°å€¼ã€‚æˆ‘ä»¬å°†åœ¨è¿™ç³»åˆ—æ–‡ç« ä¸­è®¨è®ºçš„å†…å­˜åˆ†ææŠ€æœ¯å¹¶ä¸ä¸€å®šåƒå¸¸è§„çƒ­ç‚¹åˆ†æé‚£æ ·æŒ‡å‘é—®é¢˜æ‰€åœ¨ï¼Œä½†å®ƒä»¬ç¡®å®å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å·¥ä½œè´Ÿè½½çš„è¡Œä¸ºã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œå†…å­˜åˆ†æå¸®åŠ©è¯†åˆ«é—®é¢˜æˆ–ä½œä¸ºåœ¨å¸¸è§„åˆ†ææœŸé—´å¾—å‡ºçš„ç»“è®ºçš„é¢å¤–æ•°æ®ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå†…å­˜è¶³è¿¹å¸®åŠ©æˆ‘ä»¬ä¼°è®¡å¯¹å†…å­˜å­ç³»ç»Ÿçš„å‹åŠ›ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå†…å­˜è¶³è¿¹å¾ˆå°ï¼Œæ¯”å¦‚æ¯ç§’1MBï¼Œå¹¶ä¸”RSSé€‚åˆL3ç¼“å­˜çš„å¤§å°ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ€€ç–‘å†…å­˜å­ç³»ç»Ÿçš„å‹åŠ›å¾ˆä½ï¼›è®°ä½ï¼Œç°ä»£å¤„ç†å™¨çš„å¯ç”¨å†…å­˜å¸¦å®½æ˜¯ä»¥GB/sè®¡ç®—çš„ï¼Œå¹¶ä¸”æ¥è¿‘1TB/sã€‚å¦ä¸€æ–¹é¢ï¼Œå½“å†…å­˜è¶³è¿¹ç›¸å½“å¤§ï¼Œä¾‹å¦‚æ¯ç§’10GBï¼Œå¹¶ä¸”RSSè¿œå¤§äºL3ç¼“å­˜çš„å¤§å°æ—¶ï¼Œé‚£ä¹ˆå·¥ä½œè´Ÿè½½å¯èƒ½ä¼šå¯¹å†…å­˜å­ç³»ç»Ÿé€ æˆæ˜¾è‘—å‹åŠ›ã€‚&lt;/p&gt;
&lt;h3 id=&#34;2-æ¡ˆä¾‹ç ”ç©¶stockfishçš„å†…å­˜ä½¿ç”¨&#34;&gt;2. æ¡ˆä¾‹ç ”ç©¶ï¼šStockfishçš„å†…å­˜ä½¿ç”¨&lt;/h3&gt;
&lt;p&gt;ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åˆ†æä¸€ä¸ªçœŸå®ä¸–ç•Œåº”ç”¨ç¨‹åºçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚æˆ‘ä»¬å°†ä½¿ç”¨ç”±KDEå¼€å‘çš„Linuxå †å†…å­˜åˆ†æå™¨&lt;a href=&#34;https://github.com/KDE/heaptrack&#34;&gt;heaptrack&lt;/a&gt;ã€‚Ubuntuç”¨æˆ·å¯ä»¥é€šè¿‡&lt;code&gt;apt install heaptrack heaptrack-gui&lt;/code&gt;éå¸¸å®¹æ˜“åœ°å®‰è£…å®ƒã€‚Heaptrackå¯ä»¥æ‰¾åˆ°ä»£ç ä¸­å‘ç”Ÿæœ€å¤§å’Œæœ€é¢‘ç¹åˆ†é…çš„ä½ç½®ï¼Œä»¥åŠå…¶ä»–è®¸å¤šäº‹æƒ…ã€‚åœ¨Windowsä¸Šï¼Œä½ å¯ä»¥ä½¿ç”¨&lt;a href=&#34;https://github.com/milostosic/MTuner&#34;&gt;Mtuner&lt;/a&gt;ï¼Œå®ƒå…·æœ‰ä¸Heaptrackç›¸ä¼¼çš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†Stockfishå†…ç½®çš„åŸºå‡†æµ‹è¯•ã€‚æˆ‘ä»¬ä½¿ç”¨Clang 15ç¼–è¯‘å™¨å’Œ&lt;code&gt;-O3 -mavx2&lt;/code&gt;é€‰é¡¹ç¼–è¯‘äº†å®ƒã€‚æˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ”¶é›†äº†åœ¨Intel Alderlake i7-1260På¤„ç†å™¨ä¸Šè¿è¡Œçš„å•çº¿ç¨‹Stockfishå†…ç½®åŸºå‡†æµ‹è¯•çš„Heaptrackå†…å­˜åˆ†æï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;$ heaptrack ./stockfish bench 128 1 24 default depth
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å›¾2å‘æˆ‘ä»¬å±•ç¤ºäº†Stockfishå†…å­˜åˆ†æçš„æ€»ç»“è§†å›¾ã€‚æˆ‘ä»¬å¯ä»¥ä»ä¸­å­¦åˆ°ä¸€äº›æœ‰è¶£çš„äº‹å®ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ€»åˆ†é…æ¬¡æ•°ä¸º10614æ¬¡ã€‚&lt;/li&gt;
&lt;li&gt;å‡ ä¹ä¸€åŠçš„åˆ†é…æ˜¯ä¸´æ—¶çš„ï¼Œå³ç›´æ¥è·Ÿéšå…¶é‡Šæ”¾çš„åˆ†é…ã€‚&lt;/li&gt;
&lt;li&gt;å³°å€¼å †å†…å­˜æ¶ˆè€—ä¸º204MBã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Stockfish::std_aligned_alloc&lt;/code&gt;è´Ÿè´£åˆ†é…å †ç©ºé—´çš„æœ€å¤§éƒ¨åˆ†ï¼ˆ182MBï¼‰ã€‚ä½†å®ƒå¹¶ä¸åœ¨æœ€é¢‘ç¹åˆ†é…ä½ç½®çš„åˆ—è¡¨ä¸­ï¼ˆä¸­é—´è¡¨æ ¼ï¼‰ï¼Œæ‰€ä»¥å®ƒå¯èƒ½æ˜¯ä¸€æ¬¡æ€§åˆ†é…å¹¶åœ¨ç¨‹åºç»“æŸå‰ä¸€ç›´å­˜åœ¨ã€‚&lt;/li&gt;
&lt;li&gt;å‡ ä¹æ‰€æœ‰åˆ†é…è°ƒç”¨çš„ä¸€åŠæ¥è‡ª&lt;code&gt;operator new&lt;/code&gt;ï¼Œè¿™äº›éƒ½æ˜¯ä¸´æ—¶åˆ†é…ã€‚æˆ‘ä»¬èƒ½å¦æ¶ˆé™¤ä¸´æ—¶åˆ†é…ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å¯¹äºè¿™ä¸ªæ¡ˆä¾‹ç ”ç©¶ï¼Œæ³„æ¼å†…å­˜ä¸æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://easyperf.net/img/posts/MemoryProfiling/StockfishSummary.png&#34;&gt;&lt;img src=&#34;https://easyperf.net/img/posts/MemoryProfiling/StockfishSummary.png&#34; alt=&#34;img&#34;&gt;&lt;/a&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾2. ä½¿ç”¨Heaptrackçš„Stockfishå†…å­˜åˆ†æï¼Œæ€»ç»“è§†å›¾ã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æ³¨æ„ï¼Œå›¾åƒé¡¶éƒ¨æœ‰è®¸å¤šæ ‡ç­¾é¡µï¼›æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ¢ç´¢å…¶ä¸­çš„ä¸€äº›ã€‚å›¾3æ˜¾ç¤ºäº†Stockfishå†…ç½®åŸºå‡†æµ‹è¯•çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚åœ¨æ•´ä¸ªç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå†…å­˜ä½¿ç”¨é‡ä¿æŒåœ¨200MBä¸å˜ã€‚æ€»æ¶ˆè€—çš„å†…å­˜è¢«åˆ†æˆå‡ ä¸ªéƒ¨åˆ†ï¼Œä¾‹å¦‚å›¾åƒä¸Šçš„åŒºåŸŸ1å’Œ2ã€‚æ¯ä¸ªéƒ¨åˆ†å¯¹åº”ä¸€ä¸ªç‰¹å®šçš„åˆ†é…ã€‚æœ‰è¶£çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬ä¹‹å‰è®¤ä¸ºçš„é€šè¿‡&lt;code&gt;Stockfish::std_aligned_alloc&lt;/code&gt;è¿›è¡Œçš„å•ä¸ªå¤§çš„182MBåˆ†é…ã€‚ç›¸åï¼Œæœ‰ä¸¤ä¸ªï¼šåŒºåŸŸ1çš„134.2MBå’ŒåŒºåŸŸ2çš„48.4MBã€‚å°½ç®¡è¿™ä¸¤ä¸ªåˆ†é…ä¸€ç›´æŒç»­åˆ°åŸºå‡†æµ‹è¯•çš„æœ€åã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://easyperf.net/img/posts/MemoryProfiling/Stockfish_consumed.png&#34;&gt;&lt;img src=&#34;https://easyperf.net/img/posts/MemoryProfiling/Stockfish_consumed.png&#34; alt=&#34;img&#34;&gt;&lt;/a&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾3. ä½¿ç”¨Heaptrackçš„Stockfishå†…å­˜åˆ†æï¼Œå†…å­˜ä½¿ç”¨éšæ—¶é—´ä¿æŒæ’å®šã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¿™æ˜¯å¦æ„å‘³ç€åœ¨å¯åŠ¨é˜¶æ®µä¹‹åæ²¡æœ‰å†…å­˜åˆ†é…ï¼Ÿè®©æˆ‘ä»¬æ‰¾å‡ºç­”æ¡ˆã€‚å›¾4æ˜¾ç¤ºäº†éšæ—¶é—´ç´¯ç§¯çš„åˆ†é…æ•°é‡ã€‚ä¸æ¶ˆè€—å†…å­˜å›¾è¡¨ï¼ˆå›¾3ï¼‰ç±»ä¼¼ï¼Œåˆ†é…æ˜¯æ ¹æ®å½’å› äºæ¯ä¸ªå‡½æ•°çš„ç´¯ç§¯å†…å­˜åˆ†é…æ•°é‡è¿›è¡Œåˆ‡ç‰‡çš„ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ–°çš„åˆ†é…ä¸ä»…æ¥è‡ªä¸€ä¸ªåœ°æ–¹ï¼Œè€Œæ˜¯æ¥è‡ªè®¸å¤šåœ°æ–¹ã€‚æœ€é¢‘ç¹çš„åˆ†é…æ˜¯é€šè¿‡&lt;code&gt;operator new&lt;/code&gt;å®Œæˆçš„ï¼Œå¯¹åº”äºå›¾åƒä¸Šçš„åŒºåŸŸ1ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼Œç¨‹åºçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæ–°åˆ†é…ä»¥ç¨³å®šçš„é€Ÿåº¦è¿›è¡Œã€‚ç„¶è€Œï¼Œæ­£å¦‚æˆ‘ä»¬åˆšåˆšçœ‹åˆ°çš„ï¼Œå†…å­˜æ¶ˆè€—æ²¡æœ‰å˜åŒ–ï¼›è¿™æ€ä¹ˆå¯èƒ½å‘¢ï¼Ÿå—¯ï¼Œå¦‚æœæˆ‘ä»¬é‡Šæ”¾ä¹‹å‰åˆ†é…çš„ç¼“å†²åŒºå¹¶åˆ†é…ç›¸åŒå¤§å°çš„æ–°ç¼“å†²åŒºï¼ˆä¹Ÿç§°ä¸º&lt;em&gt;ä¸´æ—¶åˆ†é…&lt;/em&gt;ï¼‰ï¼Œè¿™æ˜¯å¯èƒ½çš„ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://easyperf.net/img/posts/MemoryProfiling/Stockfish_allocations.png&#34;&gt;&lt;img src=&#34;https://easyperf.net/img/posts/MemoryProfiling/Stockfish_allocations.png&#34; alt=&#34;img&#34;&gt;&lt;/a&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾4. ä½¿ç”¨Heaptrackçš„Stockfishå†…å­˜åˆ†æï¼Œåˆ†é…æ•°é‡åœ¨å¢é•¿ã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ç”±äºåˆ†é…æ•°é‡åœ¨å¢é•¿ï¼Œä½†æ€»æ¶ˆè€—å†…å­˜æ²¡æœ‰å˜åŒ–ï¼Œæˆ‘ä»¬æ­£åœ¨å¤„ç†çš„æ˜¯ä¸´æ—¶åˆ†é…ã€‚è®©æˆ‘ä»¬æ‰¾å‡ºå®ƒä»¬åœ¨ä»£ç ä¸­çš„æ¥æºã€‚é€šè¿‡å›¾5ä¸­çš„ç«ç„°å›¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°åšåˆ°è¿™ä¸€ç‚¹ã€‚æ€»å…±æœ‰4800ä¸ªä¸´æ—¶åˆ†é…ï¼Œå…¶ä¸­90.8%æ¥è‡ª&lt;code&gt;operator new&lt;/code&gt;ã€‚å¾—ç›Šäºç«ç„°å›¾ï¼Œæˆ‘ä»¬çŸ¥é“å¯¼è‡´4360ä¸ªä¸´æ—¶åˆ†é…çš„æ•´ä¸ªè°ƒç”¨æ ˆã€‚æœ‰è¶£çš„æ˜¯ï¼Œè¿™äº›ä¸´æ—¶åˆ†é…æ˜¯ç”±&lt;code&gt;std::stable_sort&lt;/code&gt;å‘èµ·çš„ï¼Œå®ƒåˆ†é…äº†ä¸€ä¸ªä¸´æ—¶ç¼“å†²åŒºæ¥è¿›è¡Œæ’åºã€‚æ¶ˆé™¤è¿™äº›ä¸´æ—¶åˆ†é…çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨å°±åœ°(in-place)æ’åºç®—æ³•(ä¸éœ€è¦é¢å¤–çš„ç©ºé—´)ã€‚ç„¶è€Œï¼Œè¿™æ ·åšè§‚å¯Ÿåˆ°æ€§èƒ½ä¸‹é™äº†8%ï¼Œæ‰€ä»¥æˆ‘ä»¬æ”¾å¼ƒäº†è¿™ä¸ªæ”¹å˜ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://easyperf.net/img/posts/MemoryProfiling/Stockfish_flamegraph.png&#34;&gt;&lt;img src=&#34;https://easyperf.net/img/posts/MemoryProfiling/Stockfish_flamegraph.png&#34; alt=&#34;img&#34;&gt;&lt;/a&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾5. ä½¿ç”¨Heaptrackçš„Stockfishå†…å­˜åˆ†æï¼Œä¸´æ—¶åˆ†é…ç«ç„°å›¾ã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸ä¸´æ—¶åˆ†é…ç±»ä¼¼ï¼Œä½ ä¹Ÿå¯ä»¥æ‰¾åˆ°å¯¼è‡´ç¨‹åºä¸­æœ€å¤§åˆ†é…çš„è·¯å¾„ã€‚åœ¨é¡¶éƒ¨çš„ä¸‹æ‹‰èœå•ä¸­ï¼Œä½ éœ€è¦é€‰æ‹©â€œæ¶ˆè€—(Consumed)â€ç«ç„°å›¾ã€‚æˆ‘ä»¬é¼“åŠ±è¯»è€…æ¢ç´¢å…¶ä»–æ ‡ç­¾é¡µã€‚&lt;/p&gt;
&lt;h3 id=&#34;3-ä½¿ç”¨sdeåˆ†æå†…å­˜è¶³è¿¹&#34;&gt;3. ä½¿ç”¨SDEåˆ†æå†…å­˜è¶³è¿¹&lt;/h3&gt;
&lt;p&gt;ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä¼°è®¡å†…å­˜è¶³è¿¹ã€‚åœ¨ç¬¬ä¸‰éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†é€šè¿‡æµ‹é‡ä¸€ä¸ªç®€å•ç¨‹åºçš„å†…å­˜è¶³è¿¹æ¥çƒ­èº«ã€‚åœ¨ç¬¬å››éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†æ£€æŸ¥å››ä¸ªç”Ÿäº§å·¥ä½œè´Ÿè½½çš„å†…å­˜è¶³è¿¹ã€‚&lt;/p&gt;
&lt;p&gt;è€ƒè™‘ä¸‹é¢å·¦ä¾§åˆ—å‡ºçš„ç®€å•çš„æœ´ç´ çŸ©é˜µä¹˜æ³•ä»£ç ã€‚è¯¥ä»£ç å°†ä¸¤ä¸ª4Kx4Kçš„æ–¹é˜µ&lt;code&gt;a&lt;/code&gt;å’Œ&lt;code&gt;b&lt;/code&gt;ç›¸ä¹˜ï¼Œå¹¶å°†ç»“æœå†™å…¥4Kx4Kçš„æ–¹é˜µ&lt;code&gt;c&lt;/code&gt;ã€‚å›æƒ³ä¸€ä¸‹ï¼Œä¸ºäº†è®¡ç®—ç»“æœçŸ©é˜µ&lt;code&gt;c&lt;/code&gt;çš„ä¸€ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—çŸ©é˜µ&lt;code&gt;a&lt;/code&gt;ä¸­å¯¹åº”è¡Œå’ŒçŸ©é˜µ&lt;code&gt;b&lt;/code&gt;ä¸­å¯¹åº”åˆ—çš„ç‚¹ç§¯ï¼›è¿™å°±æ˜¯æœ€å†…å±‚å¾ªç¯&lt;code&gt;k&lt;/code&gt;æ‰€åšçš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;constexpr int N = 1024*4;                      // 4K
std::array&amp;lt;std::array&amp;lt;float, N&amp;gt;, N&amp;gt; a, b, c;   // 4K x 4K matrices
// init a, b, c
for (int i = 0; i &amp;lt; N; i++) {               for (int i = 0; i &amp;lt; N; i++) { 
  for (int j = 0; j &amp;lt; N; j++) {        =&amp;gt;     for (int k = 0; k &amp;lt; N; k++) {
    for (int k = 0; k &amp;lt; N; k++)        =&amp;gt;       for (int j = 0; j &amp;lt; N; j++) {
      c[i][j] += a[i][k] * b[k][j];               c[i][j] += a[i][k] * b[k][j];
    }                                           }
  }                                           }
}                                           }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†å±•ç¤ºå†…å­˜è¶³è¿¹çš„å‡å°‘ï¼Œæˆ‘ä»¬åº”ç”¨äº†ä¸€ä¸ªç®€å•çš„å¾ªç¯äº¤æ¢å˜æ¢ï¼Œäº¤æ¢äº†&lt;code&gt;j&lt;/code&gt;å’Œ&lt;code&gt;k&lt;/code&gt;çš„å¾ªç¯ï¼ˆæ ‡è®°ä¸º&lt;code&gt;=&amp;gt;&lt;/code&gt;çš„è¡Œï¼‰ã€‚ä¸€æ—¦æˆ‘ä»¬æµ‹é‡äº†å†…å­˜è¶³è¿¹å¹¶åœ¨ä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´è¿›è¡Œæ¯”è¾ƒï¼Œå°±å¾ˆå®¹æ˜“çœ‹åˆ°å·®å¼‚ã€‚å†…å­˜è®¿é—®æ¨¡å¼å˜åŒ–çš„å¯è§†åŒ–ç»“æœå¦‚å›¾6æ‰€ç¤ºã€‚æˆ‘ä»¬ä»é€ä¸ªè®¡ç®—çŸ©é˜µ&lt;code&gt;c&lt;/code&gt;çš„æ¯ä¸ªå…ƒç´ è½¬å˜ä¸ºè®¡ç®—éƒ¨åˆ†ç»“æœï¼ŒåŒæ—¶åœ¨æ‰€æœ‰ä¸‰ä¸ªçŸ©é˜µä¸­ä¿æŒè¡Œä¸»éå†ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨åŸå§‹ä»£ç ï¼ˆå·¦ä¾§ï¼‰ä¸­ï¼ŒçŸ©é˜µ&lt;code&gt;b&lt;/code&gt;ä»¥åˆ—ä¸»æ–¹å¼è®¿é—®ï¼Œè¿™ä¸åˆ©äºç¼“å­˜ã€‚è§‚å¯Ÿå›¾ç‰‡ï¼Œæ³¨æ„åœ¨å†…å±‚å¾ªç¯çš„å‰Næ¬¡è¿­ä»£åè§¦æ‘¸çš„å†…å­˜åŒºåŸŸã€‚æˆ‘ä»¬è®¡ç®—&lt;code&gt;a&lt;/code&gt;ä¸­ç¬¬0è¡Œå’Œ&lt;code&gt;b&lt;/code&gt;ä¸­ç¬¬0åˆ—çš„ç‚¹ç§¯ï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨çŸ©é˜µ&lt;code&gt;c&lt;/code&gt;çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸­ã€‚åœ¨å†…å±‚å¾ªç¯çš„ä¸‹ä¸€ä¸ªNæ¬¡è¿­ä»£æœŸé—´ï¼Œæˆ‘ä»¬è®¿é—®&lt;code&gt;a&lt;/code&gt;ä¸­çš„ç›¸åŒç¬¬0è¡Œå’Œ&lt;code&gt;b&lt;/code&gt;ä¸­çš„ç¬¬1åˆ—ï¼Œä»¥åœ¨çŸ©é˜µ&lt;code&gt;c&lt;/code&gt;ä¸­è·å¾—ç¬¬äºŒä¸ªç»“æœã€‚&lt;/p&gt;
&lt;p&gt;åœ¨å³ä¾§è½¬æ¢åçš„ä»£ç ä¸­ï¼Œå†…å±‚å¾ªç¯ä»…è®¿é—®çŸ©é˜µ&lt;code&gt;a&lt;/code&gt;ä¸­çš„å•ä¸ªå…ƒç´ ã€‚æˆ‘ä»¬å°†å®ƒä¸&lt;code&gt;b&lt;/code&gt;ä¸­ç›¸åº”è¡Œçš„æ‰€æœ‰å…ƒç´ ç›¸ä¹˜ï¼Œå¹¶å°†ä¹˜ç§¯ç´¯åŠ åˆ°&lt;code&gt;c&lt;/code&gt;çš„ç›¸åº”è¡Œä¸­ã€‚å› æ­¤ï¼Œå†…å±‚å¾ªç¯çš„å‰Næ¬¡è¿­ä»£è®¡ç®—&lt;code&gt;a&lt;/code&gt;ä¸­å…ƒç´ 0å’Œ&lt;code&gt;b&lt;/code&gt;ä¸­ç¬¬0è¡Œçš„ä¹˜ç§¯ï¼Œå¹¶å°†éƒ¨åˆ†ç»“æœç´¯ç§¯åˆ°&lt;code&gt;c&lt;/code&gt;çš„ç¬¬0è¡Œä¸­ã€‚æ¥ä¸‹æ¥çš„Næ¬¡è¿­ä»£å°†&lt;code&gt;a&lt;/code&gt;ä¸­çš„å…ƒç´ 1å’Œ&lt;code&gt;b&lt;/code&gt;ä¸­çš„ç¬¬1è¡Œç›¸ä¹˜ï¼Œå¹¶å†æ¬¡å°†éƒ¨åˆ†ç»“æœç´¯ç§¯åˆ°&lt;code&gt;c&lt;/code&gt;çš„ç¬¬0è¡Œä¸­ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://easyperf.net/img/posts/MemoryProfiling/MemoryFootprint.png&#34;&gt;&lt;img src=&#34;https://easyperf.net/img/posts/MemoryProfiling/MemoryFootprint.png&#34; alt=&#34;img&#34;&gt;&lt;/a&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾6. å†…å±‚å¾ªç¯çš„å‰Næ¬¡å’Œ2Næ¬¡è¿­ä»£åè§¦æ‘¸çš„å†…å­˜è®¿é—®æ¨¡å¼å’Œç¼“å­˜è¡Œï¼ˆ&lt;em&gt;å›¾ç‰‡æœªæŒ‰æ¯”ä¾‹&lt;/em&gt;ï¼‰ã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è®©æˆ‘ä»¬ç”¨Intel &lt;a href=&#34;https://www.intel.com/content/www/us/en/developer/articles/tool/software-development-emulator.html&#34;&gt;SDE&lt;/a&gt;ï¼Œå³x86å¹³å°çš„è½¯ä»¶å¼€å‘ä»¿çœŸå™¨å·¥å…·æ¥ç¡®è®¤è¿™ä¸€ç‚¹ã€‚SDEå»ºç«‹åœ¨åŠ¨æ€äºŒè¿›åˆ¶æ’æ¡©æœºåˆ¶ä¹‹ä¸Šï¼Œè¿™ä½¿å¾—å®ƒèƒ½å¤Ÿæ‹¦æˆªæ¯ä¸€æ¡æŒ‡ä»¤ã€‚è¿™å¸¦æ¥äº†å·¨å¤§çš„æˆæœ¬ã€‚å¯¹äºæˆ‘ä»¬è¿è¡Œçš„å®éªŒï¼Œå¸¸è§çš„æ˜¯100å€çš„å‡é€Ÿã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†é˜²æ­¢ç¼–è¯‘å™¨å¹²æ‰°æˆ‘ä»¬çš„å®éªŒï¼Œæˆ‘ä»¬ç¦ç”¨äº†å‘é‡åŒ–å’Œå±•å¼€ä¼˜åŒ–ï¼Œä»¥ä¾¿æ¯ä¸ªç‰ˆæœ¬åªæœ‰ä¸€ä¸ªçƒ­å¾ªç¯ï¼Œæ°å¥½åŒ…å«7æ¡æ±‡ç¼–æŒ‡ä»¤ã€‚æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæ¥ç»Ÿä¸€æ¯”è¾ƒå†…å­˜è¶³è¿¹é—´éš”ã€‚æˆ‘ä»¬ä¸æ˜¯ä½¿ç”¨æ—¶é—´é—´éš”ï¼Œè€Œæ˜¯ä½¿ç”¨ä»¥æœºå™¨æŒ‡ä»¤ä¸ºå•ä½çš„é—´éš”ã€‚æˆ‘ä»¬ç”¨æ¥æ”¶é›†SDEå†…å­˜è¶³è¿¹çš„å‘½ä»¤è¡Œï¼Œä»¥åŠå…¶è¾“å‡ºçš„ä¸€éƒ¨åˆ†ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚æ³¨æ„æˆ‘ä»¬ä½¿ç”¨äº†&lt;code&gt;-fp_icount 28K&lt;/code&gt;é€‰é¡¹ï¼Œè¿™è¡¨ç¤ºæµ‹é‡æ¯28Kæ¡æŒ‡ä»¤é—´éš”çš„å†…å­˜è¶³è¿¹ã€‚è¿™ä¸ªå€¼ç‰¹åˆ«é€‰æ‹©æ˜¯å› ä¸ºå®ƒä¸â€œbeforeâ€å’Œâ€œafterâ€æƒ…å†µä¸‹å†…å±‚å¾ªç¯çš„ä¸€æ¬¡è¿­ä»£ç›¸åŒ¹é…ï¼š&lt;code&gt;4Kå†…å±‚å¾ªç¯è¿­ä»£ * 7æ¡æŒ‡ä»¤ = 28K&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒSDEä»¥ç¼“å­˜è¡Œï¼ˆ64å­—èŠ‚ï¼‰ä¸ºå•ä½æµ‹é‡è¶³è¿¹ï¼Œä½†å®ƒä¹Ÿå¯ä»¥ä»¥å†…å­˜é¡µï¼ˆx86ä¸Šçš„4KBï¼‰ä¸ºå•ä½è¿›è¡Œæµ‹é‡ã€‚æˆ‘ä»¬å°†è¾“å‡ºåˆå¹¶å¹¶å¹¶æ’æ”¾ç½®ã€‚æ­¤å¤–ï¼Œä»è¾“å‡ºä¸­åˆ é™¤äº†ä¸€äº›ä¸ç›¸å…³çš„åˆ—ã€‚ç¬¬ä¸€åˆ—&lt;code&gt;PERIOD&lt;/code&gt;æ ‡è®°äº†æ–°çš„28KæŒ‡ä»¤é—´éš”çš„å¼€å§‹ã€‚æ¯ä¸ªæœŸé—´ä¹‹é—´çš„å·®å¼‚æ˜¯28Kæ¡æŒ‡ä»¤ã€‚&lt;code&gt;LOAD&lt;/code&gt;åˆ—å‘Šè¯‰æˆ‘ä»¬æœ‰å¤šå°‘ç¼“å­˜è¡Œè¢«åŠ è½½æŒ‡ä»¤è®¿é—®ã€‚å›æƒ³ä¸€ä¸‹ä¹‹å‰çš„è®¨è®ºï¼ŒåŒä¸€ä¸ªç¼“å­˜è¡Œè¢«è®¿é—®ä¸¤æ¬¡åªè®¡ç®—ä¸€æ¬¡ã€‚ç±»ä¼¼åœ°ï¼Œ&lt;code&gt;STORE&lt;/code&gt;åˆ—å‘Šè¯‰æˆ‘ä»¬æœ‰å¤šå°‘ç¼“å­˜è¡Œè¢«å­˜å‚¨ã€‚&lt;code&gt;CODE&lt;/code&gt;åˆ—è®¡ç®—åœ¨è¯¥æœŸé—´æ‰§è¡Œçš„åŒ…å«æŒ‡ä»¤çš„ç¼“å­˜è¡Œã€‚æœ€åï¼Œ&lt;code&gt;NEW&lt;/code&gt;è®¡ç®—åœ¨æœŸé—´è¢«è§¦æ‘¸çš„ä¹‹å‰æœªè¢«ç¨‹åºçœ‹åˆ°çš„ç¼“å­˜è¡Œã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬ç»§ç»­ä¹‹å‰çš„é‡è¦è¯´æ˜ï¼šSDEæŠ¥å‘Šçš„å†…å­˜è¶³è¿¹ä¸ç­‰äºåˆ©ç”¨çš„å†…å­˜å¸¦å®½ã€‚è¿™æ˜¯å› ä¸ºå®ƒæ²¡æœ‰è€ƒè™‘å†…å­˜æ“ä½œæ˜¯ä»ç¼“å­˜è¿˜æ˜¯å†…å­˜ä¸­æœåŠ¡çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;$ sde64 -footprint -fp_icount 28K -- ./matrix_multiply.exe

============================= CACHE LINES =============================
PERIOD    LOAD  STORE  CODE  NEW   |   PERIOD    LOAD  STORE  CODE  NEW
-----------------------------------------------------------------------
...                                    ...
2982388   4351    1     2   4345   |   2982404   258    256    2    511
3011063   4351    1     2      0   |   3011081   258    256    2    256
3039738   4351    1     2      0   |   3039758   258    256    2    256
3068413   4351    1     2      0   |   3068435   258    256    2    256
3097088   4351    1     2      0   |   3097112   258    256    2    256
3125763   4351    1     2      0   |   3125789   258    256    2    256
3154438   4351    1     2      0   |   3154466   257    256    2    255
3183120   4352    1     2      0   |   3183150   257    256    2    256
3211802   4352    1     2      0   |   3211834   257    256    2    256
3240484   4352    1     2      0   |   3240518   257    256    2    256
3269166   4352    1     2      0   |   3269202   257    256    2    256
3297848   4352    1     2      0   |   3297886   257    256    2    256
3326530   4352    1     2      0   |   3326570   257    256    2    256
3355212   4352    1     2      0   |   3355254   257    256    2    256
3383894   4352    1     2      0   |   3383938   257    256    2    256
3412576   4352    1     2      0   |   3412622   257    256    2    256
3441258   4352    1     2   4097   |   3441306   257    256    2    257
3469940   4352    1     2      0   |   3469990   257    256    2    256
3498622   4352    1     2      0   |   3498674   257    256    2    256
...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹ä¸Šé¢è¾“å‡ºä¸­çš„æ•°å­—ã€‚çœ‹çœ‹ä»æŒ‡ä»¤&lt;code&gt;2982388&lt;/code&gt;å¼€å§‹çš„æ—¶é—´æ®µï¼ˆå·¦ä¾§ï¼‰ã€‚è¿™ä¸ªæ—¶é—´æ®µå¯¹åº”åŸå§‹Matmulç¨‹åºä¸­å†…å±‚å¾ªç¯çš„å‰4096æ¬¡è¿­ä»£ã€‚SDEæŠ¥å‘Šç§°åœ¨è¿™ä¸ªæ—¶é—´æ®µå†…ï¼Œç®—æ³•åŠ è½½äº†4351ä¸ªç¼“å­˜è¡Œã€‚æˆ‘ä»¬æ¥åšä¸€ä¸‹æ•°å­¦è®¡ç®—ï¼Œçœ‹çœ‹æˆ‘ä»¬æ˜¯å¦èƒ½å¾—åˆ°ç›¸åŒçš„æ•°å­—ã€‚åŸå§‹çš„å†…å±‚å¾ªç¯è®¿é—®çŸ©é˜µ&lt;code&gt;a&lt;/code&gt;çš„ç¬¬0è¡Œã€‚è®°ä½&lt;code&gt;float&lt;/code&gt;ç±»å‹çš„å¤§å°æ˜¯4å­—èŠ‚ï¼Œç¼“å­˜è¡Œçš„å¤§å°æ˜¯64å­—èŠ‚ã€‚æ‰€ä»¥ï¼Œå¯¹äºçŸ©é˜µ&lt;code&gt;a&lt;/code&gt;ï¼Œç®—æ³•åŠ è½½äº†&lt;code&gt;(4096 * 4å­—èŠ‚) / 64å­—èŠ‚ = 256&lt;/code&gt;ä¸ªç¼“å­˜è¡Œã€‚å¯¹äºçŸ©é˜µ&lt;code&gt;b&lt;/code&gt;ï¼Œç®—æ³•è®¿é—®ç¬¬0åˆ—ã€‚æ¯ä¸ªå…ƒç´ éƒ½ä½äºè‡ªå·±çš„ç¼“å­˜è¡Œä¸Šï¼Œæ‰€ä»¥å¯¹äºçŸ©é˜µ&lt;code&gt;b&lt;/code&gt;å®ƒåŠ è½½äº†4096ä¸ªç¼“å­˜è¡Œã€‚å¯¹äºçŸ©é˜µ&lt;code&gt;c&lt;/code&gt;ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰ä¹˜ç§¯ç´¯ç§¯åˆ°ä¸€ä¸ªå•ç‹¬çš„å…ƒç´ ä¸­ï¼Œæ‰€ä»¥æœ‰1ä¸ªç¼“å­˜è¡Œè¢«&lt;em&gt;å­˜å‚¨&lt;/em&gt;åœ¨çŸ©é˜µ&lt;code&gt;c&lt;/code&gt;ä¸­ã€‚æˆ‘ä»¬è®¡ç®—å‡ºåŠ è½½äº†&lt;code&gt;4096 + 256 = 4352&lt;/code&gt;ä¸ªç¼“å­˜è¡Œï¼Œå­˜å‚¨äº†1ä¸ªç¼“å­˜è¡Œã€‚ä¸€ä¸ªç¼“å­˜è¡Œçš„å·®å¼‚å¯èƒ½ä¸SDEå¼€å§‹è®¡ç®—28KæŒ‡ä»¤é—´éš”ä¸æ˜¯åœ¨ç¬¬ä¸€ä¸ªå†…å±‚å¾ªç¯è¿­ä»£çš„ç¡®åˆ‡å¼€å§‹æœ‰å…³ã€‚æˆ‘ä»¬çœ‹åˆ°åœ¨è¿™ä¸ªæ—¶é—´æ®µå†…æœ‰ä¸¤æ¡åŒ…å«æŒ‡ä»¤çš„ç¼“å­˜è¡Œï¼ˆ&lt;code&gt;CODE&lt;/code&gt;ï¼‰è¢«è®¿é—®ã€‚å†…å±‚å¾ªç¯çš„ä¸ƒæ¡æŒ‡ä»¤ä½äºä¸€ä¸ªç¼“å­˜è¡Œä¸­ï¼Œä½†28Ké—´éš”ä¹Ÿå¯èƒ½æ•è·åˆ°ä¸­é—´å¾ªç¯ï¼Œä½¿å…¶æ€»å…±æˆä¸ºä¸¤ä¸ªç¼“å­˜è¡Œã€‚æœ€åï¼Œç”±äºæˆ‘ä»¬è®¿é—®çš„æ‰€æœ‰æ•°æ®ä¹‹å‰éƒ½æœªè¢«çœ‹åˆ°ï¼Œæ‰€ä»¥æ‰€æœ‰çš„ç¼“å­˜è¡Œéƒ½æ˜¯&lt;code&gt;NEW&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨è®©æˆ‘ä»¬åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ª28KæŒ‡ä»¤çš„æ—¶é—´æ®µï¼ˆ&lt;code&gt;3011063&lt;/code&gt;ï¼‰ï¼Œå®ƒå¯¹åº”åŸå§‹Matmulç¨‹åºä¸­å†…å±‚å¾ªç¯çš„ç¬¬äºŒç»„4096æ¬¡è¿­ä»£ã€‚æˆ‘ä»¬æœ‰ä¸å‰ä¸€ä¸ªæ—¶é—´æ®µç›¸åŒçš„&lt;code&gt;LOAD&lt;/code&gt;ã€&lt;code&gt;STORE&lt;/code&gt;å’Œ&lt;code&gt;CODE&lt;/code&gt;ç¼“å­˜è¡Œæ•°é‡ï¼Œè¿™æ˜¯é¢„æœŸçš„ã€‚ç„¶è€Œï¼Œæ²¡æœ‰æ–°çš„&lt;code&gt;NEW&lt;/code&gt;ç¼“å­˜è¡Œè¢«å ç”¨ã€‚è®©æˆ‘ä»¬ç†è§£ä¸ºä»€ä¹ˆä¼šè¿™æ ·ã€‚å†æ¬¡æŸ¥çœ‹å›¾6ã€‚å†…å±‚å¾ªç¯çš„ç¬¬äºŒç»„4096æ¬¡è¿­ä»£å†æ¬¡è®¿é—®çŸ©é˜µ&lt;code&gt;a&lt;/code&gt;çš„ç¬¬0è¡Œã€‚ä½†å®ƒä¹Ÿè®¿é—®çŸ©é˜µ&lt;code&gt;b&lt;/code&gt;çš„ç¬¬1åˆ—ï¼Œè¿™æ˜¯æ–°çš„ï¼Œä½†è¿™äº›å…ƒç´ ä½äºä¸ç¬¬0åˆ—ç›¸åŒçš„ç¼“å­˜è¡Œé›†ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬å·²ç»åœ¨å‰ä¸€ä¸ª28Kæ—¶é—´æ®µå†…å ç”¨äº†å®ƒä»¬ã€‚è¿™ç§æ¨¡å¼åœ¨æ¥ä¸‹æ¥çš„14ä¸ªæ—¶é—´æ®µå†…é‡å¤ã€‚æ¯ä¸ªç¼“å­˜è¡ŒåŒ…å«&lt;code&gt;64å­—èŠ‚ / 4å­—èŠ‚ï¼ˆfloatçš„å¤§å°ï¼‰= 16&lt;/code&gt;ä¸ªå…ƒç´ ï¼Œè¿™è§£é‡Šäº†æ¨¡å¼ï¼šæˆ‘ä»¬æ¯16æ¬¡è¿­ä»£åœ¨çŸ©é˜µ&lt;code&gt;b&lt;/code&gt;ä¸­è·å–ä¸€ç»„æ–°çš„ç¼“å­˜è¡Œã€‚æœ€åä¸€ä¸ªå‰©ä¸‹çš„é—®é¢˜æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨å†…å±‚å¾ªç¯çš„å‰16æ¬¡è¿­ä»£åæœ‰4097ä¸ª&lt;code&gt;NEW&lt;/code&gt;è¡Œã€‚ç­”æ¡ˆå¾ˆç®€å•ï¼šç®—æ³•ä¸æ–­è®¿é—®çŸ©é˜µ&lt;code&gt;a&lt;/code&gt;çš„ç¬¬0è¡Œï¼Œæ‰€ä»¥æ‰€æœ‰è¿™äº›æ–°çš„ç¼“å­˜è¡Œéƒ½æ¥è‡ªçŸ©é˜µ&lt;code&gt;b&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºè½¬æ¢åçš„ç‰ˆæœ¬ï¼Œå†…å­˜è¶³è¿¹çœ‹èµ·æ¥æ›´åŠ ä¸€è‡´ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªæ—¶é—´æ®µä¹‹å¤–ï¼Œæ‰€æœ‰æ—¶é—´æ®µçš„æ•°å­—éƒ½éå¸¸ç›¸ä¼¼ã€‚åœ¨ç¬¬ä¸€ä¸ªæ—¶é—´æ®µï¼Œæˆ‘ä»¬åœ¨çŸ©é˜µ&lt;code&gt;a&lt;/code&gt;ä¸­è®¿é—®äº†1ä¸ªç¼“å­˜è¡Œï¼›&lt;code&gt;(4096 * 4å­—èŠ‚) / 64å­—èŠ‚ = 256&lt;/code&gt;ä¸ªç¼“å­˜è¡Œåœ¨&lt;code&gt;b&lt;/code&gt;ä¸­ï¼›&lt;code&gt;(4096 * 4å­—èŠ‚) / 64å­—èŠ‚ = 256&lt;/code&gt;ä¸ªç¼“å­˜è¡Œè¢«å­˜å‚¨åˆ°&lt;code&gt;c&lt;/code&gt;ä¸­ï¼Œæ€»å…±513è¡Œã€‚å†æ¬¡ï¼Œç»“æœçš„å·®å¼‚ä¸SDEå¼€å§‹è®¡ç®—28KæŒ‡ä»¤é—´éš”ä¸æ˜¯åœ¨ç¬¬ä¸€ä¸ªå†…å±‚å¾ªç¯è¿­ä»£çš„ç¡®åˆ‡å¼€å§‹æœ‰å…³ã€‚åœ¨ç¬¬äºŒä¸ªæ—¶é—´æ®µï¼ˆ&lt;code&gt;3011081&lt;/code&gt;ï¼‰ï¼Œæˆ‘ä»¬è®¿é—®äº†çŸ©é˜µ&lt;code&gt;a&lt;/code&gt;ä¸­çš„ç›¸åŒç¼“å­˜è¡Œï¼Œä»çŸ©é˜µ&lt;code&gt;b&lt;/code&gt;ä¸­è®¿é—®äº†ä¸€ç»„æ–°çš„256ä¸ªç¼“å­˜è¡Œï¼Œä»¥åŠä»çŸ©é˜µ&lt;code&gt;c&lt;/code&gt;ä¸­è®¿é—®äº†ç›¸åŒçš„ç¼“å­˜è¡Œé›†ã€‚åªæœ‰æ¥è‡ªçŸ©é˜µ&lt;code&gt;b&lt;/code&gt;çš„è¡Œä¹‹å‰æœªè¢«çœ‹åˆ°ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆç¬¬äºŒä¸ªæ—¶é—´æ®µæœ‰&lt;code&gt;NEW&lt;/code&gt; 256ä¸ªç¼“å­˜è¡Œã€‚ä»¥æŒ‡ä»¤&lt;code&gt;3441306&lt;/code&gt;å¼€å§‹çš„æ—¶é—´æ®µæœ‰257ä¸ª&lt;code&gt;NEW&lt;/code&gt;è¡Œè¢«è®¿é—®ã€‚ä¸€ä¸ªé¢å¤–çš„ç¼“å­˜è¡Œæ¥è‡ªäºè®¿é—®çŸ©é˜µ&lt;code&gt;a&lt;/code&gt;ä¸­çš„å…ƒç´ &lt;code&gt;a[0][17]&lt;/code&gt;ï¼Œå› ä¸ºå®ƒä¹‹å‰æœªè¢«è®¿é—®è¿‡ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬æ¢ç´¢çš„ä¸¤ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡SDEè¾“å‡ºç¡®è®¤äº†æˆ‘ä»¬å¯¹ç®—æ³•çš„ç†è§£ã€‚ä½†è¯·æ³¨æ„ï¼Œä»…å‡­SDEè¶³è¿¹å·¥å…·çš„è¾“å‡ºï¼Œä½ æ— æ³•åˆ¤æ–­ç®—æ³•æ˜¯å¦å¯¹ç¼“å­˜å‹å¥½ã€‚åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ç®€å•åœ°æŸ¥çœ‹äº†ä»£ç å¹¶ç›¸å½“å®¹æ˜“åœ°è§£é‡Šäº†æ•°å­—ã€‚ä½†å¦‚æœæ²¡æœ‰çŸ¥é“ç®—æ³•åœ¨åšä»€ä¹ˆï¼Œå°±æ— æ³•åšå‡ºæ­£ç¡®çš„åˆ¤æ–­ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆã€‚ç°ä»£x86å¤„ç†å™¨çš„L1ç¼“å­˜åªèƒ½å®¹çº³å¤§çº¦1000ä¸ªç¼“å­˜è¡Œã€‚å½“ä½ çœ‹åˆ°ä¸€ä¸ªç®—æ³•è®¿é—®ï¼Œæ¯”å¦‚è¯´ï¼Œæ¯1Mæ¡æŒ‡ä»¤500è¡Œæ—¶ï¼Œå¯èƒ½ä¼šè¯±äººåœ°å¾—å‡ºç»“è®ºï¼Œä»£ç å¿…é¡»æ˜¯å¯¹ç¼“å­˜å‹å¥½çš„ï¼Œå› ä¸º500è¡Œå¯ä»¥è½»æ¾åœ°é€‚åº”L1ç¼“å­˜ã€‚ä½†æˆ‘ä»¬å¯¹è¿™äº›è®¿é—®çš„æ€§è´¨ä¸€æ— æ‰€çŸ¥ã€‚å¦‚æœè¿™äº›è®¿é—®æ˜¯éšæœºçš„ï¼Œé‚£ä¹ˆè¿™æ ·çš„ä»£ç è¿œéâ€œå‹å¥½â€ã€‚SDEè¶³è¿¹å·¥å…·çš„è¾“å‡ºä»…ä»…å‘Šè¯‰æˆ‘ä»¬è®¿é—®äº†å¤šå°‘å†…å­˜ï¼Œä½†æˆ‘ä»¬ä¸çŸ¥é“è¿™äº›è®¿é—®æ˜¯å¦å‘½ä¸­äº†ç¼“å­˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;4-æ¡ˆä¾‹ç ”ç©¶å››ä¸ªå·¥ä½œè´Ÿè½½çš„å†…å­˜è¶³è¿¹&#34;&gt;4. æ¡ˆä¾‹ç ”ç©¶ï¼šå››ä¸ªå·¥ä½œè´Ÿè½½çš„å†…å­˜è¶³è¿¹&lt;/h3&gt;
&lt;p&gt;åœ¨è¿™ä¸ªæ¡ˆä¾‹ç ”ç©¶ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨Intel SDEå·¥å…·æ¥åˆ†æå››ä¸ªç”Ÿäº§å·¥ä½œè´Ÿè½½çš„å†…å­˜è¶³è¿¹ï¼šBlenderå…‰çº¿è¿½è¸ªã€Stockfishå›½é™…è±¡æ£‹å¼•æ“ã€Clang++ç¼–è¯‘å’ŒAI_bench PSPNetåˆ†å‰²ã€‚æˆ‘ä»¬å¸Œæœ›è¿™é¡¹ç ”ç©¶èƒ½ç»™ä½ ä¸€ä¸ªç›´è§‰ï¼Œè®©ä½ çŸ¥é“åœ¨çœŸå®ä¸–ç•Œçš„åº”ç”¨ä¸­å¯èƒ½ä¼šçœ‹åˆ°ä»€ä¹ˆã€‚åœ¨ç¬¬ä¸‰éƒ¨åˆ†ï¼Œæˆ‘ä»¬æ”¶é›†äº†æ¯28Kæ¡æŒ‡ä»¤é—´éš”çš„å†…å­˜è¶³è¿¹ï¼Œè¿™å¯¹äºè¿è¡Œæ•°åƒäº¿æ¡æŒ‡ä»¤çš„åº”ç”¨ç¨‹åºæ¥è¯´å¤ªå°äº†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æµ‹é‡æ¯åäº¿æ¡æŒ‡ä»¤çš„è¶³è¿¹ã€‚&lt;/p&gt;
&lt;p&gt;å›¾7å±•ç¤ºäº†å››ä¸ªé€‰å®šå·¥ä½œè´Ÿè½½çš„å†…å­˜è¶³è¿¹ã€‚ä½ å¯ä»¥çœ‹åˆ°å®ƒä»¬éƒ½æœ‰éå¸¸ä¸åŒçš„è¡Œä¸ºã€‚Clangç¼–è¯‘åœ¨å¼€å§‹æ—¶å†…å­˜æ´»åŠ¨éå¸¸é«˜ï¼Œæœ‰æ—¶æ¯10äº¿æ¡æŒ‡ä»¤ä¼šé£™å‡åˆ°100MBï¼Œä½†ä¹‹åå®ƒå‡å°‘åˆ°å¤§çº¦æ¯10äº¿æ¡æŒ‡ä»¤15MBã€‚å›¾è¡¨ä¸Šçš„ä»»ä½•å³°å€¼éƒ½å¯èƒ½å¼•èµ·Clangå¼€å‘è€…çš„å…³æ³¨ï¼šå®ƒä»¬æ˜¯é¢„æœŸçš„å—ï¼Ÿå®ƒä»¬æ˜¯å¦ä¸æŸäº›å†…å­˜å¯†é›†å‹çš„ä¼˜åŒ–è¿‡ç¨‹æœ‰å…³ï¼Ÿè®¿é—®çš„å†…å­˜ä½ç½®å¯ä»¥è¢«å‹ç¼©å—ï¼Ÿ&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://easyperf.net/img/posts/MemoryProfiling/MemFootCaseStudyFourBench.png&#34;&gt;&lt;img src=&#34;https://easyperf.net/img/posts/MemoryProfiling/MemFootCaseStudyFourBench.png&#34; alt=&#34;img&#34;&gt;&lt;/a&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾7. å››ä¸ªå·¥ä½œè´Ÿè½½çš„å†…å­˜è¶³è¿¹æ¡ˆä¾‹ç ”ç©¶ã€‚MEM - åœ¨1BæŒ‡ä»¤é—´éš”æœŸé—´è®¿é—®çš„æ€»å†…å­˜ã€‚NEW - ä¹‹å‰æœªè¢«çœ‹åˆ°çš„è®¿é—®å†…å­˜ã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;BlenderåŸºå‡†æµ‹è¯•éå¸¸ç¨³å®šï¼›æˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°æ¯ä¸ªæ¸²æŸ“å¸§çš„å¼€å§‹å’Œç»“æŸã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸“æ³¨äºå•ä¸ªå¸§ï¼Œè€Œä¸å¿…çœ‹æ•´ä¸ª1000å¤šä¸ªå¸§ã€‚StockfishåŸºå‡†æµ‹è¯•è¦æ··ä¹±å¾—å¤šï¼Œå¯èƒ½æ˜¯å› ä¸ºå›½é™…è±¡æ£‹å¼•æ“å¤„ç†ä¸åŒçš„ä½ç½®ï¼Œè¿™äº›ä½ç½®éœ€è¦ä¸åŒæ•°é‡çš„èµ„æºã€‚æœ€åï¼ŒAI_benchçš„å†…å­˜è¶³è¿¹éå¸¸æœ‰è¶£ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥å‘ç°é‡å¤çš„æ¨¡å¼ã€‚åœ¨åˆå§‹å¯åŠ¨ä¹‹åï¼Œæœ‰äº”åˆ°å…­ä¸ªä»&lt;code&gt;40B&lt;/code&gt;åˆ°&lt;code&gt;95B&lt;/code&gt;çš„æ­£å¼¦æ³¢ï¼Œç„¶åæ˜¯ä¸‰ä¸ªä»¥é”åˆ©å³°å€¼ç»“æŸçš„åŒºåŸŸï¼Œè¾¾åˆ°200MBï¼Œç„¶ååˆæ˜¯ä¸‰ä¸ªæ¯10äº¿æ¡æŒ‡ä»¤å¤§çº¦åœ¨25MBçš„åŒºåŸŸã€‚æ‰€æœ‰è¿™äº›éƒ½å¯èƒ½æ˜¯å¯ä»¥ç”¨æ¥ä¼˜åŒ–åº”ç”¨ç¨‹åºçš„å¯æ“ä½œä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;å…³äºæŒ‡ä»¤ä½œä¸ºæ—¶é—´çš„è¡¡é‡å¯èƒ½ä»ç„¶æœ‰ä¸€äº›æ··æ·†ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœä½ çŸ¥é“å·¥ä½œè´Ÿè½½çš„IPCï¼ˆæ¯ä¸ªæ—¶é’Ÿå‘¨æœŸçš„æŒ‡ä»¤æ•°ï¼‰å’Œå¤„ç†å™¨è¿è¡Œçš„é¢‘ç‡ï¼Œä½ å¯ä»¥å¤§è‡´å°†æ—¶é—´çº¿ä»æŒ‡ä»¤è½¬æ¢ä¸ºç§’ã€‚ä¾‹å¦‚ï¼Œåœ¨IPC=1å’Œå¤„ç†å™¨é¢‘ç‡ä¸º4GHzçš„æƒ…å†µä¸‹ï¼Œ10äº¿æ¡æŒ‡ä»¤è¿è¡Œ250æ¯«ç§’ï¼Œåœ¨IPC=2æ—¶ï¼Œ10äº¿æ¡æŒ‡ä»¤è¿è¡Œ125æ¯«ç§’ï¼Œä»¥æ­¤ç±»æ¨ã€‚è¿™æ ·ï¼Œä½ å¯ä»¥å°†å†…å­˜è¶³è¿¹å›¾è¡¨çš„Xè½´ä»æŒ‡ä»¤è½¬æ¢ä¸ºç§’ã€‚ä½†è¯·è®°ä½ï¼Œåªæœ‰åœ¨å·¥ä½œè´Ÿè½½å…·æœ‰ç¨³å®šçš„IPCä¸”CPUé¢‘ç‡åœ¨å·¥ä½œè´Ÿè½½è¿è¡ŒæœŸé—´ä¸æ”¹å˜æ—¶ï¼Œå®ƒæ‰ä¼šå‡†ç¡®ã€‚&lt;/p&gt;
&lt;h3 id=&#34;5-æ•°æ®å±€éƒ¨æ€§å’Œé‡ç”¨è·ç¦»&#34;&gt;5. æ•°æ®å±€éƒ¨æ€§å’Œé‡ç”¨è·ç¦»&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;æ³¨ï¼š&lt;/strong&gt;ï¼ˆè¿™éƒ¨åˆ†ä½œè€…å¯èƒ½ä¼šå˜åŠ¨ï¼Œè§: &lt;a href=&#34;https://easyperf.net/blog/2024/02/12/Memory-Profiling-Part5#disqus_thread&#34;&gt;åŸæ–‡è¯„è®º&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;æ­£å¦‚ä»å‰é¢çš„æ¡ˆä¾‹ç ”ç©¶ä¸­çœ‹åˆ°çš„ï¼Œä½¿ç”¨ç°ä»£å†…å­˜åˆ†æå·¥å…·å¯ä»¥æå–å¤§é‡ä¿¡æ¯ã€‚ç„¶è€Œï¼Œè¿˜å­˜åœ¨ä¸€äº›é™åˆ¶ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°†è®¨è®ºã€‚&lt;/p&gt;
&lt;p&gt;è€ƒè™‘å›¾7ï¼ˆç¬¬å››éƒ¨åˆ†ï¼‰ä¸­æ˜¾ç¤ºçš„å†…å­˜è¶³è¿¹å›¾è¡¨ã€‚è¿™æ ·çš„å›¾è¡¨å‘Šè¯‰æˆ‘ä»¬åœ¨10äº¿æ¡æŒ‡ä»¤æœŸé—´è®¿é—®äº†å¤šå°‘å­—èŠ‚ã€‚ç„¶è€Œï¼ŒæŸ¥çœ‹è¿™äº›å›¾è¡¨ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œæˆ‘ä»¬éƒ½æ— æ³•çŸ¥é“åœ¨10äº¿æ¡æŒ‡ä»¤æœŸé—´ï¼ŒæŸä¸ªå†…å­˜ä½ç½®æ˜¯è¢«è®¿é—®äº†ä¸€æ¬¡ã€ä¸¤æ¬¡è¿˜æ˜¯ä¸€ç™¾æ¬¡ã€‚æ¯æ¬¡è®°å½•çš„å†…å­˜è®¿é—®åªæ˜¯ä¸ºé—´éš”æœŸé—´çš„æ€»å†…å­˜è¶³è¿¹åšå‡ºè´¡çŒ®ï¼Œå¹¶ä¸”æ¯ä¸ªé—´éš”åªè®¡ç®—ä¸€æ¬¡ã€‚çŸ¥é“æ¯ä¸ªå­—èŠ‚åœ¨é—´éš”æœŸé—´è¢«è§¦æ‘¸é‡ç”¨äº†å¤šå°‘æ¬¡ï¼Œä¼šç»™æˆ‘ä»¬ä¸€äº›å…³äºç¨‹åºå†…å­˜è®¿é—®æ¨¡å¼çš„ç›´è§‰ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¼°è®¡çƒ­ç‚¹å†…å­˜åŒºåŸŸçš„å¤§å°ï¼Œå¹¶æŸ¥çœ‹å®ƒæ˜¯å¦é€‚åˆL3ç¼“å­˜ã€‚&lt;/p&gt;
&lt;p&gt;ç„¶è€Œï¼Œå³ä½¿è¿™äº›ä¿¡æ¯ä¹Ÿä¸è¶³ä»¥å®Œå…¨è¯„ä¼°å†…å­˜è®¿é—®çš„æ—¶é—´å±€éƒ¨æ€§ã€‚æƒ³è±¡ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬åœ¨10äº¿æ¡æŒ‡ä»¤çš„é—´éš”æœŸé—´ï¼Œæ‰€æœ‰å†…å­˜ä½ç½®éƒ½è¢«è®¿é—®äº†ä¸¤æ¬¡ã€‚è¿™æ˜¯å¥½è¿˜æ˜¯åï¼Ÿå—¯ï¼Œæˆ‘ä»¬ä¸çŸ¥é“ï¼Œå› ä¸ºé‡è¦çš„æ˜¯ç¬¬ä¸€æ¬¡ï¼ˆä½¿ç”¨ï¼‰å’Œç¬¬äºŒæ¬¡è®¿é—®ï¼ˆé‡ç”¨ï¼‰ä¹‹é—´çš„è·ç¦»ã€‚å¦‚æœè·ç¦»å¾ˆå°ï¼Œä¾‹å¦‚ï¼Œå°äºL1ç¼“å­˜å¯ä»¥ä¿æŒçš„ç¼“å­˜è¡Œæ•°ï¼ˆä»Šå¤©å¤§çº¦æ˜¯1000ï¼‰ï¼Œé‚£ä¹ˆæ•°æ®å¾ˆå¯èƒ½ä¼šè¢«æœ‰æ•ˆåœ°é‡ç”¨ã€‚å¦åˆ™ï¼Œæ‰€éœ€çš„ç¼“å­˜è¡Œå¯èƒ½å·²ç»åœ¨è¿™æœŸé—´è¢«é©±é€äº†ã€‚&lt;/p&gt;
&lt;p&gt;æ­¤å¤–ï¼Œåˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬è®¨è®ºçš„ä»»ä½•å†…å­˜åˆ†ææ–¹æ³•éƒ½æ²¡æœ‰ç»™æˆ‘ä»¬æä¾›ç¨‹åºç©ºé—´å±€éƒ¨æ€§çš„æ´å¯Ÿã€‚å†…å­˜ä½¿ç”¨å’Œå†…å­˜è¶³è¿¹åªå‘Šè¯‰æˆ‘ä»¬è®¿é—®äº†å¤šå°‘å†…å­˜ï¼Œä½†æˆ‘ä»¬ä¸çŸ¥é“è¿™äº›è®¿é—®æ˜¯é¡ºåºçš„ã€è·¨æ­¥çš„è¿˜æ˜¯å®Œå…¨éšæœºçš„ã€‚æˆ‘ä»¬éœ€è¦æ›´å¥½çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;åº”ç”¨ç¨‹åºçš„æ—¶é—´å’Œç©ºé—´å±€éƒ¨æ€§ä¸»é¢˜å·²ç»ç ”ç©¶äº†å¾ˆé•¿æ—¶é—´ï¼Œä¸å¹¸çš„æ˜¯ï¼Œæˆªè‡³2024å¹´åˆï¼Œè¿˜æ²¡æœ‰å¯ç”¨çš„ç”Ÿäº§è´¨é‡å·¥å…·å¯ä»¥æä¾›è¿™æ ·çš„ä¿¡æ¯ã€‚è¡¡é‡ç¨‹åºæ•°æ®å±€éƒ¨æ€§çš„ä¸­å¿ƒæŒ‡æ ‡æ˜¯&lt;em&gt;é‡ç”¨è·ç¦»(reuse distance)&lt;/em&gt;ï¼Œå®ƒæ˜¯åœ¨ä¸¤æ¬¡è¿ç»­è®¿é—®ç‰¹å®šå†…å­˜ä½ç½®ä¹‹é—´è®¿é—®çš„ç‹¬ç‰¹å†…å­˜ä½ç½®çš„æ•°é‡ã€‚é‡ç”¨è·ç¦»æ˜¾ç¤ºäº†åœ¨å…¸å‹çš„æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰ç¼“å­˜ä¸­å†…å­˜è®¿é—®ç¼“å­˜å‘½ä¸­çš„å¯èƒ½æ€§ã€‚å¦‚æœå†…å­˜è®¿é—®çš„é‡ç”¨è·ç¦»å¤§äºç¼“å­˜å¤§å°ï¼Œé‚£ä¹ˆåç»­çš„è®¿é—®ï¼ˆé‡ç”¨ï¼‰å¾ˆå¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜æœªå‘½ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºç°ä»£å¤„ç†å™¨ä¸­çš„å†…å­˜è®¿é—®å•ä½æ˜¯ç¼“å­˜è¡Œï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªé¢å¤–çš„æœ¯è¯­ï¼š&lt;em&gt;æ—¶é—´é‡ç”¨(temporal reuse)&lt;/em&gt; å‘ç”Ÿåœ¨ä½¿ç”¨å’Œé‡ç”¨è®¿é—®å®Œå…¨ç›¸åŒçš„åœ°å€æ—¶ï¼Œ&lt;em&gt;ç©ºé—´é‡ç”¨(&lt;em&gt;spatial reuse&lt;/em&gt;)&lt;/em&gt; å‘ç”Ÿåœ¨ä½¿ç”¨å’Œé‡ç”¨è®¿é—®ä½äºåŒä¸€ç¼“å­˜è¡Œçš„ä¸åŒåœ°å€æ—¶ã€‚è€ƒè™‘å›¾8ä¸­æ˜¾ç¤ºçš„ä¸€ç³»åˆ—å†…å­˜è®¿é—®ï¼š&lt;code&gt;a1,b1,e1,b2,c1,d1,a2&lt;/code&gt;ï¼Œå…¶ä¸­ä½ç½®&lt;code&gt;a&lt;/code&gt;ã€&lt;code&gt;b&lt;/code&gt;å’Œ&lt;code&gt;c&lt;/code&gt;å æ®ç¼“å­˜è¡Œ&lt;code&gt;N&lt;/code&gt;ï¼Œä½ç½®&lt;code&gt;d&lt;/code&gt;å’Œ&lt;code&gt;e&lt;/code&gt;ä½äºåç»­çš„ç¼“å­˜è¡Œ&lt;code&gt;N+1&lt;/code&gt;ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè®¿é—®&lt;code&gt;a2&lt;/code&gt;çš„æ—¶é—´é‡ç”¨è·ç¦»æ˜¯å››ï¼Œå› ä¸ºåœ¨ä¸¤æ¬¡è¿ç»­è®¿é—®&lt;code&gt;a&lt;/code&gt;ä¹‹é—´æœ‰å››ä¸ªç‹¬ç‰¹çš„ä½ç½®è¢«è®¿é—®ï¼Œå³&lt;code&gt;b&lt;/code&gt;ã€&lt;code&gt;c&lt;/code&gt;ã€&lt;code&gt;d&lt;/code&gt;å’Œ&lt;code&gt;e&lt;/code&gt;ã€‚è®¿é—®&lt;code&gt;d1&lt;/code&gt;ä¸æ˜¯æ—¶é—´é‡ç”¨ï¼Œç„¶è€Œï¼Œå®ƒæ˜¯ç©ºé—´é‡ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬ä¹‹å‰è®¿é—®äº†ä½ç½®&lt;code&gt;e&lt;/code&gt;ï¼Œå®ƒä¸&lt;code&gt;d&lt;/code&gt;ä½äºåŒä¸€ç¼“å­˜è¡Œã€‚è®¿é—®&lt;code&gt;d1&lt;/code&gt;çš„ç©ºé—´é‡ç”¨è·ç¦»æ˜¯äºŒã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://easyperf.net/img/posts/MemoryProfiling/ReuseDistances.png&#34;&gt;&lt;img src=&#34;https://easyperf.net/img/posts/MemoryProfiling/ReuseDistances.png&#34; alt=&#34;img&#34;&gt;&lt;/a&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾8. æ—¶é—´å’Œç©ºé—´é‡ç”¨çš„ç¤ºä¾‹ã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å›¾9æä¾›äº†ä¸€ä¸ªå‡è®¾ç¨‹åºçš„é‡ç”¨è·ç¦»ç›´æ–¹å›¾ç¤ºä¾‹ã€‚å®ƒçš„Xè½´ä»¥&lt;code&gt;log2&lt;/code&gt; binä¸ºç¾¤é›†ï¼Œæ¯ä¸ªbinä¹˜ä»¥1000è¿›è¡Œç¼©æ”¾ã€‚Yè½´æä¾›äº†å‘ç”Ÿç‡ï¼Œå³æˆ‘ä»¬è§‚å¯Ÿåˆ°æŸä¸ªç‰¹å®šé‡ç”¨è·ç¦»çš„é¢‘ç‡ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›çœ‹åˆ°æ‰€æœ‰çš„è®¿é—®éƒ½åœ¨ç¬¬ä¸€ä¸ªbin [0;1000]ä¸­ï¼Œæ— è®ºæ˜¯æ—¶é—´è¿˜æ˜¯ç©ºé—´é‡ç”¨ã€‚ä¾‹å¦‚ï¼Œå¯¹äºé¡ºåºè®¿é—®å¤§å‹æ•°ç»„ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€ä¸ªå¤§çš„æ—¶é—´é‡ç”¨è·ç¦»ï¼ˆä¸å¥½ï¼‰ï¼Œä½†ä¸€ä¸ªå°çš„ç©ºé—´é‡ç”¨è·ç¦»ï¼ˆå¥½ï¼‰ã€‚å¯¹äºä¸€ä¸ªå¤šæ¬¡éå†1000ä¸ªå…ƒç´ çš„äºŒå‰æ ‘ï¼ˆé€‚åˆL1ç¼“å­˜ï¼‰çš„ç¨‹åºï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„æ—¶é—´é‡ç”¨è·ç¦»ï¼ˆå¥½ï¼‰ï¼Œä½†ä¸€ä¸ªå¤§çš„ç©ºé—´é‡ç”¨è·ç¦»ï¼ˆä¸å¥½ï¼‰ã€‚å¯¹å¤§å‹ç¼“å†²åŒºçš„éšæœºè®¿é—®ä»£è¡¨äº†æ—¶é—´å’Œç©ºé—´å±€éƒ¨æ€§éƒ½ä¸å¥½ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœå†…å­˜è®¿é—®å…·æœ‰å°çš„æ—¶é—´æˆ–ç©ºé—´é‡ç”¨è·ç¦»ï¼Œé‚£ä¹ˆå®ƒå¾ˆå¯èƒ½ä¼šå‘½ä¸­CPUç¼“å­˜ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªè®¿é—®å…·æœ‰å¤§çš„æ—¶é—´å’Œå¤§çš„ç©ºé—´é‡ç”¨è·ç¦»ï¼Œé‚£ä¹ˆå®ƒå¾ˆå¯èƒ½ä¼šé”™è¿‡CPUç¼“å­˜ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;&lt;a href=&#34;https://easyperf.net/img/posts/MemoryProfiling/ReuseDistanceHisto.png&#34;&gt;&lt;img src=&#34;https://easyperf.net/img/posts/MemoryProfiling/ReuseDistanceHisto.png&#34; alt=&#34;img&#34;&gt;&lt;/a&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;em&gt;å›¾9. é‡ç”¨è·ç¦»ç›´æ–¹å›¾çš„ç¤ºä¾‹ã€‚Xè½´æ˜¯é‡ç”¨è·ç¦»ï¼ŒYè½´æ˜¯å‘ç”Ÿç‡ã€‚&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å¤šå¹´æ¥å¼€å‘äº†ä¸€äº›è¯•å›¾åˆ†æç¨‹åºçš„æ—¶é—´å’Œç©ºé—´å±€éƒ¨æ€§çš„å·¥å…·ã€‚ä»¥ä¸‹æ˜¯ä¸‰ä¸ªæœ€æ–°çš„å·¥å…·åŠå…¶ç®€çŸ­æè¿°å’Œå½“å‰çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;loca&lt;/strong&gt;ï¼Œä¸€ä¸ªä½¿ç”¨PINäºŒè¿›åˆ¶æ’æ¡©å·¥å…·å®ç°çš„é‡ç”¨è·ç¦»åˆ†æå·¥å…·ã€‚å®ƒå¯ä»¥ä¸ºæ•´ä¸ªç¨‹åºæ‰“å°é‡ç”¨è·ç¦»ç›´æ–¹å›¾ï¼Œä½†ä¸èƒ½ä¸ºä¸ªåˆ«åŠ è½½æä¾›ç±»ä¼¼çš„åˆ†è§£ã€‚ç”±äºå®ƒä½¿ç”¨åŠ¨æ€äºŒè¿›åˆ¶æ’æ¡©ï¼Œå®ƒä¼šäº§ç”Ÿå·¨å¤§çš„è¿è¡Œæ—¶ï¼ˆçº¦50å€ï¼‰å’Œå†…å­˜ï¼ˆçº¦40å€ï¼‰å¼€é”€ï¼Œè¿™ä½¿å¾—è¯¥å·¥å…·åœ¨å®é™…åº”ç”¨ä¸­ä¸å®ç”¨ã€‚è¯¥å·¥å…·ä¸å†ç»´æŠ¤ï¼Œå¹¶ä¸”éœ€è¦å¯¹æºä»£ç è¿›è¡Œä¸€äº›ä¿®æ”¹æ‰èƒ½åœ¨æ–°å¹³å°ä¸Šå·¥ä½œã€‚&lt;a href=&#34;https://github.com/dcompiler/loca&#34;&gt;Githubä»“åº“&lt;/a&gt;, &lt;a href=&#34;https://doi.org/10.1145/2451116.2451153&#34;&gt;[LocaPaper]&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;RDX&lt;/strong&gt;ï¼Œåˆ©ç”¨ç¡¬ä»¶æ€§èƒ½è®¡æ•°å™¨é‡‡æ ·ä¸ç¡¬ä»¶è°ƒè¯•å¯„å­˜å™¨ç›¸ç»“åˆæ¥äº§ç”Ÿé‡ç”¨è·ç¦»ç›´æ–¹å›¾ã€‚ä¸&lt;code&gt;loca&lt;/code&gt;ç›¸æ¯”ï¼Œå®ƒåœ¨ä¿æŒ90%å‡†ç¡®æ€§çš„åŒæ—¶ï¼Œäº§ç”Ÿäº†ä¸€ä¸ªæ•°é‡çº§æ›´å°çš„å¼€é”€ã€‚è¯¥å·¥å…·ä¸å†ç»´æŠ¤ï¼Œå¹¶ä¸”å‡ ä¹æ²¡æœ‰å…³äºå¦‚ä½•ä½¿ç”¨è¯¥å·¥å…·çš„æ–‡æ¡£ã€‚&lt;a href=&#34;https://ieeexplore.ieee.org/document/8675243&#34;&gt;[RDXpaper]&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ReuseTracker&lt;/strong&gt;ï¼ŒåŸºäº&lt;code&gt;RDX&lt;/code&gt;æ„å»ºï¼Œä½†å®ƒé€šè¿‡è€ƒè™‘ç¼“å­˜ä¸€è‡´æ€§å’Œç¼“å­˜è¡Œå¤±æ•ˆæ•ˆåº”æ¥æ‰©å±•å®ƒã€‚ä½¿ç”¨è¿™ä¸ªå·¥å…·ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸€ä¸ªå°ç¨‹åºä¸Šäº§ç”Ÿæœ‰æ„ä¹‰çš„ç»“æœï¼Œç„¶è€Œï¼Œå®ƒè¿˜ä¸æ˜¯ç”Ÿäº§è´¨é‡ï¼Œå¹¶ä¸”ä¸å®¹æ˜“ä½¿ç”¨ã€‚&lt;a href=&#34;https://github.com/ParCoreLab/ReuseTracker&#34;&gt;Githubä»“åº“&lt;/a&gt;, &lt;a href=&#34;https://doi.org/10.1145/3484199&#34;&gt;[ReuseTrackerPaper]&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;èšåˆç¨‹åºä¸­æ‰€æœ‰å†…å­˜è®¿é—®çš„é‡ç”¨è·ç¦»åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½æœ‰ç”¨ï¼Œä½†æœªæ¥çš„åˆ†æå·¥å…·ä¹Ÿåº”è¯¥èƒ½å¤Ÿä¸ºä¸ªåˆ«åŠ è½½æä¾›é‡ç”¨è·ç¦»ç›´æ–¹å›¾ã€‚å¹¸è¿çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªåŠ è½½/å­˜å‚¨æ±‡ç¼–æŒ‡ä»¤éƒ½éœ€è¦å½»åº•åˆ†æã€‚æ€§èƒ½å·¥ç¨‹å¸ˆåº”è¯¥é¦–å…ˆä½¿ç”¨ä¼ ç»Ÿçš„æŠ½æ ·æ–¹æ³•æ‰¾åˆ°ä¸€ä¸ªæœ‰é—®é¢˜çš„åŠ è½½æˆ–å­˜å‚¨æŒ‡ä»¤ã€‚ä¹‹åï¼Œåº”è¯¥èƒ½å¤Ÿè¯·æ±‚è¯¥ç‰¹å®šæ“ä½œçš„æ—¶é—´å’Œç©ºé—´é‡ç”¨è·ç¦»ç›´æ–¹å›¾ã€‚è¿™åº”è¯¥æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ”¶é›†ï¼Œå› ä¸ºå®ƒå¯èƒ½æ¶‰åŠç›¸å¯¹è¾ƒå¤§çš„å¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;æ—¶é—´å’Œç©ºé—´å±€éƒ¨æ€§åˆ†ææä¾›äº†å¯ä»¥ç”¨æ¥æŒ‡å¯¼æ€§èƒ½ä¼˜åŒ–çš„ç‹¬ç‰¹è§è§£ã€‚ç„¶è€Œï¼Œä»”ç»†çš„å®ç°å¹¶ä¸ç®€å•ï¼Œä¸€æ—¦æˆ‘ä»¬å¼€å§‹è€ƒè™‘å„ç§ç¼“å­˜ä¸€è‡´æ€§æ•ˆåº”ï¼Œå¯èƒ½ä¼šå˜å¾—æ£˜æ‰‹ã€‚æ­¤å¤–ï¼Œå¤§çš„å¼€é”€å¯èƒ½ä¼šæˆä¸ºå°†æ­¤åŠŸèƒ½é›†æˆåˆ°ç”Ÿäº§åˆ†æå™¨ä¸­çš„éšœç¢ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å‚è€ƒé˜…è¯»&#34;&gt;å‚è€ƒé˜…è¯»&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;å†…å­˜å½’å±äºé‚£ä¸ªNUMA regionï¼Œredhat ä½¿ç”¨&lt;code&gt;numastat&lt;/code&gt; å·¥å…·è¿›è¡Œåˆ†æ &lt;a href=&#34;https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/monitoring_and_managing_system_status_and_performance/profiling-memory-allocation-with-numastat_monitoring-and-managing-system-status-and-performance&#34;&gt;Profiling memory allocation with numastat&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å…±äº«å†…å­˜æŸ¥çœ‹å·¥å…·ï¼š&lt;a href=&#34;https://datacadamia.com/os/linux/shared_memory&#34;&gt;shared_memory&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;å¤§é¡µç›¸å…³æ“ä½œåœ¨é™„å½•Cï¼š &lt;a href=&#34;https://github.com/dendibakh/perf-book/blob/main/chapters/18-Appendix/Appendix-C.md&#34;&gt;åŸæ–‡&lt;/a&gt; | &lt;a href=&#34;https://weedge.github.io/perf-book-cn/zh/chapters/18-Appendix/Appendix-C_cn.html&#34;&gt;ä¸­æ–‡ç¿»è¯‘&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
      
    </item>
    
    <item>
      <title>Performance Analysis and Tuning on Modern CPU ä¸­æ–‡ç¿»è¯‘</title>
      <link>https://weedge.github.io/post/book/performance-analysis-and-tuning-on-modern-cpu-cn/</link>
      <pubDate>Fri, 01 Mar 2024 01:16:30 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/book/performance-analysis-and-tuning-on-modern-cpu-cn/</guid>
      
        <description>&lt;h1 id=&#34;heading&#34;&gt;ğŸ“š&lt;/h1&gt;
&lt;p&gt;è¿™æ˜¯ä¸€æœ¬åä¸ºPerformance Analysis and Tuning on Modern CPUä¹¦ç±çš„&lt;a href=&#34;https://github.com/dendibakh/perf-book&#34;&gt;æºæ–‡ä»¶å­˜å‚¨åº“&lt;/a&gt;çš„ä¸­æ–‡ç¿»è¯‘ï¼ŒåŸç‰ˆç”± Denis Bakhvalov ç­‰äººç¼–å†™ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸç‰ˆç”µå­ä¹¦ï¼šhttps://book.easyperf.net/perf_book&lt;/li&gt;
&lt;li&gt;ä¸­æ–‡ç¿»è¯‘(ç¬¬ä¸€ç‰ˆ)ï¼šhttps://book.douban.com/subject/36243215/&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;åŸä½œè€…ç¬¬äºŒç‰ˆæ­£åœ¨è¿›è¡Œä¸­ï¼&lt;/strong&gt; è®¡åˆ’çš„æ›´æ”¹åœ¨è°·æ­Œ&lt;a href=&#34;https://docs.google.com/document/d/1tr2qRDe72VSBYypIANYjJLM_zCdPB6S9m4LmXsQb0vQ/edit?usp=sharing&#34;&gt;æ–‡æ¡£&lt;/a&gt;ä¸­è¿›è¡Œäº†æ¦‚è¿°ã€‚è®¡åˆ’ä¸­çš„æ–°ç›®å½•åœ¨ &lt;a href=&#34;https://github.com/dendibakh/perf-book/blob/main/new_toc.md&#34;&gt;new_toc.md&lt;/a&gt; ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç›®çš„&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è™½ç„¶å·²ç»æœ‰ç¿»è¯‘çš„ä¹¦ç±;ä½†æ˜¯æƒ³followæ›´æ–°,å€ŸåŠ© ã€chatGPTã€/ã€gemini/moonshot(kimi)ã€ ç¿»è¯‘æˆä¸­æ–‡ï¼Œ(åŠ é€Ÿå­¦ä¹ èŠ‚å¥ï¼ŒæŒæ¡ï¼Œå¹¶ä¸¾ä¸€åä¸‰)&lt;/li&gt;
&lt;li&gt;è‹±æ–‡æºä¹¦æ˜¯å¼€æºçš„ï¼Œç¿»è¯‘æˆä¸­æ–‡å·¥ä½œä¹ŸæŒç»­æ›´æ–°ï¼Œä¹Ÿæ˜¯å¼€æºçš„ï¼Œå¯ä»¥ä½œä¸ºå­¦ä¹ èµ„æ–™, åœ¨çº¿é˜…è¯»å¯ç¼–è¾‘ï¼Œå¸Œæœ›ä¸€èµ·å‚ä¸æ”¹è¿›ã€‚&lt;/li&gt;
&lt;li&gt;å¯¹æ¯ç« èŠ‚çš„å†…å®¹é€šè¿‡ ã€chatGPTã€/ã€gemini/moonshot(kimi)ã€ è¿›è¡Œå½’çº³æ€»ç»“ï¼Œç»“å·©å›ºçŸ¥è¯†ç‚¹ï¼Œå¹¶å¯¹è¯¾åç»ƒä¹ è¿›è¡Œå›ç­”,å¹¶éªŒè¯ç­”æ¡ˆã€‚&lt;/li&gt;
&lt;li&gt;æœ€åæ•´ä½“å‹˜è¯¯ï¼Œå®šæã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;[!TIP]&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆä¹‹ä»¥é±¼ä¸å¦‚æˆä¹‹ä»¥æ¸”, ä½¿ç”¨AIèµ‹èƒ½ã€‚&lt;/li&gt;
&lt;li&gt;æ€§èƒ½ä¼˜åŒ–åˆ†ææ•°æ®å¯ä»¥å€ŸåŠ©ã€chatGPTã€åˆ†æã€‚&lt;/li&gt;
&lt;li&gt;ã€chatGPTã€å’Œã€moonshot(kimi)ã€ ç¿»è¯‘æ•ˆæœå·®ä¸å¤š(ç›¸åŒçš„prompt)ï¼Œä½†æ˜¯å½“é—®æ–‡ä¸­çš„è§„åˆ’ç»ƒä¹ å’Œä»£ç ç»ƒä¹ æ—¶ï¼Œã€moonshot(kimi)ã€ä¸èƒ½ç†è§£é—®é¢˜ï¼Œä¸è¿‡é•¿æ–‡æœ¬ä¸Šä¼ æ ¹æ®ç« èŠ‚ç¿»è¯‘å’Œå½’çº³æ€»ç»“ä¸é”™ï¼Œæ¯•ç«Ÿä¸ç”¨ç¿»å¢™å°±å¯ä»¥ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;åœ¨çº¿é˜…è¯»åœ°å€&lt;/strong&gt;: &lt;a href=&#34;https://weedge.github.io/perf-book-cn/zh/&#34;&gt;https://weedge.github.io/perf-book-cn/zh/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸­æ–‡ç‰ˆPDF(æ¨è)&lt;/strong&gt;: &lt;a href=&#34;https://raw.githubusercontent.com/weedge/perf-book-cn/main/perf-book-cn.pdf&#34;&gt;https://raw.githubusercontent.com/weedge/perf-book-cn/main/perf-book-cn.pdf&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;å­¦ä¹ èµ„æ–™&#34;&gt;å­¦ä¹ èµ„æ–™&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/dendibakh/perf-ninja&#34;&gt;https://github.com/dendibakh/perf-ninja&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=2tzdkC6IDbo&amp;amp;list=PLRWO2AL1QAV6bJAU2kgB4xfodGID43Y5d&#34;&gt;https://www.youtube.com/watch?v=2tzdkC6IDbo&amp;amp;list=PLRWO2AL1QAV6bJAU2kgB4xfodGID43Y5d&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç°ä»£cpuå¾®æ¶æ„(ä¹¦ä¸­ç¬¬ä¸€ç« å¾®æ¶æ„å†…å®¹)ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=vgPFzblBh7w&#34;&gt;Architecture All Access: Modern CPU Architecture Part 1 â€“ Key Concepts | Intel Technology&lt;/a&gt;&lt;/p&gt;

&lt;div style=&#34;position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;&#34;&gt;
  &lt;iframe src=&#34;https://www.youtube.com/embed/vgPFzblBh7w&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;&#34; allowfullscreen title=&#34;YouTube Video&#34;&gt;&lt;/iframe&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=o_WXTRS2qTY&#34;&gt;Architecture All Access: Modern CPU Architecture 2 - Microarchitecture Deep Dive &lt;/a&gt; | &lt;a href=&#34;https://www.bilibili.com/video/BV1a2421M7Tz/&#34;&gt;bilibili&lt;/a&gt;&lt;/p&gt;

&lt;div style=&#34;position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;&#34;&gt;
  &lt;iframe src=&#34;https://www.youtube.com/embed/o_WXTRS2qTY&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;&#34; allowfullscreen title=&#34;YouTube Video&#34;&gt;&lt;/iframe&gt;
&lt;/div&gt;

&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;[!TIP]&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ–‡ç« ä¸­çš„&lt;code&gt;pandoc markdown&lt;/code&gt;æ ‡ç­¾gitbookæœªèƒ½è¯†åˆ«ï¼Œæš‚æœªæ‰¾åˆ°pandocæ’ä»¶, ä¸å½±å“æ•´ä½“é˜…è¯». (pandocå·¥å…·ä¸»è¦æ˜¯ç”¨æ¥ç”Ÿæˆç¦»çº¿PDFç”µå­ä¹¦, gitbooké€‚åˆåœ¨çº¿é˜…è¯»)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://pandoc.org/MANUAL.html&#34;&gt;pandoc&lt;/a&gt; é€šè¿‡bibtexç”Ÿæˆå¼•ç”¨æ ·å¼: &lt;a href=&#34;https://github.com/citation-style-language/styles&#34;&gt;citation-style-language(CSL)-styles&lt;/a&gt;, å¯ä» &lt;a href=&#34;https://www.zotero.org/styles&#34;&gt;Zotero Style å®˜ç½‘&lt;/a&gt; æŒ‘é€‰éœ€è¦æ ·å¼ä¸‹è½½&lt;/li&gt;
&lt;li&gt;ç¿»è¯‘çš„&lt;a href=&#34;https://github.com/dendibakh/perf-book&#34;&gt;æºæ–‡ä»¶å­˜å‚¨åº“&lt;/a&gt;å¯¹åº”çš„commit: &lt;a href=&#34;https://github.com/dendibakh/perf-book/commit/5ddfadc9c292b7dbac4d868e7a25b9a6ea3648c8&#34;&gt;5ddfadc&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;é€šè¿‡&lt;code&gt;pandoc&lt;/code&gt;ç”Ÿæˆlatexæºæ–‡ä»¶ï¼Œå…·ä½“è®¾ç½®è§ï¼š&lt;a href=&#34;https://github.com/weedge/perf-book/blob/feat/cn/export_book_zh.py&#34;&gt;https://github.com/weedge/perf-book/blob/feat/cn/export_book_zh.py&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;[!NOTE]&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨å†™ä»£ç æ—¶æˆ–å¤šæˆ–å°‘ä¼šçŸ¥é“ä¸€äº›ä»£ç å±‚æ¬¡(æ¯”å¦‚c++)çš„ä¼˜åŒ–ï¼Œä½†å¯èƒ½ä¸çŸ¥é“ä¸ºå•¥æ˜¯è¿™æ ·çš„ï¼Œè¿™æœ¬ä¹¦ç»“åˆcpuè®²è§£äº†ç›¸å…³åŸç†(æ¯”å¦‚&lt;code&gt;unlikely&lt;/code&gt;,&lt;code&gt;likely&lt;/code&gt;)ã€‚&lt;/li&gt;
&lt;li&gt;æœ¨æ¡¶æ•ˆåº”ï¼Œé€šè¿‡ç›‘æ§æµ‹é‡åˆ†æï¼Œå¯»æ‰¾æ€§èƒ½çŸ­æ¿åœ¨å“ªï¼Œç»“åˆåœºæ™¯å¯¹ç—‡ä¸‹è¯(ç†è§£å·¥ä½œåŸç†)&lt;/li&gt;
&lt;li&gt;äº†è§£ç°ä»£cpuå¾®ä½“ç³»æ¶æ„(æœ¬æ–‡ä¸­æåˆ°çš„ Intel GoldenCove æ¶æ„ç™½çš®ä¹¦&lt;a href=&#34;https://github.com/weedge/perf-book-cn/tree/main/zh/chapters//References.md#IntelOptimizationManual&#34;&gt;@IntelOptimizationManual&lt;/a&gt;), ä»¥å°è§å¤§, è®¾è®¡æ€è·¯å€Ÿé‰´åˆ°ä¸šåŠ¡ç³»ç»Ÿä¸­(è™½ç„¶æœ‰äº›è¯¦ç»†ä¿¡æ¯æœªå…¬å¼€)&lt;/li&gt;
&lt;li&gt;AMDå¤„ç†å™¨ &lt;a href=&#34;https://github.com/weedge/perf-book-cn/tree/main/zh/chapters/References.md#AMDProgrammingManual&#34;&gt;@AMDProgrammingManual&lt;/a&gt; ; ARM Neoverse V1å¤„ç†å™¨ &lt;a href=&#34;https://github.com/weedge/perf-book-cn/tree/main/zh/chapters/References.md#ARMNeoverseV1&#34;&gt;@ARMNeoverseV1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä¹¦ä¸­ä¸€äº›caseä»‹ç»äº†ä¼˜åŒ–å·¥å…·çš„ä½¿ç”¨å’Œæ€§èƒ½åˆ†æ&lt;/li&gt;
&lt;li&gt;é˜…è¯»æœ¬ä¹¦ä¸éœ€è¦è¯¦ç»†äº†è§£æ¯ä¸ªæ€§èƒ½åˆ†æå·¥å…·çš„ä½¿ç”¨(æ¯”å¦‚å¸¸ç”¨çš„&lt;code&gt;perf&lt;/code&gt;)ï¼Œä¸»è¦æ˜¯é’ˆå¯¹cpuç‰¹æ€§,memoryçš„æ€§èƒ½åˆ†æï¼›åªè¦è®°ä½æœ‰è¿™ä¸ªå·¥å…·å¹²å•¥ç”¨çš„ï¼Œå½“é‡åˆ°æ€§èƒ½åˆ†æåœºæ™¯æ—¶ï¼Œå¯ä»¥å†æ¬¡æŸ¥é˜…è¯¥å·¥å…·çš„ä½¿ç”¨æ–¹æ³•å³å¯ï¼›ä¸»è¦æ˜¯ç»“åˆå·¥å…·å»å®è·µæ€»ç»“æ–¹æ³•è®ºã€‚&lt;/li&gt;
&lt;li&gt;æœ¬ä¹¦æ˜¯é’ˆå¯¹ç°ä»£CPUçš„æ€§èƒ½åˆ†æå’Œä¼˜åŒ–ï¼›å‰ææ¡ä»¶æ˜¯åº”ç”¨ç¨‹åºå·²ç»æ¶ˆé™¤æ‰€æœ‰ä¸»è¦æ€§èƒ½é—®é¢˜ï¼›å¦‚æœæƒ³æ›´æ·±å±‚æ¬¡ä¼˜åŒ–(æ¯”å¦‚åº•å±‚å­˜å‚¨ç³»ç»Ÿ, æµé‡è¯·æ±‚æœ€ç»ˆæ±‡èšç‚¹ç³»ç»Ÿ,æ ¸å¿ƒç³»ç»Ÿç­‰)ï¼Œå¯ä»¥ä½¿ç”¨ CPU æ€§èƒ½ç›‘æ§åŠŸèƒ½æ¥åˆ†æå’Œè¿›ä¸€æ­¥è°ƒæ•´åº”ç”¨ç¨‹åºã€‚ä»…å½“æ‰€æœ‰é«˜çº§æ€§èƒ½é—®é¢˜éƒ½å·²ä¿®å¤åï¼Œæ‰å»ºè®®ä½¿ç”¨ç¡¬ä»¶åŠŸèƒ½è¿›è¡Œä½çº§å¾®è°ƒã€‚åœ¨è®¾è®¡ä¸è‰¯çš„ç®—æ³•ç³»ç»Ÿä¸Šè¿›è¡Œcpuåˆ†æè°ƒä¼˜åªæ˜¯æ—¶é—´ä¸Šçš„æµªè´¹ã€‚&lt;/li&gt;
&lt;li&gt;åº•å±‚ç¡¬ä»¶çš„æŒç»­æ€§èƒ½åˆ†æ(CP)åœ¨IaaS/PaaSäº‘æœåŠ¡ä¼ä¸šä¸­å¸¸è§ã€‚&lt;/li&gt;
&lt;li&gt;å»¶ä¼¸é˜…è¯»ï¼š&lt;a href=&#34;https://www.brendangregg.com/systems-performance-2nd-edition-book.html&#34;&gt;brendangregg-systems-performance&lt;/a&gt; | &lt;a href=&#34;https://www.brendangregg.com/bpf-performance-tools-book.html&#34;&gt;brendangregg-bpf-performance&lt;/a&gt; å¿…å¤‡æ€§èƒ½åˆ†æå·¥å…·ä¹¦(å‡½æ–¹æ³•è®ºå®è·µ)&lt;/li&gt;
&lt;li&gt;åˆ©ç”¨äººå·¥æ™ºèƒ½å’Œ LLM å¯å‘æ¶æ„æ¥å¤„ç†æ€§èƒ½åˆ†ææ ·æœ¬ï¼Œåˆ†æ
å‡½æ•°ä¹‹é—´å…³ç³»ï¼Œæœ€ç»ˆé«˜ç²¾åº¦åœ°æ‰¾å‡ºç›´æ¥å½±å“æ•´ä½“ååé‡å’Œå»¶è¿Ÿçš„å‡½æ•°å’Œåº“ã€‚&lt;a href=&#34;https://raven.io/&#34;&gt;Raven.io&lt;/a&gt;æä¾›è¿™ç§åŠŸèƒ½çš„ä¸€å®¶å…¬å¸&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/weedge/perf-book-cn/tree/main/zh/chapters/8-Optimizing-Memory-Accesses/8-0_Source_Code_Tuning_For_CPU_cn.md&#34;&gt;æºä»£ç ä¼˜åŒ–ç« èŠ‚&lt;/a&gt;é‡ç‚¹æŒæ¡&lt;/li&gt;
&lt;li&gt;ç¼–è¯‘é“¾æ¥å±‚é¢é™æ€åˆ†æï¼Œé€šè¿‡ä¼˜åŒ–æŠ¥å‘Š(æ¯”å¦‚: GCCçš„&lt;a href=&#34;https://gcc.gnu.org/onlinedocs/gcc/Developer-Options.html#index-fopt-info&#34;&gt;&lt;code&gt;-fopt-info&lt;/code&gt;&lt;/a&gt;;clangä½¿ç”¨&lt;a href=&#34;https://llvm.org/docs/Vectorizers.html#diagnostics&#34;&gt;&lt;code&gt;-Rpass*&lt;/code&gt;&lt;/a&gt;)æ¥è·å–ä¼˜åŒ–å»ºè®®(éœ€è¦å®è·µæµ‹è¯•)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PGO&lt;/strong&gt; &lt;a href=&#34;https://github.com/weedge/perf-book-cn/blob/main/zh/chapters/11-Machine-Code-Layout-Optimizations/11-7_PGO_cn.md&#34;&gt;åŸºäºæ€§èƒ½åˆ†æå¼•å¯¼çš„ä¼˜åŒ–ï¼ˆProfile Guided Optimizationsï¼‰&lt;/a&gt; ç»ƒä¹ : &lt;a href=&#34;https://github.com/dendibakh/perf-ninja/blob/main/labs/misc/pgo/README.md&#34;&gt;https://github.com/dendibakh/perf-ninja/blob/main/labs/misc/pgo/README.md&lt;/a&gt; (PGO ä¸»è¦ç”¨äºå…·æœ‰å¤§å‹ä»£ç åº“çš„é¡¹ç›®ï¼Œæ¯”å¦‚ï¼šæ•°æ®åº“ï¼Œåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ); ç‰¹åœ°åœºæ™¯ï¼Œè°¨æ…åˆ†æé…ç½®å¼•å¯¼ä¼˜åŒ–(å¯ç»„åˆ)ã€‚&lt;/li&gt;
&lt;li&gt;å……åˆ†è€ƒè™‘åˆ°æ—¶é—´å±€éƒ¨æ€§å’Œç©ºé—´å±€éƒ¨æ€§å¯¹æ€§èƒ½çš„å½±å“&lt;/li&gt;
&lt;li&gt;å°½é‡åšæ‰©å±•é˜…è¯»ï¼Œæ¯”å¦‚ä½œè€…çš„åšå®¢æ–‡ç« ï¼Œç›¸å…³å¼•ç”¨(æ¯”å¦‚ï¼š&lt;a href=&#34;https://github.com/weedge/perf-book-cn/tree/main/zh/chapters/References.md#fogOptimizeCpp&#34;&gt;@fogOptimizeCpp&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;å¯¹äºcpuæ€§èƒ½ä¼˜åŒ–ï¼Œæœ‰äº›å·²åœ¨ç¼–è¯‘å™¨å±‚é¢è¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ¯”å¦‚æœºå™¨ä»£ç å¸ƒå±€&lt;/li&gt;
&lt;li&gt;å…³æ³¨&lt;a href=&#34;https://github.com/weedge/perf-book-cn/tree/main/zh/chapters/12-Other-Tuning-Areas/12-4_Low-Latency-Tuning-Techniques_cn.md&#34;&gt;ä½å»¶è¿Ÿç³»ç»Ÿçš„æ€§èƒ½ä¼˜åŒ–&lt;/a&gt; (æ¯”å¦‚HFTç³»ç»Ÿä¸­çš„è¿™ä¸ªå¿«é€Ÿæ¼”è®²ï¼š&lt;a href=&#34;https://www.youtube.com/watch?v=XzRxikGgaHI&#34;&gt;CppCon 2018: Jonathan Keinan â€œCache Warming: Warm Up The Codeâ€&lt;/a&gt;; è¿™äº›å…³é”®è·¯å¾„ä»£ç å€¼é’±)&lt;/li&gt;
&lt;li&gt;ä¼˜åŒ–å¤šçº¿ç¨‹åº”ç”¨:
&lt;ol&gt;
&lt;li&gt;å€ŸåŠ©å¯è§†åŒ–åˆ†æå·¥å…·è¿›è¡Œåˆ†æå®šä½æ€§èƒ½ç“¶é¢ˆ(åŒæ­¥äº‹ä»¶ï¼Œé”ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢)ï¼Œä¹¦ä¸­ä¸¾äº†ä¸€äº›case, Intel VTune Profiler è¿™ä¸ªå·¥å…·å¯¹äºä½œè€…æ¥è¯´ç»å¸¸ä½¿ç”¨ï¼Œ ç±»ä¼¼GPUæ€§èƒ½åˆ†æå·¥å…· &lt;a href=&#34;https://docs.nvidia.com/nsight-compute/ProfilingGuide/index.html&#34;&gt;nsight-compute&lt;/a&gt; (é€šè¿‡&lt;a href=&#34;https://docs.nvidia.com/nsight-systems/UserGuide/index.html&#34;&gt;nsight-systems&lt;/a&gt;åˆ†æç³»ç»Ÿæ•´ä½“æ€§èƒ½è€—æ—¶)ï¼›&lt;/li&gt;
&lt;li&gt;é€šè¿‡eBPFè¿½è¸ªå†…æ ¸ä¸­ futex ç³»ç»Ÿè°ƒç”¨çš„æ‰§è¡Œï¼ˆå†…æ ¸é€šè¿‡ futex ç³»ç»Ÿè°ƒç”¨æ”¯æŒçº¿ç¨‹åŒæ­¥åŸè¯­ - äº’æ–¥é”ã€ä¿¡å·é‡ã€æ¡ä»¶å˜é‡ç­‰ï¼‰ï¼Œä»æ¶‰åŠçš„çº¿ç¨‹ä¸­æ”¶é›†æœ‰ç”¨çš„å…ƒæ•°æ®&lt;/li&gt;
&lt;li&gt;å°½é‡é¿å…çœŸå…±äº«ä¸‹çš„æ•°æ®ç«äº‰é—®é¢˜ï¼Œé€šè¿‡ç¼–è¯‘å™¨é›†æˆçš„ sanitizers å·¥å…·æ¥è¯†åˆ«ï¼Œæ¯”å¦‚Clang &lt;a href=&#34;https://clang.llvm.org/docs/ThreadSanitizer.html&#34;&gt;Thread sanitizer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;é¿å…ä¼ªå…±äº«ã€‚ç”±äºå¤šæ ¸å¤„ç†å™¨cpuä¹‹é—´ç‹¬ç«‹çš„L1/L2 cacheï¼Œä¼šå‡ºç°cache lineä¸ä¸€è‡´çš„é—®é¢˜ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ç›¸å…³åè®®æ¨¡å‹ï¼Œå¸¸ç”¨MESIåè®®ï¼ŒMESI é€šè¿‡ è¿™ä¸ªç½‘ç«™æ¨¡æ‹Ÿæ›´ç›´è§‚çš„äº†è§£ &lt;a href=&#34;https://www.scss.tcd.ie/Jeremy.Jones/VivioJS/caches/MESIHelp.htm&#34;&gt;https://www.scss.tcd.ie/Jeremy.Jones/VivioJS/caches/MESIHelp.htm&lt;/a&gt; ï¼›ä¸ºäº†ä¿è¯ä¸€ä¸ªcoreä¸Šä¿®æ”¹çš„cache lineæ•°æ®åŒæ­¥åˆ°å…¶ä»–coreçš„cache lineä¸Šï¼Œåˆ™éœ€è¦MESIåè®®æ¥ä¿è¯ï¼Œå¦‚æœåŒä¸€ä¸ªcache lineä¸Šæœ‰ä¸ªä¸¤ä¸ªå˜é‡sum1 å’Œ sum2 ä¹‹é—´è™½ç„¶æ²¡æœ‰ç›¸äº’ä¾èµ–é€»è¾‘ï¼Œä½†æ˜¯å½“ä¿®æ”¹sum1 æˆ–è€…sum2 æ—¶ï¼Œéœ€è¦åŒæ­¥åŒä¸€å—cache lineçš„å†…å®¹ï¼Œå¯¼è‡´ å³ä½¿æ²¡æœ‰ç›¸äº’å…³ç³»çš„å˜é‡åœ¨åŒä¸€cache lineä¸­ï¼Œ éœ€è¦å½¼æ­¤å…±äº«åŒæ­¥ï¼Œä»è€Œå‡ºç°æ‰€è¯´çš„ä¼ªå…±äº« flase sharingã€‚ä¼ªå…±äº«å› ä¸ºcache lineçš„åŒæ­¥ä¼šå¸¦æ¥ä¸€äº›cpu æ—¶é’Ÿå‘¨æœŸçš„æ€§èƒ½æŸå¤±ã€‚&lt;/li&gt;
&lt;li&gt;æ·±å…¥äº†è§£å¹¶è¡Œç¼–ç¨‹ï¼š &lt;a href=&#34;https://mirrors.edge.kernel.org/pub/linux/kernel/people/paulmck/perfbook/perfbook.html&#34;&gt;Is Parallel Programming Hard, And, If So, What Can You Do About It?&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;[!TIP]
ç”±äºå¤šæ ¸å¤„ç†å™¨cpuä¹‹é—´ç‹¬ç«‹çš„L1/L2 cacheï¼Œä¼šå‡ºç°cache lineä¸ä¸€è‡´çš„é—®é¢˜ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ç›¸å…³åè®®æ¨¡å‹ï¼Œæ¯”å¦‚MESIåè®®æ¥ä¿è¯cacheæ•°æ®ä¸€è‡´ï¼ŒåŒæ—¶ç”±äºCPUå¯¹ã€Œç¼“å­˜ä¸€è‡´æ€§åè®®ã€è¿›è¡Œçš„å¼‚æ­¥ä¼˜åŒ–ï¼Œå¯¹å†™å’Œè¯»åˆ†åˆ«å¼•å…¥äº†ã€Œstore bufferã€å’Œã€Œinvalid queueã€ï¼Œå¾ˆå¯èƒ½å¯¼è‡´åé¢çš„æŒ‡ä»¤æŸ¥ä¸åˆ°å‰é¢æŒ‡ä»¤çš„æ‰§è¡Œç»“æœï¼ˆå„ä¸ªæŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºéä»£ç æ‰§è¡Œé¡ºåºï¼‰ï¼Œè¿™ç§ç°è±¡å¾ˆå¤šæ—¶å€™è¢«ç§°ä½œã€ŒCPUä¹±åºæ‰§è¡Œã€ï¼Œä¸ºäº†è§£å†³ä¹±åºé—®é¢˜ï¼ˆä¹Ÿå¯ä»¥ç†è§£ä¸ºå¯è§æ€§é—®é¢˜ï¼Œä¿®æ”¹å®Œæ²¡æœ‰åŠæ—¶åŒæ­¥åˆ°å…¶ä»–çš„CPUï¼‰ï¼Œåˆå¼•å‡ºäº†ã€Œå†…å­˜å±éšœã€çš„æ¦‚å¿µï¼›å†…å­˜å±éšœå¯ä»¥åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼šå†™å±éšœï¼Œè¯»å±éšœä»¥åŠå…¨èƒ½å±éšœï¼ˆåŒ…å«äº†è¯»å†™å±éšœï¼‰ï¼Œå±éšœå¯ä»¥ç®€å•ç†è§£ä¸ºï¼šåœ¨æ“ä½œæ•°æ®çš„æ—¶å€™ï¼Œå¾€æ•°æ®æ’å…¥ä¸€æ¡â€ç‰¹æ®Šçš„æŒ‡ä»¤â€ã€‚åªè¦é‡åˆ°è¿™æ¡æŒ‡ä»¤ï¼Œé‚£å‰é¢çš„æ“ä½œéƒ½å¾—ã€Œå®Œæˆã€ã€‚CPUå½“å‘ç°å†™å±éšœæŒ‡ä»¤æ—¶ï¼Œä¼šæŠŠè¯¥æŒ‡ä»¤ã€Œä¹‹å‰ã€å­˜åœ¨äºã€Œstore Bufferã€æ‰€æœ‰å†™æŒ‡ä»¤åˆ·å…¥é«˜é€Ÿç¼“å­˜ã€‚å°±å¯ä»¥è®©CPUä¿®æ”¹çš„æ•°æ®é©¬ä¸Šæš´éœ²ç»™å…¶ä»–CPUï¼Œè¾¾åˆ°ã€Œå†™æ“ä½œã€å¯è§æ€§çš„æ•ˆæœã€‚è¯»å±éšœä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼šCPUå½“å‘ç°è¯»å±éšœçš„æŒ‡ä»¤æ—¶ï¼Œä¼šæŠŠè¯¥æŒ‡ä»¤ã€Œä¹‹å‰ã€å­˜åœ¨äºã€Œinvalid queueã€æ‰€æœ‰çš„æŒ‡ä»¤éƒ½å¤„ç†æ‰ã€‚é€šè¿‡è¿™ç§æ–¹å¼å°±å¯ä»¥ç¡®ä¿å½“å‰CPUçš„ç¼“å­˜çŠ¶æ€æ˜¯å‡†ç¡®çš„ï¼Œè¾¾åˆ°ã€Œè¯»æ“ä½œã€ä¸€å®šæ˜¯è¯»å–æœ€æ–°çš„æ•ˆæœã€‚ç”±äºä¸åŒCPUæ¶æ„çš„ç¼“å­˜ä½“ç³»ä¸ä¸€æ ·ã€ç¼“å­˜ä¸€è‡´æ€§åè®®ä¸ä¸€æ ·ã€é‡æ’åºçš„ç­–ç•¥ä¸ä¸€æ ·ã€æ‰€æä¾›çš„å†…å­˜å±éšœæŒ‡ä»¤ä¹Ÿæœ‰å·®å¼‚ï¼Œæ‰€ä»¥ä¸€äº›è¯­è¨€c++/java/go/rust éƒ½æœ‰å®ç°è‡ªå·±çš„å†…å­˜æ¨¡å‹, æ¯”å¦‚ golangå¤§ç‰›Russ Coxå†™çš„å†…å­˜æ¨¡å‹ç³»åˆ—æ–‡ç«  &lt;strong&gt;Memory Models&lt;/strong&gt;: &lt;a href=&#34;https://research.swtch.com/mm&#34;&gt;https://research.swtch.com/mm&lt;/a&gt; å€¼å¾—æ·±å…¥äº†è§£&lt;/p&gt;
&lt;/blockquote&gt;</description>
      
    </item>
    
    <item>
      <title>é€å»çš„å¥¶å¥¶</title>
      <link>https://weedge.github.io/post/nainai/</link>
      <pubDate>Fri, 02 Feb 2024 00:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/nainai/</guid>
      
        <description>&lt;iframe frameborder=&#34;no&#34; border=&#34;0&#34; marginwidth=&#34;0&#34; marginheight=&#34;0&#34; width=330 height=86 src=&#34;//music.163.com/outchain/player?type=2&amp;id=32574246&amp;auto=1&amp;height=66&#34;&gt;&lt;/iframe&gt;



&lt;blockquote&gt;
&lt;p&gt;å¤©ä¸Šçš„æ¯ä¸€é¢—æ˜Ÿ éƒ½æ˜¯çˆ±è¿‡æˆ‘ä»¬çš„äºº&lt;/p&gt;
&lt;p&gt;å¬è¯´ï¼Œåœ°ä¸Šå°‘ä¸ªäººï¼Œå¤©ä¸Šå¤šé¢—æ˜Ÿï¼Œæ¯ä¸€é¢—é—ªçƒçš„æ˜Ÿæ˜Ÿéƒ½åœ¨è·Ÿåœ°ä¸Šçš„äº²äººè¯´è¯ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ„¿ï¼Œä»Šå¤œæœ‰æ˜Ÿã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ„¿ï¼Œæ˜Ÿæ˜Ÿä¼šé—ªã€‚&lt;/p&gt;
&lt;p&gt;&amp;ndash; äººç”Ÿå¤§äº‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç®€å•è¸å®å°±å¥½ï¼Œå¥¶å¥¶ç»å¸¸ç»™è¯´çš„è¯ï¼Œä¸€ç›´è®°ç€ã€‚ã€step by step, æ‡‚å¾—çæƒœã€‘&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>æ„å»ºä¸€ä¸ªç®€å•çš„æ•°æ®åº“[golangç‰ˆ]</title>
      <link>https://weedge.github.io/post/db_tutorial_go/</link>
      <pubDate>Wed, 10 Jan 2024 10:58:28 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/db_tutorial_go/</guid>
      
        <description>&lt;p&gt;ä¸Šç¯‡æ–‡ç« ä½¿ç”¨chatGPTç¿»è¯‘äº†&lt;a href=&#34;https://cstack.github.io/db_tutorial/&#34;&gt;db_tutorial&lt;/a&gt; æ–‡ç« ï¼Œæ–‡ä¸­ä½¿ç”¨çš„æ˜¯cè¯­è¨€å¼€å‘ï¼› è¿™ç¯‡æ–‡ç« ä½¿ç”¨chatGPTæ ¹æ®db_tutorialä¸­çš„cæºç ï¼Œä½¿ç”¨golangè¿›è¡Œé‡å†™, æµ‹è¯•çš„rubyä»£ç ä½¿ç”¨pythonè¿›è¡Œé‡å†™ï¼›åŒç†å…¶ä»–è¯­è¨€ä¹Ÿé€‚ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨ï¼šåˆ©ç”¨å·²æœ‰çŸ¥è¯†ç»“æ„ï¼Œé€šè¿‡chatGPTæ¥ç”Ÿæˆå¦ä¸€ç§è¡¨è¾¾(ç°å®ä¸­è¿™ç§è½¬æ¢ç»å¸¸å‡ºç°ï¼Œæ¯”å¦‚ä¸€ä¸ªåŸºç¡€çŸ¥è¯†ç‚¹ï¼Œåš¼ç¢äº†ï¼Œæ‰çƒ‚äº†ï¼Œåº•å±‚ç›¸é€šï¼Œè¡¨è¾¾æ–¹å¼ä¸åŒï¼Œå˜äº†ä¸ªèŠ±æ ·ç©ï¼Œè€Œä¸”è¿˜èƒ½é€šè¿‡è®¤çŸ¥å·®æ¥ç›ˆåˆ©ï¼Œä¹Ÿè®¸ç²¾ç»†åˆ©å·±ä¸»ä¹‰ä¼šåˆ©ç›Šæœ€å¤§åŒ–å§)ï¼Œä½¿ç”¨AGIå·¥å…·è¿›è¡Œæ•ˆç‡ç¼–ç çš„ä¸€ç§å°å°å®è·µã€‚åœ¨å®è·µè¿‡ç¨‹ä¸­ï¼ŒchatGPTç”Ÿæˆçš„ä»£ç ä¸å¯èƒ½éƒ½èƒ½æ­£å¸¸è¿è¡Œï¼Œéœ€è¦è°ƒè¯•ä¸‹(ç‰¹åˆ«æ˜¯æŒ‡é’ˆæ“ä½œ)ã€‚&lt;/p&gt;
&lt;p&gt;æ•´ä½“å®ç°ä»£ç ï¼šhttps://github.com/weedge/baby-db/tree/main/golang&lt;/p&gt;
&lt;p&gt;ä¸»è¦çš„btreeæ•°æ®ç»“æ„ä¸ºleafNode å’Œ internalNodeï¼Œå¶å­èŠ‚ç‚¹è¡¨æ•°æ®å­˜æ”¾åœ¨valueä¸­ï¼Œidå­˜æ”¾åœ¨keyä¸­ï¼Œåºåˆ—åŒ–å’Œéå†æ“ä½œéœ€è¦é¢å¤–åç§»æ“ä½œï¼›è¿™é‡Œä»…å®ç°ç®€å•çš„insertå’Œselectæ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/leaf-node-format.png&#34; alt=&#34;leafNode&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/internal-node-format.png&#34; alt=&#34;internalNode&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬ä¸€éƒ¨åˆ†---ç®€ä»‹å’Œè®¾ç½®repl&#34;&gt;ç¬¬ä¸€éƒ¨åˆ† - ç®€ä»‹å’Œè®¾ç½®REPL&lt;/h2&gt;
&lt;p&gt;åˆ¶ä½œä¸€ä¸ªç®€å•çš„ REPL(Read-Eval-Print Loop) golang ç‰ˆæœ¬&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;bufio&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;os&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;strings&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;bufferLength&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;bufferLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printPrompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// chatGPT init error, need to debug
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;//reader := bufio.NewReader(os.Stdin)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ReadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sc&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error reading input: &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrimSuffix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;closeInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewReader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Stdin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printPrompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nf&#34;&gt;closeInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;.\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œç»“æœï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;go run golang/1.go
db &amp;gt; .tables
Unrecognized &lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;.tables&amp;#39;&lt;/span&gt;.
db &amp;gt; .exit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬äºŒéƒ¨åˆ†---ä¸–ç•Œä¸Šæœ€ç®€å•çš„sqlç¼–è¯‘å™¨å’Œè™šæ‹Ÿæœº&#34;&gt;ç¬¬äºŒéƒ¨åˆ† - ä¸–ç•Œä¸Šæœ€ç®€å•çš„SQLç¼–è¯‘å™¨å’Œè™šæ‹Ÿæœº&lt;/h2&gt;
&lt;p&gt;golang ç‰ˆæœ¬&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;bufio&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;os&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;strings&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;bufferLength&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;bufferLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printPrompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// chatGPT init error, need to debug
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;//reader := bufio.NewReader(os.Stdin)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ReadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sc&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error reading input: &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrimSuffix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;doMetaCommand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HasPrefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;This is where we would do an insert.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;This is where we would do a select.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewReader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Stdin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printPrompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;sc&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;doMetaCommand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized keyword at start of &amp;#39;%s&amp;#39;.\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;nf&#34;&gt;executeStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œç»“æœï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;go run golang/2.go
db &amp;gt; insert foo bar
This is where we would &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; an insert.
Executed.
db &amp;gt;
db &amp;gt; delete foo
Unrecognized keyword at start of &lt;span class=&#34;s1&#34;&gt;&amp;#39;delete foo&amp;#39;&lt;/span&gt;.
db &amp;gt; &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;
This is where we would &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; a &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;.
Executed.
db &amp;gt; .tables
Unrecognized &lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;.tables&amp;#39;&lt;/span&gt;
db &amp;gt; .exit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬ä¸‰éƒ¨åˆ†---å†…å­˜ä¸­è¿½åŠ æ–¹å¼å•è¡¨æ•°æ®åº“&#34;&gt;ç¬¬ä¸‰éƒ¨åˆ† - å†…å­˜ä¸­ã€è¿½åŠ æ–¹å¼ã€å•è¡¨æ•°æ®åº“&lt;/h2&gt;
&lt;p&gt;golang ç‰ˆæœ¬&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;bufio&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;os&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;strings&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;unsafe&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;bufferLength&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;255&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt;        &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//only used by insert statement
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;         &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}))&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{}))&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4096&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;TABLE_MAX_ROWS&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;(%d, %s, %s)\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrimRight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:]),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\x00&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrimRight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:]),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\x00&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;serializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))[:])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;deserializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;rowSlot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rowOffset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;byteOffset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowOffset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;byteOffset&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;byteOffset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newTable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;freeTable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;doMetaCommand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;closeInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;freeTable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;BytesToString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;SliceData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;StringToBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;StringData&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Slice&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;p&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;b&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;HasPrefix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt;
		&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
		&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// chatGPT generate code, need debug
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;c1&#34;&gt;//argsAssigned, _ := fmt.Sscanf(inputBuffer.buffer, &amp;#34;insert %d %s %s&amp;#34;, &amp;amp;statement.rowToInsert.id, &amp;amp;statement.rowToInsert.username, &amp;amp;statement.rowToInsert.email)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;argsAssigned&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Sscanf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert %d %s %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;argsAssigned&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;StringToBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
		&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;StringToBytes&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TABLE_MAX_ROWS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Errorf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error: Table full.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;

	&lt;span class=&#34;nf&#34;&gt;serializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;rowSlot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeSelect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;deserializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;rowSlot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Type&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;executeSelect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;closeInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printPrompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// chatGPT init error, need to debug
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;//reader := bufio.NewReader(os.Stdin)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ReadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sc&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error reading input: &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrimSuffix&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newTable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewReader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Stdin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printPrompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;sc&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;doMetaCommand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Syntax error. Could not parse statement.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized keyword at start of &amp;#39;%s&amp;#39;\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œç»“æœï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;go run golang/3.go
db &amp;gt; insert &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; cstack foo@bar.com
Executed.
db &amp;gt; insert &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; bob bob@example.com
Executed.
db &amp;gt; &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;1, cstack, foo@bar.com&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;2, bob, bob@example.com&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
Executed.
db &amp;gt; insert foo bar &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
Syntax error. Could not parse statement.
db &amp;gt; .exit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬å››éƒ¨åˆ†---æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæµ‹è¯•bug&#34;&gt;ç¬¬å››éƒ¨åˆ† - æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæµ‹è¯•ï¼ˆBugï¼‰&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨golangé‡å†™:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;bufio&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;os&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;strconv&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;strings&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;unsafe&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;255&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;              &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;           &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;            &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;         &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;             &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;            &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4096&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;TABLE_MAX_ROWS&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;bufferLength&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;stmtType&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newTable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;(%d, %s, %s)\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrimRight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:]),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\x00&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrimRight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:]),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\x00&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;serializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))[:])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;deserializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;rowSlot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rowOffset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;byteOffset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowOffset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;byteOffset&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;byteOffset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printPrompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// chatGPT init error, need to debug
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;//reader := bufio.NewReader(os.Stdin)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ReadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sc&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error reading input: &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// Remove newline character
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrimSpace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;closeInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// Go has automatic garbage collection, so no explicit freeing is needed
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;doMetaCommand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;closeInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stmtType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fields&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strconv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Atoi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fields&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stmtType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_ROWS&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;

	&lt;span class=&#34;nf&#34;&gt;serializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;rowSlot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeSelect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;deserializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;rowSlot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;stmtType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeSelect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newTable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewReader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Stdin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printPrompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;sc&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;doMetaCommand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ID must be positive.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;String is too long.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Syntax error. Could not parse statement.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized keyword at start of &amp;#39;%s&amp;#39;.\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error: Table full.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æµ‹è¯•å‘½ä»¤pipe: &lt;code&gt;util.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commands&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bin_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;./db&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;raw_output&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;None&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;with&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;subprocess&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Popen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bin_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stdin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;subprocess&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PIPE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stdout&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;subprocess&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PIPE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;process&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;command&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;commands&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
            &lt;span class=&#34;n&#34;&gt;process&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stdin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;command&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;process&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stdin&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;raw_output&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;process&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stdout&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;raw_output&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;splitlines&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨pythoné‡å†™æµ‹è¯•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;subprocess&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;sys&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;util&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# æµ‹è¯•æ’å…¥å’ŒæŸ¥è¯¢&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test_inserts_and_retrieves_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 1 user1 person1@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; (1, user1, person1@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;#print(f&amp;#34;result: {result}&amp;#34;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Test failed&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_getframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f_code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;co_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; passed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Run the test&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;test_inserts_and_retrieves_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# æ•°æ®åº“ç°åœ¨å¯ä»¥å®¹çº³1400è¡Œï¼Œå› ä¸ºæˆ‘ä»¬å°†æœ€å¤§é¡µé¢æ•°è®¾ç½®ä¸º100ï¼Œå¹¶ä¸”ä¸€é¡µå¯ä»¥å®¹çº³14è¡Œã€‚&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# æµ‹è¯•è¡¨å·²æ»¡çš„æƒ…å†µ&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test_prints_error_message_when_table_is_full&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;insert &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; user&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; person&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;@example.com&amp;#34;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1402&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Error: Table full.&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Test failed&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_getframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f_code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;co_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; passed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Run the test&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;test_prints_error_message_when_table_is_full&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;


&lt;span class=&#34;c1&#34;&gt;# æµ‹è¯•å…è®¸æ’å…¥æœ€å¤§é•¿åº¦çš„å­—ç¬¦ä¸²ã€‚&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test_allows_inserting_strings_that_are_maximum_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;long_username&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;a&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;long_email&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;a&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;255&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 1 &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_username&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_email&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; (1, &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_username&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;, &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_email&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Test failed&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_getframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f_code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;co_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; passed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Run the test&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;test_allows_inserting_strings_that_are_maximum_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;


&lt;span class=&#34;c1&#34;&gt;# æµ‹è¯•å¦‚æœå­—ç¬¦ä¸²å¤ªé•¿ï¼Œåˆ™ä¼šæ‰“å°é”™è¯¯æ¶ˆæ¯ã€‚&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test_prints_error_message_if_strings_are_too_long&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;long_username&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;a&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;33&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;long_email&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;a&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;256&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 1 &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_username&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_email&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; String is too long.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Test failed&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_getframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f_code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;co_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; passed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# Run the test&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;test_prints_error_message_if_strings_are_too_long&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# å½“å°è¯•æ’å…¥å¸¦æœ‰è´Ÿ ID çš„è¡Œæ—¶æ‰“å°é”™è¯¯ä¿¡æ¯&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test_negative_id_error_message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert -1 cstack foo@bar.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;expected_output&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; ID must be positive.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;expected_output&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Expected: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;expected_output&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;, but got: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_getframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f_code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;co_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; passed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;test_negative_id_error_message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;

&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;all tests passed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬äº”éƒ¨åˆ†---æŒä¹…åŒ–åˆ°ç£ç›˜&#34;&gt;ç¬¬äº”éƒ¨åˆ† - æŒä¹…åŒ–åˆ°ç£ç›˜&lt;/h2&gt;
&lt;p&gt;æµ‹è¯•ç”¨ä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;os&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;util&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# æµ‹è¯•æ•°æ®åº“å…³é—­åï¼Œæ•°æ®æ˜¯å¦åœ¨æ•°æ®åº“ä¸­&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test_keeps_data_after_closing_connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 1 user1 person1@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;result2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;#print(f&amp;#34;result2: {result2}&amp;#34;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; (1, user1, person1@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_getframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f_code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;co_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; passed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;need db file path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;test_keeps_data_after_closing_connection&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;all tests passed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æŒä¹…åŒ– golangç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;bufio&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;io&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;os&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;strconv&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;strings&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;unsafe&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;255&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;              &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;           &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;            &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;         &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;             &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;            &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4096&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;TABLE_MAX_ROWS&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;bufferLength&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;typ&lt;/span&gt;         &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;File&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;          &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;bufferLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;//fmt.Printf(&amp;#34;(%d, %s, %s)\n&amp;#34;, row.id, row.username, row.email)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;(%d, %s, %s)\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrimRight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:]),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\x00&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrimRight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:]),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\x00&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;serializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))[:])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;deserializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to fetch page number out of bounds. %d &amp;gt; %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Seek&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SEEK_SET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error seeking: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

			&lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EOF&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error reading file: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;rowSlot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rowOffset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;byteOffset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowOffset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;byteOffset&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;byteOffset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pagerOpen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;OpenFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;O_RDWR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;O_CREATE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mo&#34;&gt;0644&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unable to open file: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Seek&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SEEK_END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error seeking: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dbOpen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pagerOpen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pagerFlush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to flush null page\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Seek&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SEEK_SET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error seeking: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Seek offset does not match page start\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error writing: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dbClose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;numFullPages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numFullPages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;pagerFlush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;numAdditionalRows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numAdditionalRows&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numFullPages&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nf&#34;&gt;pagerFlush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numAdditionalRows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error closing db file: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printPrompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// chatGPT init error, need to debug
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;//reader := bufio.NewReader(os.Stdin)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ReadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sc&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error reading input: &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;c1&#34;&gt;// Ignore newline character
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;closeInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;doMetaCommand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;closeInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;dbClose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;typ&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fields&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strconv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Atoi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fields&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;typ&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_ROWS&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;

	&lt;span class=&#34;nf&#34;&gt;serializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;rowSlot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeSelect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;deserializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;rowSlot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;typ&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeSelect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Must supply a database filename.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dbOpen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewReader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Stdin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printPrompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;sc&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;doMetaCommand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ID must be positive.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;String is too long.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Syntax error. Could not parse statement.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized keyword at start of &amp;#39;%s&amp;#39;.\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error: Table full.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;go run golang/5.go test.db       
db &amp;gt; &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;
Executed.
db &amp;gt; insert &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; ab &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt;
Executed.
db &amp;gt; &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;1, ab, &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
Executed.
db &amp;gt; .exit
go run golang/5.go test.db
db &amp;gt; &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;1, ab, &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
Executed.
db &amp;gt; .exit
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬å…­éƒ¨åˆ†---æ¸¸æ ‡æŠ½è±¡&#34;&gt;ç¬¬å…­éƒ¨åˆ† - æ¸¸æ ‡æŠ½è±¡&lt;/h2&gt;
&lt;p&gt;golangå®ç°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;bufio&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;io&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;os&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;strconv&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;strings&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;unsafe&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;255&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;              &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;           &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;            &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;         &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;             &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;            &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4096&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;TABLE_MAX_ROWS&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;bufferLength&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;typ&lt;/span&gt;         &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;File&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;          &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;   &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ä¹‹åçš„ä½ç½®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;bufferLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;//fmt.Printf(&amp;#34;(%d, %s, %s)\n&amp;#34;, row.id, row.username, row.email)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;(%d, %s, %s)\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrimRight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:]),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\x00&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrimRight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:]),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\x00&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;serializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))[:])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;deserializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to fetch page number out of bounds. %d &amp;gt; %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Seek&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SEEK_SET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error seeking: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

			&lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EOF&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error reading file: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tableStart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tableEnd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cursorValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rowOffset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;byteOffset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowOffset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;byteOffset&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;byteOffset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cursorAdvance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pagerOpen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;OpenFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;O_RDWR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;O_CREATE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mo&#34;&gt;0644&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unable to open file: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Seek&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SEEK_END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error seeking: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dbOpen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pagerOpen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;   &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pagerFlush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to flush null page\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Seek&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SEEK_SET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error seeking: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Seek offset does not match page start\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error writing: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dbClose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;numFullPages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numFullPages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;pagerFlush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;numAdditionalRows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numAdditionalRows&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numFullPages&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nf&#34;&gt;pagerFlush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numAdditionalRows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error closing db file: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printPrompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// chatGPT init error, need to debug
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;//reader := bufio.NewReader(os.Stdin)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ReadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sc&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error reading input: &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;c1&#34;&gt;// Ignore newline character
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;closeInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;doMetaCommand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;closeInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;dbClose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;typ&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fields&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strconv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Atoi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fields&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;typ&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_ROWS&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tableEnd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nf&#34;&gt;serializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cursorValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numRows&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeSelect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tableStart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;deserializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;cursorValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;cursorAdvance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;typ&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeSelect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Must supply a database filename.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dbOpen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewReader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Stdin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printPrompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;sc&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;doMetaCommand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ID must be positive.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;String is too long.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Syntax error. Could not parse statement.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized keyword at start of &amp;#39;%s&amp;#39;.\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error: Table full.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨åŸæ¥ç« èŠ‚çš„æµ‹è¯•ç”¨ä¾‹&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬å…«éƒ¨åˆ†---b-treeå¶èŠ‚ç‚¹æ ¼å¼&#34;&gt;ç¬¬å…«éƒ¨åˆ† - B-Treeå¶èŠ‚ç‚¹æ ¼å¼&lt;/h2&gt;
&lt;p&gt;python æµ‹è¯•ç”¨ä¾‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;os&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;util&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# æµ‹è¯•btreeç»“æ„&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test_one_node_btree_structure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 3 user3 person3@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 1 user1 person1@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 2 user2 person2@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.btree&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Tree:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;leaf (size 3)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - 0 : 3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - 1 : 1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - 2 : 2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;

    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;result: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_getframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f_code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;co_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; passed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;


&lt;span class=&#34;c1&#34;&gt;# æµ‹è¯•æ‰“å°å¸¸é‡&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test_print_constants&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.constants&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Constants:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ROW_SIZE: 293&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;COMMON_NODE_HEADER_SIZE: 6&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;LEAF_NODE_HEADER_SIZE: 10&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;LEAF_NODE_CELL_SIZE: 297&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;LEAF_NODE_SPACE_FOR_CELLS: 4086&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;LEAF_NODE_MAX_CELLS: 13&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_getframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f_code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;co_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; passed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;need db file path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;test_one_node_btree_structure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;test_print_constants&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;all tests passed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;golangå®ç° ï¼ˆæ— åºæ–¹å¼å­˜å‚¨é”®ï¼‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;bufio&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;io&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;os&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;strconv&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;strings&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;unsafe&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;255&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;              &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;           &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;            &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;         &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;             &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;            &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4096&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NodeType&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint8&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;NODE_INTERNAL&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NodeType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;NODE_LEAF&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// Common Node Header Layout
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;NODE_TYPE_SIZE&lt;/span&gt;          &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;NODE_TYPE_OFFSET&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;IS_ROOT_SIZE&lt;/span&gt;            &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;IS_ROOT_OFFSET&lt;/span&gt;          &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_TYPE_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_TYPE_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PARENT_POINTER_SIZE&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PARENT_POINTER_OFFSET&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;IS_ROOT_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;IS_ROOT_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_TYPE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;IS_ROOT_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PARENT_POINTER_SIZE&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// Leaf Node Header Layout
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_NUM_CELLS_SIZE&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_NUM_CELLS_OFFSET&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_NUM_CELLS_SIZE&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// Leaf Node Body Layout
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_KEY_SIZE&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_KEY_OFFSET&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_VALUE_SIZE&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_VALUE_OFFSET&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_KEY_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_KEY_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_KEY_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_VALUE_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_SPACE_FOR_CELLS&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_SPACE_FOR_CELLS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;bufferLength&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;typ&lt;/span&gt;         &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;File&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;          &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ä¹‹åçš„ä½ç½®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;bufferLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_NUM_CELLS_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_KEY_SIZE&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_VALUE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printConstants&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ROW_SIZE: %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;COMMON_NODE_HEADER_SIZE: %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_HEADER_SIZE: %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_CELL_SIZE: %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_SPACE_FOR_CELLS: %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_SPACE_FOR_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_MAX_CELLS: %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printLeafNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;leaf (size %d)\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;  - %d : %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;//fmt.Printf(&amp;#34;(%d, %s, %s)\n&amp;#34;, row.id, row.username, row.email)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;(%d, %s, %s)\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrimRight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:]),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\x00&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrimRight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:]),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\x00&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;serializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))[:])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;deserializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;initializeLeafNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to fetch page number out of bounds. %d &amp;gt; %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Seek&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SEEK_SET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error seeking: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

			&lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EOF&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error reading file: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tableStart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;rootNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tableEnd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;rootNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cursorValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cursorAdvance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pagerOpen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;OpenFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;O_RDWR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;O_CREATE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mo&#34;&gt;0644&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unable to open file: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Seek&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SEEK_END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error seeking: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Db file is not a whole number of pages. Corrupt file.\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dbOpen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pagerOpen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// New database file. Initialize page 0 as leaf node.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;rootNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;initializeLeafNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pagerFlush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to flush null page\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Seek&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SEEK_SET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error seeking: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Seek offset does not match page start\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error writing: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dbClose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;pagerFlush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error closing db file: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printPrompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// chatGPT init error, need to debug
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;//reader := bufio.NewReader(os.Stdin)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ReadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sc&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error reading input: &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;c1&#34;&gt;// Ignore newline character
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;closeInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;doMetaCommand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;closeInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;dbClose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.btree&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tree:\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printLeafNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.constants&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Constants:\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printConstants&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;typ&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fields&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strconv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Atoi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fields&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;typ&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// Node full
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Need to implement splitting a leaf node.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// Make room for new cell
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;
	&lt;span class=&#34;nf&#34;&gt;serializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tableEnd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nf&#34;&gt;leafNodeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeSelect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tableStart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;deserializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;cursorValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;cursorAdvance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;typ&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeSelect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Must supply a database filename.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dbOpen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewReader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Stdin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printPrompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;sc&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;doMetaCommand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ID must be positive.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;String is too long.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Syntax error. Could not parse statement.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized keyword at start of &amp;#39;%s&amp;#39;.\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error: Table full.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬ä¹éƒ¨åˆ†---äºŒåˆ†æœç´¢å’Œé‡å¤é”®&#34;&gt;ç¬¬ä¹éƒ¨åˆ† - äºŒåˆ†æœç´¢å’Œé‡å¤é”®&lt;/h2&gt;
&lt;p&gt;golangå®ç°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;main&lt;/span&gt;

&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;bufio&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;fmt&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;io&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;os&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;strconv&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;strings&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;s&#34;&gt;&amp;#34;unsafe&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;255&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;              &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;           &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;            &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;         &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;             &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;            &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4096&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NodeType&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint8&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;NODE_INTERNAL&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NodeType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;NODE_LEAF&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// Common Node Header Layout
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;NODE_TYPE_SIZE&lt;/span&gt;          &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;NODE_TYPE_OFFSET&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;IS_ROOT_SIZE&lt;/span&gt;            &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;IS_ROOT_OFFSET&lt;/span&gt;          &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_TYPE_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_TYPE_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PARENT_POINTER_SIZE&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PARENT_POINTER_OFFSET&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;IS_ROOT_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;IS_ROOT_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_TYPE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;IS_ROOT_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PARENT_POINTER_SIZE&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// Leaf Node Header Layout
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_NUM_CELLS_SIZE&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_NUM_CELLS_OFFSET&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_NUM_CELLS_SIZE&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;// Leaf Node Body Layout
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_KEY_SIZE&lt;/span&gt;        &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_KEY_OFFSET&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_VALUE_SIZE&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_VALUE_OFFSET&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_KEY_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_KEY_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_KEY_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_VALUE_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_SPACE_FOR_CELLS&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_SPACE_FOR_CELLS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;bufferLength&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;typ&lt;/span&gt;         &lt;span class=&#34;nx&#34;&gt;StatementType&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;File&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt;       &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;          &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ä¹‹åçš„ä½ç½®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;iota&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;EXECUTE_DUPLICATE_KEY&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;bufferLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;  &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_NUM_CELLS_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_KEY_SIZE&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_VALUE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printConstants&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ROW_SIZE: %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;COMMON_NODE_HEADER_SIZE: %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_HEADER_SIZE: %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_CELL_SIZE: %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_SPACE_FOR_CELLS: %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_SPACE_FOR_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_MAX_CELLS: %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printLeafNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;leaf (size %d)\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;  - %d : %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;//fmt.Printf(&amp;#34;(%d, %s, %s)\n&amp;#34;, row.id, row.username, row.email)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;(%d, %s, %s)\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrimRight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:]),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\x00&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;TrimRight&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:]),&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;\x00&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;serializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))[:])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;deserializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;ID_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NodeType&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;NodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NODE_TYPE_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;setNodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nodeType&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;NODE_TYPE_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;nodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;initializeLeafNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nf&#34;&gt;setNodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_LEAF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to fetch page number out of bounds. %d &amp;gt; %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// Cache miss. Allocate memory and load from file.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;make&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;

		&lt;span class=&#34;c1&#34;&gt;// We might save a partial page at the end of the file
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Seek&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SEEK_SET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error seeking: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

			&lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EOF&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error reading file: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tableStart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;rootNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeFind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;c1&#34;&gt;// Binary search
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;minIndex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;onePastMaxIndex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;onePastMaxIndex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;minIndex&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;minIndex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;onePastMaxIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;keyAtIndex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;keyAtIndex&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;keyAtIndex&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;onePastMaxIndex&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;minIndex&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;minIndex&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tableFind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;rootNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;nodeType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nodeType&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_LEAF&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeFind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Need to implement searching an internal node&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cursorValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cursorAdvance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pagerOpen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;OpenFile&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;O_RDWR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;O_CREATE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mo&#34;&gt;0644&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unable to open file: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Seek&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SEEK_END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error seeking: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;     &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;fileLength&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;%&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Db file is not a whole number of pages. Corrupt file.\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dbOpen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pagerOpen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// New database file. Initialize page 0 as leaf node.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;rootNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;initializeLeafNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pagerFlush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to flush null page\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Seek&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;SEEK_SET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error seeking: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Seek offset does not match page start\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;_&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;][:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error writing: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dbClose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;pagerFlush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;fileDescriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error closing db file: %v\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printPrompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;c1&#34;&gt;// chatGPT init error, need to debug
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;//reader := bufio.NewReader(os.Stdin)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ReadString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sc&#34;&gt;&amp;#39;\n&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error reading input: &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;c1&#34;&gt;// Ignore newline character
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;	&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;closeInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;doMetaCommand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;closeInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;dbClose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.btree&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tree:\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printLeafNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.constants&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Constants:\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printConstants&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;typ&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fields&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strconv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Atoi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
	&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:],&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Fields&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;tokens&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;typ&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// Node full
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Need to implement splitting a leaf node.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;c1&#34;&gt;// Make room for new cell
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;		&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
	&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;
	&lt;span class=&#34;nf&#34;&gt;serializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;keyToInsert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tableFind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;keyToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;keyAtIndex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;keyAtIndex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;keyToInsert&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_DUPLICATE_KEY&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nf&#34;&gt;leafNodeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rowToInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeSelect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tableStart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;deserializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;cursorValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;cursorAdvance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;typ&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;STATEMENT_SELECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeSelect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Must supply a database filename.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;dbOpen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

	&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;newInputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
	&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;NewReader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Stdin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
	&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;printPrompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
		&lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;sc&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;doMetaCommand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
				&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
				&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
			&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;Statement&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepareStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ID must be positive.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;String is too long.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Syntax error. Could not parse statement.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized keyword at start of &amp;#39;%s&amp;#39;.\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
			&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

		&lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;executeStatement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error: Table full.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_DUPLICATE_KEY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
			&lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error: Duplicate key.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
		&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
	&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬åéƒ¨åˆ†---åˆ†è£‚å¶å­èŠ‚ç‚¹&#34;&gt;ç¬¬åéƒ¨åˆ† - åˆ†è£‚å¶å­èŠ‚ç‚¹&lt;/h2&gt;
&lt;p&gt;æµ‹è¯•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;os&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;util&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# æµ‹è¯•btreeæœ‰åºç»“æ„&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test_btree_order_structure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 3 user3 person3@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 1 user1 person1@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 2 user2 person2@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.btree&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Tree:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;- leaf (size 3)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - 1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - 2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - 3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;

    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;result: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_getframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f_code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;co_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; passed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# æµ‹è¯•æ‰“å°3ä¸ªå¶å­èŠ‚ç‚¹çš„btree&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test_print_structure_of_3_leaf_node_btree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;insert &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; user&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; person&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;@example.com&amp;#34;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;.btree&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 15 user15 person15@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is_remove&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Tree:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;- internal (size 1)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - leaf (size 7)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 4&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 5&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 6&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 7&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - key 7&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - leaf (size 7)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 8&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 9&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 10&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 11&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 12&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 13&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 14&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Need to implement searching an internal node&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;

    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;result: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_getframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f_code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;co_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; passed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;need db file path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; exists, remove it first&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;test_btree_order_structure&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;test_print_structure_of_3_leaf_node_btree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;all tests passed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;diff golang/9.go golang/10.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;mi&#34;&gt;62&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a63&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;84&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;&amp;gt;  * Leaf Node Split
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;&amp;gt;  */&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_RIGHT_SPLIT_COUNT&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_LEFT_SPLIT_COUNT&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_RIGHT_SPLIT_COUNT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;&amp;gt;  * Internal Node Header Layout
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;&amp;gt;  */&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_NUM_KEYS_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_NUM_KEYS_OFFSET&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_RIGHT_CHILD_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_RIGHT_CHILD_OFFSET&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_NUM_KEYS_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_NUM_KEYS_SIZE&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_NUM_KEYS_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_RIGHT_CHILD_SIZE&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;&amp;gt;  * Internal Node Body Layout
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;&amp;gt;  */&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_KEY_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_CHILD_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_CELL_SIZE&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_CHILD_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_KEY_SIZE&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;mi&#34;&gt;168&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;173&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c190&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;192&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printLeafNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;leaf (size %d)\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;  - %d : %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;indent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;level&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;  &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;199&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a219&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;239&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;isNodeRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IS_ROOT_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;setNodeRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isRoot&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;isRoot&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IS_ROOT_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;IS_ROOT_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_NUM_KEYS_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_RIGHT_CHILD_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;201&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a242&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;246&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_CELL_SIZE&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;mi&#34;&gt;203&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a249&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nf&#34;&gt;setNodeRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;206&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a253&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;258&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;initializeInternalNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nf&#34;&gt;setNodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_INTERNAL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nf&#34;&gt;setNodeRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;mi&#34;&gt;243&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a296&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;341&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childNum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to access childNum %d &amp;gt; numKeys %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;keyNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;keyNum&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_CELL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_CHILD_SIZE&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;printTree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indentationLevel&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_LEAF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;indent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indentationLevel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;- leaf (size %d)\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nf&#34;&gt;indent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indentationLevel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;- %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_INTERNAL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;indent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indentationLevel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;- internal (size %d)\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nf&#34;&gt;printTree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indentationLevel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nf&#34;&gt;indent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indentationLevel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;- key %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;printTree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indentationLevel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;358&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a457&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;setNodeRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;445&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c544&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;printLeafNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;printTree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;499&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a599&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;616&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_INTERNAL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_LEAF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;c1&#34;&gt;// Handle other node types if needed
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// or appropriate default value
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getUnusedPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numPages&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;501&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a619&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;683&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createNewRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rightChildPageNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;//rightChild := getPage(table.pager, rightChildPageNum)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;leftChildPageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getUnusedPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;leftChildPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// Left child gets data copied from the old root
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nf&#34;&gt;setNodeRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// Root becomes a new internal node with one key and two children
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nf&#34;&gt;initializeInternalNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nf&#34;&gt;setNodeRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;leftChildPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;leftChildMaxKey&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;leftChildMaxKey&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rightChildPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹å¹¶å°†ä¸€åŠå•å…ƒæ ¼ç§»åŠ¨è¿‡å»ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸­çš„ä¸€ä¸ªä¸­æ’å…¥æ–°å€¼ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ›´æ–°çˆ¶èŠ‚ç‚¹æˆ–åˆ›å»ºä¸€ä¸ªæ–°çš„çˆ¶èŠ‚ç‚¹ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeSplitAndInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;newPageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getUnusedPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;newNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nf&#34;&gt;initializeLeafNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;&amp;gt;         æ‰€æœ‰ç°æœ‰é”®ä»¥åŠæ–°é”®åº”è¯¥å‡åŒ€åˆ†å¸ƒ
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;&amp;gt;         åœ¨æ—§ï¼ˆå·¦ï¼‰å’Œæ–°ï¼ˆå³ï¼‰èŠ‚ç‚¹ä¹‹é—´ã€‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;&amp;gt;         ä»å³ä¾§å¼€å§‹ï¼Œå°†æ¯ä¸ªé”®ç§»åŠ¨åˆ°æ­£ç¡®çš„ä½ç½®ã€‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;&amp;gt;       */&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;destinationNode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_LEFT_SPLIT_COUNT&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;destinationNode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newNode&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;destinationNode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;indexWithinNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_LEFT_SPLIT_COUNT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destinationNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexWithinNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nf&#34;&gt;serializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))[:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))[:&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;cm&#34;&gt;/* åœ¨ä¸¤ä¸ªå¶å­èŠ‚ç‚¹ä¸Šæ›´æ–°å•å…ƒæ ¼è®¡æ•° */&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_LEFT_SPLIT_COUNT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_RIGHT_SPLIT_COUNT&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;isNodeRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;createNewRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Need to implement updating parent after split&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;mi&#34;&gt;507&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;509&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c689&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;690&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;c1&#34;&gt;// Node full
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Need to implement splitting a leaf node.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;leafNodeSplitAndInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;527&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;529&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d707&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬åä¸€éƒ¨åˆ†---é€’å½’æœç´¢-b-æ ‘&#34;&gt;ç¬¬åä¸€éƒ¨åˆ† - é€’å½’æœç´¢ B æ ‘&lt;/h2&gt;
&lt;p&gt;æµ‹è¯•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;os&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;util&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# æµ‹è¯•æ‰“å°3ä¸ªå¶å­èŠ‚ç‚¹çš„btree&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test_print_structure_of_3_leaf_node_btree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;insert &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; user&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; person&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;@example.com&amp;#34;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;.btree&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 15 user15 person15@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Tree:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;- internal (size 1)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - leaf (size 7)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 4&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 5&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 6&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 7&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - key 7&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - leaf (size 7)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 8&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 9&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 10&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 11&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 12&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 13&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 14&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;

    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;result: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_getframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f_code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;co_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; passed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# æ•°æ®åº“ç°åœ¨å¯ä»¥å®¹çº³1400è¡Œï¼Œå› ä¸ºæˆ‘ä»¬å°†æœ€å¤§é¡µé¢æ•°è®¾ç½®ä¸º100ï¼Œå¹¶ä¸”ä¸€é¡µå¯ä»¥å®¹çº³14è¡Œã€‚&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# æµ‹è¯•è¡¨å·²æ»¡çš„æƒ…å†µ&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test_prints_error_message_when_table_is_full&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;insert &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; user&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; person&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;@example.com&amp;#34;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1402&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is_remove&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; 
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Need to implement updating parent after split&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;result: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Test failed&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_getframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f_code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;co_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; passed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;


&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;need db file path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; exists, remove it first&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;test_print_structure_of_3_leaf_node_btree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;test_prints_error_message_when_table_is_full&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;all tests passed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;diff golang/10.go golang/11.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;mi&#34;&gt;383&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a384&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;391&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeFind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// Binary search to find index of child to search
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;minIndex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;maxIndex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// there is one more child than key
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;384&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a393&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;416&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;minIndex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;maxIndex&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;minIndex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;maxIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;keyToRight&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;keyToRight&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;maxIndex&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;minIndex&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;childNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;minIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_LEAF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeFind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_INTERNAL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeFind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;c1&#34;&gt;// Handle other node types if needed
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;nil&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;mi&#34;&gt;393&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;394&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c425&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Need to implement searching an internal node&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeFind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬åäºŒéƒ¨åˆ†---æ‰«æå¤šå±‚-b-æ ‘&#34;&gt;ç¬¬åäºŒéƒ¨åˆ† - æ‰«æå¤šå±‚ B æ ‘&lt;/h2&gt;
&lt;p&gt;æµ‹è¯•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;os&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;util&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test_prints_all_rows_in_multi_level_tree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;insert &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; user&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; person&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;expected_output&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; (1, user1, person1@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;(2, user2, person2@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;(3, user3, person3@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;(4, user4, person4@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;(5, user5, person5@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;(6, user6, person6@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;(7, user7, person7@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;(8, user8, person8@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;(9, user9, person9@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;(10, user10, person10@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;(11, user11, person11@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;(12, user12, person12@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;(13, user13, person13@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;(14, user14, person14@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;(15, user15, person15@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;result: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;expected_output&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_getframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f_code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;co_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; passed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# æµ‹è¯•æ‰“å°å¸¸é‡&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test_print_constants&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.constants&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Constants:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;ROW_SIZE: 293&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;COMMON_NODE_HEADER_SIZE: 6&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;LEAF_NODE_HEADER_SIZE: 14&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;LEAF_NODE_CELL_SIZE: 297&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;LEAF_NODE_SPACE_FOR_CELLS: 4082&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;LEAF_NODE_MAX_CELLS: 13&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_getframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f_code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;co_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; passed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;need db file path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; exists, remove it first&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;test_prints_all_rows_in_multi_level_tree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;test_print_constants&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;all tests passed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;diff golang/11.go golang/12.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;mi&#34;&gt;49&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c49&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;51&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_NUM_CELLS_SIZE&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_NEXT_LEAF_SIZE&lt;/span&gt;   &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_NEXT_LEAF_OFFSET&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_NUM_CELLS_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_NUM_CELLS_SIZE&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_NUM_CELLS_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;LEAF_NODE_NEXT_LEAF_SIZE&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;178&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a181&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;184&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeNextLeaf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;LEAF_NODE_NEXT_LEAF_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;250&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a257&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNextLeaf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// 0 è¡¨ç¤ºæ— å…„å¼ŸèŠ‚ç‚¹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;341&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;349&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d347&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tableStart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;      &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;    &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;351&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;356&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d348&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;rootNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;441&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c433&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;441&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;cm&#34;&gt;/* å‰è¿›åˆ°ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹ */&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;nextPageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNextLeaf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nextPageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;cm&#34;&gt;/* è¿™æ˜¯æœ€å³è¾¹çš„å¶å­èŠ‚ç‚¹ */&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;nextPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cellNum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;678&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a679&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;680&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNextLeaf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNextLeaf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNextLeaf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newPageNum&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;696&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c698&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;699&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;                       &lt;span class=&#34;nf&#34;&gt;serializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nf&#34;&gt;serializeRow&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leafNodeValue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destinationNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexWithinNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destinationNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indexWithinNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;754&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a758&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;766&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tableStart&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Cursor&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;tableFind&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;endOfTable&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬åä¸‰éƒ¨åˆ†---åˆ†è£‚å¶å­èŠ‚ç‚¹åæ›´æ–°çˆ¶èŠ‚ç‚¹&#34;&gt;ç¬¬åä¸‰éƒ¨åˆ† - åˆ†è£‚å¶å­èŠ‚ç‚¹åæ›´æ–°çˆ¶èŠ‚ç‚¹&lt;/h2&gt;
&lt;p&gt;æµ‹è¯•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;os&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;util&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# æ•°æ®åº“ç°åœ¨å¯ä»¥å®¹çº³1400è¡Œï¼Œå› ä¸ºæˆ‘ä»¬å°†æœ€å¤§é¡µé¢æ•°è®¾ç½®ä¸º100ï¼Œå¹¶ä¸”ä¸€é¡µå¯ä»¥å®¹çº³14è¡Œã€‚&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# æµ‹è¯•è¡¨å·²æ»¡çš„æƒ…å†µ&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test_prints_error_message_when_table_is_full&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;insert &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; user&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; person&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;@example.com&amp;#34;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1402&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is_remove&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; 
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Need to implement splitting internal node&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;result: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;expected_result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Test failed&amp;#34;&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_getframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f_code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;co_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; passed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# æµ‹è¯•4ä¸ªå¶å­èŠ‚ç‚¹çš„B+æ ‘çš„ç»“æ„&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test_prints_structure_of_4_leaf_node_btree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 18 user18 person18@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 7 user7 person7@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 10 user10 person10@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 29 user29 person29@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 23 user23 person23@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 4 user4 person4@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 14 user14 person14@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 30 user30 person30@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 15 user15 person15@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 26 user26 person26@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 22 user22 person22@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 19 user19 person19@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 2 user2 person2@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 1 user1 person1@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 21 user21 person21@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 11 user11 person11@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 6 user6 person6@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 20 user20 person20@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 5 user5 person5@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 8 user8 person8@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 9 user9 person9@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 3 user3 person3@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 12 user12 person12@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 27 user27 person27@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 17 user17 person17@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 16 user16 person16@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 13 user13 person13@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 24 user24 person24@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 25 user25 person25@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 28 user28 person28@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.btree&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;expected_output&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Tree:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;- internal (size 3)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - leaf (size 7)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 4&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 5&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 6&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 7&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - key 7&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - leaf (size 8)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 8&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 9&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 10&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 11&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 12&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 13&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 14&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 15&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - key 15&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - leaf (size 7)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 16&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 17&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 18&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 19&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 20&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 21&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 22&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - key 22&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - leaf (size 8)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 23&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 24&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 25&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 26&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 27&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 28&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 29&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - 30&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;

    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;result: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;expected_output&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_getframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f_code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;co_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; passed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;


&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;need db file path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; exists, remove it first&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;test_prints_error_message_when_table_is_full&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;test_prints_structure_of_4_leaf_node_btree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;all tests passed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;diff golang/12.go golang/13.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;mi&#34;&gt;85&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a86&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_MAX_CELLS&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;184&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a186&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;189&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;PARENT_POINTER_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]))&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;319&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a325&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;399&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// è¿”å›åº”åŒ…å«ç»™å®šé”®çš„å­èŠ‚ç‚¹çš„ç´¢å¼•ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeFindChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// Binary search
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;minIndex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;maxIndex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// there is one more child than key
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;minIndex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;maxIndex&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;minIndex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;maxIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;keyToRight&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;keyToRight&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;maxIndex&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;minIndex&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;minIndex&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;updateInternalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newKey&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;oldChildIndex&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeFindChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldChildIndex&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newKey&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_INTERNAL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_LEAF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;c1&#34;&gt;// Handle other node types if needed
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// or appropriate default value
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;parentPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childPageNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;parentPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;childMaxKey&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeFindChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;originalNumKeys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;originalNumKeys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;originalNumKeys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_MAX_CELLS&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Need to implement splitting internal node&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;rightChildPageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rightChildPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childMaxKey&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;c1&#34;&gt;// Replace right child
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;originalNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rightChildPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;originalNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;c1&#34;&gt;// Make space for the new cell
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;originalNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;c1&#34;&gt;//destination := internalNodeCell(parent, i)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;c1&#34;&gt;//source := internalNodeCell(parent, i-1)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;c1&#34;&gt;// c: memcpy(destination, source, INTERNAL_NODE_CELL_SIZE);
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;c1&#34;&gt;//copy(destination, source)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childMaxKey&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;632&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;645&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d711&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_INTERNAL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_LEAF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeNumCells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;leafNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numCells&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;c1&#34;&gt;// Handle other node types if needed
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// or appropriate default value
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; 
&lt;span class=&#34;mi&#34;&gt;652&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c718&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;//rightChild := getPage(table.pager, rightChildPageNum)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rightChildPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;668&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a735&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;736&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;675&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a744&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;oldMax&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;678&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a748&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;713&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;714&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c783&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;788&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Need to implement updating parent after split&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;parentPageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;newMax&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;parentPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;updateInternalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldMax&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newMax&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;internalNodeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;parentPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬åå››éƒ¨åˆ†---æ‹†åˆ†å†…éƒ¨èŠ‚ç‚¹&#34;&gt;ç¬¬åå››éƒ¨åˆ† - æ‹†åˆ†å†…éƒ¨èŠ‚ç‚¹&lt;/h2&gt;
&lt;p&gt;æµ‹è¯•:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;os&lt;/span&gt;
&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;util&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;

&lt;span class=&#34;c1&#34;&gt;# æµ‹è¯•7ä¸ªå¶å­èŠ‚ç‚¹çš„B+æ ‘çš„ç»“æ„&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;test_prints_structure_of_7_leaf_node_btree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 58 user58 person58@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 56 user56 person56@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 8 user8 person8@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 54 user54 person54@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 77 user77 person77@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 7 user7 person7@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 25 user25 person25@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 71 user71 person71@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 13 user13 person13@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 22 user22 person22@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 53 user53 person53@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 51 user51 person51@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 59 user59 person59@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 32 user32 person32@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 36 user36 person36@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 79 user79 person79@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 10 user10 person10@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 33 user33 person33@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 20 user20 person20@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 4 user4 person4@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 35 user35 person35@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 76 user76 person76@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 49 user49 person49@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 24 user24 person24@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 70 user70 person70@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 48 user48 person48@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 39 user39 person39@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 15 user15 person15@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 47 user47 person47@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 30 user30 person30@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 86 user86 person86@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 31 user31 person31@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 68 user68 person68@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 37 user37 person37@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 66 user66 person66@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 63 user63 person63@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 40 user40 person40@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 78 user78 person78@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 19 user19 person19@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 46 user46 person46@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 14 user14 person14@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 81 user81 person81@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 72 user72 person72@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 6 user6 person6@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 50 user50 person50@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 85 user85 person85@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 67 user67 person67@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 2 user2 person2@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 55 user55 person55@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 69 user69 person69@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 5 user5 person5@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 65 user65 person65@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 52 user52 person52@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 1 user1 person1@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 29 user29 person29@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 9 user9 person9@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 43 user43 person43@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 75 user75 person75@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 21 user21 person21@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 82 user82 person82@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 12 user12 person12@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 18 user18 person18@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 60 user60 person60@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 44 user44 person44@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.btree&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

    &lt;span class=&#34;n&#34;&gt;expected_output&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Tree:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;- internal (size 1)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - internal (size 2)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - leaf (size 7)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 4&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 5&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 6&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 7&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 8&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - key 8&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - leaf (size 11)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 9&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 10&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 12&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 13&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 14&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 15&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 18&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 19&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 20&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 21&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 22&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - key 22&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - leaf (size 8)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 24&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 25&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 29&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 30&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 31&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 32&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 33&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 35&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - key 35&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;  - internal (size 3)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - leaf (size 12)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 36&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 37&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 39&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 40&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 43&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 44&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 46&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 47&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 48&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 49&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 50&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 51&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - key 51&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - leaf (size 11)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 52&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 53&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 54&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 55&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 56&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 58&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 59&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 60&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 63&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 65&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 66&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - key 66&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - leaf (size 7)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 67&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 68&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 69&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 70&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 71&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 72&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 75&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - key 75&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;    - leaf (size 8)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 76&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 77&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 78&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 79&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 81&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 82&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 85&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;      - 86&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
        &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;

    &lt;span class=&#34;c1&#34;&gt;#print(f&amp;#34;result: {result}&amp;#34;)&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;result[64:]: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:]&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;assert&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;64&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;expected_output&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_getframe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;f_code&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;co_name&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; passed&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;


&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;need db file path&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;path&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exists&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; exists, remove it first&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;remove&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;test_prints_structure_of_7_leaf_node_btree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db_file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;

&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;all tests passed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;diff golang/13.go golang/14.go&lt;/code&gt;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a7&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;s&#34;&gt;&amp;#34;math&amp;#34;&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;85&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a87&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;88&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;cm&#34;&gt;/* ä¸ºäº†æµ‹è¯•ï¼Œä¿æŒè¾ƒå° */&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;86&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a90&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;91&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INVALID_PAGE_NUM&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;MaxUint32&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;268&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a274&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;277&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;&amp;gt;         ç”±äºæ ¹é¡µç æ˜¯0ï¼Œå› æ­¤åœ¨åˆå§‹åŒ–å†…éƒ¨èŠ‚ç‚¹æ—¶ï¼Œå¦‚æœä¸å°†å…¶å³å­èŠ‚ç‚¹åˆå§‹åŒ–ä¸ºæ— æ•ˆçš„é¡µç ï¼Œå¯èƒ½ä¼šå¯¼è‡´å³å­èŠ‚ç‚¹ä¸º0ï¼Œè¿™å°†ä½¿è¯¥èŠ‚ç‚¹æˆä¸ºæ ¹èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;&amp;gt;       */&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INVALID_PAGE_NUM&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;317&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c326&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;331&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INVALID_PAGE_NUM&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to access right child of node, but was invalid page\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;319&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c333&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;338&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INVALID_PAGE_NUM&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to access child %d of node, but was invalid page\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;354&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;358&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c373&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;374&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_INTERNAL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_LEAF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_LEAF&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;360&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;362&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c376&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;407&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;default&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;c1&#34;&gt;// Handle other node types if needed
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// or appropriate default value
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å¤„ç†æ ¹èŠ‚ç‚¹çš„æ‹†åˆ†ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å°†æ—§æ ¹å¤åˆ¶åˆ°æ–°é¡µï¼Œæˆä¸ºå·¦å­èŠ‚ç‚¹ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// é‡æ–°åˆå§‹åŒ–æ ¹é¡µä»¥åŒ…å«æ–°æ ¹èŠ‚ç‚¹ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// æ–°æ ¹èŠ‚ç‚¹æŒ‡å‘ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createNewRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rightChildPageNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rightChildPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;leftChildPageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getUnusedPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;leftChildPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_INTERNAL&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;initializeInternalNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;initializeInternalNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// Left child has data copied from the old root
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nf&#34;&gt;setNodeRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;NODE_INTERNAL&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;leftChildPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;leftChildPageNum&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;363&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a409&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;420&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// Root becomes a new internal node with one key and two children
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nf&#34;&gt;initializeInternalNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nf&#34;&gt;setNodeRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;leftChildPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;leftChildMaxKey&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;leftChildMaxKey&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rightChildPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;365&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a423&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;// å‘çˆ¶èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªæ–°çš„å­èŠ‚ç‚¹/é”®å¯¹ï¼Œå¯¹åº”äºå­èŠ‚ç‚¹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;369&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c427&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;childMaxKey&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;childMaxKey&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;373&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;374&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d430&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;originalNumKeys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; 
&lt;span class=&#34;mi&#34;&gt;376&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;377&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c432&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;433&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Need to implement splitting internal node&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;internalNodeSplitAndInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;parentPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;380&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a437&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;442&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// å…·æœ‰å³å­èŠ‚ç‚¹ä¸ºINVALID_PAGE_NUMçš„å†…éƒ¨èŠ‚ç‚¹ä¸ºç©º
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rightChildPageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INVALID_PAGE_NUM&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;mi&#34;&gt;381&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a444&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;450&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;&amp;gt;         å¦‚æœæˆ‘ä»¬å·²ç»è¾¾åˆ°èŠ‚ç‚¹çš„æœ€å¤§å•å…ƒæ ¼æ•°ï¼Œå°±ä¸èƒ½åœ¨åˆ†è£‚ä¹‹å‰é€’å¢ã€‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;&amp;gt;         åœ¨æ²¡æœ‰æ’å…¥æ–°çš„é”®/å­èŠ‚ç‚¹å¯¹çš„æƒ…å†µä¸‹é€’å¢ï¼Œå¹¶ç«‹å³è°ƒç”¨
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;&amp;gt;         `internal_node_split_and_insert` ä¼šå¯¼è‡´åœ¨ `(max_cells + 1)`
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;&amp;gt;         å¤„åˆ›å»ºä¸€ä¸ªæ–°çš„é”®ï¼Œå…¶å€¼æœªåˆå§‹åŒ–ã€‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;&amp;gt;       */&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;originalNumKeys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;383&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c452&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childMaxKey&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childMaxKey&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;386&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c455&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;originalNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;originalNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;391&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;392&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c460&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;461&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;                       &lt;span class=&#34;c1&#34;&gt;//destination := internalNodeCell(parent, i)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;                       &lt;span class=&#34;c1&#34;&gt;//source := internalNodeCell(parent, i-1)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;394&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;395&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c463&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;464&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;                       &lt;span class=&#34;c1&#34;&gt;//copy(destination, source)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;                       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeCell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))[:],&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;unsafe&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Pointer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))[:])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;c1&#34;&gt;//*internalNodeCell(parent, i) = *internalNodeCell(parent, i-1)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;400&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a470&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;473&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeSplitAndInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;parentPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childPageNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;oldPageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;parentPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;parentPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;oldMax&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;401&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a475&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;543&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;childMax&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;newPageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getUnusedPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// Flag to indicate if we are splitting the root node
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// è¿™ä¸ªç®€çŸ­çš„æ³¨é‡Šæ˜¯chatGPTæ€»ç»“ååŠ ä¸Šçš„...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;splittingRoot&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;isNodeRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;kd&#34;&gt;var&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newNode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;byte&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;splittingRoot&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;createNewRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;c1&#34;&gt;// If splitting root, update oldNode to point to the left child of the new root
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;oldPageNum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;newNode&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;initializeInternalNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;oldNumKeys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;curPageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;cur&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;curPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// Move the right child into the new node and set the right child of old node to INVALID_PAGE_NUM
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nf&#34;&gt;internalNodeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;curPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cur&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INVALID_PAGE_NUM&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// Move keys and child nodes to the new node until the middle key
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_MAX_CELLS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;INTERNAL_NODE_MAX_CELLS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;curPageNum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;cur&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;curPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;internalNodeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;curPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cur&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// Set the right child of old node to the highest key before the middle key and decrement the number of keys
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNumKeys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// Determine which of the split nodes should contain the child to be inserted
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;maxAfterSplit&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;destinationPageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childMax&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;maxAfterSplit&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;destinationPageNum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// Insert the child node into the appropriate split node
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nf&#34;&gt;internalNodeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;destinationPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;childPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;destinationPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// Update the parent node&amp;#39;s key to reflect the new highest key in the old node
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nf&#34;&gt;updateInternalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldMax&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// If not splitting the root, insert the new node into its parent
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;splittingRoot&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;internalNodeInsert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;newPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;newNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; 
&lt;span class=&#34;mi&#34;&gt;419&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;421&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c561&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;564&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;                       &lt;span class=&#34;nf&#34;&gt;printTree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indentationLevel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;numKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                               &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                               &lt;span class=&#34;nf&#34;&gt;printTree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indentationLevel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;423&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;424&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c566&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;570&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;                       &lt;span class=&#34;nf&#34;&gt;indent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indentationLevel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;- key %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                               &lt;span class=&#34;nf&#34;&gt;indent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;indentationLevel&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                               &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;- key %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nf&#34;&gt;printTree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indentationLevel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;426&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;427&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d571&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;printTree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;indentationLevel&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;629&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c773&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;bufio&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;633&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a778&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;781&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;dbClose&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;err&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;io&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;EOF&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;nx&#34;&gt;os&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;716&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;738&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;d863&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;kd&#34;&gt;func&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;createNewRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rightChildPageNum&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rightChildPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;leftChildPageNum&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getUnusedPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getPage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;leftChildPageNum&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// Left child gets data copied from the old root
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nb&#34;&gt;copy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[:])&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nf&#34;&gt;setNodeRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;c1&#34;&gt;// Root becomes a new internal node with one key and two children
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nf&#34;&gt;initializeInternalNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nf&#34;&gt;setNodeRoot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeNumKeys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;leftChildPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; 
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;leftChildMaxKey&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;leftChildMaxKey&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;internalNodeRightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;rightChildPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;leftChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;nodeParent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rightChild&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rootPageNum&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt; 
&lt;span class=&#34;mi&#34;&gt;744&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c869&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;oldMax&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;oldMax&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;784&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c909&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;newMax&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;newMax&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getNodeMaxKey&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;oldNode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;843&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a969&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;:=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;847&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a974&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;848&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;a976&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;       &lt;span class=&#34;nx&#34;&gt;fmt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;total_rows: %d\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;mi&#34;&gt;876&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;c1004&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1007&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;---&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;nf&#34;&gt;readInput&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;reader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;inputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;inputLength&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;                       &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;               &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
      
    </item>
    
    <item>
      <title>[è¯‘]æ„å»ºä¸€ä¸ªç®€å•çš„æ•°æ®åº“</title>
      <link>https://weedge.github.io/post/db_tutorial_zh/</link>
      <pubDate>Tue, 09 Jan 2024 11:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/db_tutorial_zh/</guid>
      
        <description>&lt;p&gt;ç”¨ C ä»å¤´å¼€å§‹ç¼–å†™ SQLite å…‹éš†ï¼›&lt;/p&gt;
&lt;p&gt;æ³¨ï¼šç”¨chatGPTç¿»è¯‘+äººå·¥ç¨å¾®æ•´ç†ä¸‹ï¼Œè€—æ—¶ä¸€ä¸ªå¤šå°æ—¶æ•´ç†å®Œæˆï¼Œä½¿ç”¨è¿™ä¸ªç®€å•çš„db from scratchè¯•ä¸‹æ•ˆæœ, ä»£ç ç®€å•ï¼›ç°åœ¨é«˜ä¸­ç”šè‡³åˆä¸­ç”Ÿæœ‰åœ¨å­¦è¿™ä¸ªã€‚&lt;/p&gt;
&lt;p&gt;åŸæ–‡åœ°å€ï¼š &lt;a href=&#34;https://cstack.github.io/db_tutorial/&#34;&gt;https://cstack.github.io/db_tutorial/&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ•°æ®åº“å¦‚ä½•å·¥ä½œ&#34;&gt;æ•°æ®åº“å¦‚ä½•å·¥ä½œï¼Ÿ&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®ä»¥ä»€ä¹ˆæ ¼å¼ä¿å­˜ï¼Ÿï¼ˆåœ¨å†…å­˜å’Œç£ç›˜ä¸Šï¼‰&lt;/li&gt;
&lt;li&gt;å®ƒä»€ä¹ˆæ—¶å€™ä»å†…å­˜ç§»åŠ¨åˆ°ç£ç›˜ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å›æ»šäº‹åŠ¡å¦‚ä½•è¿›è¡Œï¼Ÿ&lt;/li&gt;
&lt;li&gt;ç´¢å¼•æ˜¯å¦‚ä½•æ ¼å¼åŒ–çš„ï¼Ÿ&lt;/li&gt;
&lt;li&gt;å…¨è¡¨æ‰«æä½•æ—¶ä»¥åŠå¦‚ä½•å‘ç”Ÿï¼Ÿ&lt;/li&gt;
&lt;li&gt;å‡†å¤‡å¥½çš„è¯­å¥ä»¥ä»€ä¹ˆæ ¼å¼ä¿å­˜ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç®€è€Œè¨€ä¹‹ï¼Œæ•°æ®åº“æ˜¯å¦‚ä½•&lt;strong&gt;å·¥ä½œçš„&lt;/strong&gt;ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç†è§£ï¼Œæˆ‘æ­£åœ¨ç”¨ C ä»å¤´å¼€å§‹æ„å»º&lt;a href=&#34;https://www.sqlite.org/arch.html&#34;&gt;sqlite&lt;/a&gt;çš„å…‹éš†ï¼Œå¹¶ä¸”æˆ‘å°†è®°å½•æˆ‘çš„è¿‡ç¨‹ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œæˆ‘æ— æ³•åˆ›é€ çš„ä¸œè¥¿ï¼Œæˆ‘å°±ä¸æ˜ç™½ã€‚&lt;em&gt;What I cannot create, I do not understand&lt;/em&gt;â€ â€”â€”&lt;a href=&#34;https://en.m.wikiquote.org/wiki/Richard_Feynman&#34;&gt;ç†æŸ¥å¾·Â·è´¹æ›¼&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/arch2.gif&#34; alt=&#34;sqlite æ¶æ„ï¼ˆhttps://www.sqlite.org/arch.htmlï¼‰&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬ä¸€éƒ¨åˆ†---ç®€ä»‹å’Œè®¾ç½®repl&#34;&gt;ç¬¬ä¸€éƒ¨åˆ† - ç®€ä»‹å’Œè®¾ç½®REPL&lt;/h2&gt;
&lt;p&gt;ä½œä¸ºä¸€åç½‘é¡µå¼€å‘è€…ï¼Œæˆ‘æ¯å¤©éƒ½åœ¨å·¥ä½œä¸­ä½¿ç”¨å…³ç³»æ•°æ®åº“ï¼Œä½†å®ƒä»¬å¯¹æˆ‘æ¥è¯´å°±åƒä¸€ä¸ªé»‘åŒ£å­ã€‚æˆ‘æœ‰ä¸€äº›é—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ•°æ®ä¿å­˜åœ¨ä»€ä¹ˆæ ¼å¼ä¸­ï¼Ÿï¼ˆåœ¨å†…å­˜å’Œç£ç›˜ä¸Šï¼‰&lt;/li&gt;
&lt;li&gt;ä½•æ—¶å°†æ•°æ®ä»å†…å­˜ç§»åŠ¨åˆ°ç£ç›˜ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä¸ºä»€ä¹ˆæ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®ï¼Ÿ&lt;/li&gt;
&lt;li&gt;äº‹åŠ¡å›æ»šæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ç´¢å¼•æ˜¯å¦‚ä½•æ ¼å¼åŒ–çš„ï¼Ÿ&lt;/li&gt;
&lt;li&gt;ä½•æ—¶ä»¥åŠå¦‚ä½•è¿›è¡Œå…¨è¡¨æ‰«æï¼Ÿ&lt;/li&gt;
&lt;li&gt;å‡†å¤‡å¥½çš„è¯­å¥ä¿å­˜åœ¨ä»€ä¹ˆæ ¼å¼ä¸­ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¢å¥è¯è¯´ï¼Œæ•°æ®åº“æ˜¯å¦‚ä½•&lt;strong&gt;å·¥ä½œ&lt;/strong&gt;çš„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å¼„æ¸…æ¥šè¿™äº›é—®é¢˜ï¼Œæˆ‘æ­£åœ¨ä»é›¶å¼€å§‹ç¼–å†™ä¸€ä¸ªæ•°æ®åº“ã€‚å®ƒçš„æ¨¡å‹æ˜¯åŸºäºSQLiteçš„ï¼Œå› ä¸ºå®ƒè®¾è®¡å¾—å¾ˆå°ï¼Œæ¯”MySQLæˆ–PostgreSQLå°‘äº†ä¸€äº›ç‰¹æ€§ï¼Œæ‰€ä»¥æˆ‘æ›´æœ‰å¸Œæœ›èƒ½ç†è§£å®ƒã€‚æ•´ä¸ªæ•°æ®åº“å­˜å‚¨åœ¨å•ä¸ªæ–‡ä»¶ä¸­ï¼&lt;/p&gt;
&lt;h2 id=&#34;sqlite&#34;&gt;Sqlite&lt;/h2&gt;
&lt;p&gt;åœ¨ä»–ä»¬çš„ç½‘ç«™ä¸Šæœ‰å¾ˆå¤šå…³äºsqliteå†…éƒ¨çš„&lt;a href=&#34;https://www.sqlite.org/arch.html&#34;&gt;æ–‡æ¡£&lt;/a&gt;ï¼Œè€Œä¸”æˆ‘ä¹Ÿæœ‰ä¸€æœ¬&lt;a href=&#34;https://play.google.com/store/books/details?id=9Z6IQQnX1JEC&#34;&gt;ã€ŠSQLiteæ•°æ®åº“ç³»ç»Ÿï¼šè®¾è®¡ä¸å®ç°ã€‹&lt;/a&gt;çš„å‰¯æœ¬(çœ‹æ˜¯å¦å¯ä»¥æ’¸ä¸€éï¼Œä»…ç¿»è¯‘ï¼Œçœ‹sqliteå…·ä½“ç‰ˆæœ¬æºç äº†è§£ç»†èŠ‚)ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/arch1.gif&#34; alt=&#34;sqlite&#34;&gt;&lt;/p&gt;
&lt;p&gt;sqlite æ¶æ„ (&lt;a href=&#34;https://www.sqlite.org/zipvfs/doc/trunk/www/howitworks.wiki&#34;&gt;https://www.sqlite.org/zipvfs/doc/trunk/www/howitworks.wiki&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªæŸ¥è¯¢éœ€è¦é€šè¿‡ä¸€ç³»åˆ—ç»„ä»¶æ¥æ£€ç´¢æˆ–ä¿®æ”¹æ•°æ®ã€‚&lt;strong&gt;å‰ç«¯&lt;/strong&gt;åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ†è¯å™¨ï¼ˆtokenizerï¼‰&lt;/li&gt;
&lt;li&gt;è§£æå™¨ï¼ˆparserï¼‰&lt;/li&gt;
&lt;li&gt;ä»£ç ç”Ÿæˆå™¨ï¼ˆcode generatorï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‰ç«¯çš„è¾“å…¥æ˜¯ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œè¾“å‡ºæ˜¯ SQLite è™šæ‹Ÿæœºçš„å­—èŠ‚ç ï¼ˆå®è´¨ä¸Šæ˜¯ä¸€ä¸ªå¯ä»¥æ“ä½œæ•°æ®åº“çš„ç¼–è¯‘ç¨‹åºï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åç«¯&lt;/strong&gt;åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è™šæ‹Ÿæœºï¼ˆvirtual machineï¼‰&lt;/li&gt;
&lt;li&gt;B-æ ‘ï¼ˆB-treeï¼‰&lt;/li&gt;
&lt;li&gt;é¡µé¢ç®¡ç†å™¨ï¼ˆpagerï¼‰&lt;/li&gt;
&lt;li&gt;æ“ä½œç³»ç»Ÿæ¥å£ï¼ˆos interfaceï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;è™šæ‹Ÿæœº&lt;/strong&gt;æ¥å—å‰ç«¯ç”Ÿæˆçš„å­—èŠ‚ç ä½œä¸ºæŒ‡ä»¤ã€‚ç„¶åï¼Œå®ƒå¯ä»¥å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨æˆ–ç´¢å¼•æ‰§è¡Œæ“ä½œï¼Œæ¯ä¸ªè¡¨æˆ–ç´¢å¼•éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªç§°ä¸º B-æ ‘ çš„æ•°æ®ç»“æ„ä¸­ã€‚è™šæ‹Ÿæœºå®è´¨ä¸Šæ˜¯é’ˆå¯¹å­—èŠ‚ç æŒ‡ä»¤ç±»å‹çš„ä¸€ä¸ªå¤§å‹å¼€å…³è¯­å¥ã€‚&lt;/p&gt;
&lt;p&gt;æ¯ä¸ª&lt;strong&gt;B-æ ‘&lt;/strong&gt;ç”±è®¸å¤šèŠ‚ç‚¹ç»„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ä¸ºä¸€ä¸ªé¡µé¢ã€‚B-æ ‘å¯ä»¥é€šè¿‡å‘é¡µé¢ç®¡ç†å™¨å‘å‡ºå‘½ä»¤æ¥ä»ç£ç›˜æ£€ç´¢é¡µé¢æˆ–å°†å…¶ä¿å­˜å›ç£ç›˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é¡µé¢ç®¡ç†å™¨&lt;/strong&gt;æ¥æ”¶è¯»å–æˆ–å†™å…¥æ•°æ®é¡µé¢çš„å‘½ä»¤ã€‚å®ƒè´Ÿè´£åœ¨æ•°æ®åº“æ–‡ä»¶ä¸­é€‚å½“çš„åç§»ä½ç½®è¯»å–/å†™å…¥æ•°æ®ã€‚å®ƒè¿˜åœ¨å†…å­˜ä¸­ä¿æŒæœ€è¿‘è®¿é—®çš„é¡µé¢çš„ç¼“å­˜ï¼Œå¹¶ç¡®å®šä½•æ—¶éœ€è¦å°†è¿™äº›é¡µé¢å†™å›ç£ç›˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ“ä½œç³»ç»Ÿæ¥å£&lt;/strong&gt;æ˜¯ä¸€ä¸ªæ ¹æ® SQLite ç¼–è¯‘çš„æ“ä½œç³»ç»Ÿè€Œä¸åŒçš„å±‚ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä¸ä¼šæ”¯æŒå¤šä¸ªå¹³å°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://en.wiktionary.org/wiki/a_journey_of_a_thousand_miles_begins_with_a_single_step&#34;&gt;åƒé‡Œä¹‹è¡Œå§‹äºè¶³ä¸‹&lt;/a&gt;ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä»ä¸€äº›æ›´ç®€å•çš„äº‹æƒ…å¼€å§‹ï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„ REPLã€‚&lt;/p&gt;
&lt;h3 id=&#34;åˆ¶ä½œä¸€ä¸ªç®€å•çš„-repl&#34;&gt;åˆ¶ä½œä¸€ä¸ªç®€å•çš„ REPL&lt;/h3&gt;
&lt;p&gt;å½“ä½ ä»å‘½ä»¤è¡Œå¯åŠ¨ SQLite æ—¶ï¼Œå®ƒä¼šå¼€å§‹ä¸€ä¸ªè¯»å–-æ‰§è¡Œ-æ‰“å°å¾ªç¯ï¼š&lt;/p&gt;
&lt;p&gt;è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„æ•°æ®åº“ REPLï¼ˆRead-Eval-Print Loopï¼‰ã€‚å®ƒåŒ…å«äº†ä¸€äº›å…³é”®åŠŸèƒ½ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdbool.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;ssize_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;new_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;print_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;read_input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;ssize_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes_read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;getline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stdin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bytes_read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error reading input&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;c1&#34;&gt;// Ignore trailing newline
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes_read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bytes_read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;close_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;print_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;read_input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;close_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ªåŸºæœ¬çš„äº¤äº’å¼å‘½ä»¤è¡Œç•Œé¢ï¼Œç±»ä¼¼äº SQLite çš„å‘½ä»¤è¡Œç•Œé¢ã€‚å®ƒèƒ½å¤Ÿè¯»å–ç”¨æˆ·è¾“å…¥ï¼Œå¹¶æ£€æµ‹ç‰¹å®šçš„å‘½ä»¤ï¼ˆå¦‚ &lt;code&gt;.exit&lt;/code&gt;ï¼‰ä»¥é€€å‡ºå¾ªç¯ï¼Œå¦åˆ™ä¼šæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ï¼Œæ¥ä¸‹æ¥å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šé€æ­¥æ„å»ºæ›´å¤šåŠŸèƒ½ï¼Œå®ç°æ•°æ®åº“çš„åŸºæœ¬äº¤äº’ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„REPLã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ— é™å¾ªç¯çš„ä¸»å‡½æ•°ï¼Œå®ƒä¼šæ‰“å°æç¤ºç¬¦ï¼Œè·å–è¾“å…¥è¡Œï¼Œç„¶åå¤„ç†è¯¥è¾“å…¥è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;print_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;read_input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;close_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰&lt;code&gt;InputBuffer&lt;/code&gt;ä½œä¸ºå›´ç»•æˆ‘ä»¬éœ€è¦å­˜å‚¨ä»¥ä¸ &lt;a href=&#34;http://man7.org/linux/man-pages/man3/getline.3.html&#34;&gt;getline()&lt;/a&gt; äº¤äº’æ‰€éœ€çŠ¶æ€çš„å°åŒ…è£…å™¨ã€‚ï¼ˆç¨åä¼šè¯¦ç»†è§£é‡Šï¼‰&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;ssize_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;new_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œ&lt;code&gt;print_prompt()&lt;/code&gt;ç”¨äºå‘ç”¨æˆ·æ‰“å°æç¤ºã€‚æˆ‘ä»¬åœ¨è¯»å–æ¯è¡Œè¾“å…¥ä¹‹å‰éƒ½ä¼šè¿™æ ·åšã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;print_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¦è¯»å–ä¸€è¡Œè¾“å…¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ &lt;a href=&#34;http://man7.org/linux/man-pages/man3/getline.3.html&#34;&gt;getline()&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;n&#34;&gt;ssize_t&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;getline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;**&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lineptr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;FILE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stream&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;lineptr&lt;/code&gt;ï¼šæŒ‡å‘æˆ‘ä»¬ç”¨äºæŒ‡å‘åŒ…å«è¯»å–è¡Œçš„ç¼“å†²åŒºçš„å˜é‡çš„æŒ‡é’ˆã€‚å¦‚æœè®¾ç½®ä¸º&lt;code&gt;NULL&lt;/code&gt;ï¼Œå®ƒå°†ç”±&lt;code&gt;getline&lt;/code&gt;è¿›è¡Œåˆ†é…ï¼Œå› æ­¤å³ä½¿å‘½ä»¤å¤±è´¥ï¼Œç”¨æˆ·ä¹Ÿåº”è¯¥é‡Šæ”¾å®ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;n&lt;/code&gt;ï¼šæŒ‡å‘æˆ‘ä»¬ç”¨äºä¿å­˜åˆ†é…ç¼“å†²åŒºå¤§å°çš„å˜é‡çš„æŒ‡é’ˆã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;stream&lt;/code&gt;ï¼šè¦ä»ä¸­è¯»å–çš„è¾“å…¥æµã€‚æˆ‘ä»¬å°†ä»æ ‡å‡†è¾“å…¥è¯»å–ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;code&gt;è¿”å›å€¼&lt;/code&gt;ï¼šè¯»å–çš„å­—èŠ‚æ•°ï¼Œå¯èƒ½å°äºç¼“å†²åŒºçš„å¤§å°ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å‘Šè¯‰ &lt;code&gt;getline&lt;/code&gt; å°†è¯»å–çš„è¡Œå­˜å‚¨åœ¨ &lt;code&gt;input_buffer-&amp;gt;buffer&lt;/code&gt; ä¸­ï¼Œå¹¶å°†åˆ†é…ç¼“å†²åŒºçš„å¤§å°å­˜å‚¨åœ¨ &lt;code&gt;input_buffer-&amp;gt;buffer_length&lt;/code&gt; ä¸­ã€‚æˆ‘ä»¬å°†è¿”å›å€¼å­˜å‚¨åœ¨ &lt;code&gt;input_buffer-&amp;gt;input_length&lt;/code&gt; ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;buffer&lt;/code&gt; æœ€åˆä¸ºç©ºï¼Œå› æ­¤ &lt;code&gt;getline&lt;/code&gt; åˆ†é…è¶³å¤Ÿçš„å†…å­˜æ¥å­˜å‚¨è¾“å…¥è¡Œï¼Œå¹¶ä½¿ &lt;code&gt;buffer&lt;/code&gt; æŒ‡å‘å®ƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;read_input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;ssize_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes_read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;getline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stdin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bytes_read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error reading input&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;c1&#34;&gt;// å¿½ç•¥è¡Œå°¾çš„æ¢è¡Œç¬¦
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes_read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bytes_read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥é‡Šæ”¾ä¸º &lt;code&gt;InputBuffer *&lt;/code&gt; å®ä¾‹å’Œè¯¥ç»“æ„çš„ &lt;code&gt;buffer&lt;/code&gt; å…ƒç´ åˆ†é…çš„å†…å­˜ï¼ˆ&lt;code&gt;getline&lt;/code&gt; åœ¨ &lt;code&gt;read_input&lt;/code&gt; ä¸­ä¸º &lt;code&gt;input_buffer-&amp;gt;buffer&lt;/code&gt; åˆ†é…å†…å­˜ï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;close_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬è§£æå¹¶æ‰§è¡Œå‘½ä»¤ã€‚ç›®å‰åªæœ‰ä¸€ä¸ªå¯è¯†åˆ«çš„å‘½ä»¤ï¼š&lt;code&gt;.exit&lt;/code&gt;ï¼Œç”¨äºç»ˆæ­¢ç¨‹åºã€‚å¦åˆ™ï¼Œæˆ‘ä»¬ä¼šæ‰“å°é”™è¯¯æ¶ˆæ¯å¹¶ç»§ç»­å¾ªç¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;close_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è®©æˆ‘ä»¬è¯•è¯•çœ‹ï¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;~ ./db
db &amp;gt; .tables
Unrecognized &lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;.tables&amp;#39;&lt;/span&gt;.
db &amp;gt; .exit
~
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¥½äº†ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå·¥ä½œçš„REPLã€‚åœ¨ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†å¼€å§‹å¼€å‘æˆ‘ä»¬çš„å‘½ä»¤è¯­è¨€ã€‚ä¸æ­¤åŒæ—¶ï¼Œä»¥ä¸‹æ˜¯æœ¬èŠ‚çš„æ•´ä¸ªç¨‹åºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdbool.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;size_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;ssize_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;new_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;print_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;read_input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;ssize_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes_read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;getline&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;stdin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bytes_read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error reading input&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;c1&#34;&gt;// å¿½ç•¥è¡Œå°¾çš„æ¢è¡Œç¬¦
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes_read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bytes_read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;close_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;print_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;read_input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;close_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬äºŒéƒ¨åˆ†---ä¸–ç•Œä¸Šæœ€ç®€å•çš„sqlç¼–è¯‘å™¨å’Œè™šæ‹Ÿæœº&#34;&gt;ç¬¬äºŒéƒ¨åˆ† - ä¸–ç•Œä¸Šæœ€ç®€å•çš„SQLç¼–è¯‘å™¨å’Œè™šæ‹Ÿæœº&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬æ­£åœ¨åˆ¶ä½œä¸€ä¸ª SQLite çš„å…‹éš†ç‰ˆæœ¬ã€‚SQLite çš„â€œå‰ç«¯â€æ˜¯ä¸€ä¸ª SQL ç¼–è¯‘å™¨ï¼Œå®ƒè§£æå­—ç¬¦ä¸²å¹¶è¾“å‡ºç§°ä¸ºå­—èŠ‚ç çš„å†…éƒ¨è¡¨ç¤ºå½¢å¼ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªå­—èŠ‚ç è¢«ä¼ é€’ç»™è™šæ‹Ÿæœºï¼Œç„¶åç”±è™šæ‹Ÿæœºæ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/arch2.gif&#34; alt=&#34;SQLite Architecture&#34;&gt;&lt;/p&gt;
&lt;p&gt;å°†ä»»åŠ¡åˆ†æˆä¸¤ä¸ªæ­¥éª¤æœ‰å‡ ä¸ªä¼˜ç‚¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‡å°‘äº†æ¯ä¸ªéƒ¨åˆ†çš„å¤æ‚æ€§ï¼ˆä¾‹å¦‚ï¼Œè™šæ‹Ÿæœºä¸éœ€è¦æ‹…å¿ƒè¯­æ³•é”™è¯¯ï¼‰&lt;/li&gt;
&lt;li&gt;å…è®¸ç¼–è¯‘å¸¸è§æŸ¥è¯¢ä¸€æ¬¡ï¼Œå¹¶ç¼“å­˜å­—èŠ‚ç ä»¥æé«˜æ€§èƒ½&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ‰äº†è¿™ä¸ªæƒ³æ³•ï¼Œè®©æˆ‘ä»¬é‡æ„æˆ‘ä»¬çš„ &lt;code&gt;main&lt;/code&gt; å‡½æ•°ï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­æ”¯æŒä¸¤ä¸ªæ–°å…³é”®å­—ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;print_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;read_input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;sc&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;do_meta_command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;          &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;          &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;          &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prepare_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized keyword at start of &amp;#39;%s&amp;#39;.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;               &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;execute_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Executed.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åƒ &lt;code&gt;.exit&lt;/code&gt; è¿™æ ·çš„é SQL è¯­å¥è¢«ç§°ä¸ºâ€œå…ƒå‘½ä»¤â€ã€‚å®ƒä»¬éƒ½ä»¥ç‚¹å·å¼€å¤´ï¼Œæ‰€ä»¥æˆ‘ä»¬æ£€æŸ¥å®ƒä»¬å¹¶åœ¨ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä¸­å¤„ç†å®ƒä»¬ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªæ­¥éª¤ï¼Œå°†è¾“å…¥è¡Œè½¬æ¢ä¸ºæˆ‘ä»¬å†…éƒ¨çš„è¯­å¥è¡¨ç¤ºå½¢å¼ã€‚è¿™æ˜¯æˆ‘ä»¬ SQLite å‰ç«¯çš„ç®€å•ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬å°†å‡†å¤‡å¥½çš„è¯­å¥ä¼ é€’ç»™ &lt;code&gt;execute_statement&lt;/code&gt;ã€‚è¿™ä¸ªå‡½æ•°æœ€ç»ˆä¼šæˆä¸ºæˆ‘ä»¬çš„è™šæ‹Ÿæœºã€‚&lt;/p&gt;
&lt;p&gt;ä¸¤ä¸ªæ–°å‡½æ•°çš„è¿”å›å€¼éƒ½æ˜¯æšä¸¾ï¼Œè¡¨ç¤ºæˆåŠŸæˆ–å¤±è´¥ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MetaCommandResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PrepareResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â€œUnrecognized statementâ€ï¼Ÿè¿™ä¼¼ä¹æœ‰ç‚¹åƒå¼‚å¸¸ã€‚æˆ‘ä¸å¤ªå–œæ¬¢ä½¿ç”¨å¼‚å¸¸ï¼ˆè€Œä¸”Cç”šè‡³ä¸æ”¯æŒå¼‚å¸¸ï¼‰ï¼Œæ‰€ä»¥æˆ‘åœ¨å°½å¯èƒ½çš„åœ°æ–¹ä½¿ç”¨æšä¸¾ç»“æœä»£ç ã€‚å¦‚æœæˆ‘çš„switchè¯­å¥æ²¡æœ‰å¤„ç†æšä¸¾çš„æŸä¸ªæˆå‘˜ï¼ŒCç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ›´æœ‰ä¿¡å¿ƒåœ°å¤„ç†å‡½æ•°çš„æ¯ä¸ªç»“æœã€‚é¢„è®¡å°†æ¥ä¼šæ·»åŠ æ›´å¤šçš„ç»“æœä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;do_meta_command&lt;/code&gt; åªæ˜¯ç°æœ‰åŠŸèƒ½çš„ä¸€ä¸ªåŒ…è£…å™¨ï¼Œä¸ºæ›´å¤šçš„å‘½ä»¤ç•™å‡ºç©ºé—´ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;n&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;do_meta_command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çš„â€œå‡†å¤‡è¯­å¥â€ç°åœ¨åªåŒ…å«ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªå¯èƒ½å€¼çš„æšä¸¾ã€‚éšç€æˆ‘ä»¬å…è®¸è¯­å¥ä¸­åŒ…å«å‚æ•°ï¼Œå®ƒå°†åŒ…å«æ›´å¤šæ•°æ®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;STATEMENT_SELECT&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;StatementType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;prepare_statement&lt;/code&gt;ï¼ˆæˆ‘ä»¬çš„â€œSQLç¼–è¯‘å™¨â€ï¼‰ç°åœ¨ä¸ç†è§£SQLã€‚äº‹å®ä¸Šï¼Œå®ƒåªç†è§£ä¸¤ä¸ªå•è¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;n&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;prepare_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                                &lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strncmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;STATEMENT_SELECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å¯¹â€œinsertâ€ä½¿ç”¨äº† &lt;code&gt;strncmp&lt;/code&gt;ï¼Œå› ä¸ºâ€œinsertâ€å…³é”®å­—åé¢ä¼šè·Ÿç€æ•°æ®ã€‚ï¼ˆä¾‹å¦‚ &lt;code&gt;insert 1 cstack foo@bar.com&lt;/code&gt;ï¼‰&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œ&lt;code&gt;execute_statement&lt;/code&gt; åŒ…å«ä¸€äº›å­˜æ ¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;execute_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;This is where we would do an insert.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;STATEMENT_SELECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;This is where we would do a select.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯·æ³¨æ„ï¼Œå®ƒä¸è¿”å›ä»»ä½•é”™è¯¯ä»£ç ï¼Œå› ä¸ºç›®å‰è¿˜æ²¡æœ‰å¯èƒ½å‡ºé”™çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡è¿™äº›é‡æ„ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥è¯†åˆ«ä¸¤ä¸ªæ–°çš„å…³é”®å­—ï¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;~ ./db
db &amp;gt; insert foo bar
This is where we would &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; an insert.
Executed.
db &amp;gt; delete foo
Unrecognized keyword at start of &lt;span class=&#34;s1&#34;&gt;&amp;#39;delete foo&amp;#39;&lt;/span&gt;.
db &amp;gt; &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;
This is where we would &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; a &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;.
Executed.
db &amp;gt; .tables
Unrecognized &lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;.tables&amp;#39;&lt;/span&gt;
db &amp;gt; .exit
~
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çš„æ•°æ®åº“æ¡†æ¶æ­£åœ¨æˆå‹â€¦â€¦å¦‚æœå®ƒèƒ½å­˜å‚¨æ•°æ®å²‚ä¸æ˜¯æ›´å¥½ï¼Ÿåœ¨ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†å®ç° &lt;code&gt;insert&lt;/code&gt; å’Œ &lt;code&gt;select&lt;/code&gt;ï¼Œåˆ›å»ºä¸–ç•Œä¸Šæœ€ç³Ÿç³•çš„æ•°æ®å­˜å‚¨ã€‚åœ¨æ­¤æœŸé—´ï¼Œä»¥ä¸‹æ˜¯æ­¤éƒ¨åˆ†çš„æ•´ä¸ªå·®å¼‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;23&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InputBuffer_t&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MetaCommandResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PrepareResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;STATEMENT_SELECT&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;StatementType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;40&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;17&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;57&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;67&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;close_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;do_meta_command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;close_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prepare_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;                                &lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strncmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;STATEMENT_SELECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;execute_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;This is where we would do an insert.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;STATEMENT_SELECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;This is where we would do a select.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
 &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;print_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;read_input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;close_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;sc&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;do_meta_command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;          &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;          &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;          &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prepare_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized keyword at start of &amp;#39;%s&amp;#39;.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;               &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;execute_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Executed.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬ä¸‰éƒ¨åˆ†---å†…å­˜ä¸­è¿½åŠ æ–¹å¼å•è¡¨æ•°æ®åº“&#34;&gt;ç¬¬ä¸‰éƒ¨åˆ† - å†…å­˜ä¸­ã€è¿½åŠ æ–¹å¼ã€å•è¡¨æ•°æ®åº“&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å°†é€šè¿‡åœ¨æ•°æ®åº“ä¸Šè®¾ç½®è®¸å¤šé™åˆ¶æ¥ä»¥å°èŒƒå›´å¼€å§‹ã€‚æš‚æ—¶ï¼Œå®ƒå°†ä¼šï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ”¯æŒä¸¤ç§æ“ä½œï¼šæ’å…¥ä¸€è¡Œå’Œæ‰“å°æ‰€æœ‰è¡Œ&lt;/li&gt;
&lt;li&gt;ä»…å­˜åœ¨äºå†…å­˜ä¸­ï¼ˆä¸ä¼šæŒä¹…åŒ–åˆ°ç£ç›˜ï¼‰&lt;/li&gt;
&lt;li&gt;ä»…æ”¯æŒä¸€ä¸ªç¡¬ç¼–ç çš„è¡¨&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬çš„ç¡¬ç¼–ç è¡¨å°†å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;åˆ—å&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;ç±»å‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;id&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ•´æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;username&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å¯å˜é•¿åº¦æ–‡æœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;email&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å¯å˜é•¿åº¦æ–‡æœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ¨¡å¼ï¼Œä½†å®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿæ”¯æŒå¤šç§æ•°æ®ç±»å‹å’Œä¸åŒå¤§å°çš„æ–‡æœ¬æ•°æ®ç±»å‹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™éƒ¨åˆ†æˆ‘ä»¬éœ€è¦ä¿®æ”¹ &lt;code&gt;prepare_statement&lt;/code&gt; å‡½æ•°æ¥è§£æå‚æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strncmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args_assigned&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sscanf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert %d %s %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args_assigned&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å°†è§£æçš„å‚æ•°å­˜å‚¨åˆ°è¯­å¥å¯¹è±¡å†…çš„æ–° &lt;code&gt;Row&lt;/code&gt; æ•°æ®ç»“æ„ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#define COLUMN_USERNAME_SIZE 32
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;#define COLUMN_EMAIL_SIZE 255
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// ä»…åœ¨æ’å…¥è¯­å¥ä¸­ä½¿ç”¨
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›æ•°æ®å¤åˆ¶åˆ°è¡¨ç¤ºè¡¨çš„æŸä¸ªæ•°æ®ç»“æ„ä¸­ã€‚SQLite ä½¿ç”¨ B æ ‘è¿›è¡Œå¿«é€ŸæŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤ã€‚æˆ‘ä»¬å°†ä»ç®€å•çš„ç»“æ„å¼€å§‹ã€‚å°±åƒ B æ ‘ä¸€æ ·ï¼Œå®ƒå°†è¡Œåˆ†ç»„åˆ°ç§°ä¸ºé¡µé¢çš„å†…å­˜å—ä¸­ï¼Œä½†æ˜¯å®ƒä»¬ä¸ä¼šåƒæ ‘é‚£æ ·æ’åˆ—ï¼Œè€Œæ˜¯åƒæ•°ç»„é‚£æ ·æ’åˆ—ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘çš„è®¡åˆ’å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†è¡Œå­˜å‚¨åœ¨ç§°ä¸ºé¡µé¢çš„å†…å­˜å—ä¸­&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªé¡µé¢å­˜å‚¨å°½å¯èƒ½å¤šçš„è¡Œ&lt;/li&gt;
&lt;li&gt;è¡Œè¢«åºåˆ—åŒ–ä¸ºä¸æ¯ä¸ªé¡µé¢ä¸€èµ·çš„ç´§å‡‘è¡¨ç¤ºå½¢å¼&lt;/li&gt;
&lt;li&gt;é¡µé¢ä»…åœ¨éœ€è¦æ—¶åˆ†é…&lt;/li&gt;
&lt;li&gt;ä¿ç•™ä¸€ä¸ªæŒ‡å‘é¡µé¢çš„å›ºå®šå¤§å°æ•°ç»„&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å®šä¹‰è¡Œçš„ç´§å‡‘è¡¨ç¤ºå½¢å¼ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#define size_of_attribute(Struct, Attribute) sizeof(((Struct*)0)-&amp;gt;Attribute)
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size_of_attribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size_of_attribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size_of_attribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ„å‘³ç€åºåˆ—åŒ–è¡Œçš„å¸ƒå±€å°†å¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;åˆ—å&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;å¤§å°ï¼ˆå­—èŠ‚ï¼‰&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;åç§»é‡&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;id&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;username&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;32&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;email&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;255&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;36&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ€»è®¡&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;291&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜éœ€è¦ç¼–å†™ä»£ç ï¼Œå°†ç´§å‡‘è¡¨ç¤ºå½¢å¼è½¬æ¢ä¸ºåŸå§‹è¡Œæ•°æ®ï¼Œä»¥åŠä»åŸå§‹è¡Œæ•°æ®è½¬æ¢å›ç´§å‡‘è¡¨ç¤ºå½¢å¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;serialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;deserialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥æ˜¯ &lt;code&gt;Table&lt;/code&gt; ç»“æ„ï¼Œå®ƒæŒ‡å‘è¡Œçš„é¡µé¢å¹¶è·Ÿè¸ªè¡Œçš„æ•°é‡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4096&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;cp&#34;&gt;#define TABLE_MAX_PAGES 100
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_ROWS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘å°†é¡µé¢å¤§å°è®¾ç½®ä¸º4åƒå­—èŠ‚ï¼Œå› ä¸ºå®ƒä¸å¤§å¤šæ•°è®¡ç®—æœºä½“ç³»ç»“æ„çš„è™šæ‹Ÿå†…å­˜ç³»ç»Ÿä¸­ä½¿ç”¨çš„é¡µé¢å¤§å°ç›¸åŒã€‚è¿™æ„å‘³ç€æ•°æ®åº“ä¸­çš„ä¸€ä¸ªé¡µé¢å¯¹åº”äºæ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨çš„ä¸€ä¸ªé¡µé¢ã€‚æ“ä½œç³»ç»Ÿä¼šæ•´ä½“åœ°å°†é¡µé¢ç§»å…¥å’Œç§»å‡ºå†…å­˜ï¼Œè€Œä¸ä¼šå°†å…¶æ‹†åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘è®¾ç½®äº†ä¸€ä¸ªæœ€å¤§ä¸º100ä¸ªçš„é¡µé¢åˆ†é…çš„ä»»æ„é™åˆ¶ã€‚å½“æˆ‘ä»¬è½¬æ¢ä¸ºæ ‘ç»“æ„æ—¶ï¼Œæˆ‘ä»¬æ•°æ®åº“çš„æœ€å¤§å¤§å°ä»…å—æ–‡ä»¶çš„æœ€å¤§å¤§å°é™åˆ¶ã€‚ï¼ˆå°½ç®¡æˆ‘ä»¬ä»ç„¶é™åˆ¶äº†ä¸€æ¬¡åœ¨å†…å­˜ä¸­ä¿ç•™çš„é¡µé¢æ•°ï¼‰&lt;/p&gt;
&lt;p&gt;è¡Œä¸åº”è¯¥è·¨è¶Šé¡µé¢è¾¹ç•Œã€‚ç”±äºé¡µé¢å¯èƒ½ä¸ä¼šç›¸é‚»å­˜åœ¨äºå†…å­˜ä¸­ï¼Œè¿™ä¸ªå‡è®¾ä½¿å¾—è¯»å–/å†™å…¥è¡Œæ›´å®¹æ˜“ã€‚&lt;/p&gt;
&lt;p&gt;è‡³äºåœ¨å†…å­˜ä¸­ä¸ºç‰¹å®šè¡Œè¯»å–/å†™å…¥çš„ä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è®¡ç®—ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;row_slot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ä»…åœ¨è®¿é—®é¡µé¢æ—¶åˆ†é…å†…å­˜
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;byte_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;byte_offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ &lt;code&gt;execute_statement&lt;/code&gt; ä»æˆ‘ä»¬çš„è¡¨ç»“æ„ä¸­è¯»å†™æ•°æ®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;n&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;execute_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_ROWS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

  &lt;span class=&#34;n&#34;&gt;serialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_slot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;execute_select&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;deserialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_slot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;print_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;execute_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;execute_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;STATEMENT_SELECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;execute_select&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬éœ€è¦åˆå§‹åŒ–è¡¨ï¼Œåˆ›å»ºç›¸åº”çš„å†…å­˜é‡Šæ”¾å‡½æ•°ï¼Œå¹¶å¤„ç†ä¸€äº›å…¶ä»–é”™è¯¯æƒ…å†µï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;new_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;free_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;print_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
    &lt;span class=&#34;c1&#34;&gt;// ...
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prepare_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Syntax error. Could not parse statement.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized keyword at start of &amp;#39;%s&amp;#39;.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
               &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

    &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;execute_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Executed.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error: Table full.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
        &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™äº›ä¿®æ”¹åï¼Œæˆ‘ä»¬å¯ä»¥å®é™…åœ¨æ•°æ®åº“ä¸­ä¿å­˜æ•°æ®äº†ï¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;o&#34;&gt;~&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;insert&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cstack&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Executed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;insert&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bob&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bob&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Executed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cstack&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bob&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bob&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Executed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;insert&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;foo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Syntax&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;error&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Could&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;not&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parse&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æ˜¯å†™ä¸€äº›æµ‹è¯•çš„å¥½æ—¶æœºï¼Œæœ‰å‡ ä¸ªåŸå› ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æˆ‘ä»¬æ‰“ç®—å¤§å¹…æ”¹å˜å­˜å‚¨è¡¨çš„æ•°æ®ç»“æ„ï¼Œæµ‹è¯•å¯ä»¥æ•æ‰åˆ°å›å½’é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;è¿˜æœ‰ä¸€äº›è¾¹ç¼˜æ¡ˆä¾‹æˆ‘ä»¬å°šæœªæ‰‹åŠ¨æµ‹è¯•ï¼ˆä¾‹å¦‚ï¼Œå¡«æ»¡è¡¨ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€éƒ¨åˆ†è§£å†³è¿™äº›é—®é¢˜ã€‚ç°åœ¨ï¼Œè¿™æ˜¯æœ¬éƒ¨åˆ†çš„å…¨éƒ¨ä¿®æ”¹å†…å®¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt;
 &lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt; &lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt; &lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;stdint&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;

 &lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ExecuteResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MetaCommandResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PrepareResult&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;STATEMENT_SELECT&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;StatementType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;define&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;define&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;255&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;StatementType&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;//only used by insert statement
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;define&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size_of_attribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Struct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Attribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Struct&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Attribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size_of_attribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size_of_attribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size_of_attribute&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4096&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;define&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_ROWS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;print_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;(%d, %s, %s)&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;serialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;deserialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_slot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// Allocate memory only when we try to access page
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;byte_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;byte_offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;free_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;40&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;17&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;140&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;105&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;close_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;do_meta_command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;close_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;free_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prepare_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;                                &lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strncmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args_assigned&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sscanf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;	&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert %d %s %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;	&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;	&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args_assigned&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;STATEMENT_SELECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;execute_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_ROWS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;serialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_slot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;execute_select&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;deserialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_slot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;print_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;execute_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;       	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;execute_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;STATEMENT_SELECT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;execute_select&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
 &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;print_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;read_input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;close_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;sc&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;do_meta_command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;          &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;          &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized command &amp;#39;%s&amp;#39;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;          &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prepare_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;	&lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Syntax error. Could not parse statement.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unrecognized keyword at start of &amp;#39;%s&amp;#39;.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;               &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;execute_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;	    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Executed.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;	    &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;	&lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;	    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error: Table full.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;	    &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬å››éƒ¨åˆ†---æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæµ‹è¯•bug&#34;&gt;ç¬¬å››éƒ¨åˆ† - æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæµ‹è¯•ï¼ˆBugï¼‰&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å·²ç»èƒ½å¤Ÿå‘æ•°æ®åº“ä¸­æ’å…¥è¡Œå¹¶æ‰“å°æ‰€æœ‰è¡Œäº†ã€‚è®©æˆ‘ä»¬èŠ±ç‚¹æ—¶é—´æ¥æµ‹è¯•æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢åšå¾—æ€ä¹ˆæ ·ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å°†ä½¿ç”¨ &lt;a href=&#34;http://rspec.info/&#34;&gt;rspec&lt;/a&gt; æ¥ç¼–å†™æˆ‘çš„æµ‹è¯•ï¼Œå› ä¸ºæˆ‘å¯¹å®ƒæ¯”è¾ƒç†Ÿæ‚‰ï¼Œè€Œä¸”è¯­æ³•ç›¸å¯¹æ˜“è¯»ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å°†å®šä¹‰ä¸€ä¸ªç®€çŸ­çš„è¾…åŠ©å‡½æ•°æ¥å‘æˆ‘ä»¬çš„æ•°æ®åº“ç¨‹åºå‘é€ä¸€ç³»åˆ—å‘½ä»¤ï¼Œç„¶åå¯¹è¾“å‡ºè¿›è¡Œæ–­è¨€ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;n&#34;&gt;describe&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;database&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commands&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;raw_output&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kp&#34;&gt;nil&lt;/span&gt;
    &lt;span class=&#34;no&#34;&gt;IO&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;popen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;./db&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;r+&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pipe&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;commands&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;each&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
        &lt;span class=&#34;n&#34;&gt;pipe&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;puts&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;command&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;

      &lt;span class=&#34;n&#34;&gt;pipe&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;close_write&lt;/span&gt;

      &lt;span class=&#34;c1&#34;&gt;# Read entire output&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;raw_output&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pipe&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kp&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;raw_output&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;

  &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;inserts and retrieves a row&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
      &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 1 user1 person1@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
      &lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
      &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; (1, user1, person1@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
      &lt;span class=&#34;s2&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªç®€å•çš„æµ‹è¯•ç¡®ä¿æˆ‘ä»¬å¾—åˆ°äº†æˆ‘ä»¬æ”¾å…¥çš„å†…å®¹ã€‚è€Œä¸”ç¡®å®é€šè¿‡äº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;bundle &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; rspec
.

Finished in 0.00871 seconds &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;files took 0.09506 seconds to load&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; example, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; failures
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨å¯ä»¥æµ‹è¯•å‘æ•°æ®åº“æ’å…¥å¤§é‡è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;prints error message when table is full&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1401&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;map&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; user&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; person&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;@example.com&amp;#34;&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;eq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;db &amp;gt; Error: Table full.&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å†æ¬¡è¿è¡Œæµ‹è¯•â€¦&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;bundle &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; rspec
..

Finished in 0.01553 seconds &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;files took 0.08156 seconds to load&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; examples, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; failures
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¤ªæ£’äº†ï¼ŒæˆåŠŸäº†ï¼æˆ‘ä»¬çš„æ•°æ®åº“ç°åœ¨å¯ä»¥å®¹çº³1400è¡Œï¼Œå› ä¸ºæˆ‘ä»¬å°†æœ€å¤§é¡µé¢æ•°è®¾ç½®ä¸º100ï¼Œå¹¶ä¸”ä¸€é¡µå¯ä»¥å®¹çº³14è¡Œã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯èƒ½æ²¡æœ‰æ­£ç¡®å¤„ç†å­˜å‚¨æ–‡æœ¬å­—æ®µã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹ç¤ºä¾‹è½»æ¾è¿›è¡Œæµ‹è¯•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;allows inserting strings that are the maximum length&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;long_username&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;a&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;long_email&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;a&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;255&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 1 &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_username&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_email&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; (1, &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_username&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;, &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_email&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æµ‹è¯•å¤±è´¥äº†ï¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;Failures:

  1&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; database allows inserting strings that are the maximum length
     Failure/Error: raw_output.split&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;

     ArgumentError:
       invalid byte sequence in UTF-8
     &lt;span class=&#34;c1&#34;&gt;# ./spec/main_spec.rb:14:in `split&amp;#39;&lt;/span&gt;
     &lt;span class=&#34;c1&#34;&gt;# ./spec/main_spec.rb:14:in `run_script&amp;#39;&lt;/span&gt;
     &lt;span class=&#34;c1&#34;&gt;# ./spec/main_spec.rb:48:in `block (2 levels) in &amp;lt;top (required)&amp;gt;&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬è¯•ç€è‡ªå·±æµ‹è¯•ä¸€ä¸‹ï¼Œä¼šå‘ç°åœ¨å°è¯•æ‰“å°å‡ºè¡Œæ—¶å‡ºç°äº†ä¸€äº›å¥‡æ€ªçš„å­—ç¬¦ã€‚ï¼ˆæˆ‘ç¼©å†™äº†é•¿å­—ç¬¦ä¸²ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;db &amp;gt; insert &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; aaaaa... aaaaa...
Executed.
db &amp;gt; &lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;1, aaaaa...aaa&lt;span class=&#34;se&#34;&gt;\ï¿½&lt;/span&gt;, aaaaa...aaa&lt;span class=&#34;se&#34;&gt;\ï¿½&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
Executed.
db &amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿå¦‚æœæ‚¨æŸ¥çœ‹æˆ‘ä»¬å¯¹â€œRowâ€çš„å®šä¹‰ï¼Œæˆ‘ä»¬ä¸ºç”¨æˆ·åå‡†ç¡®åˆ†é…äº†32å­—èŠ‚ï¼Œä¸ºç”µå­é‚®ä»¶å‡†ç¡®åˆ†é…äº†255å­—èŠ‚ã€‚ä½†æ˜¯ï¼Œ&lt;a href=&#34;http://www.cprogramming.com/tutorial/c/lesson9.html&#34;&gt;Cå­—ç¬¦ä¸²&lt;/a&gt;åº”è¯¥ä»¥ç©ºå­—ç¬¦ç»“å°¾ï¼Œè€Œæˆ‘ä»¬æ²¡æœ‰ä¸ºå…¶åˆ†é…ç©ºé—´ã€‚è§£å†³æ–¹æ³•æ˜¯å¤šåˆ†é…ä¸€ä¸ªå­—èŠ‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;255&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¡®å®è§£å†³äº†é—®é¢˜ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt; bundle &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; rspec
...

Finished in 0.0188 seconds &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;files took 0.08516 seconds to load&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; examples, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; failures
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ä¸åº”è¯¥å…è®¸æ’å…¥é•¿åº¦è¶…è¿‡åˆ—å¤§å°çš„ç”¨æˆ·åæˆ–ç”µå­é‚®ä»¶ã€‚å¯¹æ­¤çš„è§„èŒƒå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;prints error message if strings are too long&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;long_username&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;a&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;33&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;long_email&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;a&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;256&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 1 &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_username&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_email&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; String is too long.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å‡çº§æˆ‘ä»¬çš„è§£æå™¨ã€‚æé†’ä¸€ä¸‹ï¼Œæˆ‘ä»¬ç›®å‰æ­£åœ¨ä½¿ç”¨&lt;a href=&#34;https://linux.die.net/man/3/scanf&#34;&gt;scanf()&lt;/a&gt;ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strncmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;args_assigned&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;sscanf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert %d %s %s&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args_assigned&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½†æ˜¯&lt;a href=&#34;https://stackoverflow.com/questions/2430303/disadvantages-of-scanf&#34;&gt;scanfå­˜åœ¨ä¸€äº›ç¼ºç‚¹&lt;/a&gt;ã€‚å¦‚æœå®ƒè¯»å–çš„å­—ç¬¦ä¸²å¤§äºå…¶è¯»å…¥çš„ç¼“å†²åŒºï¼Œå®ƒå°†å¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼Œå¹¶å¼€å§‹å‘æ„å¤–ä½ç½®å†™å…¥ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨å°†å…¶å¤åˆ¶åˆ°&lt;code&gt;Row&lt;/code&gt;ç»“æ„ä¹‹å‰æ£€æŸ¥æ¯ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ç©ºæ ¼å¯¹è¾“å…¥è¿›è¡Œåˆ’åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å°†ä½¿ç”¨&lt;a href=&#34;http://www.cplusplus.com/reference/cstring/strtok/&#34;&gt;strtok()&lt;/a&gt;æ¥å®Œæˆè¿™ä¸ªè¿‡ç¨‹ã€‚å¦‚æœæ‚¨äº²çœ¼ç›®ç¹å®ƒçš„è¿è¡Œï¼Œå¯èƒ½æ›´å®¹æ˜“ç†è§£ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prepare_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;STATEMENT_INSERT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;keyword&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;strtok&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id_string&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;strtok&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;username&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;strtok&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;email&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;strtok&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id_string&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;username&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;||&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;email&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;atoi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strlen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strlen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;COLUMN_EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;strcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;strcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prepare_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                                 &lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strncmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prepare_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯¹è¾“å…¥ç¼“å†²åŒºè¿ç»­è°ƒç”¨&lt;code&gt;strtok&lt;/code&gt;å‡½æ•°ï¼Œé€šè¿‡æ’å…¥ç©ºå­—ç¬¦æ¥å°†å…¶åˆ†æˆå­å­—ç¬¦ä¸²ï¼ˆåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹æ˜¯ç©ºæ ¼ä½œä¸ºåˆ†éš”ç¬¦ï¼‰ã€‚å®ƒè¿”å›å­å­—ç¬¦ä¸²çš„èµ·å§‹æŒ‡é’ˆã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥å¯¹æ¯ä¸ªæ–‡æœ¬å€¼è°ƒç”¨&lt;a href=&#34;http://www.cplusplus.com/reference/cstring/strlen/&#34;&gt;strlen()&lt;/a&gt;æ¥æŸ¥çœ‹å…¶æ˜¯å¦å¤ªé•¿ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å¯ä»¥åƒå¤„ç†å…¶ä»–é”™è¯¯ä»£ç ä¸€æ ·å¤„ç†é”™è¯¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt; enum PrepareResult_t {
   PREPARE_SUCCESS,
&lt;span class=&#34;gi&#34;&gt;+  PREPARE_STRING_TOO_LONG,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   PREPARE_SYNTAX_ERROR,
   PREPARE_UNRECOGNIZED_STATEMENT
 };
 switch (prepare_statement(input_buffer, &amp;amp;statement)) {
   case (PREPARE_SUCCESS):
     break;
&lt;span class=&#34;gi&#34;&gt;+  case (PREPARE_STRING_TOO_LONG):
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    printf(&amp;#34;String is too long.\n&amp;#34;);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    continue;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   case (PREPARE_SYNTAX_ERROR):
     printf(&amp;#34;Syntax error. Could not parse statement.\n&amp;#34;);
     continue;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ ·æˆ‘ä»¬çš„æµ‹è¯•å°±é€šè¿‡äº†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;bundle exec rspec
....

Finished in 0.02284 seconds (files took 0.116 seconds to load)
4 examples, 0 failures
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¤„ç†ä¸€ä¸ªé¢å¤–çš„é”™è¯¯æƒ…å†µï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;prints an error message if id is negative&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert -1 cstack foo@bar.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; ID must be positive.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;
 &lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PrepareResult_t&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;PREPARE_SYNTAX_ERROR&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;148&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;147&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prepare_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

   &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;atoi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strlen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;COLUMN_USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;230&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;226&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prepare_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
       &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PREPARE_NEGATIVE_ID&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ID must be positive.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
       &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PREPARE_STRING_TOO_LONG&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
         &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;String is too long.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¥½äº†ï¼Œç°åœ¨æµ‹è¯•è¶³å¤Ÿäº†ã€‚æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ç‰¹æ€§ï¼šæŒä¹…æ€§ï¼æˆ‘ä»¬å°†æŠŠæ•°æ®åº“ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œç„¶åå†è¯»å–å‡ºæ¥ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ä¼šå¾ˆæ£’ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯æœ¬éƒ¨åˆ†çš„å®Œæ•´å·®å¼‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gu&#34;&gt;@@ -22,6 +22,8 @@
&lt;/span&gt;&lt;span class=&#34;gu&#34;&gt;&lt;/span&gt;
 enum PrepareResult_t {
   PREPARE_SUCCESS,
&lt;span class=&#34;gi&#34;&gt;+  PREPARE_NEGATIVE_ID,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  PREPARE_STRING_TOO_LONG,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   PREPARE_SYNTAX_ERROR,
   PREPARE_UNRECOGNIZED_STATEMENT
  };
&lt;span class=&#34;gu&#34;&gt;@@ -34,8 +36,8 @@
&lt;/span&gt;&lt;span class=&#34;gu&#34;&gt;&lt;/span&gt; #define COLUMN_EMAIL_SIZE 255
 typedef struct {
   uint32_t id;
&lt;span class=&#34;gd&#34;&gt;-  char username[COLUMN_USERNAME_SIZE];
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-  char email[COLUMN_EMAIL_SIZE];
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  char username[COLUMN_USERNAME_SIZE + 1];
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  char email[COLUMN_EMAIL_SIZE + 1];
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt; } Row;

&lt;span class=&#34;gu&#34;&gt;@@ -150,18 +152,40 @@ MetaCommandResult do_meta_command(InputBuffer* input_buffer, Table *table) {
&lt;/span&gt;&lt;span class=&#34;gu&#34;&gt;&lt;/span&gt;   }
 }

&lt;span class=&#34;gd&#34;&gt;-PrepareResult prepare_statement(InputBuffer* input_buffer,
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-                                Statement* statement) {
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-  if (strncmp(input_buffer-&amp;gt;buffer, &amp;#34;insert&amp;#34;, 6) == 0) {
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+PrepareResult prepare_insert(InputBuffer* input_buffer, Statement* statement) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   statement-&amp;gt;type = STATEMENT_INSERT;
&lt;span class=&#34;gd&#34;&gt;-  int args_assigned = sscanf(
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-     input_buffer-&amp;gt;buffer, &amp;#34;insert %d %s %s&amp;#34;, &amp;amp;(statement-&amp;gt;row_to_insert.id),
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;

&lt;span class=&#34;gd&#34;&gt;-     statement-&amp;gt;row_to_insert.username, statement-&amp;gt;row_to_insert.email
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-     );
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-  if (args_assigned &amp;lt; 3) {
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  char* keyword = strtok(input_buffer-&amp;gt;buffer, &amp;#34; &amp;#34;);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  char* id_string = strtok(NULL, &amp;#34; &amp;#34;);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  char* username = strtok(NULL, &amp;#34; &amp;#34;);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  char* email = strtok(NULL, &amp;#34; &amp;#34;);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  if (id_string == NULL || username == NULL || email == NULL) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;      return PREPARE_SYNTAX_ERROR;
   }
&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  int id = atoi(id_string);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  if (id &amp;lt; 0) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+     return PREPARE_NEGATIVE_ID;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  if (strlen(username) &amp;gt; COLUMN_USERNAME_SIZE) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+     return PREPARE_STRING_TOO_LONG;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  if (strlen(email) &amp;gt; COLUMN_EMAIL_SIZE) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+     return PREPARE_STRING_TOO_LONG;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  statement-&amp;gt;row_to_insert.id = id;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  strcpy(statement-&amp;gt;row_to_insert.username, username);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  strcpy(statement-&amp;gt;row_to_insert.email, email);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  return PREPARE_SUCCESS;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+}
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+PrepareResult prepare_statement(InputBuffer* input_buffer,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+                                Statement* statement) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  if (strncmp(input_buffer-&amp;gt;buffer, &amp;#34;insert&amp;#34;, 6) == 0) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      return prepare_insert(input_buffer, statement);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¹¶ä¸”æˆ‘ä»¬å¢åŠ äº†æµ‹è¯•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;describe&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;database&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commands&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;raw_output&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kp&#34;&gt;nil&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;no&#34;&gt;IO&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;popen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;./db&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;r+&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pipe&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;commands&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;each&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;pipe&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;puts&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;command&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;pipe&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;close_write&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;c1&#34;&gt;# Read entire output&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;raw_output&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pipe&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;gets&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kp&#34;&gt;nil&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;raw_output&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;split&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;inserts and retrieves a row&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 1 user1 person1@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; (1, user1, person1@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;prints error message when table is full&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1401&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;map&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; user&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; person&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;@example.com&amp;#34;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;eq&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;db &amp;gt; Error: Table full.&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;allows inserting strings that are the maximum length&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;long_username&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;a&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;long_email&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;a&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;255&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 1 &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_username&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_email&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; (1, &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_username&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;, &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_email&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;prints error message if strings are too long&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;long_username&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;a&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;33&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;long_email&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;a&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;256&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 1 &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_username&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;long_email&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; String is too long.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;prints an error message if id is negative&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert -1 cstack foo@bar.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; ID must be positive.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬äº”éƒ¨åˆ†---æŒä¹…åŒ–åˆ°ç£ç›˜&#34;&gt;ç¬¬äº”éƒ¨åˆ† - æŒä¹…åŒ–åˆ°ç£ç›˜&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œä¸–ç•Œä¸Šæ²¡æœ‰ä»€ä¹ˆå¯ä»¥å–ä»£åšæŒã€‚Nothing in the world can take the place of persistence.â€ - &lt;a href=&#34;https://en.wikiquote.org/wiki/Calvin_Coolidge&#34;&gt;å¡å°”æ–‡Â·æŸ¯ç«‹èŠ&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æˆ‘ä»¬çš„æ•°æ®åº“å…è®¸ä½ æ’å…¥è®°å½•å¹¶å°†å…¶è¯»å–å›æ¥ï¼Œä½†å‰ææ˜¯åªè¦ä½ ä¿æŒç¨‹åºè¿è¡Œã€‚å¦‚æœä½ å…³é—­ç¨‹åºç„¶åé‡æ–°å¯åŠ¨ï¼Œæ‰€æœ‰è®°å½•éƒ½ä¼šæ¶ˆå¤±ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬æƒ³è¦çš„è¡Œä¸ºè§„èŒƒï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt;&lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;keeps data after closing connection&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;result1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 1 user1 person1@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;result2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; (1, user1, person1@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å’Œ SQLite ä¸€æ ·ï¼Œæˆ‘ä»¬å°†é€šè¿‡å°†æ•´ä¸ªæ•°æ®åº“ä¿å­˜åˆ°æ–‡ä»¶æ¥ä¿ç•™è®°å½•ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å·²ç»é€šè¿‡å°†è¡Œåºåˆ—åŒ–ä¸ºé¡µé¢å¤§å°çš„å†…å­˜å—æ¥ä¸ºæ­¤åšå¥½äº†å‡†å¤‡ã€‚è¦æ·»åŠ æŒä¹…æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†è¿™äº›å†…å­˜å—å†™å…¥æ–‡ä»¶ï¼Œå¹¶åœ¨ä¸‹æ¬¡å¯åŠ¨ç¨‹åºæ—¶å°†å…¶è¯»å…¥å†…å­˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†ç®€åŒ–æ“ä½œï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåä¸ºâ€œPagerâ€çš„æŠ½è±¡å±‚ã€‚æˆ‘ä»¬å‘Pagerè¯·æ±‚ç¬¬&lt;code&gt;x&lt;/code&gt;é¡µï¼ŒPagerä¼šè¿”å›ä¸€ä¸ªå†…å­˜å—ã€‚å®ƒé¦–å…ˆæŸ¥çœ‹å…¶ç¼“å­˜ã€‚å¦‚æœç¼“å­˜æœªå‘½ä¸­ï¼Œå®ƒå°†ä»ç£ç›˜ä¸­å¤åˆ¶æ•°æ®åˆ°å†…å­˜ä¸­ï¼ˆé€šè¿‡è¯»å–æ•°æ®åº“æ–‡ä»¶ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/arch-part5.gif&#34; alt=&#34;æˆ‘ä»¬çš„ç¨‹åºå¦‚ä½•ä¸SQLiteæ¶æ„åŒ¹é…&#34;&gt;&lt;/p&gt;
&lt;p&gt;Pagerè®¿é—®é¡µç¼“å­˜å’Œæ–‡ä»¶ã€‚Tableå¯¹è±¡é€šè¿‡Pagerå‘é€é¡µé¢è¯·æ±‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gi&#34;&gt;+typedef struct {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  int file_descriptor;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t file_length;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  void* pages[TABLE_MAX_PAGES];gfvccddddddd 
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+} Pager;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt; typedef struct {
&lt;span class=&#34;gd&#34;&gt;-  void* pages[TABLE_MAX_PAGES];
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  Pager* pager;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   uint32_t num_rows;
 } Table;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘å°†&lt;code&gt;new_table()&lt;/code&gt;é‡å‘½åä¸º&lt;code&gt;db_open()&lt;/code&gt;ï¼Œå› ä¸ºå®ƒç°åœ¨å…·æœ‰æ‰“å¼€æ•°æ®åº“è¿æ¥çš„æ•ˆæœã€‚é€šè¿‡æ‰“å¼€è¿æ¥ï¼Œæˆ‘æŒ‡çš„æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰“å¼€æ•°æ®åº“æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ–é¡µç®¡ç†å™¨æ•°æ®ç»“æ„&lt;/li&gt;
&lt;li&gt;åˆå§‹åŒ–è¡¨æ•°æ®ç»“æ„&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gd&#34;&gt;-Table* new_table() {
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+Table* db_open(const char* filename) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  Pager* pager = pager_open(filename);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t num_rows = pager-&amp;gt;file_length / ROW_SIZE;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   Table* table = malloc(sizeof(Table));
&lt;span class=&#34;gd&#34;&gt;-  table-&amp;gt;num_rows = 0;
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  table-&amp;gt;pager = pager;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  table-&amp;gt;num_rows = num_rows;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;
   return table;
 }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;db_open()&lt;/code&gt; è°ƒç”¨äº† &lt;code&gt;pager_open()&lt;/code&gt; æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ‰“å¼€æ•°æ®åº“æ–‡ä»¶å¹¶è·Ÿè¸ªå…¶å¤§å°ã€‚å®ƒè¿˜å°†é¡µé¢ç¼“å­˜åˆå§‹åŒ–ä¸ºå…¨éƒ¨ä¸º &lt;code&gt;NULL&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gi&#34;&gt;+Pager* pager_open(const char* filename) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  int fd = open(filename,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+                O_RDWR |      // Read/Write mode
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+                    O_CREAT,  // Create file if it does not exist
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+                S_IWUSR |     // User write permission
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+                    S_IRUSR   // User read permission
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+                );
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  if (fd == -1) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    printf(&amp;#34;Unable to open file\n&amp;#34;);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    exit(EXIT_FAILURE);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  off_t file_length = lseek(fd, 0, SEEK_END);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  Pager* pager = malloc(sizeof(Pager));
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  pager-&amp;gt;file_descriptor = fd;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  pager-&amp;gt;file_length = file_length;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  for (uint32_t i = 0; i &amp;lt; TABLE_MAX_PAGES; i++) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    pager-&amp;gt;pages[i] = NULL;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  return pager;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+}
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ ¹æ®æ–°çš„æŠ½è±¡ï¼Œæˆ‘ä»¬å°†è·å–é¡µé¢çš„é€»è¾‘ç§»åˆ°å•ç‹¬çš„æ–¹æ³•ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt; void* row_slot(Table* table, uint32_t row_num) {
   uint32_t page_num = row_num / ROWS_PER_PAGE;
&lt;span class=&#34;gd&#34;&gt;-  void* page = table-&amp;gt;pages[page_num];
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-  if (page == NULL) {
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-    // Allocate memory only when we try to access page
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-    page = table-&amp;gt;pages[page_num] = malloc(PAGE_SIZE);
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-  }
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  void* page = get_page(table-&amp;gt;pager, page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   uint32_t row_offset = row_num % ROWS_PER_PAGE;
   uint32_t byte_offset = row_offset * ROW_SIZE;
   return page + byte_offset;
 }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;get_page()&lt;/code&gt; æ–¹æ³•åŒ…å«å¤„ç†ç¼“å­˜æœªå‘½ä¸­çš„é€»è¾‘ã€‚æˆ‘ä»¬å‡è®¾é¡µé¢æŒ‰é¡ºåºä¿å­˜åœ¨æ•°æ®åº“æ–‡ä»¶ä¸­ï¼šç¬¬0é¡µä½äºåç§»é‡0å¤„ï¼Œç¬¬1é¡µä½äºåç§»é‡4096å¤„ï¼Œç¬¬2é¡µä½äºåç§»é‡8192å¤„ï¼Œä¾æ­¤ç±»æ¨ã€‚å¦‚æœè¯·æ±‚çš„é¡µé¢è¶…å‡ºæ–‡ä»¶èŒƒå›´ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒåº”è¯¥æ˜¯ç©ºç™½çš„ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€åˆ†é…ä¸€äº›å†…å­˜å¹¶è¿”å›å®ƒã€‚ç¨åå°†ç¼“å­˜åˆ·æ–°åˆ°ç£ç›˜æ—¶ï¼Œé¡µé¢å°†è¢«æ·»åŠ åˆ°æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gi&#34;&gt;+void* get_page(Pager* pager, uint32_t page_num) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  if (page_num &amp;gt; TABLE_MAX_PAGES) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    printf(&amp;#34;Tried to fetch page number out of bounds. %d &amp;gt; %d\n&amp;#34;, page_num,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+           TABLE_MAX_PAGES);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    exit(EXIT_FAILURE);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  if (pager-&amp;gt;pages[page_num] == NULL) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    // Cache miss. Allocate memory and load from file.
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    void* page = malloc(PAGE_SIZE);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    uint32_t num_pages = pager-&amp;gt;file_length / PAGE_SIZE;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    // We might save a partial page at the end of the file
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    if (pager-&amp;gt;file_length % PAGE_SIZE) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      num_pages += 1;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    if (page_num &amp;lt;= num_pages) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      lseek(pager-&amp;gt;file_descriptor, page_num * PAGE_SIZE, SEEK_SET);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      ssize_t bytes_read = read(pager-&amp;gt;file_descriptor, page, PAGE_SIZE);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      if (bytes_read == -1) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+        printf(&amp;#34;Error reading file: %d\n&amp;#34;, errno);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+        exit(EXIT_FAILURE);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    pager-&amp;gt;pages[page_num] = page;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  return pager-&amp;gt;pages[page_num];
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+}
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æš‚æ—¶ï¼Œæˆ‘ä»¬ä¼šç­‰åˆ°ç”¨æˆ·å…³é—­æ•°æ®åº“è¿æ¥ä¹‹åå†å°†ç¼“å­˜åˆ·æ–°åˆ°ç£ç›˜ä¸Šã€‚å½“ç”¨æˆ·é€€å‡ºæ—¶ï¼Œæˆ‘ä»¬å°†è°ƒç”¨ä¸€ä¸ªåä¸º &lt;code&gt;db_close()&lt;/code&gt; çš„æ–°æ–¹æ³•ï¼Œå…¶ä¸­ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†é¡µç¼“å­˜åˆ·æ–°åˆ°ç£ç›˜ä¸Š&lt;/li&gt;
&lt;li&gt;å…³é—­æ•°æ®åº“æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;é‡Šæ”¾ Pager å’Œ Table æ•°æ®ç»“æ„çš„å†…å­˜&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;db_close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_full_pages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_full_pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;c1&#34;&gt;// There may be a partial page to write to the end of the file
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// This should not be needed after we switch to a B-tree
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_additional_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_additional_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_full_pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_additional_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error closing db file.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;do_meta_command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;do_meta_command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;db_close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æˆ‘ä»¬å½“å‰çš„è®¾è®¡ä¸­ï¼Œæ–‡ä»¶çš„é•¿åº¦ç¼–ç äº†æ•°æ®åº“ä¸­çš„è¡Œæ•°ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨æ–‡ä»¶æœ«å°¾å†™å…¥ä¸€ä¸ªéƒ¨åˆ†é¡µé¢ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ &lt;code&gt;pager_flush()&lt;/code&gt; éœ€è¦æ¥æ”¶é¡µé¢ç¼–å·å’Œå¤§å°ä¸¤ä¸ªå‚æ•°ã€‚è¿™å¹¶ä¸æ˜¯æœ€ä½³çš„è®¾è®¡ï¼Œä½†åœ¨æˆ‘ä»¬å¼€å§‹å®ç° B æ ‘æ—¶ï¼Œè¿™ä¸ªè®¾è®¡ä¼šå¾ˆå¿«æ¶ˆå¤±ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to flush null page&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;n&#34;&gt;off_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lseek&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SEEK_SET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error seeking: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;errno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;n&#34;&gt;ssize_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes_written&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bytes_written&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error writing: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;errno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬éœ€è¦å°†æ–‡ä»¶åä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ä¼ é€’ã€‚ä¸è¦å¿˜è®°è¿˜è¦å°†é¢å¤–çš„å‚æ•°æ·»åŠ åˆ° &lt;code&gt;do_meta_command&lt;/code&gt; ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Must supply a database filename.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;db_open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;print_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;read_input&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

     &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;sc&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;do_meta_command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;do_meta_command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰äº†è¿™äº›æ›´æ”¹ï¼Œæˆ‘ä»¬å¯ä»¥å…³é—­ç„¶åé‡æ–°æ‰“å¼€æ•°æ®åº“ï¼Œæˆ‘ä»¬çš„è®°å½•ä¾ç„¶å­˜åœ¨ï¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;~ ./db mydb.db
db &amp;gt; insert 1 cstack foo@bar.com
Executed.
db &amp;gt; insert 2 voltorb volty@example.com
Executed.
db &amp;gt; .exit
~
~ ./db mydb.db
db &amp;gt; select
(1, cstack, foo@bar.com)
(2, voltorb, volty@example.com)
Executed.
db &amp;gt; .exit
~
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†æ›´æœ‰è¶£ï¼Œè®©æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹ &lt;code&gt;mydb.db&lt;/code&gt;ï¼Œçœ‹çœ‹æˆ‘ä»¬çš„æ•°æ®æ˜¯å¦‚ä½•å­˜å‚¨çš„ã€‚æˆ‘ä¼šä½¿ç”¨ vim ä½œä¸ºåå…­è¿›åˆ¶ç¼–è¾‘å™¨æ¥æŸ¥çœ‹æ–‡ä»¶çš„å†…å­˜å¸ƒå±€ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;vim mydb.db
:%!xxd
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/file-format.png&#34; alt=&#34;å½“å‰æ–‡ä»¶æ ¼å¼&#34;&gt;&lt;/p&gt;
&lt;p&gt;å‰å››ä¸ªå­—èŠ‚æ˜¯ç¬¬ä¸€è¡Œçš„ IDï¼ˆ4 ä¸ªå­—èŠ‚å› ä¸ºæˆ‘ä»¬å­˜å‚¨äº†ä¸€ä¸ª &lt;code&gt;uint32_t&lt;/code&gt;ï¼‰ã€‚å®ƒä»¥å°ç«¯å­—èŠ‚åºå­˜å‚¨ï¼Œå› æ­¤æœ€ä½æœ‰æ•ˆå­—èŠ‚æ’åœ¨å‰é¢ï¼ˆ01ï¼‰ï¼Œåé¢æ˜¯é«˜ä½å­—èŠ‚ï¼ˆ00 00 00ï¼‰ã€‚æˆ‘ä»¬ä½¿ç”¨ &lt;code&gt;memcpy()&lt;/code&gt; å°†å­—èŠ‚ä» &lt;code&gt;Row&lt;/code&gt; ç»“æ„ä½“å¤åˆ¶åˆ°é¡µé¢ç¼“å­˜ï¼Œè¿™æ„å‘³ç€ç»“æ„ä½“åœ¨å†…å­˜ä¸­æŒ‰ç…§å°ç«¯å­—èŠ‚åºæ’åˆ—ã€‚è¿™æ˜¯æˆ‘ç¼–è¯‘ç¨‹åºæ—¶æ‰€ç”¨æœºå™¨çš„ç‰¹æ€§ã€‚å¦‚æœæˆ‘ä»¬æƒ³åœ¨æˆ‘çš„æœºå™¨ä¸Šå†™ä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶ï¼Œç„¶ååœ¨å¤§ç«¯åºçš„æœºå™¨ä¸Šè¯»å–å®ƒï¼Œæˆ‘ä»¬å°±éœ€è¦æ›´æ”¹æˆ‘ä»¬çš„ &lt;code&gt;serialize_row()&lt;/code&gt; å’Œ &lt;code&gt;deserialize_row()&lt;/code&gt; æ–¹æ³•ï¼Œå§‹ç»ˆä»¥ç›¸åŒçš„é¡ºåºå­˜å‚¨å’Œè¯»å–å­—èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥çš„ 33 ä¸ªå­—èŠ‚ä»¥ç©ºå­—ç¬¦ç»“å°¾å­˜å‚¨äº†ç”¨æˆ·åã€‚æ˜¾ç„¶ï¼Œâ€œcstackâ€ çš„ ASCII åå…­è¿›åˆ¶æ˜¯ &lt;code&gt;63 73 74 61 63 6b&lt;/code&gt;ï¼Œåè·Ÿä¸€ä¸ªç©ºå­—ç¬¦ï¼ˆ&lt;code&gt;00&lt;/code&gt;ï¼‰ã€‚å…¶ä½™çš„ 33 ä¸ªå­—èŠ‚æœªè¢«ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥çš„ 256 ä¸ªå­—èŠ‚ä»¥åŒæ ·çš„æ–¹å¼å­˜å‚¨äº†é‚®ç®±ã€‚åœ¨ç»ˆæ­¢ç©ºå­—ç¬¦åé¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€äº›éšæœºçš„åƒåœ¾å€¼ã€‚è¿™å¾ˆå¯èƒ½æ˜¯ç”±äºæˆ‘ä»¬ &lt;code&gt;Row&lt;/code&gt; ç»“æ„ä½“ä¸­æœªåˆå§‹åŒ–çš„å†…å­˜ã€‚æˆ‘ä»¬å°†æ•´ä¸ª 256 å­—èŠ‚çš„é‚®ç®±ç¼“å†²åŒºå¤åˆ¶åˆ°æ–‡ä»¶ä¸­ï¼ŒåŒ…æ‹¬å­—ç¬¦ä¸²ç»“æŸåçš„ä»»ä½•å­—èŠ‚ã€‚å½“æˆ‘ä»¬åˆ†é…è¯¥ç»“æ„ä½“æ—¶ï¼Œå†…å­˜ä¸­å­˜åœ¨çš„ä»»ä½•å€¼éƒ½ä¼šä¿ç•™ä¸‹æ¥ã€‚ä½†ç”±äºæˆ‘ä»¬ä½¿ç”¨äº†ç»ˆæ­¢ç©ºå­—ç¬¦ï¼Œå®ƒå¯¹è¡Œä¸ºæ²¡æœ‰å½±å“ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šå¦‚æœæˆ‘ä»¬æƒ³ç¡®ä¿æ‰€æœ‰å­—èŠ‚éƒ½è¢«åˆå§‹åŒ–ï¼Œå¯ä»¥åœ¨ &lt;code&gt;serialize_row&lt;/code&gt; ä¸­å°† &lt;code&gt;username&lt;/code&gt; å’Œ &lt;code&gt;email&lt;/code&gt; å­—æ®µçš„å¤åˆ¶æ”¹ä¸º &lt;code&gt;strncpy&lt;/code&gt;ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;serialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;strncpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;strncpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ç»“è®º&#34;&gt;ç»“è®º&lt;/h3&gt;
&lt;p&gt;å¥½äº†ï¼æˆ‘ä»¬å®ç°äº†æŒä¹…æ€§ã€‚è¿™ä¸æ˜¯æœ€ç†æƒ³çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨æ²¡æœ‰è¾“å…¥ &lt;code&gt;.exit&lt;/code&gt; çš„æƒ…å†µä¸‹ç»ˆæ­¢ç¨‹åºï¼Œä½ ä¼šä¸¢å¤±æ›´æ”¹ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰é¡µé¢å†™å›ç£ç›˜ï¼Œå³ä½¿è¿™äº›é¡µé¢è‡ªä»ä»ç£ç›˜è¯»å–ä»¥æ¥æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚è¿™äº›æ˜¯æˆ‘ä»¬å¯ä»¥ç¨åè§£å†³çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹æ¬¡æˆ‘ä»¬å°†ä»‹ç»æ¸¸æ ‡ï¼Œè¿™åº”è¯¥ä¼šæ›´å®¹æ˜“åœ°å®ç° B æ ‘ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨é‚£ä¹‹å‰ï¼&lt;/p&gt;
&lt;h3 id=&#34;å®Œæ•´çš„å˜æ›´&#34;&gt;å®Œæ•´çš„å˜æ›´&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;errno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fcntl&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
 &lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdbool.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt; &lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt; &lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdlib.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt; &lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt; &lt;span class=&#34;cp&#34;&gt;#include&lt;/span&gt; &lt;span class=&#34;cpf&#34;&gt;&amp;lt;stdint.h&amp;gt;&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;include&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unistd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;

 &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;InputBuffer_t&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;62&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;65&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4096&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_ROWS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
 &lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;84&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;94&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;81&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;deserialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to fetch page number out of bounds. %d &amp;gt; %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     	&lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// Cache miss. Allocate memory and load from file.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_pages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// We might save a partial page at the end of the file
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;         &lt;span class=&#34;n&#34;&gt;num_pages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;         &lt;span class=&#34;n&#34;&gt;lseek&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SEEK_SET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;         &lt;span class=&#34;n&#34;&gt;ssize_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes_read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;read&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;         &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bytes_read&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     	&lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error reading file: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;errno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     	&lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;         &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
 &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_slot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;     &lt;span class=&#34;c1&#34;&gt;// Allocate memory only when we try to access page
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;byte_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;byte_offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     	  &lt;span class=&#34;n&#34;&gt;O_RDWR&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt; 	&lt;span class=&#34;c1&#34;&gt;// Read/Write mode
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     	      &lt;span class=&#34;n&#34;&gt;O_CREAT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// Create file if it does not exist
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     	  &lt;span class=&#34;n&#34;&gt;S_IWUSR&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// User write permission
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     	      &lt;span class=&#34;n&#34;&gt;S_IRUSR&lt;/span&gt;	&lt;span class=&#34;c1&#34;&gt;// User read permission
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     	  &lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Unable to open file&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;off_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lseek&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;SEEK_END&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;free_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;db_open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

 &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;142&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;201&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;76&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;close_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to flush null page&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;off_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;lseek&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     		 &lt;span class=&#34;n&#34;&gt;SEEK_SET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error seeking: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;errno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;ssize_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes_written&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bytes_written&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error writing: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;errno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;db_close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_full_pages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_full_pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;         &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// There may be a partial page to write to the end of the file
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// This should not be needed after we switch to a B-tree
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_additional_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_additional_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_full_pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;         &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_additional_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;         &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;         &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error closing db file.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;         &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;         &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;do_meta_command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;close_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;free_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;db_close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;182&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;308&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prepare_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prepare_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
                                 &lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strncmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;227&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;354&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;execute_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

 &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[])&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;argc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Must supply a database filename.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;argv&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;db_open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;print_prompt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥åŠæˆ‘ä»¬æµ‹è¯•çš„å˜æ›´ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-ruby&#34; data-lang=&#34;ruby&#34;&gt; &lt;span class=&#34;n&#34;&gt;describe&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;database&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;before&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;sb&#34;&gt;`rm -rf test.db`&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;commands&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;raw_output&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;kp&#34;&gt;nil&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;no&#34;&gt;IO&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;popen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;./db&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;r+&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pipe&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;no&#34;&gt;IO&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;popen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;./db test.db&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;r+&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pipe&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
       &lt;span class=&#34;n&#34;&gt;commands&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;each&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;command&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
         &lt;span class=&#34;n&#34;&gt;pipe&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;puts&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;command&lt;/span&gt;
       &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;28&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;32&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;27&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;describe&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;database&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
     &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;keeps data after closing connection&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;result1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert 1 user1 person1@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;result2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; (1, user1, person1@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s2&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;prints error message when table is full&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1401&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;map&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
       &lt;span class=&#34;s2&#34;&gt;&amp;#34;insert &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; user&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; person&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;#{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;@example.com&amp;#34;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬å…­éƒ¨åˆ†---æ¸¸æ ‡æŠ½è±¡&#34;&gt;ç¬¬å…­éƒ¨åˆ† - æ¸¸æ ‡æŠ½è±¡&lt;/h2&gt;
&lt;p&gt;è¿™éƒ¨åˆ†åº”è¯¥æ¯”ä¸Šä¸€éƒ¨åˆ†è¦çŸ­ã€‚æˆ‘ä»¬åªæ˜¯è¿›è¡Œä¸€äº›é‡æ„ï¼Œä»¥ä¾¿æ›´å®¹æ˜“å¼€å§‹B-Treeçš„å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ª&lt;code&gt;Cursor&lt;/code&gt;å¯¹è±¡ï¼Œä»£è¡¨è¡¨ä¸­çš„ä½ç½®ã€‚æ‚¨å¯èƒ½æƒ³è¦ä½¿ç”¨æ¸¸æ ‡è¿›è¡Œçš„æ“ä½œåŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨è¡¨çš„å¼€å¤´åˆ›å»ºæ¸¸æ ‡&lt;/li&gt;
&lt;li&gt;åœ¨è¡¨çš„æœ«å°¾åˆ›å»ºæ¸¸æ ‡&lt;/li&gt;
&lt;li&gt;è®¿é—®æ¸¸æ ‡æŒ‡å‘çš„è¡Œ&lt;/li&gt;
&lt;li&gt;å°†æ¸¸æ ‡æ¨è¿›åˆ°ä¸‹ä¸€è¡Œ&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™äº›æ˜¯æˆ‘ä»¬ç°åœ¨è¦å®ç°çš„è¡Œä¸ºã€‚ç¨åï¼Œæˆ‘ä»¬è¿˜æƒ³ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åˆ é™¤æ¸¸æ ‡æŒ‡å‘çš„è¡Œ&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹æ¸¸æ ‡æŒ‡å‘çš„è¡Œ&lt;/li&gt;
&lt;li&gt;åœ¨è¡¨ä¸­æœç´¢ç»™å®šIDï¼Œå¹¶åˆ›å»ºæŒ‡å‘è¯¥IDè¡Œçš„æ¸¸æ ‡&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¯ä¸å¤šè¯´ï¼Œè¿™æ˜¯&lt;code&gt;Cursor&lt;/code&gt;ç±»å‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// è¡¨ç¤ºæœ€åä¸€ä¸ªå…ƒç´ ä¹‹åçš„ä½ç½®
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æˆ‘ä»¬å½“å‰çš„è¡¨æ•°æ®ç»“æ„ä¸­ï¼Œå”¯ä¸€éœ€è¦ç”¨äºåœ¨è¡¨ä¸­æ ‡è¯†ä½ç½®çš„æ˜¯è¡Œå·ã€‚&lt;/p&gt;
&lt;p&gt;æ¸¸æ ‡è¿˜å…·æœ‰å¯¹å…¶æ‰€å±è¡¨çš„å¼•ç”¨ï¼ˆå› æ­¤æˆ‘ä»¬çš„æ¸¸æ ‡å‡½æ•°å¯ä»¥åªå°†æ¸¸æ ‡ä½œä¸ºå‚æ•°ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åï¼Œå®ƒæœ‰ä¸€ä¸ªåä¸º&lt;code&gt;end_of_table&lt;/code&gt;çš„å¸ƒå°”å€¼ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¡¨ç¤ºè¡¨æœ«å°¾çš„ä½ç½®ï¼ˆè¿™æ˜¯æˆ‘ä»¬å¯èƒ½è¦æ’å…¥è¡Œçš„ä½ç½®ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;table_start()&lt;/code&gt;å’Œ&lt;code&gt;table_end()&lt;/code&gt;åˆ›å»ºæ–°çš„æ¸¸æ ‡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;table_start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;table_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çš„&lt;code&gt;row_slot()&lt;/code&gt;å‡½æ•°å°†å˜ä¸º&lt;code&gt;cursor_value()&lt;/code&gt;ï¼Œå®ƒè¿”å›æŒ‡å‘æ¸¸æ ‡æè¿°ä½ç½®çš„æŒ‡é’ˆï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cursor_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;byte_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;byte_offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æˆ‘ä»¬å½“å‰çš„è¡¨ç»“æ„ä¸­æ¨è¿›æ¸¸æ ‡å°±æ˜¯ç®€å•åœ°é€’å¢è¡Œå·ã€‚åœ¨B-Treeä¸­ä¼šæ›´å¤æ‚ä¸€äº›ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cursor_advance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ”¹æˆ‘ä»¬çš„â€œè™šæ‹Ÿæœºâ€æ–¹æ³•ï¼Œä»¥ä½¿ç”¨æ¸¸æ ‡æŠ½è±¡ã€‚åœ¨æ’å…¥è¡Œæ—¶ï¼Œæˆ‘ä»¬åœ¨è¡¨çš„æœ«å°¾æ‰“å¼€ä¸€ä¸ªæ¸¸æ ‡ï¼Œå†™å…¥è¯¥æ¸¸æ ‡ä½ç½®ï¼Œç„¶åå…³é—­æ¸¸æ ‡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;serialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

&lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨é€‰æ‹©è¡¨ä¸­çš„æ‰€æœ‰è¡Œæ—¶ï¼Œæˆ‘ä»¬åœ¨è¡¨çš„å¼€å¤´æ‰“å¼€ä¸€ä¸ªæ¸¸æ ‡ï¼Œæ‰“å°è¡Œï¼Œç„¶åå°†æ¸¸æ ‡æ¨è¿›åˆ°ä¸‹ä¸€è¡Œã€‚é‡å¤ç›´åˆ°è¾¾åˆ°è¡¨çš„æœ«å°¾ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;n&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;execute_select&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table_start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

  &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;deserialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;print_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;cursor_advance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

  &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¥½äº†ï¼Œå°±æ˜¯è¿™æ ·ï¼å°±åƒæˆ‘è¯´çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªæ›´çŸ­çš„é‡æ„ï¼Œåº”è¯¥æœ‰åŠ©äºæˆ‘ä»¬å°†è¡¨æ•°æ®ç»“æ„é‡å†™ä¸ºB-Treeã€‚&lt;code&gt;execute_select()&lt;/code&gt;å’Œ&lt;code&gt;execute_insert()&lt;/code&gt;å¯ä»¥å®Œå…¨é€šè¿‡æ¸¸æ ‡ä¸è¡¨è¿›è¡Œäº¤äº’ï¼Œè€Œä¸å‡è®¾è¡¨çš„å­˜å‚¨æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯æœ¬éƒ¨åˆ†çš„å®Œæ•´å·®å¼‚ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gu&#34;&gt;@@ -78,6 +78,13 @@ struct {
&lt;/span&gt;&lt;span class=&#34;gu&#34;&gt;&lt;/span&gt; } Table;

&lt;span class=&#34;gi&#34;&gt;+typedef struct {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  Table* table;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t row_num;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  bool end_of_table; // Indicates a position one past the last element
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+} Cursor;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt; void print_row(Row* row) {
     printf(&amp;#34;(%d, %s, %s)\n&amp;#34;, row-&amp;gt;id, row-&amp;gt;username, row-&amp;gt;email);
 }
&lt;span class=&#34;gu&#34;&gt;@@ -126,12 +133,38 @@ void* get_page(Pager* pager, uint32_t page_num) {
&lt;/span&gt;&lt;span class=&#34;gu&#34;&gt;&lt;/span&gt;     return pager-&amp;gt;pages[page_num];
 }

&lt;span class=&#34;gd&#34;&gt;-void* row_slot(Table* table, uint32_t row_num) {
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-  uint32_t page_num = row_num / ROWS_PER_PAGE;
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-  void *page = get_page(table-&amp;gt;pager, page_num);
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-  uint32_t row_offset = row_num % ROWS_PER_PAGE;
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-  uint32_t byte_offset = row_offset * ROW_SIZE;
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-  return page + byte_offset;
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+Cursor* table_start(Table* table) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  Cursor* cursor = malloc(sizeof(Cursor));
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  cursor-&amp;gt;table = table;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  cursor-&amp;gt;row_num = 0;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  cursor-&amp;gt;end_of_table = (table-&amp;gt;num_rows == 0);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  return cursor;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+}
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+Cursor* table_end(Table* table) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  Cursor* cursor = malloc(sizeof(Cursor));
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  cursor-&amp;gt;table = table;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  cursor-&amp;gt;row_num = table-&amp;gt;num_rows;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  cursor-&amp;gt;end_of_table = true;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  return cursor;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+}
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+void* cursor_value(Cursor* cursor) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t row_num = cursor-&amp;gt;row_num;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t page_num = row_num / ROWS_PER_PAGE;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  void *page = get_page(cursor-&amp;gt;table-&amp;gt;pager, page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t row_offset = row_num % ROWS_PER_PAGE;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t byte_offset = row_offset * ROW_SIZE;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  return page + byte_offset;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+}
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+void cursor_advance(Cursor* cursor) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  cursor-&amp;gt;row_num += 1;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  if (cursor-&amp;gt;row_num &amp;gt;= cursor-&amp;gt;table-&amp;gt;num_rows) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    cursor-&amp;gt;end_of_table = true;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt; }

 Pager* pager_open(const char* filename) {
&lt;span class=&#34;gu&#34;&gt;@@ -327,19 +360,28 @@ ExecuteResult execute_insert(Statement* statement, Table* table) {
&lt;/span&gt;&lt;span class=&#34;gu&#34;&gt;&lt;/span&gt;     }

   Row* row_to_insert = &amp;amp;(statement-&amp;gt;row_to_insert);
&lt;span class=&#34;gi&#34;&gt;+  Cursor* cursor = table_end(table);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;gd&#34;&gt;-  serialize_row(row_to_insert, row_slot(table, table-&amp;gt;num_rows));
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  serialize_row(row_to_insert, cursor_value(cursor));
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   table-&amp;gt;num_rows += 1;

&lt;span class=&#34;gi&#34;&gt;+  free(cursor);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   return EXECUTE_SUCCESS;
 }

 ExecuteResult execute_select(Statement* statement, Table* table) {
&lt;span class=&#34;gi&#34;&gt;+  Cursor* cursor = table_start(table);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   Row row;
&lt;span class=&#34;gd&#34;&gt;-  for (uint32_t i = 0; i &amp;lt; table-&amp;gt;num_rows; i++) {
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-     deserialize_row(row_slot(table, i), &amp;amp;row);
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  while (!(cursor-&amp;gt;end_of_table)) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+     deserialize_row(cursor_value(cursor), &amp;amp;row);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;      print_row(&amp;amp;row);
&lt;span class=&#34;gi&#34;&gt;+     cursor_advance(cursor);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   }
&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  free(cursor);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   return EXECUTE_SUCCESS;
 }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬ä¸ƒéƒ¨åˆ†---b-treeç®€ä»‹&#34;&gt;ç¬¬ä¸ƒéƒ¨åˆ† - B-Treeç®€ä»‹&lt;/h2&gt;
&lt;p&gt;B-Treeæ˜¯SQLiteç”¨äºè¡¨ç¤ºè¡¨å’Œç´¢å¼•çš„æ•°æ®ç»“æ„ï¼Œå› æ­¤å®ƒæ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„æ¦‚å¿µã€‚æœ¬æ–‡ä»…ä»‹ç»æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥ä¸åŒ…å«ä»»ä½•ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆæ ‘æ˜¯æ•°æ®åº“ä¸­çš„å¥½æ•°æ®ç»“æ„å‘¢ï¼Ÿ&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æœç´¢ç‰¹å®šå€¼å¿«é€Ÿï¼ˆå¯¹æ•°æ—¶é—´ï¼‰&lt;/li&gt;
&lt;li&gt;æ’å…¥/åˆ é™¤å·²æ‰¾åˆ°çš„å€¼å¾ˆå¿«ï¼ˆé‡æ–°å¹³è¡¡çš„å¤§è‡´å¸¸æ•°æ—¶é—´ï¼‰&lt;/li&gt;
&lt;li&gt;éå†ä¸€ç³»åˆ—å€¼å¾ˆå¿«ï¼ˆä¸åƒå“ˆå¸Œæ˜ å°„ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;B-Treeä¸äºŒå‰æ ‘ä¸åŒï¼ˆâ€œBâ€å¯èƒ½ä»£è¡¨å‘æ˜è€…çš„åå­—ï¼Œä½†ä¹Ÿå¯èƒ½ä»£è¡¨â€œå¹³è¡¡â€ï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹B-Treeï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/B-tree.png&#34; alt=&#34;ç¤ºä¾‹B-Tree&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸äºŒå‰æ ‘ä¸åŒï¼ŒB-Treeä¸­çš„æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰è¶…è¿‡2ä¸ªå­©å­ã€‚æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå¯ä»¥æœ‰mä¸ªå­©å­ï¼Œå…¶ä¸­mç§°ä¸ºæ ‘çš„â€œé˜¶â€ã€‚ä¸ºäº†ä¿æŒæ ‘åŸºæœ¬å¹³è¡¡ï¼Œæˆ‘ä»¬è¿˜è¯´èŠ‚ç‚¹å¿…é¡»è‡³å°‘æœ‰m/2ä¸ªå­©å­ï¼ˆå‘ä¸Šå–æ•´ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¤–æƒ…å†µï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¶èŠ‚ç‚¹æ²¡æœ‰å­©å­&lt;/li&gt;
&lt;li&gt;æ ¹èŠ‚ç‚¹å¯ä»¥å°‘äºmä¸ªå­©å­ï¼Œä½†å¿…é¡»è‡³å°‘æœ‰2ä¸ª&lt;/li&gt;
&lt;li&gt;å¦‚æœæ ¹èŠ‚ç‚¹æ˜¯å¶èŠ‚ç‚¹ï¼ˆå”¯ä¸€çš„èŠ‚ç‚¹ï¼‰ï¼Œåˆ™ä»ç„¶æ²¡æœ‰å­©å­&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šé¢çš„å›¾ç‰‡å±•ç¤ºäº†SQLiteç”¨äºå­˜å‚¨ç´¢å¼•çš„B-Treeã€‚ä¸ºäº†å­˜å‚¨è¡¨ï¼ŒSQLiteä½¿ç”¨äº†ä¸€ç§ç§°ä¸ºB+æ ‘çš„å˜ä½“ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;B-Tree&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;B+ Tree&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å‘éŸ³&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;â€œBee Treeâ€&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;â€œBee Plus Treeâ€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ç”¨äºå­˜å‚¨&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ç´¢å¼•&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;è¡¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å†…éƒ¨èŠ‚ç‚¹å­˜å‚¨é”®&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ˜¯&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ˜¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å†…éƒ¨èŠ‚ç‚¹å­˜å‚¨å€¼&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ˜¯&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å¦&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ¯ä¸ªèŠ‚ç‚¹çš„å­©å­æ•°&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;è¾ƒå°‘&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;è¾ƒå¤š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å†…éƒ¨èŠ‚ç‚¹ä¸å¶èŠ‚ç‚¹&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ç›¸åŒç»“æ„&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ä¸åŒç»“æ„&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬å¼€å§‹å®ç°ç´¢å¼•ä¹‹å‰ï¼Œæˆ‘å°†ä¸“é—¨è®¨è®ºB+æ ‘ï¼Œä½†æˆ‘ä¼šç®€ç§°ä¸ºB-Treeæˆ–btreeã€‚&lt;/p&gt;
&lt;p&gt;å…·æœ‰å­©å­çš„èŠ‚ç‚¹ç§°ä¸ºâ€œå†…éƒ¨â€èŠ‚ç‚¹ã€‚å†…éƒ¨èŠ‚ç‚¹å’Œå¶èŠ‚ç‚¹çš„ç»“æ„ä¸åŒï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;å¯¹äºä¸€ä¸ªé˜¶ä¸ºmçš„æ ‘â€¦&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;å†…éƒ¨èŠ‚ç‚¹&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;å¶èŠ‚ç‚¹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å­˜å‚¨&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;é”®å’ŒæŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆ&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;é”®å’Œå€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;é”®çš„æ•°é‡&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æœ€å¤šm-1&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å°½å¯èƒ½å¤šçš„é”®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æŒ‡é’ˆçš„æ•°é‡&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;é”®çš„æ•°é‡ + 1&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ²¡æœ‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å€¼çš„æ•°é‡&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ²¡æœ‰&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;é”®çš„æ•°é‡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;é”®çš„ä½œç”¨&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ç”¨äºè·¯ç”±&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ä¸å€¼é…å¯¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å­˜å‚¨å€¼ï¼Ÿ&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å¦&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ˜¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;è®©æˆ‘ä»¬é€šè¿‡ç¤ºä¾‹æ¥çœ‹çœ‹å½“å‘B-Treeæ’å…¥å…ƒç´ æ—¶ï¼ŒB-Treeæ˜¯å¦‚ä½•å¢é•¿çš„ã€‚ä¸ºäº†ä¿æŒç®€å•ï¼Œæ ‘å°†æ˜¯é˜¶ä¸º3çš„ã€‚è¿™æ„å‘³ç€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹æœ€å¤šæœ‰3ä¸ªå­©å­&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹æœ€å¤šæœ‰2ä¸ªé”®&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹è‡³å°‘æœ‰2ä¸ªå­©å­&lt;/li&gt;
&lt;li&gt;æ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹è‡³å°‘æœ‰1ä¸ªé”®&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç©ºçš„B-Treeåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼šæ ¹èŠ‚ç‚¹ã€‚æ ¹èŠ‚ç‚¹å¼€å§‹ä½œä¸ºä¸€ä¸ªå¸¦æœ‰é›¶ä¸ªé”®/å€¼å¯¹çš„å¶èŠ‚ç‚¹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/btree1.png&#34; alt=&#34;ç©ºçš„btree&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬æ’å…¥ä¸€å¯¹é”®/å€¼ï¼Œå®ƒä»¬å°†æŒ‰æ’åºé¡ºåºå­˜å‚¨åœ¨å¶èŠ‚ç‚¹ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/btree2.png&#34; alt=&#34;å•èŠ‚ç‚¹btree&#34;&gt;&lt;/p&gt;
&lt;p&gt;å‡è®¾å¶èŠ‚ç‚¹çš„å®¹é‡ä¸ºä¸¤ä¸ªé”®/å€¼å¯¹ã€‚å½“æˆ‘ä»¬æ’å…¥å¦ä¸€ä¸ªæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»åˆ†è£‚å¶èŠ‚ç‚¹å¹¶å°†ä¸€åŠçš„é”®/å€¼å¯¹æ”¾å…¥æ¯ä¸ªèŠ‚ç‚¹ã€‚è¿™ä¸¤ä¸ªèŠ‚ç‚¹éƒ½æˆä¸ºæ–°çš„å†…éƒ¨èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œè¿™ä¸ªå†…éƒ¨èŠ‚ç‚¹ç°åœ¨å°†æˆä¸ºæ ¹èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/btree3.png&#34; alt=&#34;ä¸¤çº§btree&#34;&gt;&lt;/p&gt;
&lt;p&gt;å†…éƒ¨èŠ‚ç‚¹æœ‰1ä¸ªé”®å’Œ2ä¸ªæŒ‡å‘å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚å¦‚æœæˆ‘ä»¬è¦æŸ¥æ‰¾å°äºæˆ–ç­‰äº5çš„é”®ï¼Œæˆ‘ä»¬æŸ¥æ‰¾å·¦ä¾§å­èŠ‚ç‚¹ã€‚å¦‚æœæˆ‘ä»¬è¦æŸ¥æ‰¾å¤§äº5çš„é”®ï¼Œæˆ‘ä»¬æŸ¥æ‰¾å³ä¾§å­èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨è®©æˆ‘ä»¬æ’å…¥é”®â€œ2â€ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æŸ¥æ‰¾å¦‚æœå®ƒå­˜åœ¨æ—¶å®ƒä¼šåœ¨å“ªä¸ªå¶èŠ‚ç‚¹ï¼Œç„¶åæˆ‘ä»¬åˆ°è¾¾å·¦ä¾§å¶èŠ‚ç‚¹ã€‚èŠ‚ç‚¹å·²æ»¡ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ†è£‚å¶èŠ‚ç‚¹å¹¶åœ¨çˆ¶èŠ‚ç‚¹ä¸­åˆ›å»ºæ–°æ¡ç›®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/btree4.png&#34; alt=&#34;å››èŠ‚ç‚¹btree&#34;&gt;&lt;/p&gt;
&lt;p&gt;è®©æˆ‘ä»¬ç»§ç»­æ·»åŠ é”®ã€‚18å’Œ21ã€‚æˆ‘ä»¬åˆ°è¾¾å¿…é¡»å†æ¬¡åˆ†è£‚çš„ç‚¹ï¼Œä½†åœ¨çˆ¶èŠ‚ç‚¹ä¸­æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥æ”¾ç½®å¦ä¸€ä¸ªé”®/æŒ‡é’ˆå¯¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/btree5.png&#34; alt=&#34;å†…éƒ¨èŠ‚ç‚¹æ²¡æœ‰ç©ºé—´&#34;&gt;&lt;/p&gt;
&lt;p&gt;è§£å†³æ–¹æ¡ˆæ˜¯å°†æ ¹èŠ‚ç‚¹åˆ†è£‚ä¸ºä¸¤ä¸ªå†…éƒ¨èŠ‚ç‚¹ï¼Œ&lt;/p&gt;
&lt;p&gt;ç„¶ååˆ›å»ºæ–°çš„æ ¹èŠ‚ç‚¹ä½œä¸ºå®ƒä»¬çš„çˆ¶èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/btree6.png&#34; alt=&#34;ä¸‰çº§btree&#34;&gt;&lt;/p&gt;
&lt;p&gt;æ ‘çš„æ·±åº¦ä»…åœ¨æˆ‘ä»¬åˆ†è£‚æ ¹èŠ‚ç‚¹æ—¶å¢åŠ ã€‚æ¯ä¸ªå¶èŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„æ·±åº¦å’Œæ¥è¿‘ç›¸åŒæ•°é‡çš„é”®/å€¼å¯¹ï¼Œå› æ­¤æ ‘ä¿æŒå¹³è¡¡å¹¶å¿«é€Ÿæœç´¢ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬å®ç°è¿™ç§æ•°æ®ç»“æ„ä¹‹å‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹å°†å¯¹åº”ä¸€ä¸ªé¡µé¢ã€‚æ ¹èŠ‚ç‚¹å°†å­˜åœ¨äºé¡µé¢0ä¸­ã€‚å­æŒ‡é’ˆå°†ç®€å•åœ°æ˜¯åŒ…å«å­èŠ‚ç‚¹çš„é¡µé¢å·ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹æ¬¡ï¼Œæˆ‘ä»¬å¼€å§‹å®ç°btreeï¼&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬å…«éƒ¨åˆ†---b-treeå¶èŠ‚ç‚¹æ ¼å¼&#34;&gt;ç¬¬å…«éƒ¨åˆ† - B-Treeå¶èŠ‚ç‚¹æ ¼å¼&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬å°†è¡¨çš„æ ¼å¼ä»æœªæ’åºçš„è¡Œæ•°ç»„æ›´æ”¹ä¸ºB-Treeã€‚è¿™æ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„å˜åŒ–ï¼Œéœ€è¦å¤šç¯‡æ–‡ç« æ¥å®ç°ã€‚åœ¨æœ¬æ–‡ç»“æŸæ—¶ï¼Œæˆ‘ä»¬å°†å®šä¹‰å¶èŠ‚ç‚¹çš„å¸ƒå±€ï¼Œå¹¶æ”¯æŒå°†é”®/å€¼å¯¹æ’å…¥å•ä¸ªèŠ‚ç‚¹æ ‘ä¸­ã€‚ä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹åˆ‡æ¢åˆ°æ ‘ç»“æ„çš„åŸå› ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ›¿ä»£è¡¨æ ¼å¼&#34;&gt;æ›¿ä»£è¡¨æ ¼å¼&lt;/h3&gt;
&lt;p&gt;åœ¨å½“å‰æ ¼å¼ä¸­ï¼Œæ¯ä¸ªé¡µé¢ä»…å­˜å‚¨è¡Œï¼ˆæ²¡æœ‰å…ƒæ•°æ®ï¼‰ï¼Œå› æ­¤å®ƒéå¸¸èŠ‚çœç©ºé—´ã€‚æ’å…¥ä¹Ÿå¾ˆå¿«ï¼Œå› ä¸ºæˆ‘ä»¬åªæ˜¯è¿½åŠ åˆ°æœ«å°¾ã€‚ä½†æ˜¯ï¼Œåªèƒ½é€šè¿‡æ‰«ææ•´ä¸ªè¡¨æ¥æŸ¥æ‰¾ç‰¹å®šçš„è¡Œã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦åˆ é™¤ä¸€è¡Œï¼Œå°±å¿…é¡»é€šè¿‡ç§»åŠ¨å…¶åçš„æ¯ä¸€è¡Œæ¥å¡«å……ç©ºæ´ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬å°†è¡¨å­˜å‚¨ä¸ºæ•°ç»„ï¼Œä½†ä¿æŒæŒ‰idæ’åºçš„è¡Œï¼Œåˆ™å¯ä»¥ä½¿ç”¨äºŒåˆ†æœç´¢æ¥æŸ¥æ‰¾ç‰¹å®šçš„idã€‚ç„¶è€Œï¼Œæ’å…¥ä¼šå¾ˆæ…¢ï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»ç§»åŠ¨å¾ˆå¤šè¡Œæ¥è…¾å‡ºç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;ç›¸åï¼Œæˆ‘ä»¬é€‰æ‹©ä½¿ç”¨æ ‘ç»“æ„ã€‚æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥åŒ…å«å¯å˜æ•°é‡çš„è¡Œï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­å­˜å‚¨ä¸€äº›ä¿¡æ¯æ¥è·Ÿè¸ªå®ƒåŒ…å«çš„è¡Œæ•°ã€‚æ­¤å¤–ï¼Œæ‰€æœ‰ä¸å­˜å‚¨ä»»ä½•è¡Œçš„å†…éƒ¨èŠ‚ç‚¹çš„å­˜å‚¨å¼€é”€ã€‚æ¢å–ä¸€ä¸ªæ›´å¤§çš„æ•°æ®åº“æ–‡ä»¶ï¼Œæˆ‘ä»¬è·å¾—äº†å¿«é€Ÿæ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;æœªæ’åºçš„è¡Œæ•°ç»„&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;æ’åºçš„è¡Œæ•°ç»„&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;èŠ‚ç‚¹æ ‘&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;é¡µé¢åŒ…å«&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ä»…æ•°æ®&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;ä»…æ•°æ®&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;å…ƒæ•°æ®ã€ä¸»é”®å’Œæ•°æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ¯é¡µè¡Œæ•°&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ›´å¤š&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ›´å¤š&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ›´å°‘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æ’å…¥&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;O(1)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;O(n)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;O(log(n))&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;åˆ é™¤&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;O(n)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;O(n)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;O(log(n))&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;æŒ‰idæŸ¥æ‰¾&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;O(n)&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;O(log(n))&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;O(log(n))&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;èŠ‚ç‚¹å¤´æ ¼å¼&#34;&gt;èŠ‚ç‚¹å¤´æ ¼å¼&lt;/h3&gt;
&lt;p&gt;å¶èŠ‚ç‚¹å’Œå†…éƒ¨èŠ‚ç‚¹å…·æœ‰ä¸åŒçš„å¸ƒå±€ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæšä¸¾æ¥è·Ÿè¸ªèŠ‚ç‚¹ç±»å‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_INTERNAL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_LEAF&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¯ä¸ªèŠ‚ç‚¹å°†å¯¹åº”ä¸€ä¸ªé¡µé¢ã€‚å†…éƒ¨èŠ‚ç‚¹å°†é€šè¿‡å­˜å‚¨å­˜å‚¨å­èŠ‚ç‚¹çš„é¡µé¢å·æ¥æŒ‡å‘å®ƒä»¬çš„å­èŠ‚ç‚¹ã€‚btreeä¼šè¯·æ±‚pageræä¾›ç‰¹å®šé¡µé¢å·ï¼Œå¹¶ä»é¡µé¢ç¼“å­˜ä¸­å¾—åˆ°ä¸€ä¸ªæŒ‡é’ˆã€‚é¡µé¢æŒ‰ç…§é¡µé¢å·çš„é¡ºåºä¾æ¬¡å­˜å‚¨åœ¨æ•°æ®åº“æ–‡ä»¶ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;èŠ‚ç‚¹éœ€è¦åœ¨é¡µé¢å¼€å¤´å­˜å‚¨ä¸€äº›å…ƒæ•°æ®ã€‚æ¯ä¸ªèŠ‚ç‚¹å°†å­˜å‚¨å…¶èŠ‚ç‚¹ç±»å‹ã€æ˜¯å¦ä¸ºæ ¹èŠ‚ç‚¹ä»¥åŠå…¶çˆ¶èŠ‚ç‚¹çš„æŒ‡é’ˆï¼ˆä»¥å…è®¸æŸ¥æ‰¾èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹ï¼‰ã€‚æˆ‘ä¸ºæ¯ä¸ªå¤´å­—æ®µçš„å¤§å°å’Œåç§»å®šä¹‰äº†å¸¸é‡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+ * å…¬å…±èŠ‚ç‚¹å¤´å¸ƒå±€
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+ */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_TYPE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint8_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_TYPE_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IS_ROOT_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint8_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IS_ROOT_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_TYPE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PARENT_POINTER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PARENT_POINTER_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IS_ROOT_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IS_ROOT_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint8_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;NODE_TYPE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IS_ROOT_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PARENT_POINTER_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å¶èŠ‚ç‚¹æ ¼å¼&#34;&gt;å¶èŠ‚ç‚¹æ ¼å¼&lt;/h3&gt;
&lt;p&gt;é™¤äº†è¿™äº›å¸¸è§çš„å¤´å­—æ®µä¹‹å¤–ï¼Œå¶èŠ‚ç‚¹éœ€è¦å­˜å‚¨å®ƒä»¬åŒ…å«å¤šå°‘ä¸ªâ€œå•å…ƒâ€ã€‚å•å…ƒæ˜¯ä¸€ä¸ªé”®/å€¼å¯¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+ * å¶èŠ‚ç‚¹å¤´å¸ƒå±€
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+ */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NUM_CELLS_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NUM_CELLS_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NUM_CELLS_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¶èŠ‚ç‚¹çš„ä¸»ä½“æ˜¯ä¸€ä¸ªå•å…ƒæ•°ç»„ã€‚æ¯ä¸ªå•å…ƒéƒ½æ˜¯ä¸€ä¸ªé”®ï¼Œåè·Ÿä¸€ä¸ªå€¼ï¼ˆä¸€ä¸ªåºåˆ—åŒ–çš„è¡Œï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+ * å¶èŠ‚ç‚¹ä¸»ä½“å¸ƒå±€
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+ */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_KEY_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_KEY_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_VALUE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_VALUE_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;LEAF_NODE_KEY_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_KEY_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_KEY_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_VALUE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_SPACE_FOR_CELLS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;LEAF_NODE_SPACE_FOR_CELLS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ ¹æ®è¿™äº›å¸¸é‡ï¼Œå½“å‰å¶èŠ‚ç‚¹çš„å¸ƒå±€å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/leaf-node-format.png&#34; alt=&#34;æˆ‘ä»¬çš„å¶èŠ‚ç‚¹æ ¼å¼&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨å¤´éƒ¨æ¯ä¸ªå¸ƒå°”å€¼ä½¿ç”¨ä¸€ä¸ªå®Œæ•´çš„å­—èŠ‚æœ‰äº›æµªè´¹ç©ºé—´ï¼Œä½†è¿™æ ·å¯ä»¥æ›´è½»æ¾åœ°ç¼–å†™è®¿é—®è¿™äº›å€¼çš„ä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;è¿˜è¦æ³¨æ„ï¼Œæœ«å°¾æœ‰ä¸€äº›ç©ºç™½ç©ºé—´ã€‚æˆ‘ä»¬åœ¨å¤´éƒ¨ä¹‹åå­˜å‚¨å°½å¯èƒ½å¤šçš„å•å…ƒï¼Œä½†å‰©ä½™çš„ç©ºé—´æ— æ³•å®¹çº³æ•´ä¸ªå•å…ƒã€‚æˆ‘ä»¬å°†å…¶ç•™ç©ºä»¥é¿å…åœ¨èŠ‚ç‚¹ä¹‹é—´åˆ†å‰²å•å…ƒã€‚&lt;/p&gt;
&lt;h3 id=&#34;è®¿é—®å¶èŠ‚ç‚¹å­—æ®µ&#34;&gt;è®¿é—®å¶èŠ‚ç‚¹å­—æ®µ&lt;/h3&gt;
&lt;p&gt;è®¿é—®å¶èŠ‚ç‚¹å­—æ®µçš„ä»£ç éƒ½æ¶‰åŠä½¿ç”¨æˆ‘ä»¬åˆšåˆšå®šä¹‰çš„å¸¸é‡è¿›è¡ŒæŒ‡é’ˆç®—æœ¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NUM_CELLS_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_KEY_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;initialize_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™äº›æ–¹æ³•è¿”å›æ‰€éœ€å€¼çš„æŒ‡é’ˆï¼Œå› æ­¤å¯ä»¥ç”¨ä½œgetterå’Œsetterã€‚&lt;/p&gt;
&lt;h3 id=&#34;pagerå’Œtableå¯¹è±¡çš„æ›´æ”¹&#34;&gt;Pagerå’ŒTableå¯¹è±¡çš„æ›´æ”¹&lt;/h3&gt;
&lt;p&gt;æ¯ä¸ªèŠ‚ç‚¹å°†å ç”¨ä¸€ä¸ªå®Œæ•´çš„é¡µé¢ï¼Œå³ä½¿å®ƒå¹¶æœªå¡«æ»¡è¯¥é¡µé¢ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬çš„pagerä¸å†éœ€è¦æ”¯æŒè¯»å–/å†™å…¥éƒ¨åˆ†é¡µé¢ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to flush null page&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;242&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;337&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
   &lt;span class=&#34;n&#34;&gt;ssize_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes_written&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bytes_written&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error writing: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;errno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;db_close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_full_pages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_full_pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
       &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// There may be a partial page to write to the end of the file
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// This should not be needed after we switch to a B-tree
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_additional_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_additional_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_full_pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_additional_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error closing db file.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼Œåœ¨æ•°æ®åº“ä¸­å­˜å‚¨é¡µé¢çš„æ•°é‡æ¯”å­˜å‚¨è¡Œæ•°æ›´æœ‰æ„ä¹‰ã€‚é¡µé¢çš„æ•°é‡åº”è¯¥ä¸pagerå¯¹è±¡ç›¸å…³è”ï¼Œè€Œä¸æ˜¯ä¸è¡¨ç›¸å…³è”ï¼Œå› ä¸ºå®ƒæ˜¯æ•°æ®åº“ä½¿ç”¨çš„é¡µé¢æ•°é‡ï¼Œè€Œä¸æ˜¯ç‰¹å®šè¡¨çš„æ•°é‡ã€‚Bæ ‘ç”±å…¶æ ¹èŠ‚ç‚¹é¡µé¢å·æ ‡è¯†ï¼Œå› æ­¤è¡¨å¯¹è±¡éœ€è¦è·Ÿè¸ªå®ƒã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4096&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_ROWS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 
 &lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 
 &lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;127&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;200&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
     &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_pages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;184&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;269&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_pages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Db file is not a whole number of pages. Corrupt file.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
   &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;cursorå¯¹è±¡çš„æ›´æ”¹&#34;&gt;Cursorå¯¹è±¡çš„æ›´æ”¹&lt;/h3&gt;
&lt;p&gt;æ¸¸æ ‡è¡¨ç¤ºè¡¨ä¸­çš„ä½ç½®ã€‚å½“æˆ‘ä»¬çš„è¡¨æ˜¯ä¸€ä¸ªç®€å•çš„è¡Œæ•°ç»„æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¡Œå·è®¿é—®è¡Œã€‚ç°åœ¨å®ƒæ˜¯ä¸€ä¸ªæ ‘ç»“æ„ï¼Œæˆ‘ä»¬é€šè¿‡èŠ‚ç‚¹çš„é¡µé¢å·å’Œè¯¥èŠ‚ç‚¹ä¸­çš„å•å…ƒå·æ¥æ ‡è¯†ä¸€ä¸ªä½ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; &lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// Indicates a position one past the last element
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;table_start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 
   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;table_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 
   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cursor_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;

&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;byte_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;byte_offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;cursor_advance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¸Œæœ›è¿™äº›æ›´æ”¹èƒ½å¤Ÿå¸®åŠ©ä½ ç†è§£å’Œæ›´æ–°ä»£ç ä»¥æ”¯æŒB-Treeæ ¼å¼çš„æ•°æ®åº“ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å‘å¶èŠ‚ç‚¹æ’å…¥æ•°æ®&#34;&gt;å‘å¶èŠ‚ç‚¹æ’å…¥æ•°æ®&lt;/h3&gt;
&lt;p&gt;åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬åªå®ç°äº†è¶³å¤Ÿå®ç°å•èŠ‚ç‚¹æ ‘çš„å†…å®¹ã€‚å›é¡¾ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œæ ‘ä»ä¸€ä¸ªç©ºçš„å¶èŠ‚ç‚¹å¼€å§‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/btree1.png&#34; alt=&#34;empty btree&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥æ·»åŠ é”®/å€¼å¯¹ï¼Œç›´åˆ°å¶èŠ‚ç‚¹å·²æ»¡ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/btree2.png&#34; alt=&#34;one-node btree&#34;&gt;&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ä»¬é¦–æ¬¡æ‰“å¼€æ•°æ®åº“æ—¶ï¼Œæ•°æ®åº“æ–‡ä»¶å°†ä¸ºç©ºï¼Œå› æ­¤æˆ‘ä»¬å°†é¡µé¢ 0 åˆå§‹åŒ–ä¸ºç©ºçš„å¶èŠ‚ç‚¹ï¼ˆæ ¹èŠ‚ç‚¹ï¼‰ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;db_open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 
   &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_pages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// æ–°çš„æ•°æ®åº“æ–‡ä»¶ã€‚å°†é¡µé¢ 0 åˆå§‹åŒ–ä¸ºå¶èŠ‚ç‚¹ã€‚
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;initialize_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå°†é”®/å€¼å¯¹æ’å…¥åˆ°å¶èŠ‚ç‚¹ã€‚å®ƒå°†æ¥å—ä¸€ä¸ªå…‰æ ‡ä½œä¸ºè¾“å…¥ï¼Œè¡¨ç¤ºåº”å°†è¯¥å¯¹æ’å…¥çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// èŠ‚ç‚¹å·²æ»¡
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Need to implement splitting a leaf node.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// ä¸ºæ–°å•å…ƒæ ¼è…¾å‡ºç©ºé—´
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;             &lt;span class=&#34;n&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;serialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬è¿˜æ²¡æœ‰å®ç°åˆ†è£‚ï¼Œæ‰€ä»¥å¦‚æœèŠ‚ç‚¹å·²æ»¡ï¼Œæˆ‘ä»¬ä¼šæŠ¥é”™ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å•å…ƒæ ¼å³ç§»ä¸€ä¸ªä½ç½®ï¼Œä»¥è…¾å‡ºæ–°å•å…ƒæ ¼çš„ç©ºé—´ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†æ–°çš„é”®/å€¼å¯¹å†™å…¥åˆ°ç©ºç™½çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºæˆ‘ä»¬å‡è®¾æ ‘åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤ &lt;code&gt;execute_insert()&lt;/code&gt; å‡½æ•°åªéœ€è¦è°ƒç”¨è¿™ä¸ªè¾…åŠ©æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; &lt;span class=&#34;n&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;execute_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_ROWS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
   &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;serialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;leaf_node_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 
   &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡è¿™äº›æ›´æ”¹ï¼Œæˆ‘ä»¬çš„æ•°æ®åº“åº”è¯¥åƒä»¥å‰ä¸€æ ·å·¥ä½œï¼ä½†æ˜¯ç°åœ¨ä¼šæ›´æ—©åœ°è¿”å›â€œè¡¨å·²æ»¡â€é”™è¯¯ï¼Œå› ä¸ºæˆ‘ä»¬å°šä¸èƒ½åˆ†è£‚æ ¹èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;å¶èŠ‚ç‚¹èƒ½å¤Ÿå®¹çº³å¤šå°‘è¡Œï¼Ÿ&lt;/p&gt;
&lt;h3 id=&#34;æ‰“å°å¸¸é‡çš„å‘½ä»¤&#34;&gt;æ‰“å°å¸¸é‡çš„å‘½ä»¤&lt;/h3&gt;
&lt;p&gt;æˆ‘æ·»åŠ äº†ä¸€ä¸ªæ–°çš„å…ƒå‘½ä»¤ï¼Œä»¥æ‰“å°ä¸€äº›æ„Ÿå…´è¶£çš„å¸¸é‡ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;print_constants&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ROW_SIZE: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;COMMON_NODE_HEADER_SIZE: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_HEADER_SIZE: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_CELL_SIZE: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_SPACE_FOR_CELLS: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_SPACE_FOR_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_MAX_CELLS: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;294&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;376&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;do_meta_command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;db_close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.constants&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Constants:&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;print_constants&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘è¿˜æ·»åŠ äº†ä¸€ä¸ªæµ‹è¯•ï¼Œä»¥ä¾¿åœ¨è¿™äº›å¸¸é‡å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥æˆ‘ä»¬ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prints&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;constants&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;.constants&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Constants:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;ROW_SIZE: 293&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;COMMON_NODE_HEADER_SIZE: 6&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_HEADER_SIZE: 10&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_CELL_SIZE: 297&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_SPACE_FOR_CELLS: 4086&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_MAX_CELLS: 13&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ‰€ä»¥æˆ‘ä»¬çš„è¡¨ç›®å‰å¯ä»¥å®¹çº³ 13 è¡Œï¼&lt;/p&gt;
&lt;h2 id=&#34;æ ‘çš„å¯è§†åŒ–&#34;&gt;æ ‘çš„å¯è§†åŒ–&lt;/h2&gt;
&lt;p&gt;ä¸ºäº†å¸®åŠ©è°ƒè¯•å’Œå¯è§†åŒ–ï¼Œæˆ‘è¿˜æ·»åŠ äº†ä¸€ä¸ªå…ƒå‘½ä»¤æ¥æ‰“å° b æ ‘çš„è¡¨ç¤ºã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;print_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;leaf (size %d)&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;  - %d : %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;

&lt;span class=&#34;s&#34;&gt;&amp;#34;, i, key);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;294&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;376&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;do_meta_command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;db_close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.btree&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tree:&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;print_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.constants&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Constants:&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;print_constants&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
     &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿˜æœ‰ä¸€ä¸ªæµ‹è¯•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;allows&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;printing&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;structure&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;one&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;btree&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;map&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert #{i} user#{i} person#{i}@example.com&amp;#34;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.btree&amp;#34;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Tree:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;leaf (size 3)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 0 : 3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 1 : 1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 2 : 2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å“¦ï¼Œç³Ÿç³•ï¼Œæˆ‘ä»¬ä»ç„¶æ²¡æœ‰æŒ‰é¡ºåºå­˜å‚¨è¡Œã€‚ä½ ä¼šæ³¨æ„åˆ° &lt;code&gt;execute_insert()&lt;/code&gt; åœ¨å¶èŠ‚ç‚¹ä¸­æ’å…¥çš„ä½ç½®æ˜¯ç”± &lt;code&gt;table_end()&lt;/code&gt; è¿”å›çš„ä½ç½®ã€‚å› æ­¤ï¼Œè¡Œæ˜¯æŒ‰ç…§æ’å…¥çš„é¡ºåºå­˜å‚¨çš„ï¼Œå°±åƒä»¥å‰ä¸€æ ·ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸‹ä¸€æ­¥è®¡åˆ’&#34;&gt;ä¸‹ä¸€æ­¥è®¡åˆ’&lt;/h3&gt;
&lt;p&gt;è¿™å¯èƒ½çœ‹èµ·æ¥åƒæ˜¯ä¸€ç§å€’é€€ã€‚æˆ‘ä»¬çš„æ•°æ®åº“ç°åœ¨å­˜å‚¨çš„è¡Œæ•°æ¯”ä»¥å‰å°‘äº†ï¼Œè€Œä¸”æˆ‘ä»¬ä»ç„¶æŒ‰ç…§æ— åºçš„æ–¹å¼å­˜å‚¨è¡Œã€‚ä½†å°±åƒæˆ‘åœ¨å¼€å§‹æ—¶æ‰€è¯´çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªé‡å¤§çš„æ”¹å˜ï¼Œé‡è¦çš„æ˜¯å°†å…¶åˆ†è§£æˆå¯ç®¡ç†çš„æ­¥éª¤ã€‚&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å®ç°æŒ‰ä¸»é”®æŸ¥æ‰¾è®°å½•ï¼Œå¹¶å¼€å§‹æŒ‰é¡ºåºå­˜å‚¨è¡Œã€‚&lt;/p&gt;
&lt;h3 id=&#34;å®Œæ•´çš„ä»£ç å˜æ›´&#34;&gt;å®Œæ•´çš„ä»£ç å˜æ›´&lt;/h3&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;62&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;62&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;101&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ID_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;USERNAME_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

 &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4096&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;cp&#34;&gt;#define TABLE_MAX_PAGES 100
&lt;/span&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_ROWS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 
 &lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 
 &lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 
 &lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;struct&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// Indicates a position one past the last element
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;typedef&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_INTERNAL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_LEAF&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+ * Common Node Header Layout
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+ */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_TYPE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint8_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_TYPE_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IS_ROOT_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint8_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IS_ROOT_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_TYPE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PARENT_POINTER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PARENT_POINTER_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IS_ROOT_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IS_ROOT_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint8_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;NODE_TYPE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IS_ROOT_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PARENT_POINTER_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+ * Leaf Node Header Layout
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+ */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NUM_CELLS_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NUM_CELLS_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NUM_CELLS_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+ * Leaf Node Body Layout
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+ */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_KEY_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_KEY_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_VALUE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_VALUE_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;LEAF_NODE_KEY_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_KEY_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_KEY_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_VALUE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_SPACE_FOR_CELLS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;LEAF_NODE_SPACE_FOR_CELLS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NUM_CELLS_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_KEY_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;print_constants&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;ROW_SIZE: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;COMMON_NODE_HEADER_SIZE: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_HEADER_SIZE: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_CELL_SIZE: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_SPACE_FOR_CELLS: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_SPACE_FOR_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_MAX_CELLS: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;print_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;leaf (size %d)&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;  - %d : %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
 &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;print_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;(%d, %s, %s)&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;username&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;101&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;173&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;deserialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;email&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EMAIL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;initialize_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
 &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to fetch page number out of bounds. %d &amp;gt; %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;128&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;202&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
     &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_pages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;];&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;136&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;214&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table_start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 
   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;145&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;24&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;227&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;28&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table_start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 
   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
 &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;byte_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_offset&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;byte_offset&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
 &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor_advance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;185&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;271&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;fd&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_pages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Db file is not a whole number of pages. Corrupt file.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
   &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_PAGES&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;194&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;285&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;195&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;287&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
 
 &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;db_open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;char&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_open&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filename&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 
   &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_pages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// New database file. Initialize page 0 as leaf node.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;initialize_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;234&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;331&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;close_input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to flush null page&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;242&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;337&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;249&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;346&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
   &lt;span class=&#34;n&#34;&gt;ssize_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;bytes_written&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;write&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;bytes_written&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error writing: %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;errno&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;252&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;347&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;260&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;357&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
 
 &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;db_close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_full_pages&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_full_pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
       &lt;span class=&#34;k&#34;&gt;continue&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// There may be a partial page to write to the end of the file
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// This should not be needed after we switch to a B-tree
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_additional_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROWS_PER_PAGE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_additional_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_full_pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;pager_flush&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_additional_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ROW_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;int&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file_descriptor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error closing db file.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;305&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;389&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;MetaCommandResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;do_meta_command&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;db_close&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.btree&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tree:&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;print_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.constants&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Constants:&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;print_constants&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;META_COMMAND_UNRECOGNIZED_COMMAND&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;354&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;446&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;39&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PrepareResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;prepare_statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;InputBuffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PREPARE_UNRECOGNIZED_STATEMENT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// Node full
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Need to implement splitting a leaf node.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;c1&#34;&gt;// Make room for new cell
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;             &lt;span class=&#34;n&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;serialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;execute_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;TABLE_MAX_ROWS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
   &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;serialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_rows&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;leaf_node_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 
   &lt;span class=&#34;n&#34;&gt;free&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æµ‹è¯•å¦‚ä¸‹:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;allows&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;printing&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;structure&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;one&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;btree&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;].&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;map&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert #{i} user#{i} person#{i}@example.com&amp;#34;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.btree&amp;#34;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Tree:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;leaf (size 3)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 0 : 3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 1 : 1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 2 : 2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prints&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;constants&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;.constants&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Constants:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;ROW_SIZE: 293&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;COMMON_NODE_HEADER_SIZE: 6&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_HEADER_SIZE: 10&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_CELL_SIZE: 297&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_SPACE_FOR_CELLS: 4086&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;LEAF_NODE_MAX_CELLS: 13&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;
 &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;ç¬¬ä¹éƒ¨åˆ†---äºŒåˆ†æœç´¢å’Œé‡å¤é”®&#34;&gt;ç¬¬ä¹éƒ¨åˆ† - äºŒåˆ†æœç´¢å’Œé‡å¤é”®&lt;/h2&gt;
&lt;p&gt;ä¸Šæ¬¡æˆ‘ä»¬æŒ‡å‡ºï¼Œæˆ‘ä»¬ä»åœ¨ä»¥æ— åºæ–¹å¼å­˜å‚¨é”®ã€‚æˆ‘ä»¬å°†ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼Œå¹¶æ£€æµ‹å¹¶æ‹’ç»é‡å¤é”®ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œæˆ‘ä»¬çš„ &lt;code&gt;execute_insert()&lt;/code&gt; å‡½æ•°æ€»æ˜¯é€‰æ‹©åœ¨è¡¨çš„æœ«å°¾æ’å…¥ã€‚ç›¸åï¼Œæˆ‘ä»¬åº”è¯¥åœ¨è¡¨ä¸­æœç´¢æ­£ç¡®çš„ä½ç½®ï¼Œç„¶ååœ¨é‚£é‡Œæ’å…¥ã€‚å¦‚æœé”®å·²ç»å­˜åœ¨äºè¯¥ä½ç½®ï¼Œåˆ™è¿”å›é”™è¯¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;n&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;execute_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

   &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_to_insert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table_find&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_at_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key_at_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXECUTE_DUPLICATE_KEY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

   &lt;span class=&#34;n&#34;&gt;leaf_node_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ä¸å†éœ€è¦ &lt;code&gt;table_end()&lt;/code&gt; å‡½æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table_end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬å°†å…¶æ›¿æ¢ä¸ºä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨æ ‘ä¸­æœç´¢ç»™å®šé”®çš„ä½ç½®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+è¿”å›ç»™å®šé”®çš„ä½ç½®ã€‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+å¦‚æœé”®ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›åº”æ’å…¥çš„ä½ç½®ã€‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+*/&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table_find&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_node_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_LEAF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_find&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Need to implement searching an internal node&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘æ­£åœ¨ä¸ºå†…éƒ¨èŠ‚ç‚¹çš„åˆ†æ”¯æä¾›æ¡©ä»£ç ï¼Œå› ä¸ºæˆ‘ä»¬å°šæœªå®ç°å†…éƒ¨èŠ‚ç‚¹ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨äºŒåˆ†æœç´¢æ¥æœç´¢å¶å­èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_find&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// äºŒåˆ†æœç´¢
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;min_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;one_past_max_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;one_past_max_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;min_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;min_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;one_past_max_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_at_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_at_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_at_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;one_past_max_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;min_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;min_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å°†è¿”å›ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é”®çš„ä½ç½®ï¼Œ&lt;/li&gt;
&lt;li&gt;å¦ä¸€ä¸ªé”®çš„ä½ç½®ï¼Œå¦‚æœè¦æ’å…¥æ–°é”®ï¼Œåˆ™éœ€è¦ç§»åŠ¨è¯¥ä½ç½®çš„é”®ï¼Œæˆ–è€…&lt;/li&gt;
&lt;li&gt;æœ€åä¸€ä¸ªé”®ä¹‹åçš„ä½ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç”±äºæˆ‘ä»¬ç°åœ¨æ­£åœ¨æ£€æŸ¥èŠ‚ç‚¹ç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å‡½æ•°æ¥è·å–å¹¶è®¾ç½®èŠ‚ç‚¹ä¸­çš„å€¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodeType&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_node_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint8_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint8_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_TYPE_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NodeType&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;set_node_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NodeType&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint8_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint8_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_TYPE_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬é¦–å…ˆè¦è¿›è¡Œ &lt;code&gt;uint8_t&lt;/code&gt; å¼ºåˆ¶è½¬æ¢ï¼Œä»¥ç¡®ä¿å°†å…¶åºåˆ—åŒ–ä¸ºå•ä¸ªå­—èŠ‚ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è¿˜éœ€è¦åˆå§‹åŒ–èŠ‚ç‚¹ç±»å‹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;initialize_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;initialize_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;set_node_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_LEAF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºå¹¶å¤„ç†ä¸€ä¸ªæ–°çš„é”™è¯¯ä»£ç ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ExecuteResult_t&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;enum&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ExecuteResult_t&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;EXECUTE_DUPLICATE_KEY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;};&lt;/span&gt;
       &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXECUTE_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
         &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Executed.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXECUTE_DUPLICATE_KEY&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error: Duplicate key.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
       &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
         &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Error: Table full.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
         &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡è¿™äº›æ›´æ”¹ï¼Œæˆ‘ä»¬çš„æµ‹è¯•å¯ä»¥æ›´æ”¹ä¸ºæ£€æŸ¥æ˜¯å¦æŒ‰æ’åºé¡ºåºæ’åˆ—ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;       &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
       &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Tree:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
       &lt;span class=&#34;s&#34;&gt;&amp;#34;leaf (size 3)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 0 : 3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 1 : 1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 2 : 2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 0 : 1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 1 : 2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 2 : 3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
       &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬è¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªæ–°çš„æµ‹è¯•ä»¥æ£€æŸ¥é‡å¤é”®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;prints&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;an&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;error&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;message&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;there&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;is&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;duplicate&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 1 user1 person1@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 1 user1 person1@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;select&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Error: Duplicate key.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; (1, user1, person1@example.com)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°±æ˜¯è¿™æ ·ï¼æ¥ä¸‹æ¥ï¼šå®ç°åˆ†è£‚å¶å­èŠ‚ç‚¹å’Œåˆ›å»ºå†…éƒ¨èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬åéƒ¨åˆ†---åˆ†è£‚å¶å­èŠ‚ç‚¹&#34;&gt;ç¬¬åéƒ¨åˆ† - åˆ†è£‚å¶å­èŠ‚ç‚¹&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬çš„ B-Tree åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œçœ‹èµ·æ¥å¹¶ä¸åƒä¸€æ£µæ ‘ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›ä»£ç æ¥å°†å¶å­èŠ‚ç‚¹æ‹†åˆ†ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªå†…éƒ¨èŠ‚ç‚¹ä½œä¸ºä¸¤ä¸ªå¶å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;åŸºæœ¬ä¸Šï¼Œæœ¬æ–‡çš„ç›®æ ‡æ˜¯ä»è¿™ä¸ªçŠ¶æ€ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/btree2.png&#34; alt=&#34;one-node btree&#34;&gt;&lt;/p&gt;
&lt;p&gt;å˜æˆè¿™ä¸ªçŠ¶æ€ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/btree3.png&#34; alt=&#34;two-level btree&#34;&gt;&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ é™¤å¯¹æ»¡å¶å­èŠ‚ç‚¹çš„é”™è¯¯å¤„ç†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;leaf_node_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 
   &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;c1&#34;&gt;// Node full
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Need to implement splitting a leaf node.&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;leaf_node_split_and_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;ExecuteResult&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;execute_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;EXECUTE_TABLE_FULL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
   &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;statement&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_to_insert&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;row_to_insert&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;åˆ†è£‚ç®—æ³•&#34;&gt;åˆ†è£‚ç®—æ³•&lt;/h2&gt;
&lt;p&gt;å®¹æ˜“çš„éƒ¨åˆ†å·²ç»å®Œæˆã€‚ä»¥ä¸‹æ˜¯æ¥è‡ª&lt;a href=&#34;https://play.google.com/store/books/details/Sibsankar_Haldar_SQLite_Database_System_Design_and?id=9Z6IQQnX1JEC&amp;amp;hl=en&#34;&gt;SQLite æ•°æ®åº“ç³»ç»Ÿï¼šè®¾è®¡ä¸å®ç°&lt;/a&gt;çš„æè¿°ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœå¶å­èŠ‚ç‚¹æ²¡æœ‰ç©ºé—´äº†ï¼Œæˆ‘ä»¬ä¼šå°†é©»ç•™åœ¨é‚£é‡Œçš„ç°æœ‰æ¡ç›®å’Œè¦æ’å…¥çš„æ–°æ¡ç›®ï¼ˆæ­£åœ¨æ’å…¥çš„ï¼‰æ‹†åˆ†ä¸ºä¸¤ä¸ªç›¸ç­‰çš„éƒ¨åˆ†ï¼šè¾ƒä½å’Œè¾ƒé«˜çš„éƒ¨åˆ†ã€‚ï¼ˆä¸ŠåŠéƒ¨åˆ†çš„é”®ä¸¥æ ¼å¤§äºä¸‹åŠéƒ¨åˆ†çš„é”®ã€‚ï¼‰æˆ‘ä»¬åˆ†é…ä¸€ä¸ªæ–°çš„å¶å­èŠ‚ç‚¹ï¼Œå¹¶å°†ä¸ŠåŠéƒ¨åˆ†ç§»åŠ¨åˆ°æ–°èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;è®©æˆ‘ä»¬å…ˆè·å–æ—§èŠ‚ç‚¹ï¼Œå¹¶åˆ›å»ºæ–°èŠ‚ç‚¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_split_and_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+  åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹å¹¶å°†ä¸€åŠå•å…ƒæ ¼ç§»åŠ¨è¿‡å»ã€‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+  åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸­çš„ä¸€ä¸ªä¸­æ’å…¥æ–°å€¼ã€‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+  æ›´æ–°çˆ¶èŠ‚ç‚¹æˆ–åˆ›å»ºä¸€ä¸ªæ–°çš„çˆ¶èŠ‚ç‚¹ã€‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+  */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_unused_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;initialize_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;new_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œå°†æ¯ä¸ªå•å…ƒæ ¼å¤åˆ¶åˆ°å®ƒçš„æ–°ä½ç½®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+  æ‰€æœ‰ç°æœ‰é”®ä»¥åŠæ–°é”®åº”è¯¥å‡åŒ€åˆ†å¸ƒ
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+  åœ¨æ—§ï¼ˆå·¦ï¼‰å’Œæ–°ï¼ˆå³ï¼‰èŠ‚ç‚¹ä¹‹é—´ã€‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+  ä»å³ä¾§å¼€å§‹ï¼Œå°†æ¯ä¸ªé”®ç§»åŠ¨åˆ°æ­£ç¡®çš„ä½ç½®ã€‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+  */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;int32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;destination_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_LEFT_SPLIT_COUNT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;destination_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;destination_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index_within_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;%&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_LEFT_SPLIT_COUNT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index_within_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;serialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æ¯ä¸ªèŠ‚ç‚¹çš„å¤´éƒ¨æ›´æ–°å•å…ƒæ ¼è®¡æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;cm&#34;&gt;/* åœ¨ä¸¤ä¸ªå¶å­èŠ‚ç‚¹ä¸Šæ›´æ–°å•å…ƒæ ¼è®¡æ•° */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_LEFT_SPLIT_COUNT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;new_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_RIGHT_SPLIT_COUNT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚å¦‚æœåŸå§‹èŠ‚ç‚¹æ˜¯æ ¹èŠ‚ç‚¹ï¼Œåˆ™å®ƒæ²¡æœ‰çˆ¶èŠ‚ç‚¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ ¹èŠ‚ç‚¹ä½œä¸ºçˆ¶èŠ‚ç‚¹ã€‚æˆ‘ä¼šæš‚æ—¶åˆ›å»ºå¦ä¸€æ”¯çš„æ¡©ä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is_node_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_new_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Need to implement updating parent after split&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;åˆ†é…æ–°é¡µé¢&#34;&gt;åˆ†é…æ–°é¡µé¢&lt;/h2&gt;
&lt;p&gt;è®©æˆ‘ä»¬å›åˆ°å¹¶å®šä¹‰ä¸€äº›æ–°å‡½æ•°å’Œå¸¸é‡ã€‚å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å¶å­èŠ‚ç‚¹æ—¶ï¼Œæˆ‘ä»¬å°†å…¶æ”¾åœ¨ç”± &lt;code&gt;get_unused_page_num()&lt;/code&gt; å†³å®šçš„é¡µé¢ä¸­ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+åœ¨æˆ‘ä»¬å¼€å§‹å›æ”¶ç©ºé—²é¡µé¢ä¹‹å‰ï¼Œæ–°é¡µé¢å°†å§‹ç»ˆ
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+æ·»åŠ åˆ°æ•°æ®åº“æ–‡ä»¶çš„æœ«å°¾
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+*/&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_unused_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_pages&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼Œæˆ‘ä»¬å‡è®¾åœ¨å…·æœ‰ N ä¸ªé¡µé¢çš„æ•°æ®åº“ä¸­ï¼Œé¡µé¢å·ä¸º 0 åˆ° N-1 è¢«åˆ†é…ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ€»æ˜¯ä¸ºæ–°é¡µé¢åˆ†é…é¡µé¢å· Nã€‚æœ€ç»ˆï¼Œåœ¨å®ç°åˆ é™¤åï¼ŒæŸäº›é¡µé¢å¯èƒ½ä¼šå˜ä¸ºç©ºé—²ï¼Œå®ƒä»¬çš„é¡µé¢å·æœªè¢«ä½¿ç”¨ã€‚ä¸ºäº†æ›´é«˜æ•ˆï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°åˆ†é…è¿™äº›ç©ºé—²é¡µé¢ã€‚&lt;/p&gt;
&lt;h3 id=&#34;å¶å­èŠ‚ç‚¹å¤§å°&#34;&gt;å¶å­èŠ‚ç‚¹å¤§å°&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†ä¿æŒæ ‘çš„å¹³è¡¡ï¼Œæˆ‘ä»¬è¦åœ¨ä¸¤ä¸ªæ–°èŠ‚ç‚¹ä¹‹é—´å‡åŒ€åˆ†é…å•å…ƒæ ¼ã€‚å¦‚æœå¶å­èŠ‚ç‚¹å¯ä»¥å®¹çº³ N ä¸ªå•å…ƒæ ¼ï¼Œé‚£ä¹ˆåœ¨æ‹†åˆ†æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´åˆ†é… N+1 ä¸ªå•å…ƒæ ¼ï¼ˆN ä¸ªåŸå§‹å•å…ƒæ ¼åŠ ä¸€ä¸ªæ–°çš„å•å…ƒæ ¼ï¼‰ã€‚æˆ‘éšæ„åœ°é€‰æ‹©å·¦èŠ‚ç‚¹åœ¨ N+1 ä¸ºå¥‡æ•°æ—¶è·å–ä¸€ä¸ªé¢å¤–çš„å•å…ƒæ ¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_RIGHT_SPLIT_COUNT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_LEFT_SPLIT_COUNT&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;LEAF_NODE_MAX_CELLS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_RIGHT_SPLIT_COUNT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;åˆ›å»ºä¸€ä¸ªæ–°çš„æ ¹èŠ‚ç‚¹&#34;&gt;åˆ›å»ºä¸€ä¸ªæ–°çš„æ ¹èŠ‚ç‚¹&lt;/h3&gt;
&lt;p&gt;è¿™æ˜¯&lt;a href=&#34;https://play.google.com/store/books/details/Sibsankar_Haldar_SQLite_Database_System_Design_and?id=9Z6IQQnX1JEC&amp;amp;hl=en&#34;&gt;SQLite æ•°æ®åº“ç³»ç»Ÿ&lt;/a&gt;è§£é‡Šåˆ›å»ºæ–°æ ¹èŠ‚ç‚¹çš„è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è®¾ N ä¸ºæ ¹èŠ‚ç‚¹ã€‚é¦–å…ˆåˆ†é…ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œç§°ä¸º L å’Œ Rã€‚å°† N çš„ä¸‹åŠéƒ¨åˆ†ç§»åŠ¨åˆ° L ä¸­ï¼Œå°†ä¸ŠåŠéƒ¨åˆ†ç§»åŠ¨åˆ° R ä¸­ã€‚ç°åœ¨ N æ˜¯ç©ºçš„ã€‚åœ¨ N ä¸­æ·»åŠ  ã€ˆL, K,Rã€‰ï¼Œå…¶ä¸­ K æ˜¯ L ä¸­çš„æœ€å¤§é”®ã€‚é¡µé¢ N ä»ç„¶æ˜¯æ ¹èŠ‚ç‚¹ã€‚è¯·æ³¨æ„ï¼Œæ ‘çš„æ·±åº¦å¢åŠ äº†ä¸€å±‚ï¼Œä½†æ–°æ ‘ä»ç„¶ä¿æŒå¹³è¡¡ï¼Œä¸è¿åä»»ä½• B+æ ‘å±æ€§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å·²ç»åˆ†é…äº†å³å­èŠ‚ç‚¹å¹¶å°†ä¸ŠåŠéƒ¨åˆ†ç§»åŠ¨åˆ°å®ƒã€‚æˆ‘ä»¬çš„å‡½æ•°æ¥å—å³å­èŠ‚ç‚¹ä½œä¸ºè¾“å…¥ï¼Œå¹¶åˆ†é…ä¸€ä¸ªæ–°é¡µé¢æ¥å­˜å‚¨å·¦å­èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_new_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;right_child_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+  å¤„ç†æ ¹èŠ‚ç‚¹çš„æ‹†åˆ†ã€‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+  å°†æ—§æ ¹å¤åˆ¶åˆ°æ–°é¡µé¢ï¼Œæˆä¸ºå·¦å­èŠ‚ç‚¹ã€‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+  é‡æ–°åˆå§‹åŒ–æ ¹é¡µä»¥åŒ…å«æ–°æ ¹èŠ‚ç‚¹ã€‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+  æ–°æ ¹èŠ‚ç‚¹æŒ‡å‘ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+  */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;right_child&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;right_child_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;left_child_page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_unused_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;left_child&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;left_child_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å°†æ—§æ ¹å¤åˆ¶åˆ°å·¦å­èŠ‚ç‚¹ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥é‡ç”¨æ ¹é¡µï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;cm&#34;&gt;/* å·¦å­èŠ‚ç‚¹æœ‰ä»æ—§æ ¹å¤åˆ¶çš„æ•°æ® */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;left_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PAGE_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;set_node_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;left_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åï¼Œå°†æ ¹é¡µåˆå§‹åŒ–ä¸ºä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹çš„æ–°å†…éƒ¨èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;cm&#34;&gt;/* æ ¹èŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ–°çš„å†…éƒ¨èŠ‚ç‚¹ï¼Œæœ‰ä¸€ä¸ªé”®å’Œä¸¤ä¸ªå­èŠ‚ç‚¹ */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;initialize_internal_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;set_node_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;left_child_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;left_child_max_key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_node_max_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;left_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;left_child_max_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_right_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;right_child_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å†…éƒ¨èŠ‚ç‚¹æ ¼å¼&#34;&gt;å†…éƒ¨èŠ‚ç‚¹æ ¼å¼&lt;/h3&gt;
&lt;p&gt;ç°åœ¨æˆ‘ä»¬ç»ˆäºè¦åˆ›å»ºä¸€ä¸ªå†…éƒ¨èŠ‚ç‚¹äº†ï¼Œæˆ‘ä»¬å¿…é¡»å®šä¹‰å…¶å¸ƒå±€ã€‚å®ƒä»¥é€šç”¨å¤´éƒ¨å¼€å§‹ï¼Œç„¶åæ˜¯å®ƒåŒ…å«çš„é”®çš„æ•°é‡ï¼Œç„¶åæ˜¯å…¶æœ€å³ä¾§å­èŠ‚ç‚¹çš„é¡µå·ã€‚å†…éƒ¨èŠ‚ç‚¹å§‹ç»ˆæ¯”é”®å¤šä¸€ä¸ªå­èŠ‚ç‚¹æŒ‡é’ˆã€‚è¿™ä¸ªé¢å¤–çš„å­èŠ‚ç‚¹æŒ‡é’ˆå­˜å‚¨åœ¨å¤´éƒ¨ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+ * å†…éƒ¨èŠ‚ç‚¹å¤´éƒ¨å¸ƒå±€
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+ */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_NUM_KEYS_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_NUM_KEYS_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_RIGHT_CHILD_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_RIGHT_CHILD_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_NUM_KEYS_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_NUM_KEYS_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;                                           &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_NUM_KEYS_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;                                           &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_RIGHT_CHILD_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å…¶ä¸»ä½“æ˜¯ä¸€ä¸ªåŒ…å«å­èŠ‚ç‚¹å’Œé”®çš„å•å…ƒæ ¼æ•°ç»„ã€‚æ¯ä¸ªé”®åº”è¯¥æ˜¯å…¶å·¦ä¾§å­èŠ‚ç‚¹ä¸­åŒ…å«çš„æœ€å¤§é”®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+ * å†…éƒ¨èŠ‚ç‚¹ä¸»ä½“å¸ƒå±€
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+ */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_KEY_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_CHILD_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_CELL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_CHILD_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_KEY_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åŸºäºè¿™äº›å¸¸é‡ï¼Œè¿™é‡Œæ˜¯å†…éƒ¨èŠ‚ç‚¹å¸ƒå±€çš„æ ·å­ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/internal-node-format.png&#34; alt=&#34;Our internal node format&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¯·æ³¨æ„æˆ‘ä»¬çš„å·¨å¤§åˆ†æ”¯å› å­ã€‚å› ä¸ºæ¯ä¸ªå­èŠ‚ç‚¹/é”®å¯¹éƒ½éå¸¸å°ï¼Œæ‰€ä»¥æ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹å¯ä»¥å®¹çº³ 510 ä¸ªé”®å’Œ 511 ä¸ªå­èŠ‚ç‚¹æŒ‡é’ˆã€‚è¿™æ„å‘³ç€æˆ‘ä»¬æ°¸è¿œä¸å¿…éå†è®¸å¤šå±‚æ ‘æ¥æŸ¥æ‰¾ç»™å®šçš„é”®ï¼&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;# å†…éƒ¨èŠ‚ç‚¹å±‚æ•°&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;æœ€å¤§ # å¶å­èŠ‚ç‚¹&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;æ‰€æœ‰å¶å­èŠ‚ç‚¹çš„å¤§å°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;0&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;511^0 = 1&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;4 KB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;1&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;511^1 = 512&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;~2 MB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;2&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;511^2 = 261,121&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;~1 GB&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;3&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;511^3 = 133,432,831&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;~550 GB&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å®é™…ä¸Šï¼Œç”±äºå¤´éƒ¨ã€é”®å’Œæµªè´¹ç©ºé—´çš„å¼€é”€ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨æ¯ä¸ªå¶å­èŠ‚ç‚¹ä¸­å­˜å‚¨å®Œæ•´çš„ 4 KB æ•°æ®ã€‚ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»…åŠ è½½ç£ç›˜ä¸Šçš„ 4 é¡µæ¥æœç´¢å¤§çº¦ 500 GB çš„æ•°æ®ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ B-Tree å¯¹äºæ•°æ®åº“æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„æ•°æ®ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæ˜¯è¯»å–å’Œå†™å…¥å†…éƒ¨èŠ‚ç‚¹çš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_NUM_KEYS_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_right_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_RIGHT_CHILD_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_keys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;child_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tried to access child_num %d &amp;gt; num_keys %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;child_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_right_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_CHILD_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¯¹äºå†…éƒ¨èŠ‚ç‚¹ï¼Œæœ€å¤§é”®å€¼å§‹ç»ˆæ˜¯å®ƒçš„å³é”®ã€‚è€Œå¯¹äºå¶èŠ‚ç‚¹ï¼Œåˆ™æ˜¯æœ€å¤§ç´¢å¼•å¤„çš„é”®å€¼ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_node_max_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_node_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nl&#34;&gt;NODE_INTERNAL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nl&#34;&gt;NODE_LEAF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;è·Ÿè¸ªæ ¹èŠ‚ç‚¹çŠ¶æ€&#34;&gt;è·Ÿè¸ªæ ¹èŠ‚ç‚¹çŠ¶æ€&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬ç»ˆäºåœ¨é€šç”¨èŠ‚ç‚¹å¤´éƒ¨ä½¿ç”¨äº† &lt;code&gt;is_root&lt;/code&gt; å­—æ®µã€‚å›æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥å†³å®šå¦‚ä½•æ‹†åˆ†å¶èŠ‚ç‚¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is_node_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_new_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Need to implement updating parent after split&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸‹æ˜¯è·å–å™¨å’Œè®¾ç½®å™¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;is_node_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint8_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint8_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IS_ROOT_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;set_node_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;bool&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;is_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint8_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;is_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint8_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;IS_ROOT_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åˆå§‹åŒ–ä¸¤ç§ç±»å‹çš„èŠ‚ç‚¹åº”é»˜è®¤å°† &lt;code&gt;is_root&lt;/code&gt; è®¾ç½®ä¸º falseï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;initialize_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;set_node_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_LEAF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;set_node_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;initialize_internal_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;set_node_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_INTERNAL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;set_node_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨åˆ›å»ºè¡¨çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œæˆ‘ä»¬åº”å°† &lt;code&gt;is_root&lt;/code&gt; è®¾ç½®ä¸º trueï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;     &lt;span class=&#34;c1&#34;&gt;// New database file. Initialize page 0 as leaf node.
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;     &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;initialize_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;set_node_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 
   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æ‰“å°æ ‘ç»“æ„&#34;&gt;æ‰“å°æ ‘ç»“æ„&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†å¸®åŠ©å¯è§†åŒ–æ•°æ®åº“çš„çŠ¶æ€ï¼Œæˆ‘ä»¬åº”è¯¥æ›´æ–° &lt;code&gt;.btree&lt;/code&gt; å…ƒå‘½ä»¤ä»¥æ‰“å°å¤šçº§æ ‘ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å°†æ›¿æ¢å½“å‰çš„ &lt;code&gt;print_leaf_node()&lt;/code&gt; å‡½æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;print_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;leaf (size %d)&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;  - %d : %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½¿ç”¨ä¸€ä¸ªæ–°çš„é€’å½’å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä»»ä½•èŠ‚ç‚¹ï¼Œç„¶åæ‰“å°èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹ã€‚è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªç¼©è¿›çº§åˆ«ä½œä¸ºå‚æ•°ï¼Œå¹¶éšç€æ¯æ¬¡é€’å½’è°ƒç”¨è€Œå¢åŠ ã€‚æˆ‘è¿˜æ·»åŠ äº†ä¸€ä¸ªå°çš„ç¼©è¿›è¾…åŠ©å‡½æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;indent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;level&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;  &amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;print_tree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Pager&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;indentation_level&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_node_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NODE_LEAF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;num_keys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;indent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;indentation_level&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;- leaf (size %d)&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;indent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;indentation_level&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;- %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;NODE_INTERNAL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;num_keys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;indent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;indentation_level&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;- internal (size %d)&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;print_tree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;indentation_level&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;indent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;indentation_level&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;- key %d&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_right_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;print_tree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;indentation_level&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;k&#34;&gt;break&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¹¶ä¸”æ›´æ–°å¯¹æ‰“å°å‡½æ•°çš„è°ƒç”¨ï¼Œä¼ å…¥ç¼©è¿›çº§åˆ«ä¸ºé›¶ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;strcmp&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;input_buffer&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;buffer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.btree&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Tree:&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;print_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;print_tree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
     &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;META_COMMAND_SUCCESS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ˜¯æ–°æ‰“å°åŠŸèƒ½çš„æµ‹è¯•ç”¨ä¾‹ï¼&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;allows&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;printing&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;structure&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;btree&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1..14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;map&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert #{i} user#{i} person#{i}@example.com&amp;#34;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.btree&amp;#34;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 15 user15 person15@example.com&amp;#34;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;14.&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;..(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Tree:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;- internal (size 1)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - leaf (size 7)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;    - 1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;    - 2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;    - 3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;    - 4&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;    - 5&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;    - 6&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;    - 7&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - key 7&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - leaf (size 7)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;    - 8&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;    - 9&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;    - 10&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;    - 11&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;    - 12&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;    - 13&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;    - 14&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Need to implement searching an internal node&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ–°æ ¼å¼æœ‰äº›ç®€åŒ–ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ›´æ–°ç°æœ‰çš„ &lt;code&gt;.btree&lt;/code&gt; æµ‹è¯•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;       &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
       &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
       &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Tree:&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;leaf (size 3)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 0 : 1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 1 : 2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 2 : 3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;- leaf (size 3)&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;  - 3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
       &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; &amp;#34;&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æ˜¯æ–°æµ‹è¯•çš„ &lt;code&gt;.btree&lt;/code&gt; è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;nl&#34;&gt;Tree&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;13&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨æœ€å°‘ç¼©è¿›çš„çº§åˆ«ä¸Šï¼Œæˆ‘ä»¬çœ‹åˆ°äº†æ ¹èŠ‚ç‚¹ï¼ˆå†…éƒ¨èŠ‚ç‚¹ï¼‰ã€‚å®ƒè¯´ &lt;code&gt;size 1&lt;/code&gt;ï¼Œå› ä¸ºå®ƒæœ‰ä¸€ä¸ªé”®ã€‚ç¼©è¿›ä¸€çº§ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä¸€ä¸ªå¶èŠ‚ç‚¹ã€ä¸€ä¸ªé”®ï¼Œå’Œå¦ä¸€ä¸ªå¶èŠ‚ç‚¹ã€‚æ ¹èŠ‚ç‚¹ä¸­çš„é”®å€¼ï¼ˆ7ï¼‰æ˜¯ç¬¬ä¸€ä¸ªå¶èŠ‚ç‚¹ä¸­çš„æœ€å¤§é”®å€¼ã€‚å¤§äº 7 çš„æ¯ä¸ªé”®éƒ½åœ¨ç¬¬äºŒä¸ªå¶èŠ‚ç‚¹ä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸€ä¸ªå¤§é—®é¢˜&#34;&gt;ä¸€ä¸ªå¤§é—®é¢˜&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½ ä¸€ç›´å¯†åˆ‡å…³æ³¨ï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°æˆ‘ä»¬æ¼æ‰äº†ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ã€‚çœ‹çœ‹å¦‚æœæˆ‘ä»¬å°è¯•æ’å…¥ä¸€è¡Œé¢å¤–çš„æ•°æ®ä¼šå‘ç”Ÿä»€ä¹ˆï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;insert&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user15&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person15&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Need&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;implement&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;searching&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;an&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å“å‘€ï¼è°å†™äº†è¿™ä¸ª TODO æç¤ºï¼Ÿ :P&lt;/p&gt;
&lt;p&gt;ä¸‹æ¬¡æˆ‘ä»¬å°†ç»§ç»­ B æ ‘çš„å²è¯—æ•…äº‹ï¼Œå®ç°åœ¨å¤šçº§æ ‘ä¸Šçš„æœç´¢ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬åä¸€éƒ¨åˆ†---é€’å½’æœç´¢-b-æ ‘&#34;&gt;ç¬¬åä¸€éƒ¨åˆ† - é€’å½’æœç´¢ B æ ‘&lt;/h2&gt;
&lt;p&gt;ä¸Šæ¬¡æˆ‘ä»¬åœ¨æ’å…¥ç¬¬ 15 è¡Œæ—¶å‡ºç°äº†é”™è¯¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;insert&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user15&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person15&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Need&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;to&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;implement&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;searching&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;an&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é¦–å…ˆï¼Œç”¨ä¸€ä¸ªæ–°çš„å‡½æ•°è°ƒç”¨æ›¿æ¢ä»£ç å­˜æ ¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_node_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_LEAF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_find&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_find&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸ªå‡½æ•°å°†æ‰§è¡ŒäºŒåˆ†æœç´¢ï¼Œä»¥æ‰¾åˆ°åº”åŒ…å«ç»™å®šé”®çš„å­èŠ‚ç‚¹ã€‚è®°ä½ï¼Œæ¯ä¸ªå­æŒ‡é’ˆå³ä¾§çš„é”®æ˜¯è¯¥å­èŠ‚ç‚¹åŒ…å«çš„æœ€å¤§é”®ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/btree6.png&#34; alt=&#34;three-level btree&#34;&gt;&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œæˆ‘ä»¬çš„äºŒåˆ†æœç´¢æ¯”è¾ƒè¦æ‰¾åˆ°çš„é”®å’Œå­èŠ‚ç‚¹æŒ‡é’ˆå³ä¾§çš„é”®ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internal_node_find&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_keys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;

  &lt;span class=&#34;cm&#34;&gt;/* Binary search to find index of child to search */&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;min_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;cm&#34;&gt;/* there is one more child than key */&lt;/span&gt;

  &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;min_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;min_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_to_right&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key_to_right&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;max_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
      &lt;span class=&#34;n&#34;&gt;min_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿˜è¦è®°ä½ï¼Œå†…éƒ¨èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å¯ä»¥æ˜¯å¶èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥æ˜¯æ›´å¤šçš„å†…éƒ¨èŠ‚ç‚¹ã€‚åœ¨æ‰¾åˆ°æ­£ç¡®çš„å­èŠ‚ç‚¹åï¼Œåœ¨å…¶ä¸Šè°ƒç”¨é€‚å½“çš„æœç´¢å‡½æ•°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;min_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;k&#34;&gt;switch&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get_node_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nl&#34;&gt;NODE_LEAF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_find&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
    &lt;span class=&#34;k&#34;&gt;case&lt;/span&gt; &lt;span class=&#34;nl&#34;&gt;NODE_INTERNAL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
      &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_find&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;æµ‹è¯•&#34;&gt;æµ‹è¯•&lt;/h3&gt;
&lt;p&gt;ç°åœ¨åœ¨å¤šèŠ‚ç‚¹ B æ ‘ä¸­æ’å…¥ä¸€ä¸ªé”®ä¸å†å¯¼è‡´é”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥æ›´æ–°æˆ‘ä»¬çš„æµ‹è¯•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;       &amp;#34;    - 12&amp;#34;,
       &amp;#34;    - 13&amp;#34;,
       &amp;#34;    - 14&amp;#34;,
-      &amp;#34;db &amp;gt; Need to implement searching an internal node&amp;#34;,
+      &amp;#34;db &amp;gt; Executed.&amp;#34;,
+      &amp;#34;db &amp;gt; &amp;#34;,
     ])
   end
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä¹Ÿè®¤ä¸ºæ˜¯æ—¶å€™é‡æ–°å®¡è§†å¦ä¸€ä¸ªæµ‹è¯•äº†ã€‚è¯•å›¾æ’å…¥ 1400 è¡Œçš„æµ‹è¯•ã€‚å®ƒä»ç„¶å‡ºé”™ï¼Œä½†é”™è¯¯æ¶ˆæ¯æ˜¯æ–°çš„ã€‚ç›®å‰ï¼Œæˆ‘ä»¬çš„æµ‹è¯•åœ¨ç¨‹åºå´©æºƒæ—¶å¤„ç†å¾—å¹¶ä¸å¥½ã€‚å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œè®©æˆ‘ä»¬åªä½¿ç”¨åˆ°ç›®å‰ä¸ºæ­¢å¾—åˆ°çš„è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;     raw_output = nil
     IO.popen(&amp;#34;./db test.db&amp;#34;, &amp;#34;r+&amp;#34;) do |pipe|
       commands.each do |command|
-        pipe.puts command
+        begin
+          pipe.puts command
+        rescue Errno::EPIPE
+          break
+        end
       end

       pipe.close_write
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™æš´éœ²äº†æˆ‘ä»¬ 1400 è¡Œæµ‹è¯•çš„é”™è¯¯è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;     end
     script &amp;lt;&amp;lt; &amp;#34;.exit&amp;#34;
     result = run_script(script)
-    expect(result[-2]).to eq(&amp;#39;db &amp;gt; Error: Table full.&amp;#39;)
+    expect(result.last(2)).to match_array([
+      &amp;#34;db &amp;gt; Executed.&amp;#34;,
+      &amp;#34;db &amp;gt; Need to implement updating parent after split&amp;#34;,
+    ])
   end
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;çœ‹èµ·æ¥è¿™æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦åšçš„äº‹æƒ…ï¼&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬åäºŒéƒ¨åˆ†---æ‰«æå¤šå±‚-b-æ ‘&#34;&gt;ç¬¬åäºŒéƒ¨åˆ† - æ‰«æå¤šå±‚ B æ ‘&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬ç°åœ¨æ”¯æŒæ„å»ºå¤šå±‚ B æ ‘ï¼Œä½†åœ¨æ­¤è¿‡ç¨‹ä¸­æˆ‘ä»¬ç ´åäº† &lt;code&gt;select&lt;/code&gt; è¯­å¥ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ï¼Œæ’å…¥äº† 15 è¡Œç„¶åå°è¯•æ‰“å°å®ƒä»¬ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gi&#34;&gt;+  it &amp;#39;prints all rows in a multi-level tree&amp;#39; do
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    script = []
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    (1..15).each do |i|
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      script &amp;lt;&amp;lt; &amp;#34;insert #{i} user#{i} person#{i}@example.com&amp;#34;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    end
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    script &amp;lt;&amp;lt; &amp;#34;select&amp;#34;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    script &amp;lt;&amp;lt; &amp;#34;.exit&amp;#34;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    result = run_script(script)
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    expect(result[15...result.length]).to match_array([
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;db &amp;gt; (1, user1, person1@example.com)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;(2, user2, person2@example.com)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;(3, user3, person3@example.com)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;(4, user4, person4@example.com)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;(5, user5, person5@example.com)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;(6, user6, person6@example.com)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;(7, user7, person7@example.com)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;(8, user8, person8@example.com)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;(9, user9, person9@example.com)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;(10, user10, person10@example.com)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;(11, user11, person11@example.com)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;(12, user12, person12@example.com)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;(13, user13, person13@example.com)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;(14, user14, person14@example.com)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;(15, user15, person15@example.com)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;Executed.&amp;#34;, &amp;#34;db &amp;gt; &amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    ])
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  end
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä½†å½“æˆ‘ä»¬ç°åœ¨è¿è¡Œè¯¥æµ‹è¯•æ¡ˆä¾‹æ—¶ï¼Œå®é™…å‘ç”Ÿçš„æ˜¯ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Executed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™å¾ˆå¥‡æ€ªã€‚åªæ‰“å°äº†ä¸€è¡Œï¼Œå¹¶ä¸”è¯¥è¡Œçœ‹èµ·æ¥æŸåäº†ï¼ˆæ³¨æ„ id ä¸åŒ¹é…ç”¨æˆ·åï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ç§å¥‡æ€ªç°è±¡æ˜¯å› ä¸º &lt;code&gt;execute_select()&lt;/code&gt; ä»è¡¨çš„å¼€å¤´å¼€å§‹ï¼Œè€Œæˆ‘ä»¬å½“å‰çš„ &lt;code&gt;table_start()&lt;/code&gt; å®ç°è¿”å›æ ¹èŠ‚ç‚¹çš„ç¬¬ 0 ä¸ªå•å…ƒæ ¼ã€‚ä½†æ˜¯æˆ‘ä»¬çš„æ ‘çš„æ ¹ç°åœ¨æ˜¯ä¸€ä¸ªå†…éƒ¨èŠ‚ç‚¹ï¼Œå®ƒä¸åŒ…å«ä»»ä½•è¡Œã€‚æ‰“å°å‡ºæ¥çš„æ•°æ®å¿…é¡»æ˜¯å½“æ ¹èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹æ—¶ç•™ä¸‹çš„ã€‚&lt;code&gt;execute_select()&lt;/code&gt; å®é™…ä¸Šåº”è¯¥è¿”å›æœ€å·¦è¾¹å¶å­èŠ‚ç‚¹çš„ç¬¬ 0 ä¸ªå•å…ƒæ ¼ã€‚&lt;/p&gt;
&lt;p&gt;å› æ­¤ï¼Œå»æ‰æ—§çš„å®ç°ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table_start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;malloc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¹¶æ·»åŠ ä¸€ä¸ªæ–°çš„å®ç°ï¼Œæœç´¢é”®ä¸º 0ï¼ˆå¯èƒ½ä¸å­˜åœ¨äºè¡¨ä¸­ï¼Œä½†æ­¤æ–¹æ³•å°†è¿”å›æœ€å° id çš„ä½ç½®ï¼Œå³æœ€å·¦å¶å­èŠ‚ç‚¹çš„å¼€å¤´ï¼‰ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table_start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;table_find&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end_of_table&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;num_cells&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰äº†è¿™äº›æ›´æ”¹ï¼Œå®ƒä»ç„¶åªæ‰“å°äº†ä¸€èŠ‚ç‚¹çš„è¡Œï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person5&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person6&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person7&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Executed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ‰ 15 æ¡ç›®ï¼Œæˆ‘ä»¬çš„ B æ ‘åŒ…å«ä¸€ä¸ªå†…éƒ¨èŠ‚ç‚¹å’Œä¸¤ä¸ªå¶å­èŠ‚ç‚¹ï¼Œå¤§è‡´å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/btree3.png&#34; alt=&#34;æˆ‘ä»¬çš„ B æ ‘ç»“æ„&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ‰«ææ•´ä¸ªè¡¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åˆ°è¾¾ç¬¬ä¸€ä¸ªå¶å­èŠ‚ç‚¹çš„æœ«å°¾åè·³è½¬åˆ°ç¬¬äºŒä¸ªå¶å­èŠ‚ç‚¹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†åœ¨å¶å­èŠ‚ç‚¹å¤´éƒ¨æ·»åŠ ä¸€ä¸ªæ–°çš„å­—æ®µï¼Œç§°ä¸º â€œnext_leafâ€ï¼Œå®ƒå°†ä¿å­˜å³ä¾§å¶å­èŠ‚ç‚¹çš„é¡µé¢å·ã€‚æœ€å³ä¾§çš„å¶å­èŠ‚ç‚¹çš„ &lt;code&gt;next_leaf&lt;/code&gt; å€¼å°†ä¸º 0ï¼Œè¡¨ç¤ºæ²¡æœ‰å…„å¼ŸèŠ‚ç‚¹ï¼ˆé¡µé¢ 0 é€šå¸¸ä¿ç•™ç»™è¡¨çš„æ ¹èŠ‚ç‚¹ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;æ›´æ–°å¶å­èŠ‚ç‚¹å¤´éƒ¨æ ¼å¼ä»¥åŒ…æ‹¬æ–°çš„å­—æ®µï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NUM_CELLS_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NUM_CELLS_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NUM_CELLS_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NEXT_LEAF_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NEXT_LEAF_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NUM_CELLS_OFFSET&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NUM_CELLS_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;COMMON_NODE_HEADER_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;                                       &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NUM_CELLS_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;                                       &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NEXT_LEAF_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ·»åŠ ä¸€ä¸ªè®¿é—®æ–°å­—æ®µçš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_next_leaf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_NEXT_LEAF_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨åˆå§‹åŒ–æ–°çš„å¶å­èŠ‚ç‚¹æ—¶ï¼Œé»˜è®¤å°† &lt;code&gt;next_leaf&lt;/code&gt; è®¾ç½®ä¸º 0ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;322&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;330&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;initialize_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;set_node_type&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;NODE_LEAF&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;set_node_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;false&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_num_cells&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_next_leaf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;// 0 è¡¨ç¤ºæ— å…„å¼ŸèŠ‚ç‚¹
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¯å½“æˆ‘ä»¬æ‹†åˆ†å¶å­èŠ‚ç‚¹æ—¶ï¼Œæ›´æ–°å…„å¼ŸèŠ‚ç‚¹æŒ‡é’ˆã€‚æ—§å¶å­èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹å˜æˆæ–°çš„å¶å­èŠ‚ç‚¹ï¼Œæ–°å¶å­èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹å˜æˆæ—§å¶å­èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;659&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;671&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_split_and_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_unused_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;initialize_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;new_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_next_leaf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;new_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_next_leaf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_next_leaf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ·»åŠ æ–°å­—æ®µä¼šæ›´æ”¹ä¸€äº›å¸¸é‡ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;   it &amp;#39;prints constants&amp;#39; do
     script = [
       &amp;#34;.constants&amp;#34;,
&lt;span class=&#34;gu&#34;&gt;@@ -199,9 +228,9 @@ describe &amp;#39;database&amp;#39; do
&lt;/span&gt;&lt;span class=&#34;gu&#34;&gt;&lt;/span&gt;       &amp;#34;db &amp;gt; Constants:&amp;#34;,
       &amp;#34;ROW_SIZE: 293&amp;#34;,
       &amp;#34;COMMON_NODE_HEADER_SIZE: 6&amp;#34;,
&lt;span class=&#34;gd&#34;&gt;-      &amp;#34;LEAF_NODE_HEADER_SIZE: 10&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;LEAF_NODE_HEADER_SIZE: 14&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;       &amp;#34;LEAF_NODE_CELL_SIZE: 297&amp;#34;,
&lt;span class=&#34;gd&#34;&gt;-      &amp;#34;LEAF_NODE_SPACE_FOR_CELLS: 4086&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;LEAF_NODE_SPACE_FOR_CELLS: 4082&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;       &amp;#34;LEAF_NODE_MAX_CELLS: 13&amp;#34;,
       &amp;#34;db &amp;gt; &amp;#34;,
     ])
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼Œæ¯å½“æˆ‘ä»¬æƒ³è¦æ¨è¿›æ¸¸æ ‡è¶…å‡ºå¶å­èŠ‚ç‚¹çš„æœ«å°¾æ—¶ï¼Œå¯ä»¥æ£€æŸ¥å¶å­èŠ‚ç‚¹æ˜¯å¦æœ‰å…„å¼ŸèŠ‚ç‚¹ã€‚å¦‚æœæœ‰ï¼Œå°±è·³åˆ°å…„å¼ŸèŠ‚ç‚¹ï¼›å¦åˆ™ï¼Œæˆ‘ä»¬åˆ°è¾¾è¡¨çš„æœ«å°¾ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gu&#34;&gt;@@ -428,7 +432,15 @@ void cursor_advance(Cursor* cursor) {
&lt;/span&gt;&lt;span class=&#34;gu&#34;&gt;&lt;/span&gt; 
   cursor-&amp;gt;cell_num += 1;
   if (cursor-&amp;gt;cell_num &amp;gt;= (*leaf_node_num_cells(node))) {
&lt;span class=&#34;gd&#34;&gt;-    cursor-&amp;gt;end_of_table = true;
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    /* å‰è¿›åˆ°ä¸‹ä¸€ä¸ªå¶å­èŠ‚ç‚¹ */
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    uint32_t next_page_num = *leaf_node_next_leaf(node);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    if (next_page_num == 0) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      /* è¿™æ˜¯æœ€å³è¾¹çš„å¶å­èŠ‚ç‚¹ */
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      cursor-&amp;gt;end_of_table = true;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    } else {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      cursor-&amp;gt;page_num = next_page_num;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      cursor-&amp;gt;cell_num = 0;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   }
 }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨è¿™äº›æ›´æ”¹ä¹‹åï¼Œæˆ‘ä»¬å®é™…ä¸Šæ‰“å°äº† 15 è¡Œ&amp;hellip;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person5&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person6&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person7&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person9&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person10&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user11&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person11&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person12&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user13&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person13&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1919251317&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;on14&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person15&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Executed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&amp;hellip;ä½†å…¶ä¸­ä¸€è¡Œçœ‹èµ·æ¥æŸåäº†ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;(1919251317, 14, on14@example.com)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç»è¿‡ä¸€äº›è°ƒè¯•ï¼Œæˆ‘å‘ç°æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨æ‹†åˆ†å¶å­èŠ‚ç‚¹æ—¶å­˜åœ¨ä¸€ä¸ª bugï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;676&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;690&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_split_and_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index_within_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 
     &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;serialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;serialize_row&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;                    &lt;span class=&#34;n&#34;&gt;leaf_node_value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index_within_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index_within_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cell_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
       &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;LEAF_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯·è®°ä½ï¼Œå¶å­èŠ‚ç‚¹ä¸­çš„æ¯ä¸ªå•å…ƒæ ¼é¦–å…ˆæ˜¯ä¸€ä¸ªé”®ï¼Œç„¶åæ˜¯ä¸€ä¸ªå€¼ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/leaf-node-format.png&#34; alt=&#34;åŸå§‹å¶å­èŠ‚ç‚¹æ ¼å¼&#34;&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬å°†æ–°è¡Œï¼ˆå€¼ï¼‰å†™å…¥äº†å•å…ƒæ ¼çš„å¼€å¤´ï¼Œè€Œå…¶ä¸­åº”è¯¥æ”¾ç½®é”®ã€‚è¿™æ„å‘³ç€ç”¨æˆ·åçš„ä¸€éƒ¨åˆ†è¿›å…¥äº† id çš„éƒ¨åˆ†ï¼ˆå› æ­¤ id å¾ˆå¤§ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ä¿®å¤äº†è¿™ä¸ª bug ä¹‹åï¼Œæˆ‘ä»¬æœ€ç»ˆæŒ‰é¢„æœŸæ‰“å°äº†æ•´ä¸ªè¡¨ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user4&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person5&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user6&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person6&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person7&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person8&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user9&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person9&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person10&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user11&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person11&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user12&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person12&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;13&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user13&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person13&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user14&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person14&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;user15&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;person15&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;example&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;com&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Executed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å“‡ï¼ä¸€ä¸ªæ¥ä¸€ä¸ªçš„ bugï¼Œä½†æˆ‘ä»¬æ­£åœ¨å–å¾—è¿›å±•ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹æ¬¡å†è§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬åä¸‰éƒ¨åˆ†---åˆ†è£‚å¶å­èŠ‚ç‚¹åæ›´æ–°çˆ¶èŠ‚ç‚¹&#34;&gt;ç¬¬åä¸‰éƒ¨åˆ† - åˆ†è£‚å¶å­èŠ‚ç‚¹åæ›´æ–°çˆ¶èŠ‚ç‚¹&lt;/h2&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬å²è¯—èˆ¬çš„ B æ ‘å®ç°æ—…ç¨‹ä¸­çš„ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬å°†å¤„ç†åˆ†è£‚å¶å­èŠ‚ç‚¹åä¿®å¤çˆ¶èŠ‚ç‚¹ã€‚æˆ‘å°†ä½¿ç”¨ä»¥ä¸‹ç¤ºä¾‹ä½œä¸ºå‚è€ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/updating-internal-node.png&#34; alt=&#34;æ›´æ–°å†…éƒ¨èŠ‚ç‚¹ç¤ºä¾‹&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†é”®â€œ3â€æ·»åŠ åˆ°æ ‘ä¸­ã€‚è¿™å¯¼è‡´å·¦å¶å­èŠ‚ç‚¹åˆ†è£‚ã€‚åœ¨åˆ†è£‚åï¼Œæˆ‘ä»¬è¿›è¡Œä»¥ä¸‹æ“ä½œæ¥ä¿®å¤æ ‘ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å°†çˆ¶èŠ‚ç‚¹ä¸­çš„ç¬¬ä¸€ä¸ªé”®æ›´æ–°ä¸ºå·¦å­èŠ‚ç‚¹ä¸­çš„æœ€å¤§é”®ï¼ˆâ€œ3â€ï¼‰&lt;/li&gt;
&lt;li&gt;åœ¨æ›´æ–°åçš„é”®ä¹‹åæ·»åŠ ä¸€ä¸ªæ–°çš„å­èŠ‚ç‚¹/é”®å¯¹
&lt;ul&gt;
&lt;li&gt;æ–°æŒ‡é’ˆæŒ‡å‘æ–°çš„å­èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;æ–°é”®æ˜¯æ–°å­èŠ‚ç‚¹ä¸­çš„æœ€å¤§é”®ï¼ˆâ€œ5â€ï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é¦–å…ˆï¼Œæ›¿æ¢æˆ‘ä»¬çš„å­˜æ ¹ä»£ç ä¸ºä¸¤ä¸ªæ–°çš„å‡½æ•°è°ƒç”¨ï¼š&lt;code&gt;update_internal_node_key()&lt;/code&gt; ç”¨äºæ­¥éª¤ 1 å’Œ &lt;code&gt;internal_node_insert()&lt;/code&gt; ç”¨äºæ­¥éª¤ 2ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;670&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;725&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_split_and_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;err&#34;&gt;*/&lt;/span&gt;
 
   &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;old_max&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_node_max_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_unused_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;n&#34;&gt;initialize_leaf_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;new_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node_parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;new_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node_parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_next_leaf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;new_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_next_leaf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf_node_next_leaf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;709&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;766&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf_node_split_and_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;Row&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;value&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;is_node_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
     &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_new_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Need to implement updating parent after split&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;parent_page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node_parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_max&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_node_max_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;old_node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;parent&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;parent_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;update_internal_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;old_max&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_max&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;internal_node_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cursor&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;parent_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸ºäº†è·å–çˆ¶èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œæˆ‘ä»¬éœ€è¦å¼€å§‹åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­è®°å½•æŒ‡å‘å…¶çˆ¶èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node_parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;PARENT_POINTER_OFFSET&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;660&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;675&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;48&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;create_new_root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;right_child_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
   &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;left_child_max_key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_node_max_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;left_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;left_child_max_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
   &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_right_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;right_child_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node_parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;left_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node_parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;right_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;root_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æˆ‘ä»¬éœ€è¦æ‰¾åˆ°å—å½±å“çš„çˆ¶èŠ‚ç‚¹ä¸­çš„å•å…ƒæ ¼ã€‚å­èŠ‚ç‚¹ä¸çŸ¥é“è‡ªå·±çš„é¡µé¢å·ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•æŸ¥æ‰¾å®ƒã€‚ä½†æ˜¯å®ƒçŸ¥é“è‡ªå·±çš„æœ€å¤§é”®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨çˆ¶èŠ‚ç‚¹ä¸­æœç´¢è¯¥é”®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;update_internal_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;old_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;old_child_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_find_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;old_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;old_child_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;new_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;åœ¨ &lt;code&gt;internal_node_find_child()&lt;/code&gt; ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç”¨å·²ç»å­˜åœ¨çš„ç”¨äºåœ¨å†…éƒ¨èŠ‚ç‚¹ä¸­æŸ¥æ‰¾é”®çš„ä¸€äº›ä»£ç ã€‚é‡æ„ &lt;code&gt;internal_node_find()&lt;/code&gt; ä»¥ä½¿ç”¨æ–°çš„è¾…åŠ©æ–¹æ³•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_CHILD_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_find_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+  è¿”å›åº”åŒ…å«ç»™å®šé”®çš„å­èŠ‚ç‚¹çš„ç´¢å¼•ã€‚
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+  */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_keys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;cm&#34;&gt;/* äºŒåˆ†æŸ¥æ‰¾ */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;min_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;cm&#34;&gt;/* å­èŠ‚ç‚¹æ•°æ¯”é”®æ•°å¤šä¸€ä¸ª */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;min_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;min_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;max_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_to_right&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key_to_right&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;max_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;min_index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;min_index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹ &lt;code&gt;internal_node_insert()&lt;/code&gt; çš„å…¶ä½™éƒ¨åˆ†ã€‚æˆ‘ä¼šåˆ†æ­¥è§£é‡Šã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_insert&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;parent_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;                          &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;cm&#34;&gt;/*
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+  å‘çˆ¶èŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªæ–°çš„å­èŠ‚ç‚¹/é”®å¯¹ï¼Œå¯¹åº”äºå­èŠ‚ç‚¹
&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;+  */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;parent&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;parent_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child_max_key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_node_max_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_find_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child_max_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;original_num_keys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;original_num_keys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;original_num_keys&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_MAX_CELLS&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;printf&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Need to implement splitting internal node&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;EXIT_FAILURE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ–°å•å…ƒæ ¼ï¼ˆå­èŠ‚ç‚¹/é”®å¯¹ï¼‰åº”è¯¥æ’å…¥çš„ç´¢å¼•å–å†³äºæ–°å­èŠ‚ç‚¹ä¸­çš„æœ€å¤§é”®ã€‚åœ¨æˆ‘ä»¬æŸ¥çœ‹çš„ç¤ºä¾‹ä¸­ï¼Œ&lt;code&gt;child_max_key&lt;/code&gt; å°†ä¸º 5ï¼Œ&lt;code&gt;index&lt;/code&gt; å°†ä¸º 1ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå†…éƒ¨èŠ‚ç‚¹æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´å®¹çº³å¦ä¸€ä¸ªå•å…ƒæ ¼ï¼Œåˆ™æŠ›å‡ºé”™è¯¯ã€‚ç¨åæˆ‘ä»¬å°†å®ç°è¿™ä¸€ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å‡½æ•°çš„å…¶ä½™éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;right_child_page_num&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_right_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;right_child&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_page&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pager&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;right_child_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;child_max_key&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;get_node_max_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;right_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;cm&#34;&gt;/* æ›¿æ¢å³å­èŠ‚ç‚¹ */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;original_num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;right_child_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;original_num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;        &lt;span class=&#34;n&#34;&gt;get_node_max_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;right_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_right_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;else&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;cm&#34;&gt;/* ä¸ºæ–°å•å…ƒæ ¼è…¾å‡ºç©ºé—´ */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;original_num_keys&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;--&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;n&#34;&gt;memcpy&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;destination&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;source&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_CELL_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_child&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child_page_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;parent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;child_max_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å› ä¸ºæˆ‘ä»¬å•ç‹¬å­˜å‚¨äº†æœ€å³è¾¹çš„å­èŠ‚ç‚¹æŒ‡é’ˆå’Œå…¶ä»–å­èŠ‚ç‚¹/é”®å¯¹ï¼Œæ‰€ä»¥å¦‚æœæ–°å­èŠ‚ç‚¹å°†æˆä¸ºæœ€å³è¾¹çš„å­èŠ‚ç‚¹ï¼Œåˆ™å¿…é¡»ä»¥ä¸åŒçš„æ–¹å¼å¤„ç†äº‹æƒ…ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†è¿›å…¥ &lt;code&gt;else&lt;/code&gt; å—ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä¸ºæ–°å•å…ƒæ ¼è…¾å‡ºç©ºé—´ï¼Œå°†å…¶ä»–å•å…ƒæ ¼å‘å³ç§»åŠ¨ä¸€ä½ã€‚ï¼ˆå°½ç®¡åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­æ²¡æœ‰è¦ç§»åŠ¨çš„å•å…ƒæ ¼ï¼‰&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ–°å­èŠ‚ç‚¹æŒ‡é’ˆå’Œé”®å†™å…¥ç”± &lt;code&gt;index&lt;/code&gt; ç¡®å®šçš„å•å…ƒæ ¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å‡å°‘æ‰€éœ€çš„æµ‹è¯•ç”¨ä¾‹å¤§å°ï¼Œæˆ‘ç°åœ¨å…ˆç¡¬ç¼–ç  &lt;code&gt;INTERNAL_NODE_MAX_CELLS&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;126&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;126&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_KEY_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_CHILD_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;sizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
 &lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_CELL_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_CHILD_SIZE&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_KEY_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;cm&#34;&gt;/* ä¸ºäº†æµ‹è¯•ï¼Œä¿æŒè¾ƒå° */&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;const&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_MAX_CELLS&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¯´åˆ°æµ‹è¯•ï¼Œæˆ‘ä»¬çš„å¤§å‹æ•°æ®é›†æµ‹è¯•å·²ç»é€šè¿‡äº†æ—§çš„å­˜æ ¹ï¼Œå¹¶ä¸”åˆ°è¾¾äº†æˆ‘ä»¬çš„æ–°å­˜æ ¹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;65&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;65&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;@@&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;describe&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;database&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
     &lt;span class=&#34;n&#34;&gt;expect&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;result&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;last&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)).&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;to&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;match_array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;
       &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Executed.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Need to implement updating parent after split&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;db &amp;gt; Need to implement splitting internal node&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
     &lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éå¸¸ä»¤äººæ»¡æ„ï¼Œæˆ‘çŸ¥é“ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘å°†æ·»åŠ å¦ä¸€ä¸ªæµ‹è¯•ï¼Œç”¨äºæ‰“å°ä¸€ä¸ªå››èŠ‚ç‚¹æ ‘çš„ç»“æ„ã€‚ä¸ºäº†æµ‹è¯•æ›´å¤šæƒ…å†µï¼Œè€Œä¸ä»…ä»…æ˜¯é¡ºåº idï¼Œè¿™ä¸ªæµ‹è¯•å°†ä»¥ä¼ªéšæœºé¡ºåºæ·»åŠ è®°å½•ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;n&#34;&gt;it&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;allows&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;printing&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;out&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;the&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;structure&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;of&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;leaf&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;btree&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;script&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 18 user18 person18@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 7 user7 person7@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 10 user10 person10@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 29 user29 person29@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 23 user23 person23@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 4 user4 person4@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 14 user14 person14@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 30 user30 person30@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 15 user15 person15@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 26 user26 person26@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 22 user22 person22@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 19 user19 person19@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 2 user2 person2@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 1 user1 person1@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 21 user21 person21@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 11 user11 person11@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 6 user6 person6@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 20 user20 person20@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 5 user5 person5@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 8 user8 person8@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 9 user9 person9@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 3 user3 person3@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 12 user12 person12@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 27 user27 person27@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 17 user17 person17@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 16 user16 person16@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 13 user13 person13@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 24 user24 person24@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 25 user25 person25@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;insert 28 user28 person28@example.com&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;.btree&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;      &lt;span class=&#34;s&#34;&gt;&amp;#34;.exit&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;    &lt;span class=&#34;n&#34;&gt;result&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;run_script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;script&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç›®å‰ï¼Œå®ƒå°†è¾“å‡ºï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;9&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;11&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;12&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;13&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;14&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;15&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;16&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;17&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;18&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;19&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;21&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;22&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;22&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;leaf&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;size&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;8&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;23&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;24&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;25&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;26&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;27&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;28&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;29&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;30&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;db&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»”ç»†è§‚å¯Ÿï¼Œæ‚¨ä¼šå‘ç°ä¸€ä¸ª bugï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;6&lt;/span&gt;
    &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;
  &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é‚£é‡Œçš„é”®åº”è¯¥æ˜¯ 7ï¼Œè€Œä¸æ˜¯ 1ï¼&lt;/p&gt;
&lt;p&gt;ç»è¿‡ä¸€ç•ªè°ƒè¯•ï¼Œæˆ‘å‘ç°è¿™æ˜¯ç”±äºä¸€äº›é”™è¯¯çš„æŒ‡é’ˆç®—æœ¯å¼•èµ·çš„ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;internal_node_key&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kt&#34;&gt;uint32_t&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;internal_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_CHILD_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;  &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;internal_node_cell&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;node&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;key_num&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;INTERNAL_NODE_CHILD_SIZE&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
 &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;INTERNAL_NODE_CHILD_SIZE&lt;/code&gt; æ˜¯ 4ã€‚æˆ‘åœ¨è¿™é‡Œçš„æ„å›¾æ˜¯å°† 4 å­—èŠ‚æ·»åŠ åˆ° &lt;code&gt;internal_node_cell()&lt;/code&gt; çš„ç»“æœä¸­ï¼Œä½†ç”±äº &lt;code&gt;internal_node_cell()&lt;/code&gt; è¿”å›ä¸€ä¸ª &lt;code&gt;uint32_t*&lt;/code&gt;ï¼Œå› æ­¤å®é™…ä¸Šæ·»åŠ äº† &lt;code&gt;4 * sizeof(uint32_t)&lt;/code&gt; å­—èŠ‚ã€‚æˆ‘é€šè¿‡åœ¨è¿›è¡Œç®—æœ¯è¿ç®—ä¹‹å‰å°†å…¶è½¬æ¢ä¸º &lt;code&gt;void*&lt;/code&gt; æ¥è¿›è¡Œä¿®å¤ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼&lt;a href=&#34;https://stackoverflow.com/questions/3523145/pointer-arithmetic-for-void-pointer-in-c/46238658#46238658&#34;&gt;C æ ‡å‡†ä¸­æ²¡æœ‰ void æŒ‡é’ˆçš„æŒ‡é’ˆç®—æœ¯ï¼Œå¯èƒ½æ— æ³•ä¸ä½ çš„ç¼–è¯‘å™¨ä¸€èµ·å·¥ä½œ&lt;/a&gt;ã€‚ä¹Ÿè®¸å°†æ¥æˆ‘ä¼šæ’°å†™ä¸€ç¯‡å…³äºå¯ç§»æ¤æ€§çš„æ–‡ç« ï¼Œä½†ç›®å‰æˆ‘ä¿ç•™äº†æˆ‘çš„ void æŒ‡é’ˆç®—æœ¯ã€‚&lt;/p&gt;
&lt;p&gt;å¥½çš„ï¼Œåˆè¿ˆå‡ºäº†ä¸€æ­¥ï¼Œæœç€ä¸€ä¸ªå®Œå…¨å¯æ“ä½œçš„ B æ ‘å®ç°è¿ˆè¿›ã€‚ä¸‹ä¸€æ­¥åº”è¯¥æ˜¯æ‹†åˆ†å†…éƒ¨èŠ‚ç‚¹ã€‚åœ¨é‚£ä¹‹å‰ï¼&lt;/p&gt;
&lt;h2 id=&#34;ç¬¬åå››éƒ¨åˆ†---æ‹†åˆ†å†…éƒ¨èŠ‚ç‚¹&#34;&gt;ç¬¬åå››éƒ¨åˆ† - æ‹†åˆ†å†…éƒ¨èŠ‚ç‚¹&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬æ—…ç¨‹çš„ä¸‹ä¸€æ®µå°†æ˜¯æ‹†åˆ†æ— æ³•å®¹çº³æ–°é”®çš„å†…éƒ¨èŠ‚ç‚¹ã€‚è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://cstack.github.io/db_tutorial/assets/images/splitting-internal-node.png&#34; alt=&#34;æ‹†åˆ†å†…éƒ¨èŠ‚ç‚¹çš„ç¤ºä¾‹&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‘æ ‘ä¸­æ·»åŠ é”®â€œ11â€ã€‚è¿™å°†å¯¼è‡´æˆ‘ä»¬çš„æ ¹èŠ‚ç‚¹æ‹†åˆ†ã€‚åœ¨æ‹†åˆ†å†…éƒ¨èŠ‚ç‚¹æ—¶ï¼Œä¸ºäº†ä¿æŒä¸€åˆ‡çš„æ­£å¸¸è¿ä½œï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›äº‹æƒ…ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åˆ›å»ºä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹æ¥å­˜å‚¨åŸå§‹èŠ‚ç‚¹çš„(n-1)/2ä¸ªé”®&lt;/li&gt;
&lt;li&gt;å°†è¿™äº›é”®ä»åŸå§‹èŠ‚ç‚¹ç§»åŠ¨åˆ°å…„å¼ŸèŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;æ›´æ–°çˆ¶èŠ‚ç‚¹ä¸­åŸå§‹èŠ‚ç‚¹çš„é”®ï¼Œä»¥åæ˜ å…¶åœ¨æ‹†åˆ†åçš„æ–°æœ€å¤§é”®&lt;/li&gt;
&lt;li&gt;å°†å…„å¼ŸèŠ‚ç‚¹æ’å…¥çˆ¶èŠ‚ç‚¹ï¼ˆå¯èƒ½å¯¼è‡´çˆ¶èŠ‚ç‚¹ä¹Ÿè¢«æ‹†åˆ†ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æˆ‘ä»¬å°†é¦–å…ˆç”¨&lt;code&gt;internal_node_split_and_insert&lt;/code&gt;æ¥æ›¿æ¢æˆ‘ä»¬çš„å­˜æ ¹ä»£ç ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gi&#34;&gt;+void internal_node_split_and_insert(Table* table, uint32_t parent_page_num,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+                          uint32_t child_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt; void internal_node_insert(Table* table, uint32_t parent_page_num,
                           uint32_t child_page_num) {
   /*
&lt;span class=&#34;gu&#34;&gt;@@ -685,25 +714,39 @@ void internal_node_insert(Table* table, uint32_t parent_page_num,
&lt;/span&gt;&lt;span class=&#34;gu&#34;&gt;&lt;/span&gt; 
   void* parent = get_page(table-&amp;gt;pager, parent_page_num);
   void* child = get_page(table-&amp;gt;pager, child_page_num);
&lt;span class=&#34;gd&#34;&gt;-  uint32_t child_max_key = get_node_max_key(child);
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t child_max_key = get_node_max_key(table-&amp;gt;pager, child);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   uint32_t index = internal_node_find_child(parent, child_max_key);
 
   uint32_t original_num_keys = *internal_node_num_keys(parent);
&lt;span class=&#34;gd&#34;&gt;-  *internal_node_num_keys(parent) = original_num_keys + 1;
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt; 
   if (original_num_keys &amp;gt;= INTERNAL_NODE_MAX_CELLS) {
&lt;span class=&#34;gd&#34;&gt;-    printf(&amp;#34;Need to implement splitting internal node\n&amp;#34;);
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-    exit(EXIT_FAILURE);
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    internal_node_split_and_insert(table, parent_page_num, child_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    return;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   }
 
   uint32_t right_child_page_num = *internal_node_right_child(parent);
&lt;span class=&#34;gi&#34;&gt;+  /*
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  An internal node with a right child of INVALID_PAGE_NUM is empty
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  */
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  if (right_child_page_num == INVALID_PAGE_NUM) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    *internal_node_right_child(parent) = child_page_num;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    return;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   void* right_child = get_page(table-&amp;gt;pager, right_child_page_num);
&lt;span class=&#34;gi&#34;&gt;+  /*
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  If we are already at the max number of cells for a node, we cannot increment
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  before splitting. Incrementing without inserting a new key/child pair
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  and immediately calling internal_node_split_and_insert has the effect
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  of creating a new key at (max_cells + 1) with an uninitialized value
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  */
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  *internal_node_num_keys(parent) = original_num_keys + 1;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt; 
&lt;span class=&#34;gd&#34;&gt;-  if (child_max_key &amp;gt; get_node_max_key(right_child)) {
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  if (child_max_key &amp;gt; get_node_max_key(table-&amp;gt;pager, right_child)) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;     /* Replace right child */
     *internal_node_child(parent, original_num_keys) = right_child_page_num;
     *internal_node_key(parent, original_num_keys) =
&lt;span class=&#34;gd&#34;&gt;-        get_node_max_key(right_child);
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+        get_node_max_key(table-&amp;gt;pager, right_child);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;     *internal_node_right_child(parent) = child_page_num;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é™¤äº†æ›¿æ¢å­˜æ ¹ä¹‹å¤–ï¼Œè¿™é‡Œæˆ‘ä»¬è¿›è¡Œäº†ä¸‰ä¸ªé‡è¦çš„æ›´æ”¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é¦–å…ˆï¼Œ&lt;code&gt;internal_node_split_and_insert&lt;/code&gt;è¢«æå‰å£°æ˜ï¼Œå› ä¸ºæˆ‘ä»¬å°†åœ¨å…¶å®šä¹‰ä¸­è°ƒç”¨&lt;code&gt;internal_node_insert&lt;/code&gt;ï¼Œä»¥é¿å…ä»£ç é‡å¤ã€‚&lt;/li&gt;
&lt;li&gt;æ­¤å¤–ï¼Œæˆ‘ä»¬å°†é€’å¢çˆ¶èŠ‚ç‚¹çš„é”®æ•°é€»è¾‘ç§»åˆ°å‡½æ•°å®šä¹‰çš„ä¸‹æ–¹ï¼Œä»¥ç¡®ä¿åœ¨æ‹†åˆ†ä¹‹å‰ä¸è¦æ‰§è¡Œè¿™ä¸€æ­¥ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åï¼Œæˆ‘ä»¬ç¡®ä¿å°†æ’å…¥åˆ°ç©ºå†…éƒ¨èŠ‚ç‚¹çš„å­èŠ‚ç‚¹æˆä¸ºè¯¥å†…éƒ¨èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ï¼Œè€Œä¸æ‰§è¡Œä»»ä½•å…¶ä»–æ“ä½œï¼Œå› ä¸ºç©ºçš„å†…éƒ¨èŠ‚ç‚¹æ²¡æœ‰å…¶ä»–å¯ä»¥æ“ä½œçš„é”®ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šè¿°æ›´æ”¹è¦æ±‚æˆ‘ä»¬èƒ½å¤Ÿè¯†åˆ«ç©ºèŠ‚ç‚¹ - ä¸ºæ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªå¸¸é‡ï¼Œè¡¨ç¤ºæ¯ä¸ªç©ºèŠ‚ç‚¹çš„æ— æ•ˆé¡µé¢ç¼–å·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-fallback&#34; data-lang=&#34;fallback&#34;&gt;+#define INVALID_PAGE_NUM UINT32_MAX
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨ï¼Œå½“åˆå§‹åŒ–å†…éƒ¨èŠ‚ç‚¹æ—¶ï¼Œæˆ‘ä»¬å°†å…¶å³å­èŠ‚ç‚¹åˆå§‹åŒ–ä¸ºæ­¤æ— æ•ˆé¡µé¢ç¼–å·ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gu&#34;&gt;@@ -330,6 +335,12 @@ void initialize_internal_node(void* node) {
&lt;/span&gt;&lt;span class=&#34;gu&#34;&gt;&lt;/span&gt;   set_node_type(node, NODE_INTERNAL);
   set_node_root(node, false);
   *internal_node_num_keys(node) = 0;
&lt;span class=&#34;gi&#34;&gt;+  /*
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  Necessary because the root page number is 0; by not initializing an internal 
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  node&amp;#39;s right child to an invalid page number when initializing the node, we may
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  end up with 0 as the node&amp;#39;s right child, which makes the node a parent of the root
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  */
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  *internal_node_right_child(node) = INVALID_PAGE_NUM;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt; }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿™ä¸€æ­¥æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºä¸Šé¢çš„æ³¨é‡Šè¯•å›¾æ€»ç»“çš„é—®é¢˜ - åœ¨åˆå§‹åŒ–å†…éƒ¨èŠ‚ç‚¹æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ˜ç¡®åˆå§‹åŒ–å³å­èŠ‚ç‚¹å­—æ®µï¼Œé‚£ä¹ˆè¿è¡Œæ—¶è¯¥å­—æ®µçš„å€¼å¯èƒ½ä¸º0ï¼Œè¿™å–å†³äºç¼–è¯‘å™¨æˆ–ç¨‹åºæ‰§è¡Œçš„æœºå™¨ä½“ç³»ç»“æ„ã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨0ä½œä¸ºæ ¹é¡µé¢ç¼–å·ï¼Œè¿™æ„å‘³ç€æ–°åˆ†é…çš„å†…éƒ¨èŠ‚ç‚¹å°†æ˜¯æ ¹çš„çˆ¶èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬åœ¨&lt;code&gt;internal_node_child&lt;/code&gt;å‡½æ•°ä¸­æ·»åŠ äº†ä¸€äº›é˜²æŠ¤æªæ–½ï¼Œåœ¨å°è¯•è®¿é—®æ— æ•ˆé¡µé¢æ—¶ä¼šå¼•å‘é”™è¯¯ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gu&#34;&gt;@@ -186,9 +188,19 @@ uint32_t* internal_node_child(void* node, uint32_t child_num) {
&lt;/span&gt;&lt;span class=&#34;gu&#34;&gt;&lt;/span&gt;     printf(&amp;#34;Tried to access child_num %d &amp;gt; num_keys %d\n&amp;#34;, child_num, num_keys);
     exit(EXIT_FAILURE);
   } else if (child_num == num_keys) {
&lt;span class=&#34;gd&#34;&gt;-    return internal_node_right_child(node);
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    uint32_t* right_child = internal_node_right_child(node);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    if (*right_child == INVALID_PAGE_NUM) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      printf(&amp;#34;Tried to access right child of node, but was invalid page\n&amp;#34;);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      exit(EXIT_FAILURE);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    return right_child;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   } else {
&lt;span class=&#34;gd&#34;&gt;-    return internal_node_cell(node, child_num);
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    uint32_t* child = internal_node_cell(node, child_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    if (*child == INVALID_PAGE_NUM) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      printf(&amp;#34;Tried to access child %d of node, but was invalid page\n&amp;#34;, child_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      exit(EXIT_FAILURE);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    return child;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   }
 }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬çš„&lt;code&gt;print_tree&lt;/code&gt;å‡½æ•°è¿˜éœ€è¦æ·»åŠ ä¸€ä¸ªé˜²æŠ¤æªæ–½ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬ä¸ä¼šå°è¯•æ‰“å°ä¸€ä¸ªç©ºèŠ‚ç‚¹ï¼Œå› ä¸ºè¿™ä¼šæ¶‰åŠå°è¯•è®¿é—®ä¸€ä¸ªæ— æ•ˆé¡µé¢ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gu&#34;&gt;@@ -294,15 +305,17 @@ void print_tree(Pager* pager, uint32_t page_num, uint32_t indentation_level) {
&lt;/span&gt;&lt;span class=&#34;gu&#34;&gt;&lt;/span&gt;       num_keys = *internal_node_num_keys(node);
       indent(indentation_level);
       printf(&amp;#34;- internal (size %d)\n&amp;#34;, num_keys);
&lt;span class=&#34;gd&#34;&gt;-      for (uint32_t i = 0; i &amp;lt; num_keys; i++) {
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-        child = *internal_node_child(node, i);
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      if (num_keys &amp;gt; 0) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+        for (uint32_t i = 0; i &amp;lt; num_keys; i++) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+          child = *internal_node_child(node, i);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+          print_tree(pager, child, indentation_level + 1);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+          indent(indentation_level + 1);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+          printf(&amp;#34;- key %d\n&amp;#34;, *internal_node_key(node, i));
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+        }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+        child = *internal_node_right_child(node);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;         print_tree(pager, child, indentation_level + 1);
&lt;span class=&#34;gd&#34;&gt;-
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-        indent(indentation_level + 1);
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-        printf(&amp;#34;- key %d\n&amp;#34;, *internal_node_key(node, i));
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;       }
&lt;span class=&#34;gd&#34;&gt;-      child = *internal_node_right_child(node);
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;-      print_tree(pager, child, indentation_level + 1);
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;       break;
   }
 }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç°åœ¨æ˜¯å…³äº &lt;code&gt;internal_node_split_and_insert&lt;/code&gt; çš„ä¸»è¦éƒ¨åˆ†ã€‚æˆ‘ä»¬é¦–å…ˆæä¾›å®Œæ•´çš„å†…å®¹ï¼Œç„¶åé€æ­¥åˆ†è§£è¯´æ˜ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gi&#34;&gt;+void internal_node_split_and_insert(Table* table, uint32_t parent_page_num,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+                          uint32_t child_page_num) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t old_page_num = parent_page_num;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  void* old_node = get_page(table-&amp;gt;pager,parent_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t old_max = get_node_max_key(table-&amp;gt;pager, old_node);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  void* child = get_page(table-&amp;gt;pager, child_page_num); 
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t child_max = get_node_max_key(table-&amp;gt;pager, child);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t new_page_num = get_unused_page_num(table-&amp;gt;pager);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  /*
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  åœ¨æ›´æ–°æŒ‡é’ˆä¹‹å‰å£°æ˜ä¸€ä¸ªæ ‡å¿—ï¼Œ
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  è®°å½•æ­¤æ“ä½œæ˜¯å¦æ¶‰åŠåˆ†å‰²æ ¹èŠ‚ç‚¹ -
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  å¦‚æœæ˜¯çš„è¯ï¼Œæˆ‘ä»¬å°†åœ¨åˆ›å»ºè¡¨çš„æ–°æ ¹æ—¶æ’å…¥æˆ‘ä»¬æ–°åˆ›å»ºçš„èŠ‚ç‚¹ã€‚
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  å¦‚æœä¸æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æ—§èŠ‚ç‚¹çš„é”®å·²è½¬ç§»åå°†æ–°åˆ›å»ºçš„èŠ‚ç‚¹æ’å…¥å…¶çˆ¶èŠ‚ç‚¹ã€‚
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  å¦‚æœæ–°åˆ›å»ºçš„èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸æ˜¯æ–°åˆå§‹åŒ–çš„æ ¹èŠ‚ç‚¹ï¼Œæˆ‘ä»¬æ— æ³•è¿™æ ·åšï¼Œ
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  å› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…¶çˆ¶èŠ‚ç‚¹å¯èƒ½æœ‰é™¤æˆ‘ä»¬æ­£åœ¨åˆ†å‰²çš„æ—§èŠ‚ç‚¹ä¹‹å¤–çš„ç°æœ‰é”®ã€‚
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  å¦‚æœæ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å…¶çˆ¶èŠ‚ç‚¹ä¸­ä¸ºæ–°åˆ›å»ºçš„èŠ‚ç‚¹æ‰¾åˆ°ä¸€ä¸ªä½ç½®ï¼Œ
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  å¦‚æœå®ƒè¿˜æ²¡æœ‰ä»»ä½•é”®ï¼Œåˆ™æ— æ³•åœ¨æ­£ç¡®çš„ç´¢å¼•å¤„æ’å…¥å®ƒ
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  */
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t splitting_root = is_node_root(old_node);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  void* parent;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  void* new_node;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  if (splitting_root) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    create_new_root(table, new_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    parent = get_page(table-&amp;gt;pager,table-&amp;gt;root_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    /*
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    å¦‚æœæˆ‘ä»¬æ­£åœ¨åˆ†å‰²æ ¹èŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å°† old_node æ›´æ–°ä¸ºæŒ‡å‘æ–°æ ¹çš„å·¦å­èŠ‚ç‚¹ï¼Œ
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    new_page_num å·²ç»æŒ‡å‘æ–°æ ¹çš„å³å­èŠ‚ç‚¹
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    */
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    old_page_num = *internal_node_child(parent,0);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    old_node = get_page(table-&amp;gt;pager, old_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  } else {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    parent = get_page(table-&amp;gt;pager,*node_parent(old_node));
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    new_node = get_page(table-&amp;gt;pager, new_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    initialize_internal_node(new_node);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t* old_num_keys = internal_node_num_keys(old_node);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t cur_page_num = *internal_node_right_child(old_node);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  void* cur = get_page(table-&amp;gt;pager, cur_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  /*
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  é¦–å…ˆå°†å³å­èŠ‚ç‚¹æ”¾å…¥æ–°èŠ‚ç‚¹ï¼Œå¹¶å°†æ—§èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹è®¾ç½®ä¸ºæ— æ•ˆé¡µç 
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  */
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  internal_node_insert(table, new_page_num, cur_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  *node_parent(cur) = new_page_num;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  *internal_node_right_child(old_node) = INVALID_PAGE_NUM;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  /*
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  å¯¹äºæ¯ä¸ªé”®ï¼Œç›´åˆ°è¾¾åˆ°ä¸­é—´é”®ï¼Œå°†é”®å’Œå­èŠ‚ç‚¹ç§»åŠ¨åˆ°æ–°èŠ‚ç‚¹
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  */
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  for (int i = INTERNAL_NODE_MAX_CELLS - 1; i &amp;gt; INTERNAL_NODE_MAX_CELLS / 2; i--) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    cur_page_num = *internal_node_child(old_node, i);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    cur = get_page(table-&amp;gt;pager, cur_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    internal_node_insert(table, new_page_num, cur_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    *node_parent(cur) = new_page_num;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    (*old_num_keys)--;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  /*
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  è®¾ç½®ä¸­é—´é”®ä¹‹å‰çš„å­èŠ‚ç‚¹ï¼Œç°åœ¨æ˜¯æœ€é«˜çš„é”®ï¼Œä¸ºèŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ï¼Œ
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  å¹¶å‡å°‘é”®çš„æ•°é‡
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  */
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  *internal_node_right_child(old_node) = *internal_node_child(old_node,*old_num_keys - 1);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  (*old_num_keys)--;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  /*
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  ç¡®å®šåˆ†å‰²åçš„ä¸¤ä¸ªèŠ‚ç‚¹ä¸­åº”åŒ…å«è¦æ’å…¥çš„å­èŠ‚ç‚¹ï¼Œ
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  å¹¶æ’å…¥å­èŠ‚ç‚¹
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  */
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t max_after_split = get_node_max_key(table-&amp;gt;pager, old_node);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t destination_page_num = child_max &amp;lt; max_after_split ? old_page_num : new_page_num;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  internal_node_insert(table, destination_page_num, child_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  *node_parent(child) = destination_page_num;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  update_internal_node_key(parent, old_max, get_node_max_key(table-&amp;gt;pager, old_node));
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  if (!splitting_root) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    internal_node_insert(table,*node_parent(old_node),new_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    *node_parent(new_node) = *node_parent(old_node);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+}
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ªå˜é‡æ¥å­˜å‚¨æˆ‘ä»¬è¦æ‹†åˆ†çš„èŠ‚ç‚¹çš„é¡µé¢ç¼–å·ï¼ˆä»è¿™é‡Œå¼€å§‹ç§°ä¸ºæ—§èŠ‚ç‚¹ï¼‰ã€‚è¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºå¦‚æœæ—§èŠ‚ç‚¹æ°å¥½æ˜¯è¡¨çš„æ ¹èŠ‚ç‚¹ï¼Œåˆ™æ—§èŠ‚ç‚¹çš„é¡µé¢ç¼–å·å°†ä¼šæ”¹å˜ã€‚æˆ‘ä»¬è¿˜éœ€è¦è®°ä½èŠ‚ç‚¹çš„å½“å‰æœ€å¤§å€¼ï¼Œå› ä¸ºè¯¥å€¼ä»£è¡¨å…¶åœ¨çˆ¶èŠ‚ç‚¹ä¸­çš„é”®ï¼Œåœ¨æ‹†åˆ†å‘ç”Ÿåï¼Œéœ€è¦æ›´æ–°è¯¥é”®ä¸ºæ—§èŠ‚ç‚¹çš„æ–°æœ€å¤§å€¼ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t old_page_num = parent_page_num;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  void* old_node = get_page(table-&amp;gt;pager,parent_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t old_max = get_node_max_key(table-&amp;gt;pager, old_node);
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä¸‹ä¸€ä¸ªé‡è¦æ­¥éª¤æ˜¯åŸºäºæ—§èŠ‚ç‚¹æ˜¯å¦ä¸ºè¡¨çš„æ ¹èŠ‚ç‚¹çš„åˆ†æ”¯é€»è¾‘ã€‚æˆ‘ä»¬éœ€è¦è·Ÿè¸ªè¿™ä¸ªå€¼ä»¥å¤‡åç”¨ï¼›æ­£å¦‚æ³¨é‡Šæ‰€è¿°ï¼Œå¦‚æœæˆ‘ä»¬ä¸åœ¨å‡½æ•°å®šä¹‰çš„å¼€å§‹å­˜å‚¨è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†é‡åˆ°é—®é¢˜â€”â€”å¦‚æœæˆ‘ä»¬ä¸æ˜¯æ‹†åˆ†æ ¹èŠ‚ç‚¹ï¼Œåˆ™æ— æ³•ç«‹å³å°†æ–°åˆ›å»ºçš„å…„å¼ŸèŠ‚ç‚¹æ’å…¥åˆ°æ—§èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸­ï¼Œå› ä¸ºçˆ¶èŠ‚ç‚¹è¿˜ä¸åŒ…å«ä»»ä½•é”®ï¼Œå› æ­¤æ–°èŠ‚ç‚¹æ— æ³•æ­£ç¡®æ”¾ç½®åœ¨çˆ¶èŠ‚ç‚¹ä¸­çš„å…¶ä»–é”®/å­èŠ‚ç‚¹å¯¹ä¹‹é—´ï¼Œè¿™äº›é”®/å­èŠ‚ç‚¹å¯¹å¯èƒ½å·²ç»å­˜åœ¨äºçˆ¶èŠ‚ç‚¹ä¸­ï¼Œä¹Ÿå¯èƒ½ä¸å­˜åœ¨ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t splitting_root = is_node_root(old_node);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  void* parent;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  void* new_node;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  if (splitting_root) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    create_new_root(table, new_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    parent = get_page(table-&amp;gt;pager,table-&amp;gt;root_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    /*
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    å¦‚æœæˆ‘ä»¬åœ¨æ‹†åˆ†æ ¹èŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°æ—§èŠ‚ç‚¹ï¼Œä½¿å…¶æŒ‡å‘æ–°æ ¹èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ï¼Œè€Œnew_page_numå°†æŒ‡å‘æ–°æ ¹èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    */
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    old_page_num = *internal_node_child(parent,0);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    old_node = get_page(table-&amp;gt;pager, old_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  } else {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    parent = get_page(table-&amp;gt;pager,*node_parent(old_node));
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    new_node = get_page(table-&amp;gt;pager, new_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    initialize_internal_node(new_node);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å½“æˆ‘ä»¬è§£å†³äº†æ˜¯å¦æ‹†åˆ†æ ¹èŠ‚ç‚¹çš„é—®é¢˜åï¼Œæˆ‘ä»¬å¼€å§‹å°†é”®ä»æ—§èŠ‚ç‚¹ç§»åŠ¨åˆ°å…¶å…„å¼ŸèŠ‚ç‚¹ã€‚æˆ‘ä»¬å¿…é¡»é¦–å…ˆç§»åŠ¨æ—§èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶å³å­èŠ‚ç‚¹å­—æ®µè®¾ç½®ä¸ºæ— æ•ˆé¡µé¢ç¼–å·ï¼Œä»¥è¡¨ç¤ºå®ƒä¸ºç©ºã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¾ªç¯éå†æ—§èŠ‚ç‚¹å‰©ä½™çš„é”®ï¼Œåœ¨æ¯æ¬¡è¿­ä»£ä¸­æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è·å–æ—§èŠ‚ç‚¹å½“å‰ç´¢å¼•å¤„çš„é”®å’Œå­èŠ‚ç‚¹çš„å¼•ç”¨&lt;/li&gt;
&lt;li&gt;å°†å­èŠ‚ç‚¹æ’å…¥åˆ°å…„å¼ŸèŠ‚ç‚¹ä¸­&lt;/li&gt;
&lt;li&gt;æ›´æ–°å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹å€¼ï¼Œä½¿å…¶æŒ‡å‘å…„å¼ŸèŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;å‡å°‘æ—§èŠ‚ç‚¹çš„é”®æ•°&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t* old_num_keys = internal_node_num_keys(old_node);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t cur_page_num = *internal_node_right_child(old_node);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  void* cur = get_page(table-&amp;gt;pager, cur_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  /*
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  é¦–å…ˆå°†å³å­èŠ‚ç‚¹æ”¾å…¥æ–°èŠ‚ç‚¹ä¸­ï¼Œå¹¶å°†æ—§èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹å­—æ®µè®¾ç½®ä¸ºæ— æ•ˆé¡µé¢ç¼–å·
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  */
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  internal_node_insert(table, new_page_num, cur_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  *node_parent(cur) = new_page_num;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  *internal_node_right_child(old_node) = INVALID_PAGE_NUM;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  /*
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  å¯¹äºæ¯ä¸ªé”®ï¼Œç›´åˆ°è¾¾åˆ°ä¸­é—´é”®ï¼Œå°†é”®å’Œå­èŠ‚ç‚¹ç§»åŠ¨åˆ°æ–°èŠ‚ç‚¹ä¸­
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  */
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  for (int i = INTERNAL_NODE_MAX_CELLS - 1; i &amp;gt; INTERNAL_NODE_MAX_CELLS / 2; i--) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    cur_page_num = *internal_node_child(old_node, i);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    cur = get_page(table-&amp;gt;pager, cur_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    internal_node_insert(table, new_page_num, cur_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    *node_parent(cur) = new_page_num;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    (*old_num_keys)--;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç¬¬4æ­¥å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒçš„ç›®çš„æ˜¯â€œæ“¦é™¤â€æ—§èŠ‚ç‚¹çš„é”®/å­èŠ‚ç‚¹å¯¹ã€‚è™½ç„¶æˆ‘ä»¬å®é™…ä¸Šæ²¡æœ‰é‡Šæ”¾æ—§èŠ‚ç‚¹é¡µé¢ä¸­è¯¥å­—èŠ‚åç§»é‡çš„å†…å­˜ï¼Œä½†&lt;/p&gt;
&lt;p&gt;é€šè¿‡å‡å°‘æ—§èŠ‚ç‚¹çš„é”®æ•°ï¼Œæˆ‘ä»¬ä½¿å¾—è¯¥å†…å­˜ä½ç½®æ— æ³•è®¿é—®ï¼Œå¹¶ä¸”ä¸‹æ¬¡æ’å…¥å­èŠ‚ç‚¹åˆ°æ—§èŠ‚ç‚¹æ—¶ï¼Œè¿™äº›å­—èŠ‚å°†è¢«è¦†ç›–ã€‚&lt;/p&gt;
&lt;p&gt;åŒæ—¶æ³¨æ„æˆ‘ä»¬å¾ªç¯ä¸å˜å¼çš„è¡Œä¸ºâ€”â€”å¦‚æœå°†æ¥æˆ‘ä»¬çš„å†…éƒ¨èŠ‚ç‚¹æœ€å¤§é”®æ•°å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬çš„é€»è¾‘ç¡®ä¿åœ¨æ‹†åˆ†åï¼Œæ— è®ºæ˜¯æ—§èŠ‚ç‚¹è¿˜æ˜¯å…„å¼ŸèŠ‚ç‚¹ï¼Œå®ƒä»¬éƒ½ä¼šæ‹¥æœ‰ï¼ˆn-1ï¼‰/2ä¸ªé”®ï¼Œè€Œå‰©ä½™çš„1ä¸ªé”®ä¼šç§»åŠ¨åˆ°çˆ¶èŠ‚ç‚¹ã€‚å¦‚æœé€‰æ‹©å¶æ•°ä½œä¸ºèŠ‚ç‚¹çš„æœ€å¤§é”®æ•°ï¼Œé‚£ä¹ˆn/2ä¸ªèŠ‚ç‚¹å°†ç•™åœ¨æ—§èŠ‚ç‚¹ï¼Œè€Œï¼ˆn-1ï¼‰/2ä¸ªèŠ‚ç‚¹å°†ç§»åŠ¨åˆ°å…„å¼ŸèŠ‚ç‚¹ã€‚è¿™ç§é€»è¾‘ä¿®æ”¹å°†ä¼šå¾ˆç›´æ¥ã€‚&lt;/p&gt;
&lt;p&gt;å½“éœ€è¦ç§»åŠ¨çš„é”®ç§»åŠ¨å®Œæˆåï¼Œæˆ‘ä»¬å°†æ—§èŠ‚ç‚¹çš„ç¬¬iä¸ªå­èŠ‚ç‚¹è®¾ç½®ä¸ºå…¶å³å­èŠ‚ç‚¹ï¼Œå¹¶å‡å°‘å…¶é”®æ•°ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gi&#34;&gt;+  /*
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  å°†ä¸­é—´é”®ï¼ˆç°åœ¨æ˜¯æœ€å¤§é”®ï¼‰ä¹‹å‰çš„å­èŠ‚ç‚¹è®¾ç½®ä¸ºèŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ï¼Œå¹¶å‡å°‘é”®æ•°
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  */
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  *internal_node_right_child(old_node) = *internal_node_child(old_node,*old_num_keys - 1);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  (*old_num_keys)--;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç„¶åï¼Œæˆ‘ä»¬æ ¹æ®å­èŠ‚ç‚¹çš„æœ€å¤§é”®å°†å­èŠ‚ç‚¹æ’å…¥åˆ°æ—§èŠ‚ç‚¹æˆ–å…„å¼ŸèŠ‚ç‚¹ä¸­ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t max_after_split = get_node_max_key(table-&amp;gt;pager, old_node);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t destination_page_num = child_max &amp;lt; max_after_split ? old_page_num : new_page_num;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  internal_node_insert(table, destination_page_num, child_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  *node_parent(child) = destination_page_num;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬åœ¨æ—§èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸­æ›´æ–°æ—§èŠ‚ç‚¹çš„é”®ï¼Œå¹¶åœ¨å¿…è¦æ—¶æ’å…¥å…„å¼ŸèŠ‚ç‚¹ï¼Œå¹¶æ›´æ–°å…„å¼ŸèŠ‚ç‚¹çš„çˆ¶æŒ‡é’ˆã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gi&#34;&gt;+  update_internal_node_key(parent, old_max, get_node_max_key(table-&amp;gt;pager, old_node));
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  if (!splitting_root) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    internal_node_insert(table,*node_parent(old_node),new_page_num);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    *node_parent(new_node) = *node_parent(old_node);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¦æ”¯æŒè¿™ç§æ–°é€»è¾‘çš„ä¸€ä¸ªé‡è¦æ›´æ”¹æ˜¯åœ¨æˆ‘ä»¬çš„&lt;code&gt;create_new_root&lt;/code&gt;å‡½æ•°ä¸­è¿›è¡Œçš„ã€‚ä»¥å‰ï¼Œæˆ‘ä»¬åªè€ƒè™‘äº†æ–°æ ¹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å°†æ˜¯å¶èŠ‚ç‚¹çš„æƒ…å†µã€‚å¦‚æœæ–°æ ¹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å®é™…ä¸Šæ˜¯å†…éƒ¨èŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦åšä¸¤ä»¶äº‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ­£ç¡®åœ°åˆå§‹åŒ–æ ¹èŠ‚ç‚¹çš„æ–°å­èŠ‚ç‚¹ä¸ºå†…éƒ¨èŠ‚ç‚¹&lt;/li&gt;
&lt;li&gt;é™¤äº†å¯¹memcpyçš„è°ƒç”¨ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†æ ¹èŠ‚ç‚¹çš„æ¯ä¸ªé”®æ’å…¥åˆ°å…¶æ–°å·¦å­èŠ‚ç‚¹ä¸­ï¼Œå¹¶æ›´æ–°æ¯ä¸ªå­èŠ‚ç‚¹çš„çˆ¶æŒ‡é’ˆ&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gu&#34;&gt;@@ -661,22 +680,40 @@ void create_new_root(Table* table, uint32_t right_child_page_num) {
&lt;/span&gt;&lt;span class=&#34;gu&#34;&gt;&lt;/span&gt;   uint32_t left_child_page_num = get_unused_page_num(table-&amp;gt;pager);
   void* left_child = get_page(table-&amp;gt;pager, left_child_page_num);
 
&lt;span class=&#34;gi&#34;&gt;+  if (get_node_type(root) == NODE_INTERNAL) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    initialize_internal_node(right_child);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    initialize_internal_node(left_child);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   /* å·¦å­èŠ‚ç‚¹å¤åˆ¶äº†æ—§æ ¹èŠ‚ç‚¹çš„æ•°æ® */
   memcpy(left_child, root, PAGE_SIZE);
   set_node_root(left_child, false);
 
&lt;span class=&#34;gi&#34;&gt;+  if (get_node_type(left_child) == NODE_INTERNAL) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    void* child;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    for (int i = 0; i &amp;lt; *internal_node_num_keys(left_child); i++) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      child = get_page(table-&amp;gt;pager, *internal_node_child(left_child,i));
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      *node_parent(child) = left_child_page_num;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    child = get_page(table-&amp;gt;pager, *internal_node_right_child(left_child));
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    *node_parent(child) = left_child_page_num;
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   /* æ ¹èŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ–°çš„å†…éƒ¨èŠ‚ç‚¹ï¼Œæœ‰ä¸€ä¸ªé”®å’Œä¸¤ä¸ªå­èŠ‚ç‚¹ */
   initialize_internal_node(root);
   set_node_root(root, true);
   *internal_node_num_keys(root) = 1;
   *internal_node_child(root, 0) = left_child_page_num;
&lt;span class=&#34;gd&#34;&gt;-  uint32_t left_child_max_key = get_node_max_key(left_child);
&lt;/span&gt;&lt;span class=&#34;gd&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  uint32_t left_child_max_key = get_node_max_key(table-&amp;gt;pager, left_child);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;&lt;/span&gt;   *internal_node_key(root, 0) = left_child_max_key;
   *internal_node_right_child(root) = right_child_page_num;
   *node_parent(left_child) = table-&amp;gt;root_page_num;
   *node_parent(right_child) = table-&amp;gt;root_page_num;
 }
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¦ä¸€ä¸ªé‡è¦æ›´æ”¹æ˜¯å¯¹&lt;code&gt;get_node_max_key&lt;/code&gt;è¿›è¡Œçš„ï¼Œå°±åƒæœ¬æ–‡å¼€å¤´æåˆ°çš„ä¸€æ ·ã€‚ç”±äºå†…éƒ¨èŠ‚ç‚¹çš„é”®è¡¨ç¤ºå…¶å·¦ä¾§å­æ ‘çš„æœ€å¤§é”®ï¼Œå¹¶ä¸”è¯¥å­æ ‘å¯ä»¥æ˜¯ä»»æ„æ·±åº¦çš„æ ‘ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ²¿ç€è¯¥æ ‘çš„å³å­èŠ‚ç‚¹èµ°ä¸‹å»ï¼Œç›´åˆ°åˆ°è¾¾å¶èŠ‚ç‚¹ï¼Œç„¶åå–è¯¥å¶èŠ‚ç‚¹çš„æœ€å¤§é”®ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gi&#34;&gt;+uint32_t get_node_max_key(Pager* pager, void* node) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  if (get_node_type(node) == NODE_LEAF) {
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    return *leaf_node_key(node, *leaf_node_num_cells(node) - 1);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  }
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  void* right_child = get_page(pager,*internal_node_right_child(node));
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  return get_node_max_key(pager, right_child);
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+}
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªå•ä¸€æµ‹è¯•æ¥è¯æ˜åœ¨å¼•å…¥å†…éƒ¨èŠ‚ç‚¹æ‹†åˆ†åï¼Œæˆ‘ä»¬çš„&lt;code&gt;print_tree&lt;/code&gt;å‡½æ•°ä»ç„¶æœ‰æ•ˆã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-diff&#34; data-lang=&#34;diff&#34;&gt;&lt;span class=&#34;gi&#34;&gt;+  it &amp;#39;allows printing out the structure of a 7-leaf-node btree&amp;#39; do
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    script = [
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 58 user58 person58@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 56 user56 person56@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 8 user8 person8@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 54 user54 person54@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 77 user77 person77@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 7 user7 person7@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 25 user25 person25@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 71 user71 person71@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 13 user13 person13@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 22 user22 person22@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 53 user53 person53@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 51 user51 person51@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 59 user59 person59@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 32 user32 person32@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 36 user36 person36@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 79 user79 person79@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 10 user10 person10@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 33 user33 person33@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 20 user20 person20@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 4 user4 person4@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 35 user35 person35@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 76 user76 person76@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 49 user49 person49@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 24 user24 person24@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 70 user70 person70@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 48 user48 person48@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 39 user39 person39@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 15 user15 person15@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 47 user47 person47@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 30 user30 person30@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 86 user86 person86@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 31 user31 person31@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 68 user68 person68@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 37 user37 person37@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 66 user66 person66@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 63 user63 person63@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 40 user40 person40@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 78 user78 person78@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 19 user19 person19@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 46 user46 person46@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 14 user14 person14@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 81 user81 person81@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 72 user72 person72@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 6 user6 person6@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 50 user50 person50@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 85 user85 person85@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 67 user67 person67@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 2 user2 person2@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 55 user55 person55@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 69 user69 person69@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 5 user5 person5@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 65 user65 person65@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 52 user52 person52@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 1 user1 person1@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 29 user29 person29@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 9 user9 person9@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 43 user43 person43@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 75 user75 person75@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 21 user21 person21@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 82 user82 person82@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 12 user12 person12@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 18 user18 person18@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 60 user60 person60@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;insert 44 user44 person44@example.com&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;.btree&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;.exit&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    ]
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    result = run_script(script)
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    expect(result[64...(result.length)]).to match_array([
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;db &amp;gt; Tree:&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;- internal (size 1)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;  - internal (size 2)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;    - leaf (size 7)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 1&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 2&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 4&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 5&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 6&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 7&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 8&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;    - key 8&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;    - leaf (size 11)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 9&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 10&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 12&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 13&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 14&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 15&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 18&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 19&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 20&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 21&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 22&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;    - key 22&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;    - leaf (size 8)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 24&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 25&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 29&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 30&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 31&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 32&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 33&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 35&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;  - key 35&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;  - internal (size 3)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;    - leaf (size 12)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 36&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 37&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 39&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 40&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 43&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 44&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 46&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 47&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 48&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 49&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 50&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 51&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;    - key 51&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;    - leaf (size 11)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 52&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 53&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 54&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 55&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 56&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 58&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 59&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 60&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 63&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 65&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 66&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;    - key 66&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;    - leaf (size 7)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 67&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 68&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 69&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 70&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 71&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 72&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 75&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;    - key 75&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;    - leaf (size 8)&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 76&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 77&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 78&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 79&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 81&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 82&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 85&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;      - 86&amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+      &amp;#34;db &amp;gt; &amp;#34;,
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+    ])
&lt;/span&gt;&lt;span class=&#34;gi&#34;&gt;+  end
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å®Œæ•´æºç ï¼š  &lt;a href=&#34;https://github.com/cstack/db_tutorial&#34;&gt;https://github.com/cstack/db_tutorial&lt;/a&gt;&lt;/p&gt;</description>
      
    </item>
    
  </channel>
</rss>
