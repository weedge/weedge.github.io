<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>æ—¶é—´é£˜è¿‡</title>
    <link>https://weedge.github.io/</link>
    <description>Recent content on æ—¶é—´é£˜è¿‡</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Mon, 21 Nov 2022 10:26:23 +0800</lastBuildDate>
    
        <atom:link href="https://weedge.github.io/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>About</title>
      <link>https://weedge.github.io/about/</link>
      <pubDate>Sun, 20 Jan 2013 21:38:52 +0800</pubDate>
      
      <guid>https://weedge.github.io/about/</guid>
      
        <description>
&lt;link rel=&#34;stylesheet&#34; href=&#34;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css&#34;&gt;
&lt;style type=&#34;text/css&#34;&gt;.dark-theme .aplayer{background:#212121}.dark-theme .aplayer.aplayer-withlist .aplayer-info{border-bottom-color:#5c5c5c}.dark-theme .aplayer.aplayer-fixed .aplayer-list{border-color:#5c5c5c}.dark-theme .aplayer .aplayer-body{background-color:#212121}.dark-theme .aplayer .aplayer-info{border-top-color:#212121}.dark-theme .aplayer .aplayer-info .aplayer-music .aplayer-title{color:#fff}.dark-theme .aplayer .aplayer-info .aplayer-music .aplayer-author{color:#fff}.dark-theme .aplayer .aplayer-info .aplayer-controller .aplayer-time{color:#eee}.dark-theme .aplayer .aplayer-info .aplayer-controller .aplayer-time .aplayer-icon path{fill:#eee}.dark-theme .aplayer .aplayer-list{background-color:#212121}.dark-theme .aplayer .aplayer-list::-webkit-scrollbar-thumb{background-color:#999}.dark-theme .aplayer .aplayer-list::-webkit-scrollbar-thumb:hover{background-color:#bbb}.dark-theme .aplayer .aplayer-list li{color:#fff;border-top-color:#666}.dark-theme .aplayer .aplayer-list li:hover{background:#4e4e4e}.dark-theme .aplayer .aplayer-list li.aplayer-list-light{background:#6c6c6c}.dark-theme .aplayer .aplayer-list li .aplayer-list-index{color:#ddd}.dark-theme .aplayer .aplayer-list li .aplayer-list-author{color:#ddd}.dark-theme .aplayer .aplayer-lrc{text-shadow:-1px -1px 0 #666}.dark-theme .aplayer .aplayer-lrc:before{background:-moz-linear-gradient(top, #212121 0%, rgba(33,33,33,0) 100%);background:-webkit-linear-gradient(top, #212121 0%, rgba(33,33,33,0) 100%);background:linear-gradient(to bottom, #212121 0%, rgba(33,33,33,0) 100%);filter:progid:DXImageTransform.Microsoft.gradient( startColorstr=&#39;#212121&#39;, endColorstr=&#39;#00212121&#39;,GradientType=0 )}.dark-theme .aplayer .aplayer-lrc:after{background:-moz-linear-gradient(top, rgba(33,33,33,0) 0%, rgba(33,33,33,0.8) 100%);background:-webkit-linear-gradient(top, rgba(33,33,33,0) 0%, rgba(33,33,33,0.8) 100%);background:linear-gradient(to bottom, rgba(33,33,33,0) 0%, rgba(33,33,33,0.8) 100%);filter:progid:DXImageTransform.Microsoft.gradient( startColorstr=&#39;#00212121&#39;, endColorstr=&#39;#cc212121&#39;,GradientType=0 )}.dark-theme .aplayer .aplayer-lrc p{color:#fff}.dark-theme .aplayer .aplayer-miniswitcher{background:#484848}.dark-theme .aplayer .aplayer-miniswitcher .aplayer-icon path{fill:#eee}&lt;/style&gt;
&lt;script src=&#34;https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js&#34;&gt;&lt;/script&gt;

&lt;script src=&#34;https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js&#34;&gt;&lt;/script&gt;&lt;meting-js auto=&#34;https://music.163.com/#/playlist?id=2154973386&#34; theme=&#34;#2980b9&#34;&gt;&lt;/meting-js&gt;
&lt;p&gt;ç®€å•çš„æœ¨å¤´äººï¼Œç®€å•ï¼Œå‘†æœ¨ï¼Œå–œæ¬¢è‡ªè¨€è‡ªè¯­ï¼Œæ„šäººè‡ªæ‰°å‹ã€‚æ—¶é—´é£é€ï¼Œä»…ä»…è®°å½•ï¼Œç•™ä½æŸäººæŸäº‹ï¼ŒæŸäº›å¥½ç©çš„æŠ€æœ¯ï¼ŒKISS and just do IT.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¯¹è‡ªå·±ä¸€å®šè¦æœ‰ä¿¡å¿ƒï¼Œæ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„èŠ‚å¥ï¼Œä¸èƒ½å› ä¸ºä¸€æ¬¡æ¬¡å°å°æŒ«æŠ˜è€Œä¸€è¹¶ä¸æŒ¯ï¼Œç”Ÿæ´»æœ¬éå¦‚æ„ï¼Œä½•é¡»è¿‡åº¦çº ç»“ï½&lt;/p&gt;
&lt;p&gt;ä¸ä»¥ç‰©å–œï¼Œä¸ä»¥å·±æ‚²ï¼› ä¸Šå–„è‹¥æ°´ï½ inner peaceï½ è¶³å·²&lt;/p&gt;
&lt;p&gt;å¿µç»ï½ï½æ•²æœ¨é±¼ï½&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ­£ç¡®è¯„ä¼°è‡ªå·±çš„èƒ½åŠ›ï¼Œä¸åš ã€Œä½›å¡”ä¸‹çš„ğŸ­ã€ï¼Œåˆä½œåŒèµ¢å…±å¤„&lt;/p&gt;
&lt;h4 id=&#34;äººç”Ÿ&#34;&gt;äººç”Ÿ&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;â€œç‰©æ¥é¡ºåº”ï¼Œæœªæ¥ä¸è¿ï¼Œå½“æ—¶ä¸æ‚ï¼Œæ—¢è¿‡ä¸æ‹â€ &amp;ndash; æ›¾å›½è—©&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&amp;ldquo;Yesterday is a history, tomorrow is a mystery, only today is a gift, that is why we call it present. &amp;quot; &amp;ndash; åŠŸå¤«ç†ŠçŒ« (inner peace)&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;è§„å¾‹&#34;&gt;è§„å¾‹&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;â€è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢â€œ &amp;ndash; å±ˆåŸã€Šç¦»éªšã€‹&lt;/li&gt;
&lt;li&gt;&amp;ldquo;ä¼—é‡Œå¯»ä»–åƒç™¾åº¦ã€‚è“¦ç„¶å›é¦–ï¼Œé‚£äººå´åœ¨ï¼Œç¯ç«é˜‘çŠå¤„&amp;rdquo; &amp;ndash; è¾›å¼ƒç–¾ã€Šé’ç‰æ¡ˆÂ·å…ƒå¤•ã€‹&lt;/li&gt;
&lt;li&gt;&amp;ldquo;é“ç”Ÿä¸€ï¼Œä¸€ç”ŸäºŒï¼ŒäºŒç”Ÿä¸‰ï¼Œä¸‰ç”Ÿä¸‡ç‰©&amp;rdquo; &amp;ndash; è€å­ã€Š&lt;a href=&#34;https://baike.baidu.com/item/%E9%81%93%E5%BE%B7%E7%BB%8F/327138&#34;&gt;é“å¾·ç»&lt;/a&gt;ã€‹&lt;/li&gt;
&lt;li&gt;&amp;ldquo;&lt;strong&gt;ä¸‡ç‰©ä¹‹å§‹ï¼Œå¤§é“è‡³ç®€ï¼Œè¡åŒ–è‡³ç¹&lt;/strong&gt;&amp;rdquo; &amp;ndash; è€å­ã€Š&lt;a href=&#34;https://baike.baidu.com/item/%E9%81%93%E5%BE%B7%E7%BB%8F/327138&#34;&gt;é“å¾·ç»&lt;/a&gt;ã€‹&lt;/li&gt;
&lt;/ol&gt;
</description>
      
    </item>
    
    <item>
      <title>è®¾è®¡è‰ç¨¿-ç›´æ’­é—´èµ é€ç¤¼ç‰©åŠŸèƒ½</title>
      <link>https://weedge.github.io/post/zb-gift/</link>
      <pubDate>Mon, 21 Nov 2022 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/zb-gift/</guid>
      
        <description>&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;ç›´æ’­çº¿ä¸Šäº’åŠ¨ï¼Œå·²æˆä¸ºå½“ä¸‹ç”Ÿæ´»çš„ä¸€éƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯å—ç–«æƒ…å½±å“ï¼Œæˆä¸ºäº’è”ç½‘çš„ä¸»è¦æµé‡å…¥å£ï¼›ç ”ç©¶äº†ä¸‹å„ä¸ªå¹³å°ç›´æ’­é—´é€ç¤¼ç‰©çš„åŠŸèƒ½ï¼Œå‘ç°å¤§åŒå°å¼‚ï¼Œåœ¨ç¤¼ç‰©åˆ†ç»„ï¼Œä¸€äº›å®šåˆ¶åŒ–çš„ç¤¼ç‰©æœ‰åŒºåˆ†ï¼Œæ•´ä½“äº¤äº’æµç¨‹å¤§è‡´ç›¸åŒï¼Œä¸»è¦æ˜¯ç›´æ’­é—´ä¸»æ’­ä¸Šæ’­ï¼Œç”¨æˆ·é€šè¿‡ç¤¼ç‰©æ‰“èµç»™ä¸»æ’­ä»¬(ä¸€ä¸ªç›´æ’­é—´å¯èƒ½æœ‰å¤šåä¸»æ’­åœ¨äº’åŠ¨)ï¼Œç¤¼ç‰©æ˜¯é€šè¿‡è™šæ‹Ÿå¸(**å¸) æ¢ç®—ï¼Œæ—©æœŸäº’è”ç½‘ç”¨æˆ·çº¿ä¸Šäº’åŠ¨ç¤¼ç‰©ï¼Œç©å®¶æœ€å¤šçš„åº”è¯¥æ˜¯QQå¸äº†ï¼Œåªä¸è¿‡ä»¥å‰çš„æ‰“èµèµ é€åœºæ™¯æ˜¯åœ¨web2.0åˆšå¼€å§‹çš„æ—¶å€™ï¼Œäº¤äº’çš„å¤§å¤šæ˜¯æ–‡å­—å’Œå›¾ç‰‡ï¼Œç›¸å…³äº§å“åœºæ™¯ï¼Œè™šæ‹Ÿç©ºé—´(ä¸ªäººç©ºé—´ï¼Œåšå®¢ï¼Œç§èœç­‰å¨±ä¹äº’åŠ¨åœºæ™¯)ï¼›éšç€åº•å±‚ç½‘ç»œåŸºå»ºçš„å‘å±•ï¼Œ4Gä¹‹åå‡ºç°äº†å¤§é‡çš„è§†é¢‘ç½‘ç«™ï¼Œç”¨æˆ·å¯ä»¥å½•ä¸€äº›è§†é¢‘å†…å®¹æ¥äº’åŠ¨ï¼›åˆ°åæ¥éŸ³è§†é¢‘æµåª’ä½“çš„å‘å±•ï¼Œç›¸å…³çš„åœ¨çº¿ç›´æ’­é—´å¼€å§‹æ¶Œç°ï¼Œç”¨æˆ·ä¹‹é—´äº«å—ä¸€æ³¢ç›´æ’­çº¢åˆ©å¸¦æ¥çš„äº’åŠ¨ï¼Œå½“ç„¶å½±å“ç›¸å¯¹äºå‰é¢çš„å½¢å¼æ›´åŠ å®æ—¶å’Œç›´æ¥ï¼›ç°åœ¨çš„5Gå’Œæœªæ¥6Gï¼Œä»¥åŠç‰©è”ç½‘éƒ½ä¼šç»™ç›´æ’­å½¢å¼å¸¦æ¥æ–°çš„äº’åŠ¨åœºæ™¯,æ¯”å¦‚ï¼šè™šæ‹Ÿä¼šåœºï¼Œäººæœºäº’åŠ¨ï¼›å…¶ä¸­æ—©æœŸåŸ¹å…»èµ·æ¥çš„æ‰“èµé€ç¤¼è¡Œä¸ºåŠŸèƒ½ç»å¸¸ç”¨äºæœ‰ä¸»æ’­çš„å¨±ä¹äº’åŠ¨ç›´æ’­ä¸­ï¼Œä¹Ÿæ˜¯å¢å€¼ç›ˆåˆ©çš„ä¸€éƒ¨åˆ†ï¼›&lt;/p&gt;
&lt;p&gt;tips: é™¤äº†é€ç¤¼åŠŸèƒ½ï¼Œæ ¹æ®ä¸åŒç›´æ’­åœºæ™¯ï¼Œè¿˜æœ‰è¯­éŸ³è§†é¢‘è¿éº¦ï¼Œç”µå•†å¸¦è´§å•†å“ï¼Œæ²¡æœ‰ä¸»æ’­ï¼ŒèŠ‚ç›®ç›´æ’­/è½¬æ’­ï¼Œä¼šè®®ç›´æ’­ï¼Œè‡ªä¹ å®¤ï¼ŒåŸºæœ¬çš„ç‚¹èµï¼Œè®¡æ•°ï¼ŒèŠå¤©åŸºç¡€æœåŠ¡åŠŸèƒ½ï¼›è¿˜æœ‰äº›æŠ½å¥–åŠŸèƒ½ï¼Œç­”é¢˜åŠŸèƒ½(æ•™è‚²ç±»ç›´æ’­å±…å¤š)ï¼ŒæŠ•ç¥¨ï¼Œçº¢åŒ…è¿™äº›åŠŸèƒ½æœåŠ¡å¯åœ¨å¼€æ’­æ—¶è®¾ç½®ï¼Œæ˜¯å¦å¯ç”¨ï¼›æœ‰ç”¨æˆ·åŸºç¡€çš„æµé‡å¹³å°å¯èƒ½è¿˜ä¼šä»¥ç«ä»·æ’åçš„æ–¹å¼æ¨èä¸€æ³¢ï¼›è¿™äº›åŠŸèƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªå¯ç®¡ç†çš„æ’ä»¶ï¼Œé€šè¿‡ç»„åˆçš„æ–¹å¼åº”ç”¨äºç›´æ’­ä¸­ï¼Œæ–¹ä¾¿ç®¡ç†ï¼Œåç»­å¯ä»¥æ·»åŠ æ–°åŠŸèƒ½æ»¡è¶³æŸç±»å‹ç›´æ’­åœºæ™¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;éœ€æ±‚è®¾è®¡&#34;&gt;éœ€æ±‚è®¾è®¡&lt;/h2&gt;
&lt;p&gt;è®¾è®¡ä¸€ä¸ªç®€å•ç¤¼ç‰©æ‰“èµåŠŸèƒ½: Aç”¨æˆ·(è§‚ä¼—)èµ é€ç¤¼ç‰©ç»™Bç”¨æˆ·(ä¸»æ’­)ï¼Œå¯ä»¥ç»™å¤šä¸ªä¸»æ’­èµ é€ç¤¼ç‰©ï¼›&lt;/p&gt;
&lt;h3 id=&#34;åˆ†æ&#34;&gt;åˆ†æ&lt;/h3&gt;
&lt;p&gt;ç¤¼ç‰©ï¼šç›´æ’­å¹³å°é€šè¿‡è™šæ‹Ÿå¸æ¥ç»Ÿä¸€ç­‰ä»·äº¤æ¢çš„è™šæ‹Ÿç‰©å“ï¼Œè€Œè™šæ‹Ÿå¸æ˜¯éœ€è¦é€šè¿‡ç”¨æˆ·å……å€¼è´­ä¹°ï¼›å‘é€ç¤¼ç‰©å¯ä»¥è·å¾—ä¸€äº›ç§¯åˆ†ï¼›&lt;/p&gt;
&lt;p&gt;Aç”¨æˆ·å‘é€ç¤¼ç‰©ç»™Bç”¨æˆ·ï¼ŒAçš„è™šæ‹Ÿå¸æ‰£é™¤ï¼ŒBçš„è™šæ‹Ÿå¸ç›¸åº”å¢åŠ ï¼›éœ€è¦ä¿è¯èµ é€å’Œæ”¶åˆ°çš„æ•°é‡ä¸€è‡´ï¼›&lt;/p&gt;
&lt;p&gt;éœ€è¦è€ƒè™‘å¹¶å‘åœºæ™¯ï¼Œå¯¹äºçƒ­é—¨ä¸»æ’­é«˜å³°æœŸçš„æµé‡å€¼100wè§‚ä¼—ç”¨æˆ·åœ¨çº¿äº’åŠ¨ï¼Œæ¯ç§’é€ç¤¼çš„è¯·æ±‚æ•°é‡ä¹Ÿå¯èƒ½é«˜äºè¿™ä¸ªå€¼ï¼Œç”¨æˆ·å¯èƒ½è¿å‡»é€å‡ºå¤šæ¬¡ï¼Œ è€Œä¸”ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´å’Œååï¼Œå°½é‡å‡å°‘é”çš„ä½¿ç”¨ï¼Œæˆ–è€…è¯´é‡‡ç”¨&lt;a href=&#34;https://en.wikipedia.org/wiki/Optimistic_concurrency_control&#34;&gt;OCC&lt;/a&gt;ï¼Œä¹è§‚é”çš„æ–¹å¼æ¥å¤„ç†äº‹åŠ¡ï¼Œäº¤ç”±ä¸šåŠ¡æœåŠ¡ç¨‹åºæ¥å¤„ç†ï¼Œå°½é‡å‡å°‘æˆ–å‡çŸ­æ•°æ®åº“ä¸­å¿ƒå­˜å‚¨æœåŠ¡ä¸Šçš„é”æ“ä½œï¼ŒåŸç†å°±æ˜¯ï¼šå¤¯ä¸»åï¼Œå°±å‘†èŒäº†ï¼Œèµ„æºæœªé‡Šæ”¾ï¼Œè¯·æ±‚èµ„æºä¸€å¢å¤šï¼Œå¯¼è‡´æ•´ä¸ªæœåŠ¡ååä¸‹é™ï¼Œä¸€ç›´æŒç»­ä¸‹å»éšæ—¶éƒ½ä¼šdownæ‰ï¼Œè€Œä¸”é”æ˜¯å»ºç«‹åœ¨ç´¢å¼•æ•°æ®ä¹‹ä¸Šçš„ï¼Œ å¦‚æœæ²¡æœ‰ç›¸å…³é™çº§å¤„ç†ï¼Œå¼„ä¸å¥½æ•´ä½“æœåŠ¡å°±&lt;a href=&#34;https://www.youtube.com/watch?v=4m48GqaOz90&#34;&gt;galigeigei&lt;/a&gt;ï¼›&lt;/p&gt;
&lt;p&gt;100W è§‚ä¼—Aå‘åŒä¸€ä¸ªä¸»æ’­B èµ é€ç¤¼ç‰©ï¼Œå¯¹äºä¸»æ’­Bçš„è™šæ‹Ÿå¸ç´¯è®¡å†™æ“ä½œæ¯”è¾ƒå¤§ï¼ŒåŒä¸€æ—¶é—´å¯èƒ½100W+çš„w æ“ä½œ ä¸»æ’­B è™šæ‹Ÿå¸è¿™æ¡è®°å½•ï¼Œå¦‚æœç›´æ¥åŒæ­¥æ“ä½œåœ¨æ•°æ®åº“å±‚é¢ä¼šå‡ºç°è¡Œé”ï¼Œä¼šç­‰å¾…å¤¯ä¸»æ•´ä¸ªèµ é€æµç¨‹ï¼Œæ‰€ä»¥éœ€è¦æŠŠè¿™äº›é›†ä¸­å†™ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥å»æ›´æ–°è™šæ‹Ÿå¸æ•°ç›®ï¼Œè¿›è€Œæé«˜è§‚ä¼—é€ç¤¼æ¥å£çš„ååé‡ï¼Œ&lt;/p&gt;
&lt;p&gt;è§‚ä¼—è™½ç„¶æ“ä½œè‡ªå·±çš„è™šæ‹Ÿå¸æ•°ç›®è¡Œè®°å½•ï¼Œä½†æ˜¯ç›´æ¥æ“ä½œæ•°æ®åº“ï¼Œå³ä½¿å¯¹ç”¨æˆ·èµ„äº§è¡¨è¿›è¡Œåˆ†åº“åˆ†è¡¨æ“ä½œï¼Œä¹Ÿä¼šæœ‰å¤§é‡çš„ç£ç›˜i/oï¼Œæ‰€ä»¥ç›´æ’­é—´çš„äº’åŠ¨æ•°æ®ç›´æ¥åœ¨ç¼“å­˜ä¸­æ“ä½œï¼ŒæŠŠè§‚ä¼—çš„æ“ä½œè®°å½•æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼å¼‚æ­¥è½åº“ï¼›&lt;/p&gt;
&lt;p&gt;ç¼“å­˜çš„æ–¹å¼æ“ä½œï¼Œéœ€è¦æŠŠè§‚ä¼—çš„ç”¨æˆ·èµ„äº§ä¿¡æ¯å‰ç½®é¢„çƒ­è‡³ç¼“å­˜ä¸­ï¼Œç›´æ’­ä¸­ç›´æ¥æ“ä½œç¼“å­˜ï¼Œ æ“ä½œç¼“å­˜éœ€è¦ä¿è¯å¹¶å‘æ“ä½œäº‹åŠ¡çš„åŸå­æ€§ï¼Œä¿è¯è§‚ä¼—çš„è™šæ‹Ÿå¸ä¸èƒ½å¤šæ‰£æˆ–è€…å°‘æ‰£ï¼›&lt;/p&gt;
&lt;p&gt;å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¸ºäº†å‡å°‘å¤§é‡ç”¨æˆ·å†²å‡»åº•å±‚æ•°æ®åº“ï¼Œå‡å°‘ç£ç›˜io, é€ç¤¼ç‰©è¿™äº›äº’åŠ¨ç›´æ¥è¯»å†™ç”¨æˆ·ç¼“å­˜æ•°æ®ï¼Œè¿™äº›ç¼“å­˜æ•°æ®çš„æ“ä½œç±»å‹åˆ†ä¸ºæ˜¯/å¦æ›´æ–°é¢‘ç¹ï¼›&lt;/p&gt;
&lt;p&gt;æ›´æ–°ä¸é¢‘ç¹æ•°æ®ï¼šç”¨æˆ·ï¼Œç›´æ’­é—´ï¼Œç‰©æ–™è¯¦æƒ…ç­‰ä¿¡æ¯ï¼Œè¿™äº›ç¼“å­˜æ•°æ®åœ¨è¿›å…¥ç›´æ’­é—´çš„æ—¶å€™ç›´æ¥ä»æ•°æ®åº“ä»¥cacheAside patternè·å–å¡«å……ï¼Œå¡«å……çš„æ—¶å€™é‡‡ç”¨singleflightæ–¹å¼ï¼›ç‰©æ–™ä¿¡æ¯è¿˜å¯ä»¥æœåŠ¡æœ¬åœ°ç¼“å­˜ä¸€ä»½ï¼›å˜æ›´æ•°æ®æ—¶ï¼Œè¿œç«¯ç¼“å­˜æ•°æ®å¯ä»¥é€šè¿‡CDCè®¢é˜…æ•°æ®åº“æ“ä½œæ—¥å¿—(æ¯”å¦‚ï¼šbinlog)æ¥ä¸»åŠ¨å¼‚æ­¥æ›´æ–°ç¼“å­˜æ•°æ®ï¼Œæˆ–è€…ä½¿ç”¨å»¶æ—¶åŒåˆ æ¥è¢«åŠ¨æ›´æ–°ï¼Œæœ¬åœ°ç¼“å­˜å¯æ ¹æ®é€šè¿‡æ§åˆ¶å¹³é¢é…ç½®ä¸‹å‘æ¥è§¦å‘ä»è¿œç«¯ç¼“å­˜æ›´æ–°æ•°æ®ï¼›&lt;/p&gt;
&lt;p&gt;æ›´æ–°é¢‘ç¹æ•°æ®ï¼š è¿™ä¸ªä¸»è¦å‘ç”Ÿåœ¨ç”¨æˆ·ç›´æ’­äº’åŠ¨ï¼Œèµ é€ç¤¼ç‰©åœºæ™¯ï¼Œå¤šæ¬¡å¹¶å‘æ“ä½œï¼Œå˜æ›´çš„å®ä½“æ•°æ® è§‚ä¼—/ä¸»æ’­è™šæ‹Ÿèµ„äº§æ‰£é™¤/å¢åŠ ï¼Œè¿™äº›æ•°æ®ä»¥writeThrough/Behind partternæ–¹å¼ç›´æ¥æ›´æ–°ç¼“å­˜ï¼Œé˜Ÿåˆ—å¼‚æ­¥è½åº“ï¼›å› ä¸ºç›´æ’­åœºæ™¯ç”¨æˆ·çš„æ•°æ®éƒ½åœ¨ç¼“å­˜ä¸­ï¼Œæ•°æ®å®æ—¶æ›´æ–°æŸ¥çœ‹ï¼Œä¸å½±å“ç”¨æˆ·ä½“éªŒï¼›ç›´æ’­ç›‘æ§åå°ä»æ•°æ®åº“é‡Œè®¢é˜…è¿‘å®æ—¶æŸ¥çœ‹ç”¨æˆ·çš„è™šæ‹Ÿèµ„äº§ï¼Œä¼šæœ‰ä¸€ä¸ªæ‰¹é‡çª—å£çš„å¤„ç†å»¶è¿Ÿï¼›&lt;/p&gt;
&lt;p&gt;ç¼“å­˜æ•°æ®åˆå§‹åŒ–ï¼Œå¯ä»¥åœ¨ç”¨æˆ·åˆšæ‰“å¼€appçš„æ—¶å€™åˆå§‹åŒ–ï¼Œä¹Ÿå¯ä»¥åœ¨è¿›å…¥/åˆ›å»ºå¥½ç›´æ’­é—´çš„æ—¶å€™åˆå§‹åŒ–å¥½ç”¨æˆ·ç›´æ’­é—´ç¼“å­˜æ•°æ®ï¼›&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šå¯ä»¥å°†æ“ä½œåˆ†2ä¸ªå…³é”®æ­¥éª¤ï¼š è§‚ä¼—èµ é€ç¤¼ç‰©å’Œå¼‚æ­¥æ›´æ–°è§‚ä¼—å’Œä¸»æ’­çš„èµ„äº§ä¿¡æ¯ï¼›é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—æ¥è§£è€¦ï¼Œæé«˜é€ç¤¼æ¥å£ååå’Œè¯·æ±‚å“åº”å»¶è¿Ÿï¼Œä»¥åŠä»¥pullæ–¹å¼æ¶ˆè´¹ï¼Œç¼“è§£æ•°æ®åº“å®ä¾‹çš„è¯»å†™å‹åŠ›ï¼›&lt;/p&gt;
&lt;p&gt;è§‚ä¼—èµ é€ç¤¼ç‰©ï¼š ç¤¼ç‰©æ˜¯é€šè¿‡è™šæ‹Ÿè´§å¸è¿›è¡Œç­‰ä»·äº¤æ¢çš„ï¼Œé€šè¿‡ç¤¼ç‰©idè·å–åˆ°å¯¹åº”æ¶ˆè´¹çš„è™šæ‹Ÿèµ„äº§ï¼Œå¯¹ä¸­å¿ƒè¿œç«¯ç¼“å­˜åˆ†ç‰‡ä¸­çš„è§‚ä¼—è™šæ‹Ÿèµ„äº§è¿›è¡Œäº‹åŠ¡æ‰£é™¤å¤„ç†ï¼Œäº‹åŠ¡æäº¤ä¹‹åï¼Œå‘é€äº‹åŠ¡æ¶ˆæ¯ï¼›è¿™é‡Œé‡‡ç”¨casæ–¹å¼å¤„ç†ï¼Œä¸€ç§æ˜¯watch key(string è¯»å†™ioæ˜¯O(1), ä¸ç”¨hashæ˜¯å› ä¸ºè¯»å–å…¨éƒ¨èµ„äº§ä¿¡æ¯ioæ˜¯O(n))+äº‹åŠ¡æ–¹å¼ï¼Œä¸€ç§æ˜¯luaçš„å½¢å¼ç›´æ¥å†™ä¸šåŠ¡æäº¤è„šæœ¬ç»™redisæ ¸å¿ƒä¸»çº¿ç¨‹å»å¤„ç†ï¼›è¿™é‡Œå¯èƒ½ä¼šæƒ³åˆ°ç›´æ¥ç”¨ hash incråŸå­æ“ä½œï¼Œä½†æ˜¯è¿™é‡Œä¸è¡Œï¼Œå› ä¸ºéœ€è¦è¯»å‡ºkeyå¯¹åº”çš„è™šæ‹Ÿèµ„äº§ï¼Œç”¨äºåˆ¤æ–­è™šæ‹Ÿèµ„æºæ˜¯å¦å……è¶³ï¼Œè¯»å‡ºæ¥åœ¨æ‰£é™¤å†™å…¥ï¼Œéœ€è¦ä¸€èµ·æ‰§è¡Œï¼Œä¿è¯äº‹åŠ¡åŸå­æ€§ï¼›é™¤äº†æ ¸å¿ƒæµç¨‹ï¼Œè¿˜æœ‰å‘é€ç¤¼ç‰©æˆåŠŸåï¼Œéœ€è¦æ¨é€æ¶ˆæ¯åˆ°ç›´æ’­é—´ï¼Œæ ¹æ®äº§å“ç¤¼å“ç­–ç•¥åˆ¤æ–­æ˜¯å¦å±•ç¤ºç‰¹æ•ˆ; ä»¥åŠå¢åŠ ç”¨æˆ·æ´»åŠ¨ç§¯åˆ†ï¼Œå¢åŠ äº’åŠ¨ç§¯ææ€§ï¼›&lt;/p&gt;
&lt;p&gt;å¼‚æ­¥æ›´æ–°è§‚ä¼—å’Œä¸»æ’­æ•°æ®åº“è½åœ°èµ„äº§ä¿¡æ¯ï¼šè¿™é‡Œä¸ºäº†å‡å°‘å¯¹æ•°æ®åº“çš„è¡Œé”çš„å¹¶å‘å‹åŠ›ï¼Œä¹Ÿé‡‡ç”¨CASçš„æ–¹å¼æ¥æ›´æ–°æ•°æ®åº“çš„æ•°æ®ï¼Œ&lt;/p&gt;
&lt;p&gt;æ¶ˆæ¯é˜Ÿåˆ—ï¼šæ¶‰åŠåˆ°é‡‘é’±ï¼Œä¸ºäº†æé«˜ååï¼Œéœ€è¦ä¿è¯æ•°æ®å‡†ç¡®ï¼Œæ•°æ®æœ€ç»ˆä¸€è‡´(&lt;a href=&#34;https://www.allthingsdistributed.com/2008/12/eventually_consistent.html&#34;&gt;&lt;strong&gt;BASE&lt;/strong&gt;&lt;/a&gt;)ï¼Œé‡‡ç”¨æ”¯æŒäº‹åŠ¡æ¶ˆæ¯çš„åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¯”å¦‚ï¼š&lt;a href=&#34;https://rocketmq.apache.org/zh/docs/featureBehavior/04transactionmessage/&#34;&gt;rocketMQ&lt;strong&gt;äº‹åŠ¡æ¶ˆæ¯&lt;/strong&gt;&lt;/a&gt;ï¼Œè¿™é‡Œå¯èƒ½æœ‰ä¸ªç–‘é—®å¦‚æœåˆšå¼€å§‹å‘é€äº‹åŠ¡æ¶ˆæ¯å°±å¤±è´¥äº†ï¼Œå¯èƒ½æ˜¯ç½‘ç»œæŠ–åŠ¨,æˆ–è€…æœåŠ¡è´Ÿè½½å‘Šç­‰åŸå› ï¼Œä¸€èˆ¬æ˜¯å¯ç”¨failoveræƒé‡&lt;a href=&#34;https://en.wikipedia.org/wiki/Exponential_backoff&#34;&gt;æŒ‡æ•°é€€é¿&lt;/a&gt;ç­–ç•¥é‡è¯•åˆ°ä¸åŒæœºæˆ¿çš„rocketMQé›†ç¾¤ï¼Œå¯ä»¥æŸ¥çœ‹&lt;a href=&#34;https://rocketmq.apache.org/zh/docs/featureBehavior/05sendretrypolicy#%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81%E9%87%8D%E8%AF%95%E6%9C%BA%E5%88%B6&#34;&gt;æ¶ˆæ¯å‘é€é‡è¯•æœºåˆ¶&lt;/a&gt; å’Œ &lt;a href=&#34;https://rocketmq.apache.org/zh/docs/bestPractice/15bestpractice&#34;&gt;æœ€ä½³å®è·µ&lt;/a&gt;, &lt;a href=&#34;https://aws.amazon.com/cn/builders-library/timeouts-retries-and-backoff-with-jitter/&#34;&gt;timeouts-retries-and-backoff-with-jitter&lt;/a&gt;ï¼›å¦‚æœé‡è¯•è¿˜æ˜¯å¤±è´¥æ‰“å°é”™è¯¯æ—¥å¿—è®°å½•å‘é€è¯¦æƒ…ï¼Œé€šè¿‡å®æ—¶æ•°æ®æµå°†å¼‚å¸¸è¡Œä¸ºå†™å…¥dbä¸­ï¼Œä»¥ä¾¿åç»­è¡¥å‘ï¼›&lt;/p&gt;
&lt;p&gt;Tips: å¦‚æœä½¿ç”¨é˜¿é‡Œäº‘rocketMQ, éœ€è¦æ³¨æ„æ”¯æŒç‰ˆæœ¬æä¾›çš„SDKï¼Œ5.0 ç‰ˆæœ¬ &lt;a href=&#34;https://github.com/apache/rocketmq-clients&#34;&gt;client SDK&lt;/a&gt; ; 4.0ç›¸å…³ç‰ˆæœ¬æœ‰äº›å¼€å‘è¯­è¨€ä¸æ”¯æŒtcpæ–¹å¼ï¼Œä»…æä¾›httpçš„æ–¹å¼(ä¼šå°‘äº†ä¸€äº›åŠŸèƒ½ï¼Œæ¯”å¦‚æ‰¹é‡å‘é€æ™®é€šæ¶ˆæ¯)ï¼›é€‰ç”¨æ–°ç‰ˆçš„5.0ç‰ˆæœ¬çš„SDKå¼€å‘; å¦‚æœæœ‰è‡ªå»ºè¿ç»´èƒ½åŠ›ï¼Œç›´æ¥ä½¿ç”¨å¼€æºæ–¹æ¡ˆæ¥æ­å»ºä¸€å¥—ï¼Œæ¯”å¦‚ç”¨&lt;a href=&#34;https://www.amazonaws.cn/solutions/apache-rocketmq-on-aws/&#34;&gt;rocketMQ on aws&lt;/a&gt;ï¼Œå¹¶ä¸”ä½¿ç”¨5.0å¯ä»¥å®ç°ä¸€å±‚mq-proxy;&lt;/p&gt;
&lt;p&gt;é¢˜å¤–è¯: ç°åœ¨åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—&lt;a href=&#34;https://kafka.apache.org/33/documentation/streams/architecture&#34;&gt;kafka-streams&lt;/a&gt;, &lt;a href=&#34;https://github.com/apache/rocketmq-streams&#34;&gt;rocketmq-streams&lt;/a&gt; æ”¯æŒæ•°æ®æµ(stream)å¤„ç†å¤§æ•°æ®å®æ—¶åœºæ™¯ï¼Œæ”¯æŒä¸€äº›ç®€å•ç®—å­æ“ä½œå’ŒSQL(&lt;a href=&#34;https://github.com/confluentinc/ksql&#34;&gt;ksql&lt;/a&gt;, &lt;a href=&#34;https://github.com/alibaba/rsqldb&#34;&gt;rsql&lt;/a&gt;)ï¼›è¿™ä¸ªå’Œflinkå¯¹åº”åŠŸèƒ½æ˜¯é‡åˆäº†ï¼Œflinkä¹Ÿåœ¨å¾€table storeä¸Šå‘åŠ›æ»¡è¶³æ•°æ®å †ç§¯çš„èƒ½åŠ›; ä¸€æ³¢æµï½&lt;/p&gt;
&lt;h3 id=&#34;è°ƒç ”&#34;&gt;è°ƒç ”&lt;/h3&gt;
&lt;p&gt;ä»¥pcç«¯æŠ“httpåŒ…ä¸ºä¾‹ï¼Œæ‰‹æœºç«¯æ¥å£ä¸€æ ·&lt;/p&gt;
&lt;h4 id=&#34;æŠ–éŸ³æ¥å£&#34;&gt;æŠ–éŸ³æ¥å£&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;curl &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;https://live.douyin.com/webcast/gift/send/?aid=6383&amp;amp;live_id=1&amp;amp;device_platform=web&amp;amp;language=zh-CN&amp;amp;enter_from=web_live&amp;amp;cookie_enabled=true&amp;amp;screen_width=2048&amp;amp;screen_height=1152&amp;amp;browser_language=zh-CN&amp;amp;browser_platform=MacIntel&amp;amp;browser_name=Chrome&amp;amp;browser_version=107.0.0.0&amp;amp;browser_online=true&amp;amp;engine_name=Blink&amp;amp;engine_version=107.0.0.0&amp;amp;os_name=Mac+OS&amp;amp;os_version=10.15.7&amp;amp;cpu_core_num=8&amp;amp;device_memory=8&amp;amp;platform=PC&amp;amp;downlink=10&amp;amp;effective_type=4g&amp;amp;round_trip_time=50&amp;amp;channel=channel_pc_web&amp;amp;app_name=douyin_web&amp;amp;webid=7167235205950047744&amp;amp;user_agent=Mozilla%2F5.0+(Macintosh%3B+Intel+Mac+OS+X+10_15_7)+AppleWebKit%2F537.36+(KHTML,+like+Gecko)+Chrome%2F107.0.0.0+Safari%2F537.36&amp;amp;fp=verify_lam4f5i1_plZJSYeB_iUgU_4z2o_9JHF_d7Z0Z60sLg33&amp;amp;did=0&amp;amp;referer=https:%2F%2Flive.douyin.com%2F444452144000%3Fcover_type%3D0%26enter_from_merge%3Dweb_live%26enter_method%3Dweb_card%26game_name%3D%26is_recommend%3D1%26live_type%3Dgame%26more_detail%3D%26request_id%3D2022111814283801020916816201004237%26room_id%3D7167220081737468683%26stream_type%3Dvertical%26title_type%3D1%26web_live_page%3Dhot_live%26web_live_tab%3Dall&amp;amp;target=&amp;amp;device_id=7167235205950047744&amp;amp;msToken=aOEoMNHAEI98H45Z0n-zUTffiNgv7HNkGU0lwFptk-JBg00tEs0I74G4sYXgG670cAdhSmXNcKlRU3-QaxW7Pflt-p8YAmyU5eC3EGJQfp7Mk7JpmP_P&amp;amp;X-Bogus=DFSzswVL0qCmAcoQS8MuBN7TlqS8&amp;amp;_signature=_02B4Z6wo00001Heu8JQAAIDD43irmgubdKx3rvQAAH6ktTtRdH7gtQJWp3SjldUkeBB51lpkXUQ700UnFEXODUicQ0r1ccxSxq4OwWIjvxuNe8Acl-gJzChe99W43SojHkPp9aa82Qzi9VoTd2&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;authority: live.douyin.com&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;accept: application/json, text/plain, */*&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;accept-language: zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;content-type: application/x-www-form-urlencoded&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;cookie: xgplayer_user_id=502915240928; csrf_session_id=f5161482adac52884f25a91fa758d7b0; ttcid=5cd5ff73751f4ab39911c85e57f9ca7479; passport_csrf_token=46e48d1e7b4df245f8caab8a34b64935; passport_csrf_token_default=46e48d1e7b4df245f8caab8a34b64935; home_can_add_dy_2_desktop=%220%22; n_mh=Qo43cptpX41bfwDmWyVyRUGMZnsucxhgcWJqKjjWkvI; sso_uid_tt=a84f8e3ae1f0c8301f5a882b05abe3f0; sso_uid_tt_ss=a84f8e3ae1f0c8301f5a882b05abe3f0; toutiao_sso_user=a28a6e92e7dc7d690b4f6b9a59077692; toutiao_sso_user_ss=a28a6e92e7dc7d690b4f6b9a59077692; passport_assist_user=Cjyr0IY04IJK-7Hxgl87vzPKZIfpFS29oAG2arITfMftUANM_d6SDxwAksiJEuVqZgZdE_BYyvcjLLGAQaYaSAo8zVwGiPnNM3S7eRNlXwMkuS7yNVm17pbNfKqXsXj3Rgk9Nm08DWh_PY0JRbH8FQeLxabRAoqM4bPJTzQ8EM_DoQ0Yia_WVCIBAxToQPk%3D; sid_ucp_sso_v1=1.0.0-KGIxM2FlNmE2MDdiNWE5MDA1YmIwZjg5OWVkNTUxMTBhMzdhYWE2OTIKHQjhrMGYrgIQt8vcmwYY7zEgDDDHuNHRBTgGQPQHGgJobCIgYTI4YTZlOTJlN2RjN2Q2OTBiNGY2YjlhNTkwNzc2OTI; ssid_ucp_sso_v1=1.0.0-KGIxM2FlNmE2MDdiNWE5MDA1YmIwZjg5OWVkNTUxMTBhMzdhYWE2OTIKHQjhrMGYrgIQt8vcmwYY7zEgDDDHuNHRBTgGQPQHGgJobCIgYTI4YTZlOTJlN2RjN2Q2OTBiNGY2YjlhNTkwNzc2OTI; passport_auth_status=ba24f5319c0f02c6232d484fd51c2187%2C; passport_auth_status_ss=ba24f5319c0f02c6232d484fd51c2187%2C; sid_guard=ea2e466c926c317f4f552f0d3982a458%7C1668752823%7C5184000%7CTue%2C+17-Jan-2023+06%3A27%3A03+GMT; uid_tt=23c596f546d448da13c0098152ef5d17; uid_tt_ss=23c596f546d448da13c0098152ef5d17; sid_tt=ea2e466c926c317f4f552f0d3982a458; sessionid=ea2e466c926c317f4f552f0d3982a458; sessionid_ss=ea2e466c926c317f4f552f0d3982a458; sid_ucp_v1=1.0.0-KDRiMzcyMDVkZmZhMWIxNjhjNDM4YjBiZDA4Y2E5ZTBmN2IxNTE1NjIKFwjhrMGYrgIQt8vcmwYY7zEgDDgGQPQHGgJsZiIgZWEyZTQ2NmM5MjZjMzE3ZjRmNTUyZjBkMzk4MmE0NTg; ssid_ucp_v1=1.0.0-KDRiMzcyMDVkZmZhMWIxNjhjNDM4YjBiZDA4Y2E5ZTBmN2IxNTE1NjIKFwjhrMGYrgIQt8vcmwYY7zEgDDgGQPQHGgJsZiIgZWEyZTQ2NmM5MjZjMzE3ZjRmNTUyZjBkMzk4MmE0NTg; FOLLOW_NUMBER_YELLOW_POINT_INFO=%22MS4wLjABAAAAt_v5oVMmcxuNnLLRzi6Ey1GKVQr_2XVFt2jPbkhZPI8%2F1668787200000%2F0%2F1668752826051%2F0%22; strategyABtestKey=%221668752909.101%22; __ac_nonce=06377261b0070042789c9; __ac_signature=_02B4Z6wo00f01JfP74gAAIDDAxm0hJMbmiiX7-sAAEaJTk9YXvYiEKlcYbhZnUTqyIVISJ6Z9uR3UEye00i7MfEP1dAywrmbnaQAIP3m1.7zOA8BmpqIWhyYJal-u6k6LMxVpsCtyakYsz3325; live_can_add_dy_2_desktop=%221%22; tt_scid=PpJHVbeNWnhY54EQ6vWraqXl5A8SZDtl3dn9JTaQQNLPo37ztPaJz.xoJHxyhNYScf8e; s_v_web_id=verify_lam4f5i1_plZJSYeB_iUgU_4z2o_9JHF_d7Z0Z60sLg33; ttwid=1%7C-XDacSDIgDIHmJqBxLj6Op91O91Ww4nvf96AveJpNeE%7C1668752951%7C0275ac24a410dd06b5f87dc4d84188f6eedaf20ed69cc9d0e979559df7df461e; download_guide=%223%2F20221118%22; odin_tt=3a02e4ad7a6c9042e1c42ece6d0d4a1aeeb37ed334f3450eb4adf57a6d0e09938523f8954816d90d557b27f5d3cbea85; msToken=1GTirdFSckP7H_txAPOKIMLWleKhlwccm-ts_3OviXegeQ2cr0B56jMAqfB3SqEGnxPEBjXRWsmg-sxVW3okb1s-acOAnBkIVDA_47g5aZFOqMKEzI-N; msToken=aOEoMNHAEI98H45Z0n-zUTffiNgv7HNkGU0lwFptk-JBg00tEs0I74G4sYXgG670cAdhSmXNcKlRU3-QaxW7Pflt-p8YAmyU5eC3EGJQfp7Mk7JpmP_P&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;origin: https://live.douyin.com&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;referer: https://live.douyin.com/444452144000&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;sec-ch-ua: &amp;#34;Google Chrome&amp;#34;;v=&amp;#34;107&amp;#34;, &amp;#34;Chromium&amp;#34;;v=&amp;#34;107&amp;#34;, &amp;#34;Not=A?Brand&amp;#34;;v=&amp;#34;24&amp;#34;&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;sec-ch-ua-mobile: ?0&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;sec-ch-ua-platform: &amp;#34;macOS&amp;#34;&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;sec-fetch-dest: empty&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;sec-fetch-mode: cors&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;sec-fetch-site: same-origin&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;x-secsdk-csrf-token: 000100000001c39118162052c6b50f6dadb067cc07c073c9b93f035ea22242c67c43f5951903172899f1bc355042&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  --data-raw &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;room_id=7167220081737468683&amp;amp;to_room_id=7167220081737468683&amp;amp;sec_to_user_id=MS4wLjABAAAAOgGR5D9qmmPglgaT08-30j8vnjeeAdmgXhJY_8Q7oLk&amp;amp;to_episode_id=0&amp;amp;send_type=4&amp;amp;send_scene=1&amp;amp;gift_source=0&amp;amp;buff_level=0&amp;amp;count=1&amp;amp;price=2&amp;amp;gift_id=2002&amp;amp;is_first_combo=true&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  --compressed -iv
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å“åº”&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;{
 &lt;span style=&#34;color:#1e90ff;font-weight:bold&#34;&gt;&amp;#34;data&amp;#34;&lt;/span&gt;: {
   &lt;span style=&#34;color:#1e90ff;font-weight:bold&#34;&gt;&amp;#34;message&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;Insufficient Fund&amp;#34;&lt;/span&gt;,
   &lt;span style=&#34;color:#1e90ff;font-weight:bold&#34;&gt;&amp;#34;prompts&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;ä½™é¢ä¸è¶³&amp;#34;&lt;/span&gt;
 },
 &lt;span style=&#34;color:#1e90ff;font-weight:bold&#34;&gt;&amp;#34;extra&amp;#34;&lt;/span&gt;: {
   &lt;span style=&#34;color:#1e90ff;font-weight:bold&#34;&gt;&amp;#34;now&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#099&#34;&gt;1668755929438&lt;/span&gt;
 },
 &lt;span style=&#34;color:#1e90ff;font-weight:bold&#34;&gt;&amp;#34;status_code&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#099&#34;&gt;40001&lt;/span&gt;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;å¿«æ‰‹æ¥å£&#34;&gt;å¿«æ‰‹æ¥å£&lt;/h4&gt;
&lt;p&gt;è¯·æ±‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;curl &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;https://live.kuaishou.com/live_graphql&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Connection: keep-alive&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Cookie: clientid=3; did=web_0d47b6546f1fd39fe4d1236703ae2b16; kuaishou.live.bfb1s=9b8f70844293bed778aade6e0a8f9942; client_key=65890b29; kpn=GAME_ZONE; userId=553458447; kuaishou.live.web_st=ChRrdWFpc2hvdS5saXZlLndlYi5zdBKgAV6EW8_dkcqveTyN6yy6uaMZd7O2c9rYOi19Fb3FhhOTPjtHtkb7lPQxQ4QaygTV0J-_Z0E7-4E5lFUZ2MRRzwjNAgbEEeSbf5duEVRtpGJnR_EEjJeZ3yyPMWPsJelIVcpSHGX02esKljXrWSXcbMWU709r4hxtaNHdMQtnvmLt1nijHxRE7lio0ZRYM5n-EK65VJq2EUpFqHFY_jFqxm0aEhrHsWfESUHgv806qk-5eqStgCIgOVwse70J74NPwA2TbGfOv-Ze0M-TVQJ0kHcHOHiTkKooBTAB; kuaishou.live.web_ph=75bafd83e69f9caf80b760c47f7b9c976d31; userId=553458447; ksliveShowClipTip=true&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Origin: https://live.kuaishou.com&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Referer: https://live.kuaishou.com/u/YiGe6666&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Sec-Fetch-Dest: empty&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Sec-Fetch-Mode: cors&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;Sec-Fetch-Site: same-origin&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;accept: */*&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;content-type: application/json&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;sec-ch-ua: &amp;#34;Google Chrome&amp;#34;;v=&amp;#34;107&amp;#34;, &amp;#34;Chromium&amp;#34;;v=&amp;#34;107&amp;#34;, &amp;#34;Not=A?Brand&amp;#34;;v=&amp;#34;24&amp;#34;&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;sec-ch-ua-mobile: ?0&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  -H &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;sec-ch-ua-platform: &amp;#34;macOS&amp;#34;&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  --data-raw &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;{&amp;#34;operationName&amp;#34;:&amp;#34;SendTokenGift&amp;#34;,&amp;#34;variables&amp;#34;:{&amp;#34;e&amp;#34;:&amp;#34;UJfUx05OooLVLeaLzurAD7t0ycf7qHV57YPA64hWOh5Nslk4cNv5GCO5UIhUfygGimZNaBMDaQF7CWigSoxuOG4KmX6PBg7Nw/BxK3lCQ/MeVM8H3VRD7RIv7A9H4Zt+z/43c25jpTuaQrjLpxrWXzNYORIKJRjga9ZUGPCbNwatxYFMuVGEJcn8SZxFdd2rr1HMsQV2HXhl1PcILcXZ5fcnu7+VARIIj26snB4TOiQ=&amp;#34;,&amp;#34;iv&amp;#34;:&amp;#34;yLelD2PBybOSK8LM&amp;#34;,&amp;#34;giftId&amp;#34;:114,&amp;#34;liveStreamId&amp;#34;:&amp;#34;sOuGkqrHrOs&amp;#34;,&amp;#34;count&amp;#34;:1,&amp;#34;comboKey&amp;#34;:&amp;#34;IZLFwC_9lDBi2YL6_1668754497884&amp;#34;,&amp;#34;giftToken&amp;#34;:&amp;#34;CkMQj7b0hwIaNIECAoICgwLHAgmLAowCjQIOENsBnAGfAt8B4AEhoQLhAakCKXFysgLyAfYBtwL3AfgB+QEgNCi36OokEIzc0szIMBqQARbIi9FshY8J3yb72Pi3Kf3b4VlRZ8dHHr2d64OWA545YQ6SBsTaqA6ERQ9DQbGDCXK3L5MoVtVL/wy4cLlD+XTMYIYjEYUU/0IwTbvhrTXWdll64SIP1APvRQXCjDugMBShDAqlMCBPqREhchX0t8tXHhYO2h+h6k3+kwe3yAdSioapP7i5NxtuLxCFTYPiVA==&amp;#34;},&amp;#34;query&amp;#34;:&amp;#34;mutation SendTokenGift($e: String, $iv: String, $giftId: Int, $liveStreamId: ID, $count: Int, $comboKey: String, $giftToken: String) {\n  sendTokenGift(e: $e, iv: $iv, giftId: $giftId, liveStreamId: $liveStreamId, count: $count, comboKey: $comboKey, giftToken: $giftToken) {\n    result\n    ksCoin\n    styleType\n    __typename\n  }\n}\n&amp;#34;}&amp;#39;&lt;/span&gt; &lt;span style=&#34;color:#a50&#34;&gt;\
&lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&lt;/span&gt;  --compressed -iv
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å“åº”&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;{
  &lt;span style=&#34;color:#1e90ff;font-weight:bold&#34;&gt;&amp;#34;data&amp;#34;&lt;/span&gt;: {
    &lt;span style=&#34;color:#1e90ff;font-weight:bold&#34;&gt;&amp;#34;sendTokenGift&amp;#34;&lt;/span&gt;: {
      &lt;span style=&#34;color:#1e90ff;font-weight:bold&#34;&gt;&amp;#34;result&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;,&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;//æˆåŠŸ&lt;/span&gt;
      &lt;span style=&#34;color:#1e90ff;font-weight:bold&#34;&gt;&amp;#34;ksCoin&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;,
      &lt;span style=&#34;color:#1e90ff;font-weight:bold&#34;&gt;&amp;#34;styleType&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#00a&#34;&gt;null&lt;/span&gt;,
      &lt;span style=&#34;color:#1e90ff;font-weight:bold&#34;&gt;&amp;#34;__typename&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;SendGiftResult&amp;#34;&lt;/span&gt;
    }
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å¿«æ‰‹ç»™ç«¯ä¸Šçš„æ¥å£ä½¿ç”¨çš„&lt;a href=&#34;https://spec.graphql.org/draft/&#34;&gt;graphql&lt;/a&gt;ç»Ÿä¸€ä¸­å¿ƒåŒ–äº†å…¥å£ï¼Œæ–¹ä¾¿åç»­è§„èŒƒåŒ–ç®¡ç†æ¥å£ï¼›æ•´ä½“äº¤äº’ä¹Ÿæœ‰äº›å·®åˆ«ï¼Œä¸€ä¸ªæ˜¯åç½®åˆ¤æ–­ï¼Œä¸€ä¸ªæ˜¯å‰ç½®åˆ¤æ–­ç¤¼ç‰©æ˜¯å¦å¯ä»¥èµ é€ï¼Œä½†æ˜¯å¯¹äºèµ é€ç¤¼ç‰©æ¥å£è¿˜æ˜¯éœ€è¦åˆ¤æ–­æ˜¯å¦æ»¡è¶³èµ é€çš„é‡‘é¢ï¼›å‰ç½®å¯¹äºç”¨æˆ·ä½“éªŒä¼šå¥½äº›ï¼Œå°‘äº†äº›äº¤äº’å§; æ¥å£æ•°æ®éƒ½æœ‰tokenåŠ å¯†éªŒè¯ï¼Œé˜²æ­¢ä¸‰æ–¹é»‘äº§ä¸­é€”æ‹¦æˆªï¼Œåè€…å¯¹æ•´ä½“èµ é€æ•°æ®ä¹Ÿæ˜¯å‹ç¼©åŠ å¯†äº†(ç”¨æˆ·è¡Œä¸ºæ‰“ç‚¹æ•°æ®ä¹Ÿæ˜¯å‹ç¼©ä¸ŠæŠ¥çš„)ï¼›&lt;/p&gt;
&lt;p&gt;Tips: è²Œä¼¼ç¤¼ç‰©çš„ä»·æ ¼åœ¨å„ä¸ªç›´æ’­å¹³å°éƒ½ä¸€æ ·çš„ï¼Œä¸åƒå•†å“ä»·æ ¼æœ‰ç›¸å¯¹æ³¢åŠ¨ï¼Œåªæ˜¯ä¼šæœ‰äº›ç›´æ’­åœºæ™¯å®šåˆ¶åŒ–çš„ç¤¼ç‰©ï¼Œæœ‰ç§éç†æ€§æƒ…æ„Ÿå†²åŠ¨æ¶ˆè´¹çš„æ„Ÿè§‰ï¼Œæç›´æ’­ç±»ç”¨æˆ·äº§å“ï¼Œå¿ƒç†å­¦è²Œä¼¼æŒºé‡è¦çš„ï¼Œè€é“å¸¦ä¸€æ³¢ 666ï½&lt;/p&gt;
&lt;h3 id=&#34;è®¾è®¡&#34;&gt;è®¾è®¡&lt;/h3&gt;
&lt;h4 id=&#34;æ•´ä½“è®¾è®¡æœåŠ¡æ¨¡å—æµç¨‹&#34;&gt;æ•´ä½“è®¾è®¡æœåŠ¡æ¨¡å—æµç¨‹&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/%E7%9B%B4%E6%92%AD%E4%BA%92%E5%8A%A8-%E8%B5%A0%E9%80%81%E7%A4%BC%E7%89%A9%E8%AE%BE%E8%AE%A1.drawio.png&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;db&#34;&gt;DB&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;gift ç¤¼ç‰©è¡¨&lt;/strong&gt;ï¼šæœ‰é™é›†ï¼Œè¿™ä¸ªç‰©æ–™æ•°ç›®æ˜¯å›ºå®šçš„ï¼Œæ²¡æœ‰SKUè¿™ä¸€æ¦‚å¿µï¼Œå¯ä»¥ç›´æ¥å®šä¹‰å¥½é…ç½®ä¹‹åï¼Œç›´æ¥å­˜æ”¾åœ¨æ•°æ®åº“ä¸­ï¼›ä¾¿äºåç»­ç¼“å­˜è‡³è¿œç«¯æˆ–è€…æœåŠ¡æœ¬åœ°ï¼›&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;giftId&lt;/td&gt;
&lt;td&gt;int64&lt;/td&gt;
&lt;td&gt;UK  å”¯ä¸€é”®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;name&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;ç¤¼ç‰©åç§°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;currencyCn&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;ä»·æ ¼ï¼šè™šæ‹Ÿè´§å¸æ•°ç›®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;unit&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;è™šæ‹Ÿè´§å¸åº¦é‡å•ä½ï¼Œå¯¹åº”èµ„äº§ç±»å‹ï¼šé‡‘å¸/é’»çŸ³/Xå¸&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;giftCategory&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;ç¤¼ç‰©ç±»åˆ«&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;iconUrl&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;ç¤¼ç‰©iconåœ°å€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;sendRule&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;èµ é€è§„åˆ™&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;effectsUrl&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;ç¤¼ç‰©ç‰¹æ•ˆåœ°å€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;createdAt&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;updatedAt&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;user_asset ç”¨æˆ·æ‹¥æœ‰çš„è™šæ‹Ÿèµ„äº§è¡¨&lt;/strong&gt;ï¼š  ç”¨æˆ·å½“å‰æ‹¥æœ‰çš„è™šæ‹Ÿå¸ä½™é¢&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;userId&lt;/td&gt;
&lt;td&gt;int64&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;assetCn&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;èµ„äº§æ•°é‡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;assetType&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;èµ„äº§ç±»å‹ 1. é‡‘å¸ 2.é’»çŸ³ 3. Xå¸ &lt;del&gt;4. Xä¼˜æƒ å·&lt;/del&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;version&lt;/td&gt;
&lt;td&gt;int64&lt;/td&gt;
&lt;td&gt;æ›´æ–°ç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;createdAt&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;updatedAt&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å¯¹äº&lt;strong&gt;å•ä¸ªç”¨æˆ·èµ„äº§ä¿®æ”¹&lt;/strong&gt;ï¼›å¦‚æœå­˜åœ¨ &lt;strong&gt;select èµ„äº§ï¼Œç„¶åæ ¹æ®ä¸åŒäº§å“ç­–ç•¥è¿›è¡Œä¸šåŠ¡é€»è¾‘è®¡ç®—å‡ºæ›´æ–°åèµ„äº§ï¼Œæœ€åupdate æ›´æ–°&lt;/strong&gt; åœºæ™¯ï¼Œåœ¨å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¸‰ç§æ–¹å¼ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æœåŠ¡ç›´æ¥é€šè¿‡åˆ†å¸ƒå¼é”æ¥å¤„ç†ï¼Œè¿™ç§æ–¹å¼ä¸èƒ½é˜²ä½å…¶ä»–å…¶ä»–æœåŠ¡æˆ–è€…è„šæœ¬ç›´æ¥æ“ä½œæ•°æ®åº“çš„æƒ…å†µï¼Œé™¤éåœ¨æ“ä½œä¹‹å‰ä¹Ÿå»è·å–ä¸€æ¬¡é”ï¼Œè€Œä¸”å¼•å…¥å¤–éƒ¨ä¾èµ–ï¼›å¯ä»¥è€ƒè™‘è‡ªä¸¾æ–¹å¼ï¼ŒæœåŠ¡èµ„æºå®ä¾‹è‡ªå·±æ¥ä¸Šé”ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ‚²è§‚é” select for updateäº‹åŠ¡å®ç°&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color:#00a&#34;&gt;SET&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;AUTOCOMMIT=&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;;&lt;span style=&#34;color:#bbb&#34;&gt; 
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;BEGIN&lt;/span&gt;&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;ï¼›&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;   &lt;/span&gt;a&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;=&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;SELECT&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;assetCn&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;FROM&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;user_asset&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;WHERE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;userId=&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;userId&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;and&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;assetType=&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;assetType&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;FOR&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;UPDATE&lt;/span&gt;;&lt;span style=&#34;color:#bbb&#34;&gt;  
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;   &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;update&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;user_asset&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;set&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;assetCn=a.assetCn+&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;incrCn&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;where&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;userId=&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;userId&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;and&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;assetType=&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;assetType&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;;&lt;span style=&#34;color:#bbb&#34;&gt; 
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;COMMIT&lt;/span&gt;;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;ä¹è§‚é” CASçš„æ–¹å¼ï¼Œæ²¡æœ‰æ›´æ–°ç»§ç»­å¾ªç¯ï¼Œç›´åˆ°æ›´æ–°ok&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;a&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;=&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;SELECT&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;assetCn&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;FROM&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;user_asset&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;WHERE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;userId=&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;userId&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;and&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;assetType=&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;assetType&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;#&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;$&lt;/span&gt;oldAssetCn&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;=&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;a.assetCn&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;#&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;$&lt;/span&gt;newAssetCn&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;=&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;a.assetCn+&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;$&lt;/span&gt;incrCn&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;#&lt;span style=&#34;color:#00a&#34;&gt;if&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;$&lt;/span&gt;newAssetCn&amp;gt;=&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;-&amp;gt;&lt;span style=&#34;color:#00a&#34;&gt;update&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;update&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;user_asset&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;set&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;assetCn=&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;newAssetCn&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;where&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;userId=&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;userId&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;and&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;assetType=&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;assetType&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;and&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;assetCn&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;=&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;oldAssetCn&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; 
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;å­˜åœ¨ABAé—®é¢˜ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;è€ƒè™‘å¦‚ä¸‹æ“ä½œï¼š&lt;/p&gt;
&lt;p&gt;å¹¶å‘1ï¼ˆä¸Šï¼‰ï¼šè·å–å‡ºæ•°æ®çš„åˆå§‹å€¼æ˜¯Aï¼Œåç»­è®¡åˆ’å®æ–½CASä¹è§‚é”ï¼ŒæœŸæœ›æ•°æ®ä»æ˜¯Açš„æ—¶å€™ï¼Œä¿®æ”¹æ‰èƒ½æˆåŠŸ&lt;/p&gt;
&lt;p&gt;å¹¶å‘2ï¼šå°†æ•°æ®ä¿®æ”¹æˆB&lt;/p&gt;
&lt;p&gt;å¹¶å‘3ï¼šå°†æ•°æ®ä¿®æ”¹å›A&lt;/p&gt;
&lt;p&gt;å¹¶å‘1ï¼ˆä¸‹ï¼‰ï¼šCASä¹è§‚é”ï¼Œæ£€æµ‹å‘ç°åˆå§‹å€¼è¿˜æ˜¯Aï¼Œè¿›è¡Œæ•°æ®ä¿®æ”¹&lt;/p&gt;
&lt;p&gt;å¹¶å‘1åœ¨ä¿®æ”¹æ•°æ®æ—¶ï¼Œè™½ç„¶è¿˜æ˜¯Aï¼Œä½†å·²ç»ä¸æ˜¯åˆå§‹æ¡ä»¶çš„Aäº†ï¼Œä¸­é—´å‘ç”Ÿäº†Aå˜Bï¼ŒBåˆå˜Açš„å˜åŒ–ï¼Œæ­¤Aå·²ç»éå½¼Aï¼Œæ•°æ®å´æˆåŠŸä¿®æ”¹ï¼Œå¯èƒ½å¯¼è‡´é”™è¯¯&lt;/p&gt;
&lt;p&gt;ABAé—®é¢˜å¯¼è‡´çš„åŸå› ï¼Œæ˜¯CASè¿‡ç¨‹ä¸­åªç®€å•è¿›è¡Œäº†â€œå€¼â€çš„æ ¡éªŒï¼Œå†æœ‰äº›æƒ…å†µä¸‹ï¼Œâ€œå€¼â€ç›¸åŒä¸ä¼šå¼•å…¥é”™è¯¯çš„ä¸šåŠ¡é€»è¾‘ï¼ˆä¾‹å¦‚åº“å­˜ï¼‰ï¼Œæœ‰äº›æƒ…å†µä¸‹ï¼Œâ€œå€¼â€è™½ç„¶ç›¸åŒï¼Œå´å·²ç»ä¸æ˜¯åŸæ¥çš„æ•°æ®äº†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;åŠ ä¸Šç‰ˆæœ¬å­—æ®µversion, å¯¹ç‰ˆæœ¬è¿›è¡ŒCASæ›´æ–°&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;a&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;=&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;SELECT&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;assetCn,&lt;span style=&#34;color:#00a&#34;&gt;version&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;FROM&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;user_asset&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;WHERE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;userId=&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;userId&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;and&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;assetType=&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;assetType&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;#&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;$&lt;/span&gt;oldAssetCn&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;=&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;a.assetCn&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;#&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;$&lt;/span&gt;oldVersion&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;=&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;a.&lt;span style=&#34;color:#00a&#34;&gt;version&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;#&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;$&lt;/span&gt;newAssetCn&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;=&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;a.assetCn+&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;$&lt;/span&gt;incrCn&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;#&lt;span style=&#34;color:#00a&#34;&gt;if&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;$&lt;/span&gt;newAssetCn&amp;gt;=&lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;-&amp;gt;&lt;span style=&#34;color:#00a&#34;&gt;update&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;#&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;$&lt;/span&gt;newVersion&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;=&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;$&lt;/span&gt;oldVersion+&lt;span style=&#34;color:#099&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;update&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;user_asset&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;set&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;assetCn=&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;newAssetCn&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;and&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;version&lt;/span&gt;=&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;newVersion&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;where&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;userId=&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;userId&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;and&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;assetType=&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;assetType&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;and&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;version&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;=&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;{$&lt;/span&gt;oldVersion&lt;span style=&#34;color:#f00;background-color:#faa&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; 
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æƒ³ä¸€æƒ³ï¼šmysqlä¸ºäº†é«˜å¯ç”¨å’Œè¯»å†™åˆ†ç¦»ï¼Œç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çš„å®ä¾‹é›†ç¾¤æ˜¯ä¸»ä»æ¶æ„ï¼Œå­˜åœ¨ä¸»ä»å»¶è¿Ÿï¼Œå…¶å®è¿™ä¸ªæ˜¯ä¸å½±å“çš„ï¼Œæœ€ç»ˆéƒ½æ˜¯CASçš„updateæ›´æ–°ï¼Œæ›´æ–°æˆåŠŸä¼šè¿”å›affect rowsä¸º1ï¼Œæ²¡æœ‰æ›´æ–°åˆ™ä¸º0ï¼›&lt;/p&gt;
&lt;p&gt;Notice:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;select for update åŠ æ’æ–¥é”å’Œæ‰€å»ºçš„ç´¢å¼•æœ‰å…³(é—´éš”(gap)é”ï¼Œä¸´é”®(next-key)é”ï¼Œé”è¡Œ/è¡¨)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨mongodbæ¥å­˜æ”¾ï¼Œç›´æ¥ä½¿ç”¨findAndModify incr æ¥æ“ä½œå³å¯ï¼Œå½“ç„¶é˜²æ­¢é‡å¤æ•°æ®ï¼Œéœ€è¦åŠ å”¯ä¸€ç´¢å¼•&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;user_asset_record ç”¨æˆ·è™šæ‹Ÿå¸äº¤æ˜“æµæ°´è¡¨&lt;/strong&gt;ï¼šè®°å½•è™šæ‹Ÿå¸å¢åŠ å’Œå‡å°‘æ•°æ®è¯¦æƒ…ï¼Œè¿™ä¸ªæä¾›åå°æŸ¥çœ‹ï¼Œç”¨äºé‡å¤è¯·æ±‚å¹‚ç­‰å¤„ç†ï¼Œ å»ºåº“å»ºè¡¨æŒ‰ç…§userIdè¿›è¡Œparttion åˆ†åº“åˆ†è¡¨ï¼›&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;recordId&lt;/td&gt;
&lt;td&gt;int64&lt;/td&gt;
&lt;td&gt;PK  ç”¨æˆ·èµ„äº§æµæ°´è®°å½•id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;userId&lt;/td&gt;
&lt;td&gt;int64&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;recUserId&lt;/td&gt;
&lt;td&gt;int64&lt;/td&gt;
&lt;td&gt;æ¥æ”¶è€…ç”¨æˆ·id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;roomId&lt;/td&gt;
&lt;td&gt;int64&lt;/td&gt;
&lt;td&gt;æˆ¿é—´id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;giftId&lt;/td&gt;
&lt;td&gt;int64&lt;/td&gt;
&lt;td&gt;ç¤¼ç‰©id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;eventId&lt;/td&gt;
&lt;td&gt;int64&lt;/td&gt;
&lt;td&gt;äº‹ä»¶Id: ç›´æ’­äº’åŠ¨åœºæ™¯ä¸‹ï¼Œäº’åŠ¨ID ç”¨äºè´¯å½»æ•´ä¸ªé€ç¤¼ç‰©æµæ°´é“¾è·¯,è¿›è¡Œå¹‚ç­‰å¤„ç†ï¼Œäº’åŠ¨ä¸­å°ç”Ÿæˆï¼› ç”¨æˆ·å……å€¼åœºæ™¯ä¸‹ï¼Œè®¢å•idï¼Œæ”¯ä»˜ä¸­å°ç”Ÿæˆï¼›&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;record&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;è®°å½•è¡Œä¸º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;recordOp&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;æ“ä½œè®°å½• è™šæ‹Ÿå¸å¢åŠ å’Œå‡å°‘&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;createdAt&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;updatedAt&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;èµ„æºè¯„ä¼°ï¼š&lt;/p&gt;
&lt;p&gt;åœ¨æ”¯ä»˜ä¸­å°ï¼ŒæŸä¸ªäº’åŠ¨æ¶‰åŠåˆ°å¤šä¸ªç”¨æˆ·èµ„äº§çš„å˜æ›´ï¼Œéœ€è¦æŠŠå¤šä¸ªå†™æ“ä½œå…³è”åˆ°ä¸€ä¸ªæœ¬åœ°äº‹åŠ¡è¿›è¡Œå¤„ç†ï¼Œä¿è¯æ•°æ®æ‰£å‡å’Œå¢å‡ä¸€è‡´ï¼Œéœ€è¦å¼€å¯æœ¬åœ°äº‹åŠ¡æ¥å¤„ç†å¤šè¡¨æ•°æ®ï¼›ä»¥ä¸‹gistä¸ºå¹¶å‘mysqlæœ¬åœ°äº‹åŠ¡å¤„ç†æµ‹è¯•demo&lt;/p&gt;
&lt;script type=&#34;application/javascript&#34; src=&#34;https://gist.github.com/weedge/1700dd7053a87a4ab35ba4fce0ebea6a.js&#34;&gt;&lt;/script&gt;

&lt;script type=&#34;application/javascript&#34; src=&#34;https://gist.github.com/weedge/fd731ce8549cd99ccfc9491f6025ae8e.js&#34;&gt;&lt;/script&gt;

&lt;h4 id=&#34;cache&#34;&gt;Cache&lt;/h4&gt;
&lt;p&gt;keyè®¾è®¡ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åç§°&lt;/th&gt;
&lt;th&gt;key&lt;/th&gt;
&lt;th&gt;value&lt;/th&gt;
&lt;th&gt;ex&lt;/th&gt;
&lt;th&gt;æ˜¯å¦é¢‘ç¹æ›´æ–°&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ç”¨æˆ·è™šæ‹Ÿèµ„äº§ä¿¡æ¯&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Y&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç¤¼ç‰©ä¿¡æ¯&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;N&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç”¨æˆ·ä¿¡æ¯&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;N&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç›´æ’­é—´ä¿¡æ¯&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;N&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;èµ„æºè¯„ä¼°ï¼š&lt;/p&gt;
&lt;p&gt;å¹¶å‘åœºæ™¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ç¼“å­˜ä»dbä¸­è·å–&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é¢‘ç¹å¢/å‡ç”¨æˆ·è™šæ‹Ÿèµ„äº§ç¼“å­˜å­˜é‡æ•°æ®&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;çƒ­key:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç”¨æˆ·ç»´åº¦çš„ç”¨æˆ·è™šæ‹Ÿèµ„äº§ä¿¡æ¯ï¼Œé€šè¿‡userIdè¿›è¡Œåˆ†æ•£å³å¯ï¼Œ å¦‚æœå¤šç”¨æˆ·/ç§Ÿæˆ· å¯¹ å…±äº«ç¼“å­˜èµ„æºé¢‘ç¹æ“ä½œ(æ¯”å¦‚ ä¼˜æƒ å·/å•†å·)ï¼Œçªç ´äº†å•rediså®ä¾‹çš„è¯»å†™ç“¶é¢ˆï¼Œéœ€è¦å¯¹keyè¿›è¡Œå†æ¬¡åˆ‡åˆ†ï¼›å¦‚æœæ˜¯è¯»å¤šåœºæ™¯ï¼Œæ›´æ–°ä¸é¢‘ç¹ç¼“å­˜å¯ä»¥ç¼“å­˜åœ¨æœ¬åœ°æœåŠ¡è¿›ç¨‹ä¸­ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¤§key:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å­˜æ”¾çš„valueå€¼æ¯”è¾ƒå¤§ï¼Œä¸€èˆ¬æ˜¯list, setï¼Œzset, hashè¿™äº›é›†åˆç»“æ„ï¼Œå­˜å‚¨çš„item/fieldæ•°ç›®ä¸€èˆ¬åœ¨5000ä¸ªå·¦å³ï¼Œéœ€è¦æŒ‰æ¯”ä¾‹åˆ‡åˆ†ï¼Œè¯»æ”¾å¤§çš„é—®é¢˜å¯ä»¥å¹¶å‘æ§åˆ¶è¯»å–ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;æ¶ˆæ¯é˜Ÿåˆ—&#34;&gt;æ¶ˆæ¯é˜Ÿåˆ—&lt;/h4&gt;
&lt;p&gt;topic&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;åç§°&lt;/th&gt;
&lt;th&gt;æ¶ˆæ¯ç±»å‹&lt;/th&gt;
&lt;th&gt;æ¶ˆæ¯key&lt;/th&gt;
&lt;th&gt;æ¶ˆæ¯tag&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;/table&gt;
&lt;h4 id=&#34;api&#34;&gt;API&lt;/h4&gt;
&lt;p&gt;å‰å°ç»Ÿä¸€å…¥å£æ¥å£å‚æ•°å®‰å…¨éªŒè¯&lt;/p&gt;
&lt;p&gt;äº’åŠ¨ä¸­å°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;èµ é€ç¤¼ç‰©æ¥å£&lt;/li&gt;
&lt;li&gt;è·å–ç›´æ’­é—´ç¤¼ç‰©åˆ—è¡¨æ¥å£&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ”¯ä»˜ä¸­å°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å˜æ›´ç”¨æˆ·è™šæ‹Ÿèµ„äº§æ¥å£&lt;/li&gt;
&lt;li&gt;è·å–ç”¨æˆ·è™šæ‹Ÿèµ„äº§æ¥å£&lt;/li&gt;
&lt;li&gt;è·å–ç”¨æˆ·èµ„äº§å˜æ›´æµæ°´æ¥å£&lt;/li&gt;
&lt;li&gt;æ›´æ–°æ•°æ®åº“ä¸­çš„ç”¨æˆ·èµ„äº§ æ¶ˆè´¹é€»è¾‘&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ¶ˆæ¯æœåŠ¡ï¼š &lt;a href=&#34;https://weedge.github.io/post/jxzbim/&#34;&gt;https://weedge.github.io/post/jxzbim/&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;å¼€å‘&#34;&gt;å¼€å‘&lt;/h3&gt;
&lt;p&gt;æŒ‰æœåŠ¡æ¨¡å—è¿›è¡Œå¹¶è¡Œå¼€å‘ï¼Œè”è°ƒï¼›ç»™å‡ºå¯¹åº”æ’æœŸ&lt;/p&gt;
&lt;h5 id=&#34;å¼€æºå¼€å‘æ¡†æ¶å’Œç»„ä»¶é€‰æ‹©&#34;&gt;å¼€æºå¼€å‘æ¡†æ¶å’Œç»„ä»¶é€‰æ‹©&lt;/h5&gt;
&lt;ol&gt;
&lt;li&gt;å¼€å‘è¯­è¨€ï¼šgolang + lua + shell&lt;/li&gt;
&lt;li&gt;å¼€å‘æ¡†æ¶ï¼šgin&lt;/li&gt;
&lt;li&gt;DBï¼šmysql, é«˜å¯ç”¨é›†ç¾¤æ–¹æ¡ˆï¼šä¸æ¨èè‡ªå»ºsharding+proxyçš„æ–¹å¼ï¼›æ¨èä½¿ç”¨æ”¯æŒmysqlåè®®çš„åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œä¸”æ— éœ€åœ¨ä¸šåŠ¡ä¸­è€ƒè™‘åˆ†åº“åˆ†è¡¨æ“ä½œï¼Œä»¥åŠåˆ†åº“åˆ†è¡¨çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼›æ¯”å¦‚ï¼šå¼€æºæ–¹æ¡ˆ &lt;a href=&#34;https://docs.pingcap.com/zh/&#34;&gt;tidb&lt;/a&gt;(shared nothing,scale out)ï¼Œäº‘å‚å•†ï¼š&lt;a href=&#34;https://polardbx.com/document&#34;&gt;polardb-x&lt;/a&gt; (shared nothing, scale out)/&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/AmazonRDS/latest/AuroraUserGuide/Aurora.AuroraMySQL.html&#34;&gt;aurora mysql&lt;/a&gt; (shared disk, scale up),   &lt;a href=&#34;https://gorm.io/&#34;&gt;gorm&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Cache:  redis, é«˜å¯ç”¨é›†ç¾¤æ–¹æ¡ˆ &lt;a href=&#34;https://redis.io/docs/management/scaling/&#34;&gt;redis-cluster&lt;/a&gt;   &lt;a href=&#34;https://redis.uptrace.dev/guide/&#34;&gt;go-redis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;MQ: rocketMQ, &lt;a href=&#34;https://github.com/apache/rocketmq-client-go&#34;&gt;rocketmq-client-go&lt;/a&gt;,  å¦‚æœä½¿ç”¨é˜¿é‡Œäº‘rocketMQä½¿ç”¨å¯¹åº”&lt;a href=&#34;https://github.com/apache/rocketmq-clients/tree/master/golang&#34;&gt;client SDK&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;æµ‹è¯•&#34;&gt;æµ‹è¯•&lt;/h3&gt;
&lt;p&gt;åŸºæœ¬åŠŸèƒ½é€»è¾‘æµ‹è¯•ï¼Œå¹¶å‘åœºæ™¯ä¸‹çš„æ‰£å‡å’Œæ–°å¢æ•°æ®ä¸€è‡´ï¼›ç„¶ååŠ ä¸Š ä¸šåŠ¡/åŸºç¡€æœåŠ¡/ä¸­é—´ä»¶æœåŠ¡ç›‘æ§ï¼Œæ—¥å¿—ï¼Œåœ¨å¼€å§‹å‹æµ‹ï¼Œç»™å‡ºæ€§èƒ½æŠ¥å‘Šï¼Œè°ƒä¼˜ï¼›æœ€ç»ˆç»™å‡ºæ¥å£/æ•´ä½“æœåŠ¡ååå’Œå»¶æ—¶ä¸Šé™ï¼Œé‡‡ç”¨æœåŠ¡æµæ§å¯¹æœåŠ¡æ¥å£åŠ ä¸Šæ¥å£/æœåŠ¡é™æµï¼Œä»¥åŠè¶…æ—¶é‡è¯•ï¼ŒæœåŠ¡ç›¸å…³é™çº§ç­–ç•¥ï¼›ç„¶åæ¨¡æ‹Ÿçº¿ä¸Šåœºæ™¯ç»§ç»­å‹æµ‹ï¼Œè§¦å‘å¯¹åº”æŠ¥è­¦å’Œé™æµï¼Œé™çº§ç­–ç•¥ï¼›&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¨¡å—æµ‹è¯•&lt;/li&gt;
&lt;li&gt;åŠ ä¸ŠæœåŠ¡ç›‘æ§ï¼Œæ—¥å¿—ï¼ŒæŠ¥è­¦ï¼Œé‡ç‚¹å…³æ³¨æ ¸å¿ƒé“¾è·¯æŒ‡æ ‡&lt;/li&gt;
&lt;li&gt;æ¥å£å‹æµ‹&lt;/li&gt;
&lt;li&gt;æ ¸å¿ƒå‰ç«¯æ¥å£æ•´ä½“å‹æµ‹&lt;/li&gt;
&lt;li&gt;è°ƒä¼˜ï¼šè€—æ—¶ï¼Œå†…å­˜ï¼Œcpuï¼ŒI/O(ç½‘ç»œï¼Œç£ç›˜)&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;é¢å¯¹å¤§é‡å¹¶å‘è¯·æ±‚çš„ç”¨æˆ·äº¤äº’åœºæ™¯ï¼Œæ•´ä½“æ€è·¯æ˜¯é¢„çƒ­å¿«é€Ÿè·¯å¾„å“åº”ç”¨æˆ·çš„äº¤äº’è¯·æ±‚è¡Œä¸ºï¼Œç„¶åå¼‚æ­¥é˜Ÿåˆ—è§£è€¦ï¼Œæ‰§è¡Œæ…¢è·¯å¾„ï¼Œå¿«/æ…¢è·¯å¾„ä¸Šé€šè¿‡å¹¶å‘æ‰¹é‡å¤„ç†æé«˜ååï¼Œå¿«è·¯å¾„å°½é‡ä½¿ç”¨ä¹è§‚é”ï¼Œå‡å°‘blockï¼›éœ€è¦è€ƒè™‘åˆ°æ•°æ®ä¸€è‡´ï¼Œèµ„äº§æ›´æ”¹å‡†ç¡®ï¼›æœ¬åœ°äº‹åŠ¡(å¤šè¡¨æ›´æ–°)ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡åœºæ™¯(å¤šæœåŠ¡å¯¹åº”è¡¨æ›´æ–°)ï¼›æœåŠ¡å¼‚å¸¸æ—¶çš„é™çº§æªæ–½ï¼Œä»¥åŠæœåŠ¡è¿‡è½½æ—¶çš„é™æµï¼Œä»¥åŠæ¶ˆæ¯æ•°æ®æµçš„åå‹æªæ–½ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s/Cmw3QExqCfBAz9V0AlsS9A&#34;&gt;https://mp.weixin.qq.com/s/Cmw3QExqCfBAz9V0AlsS9A&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://aws.amazon.com/cn/builders-library/timeouts-retries-and-backoff-with-jitter/&#34;&gt;https://aws.amazon.com/cn/builders-library/timeouts-retries-and-backoff-with-jitter/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s/jznfR9Jc-U-uCXioHXjeew&#34;&gt;https://mp.weixin.qq.com/s/jznfR9Jc-U-uCXioHXjeew&lt;/a&gt; , &lt;a href=&#34;https://mp.weixin.qq.com/s/AV4E0Y9d4k5VYTL7n2TNug&#34;&gt;https://mp.weixin.qq.com/s/AV4E0Y9d4k5VYTL7n2TNug&lt;/a&gt; , &lt;a href=&#34;https://mp.weixin.qq.com/s/cT9b2GDsUinVNoA6gyqs_g&#34;&gt;https://mp.weixin.qq.com/s/cT9b2GDsUinVNoA6gyqs_g&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www.52im.net/thread-3515-1-1.html#26&#34;&gt;http://www.52im.net/thread-3515-1-1.html#26&lt;/a&gt; , &lt;a href=&#34;http://www.52im.net/thread-3994-1-1.html&#34;&gt;http://www.52im.net/thread-3994-1-1.html&lt;/a&gt; , &lt;a href=&#34;http://www.52im.net/thread-3376-1-1.html&#34;&gt;http://www.52im.net/thread-3376-1-1.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://coolshell.cn/articles/8239.html&#34;&gt;https://coolshell.cn/articles/8239.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://redis.com/blog/redis-clustering-best-practices-with-keys/&#34;&gt;https://redis.com/blog/redis-clustering-best-practices-with-keys/&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
      
    </item>
    
    <item>
      <title>è®©MLè·‘èµ·æ¥</title>
      <link>https://weedge.github.io/post/let-ml-go/</link>
      <pubDate>Tue, 08 Nov 2022 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/let-ml-go/</guid>
      
        <description>&lt;h3 id=&#34;ä»‹ç»&#34;&gt;ä»‹ç»&lt;/h3&gt;
&lt;p&gt;ä¸Šæ–‡æåˆ°é€šè¿‡ç”¨æˆ·çš„è¡Œä¸ºæ•°æ®å­˜æ”¾åœ¨S3ä¸­ï¼Œè¿™äº›æ•°æ®åŒ…æ‹¬ç»“æ„åŒ–å’Œéç»“æ„åŒ–æ•°æ®ï¼Œæ€ä¹ˆè®©è¿™äº›æ•°æ®å˜å¾—æœ‰ä»·å€¼å‘¢ï¼Ÿä¸€ç§æ˜¯äººä¸ºè¿›è¡Œæ•°æ®æŒ–æ˜ï¼Œå¯¹ç›¸å…³æŒ‡æ ‡è½¬åŒ–ç‡è¿›è¡Œè¯„ä¼°ï¼›è¿˜æœ‰ä¸€ç§æ˜¯é€šè¿‡è¿™äº›æ•°æ®æ¥è®­ç»ƒæ¨¡å‹ï¼Œç„¶åå°†é¢„æµ‹æ¨¡å‹ç”¨äºç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡ŒA/Bæµ‹è¯•ï¼Œé€‰å‡ºé€‚åˆçš„æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹éœ€è¦ä¸æ–­æ›´æ–°è¿­ä»£ï¼Œå¹¶ä¸”è‡ªåŠ¨åŒ–åŠè‡ªåŠ¨åŒ–è¿è¡Œèµ·æ¥ï¼›&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/images/ml-concepts-10.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ•°æ®å‡†å¤‡&#34;&gt;æ•°æ®å‡†å¤‡&lt;/h3&gt;
&lt;h4 id=&#34;ç‰¹å¾å·¥ç¨‹&#34;&gt;ç‰¹å¾å·¥ç¨‹&lt;/h4&gt;
&lt;h3 id=&#34;æ¨¡å‹è®­ç»ƒ&#34;&gt;æ¨¡å‹è®­ç»ƒ&lt;/h3&gt;
&lt;p&gt;ç›¸å…³åº“ï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://xgboost.ai/&#34;&gt;XGBoost&lt;/a&gt;,  &lt;a href=&#34;https://en.wikipedia.org/wiki/Gradient_boosting&#34;&gt;Gradient Boosting&lt;/a&gt;æ¡†æ¶ä¸‹å®ç°æœºå™¨å­¦ä¹ ç®—æ³•ã€‚XGBoost æä¾›äº†ä¸€ç§å¹¶è¡Œæ ‘æå‡ï¼ˆä¹Ÿç§°ä¸º &lt;a href=&#34;https://developers.google.com/machine-learning/decision-forests/intro-to-gbdt&#34;&gt;GBDT&lt;/a&gt;ã€GBMï¼‰ï¼Œå¯ä»¥å¿«é€Ÿå‡†ç¡®åœ°è§£å†³è®¸å¤šæ•°æ®ç§‘å­¦é—®é¢˜ã€‚æ”¯æŒåœ¨å¤šå°æœºå™¨ä¸Šè¿›è¡Œåˆ†å¸ƒå¼è®­ç»ƒï¼ŒåŒ…æ‹¬ AWSã€GCEã€Azure å’Œ Yarn é›†ç¾¤ï¼›å¯ä¸ Flinkã€Spark ç­‰äº‘æ•°æ®æµç³»ç»Ÿé›†æˆã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚æœè¯´æŠŠæœºå™¨å­¦ä¹ é—®é¢˜åˆ†æˆï¼Œå¸¸è§„æœºå™¨å­¦ä¹ ï¼ˆconventional machine learningï¼‰å’Œæ·±åº¦å­¦ä¹ ï¼ˆdeep learningï¼‰çš„è¯ï¼Œé‚£ä¹ˆXGBoostå°±æ˜¯åœ¨å¸¸è§„MLç«èµ›è·å¥–æœ€å¤šçš„ç®—æ³•ã€‚&lt;a href=&#34;https://github.com/dmlc/xgboost&#34;&gt;XGBoost&lt;/a&gt; çš„å…¨ç§°æ˜¯ Extreme Gradient Boostingï¼Œæ˜¯gradient boostingçš„ä¸€ç§å¼€æºå®ç°ã€‚gradient boosting æŠŠè‹¥å¹²å¼±æ¨¡å‹é€šè¿‡å†³ç­–æ ‘çš„æ–¹å¼èšåˆï¼ˆensembleï¼‰åœ¨ä¸€èµ·ï¼Œ å½¢æˆä¸€ä¸ªæœ€ç»ˆçš„æ¨¡å‹ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸€ä¸ªæŒç»­çš„ã€ä¸æ–­è¿­ä»£ä¼˜åŒ–è¿‡ç¨‹ï¼Œæ¯æ¬¡è¿­ä»£ä¼˜åŒ–çš„æ–¹å‘é€šè¿‡è®¡ç®—loss functionçš„æ¢¯åº¦æ¥å®ç°ï¼Œç„¶åé‡‡å–æ¢¯åº¦ä¸‹é™çš„æ–¹å¼ä¸æ–­çš„é™ä½loss functionï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªæœ€ç»ˆçš„æ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;XGBoostæœ€å¸¸ç”¨æ¥è§£å†³å¸¸è§„MLä¸­çš„åˆ†ç±»ï¼ˆregressionï¼‰å’Œå›å½’ï¼ˆclassificationï¼‰é—®é¢˜ã€‚å›å½’é—®é¢˜ï¼Œä¸¾ä¾‹æ¥è¯´ï¼šæ ¹æ®ä¸€ä¸ªäººçš„å¹´é¾„ã€èŒä¸šã€å±…ä½ç¯å¢ƒç­‰ä¸ªäººä¿¡æ¯æ¨ç®—å‡ºè¿™ä¸ªäººçš„æ”¶å…¥ï¼Œè¿™ç§æ¨ç†çš„ç»“æœæ˜¯ä¸€ä¸ªè¿ç»­çš„å€¼ï¼ˆæ”¶å…¥ï¼‰çš„æƒ…å†µå°±æ˜¯ä¸€ä¸ªå›å½’é—®é¢˜ï¼›åˆ†ç±»é—®é¢˜ï¼Œæ¯”å¦‚åœ¨æ¬ºè¯ˆæ£€æµ‹ä¸­ï¼Œæ ¹æ®æœ‰å…³äº¤æ˜“çš„ä¿¡æ¯ï¼Œæ¥åˆ¤æ–­äº¤æ˜“æ˜¯ä¸æ˜¯æ¬ºè¯ˆï¼Œè¿™é‡Œçš„åˆ¤æ–­æ˜¯æˆ–è€…å¦å°±æ˜¯ä¸€ä¸ªäºŒåˆ†ç±»é—®é¢˜ã€‚é€šå¸¸è¿™ä¸¤ç±»é—®é¢˜éƒ½æ˜¯ç»™å‡ºä¸€ä¸ªè¡¨æ ¼ç±»å‹æ•°æ®ï¼Œè¡¨æ ¼ä¸­çš„æ¯åˆ—æ•°æ®éƒ½æ˜¯è·Ÿæ¨ç†çš„ç›®æ ‡ï¼ˆå±äºæŸä¸ªåˆ†ç±»æˆ–è€…æ¨ç†å€¼ï¼‰æœ‰ç€æ½œåœ¨å…³ç³»çš„æ•°æ®ï¼ŒXGBoostç‰¹åˆ«æ“…é•¿å¤„ç†è¿™ç±»çš„è¡¨æ ¼æ•°æ®ï¼ˆtabular dataï¼‰ï¼Œå¹¶æ®æ­¤ä½œå‡ºæ¨æ–­ã€‚å¯¹äºè¡¨æ ¼æ•°æ®ï¼Œæ— éç”±è¡Œã€åˆ—æ¥ç»„æˆï¼Œåœ¨MLä¸­å¯¹äºè¡¨æ ¼æ•°æ®ä¸­çš„è¡Œå’Œåˆ—ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šçº¦å®šä¿—ç§°çš„ç§°è°“ï¼Œåœ¨å„ç§å…³äºMLçš„æ–‡ç« ä¸­è¿™äº›ç§°è°“ä¼šç»å¸¸å‡ºç°ï¼Œä¸ºäº†ä¾¿äºå¤§å®¶ç†è§£ï¼Œåœ¨è¿™é‡Œå¯¹è¿™äº›å«æ³•åšä¸€ä¸ªæ¢³ç†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¡Œï¼ˆrowï¼‰ï¼Œå«åšä¸€ä¸ªè§‚å¯Ÿï¼ˆobservationï¼‰ï¼Œæˆ–è€…ä¸€ä¸ªæ ·æœ¬ï¼ˆsampleï¼‰&lt;/li&gt;
&lt;li&gt;åˆ—ï¼ˆcolumnï¼‰ ï¼Œä¹Ÿå«å­—æ®µï¼ˆfieldï¼‰ï¼Œå±æ€§ï¼ˆattributeï¼‰ï¼Œæˆ–è€…ç‰¹å¾ï¼ˆfeatureï¼‰&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://keras.io/zh/&#34;&gt;keras&lt;/a&gt;: æ·±åº¦å­¦ä¹ æ¨¡å‹åº“ï¼Œé«˜çº§ç¥ç»ç½‘ç»œ,åŒæ—¶æ”¯æŒå·ç§¯ç¥ç»ç½‘ç»œå’Œå¾ªç¯ç¥ç»ç½‘ç»œï¼Œä»¥åŠä¸¤è€…çš„ç»„åˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ¨¡å‹è¯„ä¼°&#34;&gt;æ¨¡å‹è¯„ä¼°&lt;/h3&gt;
&lt;h3 id=&#34;æ¨¡å‹éƒ¨ç½²&#34;&gt;æ¨¡å‹éƒ¨ç½²&lt;/h3&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨&lt;a href=&#34;https://www.tensorflow.org/&#34;&gt;TF&lt;/a&gt;(tensorflow)æ¡†æ¶, ä½¿ç”¨TF &lt;a href=&#34;https://github.com/tensorflow/serving&#34;&gt;serving&lt;/a&gt;æ¥æ”¯æŒåŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡ŒA/Bæµ‹è¯•ï¼›&lt;/p&gt;
&lt;p&gt;æ“ä½œdemoå‚è€ƒï¼šhttps://www.tensorflow.org/tfx/tutorials/serving/rest_simple&lt;/p&gt;
&lt;h3 id=&#34;ç”¨äºç”Ÿäº§ç¯å¢ƒéœ€è¦è€ƒè™‘çš„é—®é¢˜&#34;&gt;ç”¨äºç”Ÿäº§ç¯å¢ƒéœ€è¦è€ƒè™‘çš„é—®é¢˜&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è®­ç»ƒæ¨¡å‹çš„æ•°æ®æ¥æºï¼Œä»¥åŠé‡‡é›†å­˜æ”¾(æ ¼å¼å’Œå‹ç¼©)ï¼›è¿™äº›æ•°æ®æ ¹æ®ä½¿ç”¨åœºæ™¯è€Œå®šï¼Œæ¯”å¦‚demoä¸­çš„ç”µå•†åœºæ™¯ï¼Œè¯†åˆ«ç‰©å“ï¼Œéœ€è¦å¤§é‡çš„éç»“æ„åŒ–å›¾ç‰‡æ•°æ®ï¼Œè¿™äº›ç”¨æˆ·ä¸Šä¼ çš„åŸå§‹å›¾ç‰‡å’ŒåŠ å·¥åçš„å›¾ç‰‡å­˜æ”¾äºå¯¹è±¡å­˜å‚¨ä¸­æ¯”å¦‚S3ï¼ŒOSSï¼ŒCOSï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç‰¹å¾æ•°æ®æ¸…æ´—è¿‡æ»¤å­˜æ”¾ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ•°æ®å¦‚ä½•å¿«é€Ÿè®­ç»ƒï¼›æ•°æ®é‡ä¸€èˆ¬å¾ˆå¤§ï¼ŒPBçº§åˆ«ï¼Œå•æœºè‚¯å®šæ˜¯åŠ è½½ä¸äº†è¿™ä¹ˆå¤šæ•°æ®è®­ç»ƒï¼Œå³ä½¿åˆ†å‰²æˆå¤šä¸ªå°æ–‡ä»¶ï¼Œå•æœºå¤„ç†éœ€è¦å¤§é‡ä¸­é—´ç»“æœå­˜æ”¾ï¼Œå¤„ç†æ•ˆç‡éå¸¸ä½ï¼›æ‰€ä»¥æ¨¡å‹è®­ç»ƒéœ€è¦è€ƒè™‘é›†ç¾¤æ¨¡å¼ï¼Œè¿›è¡Œ&lt;a href=&#34;https://openmlsys.github.io/chapter_distributed_training/index.html&#34;&gt;åˆ†å¸ƒå¼è®­ç»ƒæ¨¡å‹&lt;/a&gt;ï¼Œéœ€è¦ä¸€ä¸ªè®­ç»ƒå¹³å°æ¥æ”¯æŒï¼Œå……åˆ†è°ƒåº¦è®¡ç®—èµ„æº(CPU,GPU,TPU,FPGA)ï¼Œå¹¶è¡Œè®¡ç®—ï¼Œå¹¶ä¸”æ ¹æ®æ•°æ®é‡è¿›è¡Œå¯ä¼¸ç¼©æ‰©å±•ï¼Œä¿è¯è®­ç»ƒä¸­é€”ä¸­æ–­çš„å¯ç”¨æ€§(failover,checkpoint)ï¼›&lt;/p&gt;
&lt;p&gt;å¼€æºæ¡†æ¶ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;uber &lt;a href=&#34;https://github.com/horovod/horovod&#34;&gt;https://github.com/horovod/horovod&lt;/a&gt;  &lt;a href=&#34;https://arxiv.org/pdf/1802.05799.pdf&#34;&gt;Horovod: fast and easy distributed deep learning in TensorFlow&lt;/a&gt; å¤§éƒ¨åˆ†äº‘å¹³å°åŸºäºhorovodåšäº†å®šåˆ¶åŒ–çš„æ”¹é€ &lt;/li&gt;
&lt;li&gt;Bytedance: &lt;a href=&#34;https://github.com/bytedance/byteps&#34;&gt;https://github.com/bytedance/byteps&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°†è®­ç»ƒå¥½çš„æ¨¡å‹å¯¼å‡ºåºåˆ—åŒ–pbæ ¼å¼ï¼Œå­˜æ”¾åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­(&lt;a href=&#34;https://www.tensorflow.org/guide/saved_model#save_and_restore_models&#34;&gt;SavedModel&lt;/a&gt;)ï¼›ç„¶åTF servingå¯åŠ¨æœåŠ¡åŠ è½½æ¨¡å‹ï¼Œå¯¹å¤–ä»¥ HTTP &lt;a href=&#34;https://github.com/tensorflow/serving/blob/master/tensorflow_serving/g3doc/api_rest.md&#34;&gt;REST API&lt;/a&gt;æˆ– &lt;a href=&#34;https://github.com/tensorflow/serving/tree/master/tensorflow_serving/apis&#34;&gt;gRPC API&lt;/a&gt;çš„æ–¹å¼æä¾›æ¨¡å‹æœåŠ¡ï¼›æ­£å¼ç”¨äºçº¿ä¸Šï¼Œéœ€è¦è€ƒè™‘æœåŠ¡æ€§èƒ½é—®é¢˜(é«˜å¹¶å‘åœºæ™¯ï¼Œå»¶è¿Ÿå’Œååé‡ï¼Œæ¨¡å‹&lt;a href=&#34;https://github.com/tensorflow/serving/blob/master/tensorflow_serving/g3doc/saved_model_warmup.md&#34;&gt;é¢„çƒ­&lt;/a&gt;(warmup)ï¼Œ&lt;a href=&#34;https://github.com/tensorflow/serving/blob/master/tensorflow_serving/batching/README.md&#34;&gt;æ‰¹å¤„ç†&lt;/a&gt;(batching)ç­‰&lt;a href=&#34;https://github.com/tensorflow/serving/blob/master/tensorflow_serving/g3doc/performance.md&#34;&gt;æ€§èƒ½&lt;/a&gt;ä¼˜åŒ–ç‚¹)ï¼Œç”Ÿäº§ç¯å¢ƒæ¨¡å‹æ›´æ–°(æ„å»ºï¼Œæ— æŸæœåŠ¡åˆ‡æ¢ï¼Œæµé‡A/Bæµ‹è¯•)ï¼Œå®¹å™¨åŒ–éƒ¨ç½²(&lt;a href=&#34;https://github.com/tensorflow/serving/blob/master/tensorflow_serving/g3doc/serving_kubernetes.md&#34;&gt;serving on K8S&lt;/a&gt;)(æ‰©ç¼©å®¹ï¼Œæµæ§ï¼Œå®¹é”™ç­‰é«˜å¯ç”¨è®¾è®¡)ï¼ŒæœåŠ¡ç›‘æ§ç­‰å·¥ç¨‹ä¸Šçš„é—®é¢˜ï¼›æœ¬åœ°demoå¯å‚è€ƒ: &lt;a href=&#34;https://github.com/tensorflow/serving/blob/master/tensorflow_serving/g3doc/serving_basic.md&#34;&gt;Serving a TensorFlow Model&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›‘æ§æ¨¡å‹æ•°æ®ï¼Œå¦‚ä½•å¯¹å…¶è¿›è¡Œè¯„ä¼°ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¨¡å‹è¿­ä»£æ›´æ–°é€Ÿåº¦å¿«ï¼Œéœ€è¦å¼•å…¥CI/CD pipelines æ¥è‡ªåŠ¨åŒ–æ”¯æŒæ¨¡å‹é—­ç¯è¿­ä»£ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è®¡ç®—èµ„æºæœºå™¨æˆæœ¬é¢„ä¼°ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;å¼€æºæ–¹æ¡ˆ&#34;&gt;å¼€æºæ–¹æ¡ˆ&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://www.kubeflow.org/docs/started/introduction/&#34;&gt;Kubeflow&lt;/a&gt; åœ¨ Kubernetes ä¸Šéƒ¨ç½²æœºå™¨å­¦ä¹  (ML) å·¥ä½œæµå˜å¾—ç®€å•ã€å¯ç§»æ¤å’Œå¯æ‰©å±•ã€‚æä¾›ä¸€ç§ç›´æ¥çš„æ–¹å¼æ¥å°†ç”¨äº ML çš„åŒç±»æœ€ä½³å¼€æºç³»ç»Ÿéƒ¨ç½²åˆ°ä¸åŒçš„åŸºç¡€è®¾æ–½ï¼›åœ¨ä»»ä½•è¿è¡Œ Kubernetes çš„åœ°æ–¹ï¼Œéƒ½åº”è¯¥èƒ½å¤Ÿè¿è¡Œ Kubeflowã€‚&lt;/p&gt;
&lt;h3 id=&#34;tfx-with-kubeflow-on-gke&#34;&gt;TFX with kubeflow on GKE&lt;/h3&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/tensorflow/tfx&#34;&gt;https://github.com/tensorflow/tfx&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ–‡æ¡£ï¼š&lt;a href=&#34;https://www.tensorflow.org/tfx/tutorials&#34;&gt;TFX tutorials&lt;/a&gt;&lt;/p&gt;

&lt;div style=&#34;position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;&#34;&gt;
  &lt;iframe src=&#34;https://www.youtube.com/embed/17l3VR2MIeg&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;&#34; allowfullscreen title=&#34;YouTube Video&#34;&gt;&lt;/iframe&gt;
&lt;/div&gt;

&lt;h3 id=&#34;ml-on--amazon-sagemakerhttpsawsamazoncomsagemaker&#34;&gt;ML on  &lt;a href=&#34;https://aws.amazon.com/sagemaker/&#34;&gt;Amazon SageMaker&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;åˆ†å¸ƒå¼è®­ç»ƒï¼š &lt;a href=&#34;https://aws.amazon.com/cn/sagemaker/distributed-training/&#34;&gt;https://aws.amazon.com/cn/sagemaker/distributed-training/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ–‡æ¡£ï¼š&lt;a href=&#34;https://sagemaker-examples.readthedocs.io/en/latest/index.html&#34;&gt;Amazon SageMaker Example Notebooks&lt;/a&gt;ï¼Œ &lt;a href=&#34;https://sagemaker-workshop.com/&#34;&gt;Amazon SageMaker Workshop&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;SageMakeræ¡†æ¶ç›´æ¥é›†æˆäº†å¤šç§æœºå™¨å­¦ä¹ æ¡†æ¶ï¼Œä¸€æ¡é¾™æœåŠ¡ï¼Œä¹Ÿå¯ä»¥é›†æˆKubeflowæ–¹æ¡ˆï¼›æœºå™¨å­¦ä¹ æ•´ä½“ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬è®­ç»ƒæ•°æ®å‡†å¤‡ï¼Œæ¨¡å‹è®­ç»ƒï¼Œæ¨¡å‹è¯„ä¼°ï¼Œè¯„ä¼°okä¹‹åéƒ¨ç½²ä¸Šçº¿æä¾›åœ¨çº¿é¢„æµ‹æ¨ç†æœåŠ¡ï¼Œé€šè¿‡ç›‘æ§æœé›†æ•°æ®ï¼Œé‡å¤è¿­ä»£æ¨¡å‹ï¼›æ•´ä½“ç”Ÿå‘½å‘¨æœŸå¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://s3.cn-north-1.amazonaws.com.cn/awschinablog/use-xgboost-in-amazon-sagemaker-for-commercial-empowerment1.jpg&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;p&gt;å°†æ•°æ®å¤„ç†å‡†å¤‡åˆ°æ¨¡å‹ä¸Šçº¿æ•´ä¸ªè¿‡ç¨‹å¯ä»¥è‡ªåŠ¨åŒ–ï¼Œé€šè¿‡sageMakerå¹³å°ç›´æ¥ç»„åˆæˆå·¥ä½œæµpipelineè¿›è¡Œè‡ªåŠ¨åŒ–å¤„ç†ï¼Œdemoè¯·å‚è€ƒï¼š&lt;a href=&#34;https://aws.amazon.com/cn/getting-started/hands-on/machine-learning-tutorial-mlops-automate-ml-workflows/&#34;&gt;è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ å·¥ä½œæµ sagemaker tutorial&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://d1.awsstatic.com/sagemaker-tutorial-5-1-step-3-1-pipeline-diagram.90a11a1a83636b6d56c8ce8d43829571b506ae11.png&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;p&gt;Tips: è¿™é‡Œåªæ˜¯æ•´ä½“æ¦‚æ‹¬ä¸‹æœºå™¨å­¦ä¹ å·¥ç¨‹åŒ–çš„è¿‡ç¨‹ï¼›æœºå™¨å­¦ä¹ ä»¥åŠæ·±åº¦å­¦ä¹ ç›¸å…³çš„ç®—æ³•çŸ¥è¯†å¾…æ·±å…¥è¾¹åŠ¨æ‰‹è¾¹å­¦ä¹ ï¼›å¾…ç»­ï½ :)&lt;/p&gt;
&lt;h3 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://developers.google.com/machine-learning&#34;&gt;google-developers-ml&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.tensorflow.org/tfx/&#34;&gt;TFX&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://xgboost.readthedocs.io/en/latest/index.html&#34;&gt;XGBoostæ–‡æ¡£&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.tensorflow.org/tfx/guide/serving&#34;&gt;TF Serving&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://time.geekbang.org/column/article/303430&#34;&gt;æ·±åº¦å­¦ä¹ æ¨èç³»ç»Ÿå®æˆ˜&lt;/a&gt; &lt;a href=&#34;https://github.com/wzhe06/SparrowRecSys&#34;&gt;SparrowRecSys&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://zh.d2l.ai/index.html&#34;&gt;åŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.mikulskibartosz.name/how-to-ab-test-tensorflow-models-using-sagemaker-endpoints/&#34;&gt;How to A/B test Tensorflow models using Sagemaker Endpoints&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://aws.amazon.com/cn/blogs/china/use-xgboost-in-amazon-sagemaker-for-commercial-empowerment/&#34;&gt;åœ¨ Amazon SageMaker ä¸­ä½¿ç”¨ XGBoost æ¥å®ç°å•†ä¸šèµ‹èƒ½&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://aws.amazon.com/cn/getting-started/hands-on/machine-learning-tutorial-mlops-automate-ml-workflows/&#34;&gt;è‡ªåŠ¨åŒ–æœºå™¨å­¦ä¹ å·¥ä½œæµ sagemaker tutorial&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/79030485&#34;&gt;AllReduceç®—æ³•çš„å‰ä¸–ä»Šç”Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
      
    </item>
    
    <item>
      <title>ç”¨æˆ·è¡Œä¸ºåˆ†ææ–¹æ¡ˆè®¾è®¡</title>
      <link>https://weedge.github.io/post/user-behavior-analytics-solution/</link>
      <pubDate>Wed, 02 Nov 2022 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/user-behavior-analytics-solution/</guid>
      
        <description>&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;ç”¨æˆ·åœ¨æ‰‹æœºå’Œpcç«¯ä½¿ç”¨å®¢æˆ·ä¸šåŠ¡äº§å“ï¼Œæ¯”å¦‚æµè§ˆç½‘é¡µï¼Œè´­ä¹°å•†å“ï¼ŒæŸ¥çœ‹æ–‡æ¡£ï¼Œè§‚çœ‹è§†é¢‘ï¼Œç›´æ’­ï¼ŒIOTåœºæ™¯ï¼›ä¼šäº§ç”Ÿå¤§é‡çš„ç”¨æˆ·è¡Œä¸ºæ•°æ®ï¼Œä¸»è¦åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;éç»“æ„åŒ–æ•°æ®ï¼šæ—¥å¿—(å‰ç«¯äº‹ä»¶åŸ‹ç‚¹æ—¥å¿—ï¼ŒæœåŠ¡ç«¯å¤„ç†äº‹ä»¶æ—¥å¿—)ï¼Œè¿˜æœ‰äº›éç»“æ„åŒ–çš„å›¾ç‰‡ï¼ŒéŸ³è§†é¢‘æ•°æ®ç­‰ç­‰ï¼Œä¸»è¦å­˜æ”¾åœ¨æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿä¸­ï¼›&lt;/li&gt;
&lt;li&gt;ç»“æ„åŒ–å’ŒåŠç»“æ„åŒ–æ•°æ®ï¼š ç”¨æˆ·æ“ä½œäº§å“å†™å…¥çš„ç»“æ„åŒ–æ•°æ®å­˜æ”¾äºæ•°æ®åº“è¡¨ä¸­ï¼Œå°†æ–‡æ¡£å‹åŠç»“æ„åŒ–çš„æ•°æ®æ”¾å…¥æ–‡æ¡£æ•°æ®åº“ä¸­ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;éœ€è¦åˆ†æç”¨æˆ·çš„è¡Œä¸ºæ•°æ®ï¼Œè¿›è¡Œå†³ç­–ï¼›åˆ†ä¸ºå®æ—¶æµå¼å¤„ç†å’Œç¦»çº¿æ‰¹å¤„ç†ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®æ—¶æµå¤„ç†ï¼Œä¸»è¦ç”¨äºå®æ—¶å±•ç°å®¢æˆ·ç«¯çœ‹æ¿ï¼Œåå°BIå®æ—¶åˆ†æï¼Œå®æ—¶é£æ§/æ¨èï¼Œå¼‚å¸¸æŠ¥è­¦ç­‰åœºæ™¯ï¼›&lt;/li&gt;
&lt;li&gt;ç¦»çº¿æ‰¹å¤„ç†ï¼Œåˆ†æç”¨æˆ·å†å²æ•°æ®ï¼Œè¿›è¡Œæ¨èç®—æ³•ç­‰æœºå™¨å­¦ä¹ ç®—æ³•æ¨¡å‹è®­ç»ƒä½¿ç”¨ï¼Œæ•°æ®ä»“åº“ä¸­æ ¹æ®ä¸åŒç»´åº¦å¯¹æ•°æ®è¿‡æ»¤èšåˆï¼Œè¿›è¡Œä¸Šå·ä¸‹é’»åˆ†æï¼Œæ¯”å¦‚è®¡ç®—DAU,WAU,MAUï¼Œè½¬åŒ–ç‡(è´­ä¹°ç‡ï¼Œæ³¨å†Œç‡)åˆ†æç­‰ï¼Œé€šå¸¸å¯¹æ•°æ®å»ºè®¾æŠ•å…¥å¤šçš„è¯ï¼Œ ä¼šæŠŠç”¨æˆ·äº§ç”Ÿçš„ç»“æ„åŒ–éç»“æ„åŒ–çš„æ•°æ®éƒ½å­˜ä¸‹ï¼Œæ”¾åœ¨ä¸€ä¸ªå¤§çš„æ± å­é‡Œå¾…ä½¿ç”¨æ—¶è¿›è¡Œåˆ†æï¼Œå³æ‰€è°“çš„æ•°æ®æ¹–ï¼Œå›´æ¹–è€Œå»ºæŒ–æ˜æ•°æ®ä»·å€¼ï¼›è€Œæ•°ä»“ç›¸å¯¹ç²¾ç»†åŒ–çš„åˆ†æï¼Œå‰ç½®å»ºæ¨¡å»ºè¡¨åˆ†æï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¯¹æ­¤è¿›è¡Œæ–¹æ¡ˆåˆ†æï¼Œæœ¬æ–‡å°†ä»‹ç»ä¸€ç§å®æ—¶ç¦»çº¿å¤„ç†åˆ†æç”¨æˆ·è¡Œä¸ºæ•°æ®æ–¹æ¡ˆï¼Œå³èƒ½å¸®åŠ©ä¼ä¸šä½æˆæœ¬åœ°ä½¿ç”¨æµ·é‡æ•°æ®ï¼Œåˆèƒ½æ›´å¿«é€Ÿåœ°å“åº”ä¸šåŠ¡éœ€æ±‚ï¼ŒåŒæ—¶å€ŸåŠ©äºšé©¬é€Šäº‘ç§‘æŠ€çš„æ‰˜ç®¡æœåŠ¡ï¼Œèƒ½å¤Ÿå¿«é€Ÿå®æ–½å’Œè½»æ¾è¿ç»´ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ“ä½œæ¦‚æ‹¬&#34;&gt;æ“ä½œæ¦‚æ‹¬&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;æƒé™è®¾ç½®ï¼šæ ¹æ®å…¬å¸ä¸šåŠ¡ç»„ç»‡ï¼Œåˆ†é…å¯¹åº”æœåŠ¡èµ„æºæƒé™ï¼Œæ¯”å¦‚ç³»ç»Ÿç®¡ç†å‘˜OP, å¼€å‘äººå‘˜DEV, è¿˜æœ‰ä¸šåŠ¡ç®¡ç†å‘˜OPï¼›ç»„ç»‡æ¶æ„æƒé™å»ºè®¾ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡åŸºç¡€æ¶æ„ï¼šé¦–å…ˆéœ€è¦æ­å¥½åŸºç¡€æœåŠ¡æ¡†æ¶ï¼Œç»“åˆäº‘å‚å•†æœåŠ¡ï¼Œè¿›è¡Œå¯æ°´å¹³å‚ç›´è‡ªåŠ¨æ‰©å±•ï¼Œé«˜å®¹é”™æ€§ï¼Œä½æˆæœ¬ï¼Œå¯è§‚æµ‹ç›‘æ§ï¼Œæ˜“äºç»´æŠ¤ï¼ŒæŒç»­é›†æˆå‘å¸ƒçš„ç¨³å®šæ€§æ¶æ„å»ºè®¾ï¼›&lt;/li&gt;
&lt;li&gt;ä¸šåŠ¡è¿­ä»£æ•°æ®å»ºè®¾å¼€å‘ï¼šæ¶å­æ­å¥½ä¹‹åï¼Œéœ€è¦å¯¹ç‰¹å®šçš„ä¸šåŠ¡åœºæ™¯è¿›è¡Œæ•°æ®å»ºæ¨¡ï¼ŒAIæ¨¡å‹è®­ç»ƒï¼ŒæŒ–æ˜å‡ºæ•°æ®çš„ä»·å€¼ï¼Œè¿›è¡Œå†³ç­–ï¼›æœåŠ¡ä»£ç è´¨é‡ï¼Œæ¡†æ¶å»ºè®¾ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;è§£å†³æ–¹æ¡ˆ&#34;&gt;è§£å†³æ–¹æ¡ˆ&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨aws ç°æœ‰äº§å“æœåŠ¡ç»„ä»¶è¿›è¡Œæ­å»ºï¼Œä¸»è¦åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œæ•°æ®é‡‡é›†ï¼Œæ•°æ®å¤„ç†å­˜å‚¨ï¼Œæ•°æ®åˆ†æï¼Œæ•´ä½“æ¶æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/weedge/user-behavior-analytics-cdk/blob/master/docs/aws-user-behavior-analytics.drawio.png?raw=true&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ•°æ®æºé‡‡é›†&#34;&gt;æ•°æ®æºé‡‡é›†&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;è®¿é—®æ—¥å¿—å’Œè¯·æ±‚äº‹ä»¶ï¼šç”¨æˆ·åœ¨æ‰‹æœºç«¯é€šè®¿CloudFront å†…å®¹åˆ†å‘æœåŠ¡, ä¼šç”Ÿæˆç”¨æˆ·è¡Œä¸º&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/AmazonCloudFront/latest/DeveloperGuide/AccessLogs.html&#34;&gt;è®¿é—®æ—¥å¿—&lt;/a&gt;ï¼Œè¿™äº›&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/AmazonCloudFront/latest/DeveloperGuide/real-time-logs.html&#34;&gt;å®æ—¶æ—¥å¿—&lt;/a&gt;ä¸­ä¼šæœ‰äº§å“ä¸­å®šä¹‰çš„è¡Œä¸ºåˆ†æåŸ‹ç‚¹è®°å½•äº‹ä»¶ï¼Œå­˜æ”¾åœ¨S3ä¸­ï¼Œé€šè¿‡Lambdaæ— æœåŠ¡å‡½æ•°å†™å…¥kinesis data streamsä¸­ï¼›å¦‚æœéœ€è¦å®æ—¶å¤„ç†ï¼Œéœ€è¦å¼€å¯&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/AmazonCloudFront/latest/DeveloperGuide/real-time-logs.html&#34;&gt;CloudFrontå®æ—¶æ—¥å¿—åŠŸèƒ½&lt;/a&gt;ï¼Œå°†æ•°æ®å†™å…¥Kinesis Data Streamsä¸­ï¼Œä¼šæœ‰å‡ ç§’çš„å¤„ç†å»¶æ—¶ï¼›è¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯æœåŠ¡ç«¯åœ¨çº¿å®æ—¶é€šè¿‡ä½¿ç”¨aws SDKæ–¹å¼ç›´æ¥å†™å…¥è®°å½•äº‹ä»¶æ•°æ®ï¼Œå¯é€šè¿‡æ— æœåŠ¡éƒ¨ç½²çš„lambdaå‡½æ•°å†™å…¥æˆ–è€…API gatewayé…ç½®å†™å…¥(å‚è€ƒ:&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/apigateway/latest/developerguide/integrating-api-with-aws-services-kinesis.html&#34;&gt;åœ¨ API Gateway ä¸­åˆ›å»º REST API ä½œä¸º Amazon Kinesis ä»£ç†&lt;/a&gt;)ï¼Œå¸¸ç”¨äºå®æ—¶å¼‚å¸¸æŠ¥è­¦å’Œç»Ÿè®¡ï¼›&lt;/li&gt;
&lt;li&gt;æ•°æ®åº“æ•°æ®ï¼š å­˜æ”¾åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œéœ€è¦å°†æ•°æ®åŒæ­¥å­˜æ”¾åœ¨æ•°ä»“å’Œæ•°æ®æ¹–ä¸­ï¼Œè¿›è¡Œç¦»çº¿åˆ†æ; æ•°æ®åº“çš„æ•°æ®å¯ä»¥é€šè¿‡&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/dms/latest/userguide/CHAP_Introduction.html&#34;&gt;aws DMS&lt;/a&gt;æœåŠ¡æ¥æ”¯æŒå­˜é‡å¢é‡æ•°æ®åŒæ­¥è‡³Kinesis Data Streamsä¸­ï¼Œå…·ä½“æ–¹æ¡ˆå¯ä»¥å‚è€ƒ**&lt;a href=&#34;https://aws.amazon.com/cn/blogs/big-data/stream-change-data-to-amazon-kinesis-data-streams-with-aws-dms/&#34;&gt;ä½¿ç”¨ AWS DMS å°†æ›´æ”¹æ•°æ®æµå¼ä¼ è¾“åˆ° Amazon Kinesis Data Streams&lt;/a&gt;**ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;a href=&#34;https://ververica.github.io/flink-cdc-connectors/master/&#34;&gt;flink CDC connector&lt;/a&gt;  &lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/emr/latest/ReleaseGuide/emr-flink.html&#34;&gt;on aws EMR&lt;/a&gt;æ”¯æŒåŒæ­¥(éœ€è¦ç†è§£åå‹æœºåˆ¶ï¼Œä»¥ä¾¿è§¦å‘æ—¶çœ‹æ˜¯å¦å¢å¤§ä¸‹æ¸¸æ¶ˆè´¹èƒ½åŠ›æé«˜åå), å¯å‚è€ƒ&lt;a href=&#34;https://aws.amazon.com/cn/blogs/china/best-practice-of-using-amazon-emr-cdc-to-enter-the-lake-in-real-time-in-a-multi-database-multi-table-scenario/&#34;&gt;å¤šåº“å¤šè¡¨åœºæ™¯ä¸‹ä½¿ç”¨Amazon EMR CDCå®æ—¶å…¥æ¹–æœ€ä½³å®è·µ&lt;/a&gt;ï¼Œæ³¨æ„æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®å­—æ®µéœ€è¦è§„èŒƒï¼Œéœ€è¦ä¸€ä¸ªæ›´æ–°æ—¶é—´å­—æ®µæ–¹ä¾¿æ•°æ®é¡ºåºåŒæ­¥ï¼Œæ¯”å¦‚mysql &lt;code&gt;update_time timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP&lt;/code&gt;ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ‚¨å¯ä»¥å‚é˜… AWS ç™½çš®ä¹¦&lt;a href=&#34;https://d1.awsstatic.com/whitepapers/aws-cloud-data-ingestion-patterns-practices.pdf&#34;&gt;AWS Cloud Data Ingestion Patterns and Practices&lt;/a&gt;ï¼Œäº†è§£æœ‰å…³æ•°æ®é‡‡é›†æ¨¡å¼çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼›&lt;/p&gt;
&lt;p&gt;å°†æ•°æ®é‡‡é›†å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¸­ä¸»è¦æ˜¯æ–¹ä¾¿å¤šä¸ªæ¶ˆè´¹æ–¹æ¥å¤„ç†æµï¼Œä»¥åŠæœåŠ¡ä¹‹é—´çš„æ•´ä½“è§£è€¦ï¼Œå¯ä½œä¸ºæ•°æ®æµç¼“å­˜å±‚ï¼Œæ•°æ®æµé‡çªå¢æ—¶ï¼Œå¢åŠ åˆ†ç‰‡æ•°ï¼Œæé«˜ååï¼Œå½“ç„¶æ•´ä½“ååé‡ä¹Ÿå–å†³äºä¸‹æ¸¸æ•°æ®çš„æ¶ˆè´¹èƒ½åŠ›ï¼Œå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œä»¥pullæ–¹å¼è¿›è¡Œæ¶ˆè´¹(ä¸»åŠ¨æ¶ˆè´¹)ï¼Œä¸è‡³äºå°†ä¸‹æ¸¸æœåŠ¡æ‰“æŒ‚ï¼Œè€Œä¸”æ–¹ä¾¿ä¸‹æ¸¸å¼‚å¸¸æ¶ˆè´¹é‡å¯æ—¶ï¼Œç»§ç»­åœ¨æœªæ¶ˆè´¹ç‚¹å¼€å§‹æ¶ˆè´¹ï¼›è¿™é‡Œæä¾›ä¸¤ç§æ–¹æ¡ˆï¼Œä¸€ç§å°†æ•°æ®å†™å…¥Kinesis Data Streamsä¸­ï¼Œä¸€ç§å°†æ•°æ®å†™å…¥&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/msk&#34;&gt;MSK&lt;/a&gt;(aws æ‰˜ç®¡çš„kafkaé›†ç¾¤æœåŠ¡ï¼Œå¦‚æœç›´æ¥è‡ªå·±æ­å»ºç»´æŠ¤ï¼Œæˆæœ¬æ¯”è¾ƒé«˜ï¼Œå¯¹æ¥å…¶ä»–awsæœåŠ¡ç›¸å¯¹å¤æ‚äº›) ä¸­ï¼›&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ•°æ®å†™å…¥Kinesis Data Streamsä¸­ä¸»è¦æ˜¯æ–¹ä¾¿å¤šä¸ªæ¶ˆè´¹æ–¹æ¥å¤„ç†æµï¼Œä»¥åŠæœåŠ¡ä¹‹é—´çš„æ•´ä½“è§£è€¦ï¼Œæ•°æ®æµç¼“å­˜å±‚ï¼Œæ›´é‡è¦çš„æ˜¯æ–¹ä¾¿ä½¿ç”¨aws Kinesisæ–¹æ¡ˆï¼Œå‡å°‘è¿ç»´æˆæœ¬ï¼Œå¯¹æ¥ä¹Ÿä¸°å¯Œï¼Œä¸»è¦æ˜¯æ–¹ä¾¿å¯¹æ¥å†…éƒ¨Kinesisç›¸å…³æœåŠ¡ç»„ä»¶;&lt;/li&gt;
&lt;li&gt;æ•°æ®å†™å…¥MSKä¸­ï¼Œä½¿ç”¨çš„å¼€æºè§£å†³æ–¹æ¡ˆå¯¹æ¥ï¼›ä¸‹æ¸¸å¯¹æ¥kinesis Data Analytics æœåŠ¡éœ€è¦é€šè¿‡flink è®¡ç®—å¼•æ“åŠ è½½å¯¹åº”kafka connectoråŒ…ï¼Œä»kafkaä¸­è·å–æ•°æ®æºè¿›è¡Œåˆ†æï¼›å¦‚æœä¸‹æ¸¸å¯¹æ¥å…¶ä»–æœåŠ¡ï¼Œæ¯”å¦‚ï¼šKinesis Data Firehoseï¼Œå°†æ•°æ®ä¼ è¾“è½¬åŒ–å†™å…¥æ•°æ®æ¹–S3ä¸­å­˜å‚¨ï¼Œå†™å…¥Redshiftæ•°ä»“ä¸­åˆ†æï¼›ä½¿ç”¨SNS è¿›è¡ŒæŠ¥è­¦ç­‰ï¼› éœ€è¦å¼•å…¥æ— æœåŠ¡æ¡†æ¶lambdaå‡½æ•°ï¼Œé€šè¿‡ä½¿ç”¨&lt;a href=&#34;https://docs.confluent.io/platform/current/clients/index.html&#34;&gt;kafka client SDKåº“&lt;/a&gt;æ¥è¿›è¡Œç”Ÿäº§/æ¶ˆè´¹å¤„ç†ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å…·ä½“ä½¿ç”¨ç»“åˆå…¬å¸å®é™…åœºæ™¯è€Œå®šï¼Œå¦‚æœæƒ³æƒ³é€šè¿‡kafkaå¯¹æ¥æ›´å¤šçš„å¼€æºå¤§æ•°æ®æœåŠ¡æ¡†æ¶ï¼Œ å¯ä»¥é€‰æ‹©MSKæ–¹æ¡ˆï¼Œé¢å¤–éœ€è¦å¼€å‘ç»´æŠ¤lambdaå‡½æ•°æœåŠ¡ï¼›ä½¿ç”¨Kinesis Data streams å¾ˆæ–¹ä¾¿æ¥å…¥awsç›¸å…³æœåŠ¡ï¼Œå‡å°‘é¢å¤–çš„å¼€å‘ç»´æŠ¤æˆæœ¬ï¼Œä¸è¿‡å¦‚æœå¯¹æ¥å…¶ä»–å¼€æºå¤§æ•°æ®æœåŠ¡æ¡†æ¶ï¼ŒåŒæ ·éœ€è¦å¼•å…¥lambdaå‡½æ•°æœåŠ¡ï¼›æœ¬æ–‡é‡‡ç”¨å°†æ•°æ®å†™å…¥Kinesis Data streams æœåŠ¡ï¼Œæä¾›ç»™ä¸‹æ¸¸å¯¹æ¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ•°æ®å¤„ç†å­˜å‚¨&#34;&gt;æ•°æ®å¤„ç†å­˜å‚¨&lt;/h3&gt;
&lt;p&gt;æ•°æ®å¤„ç†åˆ†æï¼Œåˆ†ä¸ºå®æ—¶å¤„ç†çš„&lt;a href=&#34;https://aws.amazon.com/cn/streaming-data/&#34;&gt;æµæ•°æ®&lt;/a&gt;å’Œç¦»çº¿å¤„ç†æ‰¹æ•°æ®å¤„ç†å­˜æ”¾ï¼›&lt;/p&gt;
&lt;p&gt;å®æ—¶å¤„ç†ä½¿ç”¨AWS Kinesisi Data Analytics(KDA)è¿›è¡Œåˆ†æï¼Œæ”¯æŒä¸‰ç§åˆ†ææ–¹å¼ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½¿ç”¨è€çš„æ–¹å¼&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/kinesisanalytics/latest/dev/what-is.html&#34;&gt;SQL åº”ç”¨ç¨‹åº&lt;/a&gt;è¿›è¡Œåˆ†æå¤„ç†ï¼Œä¸èƒ½ä½¿ç”¨ç¼–ç¨‹è¯­è¨€python/Scalaæ¥è°ƒç”¨apiæ¥è¿›è¡Œç²¾ç»†åŒ–æ“ä½œ(éœ€è¦å®šä¹‰UDFåŒ…æä¾›ä½¿ç”¨),ä»¥åŠå³å¸­æŸ¥è¯¢ï¼›&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨åŸºäº &lt;a href=&#34;https://flink.apache.org/&#34;&gt;Apache Flink&lt;/a&gt; çš„å¼€æºåº“åœ¨ Kinesis Data Analytics ä¸­æ„å»º Java ,Scala å’ŒPython åº”ç”¨ç¨‹åº,Apache Flink æ˜¯å¤„ç†æ•°æ®æµçš„å¸¸ç”¨æ¡†æ¶å’Œå¼•æ“ï¼ŒKinesis Data Analyticsç°ä½¿ç”¨flinkæ”¯æŒæœ€é«˜ç‰ˆæœ¬æ˜¯&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-release-1.13/docs/learn-flink/overview/&#34;&gt;1.13&lt;/a&gt;ï¼›åœ¨å¼€å‘åº”ç”¨æ—¶ï¼Œéœ€è¦æ‰“å°æ—¥å¿—ï¼Œä»¥ä¾¿ä½¿ç”¨CloudWatch æ—¥å¿—ç›‘æ§åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œé”™è¯¯çŠ¶å†µï¼›å¦‚æœåº”ç”¨ç¨‹åºå‡ºç°bugæˆ–è€…æœåŠ¡å¼‚å¸¸ä¸­æ–­å¯ä»¥ä½¿ç”¨æ£€æŸ¥ç‚¹(&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-release-1.13/docs/ops/state/checkpoints/&#34;&gt;CheckPoints&lt;/a&gt;)å’Œä¿å­˜ç‚¹(&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-release-1.13/docs/ops/state/savepoints/&#34;&gt;SavePoints&lt;/a&gt; ç”Ÿæˆ&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/kinesisanalytics/latest/java/how-fault-snapshot.html&#34;&gt;å¿«ç…§&lt;/a&gt;)åœ¨ Kinesis Data Analytics åº”ç”¨ç¨‹åºä¸­å®ç°å®¹é”™åŠŸèƒ½; åŒæ—¶Kinesis Data Analytics &lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/kinesisanalytics/latest/java/how-scaling.html&#34;&gt;&lt;strong&gt;å¯å¼¹æ€§æ‰©ç¼©&lt;/strong&gt;&lt;/a&gt;åº”ç”¨ç¨‹åºçš„å¹¶è¡Œåº¦ï¼Œä»¥é€‚åº”å¤§å¤šæ•°åœºæ™¯ä¸‹çš„æºæ•°æ®ååé‡å’Œæ“ä½œå¤æ‚æ€§ï¼ŒKinesis Data Analytics ç›‘æ§åº”ç”¨ç¨‹åºçš„èµ„æº (CPU) ä½¿ç”¨æƒ…å†µï¼Œå¹¶ç›¸åº”åœ°å¼¹æ€§åœ°å‘ä¸Šæˆ–å‘ä¸‹æ‰©å±•åº”ç”¨ç¨‹åºçš„å¹¶è¡Œåº¦; ä½¿ç”¨ç®—å­(&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-release-1.13/docs/dev/datastream/operators/overview/#operators&#34;&gt;operators&lt;/a&gt;)è¿›è¡Œæ•°æ®æµæ‹“æ‰‘è®¡ç®—ï¼›åŒæ—¶é€šè¿‡&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-release-1.13/docs/connectors/datastream/overview/&#34;&gt;connector&lt;/a&gt;å¯ç›´æ¥å¼•å…¥jaråŒ…æ¥å…¥æ•°æ®æºæˆ–è€…sinkåˆ°ä¸‹æ¸¸æœåŠ¡ï¼Œå¯ä»¥åœ¨mvnåº“ä¸­æ‰¾åˆ°ï¼Œæ¯”å¦‚&lt;a href=&#34;https://mvnrepository.com/artifact/org.apache.flink/flink-sql-connector-kinesis&#34;&gt;kinesis stream connector&lt;/a&gt;;&lt;/li&gt;
&lt;li&gt;åœ¨åŸºäº &lt;a href=&#34;https://flink.apache.org/&#34;&gt;Apache Flink&lt;/a&gt; çš„å¼€æºåº“æ„å»ºåº”ç”¨ç¨‹åºçš„åŸºç¡€ä¸Šï¼Œç»“åˆ&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/glue/latest/dg/how-it-works.html&#34;&gt;Glue&lt;/a&gt;å®šä¹‰æ•°æ®åº“è¡¨å­˜æ”¾æ•°æ®catalogå…ƒæ•°æ®ï¼Œé€šè¿‡&lt;a href=&#34;https://zeppelin.apache.org/&#34;&gt;zeppelin&lt;/a&gt;å¢åŠ äº†å¯è§†åŒ–å³å¸­æŸ¥è¯¢, ç›´æ¥å¯ä»¥åœ¨notebookä¸Šç¼–å†™flink æµ/æ‰¹**&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql/overview/&#34;&gt;SQL&lt;/a&gt;**(notice: *flinkSQLå’ŒKDA SQLæœ‰æ‰€ä¸åŒï¼Œç‰¹åˆ«æ˜¯åœ¨windowä¸Šæœ‰äº›åŒºåˆ«*), ä»¥åŠç¼–å†™è°ƒç”¨flink APIçš„Scala,Pythonç¨‹åº, å…·ä½“è§&lt;a href=&#34;https://zeppelin.apache.org/docs/0.9.0/interpreter/flink.html&#34;&gt;zeppelin flinkè§£é‡Šå™¨&lt;/a&gt;; è¿™ç§æ–¹å¼æ˜¯ç›¸å¯¹äºç¬¬äºŒç§æ–¹å¼ï¼Œåœ¨æ–¹ä¾¿è¿ç»´ç®¡ç†çš„åŸºç¡€ä¸Šæ›´åŠ å®¹æ˜“ä¸Šæ‰‹ï¼Œç›´æ¥åœ¨notebookä¸Šå°±å¯ä»¥è¿›è¡Œå³å¸­æŸ¥è¯¢, æŸ¥è¯¢ä¼šè¯è¿˜å¯ä»¥ä¿ç•™æˆ–å­˜æ”¾æœ¬åœ°ï¼Œè¿˜å¯ä»¥ä½œä¸ºæµ‹è¯•å¼€å‘è°ƒè¯•çš„å¹³å°ï¼Œæ„å»ºå¥½å¤„ç†ç¨‹åºï¼Œå¯ç›´æ¥è½¬åŒ–æˆ&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/kinesisanalytics/latest/java/how-notebook-durable.html&#34;&gt;æŒä¹…åŒ–çš„åº”ç”¨ç¨‹åºéƒ¨ç½²&lt;/a&gt;ï¼›å½“ç„¶è¿™éƒ¨åˆ†è´¹ç”¨ç›¸æ¯”å‰é¢çš„åˆ†ææ–¹å¼ç›¸å¯¹å¤šäº›ï¼Œå¯åŠ¨çš„studio notebook è´¹ç”¨ï¼ŒKinesis å¤„ç†å•å…ƒ(KPU)å°†æŒ‰å°æ—¶æ”¶è´¹ï¼›å¯å‚è€ƒ&lt;a href=&#34;https://docs.aws.amazon.com/kinesisanalytics/latest/java/how-zeppelin-examples.html&#34;&gt;å®ä¾‹æ•™ç¨‹&lt;/a&gt;ï¼Œ&lt;a href=&#34;https://aws.amazon.com/cn/blogs/big-data/query-your-data-streams-interactively-using-kinesis-data-analytics-studio-and-python/&#34;&gt;ä½¿ç”¨ Kinesis Data Analytics Studio å’Œ Python ä»¥äº¤äº’æ–¹å¼æŸ¥è¯¢æ•°æ®æµ&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ•´ä½“æ¥è¯´ï¼š &lt;a href=&#34;https://aws.amazon.com/kinesis/data-analytics/&#34;&gt;Amazon Kinesis Data Analytics&lt;/a&gt; å¯ä»¥è½»æ¾åœ°å®æ—¶åˆ†ææµæ•°æ®ï¼Œå¹¶ä½¿ç”¨æ ‡å‡† SQLã€Python å’Œ Scala æ„å»ºç”± Apache Flink æä¾›æ”¯æŒçš„æµå¤„ç†åº”ç”¨ç¨‹åºã€‚ç‰¹åˆ«æ˜¯notebookåŠŸèƒ½åªéœ€åœ¨AWS ç®¡ç†æ§åˆ¶å°ä¸­å•å‡»å‡ ä¸‹ï¼Œå†™ä¸‹åˆ†æSQLï¼Œå°±å¯ä»¥å¯åŠ¨æ— æœåŠ¡å™¨ç¬”è®°æœ¬æ¥æŸ¥è¯¢æ•°æ®æµå¹¶åœ¨å‡ ç§’é’Ÿå†…è·å¾—ç»“æœã€‚Kinesis Data Analytics é™ä½äº†æ„å»ºå’Œç®¡ç† Apache Flink åº”ç”¨ç¨‹åºçš„å¤æ‚æ€§ã€‚&lt;/p&gt;
&lt;p&gt;ç¦»çº¿å¤„ç†çš„æ•°æ®ä¸»è¦æ˜¯é€šè¿‡&lt;a href=&#34;&#34;&gt;AWS Kinesis Data Firehose&lt;/a&gt; ä¼ è¾“æµå†™å…¥ä¸‹æ¸¸æœåŠ¡å­˜å‚¨ï¼Œå°†æ•°æ®å†™å…¥æ¹–ä»“ç³»ç»Ÿä¸­, ç”¨äºåç»­çš„æ•°æ®åˆ†æï¼Œä»¥åŠå‰æœŸè§„åˆ’å¥½çš„æ•°æ®åˆ†æï¼›é€‰ç”¨firehoseçš„åŸå› æ˜¯æœ‰åŸå§‹å¤‡ä»½æœºåˆ¶å­˜æ”¾äºS3ä¸­ï¼Œå³ä½¿æ•°æ®ä¼ è¾“é”™è¯¯æ—¶ï¼Œæ•°æ®ä¼ è¾“ä¸­ä¸ä¼šä¸¢å¤±æ•°æ®ï¼ŒåŒæ—¶å†…ç½®lambdå‡½æ•°åœ¨ä¼ è¾“ä¹‹å‰å°†æ•°æ®è½¬åŒ–å¤„ç†ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒç”¨Glueå®šä¹‰è¡¨æ¥è½¬æ¢å¤§æ•°æ®ç›¸å…³çš„è®°å½•æ ¼å¼;&lt;/p&gt;
&lt;p&gt;åŸå§‹åˆ†ææ•°æ®ç›´æ¥å­˜æ”¾äº&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/Welcome.html&#34;&gt;S3&lt;/a&gt;ä¸­ï¼Œ11ä¸ª9çš„ä¿éšœå¯ä»¥éå¸¸å¯é ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œé€šè¿‡&lt;a href=&#34;https://aws.amazon.com/cn/s3/storage-classes/glacier/&#34;&gt;Glacier&lt;/a&gt;æŒä¹…å†·çƒ­å­˜æ”¾ï¼Œé™ä½æˆæœ¬ï¼Œæ–¹ä¾¿åé¢è¿½æŸ¥æ•°æ®ï¼Œä»¥åŠé€šè¿‡AthenaæŸ¥è¯¢å¼•æ“ç»“åˆGlueæ¥å®šä¹‰è¡¨ä»S3ä¸­æŒ–æ˜å‡ºæ›´æœ‰ä»·å€¼çš„æ•°æ®ï¼›æ•°æ®å­˜æ”¾ä¸‹æ¥ä¹‹åï¼Œç»“åˆå¤§æ•°æ®ç›¸å…³å¹³å°ï¼Œ&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/emr/latest/ManagementGuide/emr-what-is-emr.html&#34;&gt;EMR&lt;/a&gt;è¿›è¡Œæµ·é‡æ•°æ®å¤„ç†(PBçº§åˆ«)ï¼›åŒæ—¶ç»“åˆ&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/glue/latest/dg/what-is-glue.html&#34;&gt;Glue&lt;/a&gt; è¿›è¡ŒETL æ•°æ®å¤„ç†ï¼Œé›†æˆç¼–æ’æˆDAGå·¥ä½œæµï¼Œå¯è§†åŒ–ç®¡ç†è¿™äº›ETLä»»åŠ¡ä½œä¸šï¼Œä¹Ÿå¯ä»¥è¿ç§»è°ƒåº¦å¹³å°æ¯”å¦‚Azkabançš„å·¥ä½œæµè¿ç§»è‡³Glue ETLå·¥ä½œæµ,å‚è€ƒ&lt;a href=&#34;https://aws.amazon.com/cn/blogs/china/preliminary-study-on-selection-of-aws-glue-scheduling-tool/&#34;&gt;Amazon Glue ETLä½œä¸šè°ƒåº¦å·¥å…·é€‰å‹åˆæ¢&lt;/a&gt;ï¼›&lt;/p&gt;
&lt;p&gt;æå‰ä¸šåŠ¡åœºæ™¯æ•°æ®åˆ†æå»ºæ¨¡ï¼Œä½¿ç”¨&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/redshift/latest/gsg/concepts-diagrams.html&#34;&gt;Redshift&lt;/a&gt;æ¥å­˜æ”¾ä¸åŒç»´åº¦(DIM)çš„è¡¨ï¼Œåˆ†å±‚(ODS-&amp;gt;&lt;strong&gt;DWD-&amp;gt;DWM-&amp;gt;DWS&lt;/strong&gt;)å»ºè®¾æ•°æ®ä»“åº“ï¼› é€‰ç”¨redshiftæ€§ä»·æ¯”æ¯”è¾ƒé«˜ï¼Œå¼€ç®±å³ç”¨ï¼Œå­˜æ”¾ç»“æ„åŒ–ï¼ŒåŠç»“æ„åŒ–æ•°æ®ï¼Œæ•°æ®åˆ—å¼å­˜å‚¨ï¼Œåˆ†ç‰‡å­˜æ”¾ï¼Œè®¡ç®—å’Œå­˜å‚¨åˆ†ç¦»ï¼Œå¾ˆæ–¹ä¾¿æ— æœåŠ¡åŒ–ï¼Œåœ¨æ•°ç§’å†…è½»æ¾è¿è¡Œå’Œæ‰©å±•åˆ†æï¼Œè€Œæ— éœ€è°ƒé…å’Œç®¡ç†æ•°æ®ä»“åº“; å’Œæ•°æ®æ¹–æ‰“é€šï¼Œå¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/redshift/latest/gsg/data-lake.html&#34;&gt;Redshift Spectrum&lt;/a&gt; åœ¨ Amazon S3 æ–‡ä»¶ä¸­æŸ¥è¯¢æ•°æ®ï¼Œè€Œä¸å¿…å°†æ•°æ®åŠ è½½åˆ° Amazon Redshift è¡¨ä¸­ï¼Œæé«˜å…³è”æŸ¥è¯¢ï¼›è¿˜å¯ä»¥å¯¹æ¥æœºå™¨å­¦ä¹ &lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/redshift/latest/dg/machine_learning.html&#34;&gt;ML&lt;/a&gt;ï¼Œé€šè¿‡CREATE MODEL DDLè¯­å¥ä¸‹æ¨åˆ°Amazon &lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/sagemaker/latest/dg/whatis.html&#34;&gt;SageMaker&lt;/a&gt;ï¼Œä»S3ä¸­åŠ è½½æ•°æ®è¿›è¡Œè®­ç»ƒï¼›&lt;/p&gt;
&lt;h3 id=&#34;æ•°æ®åˆ†æ&#34;&gt;æ•°æ®åˆ†æ&lt;/h3&gt;
&lt;p&gt;ä¸»è¦æ˜¯é€šè¿‡åˆ†æå¼•æ“ä»æ•°æ®å­˜å‚¨è·å–æ•°æ®ï¼Œæ ¹æ®ç»´åº¦å±•ç°çœ‹æ¿ï¼Œè¿›è¡Œå®æ—¶æ•°æ®æŸ¥çœ‹ï¼Œç¦»çº¿åˆ†æï¼Œä»¥åŠå¯è§†åŒ–å³å¸­åˆ†æï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å®æ—¶ç»“æœæ•°æ®æŸ¥çœ‹ï¼šé€šè¿‡&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/amazondynamodb/latest/developerguide/Introduction.html&#34;&gt;DynamoDB&lt;/a&gt;è·å–å®æ—¶ç»“æœæ•°æ®ï¼Œä¸»è¦æ˜¯Key/Valueæ•°æ®ï¼ŒåŒæ—¶æŸ¥è¯¢é€Ÿåº¦å¾ˆå¿«ï¼Œåˆ©ç”¨&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/amazondynamodb/latest/developerguide/DAX.html&#34;&gt;DAX&lt;/a&gt;å®ç°å†…å­˜ä¸­åŠ é€Ÿï¼›é€šè¿‡&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/welcome.html&#34;&gt;lambda&lt;/a&gt;å¯¹æ¥&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/apigateway/latest/developerguide/welcome.html&#34;&gt;API Gateway&lt;/a&gt;æä¾›æ•°æ®æ¥å£ï¼Œæ–¹ä¾¿ä¸šåŠ¡åœºæ™¯å®æ—¶å±•ç°ï¼Œæ¯”å¦‚ç›‘æ§æŸ¥çœ‹å¼‚å¸¸æ•°æ®ï¼Œè®¿é—®è®¡æ•°ç­‰ç»“æœå±•ç°ï¼›è¿™äº›ç»“æœæ•°æ®å¯ä»¥ç›´æ¥é€šè¿‡&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/sns/latest/dg/welcome.html&#34;&gt;SNS&lt;/a&gt;å‘é€é‚®ä»¶æˆ–è€…çŸ­ä¿¡è¿›è¡Œé€šçŸ¥ï¼›&lt;/li&gt;
&lt;li&gt;é€šè¿‡&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/opensearch-service/latest/developerguide/what-is.html&#34;&gt;OpenSearch&lt;/a&gt;æä¾›å®æ—¶æœç´¢æœåŠ¡ï¼Œæ¯”å¦‚æ—¥å¿—æœç´¢å®æ—¶å®šä½è¿½æŸ¥é—®é¢˜ï¼Œé€šè¿‡KDAå®æ—¶åˆ†æå†™å…¥ï¼›åœ¨çº¿æ£€ç´¢å•†å“ï¼Œè¿™äº›æ•°æ®ä¸»è¦æ¥æºäºæ•°æ®åº“ï¼Œå¼‚æ„æˆOpenSearchç´¢å¼•æ•°æ®è¿›è¡Œæ£€ç´¢ï¼Œå¯é€šè¿‡&lt;a href=&#34;https://ververica.github.io/flink-cdc-connectors/master/&#34;&gt;flink CDC&lt;/a&gt; on &lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/emr/latest/ReleaseGuide/emr-flink.html&#34;&gt;EMR&lt;/a&gt;æ¥åŒæ­¥æ•°æ®åˆ°OpenSearchä¸­ï¼›&lt;/li&gt;
&lt;li&gt;S3ä¸­çš„æ•°æ®é€šè¿‡&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/athena/latest/ug/what-is.html&#34;&gt;Athena&lt;/a&gt;åœ¨Glue/Hiveä¸Šå»ºè¡¨å…ƒæ•°æ®ï¼Œä½¿ç”¨&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/athena/latest/ug/ddl-sql-reference.html&#34;&gt;SQL&lt;/a&gt;æŸ¥è¯¢ï¼Œå‡ åˆ†é’Ÿå†…å¯ä»¥æŸ¥è¯¢åˆ°ç»“æœ;&lt;/li&gt;
&lt;li&gt;å­˜æ”¾åœ¨&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/redshift/latest/gsg/concepts-diagrams.html&#34;&gt;Redshift&lt;/a&gt;æ•°æ®ä»“åº“ä¸­çš„æ•°æ®ï¼Œé€šè¿‡Amazon &lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/quicksight/latest/user/welcome.html&#34;&gt;QuickSight&lt;/a&gt;æ¥å…¥è¿›è¡ŒBIåˆ†æï¼Œå“åº”æ—¶é—´åœ¨ç§’çº§åˆ«ï¼Œåªéœ€è¦åœ¨ç•Œé¢ä¸Šé€‰æ‹©å›¾è¡¨ç»„åˆæˆä¸€ä¸ªä»ªè¡¨ç›˜å±•ç°å³å¯ï¼Œæ–¹ä¾¿å¿«é€Ÿå†³ç­–ï¼›&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/quicksight/latest/user/regions.html&#34;&gt;æ”¯æŒAWSåŒºåŸŸæ¥å…¥IPèŒƒå›´&lt;/a&gt;;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;ç»„ç»‡ç”¨æˆ·è§’è‰²æƒé™ç®¡ç†&#34;&gt;ç»„ç»‡ç”¨æˆ·è§’è‰²æƒé™ç®¡ç†&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸Šè¿™äº›è°ˆåˆ°çš„æœåŠ¡éœ€è¦è¿›è¡Œå®‰å…¨è®¿é—®ï¼Œé€šè¿‡&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/iam/&#34;&gt;IAM&lt;/a&gt;å®šä¹‰ç­–ç•¥è§’è‰²åˆ†é…æƒé™è¿›è¡Œ&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/service-authorization/latest/reference/reference.html&#34;&gt;æœåŠ¡æˆæƒ&lt;/a&gt;ï¼Œæ¥è¿›è¡Œå®‰å…¨è®¿é—®ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æœåŠ¡èµ„æºä¹‹é—´çš„è®¿é—®ï¼Œéœ€è¦åˆ†é…è¯»å†™æƒé™ï¼Œéœ€è¦æŠŠè¿™äº›ç­–ç•¥èµ‹äºˆè«ä¸ªè§’è‰²ï¼Œç„¶åèµ„æºé€šè¿‡è¿™ä¸ªèµ‹äºˆèµ„æºæƒé™çš„è§’è‰²æ¥è®¿é—®å¯¹åº”èµ„æºï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿˜æœ‰å°±æ˜¯æ“ä½œè€…è®¿é—®æœåŠ¡èµ„æºï¼Œéœ€è¦åˆ†é…ä¸åŒèµ„æºçš„è¯»å†™æƒé™ï¼Œå¯ä»¥æ ¹æ®å…¬å¸ç»„ç»‡æ¶æ„æ¥ç®¡ç†æ¯ä¸ªå‘˜å·¥çš„æƒé™ä½¿ç”¨èŒƒå›´ï¼Œéå¸¸æ–¹ä¾¿ï¼›&lt;/p&gt;
&lt;p&gt;è§’è‰²æƒé™è®¾ç½®è§„åˆ™å¦‚ä¸‹ï¼š&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/IAM/latest/UserGuide/id.html&#34;&gt;IAMèº«ä»½&lt;/a&gt;è®¾ç½®ç”¨æˆ·ç»„ dev, op, biz userï¼Œåç»­ ç»†åˆ†åœ¨æŒ‰ç»„ç»‡éƒ¨é—¨è¿›è¡Œå»ºç»„ï¼›&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;op: ç†è®ºä¸Šæ„å»ºå®Œä¸€ç»„èµ„æºå¯ä»¥åˆ†é…å¯¹åº”æƒé™ç­–ç•¥è§’è‰²Roleï¼Œç»™äºˆæœåŠ¡èµ„æºçš„è¿ç»´ç®¡ç†æ“ä½œï¼›&lt;/li&gt;
&lt;li&gt;dev: åªæœ‰ä½¿ç”¨å¼€å‘èµ„æºæƒé™ï¼Œæ¯”å¦‚lambdaç¼–è¾‘å‘å¸ƒæƒé™ï¼Œæ•°æ®åº“è¯»å†™æƒé™ï¼Œè€Œéç®¡ç†åˆ é™¤æƒé™ç­–ç•¥Roleï¼›&lt;/li&gt;
&lt;li&gt;bizUser: ä¸šåŠ¡æ“ä½œè€…ï¼Œå¤§éƒ¨åˆ†åªæœ‰è¯»æƒé™ç­–ç•¥Roleï¼Œæ²¡æœ‰å†™æ“ä½œæƒé™ï¼›&lt;/li&gt;
&lt;li&gt;admin: ç®¡ç†å‘˜ï¼ŒAdministratoræƒé™ï¼Œå¯ä»¥è®¿é—®ä»»ä½•èµ„æº&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿˜æœ‰æ˜¯åˆ›å»ºçš„åº”ç”¨æ˜¯ç»™å¤–éƒ¨æœåŠ¡ç”¨æˆ·ä½¿ç”¨ï¼Œæ¯”å¦‚Web,ç§»åŠ¨ç«¯ç”¨æˆ·ï¼Œé€šè¿‡Amazon &lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/cognito/&#34;&gt;Cognito&lt;/a&gt;æ¥æ³¨å†Œç™»å½•ç®¡ç†ç”¨æˆ·ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹ç™»å½•è¿›è¡Œèº«ä»½éªŒè¯ï¼›ä¸¤ä¸ªä¸»è¦ç»„ä»¶æ˜¯ç”¨æˆ·æ± å’Œèº«ä»½æ± ï¼šç”¨æˆ·æ± æ˜¯ä¸ºåº”ç”¨ç¨‹åºæä¾›æ³¨å†Œå’Œç™»å½•é€‰é¡¹çš„ç”¨æˆ·ç›®å½•ï¼Œèº«ä»½æ± æˆäºˆç”¨æˆ·è®¿é—®å…¶ä»– AWS æœåŠ¡çš„æƒé™ã€‚è¯·å‚è€ƒ&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/cognito/latest/developerguide/cognito-scenarios.html&#34;&gt;Amazon Cognitoå¸¸è§åœºæ™¯&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åœºæ™¯&#34;&gt;åœºæ™¯&lt;/h2&gt;
&lt;h3 id=&#34;case-å®æ—¶å¼‚å¸¸äº‹ä»¶æŠ¥è­¦å±•ç°&#34;&gt;CASE å®æ—¶å¼‚å¸¸äº‹ä»¶æŠ¥è­¦å±•ç°&lt;/h3&gt;
&lt;p&gt;æ‰“ç‚¹äº‹ä»¶æ•°æ®ï¼šï¼ˆå®ä½“æ•°æ®ï¼Œé€šè¿‡åŒæ­¥å®ä½“è¡¨æ•°æ®æµè¿›è¡Œå…³è”jionæ“ä½œï¼‰&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;field&lt;/th&gt;
&lt;th&gt;type&lt;/th&gt;
&lt;th&gt;desc&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;eventId&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·è¡Œä¸ºäº‹ä»¶id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;action&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;ç»Ÿä¸€å®šä¹‰çš„äº‹ä»¶åŠ¨ä½œï¼Œæ¯”å¦‚ æµè§ˆæ–‡æ¡£ï¼šviewDoc&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;userId&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;è§¦å‘äº‹ä»¶çš„ç”¨æˆ·id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;createdAt&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;è§¦å‘äº‹ä»¶æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;objectId&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;æ“ä½œå¯¹è±¡id, æ¯”å¦‚æ–‡æ¡£id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;bizId&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;æ‰€å±ä¸šåŠ¡id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;errorMsg&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;é”™è¯¯ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å®æ—¶è¿‡æ»¤å‡ºå¼‚å¸¸äº‹ä»¶KDA SQL&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;-- ** Continuous Filter ** 
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;-- Performs a continuous filter based on a WHERE condition.
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;--          .----------.   .----------.   .----------.              
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;--          |  SOURCE  |   |  INSERT  |   |  DESTIN. |              
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;-- Source--&amp;gt;|  STREAM  |--&amp;gt;| &amp;amp; SELECT |--&amp;gt;|  STREAM  |--&amp;gt;Destination
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;--          |          |   |  (PUMP)  |   |          |              
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;--          &amp;#39;----------&amp;#39;   &amp;#39;----------&amp;#39;   &amp;#39;----------&amp;#39;               
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;-- STREAM (in-application): a continuously updated entity that you can SELECT from and INSERT into like a TABLE
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;-- PUMP: an entity used to continuously &amp;#39;SELECT ... FROM&amp;#39; a source STREAM, and INSERT SQL results into an output STREAM
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;-- Create output stream, which can be used to send to a destination
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;-- reference: 
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;-- https://docs.aws.amazon.com/zh_cn/kinesisanalytics/latest/sqlref/analytics-sql-reference.html
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;-- https://docs.aws.amazon.com/zh_cn/kinesisanalytics/latest/dev/streaming-sql-concepts.html
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;-- https://docs.aws.amazon.com/zh_cn/kinesisanalytics/latest/sqlref/kinesis-analytics-sqlref.pdf
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;-- abnormality event stream
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;CREATE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;OR&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;REPLACE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;STREAM&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;DESTINATION_SQL_STREAM&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; 
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;(&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;eventId&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;       &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;varchar&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;64&lt;/span&gt;),&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;action&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;varchar&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;256&lt;/span&gt;),&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;varchar&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;64&lt;/span&gt;),&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;objectId&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;varchar&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;64&lt;/span&gt;),&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;bizId&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;         &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;varchar&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;64&lt;/span&gt;),&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;errorMsg&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;varchar&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1024&lt;/span&gt;),&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;createdAt&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;varchar&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;32&lt;/span&gt;)&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;);&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;-- Filter errorMsg like panic/error pump
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;CREATE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;OR&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;REPLACE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;PUMP&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;ERROR_PANIC_STREAM_PUMP&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;AS&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;INSERT&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;INTO&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;DESTINATION_SQL_STREAM&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;SELECT&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;STREAM&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;eventId&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;action&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;objectId&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;bizId&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;errorMsg&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;createdAt&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;FROM&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;SOURCE_SQL_STREAM_001&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;WHERE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;errorMsg&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;LIKE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;%[PANIC]%&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;or&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;errorMsg&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;LIKE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;%[panic]%&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; 
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;or&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;errorMsg&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;LIKE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;%[ERROR]%&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; 
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;or&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;errorMsg&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;LIKE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;%[error]%&amp;#39;&lt;/span&gt;;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;æ¯1åˆ†é’Ÿwarnæ•°ç›®è¶…è¿‡10æ¬¡çš„SQL(æ»šåŠ¨çª—å£)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-sql&#34; data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color:#00a&#34;&gt;CREATE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;OR&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;REPLACE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;STREAM&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;DESTINATION_SQL_STREAM&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; 
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;(&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;eventId&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;       &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;varchar&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;64&lt;/span&gt;),&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;action&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;varchar&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;256&lt;/span&gt;),&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;varchar&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;64&lt;/span&gt;),&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;objectId&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;varchar&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;64&lt;/span&gt;),&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;bizId&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;         &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;varchar&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;64&lt;/span&gt;),&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;errorMsg&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;varchar&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;1024&lt;/span&gt;),&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;createAt&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;varchar&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;32&lt;/span&gt;),&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;INGREST_ROW_TIME&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;varchar&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;32&lt;/span&gt;),&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;APPROXIMATE_ARRIVAL_TIME&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;      &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;varchar&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;32&lt;/span&gt;)&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;);&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;-- Filter errorMsg like warning pump
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;-- Aggregation with time window(u can use stagger windows,tumbling windows, sliding windows)
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;-- use tumbling windows for this case
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;CREATE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;OR&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;REPLACE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;PUMP&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;STREAM_PUMP&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;AS&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;INSERT&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;INTO&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;DESTINATION_SQL_STREAM&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;SELECT&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;STREAM&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;eventId&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;userId&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;objectId&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;bizId&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;createAt&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;errorMsg&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;action&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;        &lt;/span&gt;STEP(&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;SOURCE_SQL_STREAM_001&amp;#34;&lt;/span&gt;.ROWTIME&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;BY&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;INTERVAL&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;60&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;SECOND&lt;/span&gt;)&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;AS&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;INGREST_ROW_TIME&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;        &lt;/span&gt;STEP(&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;SOURCE_SQL_STREAM_001&amp;#34;&lt;/span&gt;.APPROXIMATE_ARRIVAL_TIME&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;BY&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;INTERVAL&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;60&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;SECOND&lt;/span&gt;)&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;AS&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;APPROXIMATE_ARRIVAL_TIME&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;-- STEP(&amp;#34;SOURCE_SQL_STREAM_001&amp;#34;.EVENT_TIME BY INTERVAL &amp;#39;60&amp;#39; SECOND) AS &amp;#34;EVENT_TIME&amp;#34;,
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;COUNT&lt;/span&gt;(*)&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;AS&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;action_warn_count&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;FROM&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;SOURCE_SQL_STREAM_001&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;WHERE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;errorMsg&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;LIKE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;% WARNNING %&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;or&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;errorMsg&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;LIKE&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;% warnning %&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;GROUP&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;BY&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;action&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;        &lt;/span&gt;STEP(&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;SOURCE_SQL_STREAM_001&amp;#34;&lt;/span&gt;.ROWTIME&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;BY&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;INTERVAL&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;60&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;SECOND&lt;/span&gt;),&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;        &lt;/span&gt;STEP(&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;SOURCE_SQL_STREAM_001&amp;#34;&lt;/span&gt;.APPROXIMATE_ARRIVAL_TIME&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;BY&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#0aa&#34;&gt;INTERVAL&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;60&amp;#39;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;SECOND&lt;/span&gt;)&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;        &lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;-- STEP(&amp;#34;SOURCE_SQL_STREAM_001&amp;#34;.EVENT_TIME BY INTERVAL &amp;#39;60&amp;#39; SECOND) 
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt;    &lt;/span&gt;&lt;span style=&#34;color:#00a&#34;&gt;Having&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;action_warn_count&amp;#34;&lt;/span&gt;&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&amp;gt;=&lt;span style=&#34;color:#bbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;;&lt;span style=&#34;color:#bbb&#34;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;æœåŠ¡æ„å»º&#34;&gt;æœåŠ¡æ„å»º&lt;/h2&gt;
&lt;p&gt;åŸºäºä»¥ä¸ŠæœåŠ¡æ­å»ºï¼Œéœ€è¦ç”¨æˆ·å»awsäº‘å¹³å°ä¸Šç‚¹å‡»ï¼Œé…ç½®ä½¿ç”¨ï¼Œ ç‰¹åˆ«æ˜¯æ„å»ºè¡¨ï¼Œä»¥åŠæ•°æ®ä¼ è¾“ï¼Œå±æ€§å’Œå®‰å…¨è®¿é—®æƒé™è§’è‰²çš„ç®¡ç†ï¼Œéšç€ä¸šåŠ¡å¤æ‚åº¦å˜é«˜ï¼ŒåŸºç¡€æœåŠ¡ä¹Ÿéšä¹‹å¢å¤šï¼Œå¯é…ç½®åŒ–çš„ä¸œè¥¿è¶Šæ¥è¶Šå¤šï¼Œä¼šå¸¦æ¥ç¾éš¾æ€§çš„åæœï¼Œæœ€ç»ˆå˜å¾—ä¸å¯æ§ï¼ŒäººåŠ›ç®¡ç†è¿ç»´æˆæœ¬å¢åŠ ï¼›awså¹³å°æä¾›äº†AWS CloudFormation å…è®¸æ‚¨é€šè¿‡å°†åŸºç¡€è®¾æ–½è§†ä¸ºä»£ç æ¥å»ºæ¨¡ã€é¢„ç½®å’Œç®¡ç† AWS å’Œç¬¬ä¸‰æ–¹èµ„æºã€‚å³IaCï¼Œä¹Ÿæ˜¯Devopsç»å¸¸æ‰€åšçš„äº‹æƒ…ï¼Œå¯ä»¥ä½¿ç”¨ç›¸å…³IaCå·¥å…·æ¥è‡ªåŠ¨åŒ–æ„å»ºä¸€ä¸ªç³»ç»Ÿï¼Œå¸¸ç”¨çš„åœºæ™¯æ˜¯CI/CDæ”¯æŒå¿«é€Ÿå˜åŒ–çš„ä¸šåŠ¡éœ€æ±‚å¼€å‘ï¼›AWSä¸€ç›´æä¾›åŸºç¡€æœåŠ¡çš„é…ç½®APIï¼Œæœ‰ç›¸å…³çš„SDKå¯ä¾›ä½¿ç”¨ï¼Œä¹Ÿæœ‰&lt;code&gt;aws&lt;/code&gt; å·¥å…·æ¥æ“ä½œè¿™äº›åŸºç¡€æœåŠ¡èµ„æºï¼› åé¢æä¾›äº†ä¸€ç§å¼€æºè½¯ä»¶å¼€å‘æ¡†æ¶AWS Cloud Development Kit (AWS &lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/cdk/v2/guide/home.html&#34;&gt;CDK&lt;/a&gt;)ï¼Œå¯ä½¿ç”¨ç†Ÿæ‚‰çš„ç¼–ç¨‹è¯­è¨€æ¥å®šä¹‰äº‘åº”ç”¨ç¨‹åºèµ„æºï¼›å°†äº‘ä¸Šç¡¬ä»¶èµ„æºå¯ç¼–ç¨‹åŒ–ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°è‡ªåŠ¨åŒ–è¿ç»´ç®¡ç†ï¼Œå……åˆ†åˆ©ç”¨äº‘ä¸Šçš„èµ„æºæ¥ç»„è£…constructæˆä¸€ä¸ªæ¨¡å—æ ˆstack, å„ä¸ªæ¨¡å—æ ˆæœ€ç»ˆåˆæˆä¸€ä¸ªè½åœ°è§£å†³æ–¹æ¡ˆï¼Œæ–¹ä¾¿å¼€ç®±å³ç”¨(å®‰è£…è½¯ä»¶ä¸€æ ·)ï¼Œé™ä½äº‘æ„å»ºçš„å¤æ‚æ€§ï¼›cdk constructåˆ†3ä¸ªå±‚æ¬¡çš„å°è£…ï¼ŒL1æ˜¯æœ€ä½çº§åˆ«åˆå§‹å°è£…ï¼Œç›´æ¥å¯¹åº”CloudFormationé…ç½®æ¨¡ç‰ˆæ–‡ä»¶æ˜ å°„ï¼Œç§°ä¹‹ä¸ºCFN èµ„æºï¼Œå¿…é¡»é…ç½®æ¯ä¸€é¡¹å±æ€§ï¼Œéœ€è¦æ·±å…¥äº†è§£èµ„æºæ¨¡å‹çš„è¯¦ç»†ä¿¡æ¯ï¼›L2æ˜¯æ˜¯å¯¹äº†L1çš„ç»„åˆå°è£…ï¼Œä½¿ç”¨èµ„æºå±æ€§é»˜è®¤å€¼ï¼Œæ¯”å¦‚new VPCï¼›L3åˆ™æ˜¯ä¸€ç§æ¨¡å¼(pattern)ï¼Œé€šè¿‡å¤šç§èµ„æºç»„åˆæˆä¸€ä¸ªå¸¸è§èµ„æºæ¶æ„ï¼Œæ¯”å¦‚ new Fargateæ— æœåŠ¡åŒ–å®¹å™¨é›†ç¾¤ï¼›å…·ä½“å‚è€ƒè§ï¼š&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/cdk/v2/guide/constructs.html&#34;&gt;constructs&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡&lt;a href=&#34;https://cdkworkshop.com&#34;&gt;cdk workshop&lt;/a&gt; å¤§æ¦‚èŠ±åŠå¤©æ—¶é—´å­¦ä¹ è¿™é‡Œçš„demoå°±å¯ä»¥è¯•ç€æ­å»ºç›¸å…³çš„æœåŠ¡ï¼Œ ä¹Ÿæœ‰æ›´å¤šçš„&lt;a href=&#34;https://awesome-aws-workshops.com/&#34;&gt;awesome workshop&lt;/a&gt;å¯ä¾›å‚è€ƒå’Œå­¦ä¹ çš„ï¼Œå¹¶ä¸” &lt;a href=&#34;https://aws.amazon.com/blogs&#34;&gt;aws blog&lt;/a&gt;  &lt;a href=&#34;https://aws.amazon.com/cn/builders-library&#34;&gt;builders&#39; lib&lt;/a&gt;ä¹Ÿä¼šæœ‰å¾ˆå¤šç›¸å…³çš„è§£å†³æ–¹æ¡ˆæä¾›å­¦ä¹ ï¼›å½“ç„¶éœ€è¦å¾ˆå¥½çš„æ¶æ„awsæœåŠ¡ï¼Œéœ€è¦å¤šè½åœ°å®è·µï¼Œæ·±å…¥æœåŠ¡ç»†èŠ‚(æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£&lt;a href=&#34;https://docs.aws.amazon.com/&#34;&gt;docs&lt;/a&gt;)ï¼Œç»“åˆéœ€æ±‚ï¼Œæ‰èƒ½æ„å»ºä¸€ä¸ªç›¸å¯¹å®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼›å½“ç„¶å‰æœŸç”Ÿäº§è½åœ°éœ€è¦ä½¿ç”¨CDKæ¥è¿›è¡Œæ¶æ„æ¨ç†ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œç»“åˆä¸Šè¿°éœ€æ±‚ï¼Œä½¿ç”¨CDKæ¥æ­å»ºä¸€äº›stack, æ–¹ä¾¿æ•°æ®æµåˆ†æç®¡é“çš„ç»„è£…ï¼Œåç»­ä¹Ÿæ–¹ä¾¿ä¸å…¶ä»–contstuctsè¿›è¡Œç»„è£…ï¼›ä¸»è¦æ˜¯åˆ†ä¸ºä»¥ä¸‹stack:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;CDK-Workshop-Lambda-KDS-stack&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;p&gt;APIGateway-&amp;gt;lambda(put KDS record &amp;amp; hit counter in dynamodb)-&amp;gt;lambda(hello)  dynamotableviewer&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;DMS-KDS-stack&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;KDS-KDA-sql-Lambda-Dynamodb-stack&lt;/strong&gt;: KDS-&amp;gt;KDA-&amp;gt;lambda-&amp;gt;dynamodb dynamotableviewer&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;KDS-KDF-S3-stack&lt;/strong&gt;: KDS-&amp;gt;KDF-&amp;gt;S3&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;KDS-KDA-flink-OpenSearch-stack&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;KDS-KDA-flink-KDS-stack: eg: for near-realtime-warehouse, make a pipeline (ODS-&amp;gt;&lt;strong&gt;DWD-&amp;gt;DWM-&amp;gt;DWS&lt;/strong&gt;) sink to Redshift; like this &lt;a href=&#34;https://cloud.tencent.com/developer/article/1919594&#34;&gt;tencent news Pipeline pattern&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;KDS-KDF-Redshift-stack:&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Redshift-QuickSight-stack&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;S3-Glue-Athena-stack&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¿™é‡Œä¸»è¦éƒ¨ç½²CDK-Workshop-Lambda-KDS-stack, KDS-KDA-sql-Lambda-Dynamodb-stack å’ŒKDS-KDF-S3-stack æ­å»ºSQLæµå¼å¤„ç†ç”¨æˆ·è¡Œä¸ºæ•°æ®,å…·ä½“è§&lt;a href=&#34;https://github.com/weedge/user-behavior-analytics-cdk&#34;&gt;ä»£ç &lt;/a&gt;ï¼›å…¶ä»–stackå¯ä»¥åç»­è¿›è¡Œæ‰©å±•è¿›è¡Œæ„å»ºï¼Œæ¨ç†æ•´ä½“åŸºç¡€è®¾æ–½æ¶æ„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ„å»º&#34;&gt;æ„å»º&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆéœ€è¦å®‰è£…CDK, å…·ä½“æŸ¥çœ‹&lt;a href=&#34;https://aws.amazon.com/cn/getting-started/guides/setup-cdk/&#34;&gt;å…¥é—¨æ•™ç¨‹&lt;/a&gt;ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# download code to start&lt;/span&gt;
git clone https://github.com/weedge/user-behavior-analytics-cdk.git &amp;amp;&amp;amp; &lt;span style=&#34;color:#0aa&#34;&gt;cd&lt;/span&gt; user-behavior-analytics-cdk
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# tips: cdk load cdk.json + cdk.context.json to run by js on node&lt;/span&gt;
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# list stacks&lt;/span&gt;
cdk ls
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# deploy KDS-KDA-sql-Lambda-DynamoDB-stack with KDS-KDF-S3-stack(need created kinesis data stream)&lt;/span&gt;
cdk deploy KDS-KDA-sql-Lambda-DynamoDB-stack
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# deploy CDK-Workshop-Lambda-KDS-stack for hit event stream; lambda func put record to KDS, dependcy KDS&lt;/span&gt;
cdk deploy CDK-Workshop-Lambda-KDS-stack
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;éƒ¨ç½²å®Œä¹‹åï¼Œä¼šè¾“å‡ºkinesisæ•°æ®æµçš„åç§°ä»¥åŠç”¨äºæŸ¥çœ‹æ•°æ®ç»“æœåœ°å€ï¼›&lt;/p&gt;
&lt;p&gt;å¼€å§‹å†™å…¥æµ‹è¯•æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨python3, ä½¿ç”¨pip3 å®‰è£…ä¾èµ–åŒ…&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# init python virtural env&lt;/span&gt;
python3 -m venv .venv &amp;amp;&amp;amp; &lt;span style=&#34;color:#0aa&#34;&gt;source&lt;/span&gt; .venv/bin/activate 
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# install boto3  faker&lt;/span&gt;
pip3 install boto3 faker
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# run test script, wait KDA run, put record to KDS&lt;/span&gt;
python3 src/scripts/producer-kds-test.py
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;è¿è¡Œæµ‹è¯•è„šæœ¬ï¼Œè¾“å…¥regionåœ°åŸŸåç§°,æ¯”å¦‚us-east-1, ç­‰å¾…å¯åŠ¨åï¼Œè¾“å…¥æ•°æ®æµåç§°ï¼Œå¼€å§‹å‘é€æ•°æ®ï¼›&lt;/p&gt;
&lt;p&gt;æ¯1ç§’å‘ä¸€æ¬¡æ•°æ®å†™å…¥KDSä¸­ï¼Œå‘äº†10æ¬¡å«æœ‰é”™è¯¯äº‹ä»¶ï¼Œå‘äº†10æ¬¡éšæœºäº‹ä»¶ï¼Œæ€»å…±20æ¡ï¼›&lt;/p&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥ä½¿ç”¨awsæä¾›KDSæ•°æ®ç”Ÿæˆå™¨ï¼šhttps://github.com/awslabs/amazon-kinesis-data-generator&lt;/p&gt;
&lt;p&gt;ä»åˆšæ‰éƒ¨ç½²è¾“å‡ºç»“æœåœ°å€æŸ¥çœ‹å«æœ‰é”™è¯¯çš„æ•°æ®å·²ç»æœ‰10æ¡å±•ç°å‡ºæ¥(æ•°æ®è·å–å¼å‰ç«¯æ¯éš”å‡ ç§’è½®è®­è·å–apiæ•°æ®ï¼Œå®æ—¶å±•ç°å¯é€šè¿‡&lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/apigateway/latest/developerguide/apigateway-websocket-api.html&#34;&gt;API Gateway WebSocket&lt;/a&gt; æ¥æ”¯æŒ)ï¼›å†å²æ•°æ®å¯ä»¥åœ¨KDFé…ç½®çš„S3ç›®æ ‡ä¸­ç‚¹å‡»æŸ¥çœ‹ï¼ŒåŸå§‹æ•°æ®å¯ä»¥ä¸‹è½½gzåŒ…è¿›è¡Œè§£å‹æŸ¥çœ‹;&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä½¿ç”¨æä¾›ç»™å‰ç«¯è®¿é—®çš„äº‹ä»¶api(apiåœ°å€åœ¨éƒ¨ç½²CDK-Workshop-Lambda-KDS-stackåè¾“å‡ºçš„è®¿é—®åœ°å€)æ¥å†™å…¥å¼‚å¸¸&lt;code&gt;[error]&lt;/code&gt; æ•°æ®&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;curl -XPOST -iv https://{APIGateway}.execute-api.{region}.amazonaws.com/prod/event -d &lt;span style=&#34;color:#a50&#34;&gt;&amp;#39;{&amp;#34;eventId&amp;#34;:&amp;#34;1-1-1&amp;#34;,&amp;#34;bizId&amp;#34;:&amp;#34;123123&amp;#34;,&amp;#34;objectId&amp;#34;:&amp;#34;123&amp;#34;,&amp;#34;action&amp;#34;:&amp;#34;test&amp;#34;,&amp;#34;errorMsg&amp;#34;:&amp;#34;[error]&amp;#34;,&amp;#34;userId&amp;#34;:&amp;#34;1231321&amp;#34;}&amp;#39;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é€šè¿‡åˆšæ‰éƒ¨ç½²KDS-KDA-sql-Lambda-DynamoDB-stackçš„ç»“æœåœ°å€å¯ä»¥ æŸ¥çœ‹å¼‚å¸¸æ•°æ®å·²ç»å®æ—¶å†™å…¥ã€‚&lt;/p&gt;
&lt;p&gt;æœ€åå°†éƒ¨ç½²èµ„æºæ¸…é™¤ï¼Œä¾èµ–åˆ é™¤(å’Œå¸è½½è½¯ä»¶ä¸€æ ·)ã€‚&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# destroy resources with dependent resources&lt;/span&gt;
cdk destroy KDS-KDF-S3-stack
cdk destroy KDS-KDA-sql-Lambda-DynamoDB-stack
cdk destroy CDK-Workshop-Lambda-KDS-stack
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# or cdk destroy --all&lt;/span&gt;
cdk destroy --all
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;ä»£ç ç»“æ„&#34;&gt;ä»£ç ç»“æ„&lt;/h3&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;â”œâ”€â”€ cmd                              -- golang cmd bin dir
â”œâ”€â”€ docs                             -- help doc
â”œâ”€â”€ infra                            -- infrastructures stack
â”‚Â Â  â””â”€â”€ lib                          -- cdk constuct in stack
â”œâ”€â”€ src                              -- source code to run
â”‚Â Â  â”œâ”€â”€ kinesis-analytics-pyflink    -- KDA python scripts use flink python api 
â”‚Â Â  â”œâ”€â”€ kinesis-analytics-sql        -- KDA sql
â”‚Â Â  â”œâ”€â”€ lambda                       -- js,python,golang lambda func 
â”‚Â Â  â”œâ”€â”€ redshift-sql                 -- redshift sql 
â”‚Â Â  â””â”€â”€ scripts                      -- local run test code by use aws sdk
â”œâ”€â”€ test                             -- test cdk logic
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;
&lt;p&gt;sam cli &lt;a href=&#34;https://docs.aws.amazon.com/zh_cn/serverless-application-model/latest/developerguide/serverless-sam-cli-using-invoke.html&#34;&gt;local debug lambda&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;streaming cdk: &lt;a href=&#34;https://github.com/aws-samples/streaming-solution-aws-cdk&#34;&gt;https://github.com/aws-samples/streaming-solution-aws-cdk&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;kds and msk cdk: &lt;a href=&#34;https://github.com/aws-solutions/streaming-data-solution-for-amazon-kinesis-and-amazon-msk&#34;&gt;https://github.com/aws-solutions/streaming-data-solution-for-amazon-kinesis-and-amazon-msk&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Redshift cdk : &lt;a href=&#34;https://github.com/miztiik/redshift-demo&#34;&gt;https://github.com/miztiik/redshift-demo&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Glue cdk: &lt;a href=&#34;https://github.com/aws-samples/glue-workflow-aws-cdk&#34;&gt;https://github.com/aws-samples/glue-workflow-aws-cdk&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;opensearch cdk: &lt;a href=&#34;https://www.luminis.eu/blog/cloud-en/deploying-a-secure-aws-elasticsearch-cluster-using-cdk/&#34;&gt;https://www.luminis.eu/blog/cloud-en/deploying-a-secure-aws-elasticsearch-cluster-using-cdk/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;mysql cdk: &lt;a href=&#34;https://aws.amazon.com/cn/blogs/infrastructure-and-automation/use-aws-cdk-to-initialize-amazon-rds-instances/&#34;&gt;https://aws.amazon.com/cn/blogs/infrastructure-and-automation/use-aws-cdk-to-initialize-amazon-rds-instances/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;mysql dms cdk: &lt;a href=&#34;https://aws.amazon.com/cn/blogs/database/accelerate-data-migration-using-aws-dms-and-aws-cdk/&#34;&gt;https://aws.amazon.com/cn/blogs/database/accelerate-data-migration-using-aws-dms-and-aws-cdk/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;aurora mysql dms kds opensearch cdk: &lt;a href=&#34;https://github.com/aws-samples/aws-dms-cdc-data-pipeline.git&#34;&gt;https://github.com/aws-samples/aws-dms-cdc-data-pipeline.git&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;kda-flink-py: &lt;a href=&#34;https://aws.amazon.com/cn/blogs/china/python-stream-data-processing-and-analysis-using-pyflink-in-amazon-kinesis-data-analytics/&#34;&gt;https://aws.amazon.com/cn/blogs/china/python-stream-data-processing-and-analysis-using-pyflink-in-amazon-kinesis-data-analytics/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;kda-zeppelin-flink-py: &lt;a href=&#34;https://aws.amazon.com/cn/blogs/big-data/query-your-data-streams-interactively-using-kinesis-data-analytics-studio-and-python/&#34;&gt;https://aws.amazon.com/cn/blogs/big-data/query-your-data-streams-interactively-using-kinesis-data-analytics-studio-and-python/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://docs.aws.amazon.com/pdfs/whitepapers/latest/microservices-on-aws/microservices-on-aws.pdf&#34;&gt;Implementing Microservices on AWS&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href=&#34;https://d1.awsstatic.com/whitepapers/aws-cloud-data-ingestion-patterns-practices.pdf&#34;&gt;AWS Cloud Data Ingestion Patterns and Practices&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://catalog.us-east-1.prod.workshops.aws/workshops/c342c6d1-2baf-4827-ba42-52ef9eb173f6/en-US/flink-on-kda&#34;&gt;Flink-on-KDS Workshop&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://catalog.us-east-1.prod.workshops.aws/workshops/2300137e-f2ac-4eb9-a4ac-3d25026b235f/en-US&#34;&gt;Real time streaming with kinesis Workshop&lt;/a&gt;&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>å…¨æ ˆå¼€å‘</title>
      <link>https://weedge.github.io/post/shop/</link>
      <pubDate>Sun, 02 Jan 2022 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/shop/</guid>
      
        <description>&lt;h2 id=&#34;ä»‹ç»&#34;&gt;ä»‹ç»&lt;/h2&gt;
&lt;p&gt;ä»¥å‰å·¥ä½œä¸­æœ‰è¿‡å‰ç«¯çš„å¼€å‘ç»éªŒï¼Œä½¿ç”¨åç«¯æ¨¡ç‰ˆSmarty(ä¸»è¦æ˜¯å¤–éƒ¨éœ€æ±‚ï¼Œç°åœ¨æ–°é¡¹ç›®ä¸­åº”è¯¥å¾ˆå°‘ä½¿ç”¨è¿™ä¸ªäº†)ï¼Œå‰ç«¯æ¨¡ç‰ˆMustacheï¼Œé¡µé¢ä¸­ä½¿ç”¨ js jqueryäº¤äº’é€»è¾‘ï¼Œç›´æ¥æœç”¨ä¸€äº›å¼€æºçš„UIç»„ä»¶Bootstrapï¼Œå¼€æºçš„åå°UIç³»ç»Ÿï¼Œä¸»è¦æ˜¯å»ºè®¾å†…éƒ¨åå°çš„æ—¶å€™ä½¿ç”¨ï¼Œè‡ªåŠ¨ç”ŸæˆCRUDé¡µé¢ï¼›å‰ç«¯çš„æŠ€æœ¯æ ˆæ›´æ–°è¿­ä»£ç›¸å¯¹åç«¯å¿«äº›ï¼Œé€šè¿‡ä»¥å…¨æ ˆæŠ€æœ¯æ ˆä¸ºåˆ‡å…¥ç‚¹ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„ç³»ç»Ÿï¼Œå­¦ä¹ ä¸‹æœ€æ–°æŠ€æœ¯æ ˆå·¥å…·ï¼Œä¸»è¦ç›®çš„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;æ ¹æ®éœ€æ±‚ï¼Œå®ç°ä¸€ä¸ªç®€å•åŠŸèƒ½çš„è´­ç‰©ç³»ç»Ÿï¼Œç›®çš„æ˜¯ä¸ºäº†å­¦ä¹ ts-&amp;gt;js on node.jså…¨æ ˆå¼€å‘ï¼Œäº†è§£æ•´ä½“å¼€å‘æ„å»ºå·¥å…·ï¼Œç†Ÿæ‚‰ä¸‹å·¥å…·å¼€å‘æµç¨‹ï¼Œä¸»è¦è¿˜æ˜¯äº†è§£å‰ç«¯æ¡†æ¶å·¥å…·çš„ä½¿ç”¨ï¼Œä»¥åŠç†Ÿæ‚‰é€šè¿‡jsè¿è¡Œæ—¶ç¯å¢ƒè¿è¡Œåœ¨åç«¯æœåŠ¡ä¸Šçš„åº”ç”¨å¼€å‘å·¥å…·ï¼Œä»¥ä¾¿åœ¨åç»­å¼€å‘åå°ç³»ç»Ÿçš„æ—¶å€™å¯ä»¥ç†Ÿç»ƒä½¿ç”¨è¿™äº›æŠ€æœ¯è¿›è¡Œå¼€å‘ï¼Œè¿™äº›å·¥å…·çš„è®¾è®¡æ€æƒ³å¯ä»¥å€Ÿé‰´åˆ°å…¶ä»–åç«¯ä¸šåŠ¡å¼€å‘è¯­è¨€ä¸­ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŠŸèƒ½è¦æ±‚&#34;&gt;åŠŸèƒ½è¦æ±‚&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;â½¤æˆ·å¯ä»¥æµè§ˆå•†å“ï¼Œæä¾›æŒ‰å•†å“åå­—æœç´¢åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;â½¤æˆ·å¯ä»¥ä¸‹å•è´­ä¹°æŸæ ·å•†å“ï¼ˆâ½€ä»˜è¿‡ç¨‹å¯ä»¥çœç•¥ï¼‰ï¼Œè´­ä¹°æˆåŠŸåç³»ç»Ÿéœ€è¦å¼‚æ­¥é€šçŸ¥ä¸‹æ¸¸ç³»ç»Ÿï¼ˆå¦‚ä»“åº“ ç³»ç»Ÿã€ç‰©æµç³»ç»Ÿç­‰ï¼Œä¸‹æ¸¸ç³»ç»Ÿå¯ç®€å•å®ç°ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æä¾›åå°ç®¡ç†â»šâ¾¯å½•â¼Šå•†å“ï¼ŒåŒ…æ‹¬å•†å“åç§°ã€å•†å“æè¿°ã€å•†å“ä»·æ ¼ã€åº“å­˜ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;è¦æ±‚è®°å½•â½¤æˆ·è®¿é—®â½‡å¿—ï¼Œä¾›å®¡è®¡ä½¿â½¤ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å®ç°è¦æ±‚&#34;&gt;å®ç°è¦æ±‚&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;å‰ç«¯ä½¿â½¤Vue.js + elementUIï¼Œåå°ä½¿â½¤ AdonisJS æ¡†æ¶ï¼ˆAdonisJS ç‰ˆæœ¬è¦æ±‚5.0ä»¥ä¸Šï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ•°æ®åº“ä½¿â½¤ mysqlï¼Œç»“åˆ AdonisJS çš„ ORM èƒ½â¼’ã€‚&lt;/li&gt;
&lt;li&gt;è®¾è®¡æ—¶éœ€è¦è€ƒè™‘å¿…è¦çš„ç³»ç»Ÿå®‰å…¨æ€§ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;è®¾è®¡å®ç°&#34;&gt;è®¾è®¡å®ç°&lt;/h2&gt;
&lt;h3 id=&#34;éœ€æ±‚åˆ†æ&#34;&gt;éœ€æ±‚åˆ†æ&lt;/h3&gt;
&lt;p&gt;æ•´ä½“äº¤äº’ä¸»è¦æ˜¯å®ç°è´­ä¹°ç³»ç»Ÿï¼Œä»¥åŠç”¨æˆ·è´­ä¹°å•†å“çš„è®¿é—®æ—¥å¿—ï¼Œä»¥åŠç”¨æˆ·è¡Œä¸ºæ—¥å¿—ï¼Œç»™å®¡è®¡ç³»ç»Ÿï¼Œè¿›è¡Œæ¼æ´åˆ†æç­‰ï¼Œè€ƒè™‘åˆ°å‰æœŸç”¨æˆ·æ¯”è¾ƒå°‘ï¼Œäº¤äº’ä½¿ç”¨ï¼Œ5å¤©è®¾è®¡å¼€å‘æ—¶é—´ï¼Œå…ˆæä¾›v1ç®€å•ç‰ˆæœ¬ï¼Œæ»¡è¶³å•†å®¶å’Œä¹°å®¶ç”¨æˆ·çš„åŸºæœ¬è´­ä¹°åŠŸèƒ½&lt;/p&gt;
&lt;p&gt;ä¹°å®¶åŸºæœ¬éœ€æ±‚ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é€šè¿‡é¡µé¢æŸ¥çœ‹ä¸Šæ¶å•†å“åˆ—è¡¨ï¼›æŸ¥çœ‹å•†å“è¯¦æƒ…é¡µï¼›é€šè¿‡å•†å“åå…³é”®å­—æœç´¢å•†å“ï¼›&lt;/li&gt;
&lt;li&gt;è´­ä¹°å•†å“ï¼ŒæŸ¥çœ‹è®¢å•(ä¸ºäº†ç®€åŒ–éœ€æ±‚ï¼Œæ— è´­ç‰©è½¦åŠŸèƒ½ï¼Œå‡è®¾ç”¨æˆ·è®¢å•åªèƒ½è´­ä¹°ä¸€ä»¶å•†å“ï¼ŒåŠç”¨æˆ·å’Œè®¢å•æ˜¯ä¸€å¯¹å¤šï¼Œè®¢å•å’Œå•†å“æ˜¯å¤šå¯¹ä¸€)ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å–å®¶åŸºæœ¬éœ€æ±‚ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åå°å½•å…¥æŸ¥çœ‹ä¿®æ”¹åˆ é™¤å•†å“(ä¸€ä¸ªç”¨æˆ·ç¼–è¾‘å¤šä¸ªå•†å“é¡¹ï¼Œä¸€ä¸ªå•†å“é¡¹ä¹Ÿå¯ä»¥ç»™å¤šä¸ªç”¨æˆ·ç¼–è¾‘ï¼ŒåŠç”¨æˆ·å’Œå•†å“æ˜¯å¤šå¯¹å¤šï¼Œä¸ºäº†ç®€å•è€ƒè™‘ï¼Œä¸è€ƒè™‘ååŒçš„æƒ…å†µ)ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åå°éœ€æ±‚ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;è®°å½•è®¿é—®æ—¥å¿—ï¼Œå®¡è®¡éœ€æ±‚ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;åŠŸèƒ½è®¾è®¡&#34;&gt;åŠŸèƒ½è®¾è®¡&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;Shop-frontend  æ•°æ®é¡µé¢å±•ç°ï¼Œæ»¡è¶³å•†å“åˆ—è¡¨å±•ç°ï¼›é€šè¿‡å•†å“åæœç´¢ï¼›è¯¦æƒ…é¡µæŸ¥çœ‹ï¼›&lt;/li&gt;
&lt;li&gt;Shop-backend  å•†å“åå°ï¼Œæä¾›http RESTful api ï¼Œæ»¡è¶³é¡µé¢éœ€æ±‚ï¼Œä»¥åŠç›¸åº”authæƒé™éªŒè¯ï¼Œæ—¥å¿—è®°å½•ï¼Œè´­ä¹°è®¢å•å‘é€ï¼›&lt;/li&gt;
&lt;li&gt;Shop-admin-frontend å•†å“æ•°æ®ç®¡ç†é¡µé¢å±•ç°ï¼Œæ“ä½œå•†å“å¢åˆ æŸ¥æ”¹åŠŸèƒ½é¡µé¢ï¼›&lt;/li&gt;
&lt;li&gt;Shop-admin-backend å•†å“æ•°æ®ç®¡ç†åå°ï¼Œæä¾›http RESTful apiï¼Œ æ»¡è¶³é¡µé¢CRUDåŠŸèƒ½ï¼›&lt;/li&gt;
&lt;li&gt;Shop-backend  è®°å½•ç”¨æˆ·è®¿é—®æ—¥å¿—ï¼Œ é€‚ç”¨pbæ ¼å¼è®°å½•æ—¥å¿—ï¼Œäº§ç”Ÿæ—¥å¿—å®æ—¶å†™å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œæä¾›ç»™å®¡è®¡ç³»ç»Ÿä½¿ç”¨&lt;/li&gt;
&lt;li&gt;å…¶ä»–æœåŠ¡ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ•´ä½“æ¶æ„è®¾è®¡å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/shop-system.drawio.png&#34; alt=&#34;simple-shop-system&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ•°æ®åº“è®¾è®¡&#34;&gt;æ•°æ®åº“è®¾è®¡&lt;/h3&gt;
&lt;p&gt;å•ç‹¬æ•°æ®åº“å®ä¾‹shop, ç®€å•å®ç°ï¼Œæœªæ ¹æ®æœªæ¥å‡ å¹´çš„æ•°æ®é‡æ¥è¯„ä¼°è¡¨çš„å®¹é‡ï¼Œåˆ†åº“åˆ†è¡¨çš„æƒ…å†µç­‰ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å•†å“è¡¨  tbl_shop_items&lt;/p&gt;
&lt;p&gt;(Tips: è¿™é‡Œä¸ºäº†ç®€åŒ–ï¼Œæ²¡æœ‰å®šä¹‰å¤æ‚ä¸šåŠ¡å®ä½“å…³ç³»äº†ï¼Œæ¯”å¦‚äº§å“å•å…ƒ(CPU), å•†å“å•å…ƒ(SKU)ï¼Œäº§å“å®¹å™¨(Container) ç­‰ï¼Œä¸è¦è„±ç¦»ä¸šåŠ¡è€æµæ°“)&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;int64&lt;/td&gt;
&lt;td&gt;å•†å“id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;name&lt;/td&gt;
&lt;td&gt;varchar(32)&lt;/td&gt;
&lt;td&gt;å•†å“åç§°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;desc&lt;/td&gt;
&lt;td&gt;varchar(1024)&lt;/td&gt;
&lt;td&gt;å•†å“æè¿°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;price&lt;/td&gt;
&lt;td&gt;unsigned int&lt;/td&gt;
&lt;td&gt;ä»·æ ¼ï¼ˆåˆ†ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;stock&lt;/td&gt;
&lt;td&gt;unsigned int&lt;/td&gt;
&lt;td&gt;åº“å­˜æ•°ç›®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;sell_cn&lt;/td&gt;
&lt;td&gt;unsigned int&lt;/td&gt;
&lt;td&gt;å”®å–æ•°ç›®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;is_released&lt;/td&gt;
&lt;td&gt;bool&lt;/td&gt;
&lt;td&gt;æ˜¯å¦ä¸Šæ¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;is_soldout&lt;/td&gt;
&lt;td&gt;bool&lt;/td&gt;
&lt;td&gt;æ˜¯å¦å”®åŒ¿&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;is_del&lt;/td&gt;
&lt;td&gt;bool&lt;/td&gt;
&lt;td&gt;æ˜¯å¦åˆ é™¤&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;owner_id&lt;/td&gt;
&lt;td&gt;unsigned int64&lt;/td&gt;
&lt;td&gt;æ·»åŠ è€…ç”¨æˆ·id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;create_at&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;update_at&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ext&lt;/td&gt;
&lt;td&gt;varchar&lt;/td&gt;
&lt;td&gt;æ‰©å±•å­—æ®µ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;ç”¨æˆ·å•†å“æ“ä½œè¡¨ tbl_user_items&lt;/li&gt;
&lt;/ol&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;unsigned int64&lt;/td&gt;
&lt;td&gt;æ“ä½œid&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;user_id&lt;/td&gt;
&lt;td&gt;unsigned int64&lt;/td&gt;
&lt;td&gt;å•†å“ç®¡ç†åå°ç”¨æˆ·id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;item_id&lt;/td&gt;
&lt;td&gt;unsigned int64&lt;/td&gt;
&lt;td&gt;å•†å“id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;create_at&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;update_at&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ext&lt;/td&gt;
&lt;td&gt;varchar&lt;/td&gt;
&lt;td&gt;æ‰©å±•å­—æ®µ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;ç”¨æˆ·è®¢å•è¡¨  tbl_user_orders ï¼ˆä¸ºäº†ç®€åŒ–ï¼Œä¸€ä¸ªç”¨æˆ·åªèƒ½é€‰ä¸€ä¸ªå•†å“ç›´æ¥ä¸‹å•è´­ä¹°ï¼Œæ— è´­ç‰©è½¦ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;user_id&lt;/td&gt;
&lt;td&gt;unsigned int64&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;item_id&lt;/td&gt;
&lt;td&gt;unsigned int64&lt;/td&gt;
&lt;td&gt;å•†å“id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;order_id&lt;/td&gt;
&lt;td&gt;unsigned int64&lt;/td&gt;
&lt;td&gt;è®¢å•id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;pay_amount&lt;/td&gt;
&lt;td&gt;unsigned int64&lt;/td&gt;
&lt;td&gt;æ”¯ä»˜é‡‘é¢&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;create_at&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;update_at&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ext&lt;/td&gt;
&lt;td&gt;varchar&lt;/td&gt;
&lt;td&gt;æ‰©å±•å­—æ®µ&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;ç”¨æˆ·è¡¨ tbl_users (users)&lt;/li&gt;
&lt;/ol&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;unsigned int64&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;name&lt;/td&gt;
&lt;td&gt;varchar&lt;/td&gt;
&lt;td&gt;ç”¨æˆ·å&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;email&lt;/td&gt;
&lt;td&gt;varchar&lt;/td&gt;
&lt;td&gt;é‚®ä»¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;password&lt;/td&gt;
&lt;td&gt;varchar&lt;/td&gt;
&lt;td&gt;åŠ å¯†å¯†ç &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;remember_me_token&lt;/td&gt;
&lt;td&gt;varchar&lt;/td&gt;
&lt;td&gt;api Opaque Access Token&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;is_admin&lt;/td&gt;
&lt;td&gt;bool&lt;/td&gt;
&lt;td&gt;æ˜¯å¦æ˜¯ç®¡ç†å‘˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;created_at&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;updated_at&lt;/td&gt;
&lt;td&gt;timestamp&lt;/td&gt;
&lt;td&gt;ä¿®æ”¹æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ERå…³ç³»ï¼š&lt;/p&gt;
&lt;p&gt;[tbl_shop_items] &amp;lt;-N&amp;mdash;1-&amp;gt; (create) [tbl_users]&lt;/p&gt;
&lt;p&gt;[tbl_shop_items] &amp;lt;-1&amp;mdash;N-&amp;gt; [tbl_user_items] (record)   &amp;lt;-M&amp;mdash;1-&amp;gt; [tbl_users]&lt;/p&gt;
&lt;p&gt;[tbl_shop_items] &amp;lt;-1&amp;mdash;N-&amp;gt; [tbl_user_orders] (order) &amp;lt;-M&amp;mdash;1-&amp;gt; [users]&lt;/p&gt;
&lt;h3 id=&#34;æ¶ˆæ¯è®¾è®¡&#34;&gt;æ¶ˆæ¯è®¾è®¡&lt;/h3&gt;
&lt;p&gt;è®¢å•ç”Ÿæˆåï¼Œé€šçŸ¥ä¸‹æ¸¸ç³»ç»Ÿï¼Œè®¢é˜…æ¶ˆæ¯ï¼Œæš‚ä¸è€ƒè™‘ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åç«¯æ¥å£è®¾è®¡&#34;&gt;åç«¯æ¥å£è®¾è®¡&lt;/h3&gt;
&lt;p&gt;å› ä¸ºé€»è¾‘ç®€å•ï¼Œå°±æ²¡æœ‰ç”»å‡ºæ¥å£åŠŸèƒ½çš„æ—¶åºå›¾å’Œæµç¨‹å›¾ã€‚&lt;/p&gt;
&lt;h4 id=&#34;shop-backend--æœåŠ¡ç«¯å£2021&#34;&gt;Shop-backend  æœåŠ¡ç«¯å£ï¼š2021&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;GET /shop/api/v1/itmes  å•†å“åˆ—è¡¨&lt;/li&gt;
&lt;li&gt;GET /shop/api/v1/items/:id å•†å“è¯¦æƒ…&lt;/li&gt;
&lt;li&gt;GET /shop/api/v1/items/search?q=** æ›´å…·åç§°æœç´¢å•†å“&lt;/li&gt;
&lt;li&gt;POST /shop/api/v1/order  å•†å“ä¸‹å•&lt;/li&gt;
&lt;li&gt;GET  /shop/api/v1/orders/:orderId  è·å–è®¢å•è¯¦æƒ…&lt;/li&gt;
&lt;li&gt;GET /shop/api/v1/users/:uid/orders ç”¨æˆ·å•†å“è®¢å•åˆ—è¡¨&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;shop-admin-backend-æœåŠ¡ç«¯å£2022&#34;&gt;Shop-admin-backend æœåŠ¡ç«¯å£ï¼š2022&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;shop items CRUD RESTful api  for resource methods (&lt;a href=&#34;https://docs.adonisjs.com/guides/controllers#resourceful-routes-and-controllers&#34;&gt;route RESTful resource&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;POST /shopadmin/api/v1/items/:id/check å•†å“å®¡æ ¸&lt;/li&gt;
&lt;li&gt;GET /shopadmin/api/v1/items/:uid  è·å–ç”¨æˆ·åˆ›å»ºçš„å•†å“&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;å‰ç«¯é¡µé¢äº¤äº’è®¾è®¡&#34;&gt;å‰ç«¯é¡µé¢äº¤äº’è®¾è®¡&lt;/h3&gt;
&lt;p&gt;å‰ç«¯é¡µé¢è°ƒè¯•ï¼Œæœ¬åœ°èµ·é¡µé¢æœåŠ¡ç«¯å£è¿›è¡Œæœ¬åœ°è°ƒè¯•&lt;/p&gt;
&lt;h4 id=&#34;shop-frontend-vue-route-component-page&#34;&gt;Shop-frontend (vue route component page)&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;/     ä¸»é¡µé¢/æœç´¢ç»“æ„é¡µï¼Œåˆ—è¡¨é¡µé¢ ï¼Œå±•ç¤ºæœç´¢æ¡†&lt;/li&gt;
&lt;li&gt;/items/:id   è¯¦ç»†é¡µé¢ï¼Œ å±•ç¤ºè´­ä¹°æŒ‰é’®&lt;/li&gt;
&lt;li&gt;/user/:id/orders ç”¨æˆ·å•†å“è®¢å•åˆ—è¡¨é¡µé¢&lt;/li&gt;
&lt;li&gt;/error  è®¿é—®ä¸åˆ°çš„é¡µé¢&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;shop-admin-frontend-crud-edge-template-layout-page&#34;&gt;Shop-admin-frontend (CRUD edge template layout page)&lt;/h4&gt;
&lt;p&gt;CRUD RESTful api  for resource methods to render edge page&lt;/p&gt;
&lt;h2 id=&#34;å¼€å‘&#34;&gt;å¼€å‘&lt;/h2&gt;
&lt;p&gt;åˆæœŸæ•´ä½“ä½¿ç”¨å‰ç«¯jså…¨æ ˆå¼€å‘æŠ€æœ¯æ ˆï¼›Typescript é™æ€è¯­è¨€ï¼Œé€šè¿‡ tsc å°†tsç¼–è¯‘æˆjs å‡å°‘é”™è¯¯ï¼›é€šè¿‡npmç®¡ç†ä¾èµ–åŒ…(vim vundle/python pip/php composer/go module/rust cargo)ï¼›ä½¿ç”¨VS Code IDEå¼€å‘ç¥å™¨ç¼–ç (All in ONEï¼Œå¯è¿œç¨‹sshè¿æ¥å®‰è£…äº†linux å†…æ ¸è™šæ‹ŸæœåŠ¡è°ƒè¯•å­¦ä¹ ï¼ŒæŸ¥çœ‹æºç å¾ˆæ–¹ä¾¿)ï¼Œå®‰è£…æ‰€éœ€æ’ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“å¼€å‘å·¥å…·å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;Typescript ç¼–ç¨‹è¯­è¨€(JavaScriptè¶…çº§ tsc 4.5.4 ts-&amp;gt;js) + Node.js è¿è¡Œæ—¶ç¯å¢ƒ(v17.2 V8 JavaScript å¼•æ“ from Google Chrome çš„å†…æ ¸) + Adonis.js MVCåç«¯æ¡†æ¶(v5.0+) + Vue.jså‰ç«¯æ¡†æ¶(v3.0+)  + Element-plus UI å‰ç«¯é¡µé¢UIæ¨¡ç‰ˆ(v1.3)&lt;/p&gt;
&lt;p&gt;tipsï¼šä¸šåŠ¡æ¨¡å—è®¾è®¡å°½é‡æ»¡è¶³SOLIDåŸåˆ™ï¼Œæœ€ç»ˆæ»¡è¶³&lt;strong&gt;é«˜å†…èšï¼Œä½è€¦åˆ&lt;/strong&gt;, å°½é‡è®©å¼€å‘æ¡†æ¶æ¥æ»¡è¶³ã€‚&lt;/p&gt;
&lt;h3 id=&#34;åç«¯æœåŠ¡å¼€å‘&#34;&gt;åç«¯æœåŠ¡å¼€å‘&lt;/h3&gt;
&lt;p&gt;shop-backend, shop-admin-backend æœåŠ¡é€»è¾‘ï¼Œ ä½¿ç”¨tsè¯­è¨€ï¼ŒAdonisJS (MVC+IoCå¼€å‘æ¡†æ¶,é€‚åˆåå°å¼€å‘æ¡†æ¶) 5.0+å¼€å‘ç¯å¢ƒï¼š&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.adonisjs.com/guides/database/introduction&#34;&gt;Model&lt;/a&gt;: app ER(entity relationship) data model -&amp;gt; table schema by migration -&amp;gt; create table -&amp;gt; make  table model&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.adonisjs.com/guides/controllers&#34;&gt;Controller&lt;/a&gt;: make controller for api logic&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.adonisjs.com/guides/routing&#34;&gt;Routing&lt;/a&gt;: http RESTful api router (start preload routes)&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.adonisjs.com/guides/views/introduction&#34;&gt;View&lt;/a&gt;: view  edge template reander frontend page&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.adonisjs.com/guides/validator/introduction&#34;&gt;Validator&lt;/a&gt;: validate data schema&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.adonisjs.com/guides/validator/custom-rules&#34;&gt;Rules&lt;/a&gt;: validate rules(common &amp;amp; DIY  start preload rules)&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.adonisjs.com/guides/middleware&#34;&gt;Middleware&lt;/a&gt;:  Middleware are a series of functions that are executed during an HTTP request before it reaches the route handler. Every function in the chain has the ability to end the request or forward it to the &lt;code&gt;next&lt;/code&gt; function. &lt;strong&gt;&lt;del&gt;server&lt;/del&gt;&lt;/strong&gt; Middleware, &lt;strong&gt;Global&lt;/strong&gt; Middleware, &lt;strong&gt;Naming&lt;/strong&gt; Middleware&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.adonisjs.com/guides/auth/introduction&#34;&gt;Authentication&lt;/a&gt;: using &lt;strong&gt;sessions&lt;/strong&gt;, &lt;strong&gt;basic auth&lt;/strong&gt; or &lt;strong&gt;API tokens(JWT, OAT)&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://docs.adonisjs.com/guides/events&#34;&gt;Events&lt;/a&gt;: define evens listener  to listen async event on(eventName,callback) , then emit event to tigger regist event&amp;rsquo;s callback; eg: new user to emit event callback to send email (DIY events Listenner, start preload events)&lt;/p&gt;
&lt;p&gt;é€šè¿‡adonis-ts-app demo åˆå§‹åŒ–ä¸€ä¸ªapp:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#new project&lt;/span&gt;
npm init adonis-ts-app@latest shop-backend
npm init adonis-ts-app@latest shop-admin-backend
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#install package for mysql &lt;/span&gt;
npm i @adonisjs/lucid@alpha
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#invoke package to select mysql for ace make:model and migration table&lt;/span&gt;
node ace configure(invoke) @adonisjs/lucid
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#install mysql2&lt;/span&gt;
npm install mysql2
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#modify config/database.ts use mysql client: mysql2&lt;/span&gt;

&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#install auth middleware&lt;/span&gt;
npm i @adonisjs/auth@alpha
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#install Argon2 password hashing algorithm following the PHC string format&lt;/span&gt;
npm install phc-argon2
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#invoke package to select lucid and api tokens&lt;/span&gt;
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# https://docs.adonisjs.com/guides/auth/introduction&lt;/span&gt;
node ace invoke @adonisjs/auth
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# rigister auth naming middleware in start/kernel.js  auth: &amp;#39;App/Middleware/Auth&amp;#39;,&lt;/span&gt;
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# add auth middleware for router in start/router.js  &lt;/span&gt;
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# use database-backed opaque access token&lt;/span&gt;
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# demo: https://dev.to/tngeene/adonisjs-understanding-user-registration-and-authentication-2ojl&lt;/span&gt;
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# for session auth&lt;/span&gt;
npm i @adonisjs/session 
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# for CSRF token protection&lt;/span&gt;
npm i @adonisjs/shield 
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#invoke add fhield global middleware in start/kernel.js () =&amp;gt; import(&amp;#39;@ioc:Adonis/Addons/Shield&amp;#39;)&lt;/span&gt;
node ace invoke @adonisjs/shield

&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#change .env modify mysql conf&lt;/span&gt;
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#migration table&lt;/span&gt;
node ace make:migration {table}
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#migration create/rollback table&lt;/span&gt;
node ace migration:run / node ace migration:rollback

&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#then u can use ace to make a new model app/Models/***.ts&lt;/span&gt;
node ace make:model ***
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#then u can use ace to make a new app/Controllers/Http/***Controller.ts&lt;/span&gt;
node ace make:controller ***
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#if use edge tpl, u can use ace to make a new view to render tpl&lt;/span&gt;
node ace make:view ***
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#if valide request param, u can use ace to make a new volidator&lt;/span&gt;
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#https://docs.adonisjs.com/guides/validator/introduction&lt;/span&gt;
node ace make:validator ***
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#or diy validate rules&lt;/span&gt;
node ace make:prldfile validator

&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#make events to gen start/events.ts for listen on(eventName,callback)&lt;/span&gt;
node ace make:prldfile events
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#or make listener to listen on eventsList &lt;/span&gt;
node ace make:listener ***


&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#make a middleware like auth middleware;&lt;/span&gt;
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#transmit by ctx, ctx-&amp;gt;ctx-&amp;gt;ctx to next()&lt;/span&gt;
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#eg: u can make a user action log middleware to analyse or A/B test for recommended system&lt;/span&gt;
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#https://docs.adonisjs.com/guides/middleware&lt;/span&gt;
node ace make:middleware ***

&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# https://github.com/luin/ioredis/blob/master/API.md&lt;/span&gt;
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# https://docs.adonisjs.com/guides/redis&lt;/span&gt;
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#install redis&lt;/span&gt;
npm i @adonisjs/redis
node ace configure @adonisjs/redis

&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# https://www.npmjs.com/package/@elastic/elasticsearch&lt;/span&gt;
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# https://www.elastic.co/guide/en/elasticsearch/client/javascript-api/current/typescript.html&lt;/span&gt;
npm i @elastic/elasticsearch


&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# watch run &lt;/span&gt;
node ace serve --watch
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;å‰ç«¯å¼€å‘&#34;&gt;å‰ç«¯å¼€å‘&lt;/h3&gt;
&lt;p&gt;Shop-frontend, shop-admin-frontend å‰ç«¯é¡µé¢é€»è¾‘ï¼Œä½¿ç”¨TypeScript+ Vue.js(å‰ç«¯å¼€å‘æ¡†æ¶) + ElementUIç»„ä»¶ é€šè¿‡viteæ„å»ºæœ¬åœ°å¼€å‘(CIè¿‡ç¨‹é€šè¿‡webpackæ‰“åŒ…ç”Ÿæˆé™æ€èµ„æºï¼Œé€šè¿‡CDéƒ¨ç½²åˆ°è¾¹ç¼˜CDNèŠ‚ç‚¹)ï¼Œå¼€å‘ç¯å¢ƒå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;Vue.js 3 + TypeScript + Vite + ElementUI-plus&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://next.router.vuejs.org/zh/&#34;&gt;vue router&lt;/a&gt;: é€šè¿‡ Vue.jsï¼Œç”¨ç»„ä»¶ç»„æˆåº”ç”¨ï¼›é€šè¿‡ Vue Router å°†ç»„ä»¶æ˜ å°„åˆ°è·¯ç”±ä¸Šï¼Œè®© Vue Router çŸ¥é“åœ¨å“ªé‡Œæ¸²æŸ“å®ƒä»¬;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://axios-http.com/zh/docs/intro&#34;&gt;axios&lt;/a&gt;: HTTP ç½‘ç»œclientè¯·æ±‚åº“;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://next.vuex.vuejs.org/zh/index.html&#34;&gt;vuex&lt;/a&gt;: state management pattern + library stat/view/actions like MVC;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://vee-validate.logaretm.com/v4/guide/overview&#34;&gt;vee-validate&lt;/a&gt;: form validation;  &lt;a href=&#34;https://www.npmjs.com/package/yup&#34;&gt;yup&lt;/a&gt;:  data schema validation;&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# install vue cli&lt;/span&gt;
npm install -g @vue/cli
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# u can use vue create app use vue.js v3&lt;/span&gt;
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# vue create vue-app &amp;amp; cd vue-app&lt;/span&gt;
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# vue add element-plus&lt;/span&gt;

&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# or use vite build vue.js v3 project app&lt;/span&gt;
npm init @vitejs/app shop-frontend 
npm init @vitejs/app shop-admin-frontend

&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# eg: shop-frontend&lt;/span&gt;
&lt;span style=&#34;color:#0aa&#34;&gt;cd&lt;/span&gt; shop-frontend (shop-admin-frontend)
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# choose vue-ts when install&lt;/span&gt;
npm install

&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# install vue-router4, https://next.router.vuejs.org/zh/&lt;/span&gt;
npm install vue-router@4

&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# install axios https://axios-http.com/zh/docs/intro&lt;/span&gt;
npm install axios

&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# install vuex, nice design(state management pattern + library stat/view/actions like MVC)  &lt;/span&gt;
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# https://next.vuex.vuejs.org/zh/index.html&lt;/span&gt;
npm install vuex@next --save

&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# install vee-validate, https://vee-validate.logaretm.com/v4/guide/overview&lt;/span&gt;
npm i vee-validate@next --save


&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#install element-plus ui&lt;/span&gt;
npm install element-plus --save
npm i -D sass
&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;#auto import &lt;/span&gt;
npm install -D unplugin-vue-components unplugin-auto-import

&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;# run local vue dev runtime app service (vite --port 5000 --host)&lt;/span&gt;
npm run dev

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;é™„å…·ä½“ä»£ç (Monolithç‰ˆæœ¬, åç«¯çŠ¶æ€å­˜å‚¨æ•°æ®è¯»å†™ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®æº)ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/weedge/backend-adonisjs-api/tree/main/shop-admin-backend&#34;&gt;Shop-admin-backend&lt;/a&gt; : åå°ç®¡ç†ç³»ç»Ÿï¼Œä¸ºäº†æ–¹ä¾¿åç»­æ ¹æ®æ•°æ®åº“è¡¨ä¸€é”®ç”ŸæˆCURDä»£ç ï¼Œé‡‡ç”¨åç«¯æ¨¡ç‰ˆedge templateï¼›ç”¨æˆ·ç®¡ç†å¯ä»¥é‡‡ç”¨å†…éƒ¨å…¬å¸ç”¨æˆ·å¹³å°SSOå•ç‚¹ç™»å½•è·å–ticketçš„æ–¹å¼ï¼Œæˆ–è€…ä½¿ç”¨æ¡†æ¶æœ¬èº«çš„èº«ä»½è®¤è¯åŠŸèƒ½è¿›è¡Œåå°æ¨¡å—çš„æƒé™ç®¡ç†(web authentication)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/weedge/backend-adonisjs-api/tree/main/adonisjs-shop-backend-api&#34;&gt;Shop-backend-api&lt;/a&gt;ï¼šåç«¯æ¥å£ï¼Œè·å–æ¥å£æ•°æ®ï¼Œéœ€è¦ç™»å½•éªŒè¯ï¼Œå’Œtokené‰´æƒï¼Œè®°å½•ç”¨æˆ·è¡Œä¸ºæ—¥å¿—ï¼Œè¯»å†™æ“ä½œæ•°æ®åº“å’Œç¼“å­˜ç­‰ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/weedge/frontend-vue/tree/main/vue-shop-frontend&#34;&gt;Shop-frontend-vue&lt;/a&gt;ï¼šå‰ç«¯é¡µé¢ï¼Œä½¿ç”¨vueæ¡†æ¶å¼€å‘ï¼Œè®¿é—®åç«¯APIä½¿ç”¨axiosï¼ŒçŠ¶æ€ç®¡ç†ä½¿ç”¨vuexï¼Œé¡µé¢è·¯ç”±ä½¿vue-routerï¼Œè¡¨å•éªŒè¯å’Œæ•°æ®éªŒè¯åˆ†åˆ«ä½¿ç”¨vee-valdateå’Œyupï¼Œç»„ä»¶çš„ä½¿ç”¨éœ€è¦ç»“åˆæ–‡æ¡£ä½¿ç”¨ï¼›é¦–é¡µ/æœç´¢ç»“æœé¡µå±•ç¤ºå•†å“åˆ—è¡¨ï¼Œç‚¹å‡»æ›´å¤šè¿›å…¥å•†å“è¯¦ç»†é¡µé¢è¿›è¡Œè´­ä¹°ï¼Œè´­ä¹°éœ€è¦ç™»å½•/æ³¨å†Œï¼Œç™»å½•åè¿›å…¥è®¢å•åˆ—è¡¨é¡µï¼Œå…·ä½“éœ€æ±‚æ¨åŠ¨ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;æ•´ä½“è”è°ƒ&#34;&gt;æ•´ä½“è”è°ƒ&lt;/h3&gt;
&lt;p&gt;è¿™é‡Œå‰åç«¯ç»Ÿä¸€æŠ€æœ¯æ ˆé‡‡ç”¨js on node  by (AdonisJS 5 + Vue 3 + Element-plus UI)ï¼Œ å¦‚æœç†Ÿæ‚‰node js  å¾ˆæ–¹ä¾¿è°ƒè¯•ï¼Œå¼€å‘1äººå·¥å…¨æ ˆæå®šå°±è¡Œï¼Œè‡³äºå¤–éƒ¨éœ€æ±‚UIçš„è°ƒæ•´ç¾åŒ–ç”±PMå’Œè®¾è®¡å¸ˆç¡®å®šå¥½ï¼Œå°½é‡é€šè¿‡å·¥å…·è‡ªåŠ¨åŒ–ï¼Œ é™ä½æ²Ÿé€šæˆæœ¬ï¼›&lt;/p&gt;
&lt;p&gt;å½“ç„¶å½“åç»­ç³»ç»Ÿåˆ‡æˆå¾®æœåŠ¡ï¼ŒæŠŠ1äººå·¥å…¨æ ˆçš„æ´»åˆ†æˆå¤šä¸ªäººæ¥ç»´æŠ¤ï¼Œä»å…¬å¸å’Œç»„ç»‡æ¶æ„å±‚é¢æ¥è¯´ï¼Œè™½ç„¶å¢åŠ äº†å¼€å‘æ²Ÿé€šæˆæœ¬ï¼Œä½†æ˜¯å¯¹å…¬å¸æ¥è¯´æ˜¯æœ‰åˆ©çš„ï¼Œäººå‘˜ç¦»èŒå¯¹ç³»ç»Ÿå½±å“ä¼šé™ä½å¾ˆå¤šå§(from: éƒ­è€å¸ˆçš„æ¶æ„è¯¾,ä»¥å¿ƒç†å­¦+è®¤çŸ¥ç­‰æ–¹é¢)ï¼›&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;å‰ç«¯çš„æŠ€æœ¯è¿­ä»£é€Ÿåº¦æ˜¯å¿«äºåç«¯çš„ï¼Œä¸»è¦æ˜¯å‰ç«¯æœ‰å¤§é‡çš„éœ€æ±‚å¼€å‘ï¼Œä¸ç®¡æ˜¯å¤–éƒ¨ä¸šåŠ¡è¿˜æ˜¯å†…éƒ¨éœ€æ±‚å¼€å‘ï¼Œæ‰€ä»¥éœ€è¦æ»¡è¶³ä¸šåŠ¡åœºæ™¯ä¸‹çš„é«˜æ•ˆè¿­ä»£é€Ÿåº¦ï¼Œè¡ç”Ÿå‡ºé«˜æ•ˆçš„å¼€å‘æ¡†æ¶å·¥å…·å’ŒUIç»„ä»¶å¤ç”¨ï¼ŒåŒæ—¶éœ€è¦ä¿æŒå·¥å…·åœ¨é¡¹ç›®ä¸­çš„è¿­ä»£å‡çº§ï¼Œè€Œä¸”åœ¨åŸºäºå‰ç«¯æŠ€æœ¯å‘å±•è§¦åŠåˆ°åç«¯å¼€å‘ï¼Œæ¼”å˜å‡ºå‰åæŠ€æœ¯æ ˆç»Ÿä¸€çš„å…¨æ ˆå¼€å‘ï¼Œä½†æ˜¯éœ€æ±‚å¢å¤šï¼Œéœ€è¦æ›´å¤šçš„èµ„æºæ¥æ‰¿è½½ç”¨æˆ·è¯·æ±‚ï¼Œå¯¹äºåç«¯ä¸€äº›åŸºç¡€ç»„ä»¶æœåŠ¡å’Œæ€§èƒ½ä¼˜åŒ–çš„åœºæ™¯ï¼Œè¿˜æ˜¯éœ€è¦æ ¹æ®&lt;strong&gt;è¯­è¨€ç‰¹æ€§ï¼ŒäººåŠ›ï¼Œç»„ç»‡ç»“æ„&lt;/strong&gt;ç­‰å› ç´ è€ƒè™‘ï¼›å‰ç«¯æŠ€æœ¯åº•å±‚å¼•æ“å’ŒåŸç†æ€§åŸºç¡€çŸ¥è¯†æ˜¯ä¸æ˜“å˜çš„ï¼Œå¯ä»¥åœ¨å…³æ³¨å˜åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæ·±å…¥æµ…å‡ºå…±æ€§çš„åº•å±‚é€»è¾‘ï¼Œä»¥ä¸å˜åº”ä¸‡å˜ï¼›å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ï¼›(ä¸ç®¡æ˜¯å‰ç«¯/åç«¯å¼€å‘ï¼ŒDevOps, ä»¥åŠå¤§æ•°æ®å¼€å‘ï¼Œç”šè‡³AIï¼Œ&lt;strong&gt;ç†Ÿç»ƒ&lt;/strong&gt;åˆ©ç”¨å¥½å·¥å…·ï¼Œå·¥å…·æ˜¯åœ¨åº”ç”¨åœºæ™¯ä¸‹æ²‰æ·€ä¸‹æ¥çš„ï¼Œ&lt;strong&gt;ç†è§£&lt;/strong&gt;åŸºç¡€åŸç†å’Œå·¥å…·è®¾è®¡åŸç†ï¼Œç»“åˆä½¿ç”¨åœºæ™¯ï¼Œå¿«é€Ÿå®šä½(æ–‡æ¡£ï¼Œé—®é¢˜)ï¼Œè¾“å‡ºæœ€å¤§åŒ–ï¼ŒæŠ€æœ¯å·¥å…·æ²¡æœ‰é“¶å¼¹ï¼Œåº”ç”¨åœ¨é€‚ç”¨åœºæ™¯è¾¾åˆ°äº‹åŠåŠŸå€æ•ˆæœï¼Œå­¦ä¼šåœ¨å·¨äººçš„è‚©è†€ä¸Šè€ƒè™‘é—®é¢˜ï¼Œæäº‹æƒ…)ã€‚&lt;/p&gt;
&lt;h2 id=&#34;reference&#34;&gt;reference&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;ECMAScript: &lt;a href=&#34;https://tc39.es/ecma262/&#34;&gt;https://tc39.es/ecma262/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ts: &lt;a href=&#34;https://www.typescriptlang.org/&#34;&gt;https://www.typescriptlang.org/&lt;/a&gt;      &lt;a href=&#34;https://typescript.bootcss.com/&#34;&gt;https://typescript.bootcss.com/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;why-ts: &lt;a href=&#34;https://serokell.io/blog/why-typescript&#34;&gt;https://serokell.io/blog/why-typescript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Node.js: &lt;a href=&#34;http://nodejs.cn/learn&#34;&gt;http://nodejs.cn/learn&lt;/a&gt;  &lt;strong&gt;&lt;a href=&#34;https://nodejs.org/dist/latest-v17.x/docs/api/&#34;&gt;https://nodejs.org/dist/latest-v17.x/docs/api/&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;V8 JavaScript/&lt;a href=&#34;https://developer.mozilla.org/zh-CN/docs/WebAssembly/Concepts&#34;&gt;WebAssembly&lt;/a&gt; Engine: &lt;strong&gt;&lt;a href=&#34;https://chromium.googlesource.com/v8/v8.git&#34;&gt;https://chromium.googlesource.com/v8/v8.git&lt;/a&gt;&lt;/strong&gt; &lt;strong&gt;&lt;a href=&#34;https://v8.dev/docs&#34;&gt;https://v8.dev/docs&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Adonis.js5: &lt;a href=&#34;https://adonisjs.com/&#34;&gt;https://adonisjs.com/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Adonis.js5 + Edge template demo: &lt;a href=&#34;https://masteringbackend.com/posts/adonisjs-tutorial-the-ultimate-guide&#34;&gt;https://masteringbackend.com/posts/adonisjs-tutorial-the-ultimate-guide&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Adonis.js5 + Vue.js3 demo: &lt;a href=&#34;https://www.section.io/engineering-education/build-a-ticketing-app-with-adonisjs-and-vuejs/&#34;&gt;https://www.section.io/engineering-education/build-a-ticketing-app-with-adonisjs-and-vuejs/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Vue.js3: &lt;a href=&#34;https://v3.cn.vuejs.org/guide/introduction.html&#34;&gt;https://v3.cn.vuejs.org/guide/introduction.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Vite: &lt;a href=&#34;https://cn.vitejs.dev/guide/&#34;&gt;https://cn.vitejs.dev/guide/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Vue CLI: &lt;a href=&#34;https://cli.vuejs.org/zh/guide/&#34;&gt;https://cli.vuejs.org/zh/guide/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Element-Plus UI: &lt;a href=&#34;https://element-plus.gitee.io/zh-CN/guide/installation.html&#34;&gt;https://element-plus.gitee.io/zh-CN/guide/installation.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;webpack: &lt;a href=&#34;https://webpack.docschina.org/concepts/&#34;&gt;https://webpack.docschina.org/concepts/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;webå¼€å‘: &lt;strong&gt;&lt;a href=&#34;https://developer.mozilla.org/zh-CN/docs/Web&#34;&gt;https://developer.mozilla.org/zh-CN/docs/Web&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
      
    </item>
    
    <item>
      <title>CRDT</title>
      <link>https://weedge.github.io/post/crdt/</link>
      <pubDate>Tue, 28 Dec 2021 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/crdt/</guid>
      
        <description>&lt;h2 id=&#34;ä»‹ç»&#34;&gt;ä»‹ç»&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;æ— å†²çªå¤åˆ¶æ•°æ®ç±»å‹&lt;/strong&gt;(CRDT: &lt;strong&gt;conflict-free replicated data type&lt;/strong&gt;) æ˜¯ä¸€ç§ç®€åŒ–åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ç³»ç»Ÿå’Œå¤šç”¨æˆ·åº”ç”¨ç¨‹åºçš„æ•°æ®ç»“æ„ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è®¸å¤šç³»ç»Ÿä¸­ï¼ŒæŸäº›æ•°æ®çš„å‰¯æœ¬éœ€è¦å­˜å‚¨åœ¨å¤šå°è®¡ç®—æœºä¸Šã€‚æ­¤ç±»ç³»ç»Ÿçš„ç¤ºä¾‹åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨æœ¬åœ°è®¾å¤‡ä¸Šå­˜å‚¨æ•°æ®ï¼Œå¹¶ä¸”éœ€è¦å°†è¯¥æ•°æ®åŒæ­¥åˆ°å±äºåŒä¸€ç”¨æˆ·çš„å…¶ä»–è®¾å¤‡ï¼ˆåŒä¸€ç”¨æˆ·å¤šç«¯è®¾å¤‡åŒæ­¥ï¼Œä¾‹å¦‚æ—¥å†ã€ç¬”è®°ã€è”ç³»äººæˆ–æé†’ï¼‰çš„ç§»åŠ¨åº”ç”¨ç¨‹åºï¼›&lt;/li&gt;
&lt;li&gt;åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œç»´æŠ¤æ•°æ®çš„å¤šä¸ªå‰¯æœ¬ï¼ˆåœ¨åŒä¸€æ•°æ®ä¸­å¿ƒæˆ–ä¸åŒä½ç½®,ä¸€èˆ¬æ˜¯ä¸åŒæ•°æ®ä¸­å¿ƒçš„å¤šæ´»åœºæ™¯ï¼‰ï¼Œä»¥ä¾¿åœ¨æŸäº›å‰¯æœ¬ç¦»çº¿æ—¶ç³»ç»Ÿç»§ç»­æ­£å¸¸å·¥ä½œï¼›&lt;/li&gt;
&lt;li&gt;åä½œè½¯ä»¶ï¼Œä¾‹å¦‚ Google Docsã€Trelloã€Figma æˆ–è®¸å¤šå…¶ä»–è½¯ä»¶ï¼Œå…¶ä¸­å¤šä¸ªç”¨æˆ·å¯ä»¥åŒæ—¶æ›´æ”¹åŒä¸€æ–‡ä»¶æˆ–æ•°æ®ï¼›&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.microsoft.com/en-us/shows/tech-exceptions/concordant-always-know-what-to-expect-from-your-data&#34;&gt;è¾¹ç¼˜è®¡ç®—åœºæ™¯&lt;/a&gt;ï¼Œæ¯”å¦‚å¤šä¸ªæ‰‹æœº/è½¦è½½app åœ¨æ— ä¿¡å·çš„æ£®æ—ä¸­ï¼Œäº§ç”Ÿçš„æœ¬åœ°ç¦»çº¿ååŒæ•°æ®ï¼Œå¤šä¸ªè®¾å¤‡åŒæ­¥åˆ°äº‘ä¸Šå¤„ç†;&lt;/li&gt;
&lt;li&gt;å¤§è§„æ¨¡æ•°æ®å­˜å‚¨å’Œå¤„ç†ç³»ç»Ÿï¼Œå¤åˆ¶æ•°æ®ä»¥å®ç°å…¨çƒå¯æ‰©å±•æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€æœ‰æ­¤ç±»ç³»ç»Ÿéƒ½éœ€è¦å¤„ç†æ•°æ®å¯èƒ½åœ¨ä¸åŒå‰¯æœ¬ä¸ŠåŒæ—¶ä¿®æ”¹çš„äº‹å®ã€‚ä»å¹¿ä¹‰ä¸Šè®²ï¼Œæœ‰ä¸¤ç§å¯èƒ½çš„æ–¹æ³•æ¥å¤„ç†æ­¤ç±»æ•°æ®ä¿®æ”¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;å¼ºä¸€è‡´æ€§å¤åˆ¶ï¼š&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œå‰¯æœ¬ç›¸äº’åè°ƒä»¥å†³å®šä½•æ—¶ä»¥åŠå¦‚ä½•åº”ç”¨ä¿®æ”¹ã€‚è¿™ç§æ–¹æ³•æ”¯æŒå¼ºä¸€è‡´æ€§æ¨¡å‹ï¼Œä¾‹å¦‚å¯åºåˆ—åŒ–äº‹åŠ¡å’Œå¯çº¿æ€§åŒ–ã€‚ç„¶è€Œï¼Œç­‰å¾…è¿™ç§åè°ƒä¼šé™ä½è¿™äº›ç³»ç»Ÿçš„æ€§èƒ½ï¼›æ­¤å¤–ï¼ŒCAP å®šç†å‘Šè¯‰æˆ‘ä»¬ï¼Œå½“å‰¯æœ¬ä¸ç³»ç»Ÿçš„å…¶ä½™éƒ¨åˆ†æ–­å¼€è¿æ¥æ—¶ï¼ˆä¾‹å¦‚ï¼Œç”±äºç½‘ç»œåˆ†åŒºï¼Œæˆ–è€…å› ä¸ºå®ƒæ˜¯å…·æœ‰é—´æ­‡æ€§è¿æ¥çš„ç§»åŠ¨è®¾å¤‡ï¼‰ï¼Œä¸å¯èƒ½å¯¹å‰¯æœ¬è¿›è¡Œä»»ä½•æ•°æ®æ›´æ”¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¹è§‚å¤åˆ¶ï¼š&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤æ¨¡å‹ä¸­ï¼Œç”¨æˆ·å¯ä»¥ç‹¬ç«‹äºä»»ä½•å…¶ä»–å‰¯æœ¬ä¿®æ”¹ä»»ä½•å‰¯æœ¬ä¸Šçš„æ•°æ®ï¼Œå³ä½¿è¯¥å‰¯æœ¬ç¦»çº¿æˆ–ä¸å…¶ä»–å‰¯æœ¬æ–­å¼€è¿æ¥ã€‚è¿™ç§æ–¹æ³•å¯å®ç°æœ€å¤§çš„æ€§èƒ½å’Œå¯ç”¨æ€§ï¼Œä½†å½“å¤šä¸ªå®¢æˆ·ç«¯æˆ–ç”¨æˆ·åŒæ—¶ä¿®æ”¹åŒä¸€æ¡æ•°æ®æ—¶ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´å†²çªã€‚å½“å‰¯æœ¬ç›¸äº’é€šä¿¡æ—¶ï¼Œéœ€è¦è§£å†³è¿™äº›å†²çªã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ— å†²çªå¤åˆ¶æ•°æ®ç±»å‹ (CRDT) ç”¨äºå…·æœ‰ä¹è§‚å¤åˆ¶çš„ç³»ç»Ÿï¼Œå®ƒä»¬è´Ÿè´£è§£å†³å†²çªã€‚CRDT ç¡®ä¿ï¼Œæ— è®ºåœ¨ä¸åŒçš„å‰¯æœ¬ä¸Šè¿›è¡Œä»€ä¹ˆæ•°æ®ä¿®æ”¹ï¼Œæ•°æ®å§‹ç»ˆå¯ä»¥åˆå¹¶åˆ°ä¸€è‡´çš„çŠ¶æ€ã€‚æ­¤åˆå¹¶ç”± CRDT è‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€ä»»ä½•ç‰¹æ®Šçš„å†²çªè§£å†³ä»£ç æˆ–ç”¨æˆ·å¹²é¢„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;åŸç†&#34;&gt;åŸç†&lt;/h2&gt;
&lt;h2 id=&#34;å®ç°&#34;&gt;å®ç°&lt;/h2&gt;
&lt;h3 id=&#34;automergehttpsgithubcomautomergeautomerge&#34;&gt;&lt;a href=&#34;https://github.com/automerge/automerge&#34;&gt;automerge&lt;/a&gt;&lt;/h3&gt;
&lt;h3 id=&#34;yjshttpsgithubcomyjsyjs&#34;&gt;&lt;a href=&#34;https://github.com/yjs/yjs&#34;&gt;Yjs&lt;/a&gt;&lt;/h3&gt;
&lt;h3 id=&#34;redis-crdbhttpsrediscomredis-enterprisetechnologyactive-active-geo-distribution&#34;&gt;&lt;a href=&#34;https://redis.com/redis-enterprise/technology/active-active-geo-distribution/&#34;&gt;redis (CRDB)&lt;/a&gt;&lt;/h3&gt;
&lt;h2 id=&#34;references&#34;&gt;references&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Conflict-free_replicated_data_type&#34;&gt;wiki: Conflict-free replicated data type&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/alangibson/awesome-crdt#know-before-you-go&#34;&gt;awesome-crdt#know-before-you-go&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://crdt.tech/resources&#34;&gt;crdt.tech-resources&lt;/a&gt;&lt;/strong&gt; &lt;strong&gt;&lt;a href=&#34;https://crdt.tech/implementations&#34;&gt;crdt.tech-implementations&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://hal.inria.fr/hal-00932836/file/CRDTs_SSS-2011.pdf&#34;&gt;Conflict-free Replicated Data Types.pdf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://hal.inria.fr/file/index/docid/555588/filename/techreport.pdf?spm=a2c6h.12873639.0.0.a25177aaoVMJMH&amp;amp;file=techreport.pdf&#34;&gt;A comprehensive study of Convergent and Commutative Replicated Data Types.pdf&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://arxiv.org/pdf/1806.10254.pdf&#34;&gt;Conflict-free Replicated Data Types: An Overview.pdf&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.isa-afp.org/browser_info/current/AFP/CRDT/document.pdf&#34;&gt;A framework for establishing Strong Eventual Consistency for Conflict-free Replicated Data types.pdf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://arxiv.org/pdf/1608.03960.pdf&#34;&gt;A Conflict-Free Replicated JSON Datatype.pdf&lt;/a&gt;&lt;/strong&gt; &lt;a href=&#34;https://cs.paperswithcode.com/paper/a-conflict-free-replicated-json-datatype&#34;&gt;code&lt;/a&gt; &lt;a href=&#34;https://www.youtube.com/watch?v=TRvQzwDyVro&#34;&gt;vedio introduce&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=GXJ0D2tfZCM&#34;&gt;Automerge: Making Servers Optional for Real-Time Collaboration&lt;/a&gt;&lt;/strong&gt; &lt;a href=&#34;https://speakerdeck.com/ept/automerge-making-servers-optional-for-real-time-collaboration&#34;&gt;slide&lt;/a&gt; &lt;a href=&#34;https://github.com/automerge&#34;&gt;github.com/automerge&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.researchgate.net/publication/310212186_Near_Real-Time_Peer-to-Peer_Shared_Editing_on_Extensible_Data_Types&#34;&gt;Near Real-Time Peer-to-Peer Shared Editing on Extensible Data Types.pdf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.sciencedirect.com/science/article/pii/S1877050921014101&#34;&gt;Toward Fast and Reliable Active-Active Geo-Replication for a Distributed Data Caching Service in the Mobile Cloud&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://redis.com/redis-enterprise/technology/active-active-geo-distribution/&#34;&gt;redis: active-active-geo-distribution&lt;/a&gt; &lt;a href=&#34;https://docs.redis.com/latest/rs/references/developing-for-active-active/&#34;&gt;redis: Developing applications with Active-Active databases&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.riak.com/riak/kv/2.0.0/developing/data-types/?spm=a2c6h.12873639.0.0.a25177aaoVMJMH&#34;&gt;riak-kv:Data Types&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://developer.aliyun.com/article/635632&#34;&gt;é˜¿é‡Œäº‘redisï¼šCRDTâ€”â€”è§£å†³æœ€ç»ˆä¸€è‡´é—®é¢˜çš„åˆ©å™¨&lt;/a&gt;&lt;/strong&gt;  &lt;a href=&#34;https://developer.aliyun.com/article/781709?utm_content=g_1000239229&#34;&gt;å¤šä¸­å¿ƒå®¹ç¾å®è·µï¼šå¦‚ä½•å®ç°çœŸæ­£çš„å¼‚åœ°å¤šæ´»ï¼Ÿ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.51cto.com/art/202107/674513.htm&#34;&gt;åŸºäºCRDTçš„æ•°æ®æœ€ç»ˆä¸€è‡´æ€§&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://ddia.vonng.com/#/ch5?id=%E5%A4%9A%E4%B8%BB%E5%A4%8D%E5%88%B6&#34;&gt;å¤šä¸»å¤åˆ¶&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
      
    </item>
    
    <item>
      <title>pool</title>
      <link>https://weedge.github.io/post/pool/</link>
      <pubDate>Thu, 02 Dec 2021 12:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/pool/</guid>
      
        <description>&lt;h2 id=&#34;ä»‹ç»&#34;&gt;ä»‹ç»&lt;/h2&gt;
&lt;p&gt;å¹³å¸¸æƒ³åˆ°ä¸æµªè´¹èµ„æºçš„æ–¹æ³•ï¼Œæ˜¯å¯¹èµ„æºè¿›è¡Œå¤ç”¨ï¼Œå‡å°‘èµ„æºæ¶ˆè€—å’Œæµªè´¹(å°æ—¶å€™å¤§äººç»å¸¸åœ¨åƒé¥­æ—¶è¯´çš„é‚£å¥è¯)ï¼›åœ¨è®¡ç®—æœºå·¥ç¨‹é¢†åŸŸï¼Œå­˜åœ¨å¤§é‡æ¶ˆè€—èµ„æºçš„åœºæ™¯ï¼Œå¤šè·¯å¤ç”¨å’Œæ± åŒ–æ˜¯æœ€å¸¸ç”¨çš„æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µï¼›å¤šè·¯å¤ç”¨å­˜åœ¨ç³»ç»Ÿè°ƒç”¨ï¼Œç”±ç³»ç»Ÿå†…æ ¸å±‚é¢å»æ”¯æŒä¼˜åŒ–(I/Oå¤šè·¯å¤ç”¨select/poll/epoll/kqueue)ï¼Œè€Œæ± åŒ–å¯ä»¥åº”ç”¨ç”¨æˆ·ä½¿ç”¨å±‚é¢æ¥ä¼˜åŒ–ï¼›æ± åŒ–(&lt;a href=&#34;https://en.wikipedia.org/wiki/Pool_(computer_science)&#34;&gt;pool&lt;/a&gt;)æ˜¯ä¸€ç§èµ„æºå¤ç”¨ä¼˜åŒ–æŠ€æœ¯ï¼Œå‡å°‘èµ„æºå›æ”¶å¤„ç†ï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡ï¼Œèµ„æºæœ€å¥½æ˜¯å›ºå®šå¤§å°ï¼Œå¦‚æœåœ¨å¤ç”¨èµ„æºè¿‡ç¨‹ä¸­ï¼Œèµ„æºåœ¨é€æ¸å¢å¤§ï¼Œä¸€ç›´å¤ç”¨ï¼Œä¹Ÿä¼šå¯¼è‡´èµ„æºæ¶ˆè€—è¿‡å¤šï¼Œåˆ°äº†ä¸€å®šå¤§å°ä¹‹åï¼Œé€šè¿‡ç³»ç»Ÿé‡Šæ”¾æ‰ï¼›åœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™æå‰ç”³è¯·åŠ è½½å¥½èµ„æºæ”¾åˆ°æ± å­ä¸­ï¼Œè¿è¡Œæ—¶æ ¹æ®ä¸åŒçš„è°ƒåº¦ç®¡ç†èµ„æºç­–ç•¥ä»æ± å­ä¸­è·å–å‡†å¤‡å¥½çš„èµ„æºï¼Œæˆ–è€…è¿è¡Œæ—¶æ–°å»ºèµ„æºæ”¾å…¥æ± å­ä¸­ï¼Œç”¨æˆ·ç¨‹åºä¸­è¿›è¡Œè‡ªå®šä¹‰å¤„ç†æ“ä½œï¼Œæ“ä½œå®Œä¹‹åå°†èµ„æºé‡æ–°æ”¾å…¥æ± å­ä¸­å¤ç”¨ï¼Œæœ‰äº›èµ„æºå¯ä»¥åŠ¨æ€æ‰©ç¼©ï¼› èµ„æºä¸»è¦æ˜¯ç¨‹åºè¿è¡Œæ—¶å¯¹è±¡ï¼Œå½“ç„¶è¿™äº›æ“ä½œèµ„æºå®é™…éƒ½æ˜¯åˆ†é…åœ¨è™šæ‹Ÿå†…å­˜ç©ºé—´çš„å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ä¸­ï¼Œæ¯”å¦‚ï¼Œ&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E8%A1%8C%E7%A8%8B&#34;&gt;è¿›ç¨‹&lt;/a&gt;(process &lt;a href=&#34;https://en.wikipedia.org/wiki/Process_control_block&#34;&gt;PCB&lt;/a&gt; å†…æ ¸æ€)ã€&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E5%9F%B7%E8%A1%8C%E7%B7%92&#34;&gt;çº¿ç¨‹&lt;/a&gt;(thread &lt;a href=&#34;https://en.wikipedia.org/wiki/Thread_control_block&#34;&gt;TCB &lt;/a&gt; å†…æ ¸æ€)ã€&lt;a href=&#34;https://zh.wikipedia.org/zh-hans/%E5%8D%8F%E7%A8%8B&#34;&gt;åç¨‹&lt;/a&gt;(coroutine ç”¨æˆ·æ€åä½œå¼è°ƒåº¦,å°½é‡å‡å°‘å†…æ ¸è°ƒåº¦)ä¸ºè½½ä½“çš„å·¥ä½œä»»åŠ¡(work task åœ¨ç”¨æˆ·æ€åˆ†é…æ ˆç©ºé—´)ï¼›å†…å­˜å¯¹è±¡(heap object)ï¼Œé•¿é“¾æ¥(tcp connect) ç­‰ï¼›ä¸»è¦å¯¹è¿™äº›èµ„æºå¯¹è±¡è¿›è¡Œæ± åŒ–æŠ€æœ¯è¿›è¡Œä»‹ç»ï¼Œäº†è§£æ± åŒ–å¯¹åº”åœºæ™¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;å·¥ä½œä»»åŠ¡æ± worker-pool&#34;&gt;å·¥ä½œä»»åŠ¡æ± ï¼ˆworker pool)&lt;/h2&gt;
&lt;p&gt;ç¨‹åºä¸­çš„å·¥ä½œä»»åŠ¡æ˜¯ä¸€äº›è¿è¡Œé€»è¾‘ï¼Œé€šè¿‡è¿›ç¨‹ï¼Œçº¿ç¨‹ï¼Œæˆ–è€…åç¨‹ä¸ºè½½ä½“è·å–ç³»ç»Ÿèµ„æºæ¥è¿è¡Œï¼›å¦‚æœè¿è¡Œçš„èµ„æºå¯¹è±¡ç‰¹åˆ«å¤šï¼Œè¿™äº›èµ„æºå¯¹è±¡åœ¨å†…å­˜ä¸­åˆ†é…ç©ºé—´ï¼Œè¿™å°±å¯¼è‡´èµ„æºæ¶ˆè€—è¿‡å¤šï¼Œç”šè‡³å¯èƒ½å¯¼è‡´OOMï¼ŒåŒæ—¶å¤„ç†ä»»åŠ¡å®Œæˆä¹‹åï¼Œè¿™äº›èµ„æºéœ€è¦å›æ”¶ï¼Œä¹Ÿä¼šæ¶ˆè€—å¤§é‡çš„cpuæ—¶é—´ï¼›æ‰€ä»¥åœ¨è¿™äº›é«˜è€—è¿›ç¨‹/çº¿ç¨‹ï¼Œæˆ–è€…åç¨‹èµ„æºçš„å·¥ä½œä»»åŠ¡åœºæ™¯ä¸‹(æ¯”å¦‚å¤§é‡çš„è¯·æ±‚ä»»åŠ¡)ï¼Œéœ€è¦ç”¨æ± åŒ–æŠ€æœ¯è¿›è¡Œå¤ç”¨ç®¡ç†ï¼Œæé«˜åˆ©ç”¨ç‡ï¼Œå‡å°‘è¯·æ±‚è€—æ—¶ï¼›å¯¹æ­¤åˆ†åˆ«ä»‹ç»è¿›ç¨‹æ± ï¼Œçº¿ç¨‹æ± ï¼Œåç¨‹æ± ï¼Œä»¥åŠå¼€æºç»„ä»¶æœåŠ¡ä¸­çš„å®ç°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;è¿›ç¨‹æ± process-pool&#34;&gt;è¿›ç¨‹æ± (process pool)&lt;/h3&gt;
&lt;p&gt;æ—©æœŸçš„æ“ä½œç³»ç»Ÿæ˜¯ä»¥&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E8%A1%8C%E7%A8%8B&#34;&gt;è¿›ç¨‹&lt;/a&gt;ä½œä¸ºèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ¯”å¦‚æ—©æœŸlinux2.4ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œè¿›ç¨‹æ˜¯ç¨‹åºçš„åŸºæœ¬æ‰§è¡Œå®ä½“ï¼›åœ¨é¢å‘çº¿ç¨‹è®¾è®¡çš„ç³»ç»Ÿï¼ˆå¦‚å½“ä»£å¤šæ•°æ“ä½œç³»ç»Ÿã€&lt;a href=&#34;https://zh.wikipedia.org/wiki/Linux&#34;&gt;Linux&lt;/a&gt; 2.6åŠæ›´æ–°çš„ç‰ˆæœ¬ï¼‰ä¸­ï¼Œè¿›ç¨‹æœ¬èº«ä¸æ˜¯åŸºæœ¬æ‰§è¡Œå•ä½ï¼Œè€Œæ˜¯&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E5%9F%B7%E8%A1%8C%E7%B7%92&#34;&gt;çº¿ç¨‹&lt;/a&gt;çš„å®¹å™¨ï¼Œå°†èµ„æºåˆ†é…å’Œè°ƒåº¦è¿è¡Œè¿›è¡Œäº†åˆ†ç¦»è®¾è®¡ï¼›å¼•å…¥çº¿ç¨‹åï¼Œè¿›ç¨‹ä¸­å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”å…±äº«çº¿ç¨‹èµ„æºï¼›è¿™é‡Œä»‹ç»è¿›ç¨‹æ± ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä½œä¸ºè°ƒåº¦è¿è¡Œå•ä½ï¼›åœ¨ä½¿ç”¨PHPè¯­è¨€è¿›è¡ŒwebæœåŠ¡ç«¯å¼€å‘çš„æ—¶å€™ï¼Œå¸¸è§„æ“ä½œç”¨LAMP/LNMPç»„åˆï¼Œå…¶ä¸­ä½¿ç”¨Apache/Nginxä½œä¸ºwebæœåŠ¡å™¨å°†è¯·æ±‚è·¯ç”±åˆ°å¯¹åº”åç«¯æœåŠ¡æ¨¡å—å¤„ç†ï¼Œç„¶åå°†å¤„ç†çš„å“åº”ç»“æœè¿”å›ï¼›åç«¯æœåŠ¡æ¨¡å—é€šè¿‡å®ç°é€šç”¨ç½‘å…³æ¥å£åè®®(CGI)åº”ç”¨(app)è¿›ç¨‹æ¥å¤„ç†è¯·æ±‚, å¦‚æœä»…ä»…æ˜¯å•ä¸ªè¯·æ±‚å¤„ç†ä»è·¯ç”±æ¨¡å—è½¬å‘çš„è¯·æ±‚ï¼Œååé‡æ˜¯å¾ˆä½çš„(ä¸€ä¸ªè¯·æ±‚ä¸€ä¸ªè¿›ç¨‹çš„æ–¹å¼(fork-and-execæ¨¡å¼)ï¼Œå®ç°ç®€å•ï¼Œç”šè‡³å¯ä»¥ç”¨shellè„šæœ¬æ¥ä½œä¸ºCGIè¿›ç¨‹å¤„ç†ï¼Œæ—©æœŸ90å¹´ä¹‹å‰äº’è”ç½‘ç”¨æˆ·ä¸å¤š)ï¼›éšç€äº’è”ç½‘çš„å‘å±•ï¼Œfork-and-execæ¨¡å¼ï¼Œè¿›ç¨‹åˆ›å»ºå’Œæ¶ˆé™¤å¼€é”€å˜å¤§ï¼Œæˆäº†è¯Ÿç—…ï¼Œ&lt;a href=&#34;https://en.wikipedia.org/wiki/FastCGI&#34;&gt;FastCGI&lt;/a&gt;æ¥å£åè®®åœ¨90å¹´ä»£ä¸­æœŸæå‡ºæ¥ï¼ŒFastCGIæœåŠ¡å™¨ä½¿ç”¨æŒä¹…è¿›ç¨‹æ¥å¤„ç†ä¸€ç³»åˆ—è¯·æ±‚ï¼ŒåŠæ¯ä¸ªå•ç‹¬çš„ FastCGI è¿›ç¨‹å¯ä»¥åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…å¤„ç†è®¸å¤šè¯·æ±‚ï¼Œä»è€Œé¿å…æ¯ä¸ªè¯·æ±‚è¿›ç¨‹åˆ›å»ºå’Œç»ˆæ­¢çš„å¼€é”€(å¦å¤–è¿˜æœ‰SCGI,WSGIåè®®,éƒ½æ˜¯å®šä¹‰é€šç”¨çš„æ¥å£åè®®ï¼Œå°†webæœåŠ¡å™¨å’Œåº”ç”¨æœåŠ¡å™¨è¿›è¡Œè§£è€¦ï¼Œæ¯”å¦‚apache/nginxéƒ½æœ‰å¯¹åº”çš„åè®®æ¨¡å—å’Œåº”ç”¨æœåŠ¡å™¨php-fpm/uWSGI(python)ç›¸å…³æ¥å£åè®®è¿›ç¨‹è¿›è¡Œäº¤äº’ï¼Œç¼–å†™è¯­è¨€å¤§å¤šæ˜¯è§£é‡Šæ€§è¯­è¨€ï¼Œè¿›ç¨‹è¿è¡Œæ—¶åŠ¨æ€åŠ è½½è§£é‡Šæ‰§è¡Œ)ã€‚&lt;/p&gt;
&lt;h4 id=&#34;php-fpm-worker-process-pool&#34;&gt;php-fpm worker process pool&lt;/h4&gt;
&lt;p&gt;phpè§£é‡Šæ€§è¯­è¨€ä½œä¸ºåç«¯æœåŠ¡æ¨¡å—çš„å¼€å‘è¯­è¨€ï¼Œæ”¯æŒFastCGIï¼Œå¹¶ä¸”å¯¹æ”¯æŒFastCGIæ¥å£åè®®çš„è¿›ç¨‹è¿›è¡Œç®¡ç†ï¼Œé€šè¿‡SAPI(Server Application Programme Interface)æ¨¡å—ä¸­çš„FPM(FastCGI Process Manager)å®ç°ï¼›åœ¨åˆå§‹å¯åŠ¨php-fpmæ—¶ï¼Œé€šè¿‡ä¸»è¿›ç¨‹ç›‘å¬ä¸åŒæœåŠ¡ç«¯å£ï¼Œä¸åŒæœåŠ¡ç«¯å£åˆå§‹å¯¹åº”çš„FastCGIå·¥ä½œè¿›ç¨‹æ± ï¼›è¿è¡Œæ—¶ï¼Œä¸»è¿›ç¨‹(çˆ¶è¿›ç¨‹)å’Œå·¥ä½œè¿›ç¨‹(å­è¿›ç¨‹)é€šè¿‡åŒå‘ä¿¡å·ç®¡é“(pipe)è¿›è¡Œé€šä¿¡ï¼Œå®ç°ä¸»è¿›ç¨‹å¯¹å·¥ä½œè¿›ç¨‹çš„æ§åˆ¶ç®¡ç†ï¼Œä»¥åŠå·¥ä½œè¿›ç¨‹é€šè¿‡æ ‡å‡†è¾“å‡ºç®¡é“(stdout pipe)å’Œæ ‡å‡†é”™è¯¯ç®¡é“(stderr pipe)ï¼Œå°†ç»“æœå’Œé”™è¯¯è¿”å›ç»™ä¸»è¿›ç¨‹ï¼›ä¸»è¿›ç¨‹å’Œå·¥ä½œè¿›ç¨‹é€šè¿‡å…±äº«å†…å­˜çš„æ–¹å¼(å†…éƒ¨è®°åˆ†æ¿ç»“æ„scoreboard)ï¼Œå®ç°å·¥ä½œè¿›ç¨‹è¿è¡Œæ—¶çš„ç›‘æ§(å·¥ä½œè¿›ç¨‹çŠ¶æ€), ä¸»è¿›ç¨‹ä¼šå®šæ—¶è½®è®­æ£€æŸ¥å·¥ä½œè¿›ç¨‹æ•°ç›®ï¼Œæ ¹æ®è¿›ç¨‹æ± ç®¡ç†ç­–ç•¥æ¥å¤„ç†æ˜¯å¦æ‰©ç¼©å®¹ï¼Œæ£€æŸ¥å·¥ä½œè¿›ç¨‹å¤„ç†è¯·æ±‚æ˜¯å¦è¶…æ—¶ï¼Œæ•´ä½“æµç¨‹å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/fpm-worker-pool.drawio.png&#34; alt=&#34;fpm-worker-pool&#34;&gt;&lt;/p&gt;
&lt;p&gt;å…·ä½“ä»£ç è§&lt;a href=&#34;https://github.com/php/php-src/tree/master/sapi/fpm&#34;&gt;php-fpm&lt;/a&gt;ï¼›phpè¯­è¨€æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½¿ç”¨ &lt;code&gt;TSRM&lt;/code&gt; æœºåˆ¶åˆ†é…å’Œä½¿ç”¨å˜é‡æ—¶ä¼šæœ‰é¢å¤–çš„æŸè€—ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸éœ€è¦å¤šçº¿ç¨‹çš„ PHP ç¯å¢ƒï¼›è€Œä¸”å·¥ä½œè¿›ç¨‹å¤„ç†è¯·æ±‚æ—¶åŠ è½½phpè„šæœ¬è§£ææˆopcode, ç„¶åé€šè¿‡ZendVMè§£é‡Šå™¨è°ƒç”¨opcodeå¯¹åº”çš„æœºå™¨æŒ‡ä»¤ï¼Œæœ€ç»ˆå®Œæˆphpè„šæœ¬çš„è¿è¡Œï¼Œç”±äºæ¯æ¬¡å¤„ç†è¯·æ±‚éƒ½éœ€è¦è§£ææˆopcode,ä¼šæœ‰æ€§èƒ½æŸè€—ï¼Œæ‰€ä»¥å¼•å…¥opcacheæ¥ç¼“å­˜è§£æåçš„opcodeï¼›php-fpmçš„è¿è¡Œæœºåˆ¶æ˜¯é‡‡ç”¨å¤šè¿›ç¨‹æ–¹å¼æ¥å¤„ç†è¯·æ±‚ï¼Œæ¯ä¸ªwokerè¿›ç¨‹å¤„ç†è¯·æ±‚æ—¶æ‰€å å†…å­˜å¤§å°åœ¨10M+ï¼Œå¯ä»¥é€šè¿‡&lt;code&gt;ps aux | grep php | grep -v grep | grep -v master | awk &#39;{sum+=$6; cn+=1} END {print sum/cn}&#39;&lt;/code&gt;è·å–workerè¿›ç¨‹æ¶ˆè€—å†…å­˜å¹³å‡å€¼ï¼Œæ‰€ä»¥fpmå¼•å…¥å·¥ä½œè¿›ç¨‹æ± æ¥é˜²æ­¢è¿‡åº¦æ¶ˆè€—å†…å­˜ï¼Œè€Œä¸”å¯ä»¥æœç”¨å·¥ä½œè¿›ç¨‹æ¥å¤„ç†è¯·æ±‚ï¼Œå†…å­˜èµ„æºç´§çš„åœºæ™¯æ± ä¸­å¼€å¯åŠ¨æ€æ‰©ç¼©workerè¿›ç¨‹ï¼Œåä¹‹é‡‡ç”¨é™æ€æ–¹å¼æ± ä¸­ä¸€æ¬¡åˆå§‹pm.max_children è¿™ä¹ˆå¤šworkerè¿›ç¨‹ï¼Œå‡å°‘æ‰©ç¼©ç®¡ç†å¼€é”€ã€‚&lt;/p&gt;
&lt;p&gt;phpå¤šè¿›ç¨‹(è¿›ç¨‹å•ä¸ªçº¿ç¨‹)ç¼–ç¨‹ç›¸å¯¹å¤šçº¿ç¨‹(è¿›ç¨‹å¤šä¸ªçº¿ç¨‹)ç¼–ç¨‹è¦ç®€å•äº›ï¼Œå¤šçº¿ç¨‹éœ€è¦è€ƒè™‘å…±äº«æ‰€åœ¨è¿›ç¨‹èµ„æºåŒæ­¥çš„é—®é¢˜ï¼Œå¤„äºå®‰å…¨éš”ç¦»è€ƒè™‘ï¼Œè¿›ç¨‹å¤šçº¿ç¨‹ä¸­å¦‚æœæŸä¸ªçº¿ç¨‹å‡ºé”™ï¼Œæ•´ä¸ªè¿›ç¨‹å°±æŒ‚äº†ï¼Œè€Œå¤šè¿›ç¨‹èµ„æºç›¸äº’éš”ç¦»ï¼Œå¦‚æœä¸€ä¸ªè¿›ç¨‹æŒ‚äº†ï¼Œä¸å½±å“å…¶ä»–è¿›ç¨‹å¤„ç†ä»»åŠ¡ï¼›è€Œä¸”è§£é‡Šè¯­è¨€ç›¸å¯¹c/c++ç¼–è¯‘æˆæœºå™¨ç æ‰§è¡Œè¯­è¨€å¼€å‘æ•ˆç‡è¦é«˜å¾ˆå¤šï¼Œè¿è¡Œæ—¶åŠ è½½ï¼Œæ— éœ€é‡å¯æœåŠ¡(å½“ç„¶c/c++ç¼–è¯‘å‹è¯­è¨€ä¹Ÿæ”¯æŒåŠ¨æ€åº“åŠ è½½è‡³å†…å­˜æä¾›ç›¸å…³æ¥å£è°ƒç”¨ï¼Œè¿›è¡Œçƒ­åŠ è½½è€Œæ— éœ€é‡å¯æœåŠ¡ï¼Œä½†æ˜¯ä¸å¯èƒ½æ¯æ¬¡æ–°å¼€å‘ä¸€ä¸ªåŠŸèƒ½éƒ½ä»¥*.soåŠ¨æ€åº“çš„å½¢å¼æä¾›å§ï¼Œæ‰€ä»¥éœ€æ±‚æ›´æ–°è¿­ä»£å¿«çš„åœºæ™¯ï¼Œåƒæ¸¸æˆé¢†åŸŸçš„æœåŠ¡å™¨ï¼Œç½‘å…³æœåŠ¡å™¨ï¼Œç”šè‡³å¤§æ•°æ®ä»»åŠ¡ç®—å­ï¼Œå¤§å¤šéƒ½æ˜¯é€šè¿‡å¼•å…¥è§£é‡Šå‹è„šæœ¬è¯­è¨€(lua/js/perl/python/php)ç¼–å†™ä¸šåŠ¡é€»è¾‘ï¼Œè¿›è¡Œçƒ­åŠ è½½)ï¼›&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯å¤šè¿›ç¨‹æ¯•ç«Ÿæ¯”å¤šçº¿ç¨‹è¦æ¶ˆè€—æ›´å¤šçš„ç³»ç»Ÿèµ„æºï¼›è€Œä¸”å¦‚æœå­˜åœ¨å¤šè¿›ç¨‹å•çº¿ç¨‹çš„&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E4%B8%AD%E5%A4%AE%E5%A4%84%E7%90%86%E5%99%A8&#34;&gt;cpu&lt;/a&gt;åˆ‡æ¢ï¼Œæ˜¯ä»ä¸€ä¸ªè¿›ç¨‹åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œè€Œå•è¿›ç¨‹å¤šçº¿ç¨‹çš„&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E4%B8%AD%E5%A4%AE%E5%A4%84%E7%90%86%E5%99%A8&#34;&gt;cpu&lt;/a&gt;åˆ‡æ¢åˆ™åªåœ¨ä¸€ä¸ªè¿›ç¨‹å†…ï¼Œæ¯ä¸ªè¿›ç¨‹/çº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸Šä¸‹æ–‡å †æ ˆä¿å­˜ï¼Œè¿›ç¨‹é—´çš„cpuåˆ‡æ¢æ¶ˆè€—æ›´å¤§ä¸€äº›ï¼›å¤šçº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢æ¶‰åŠç¨‹åºè®¡æ•°å™¨ã€å †æ ˆæŒ‡é’ˆå’Œç¨‹åºçŠ¶æ€å­—ç­‰ä¸€ç³»åˆ—çš„å¯„å­˜å™¨ç½®æ¢ã€ç¨‹åºå †æ ˆé‡ç½®ç”šè‡³æ˜¯ CPU é«˜é€Ÿç¼“å­˜ã€TLB å¿«è¡¨çš„æ±°æ¢ï¼›è¿›ç¨‹é—´çš„ä¸Šçº¿æ–‡åˆ‡æ¢è¿˜æ¶‰åŠæ•´ä¸ªè¿›ç¨‹åœ°å€ç©ºé—´ã€‚&lt;/p&gt;
&lt;h3 id=&#34;çº¿ç¨‹æ± thread-poolhttpsenwikipediaorgwikithread_pool&#34;&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Thread_pool&#34;&gt;çº¿ç¨‹æ± (thread pool)&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦è¿è¡Œçš„æœ€å°å•å…ƒï¼Œéšç€è®¡ç®—æœº&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E4%B8%AD%E5%A4%AE%E5%A4%84%E7%90%86%E5%99%A8&#34;&gt;cpu&lt;/a&gt;æ ¸æ•°çš„å¢åŠ ï¼Œå¤šçº¿ç¨‹æŠ€æœ¯å¯ä»¥å……åˆ†åˆ©ç”¨å¤šä¸ªcpuæ ¸è¿›è¡Œå¹¶è¡Œå¤„ç†ï¼Œæé«˜ååï¼›å¯¹äºåœ¨å•cpuå•æ ¸çš„è®¡ç®—æœºä¸Šï¼Œä½¿ç”¨å¤šçº¿ç¨‹æŠ€æœ¯ï¼Œä¹Ÿå¯ä»¥æŠŠè¿›ç¨‹ä¸­è´Ÿè´£I/Oå¤„ç†ã€äººæœºäº¤äº’è€Œå¸¸è¢«é˜»å¡çš„éƒ¨åˆ†ï¼Œä¸å¯†é›†è®¡ç®—çš„éƒ¨åˆ†åˆ†å¼€æ¥æ‰§è¡Œï¼Œç¼–å†™ä¸“é—¨çš„workhorseçº¿ç¨‹æ‰§è¡Œå¯†é›†è®¡ç®—ï¼Œè™½ç„¶å¤šä»»åŠ¡æ¯”ä¸ä¸Šå¤šæ ¸ï¼Œä½†å› ä¸ºå…·å¤‡å¤šçº¿ç¨‹çš„èƒ½åŠ›ï¼Œä»è€Œæé«˜äº†ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚è€Œå¤šçº¿ç¨‹çš„é¢‘ç¹å»ºç«‹å’Œé”€æ¯ï¼Œä»¥åŠå¤šçº¿ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ï¼Œä¼šå¯¼è‡´æ•´ä½“æ‰§è¡Œçš„å»¶è¿Ÿï¼Œå¯¹äºé«˜æ€§èƒ½çš„æœåŠ¡ç»„ä»¶ï¼Œé’ˆå¯¹ioå¯†é›†å‹åœºæ™¯ï¼Œå¼•å…¥çº¿ç¨‹æ± æ¥è¿›è¡Œä¼˜åŒ–ï¼›è€Œä¸šåŠ¡åœºæ™¯ï¼Œä¸ºäº†æé«˜ä¸šåŠ¡çš„æ¥å£ååé‡ï¼Œä¹Ÿå¼•å…¥äº†çº¿ç¨‹æ± è¿›è¡Œä¼˜åŒ–ï¼›&lt;/p&gt;
&lt;h4 id=&#34;nginx-thread-pool&#34;&gt;nginx thread pool&lt;/h4&gt;
&lt;p&gt;&lt;a href=&#34;https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/&#34;&gt;nginxæ˜¯å¤šå·¥ä½œè¿›ç¨‹(cpuæ ¸æ•°)+äº‹ä»¶æ¨¡å‹&lt;/a&gt;ï¼ˆå¦‚æœæ˜¯IOå¯†é›†å‹ workerè¿›ç¨‹æ•°åœ¨1.5-2å€cpuæ ¸æ•°ï¼‰ï¼Œé€šè¿‡å·¥ä½œè¿›ç¨‹å•çº¿ç¨‹çš„äº‹ä»¶æ¨¡å‹(æ¯”å–»æˆgrandmasterğŸ˜„)èƒ½å¤Ÿå¾ˆå¿«å¤„ç†ç”¨æˆ·çš„è¯·æ±‚(epolläº‹ä»¶æœºåˆ¶)ï¼Œä½†æ˜¯ä¸ºäº†è§£å†³é‡é˜»å¡å‹IOå¯†é›†å‹çš„å·¥ä½œä»»åŠ¡é—®é¢˜ï¼Œnginx 1.7.12å¼•å…¥äº†&lt;a href=&#34;https://www.nginx.com/blog/thread-pools-boost-performance-9x/&#34;&gt;thread pool çº¿ç¨‹æ± æŠ€æœ¯&lt;/a&gt;ï¼Œä¸»è¦æ˜¯é’ˆå¯¹linuxç³»ç»Ÿï¼Œè§£å†³ä¸æ”¯æŒå¼‚æ­¥IOçš„åœºæ™¯(FreeBSDç³»ç»Ÿçš„å¼‚æ­¥IOæ”¯æŒä½¿ç”¨å†…å­˜åšä¸ºæ–‡ä»¶ç¼“å­˜)ï¼›&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚äº§ç”Ÿç£ç›˜ioçš„ç³»ç»Ÿè°ƒç”¨read(),sendfile(),aio_write()(Linuxä¸Šçš„åœ¨ç¼–å†™ä¸€äº›ä¸´æ—¶æ–‡ä»¶,åœ¨nginx1.9.13åŠ å…¥&lt;a href=&#34;https://github.com/nginx/nginx/commit/348f705c000bdbfbee74d6f0111a03697f8ffa4f&#34;&gt;commit 348f705&lt;/a&gt;)è¿™äº›é˜»å¡æ“ä½œåœºæ™¯ï¼Œå·¥ä½œè¿›ç¨‹å¤„ç†è¿™äº›æ“ä½œçš„æ—¶å€™ï¼Œå°†å…¶æ”¾å…¥çº¿ç¨‹æ± ä¸­æ¥å¤„ç†ï¼Œå¸¸è§çš„ç›´æ’­/ç‚¹æ’­å›æ”¾åœºæ™¯ä¸­ï¼Œä¼šæœ‰æ‹‰æµæ“ä½œï¼Œä»æœ€è¿‘CDNæœåŠ¡èŠ‚ç‚¹ä¸Šè·å–è§†é¢‘æµè¿›è¡Œæ’­æ”¾ï¼›åƒè§†é¢‘æµæ–‡ä»¶ï¼Œæˆ–è€…å…¶ä»–å¤§æ–‡ä»¶ï¼Œè¿™äº›è¯·æ±‚èµ„æºæ˜¯æ²¡æ³•æ”¾å…¥ç³»ç»Ÿå†…å­˜&lt;a href=&#34;https://zhuanlan.zhihu.com/p/35448479&#34;&gt;é¡µé¢ç¼“å­˜&lt;/a&gt;ä¸­ï¼Œå¯¼è‡´äº‹ä»¶æ¨¡å‹è¢«æ–‡ä»¶æ“ä½œå¡ä½ï¼Œæ²¡æ³•æ­£å¸¸çš„å“åº”é“¾æ¥ï¼Œå¼•å…¥ thread pool æ¥ç¼“è§£è¿™ä¸ªé—®é¢˜ï¼›æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;å·¥ä½œè¿›ç¨‹ä¸­çš„ä¸»çº¿ç¨‹å†³å®šè¦å‘èµ·æ–‡ä»¶ç³»ç»Ÿæ“ä½œæ—¶ï¼Œå°†ä¼šå»ºç«‹ä¸€ä¸ªç‰¹æ®Šçš„ä»»åŠ¡ï¼Œå¹¶å°†è¯¥ä»»åŠ¡ä¸¢åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼›è€Œçº¿ç¨‹æ± ä¸­çš„ç©ºé—²çº¿ç¨‹ä¼šä¸æ–­çš„æ‰§è¡Œè¯¥é˜Ÿåˆ—çš„æ–‡ä»¶ä»»åŠ¡ï¼Œè€Œåå°†æ‰§è¡Œå¥½çš„ç»“æœè¿”å›ï¼Œä¸»çº¿ç¨‹ç›‘å¬åˆ°é€šçŸ¥äº‹ä»¶å°±ç»ªè°ƒç”¨å›è°ƒå‡½æ•°å¤„ç†ç»“æœï¼Œç»§ç»­åç»­æ“ä½œã€‚ç»è¿‡è¿™ä¸ªä¼˜åŒ–ï¼Œä¸»çº¿ç¨‹ä¸ä¼šå†è¢«é˜»å¡åœ¨ç³»ç»Ÿè°ƒç”¨ä¸Š(å¤šåˆ†å‡ºäº†é€šçŸ¥äº‹ä»¶ï¼Œä¸å½±å“è¯»å†™äº‹ä»¶)ï¼Œå¦‚å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/nginx-thread-pool.drawio.png&#34; alt=&#34;thread-pools-worker-process-event-cycle&#34;&gt;&lt;/p&gt;
&lt;p&gt;thread poolæ•´ä½“å®ç°ä»£ç è§&lt;a href=&#34;https://github.com/nginx/nginx/commit/305fc021db799c87d751f0f1f5e99afee7bb2b3b&#34;&gt;thread pool commit 305fc02&lt;/a&gt; , &lt;a href=&#34;https://github.com/nginx/nginx/commit/e10e7a4831cfaf6a41824da7c35819fc7f58f8ee&#34;&gt;epoll notify mechanism&lt;/a&gt;, &lt;a href=&#34;https://github.com/nginx/nginx/commit/2b3c01e9953b3985e05a46e56a01078b37caeb18&#34;&gt;kqueue notify mechanism&lt;/a&gt;ï¼›æœ€è¿‘æœ‰ä¸ª&lt;a href=&#34;https://github.com/nginx/nginx/commit/83e92a2edd6bf7c6867b653284ac44962c4e33c9&#34;&gt;commit 83e92a2&lt;/a&gt; è§£å†³http2 ç­‰å¾… sendfile å®Œæˆ è¯·æ±‚hangä½çš„æƒ…å†µï¼Œå°±æ˜¯åˆ©ç”¨çº¿ç¨‹æ± çš„å¼‚æ­¥æ–¹å¼(aio)æ¥å¤„ç†çš„ï¼ˆps: nginx ä½œè€…ä¹Ÿï¼‰ã€‚&lt;/p&gt;
&lt;h4 id=&#34;redis-thread-pool&#34;&gt;redis thread pool&lt;/h4&gt;
&lt;p&gt;rediså¤„ç†å‘½ä»¤æ ¸å¿ƒé€»è¾‘æ˜¯å•è¿›ç¨‹å•çº¿ç¨‹æ¨¡å¼ï¼Œrediså…³æ³¨çš„æ˜¯ç½‘ç»œIOï¼Œä»¥åŠå†…å­˜æ“ä½œï¼Œå¦‚æœæ˜¯å•è¿›ç¨‹å¤šçº¿ç¨‹å¤„ç†å¿…ç„¶ä¼šæœ‰åŒä¸€ä¸ªå†…å­˜ç»“æ„ä¼šæœ‰å¤šä¸ªçº¿ç¨‹å¤„ç†ï¼ŒåŠ é”å¤„ç†ï¼Œçº¿ç¨‹ç­‰å¾…ä»¥åŠå¤šçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€çš„é—®é¢˜ï¼Œæ‰§è¡Œæ•ˆç‡ä¸å¦‚å•çº¿ç¨‹é«˜æ•ˆï¼›ç½‘ç»œIOäº‹ä»¶ç›´æ¥é€šè¿‡IOå¤šè·¯å¤ç”¨äº‹ä»¶æ¨¡å‹(AE)æ¥è§£å†³, è€Œä¸”é€»è¾‘ç®€å•å¯ç»´æŠ¤ï¼›&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸ºäº†æé«˜å¤„ç†æ€§èƒ½ï¼ŒRedis v4.0 å°†ç£ç›˜ioå’Œå†…å­˜é‡Šæ”¾freeå·¥ä½œé‡‡ç”¨å‡ ä¸ªçº¿ç¨‹å¼‚æ­¥å¤„ç†bio(3ä¸ª)ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;fsyncå†…å­˜å¼‚æ­¥æŒä¹…è½ç›˜æ“ä½œå’Œcloseå¼‚æ­¥å…³é—­æ–‡ä»¶æ“ä½œï¼›&lt;/p&gt;
&lt;p&gt;ç”±äºå†…å­˜ä¸­å¤§keåŒæ­¥åˆ é™¤ä¼šè€—æ—¶é«˜ä»è€Œé˜»å¡æ ¸å¿ƒé€»è¾‘ï¼Œæ‰€ä»¥å°†è¿™äº›å†…å­˜é‡Šæ”¾é‡‡ç”¨lazyfreeæœºåˆ¶ä¼˜åŒ–å¼‚æ­¥åŒ–å¤„ç†ï¼ŒåŒ…æ‹¬ä¸¤ç±»ï¼šä¸€ç±»æ˜¯ä¸»åŠ¨é‡Šæ”¾&lt;code&gt;unlink&lt;/code&gt; &lt;code&gt;flushall async&lt;/code&gt; ï¼›ä¸€ç±»æ˜¯è¢«åŠ¨é‡Šæ”¾, åˆ†ä¸º4ç§åœºæ™¯ï¼ŒæŒ‰éœ€æ±‚åœºæ™¯è¿›è¡Œæ‰“å¼€ä¼˜åŒ–(é»˜è®¤æ˜¯å…³é—­çš„)ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;lazyfree-lazy-eviction no
lazyfree-lazy-expire no
lazyfree-lazy-server-del no
slave-lazy-flush no
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â€‹	lazyfree-lazy-evictionï¼šé’ˆå¯¹rediså†…å­˜ä½¿ç”¨è¾¾åˆ°maxmeoryï¼Œå¹¶è®¾ç½®æœ‰æ·˜æ±°ç­–ç•¥æ—¶ï¼›åœ¨è¢«åŠ¨æ·˜æ±°é”®æ—¶ï¼Œæ˜¯å¦é‡‡ç”¨lazy freeæœºåˆ¶ï¼› å…·ä½“æµç¨‹è§&lt;a href=&#34;https://weedge.github.io/post/lru/#%E8%BF%91%E4%BC%BClru%E7%AE%97%E6%B3%95&#34;&gt;redis è¿‘ä¼¼lruç®—æ³•&lt;/a&gt;ï¼›&lt;/p&gt;
&lt;p&gt;â€‹	lazyfree-lazy-expireï¼šé’ˆå¯¹è®¾ç½®æœ‰TTLçš„é”®ï¼Œè¾¾åˆ°è¿‡æœŸåï¼Œè¢«redisæ¸…ç†åˆ é™¤æ—¶æ˜¯å¦é‡‡ç”¨lazy freeæœºåˆ¶ï¼›å¯å¼€å¯&lt;/p&gt;
&lt;p&gt;â€‹	lazyfree-lazy-server-delï¼šé’ˆå¯¹æœ‰äº›æŒ‡ä»¤åœ¨å¤„ç†å·²å­˜åœ¨çš„é”®æ—¶ï¼Œä¼šå¸¦æœ‰ä¸€ä¸ªéšå¼çš„DELé”®çš„æ“ä½œï¼Œæ¯”å¦‚&lt;code&gt;rename&lt;/code&gt;æ“ä½œï¼Œå¦‚æœkeyå­˜åœ¨ä¼šå…ˆåˆ é™¤è¿™ä¸ªkey/value, å¦‚æœæ˜¯å¤§keyåœºæ™¯ä¼šé˜»å¡ï¼›å¯å¼€å¯&lt;/p&gt;
&lt;p&gt;â€‹	slave-lazy-flushï¼šé’ˆå¯¹slaveè¿›è¡Œå…¨é‡æ•°æ®åŒæ­¥ï¼Œslaveåœ¨åŠ è½½masterçš„RDBæ–‡ä»¶å‰ï¼Œä¼šè¿è¡Œflushallæ¥æ¸…ç†è‡ªå·±çš„æ•°æ®åœºæ™¯ï¼Œå¼€å¯å¯å‡å°‘å…¨é‡åŒæ­¥è€—æ—¶ï¼Œä»è€Œå‡å°‘ä¸»åº“å› è¾“å‡ºç¼“å†²åŒºçˆ†æ¶¨å¼•èµ·çš„å†…å­˜ä½¿ç”¨å¢é•¿ï¼›å¯å¼€å¯&lt;/p&gt;
&lt;p&gt;â€‹	è¿˜æœ‰ä¸€ä¸ªé…ç½® &lt;code&gt;lazyfree-lazy-user-del no&lt;/code&gt;ï¼Œ é’ˆå¯¹è€ç”¨æˆ·/ä»£ç ä½¿ç”¨&lt;code&gt;del&lt;/code&gt;ä¸»åŠ¨åˆ é™¤æ˜¯å¦å¼‚æ­¥å¤„ç†ï¼Œå¼€å¯å’Œ&lt;code&gt;unlink&lt;/code&gt;ä¸€æ ·ï¼›&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;ä¸ºäº†æé«˜å¤„ç†IOèƒ½åŠ›ï¼ŒRedis v6.0 æ­£å¼åœ¨ç½‘ç»œæ¨¡å‹ä¸­å®ç° I/O å¤šçº¿ç¨‹ï¼Œæµç¨‹å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;â€‹	å®¢æˆ·ç«¯å’Œä¸»çº¿ç¨‹å»ºç«‹è¿æ¥ï¼Œä¸»çº¿ç¨‹å°†è¯·æ±‚å°è£…æˆclientç»“æ„æ”¾å…¥LIFOè¯»å…¥é˜Ÿåˆ—(clients_pending_read)ï¼Œä¸»çº¿ç¨‹ç„¶åæŠŠLIFOè¯»å…¥é˜Ÿåˆ—ä¸­çš„clientæ•°æ®RRå‡åŒ€åˆ†é…ç»™ä¸»çº¿ç¨‹å’ŒI/Oå¤šçº¿ç¨‹çš„æœ¬åœ°é˜Ÿåˆ—(io_threads_list[id])ï¼›&lt;/p&gt;
&lt;p&gt;â€‹	ä¸»çº¿ç¨‹å’ŒI/Oå¤šçº¿ç¨‹è§£æå‘½ä»¤ï¼Œå†™å…¥æŸ¥è¯¢ç¼“å­˜åŒº(querybuf)ï¼›&lt;/p&gt;
&lt;p&gt;â€‹	ä¸»çº¿ç¨‹å¿™è½®è®­ç­‰å¾…I/Oå¤šçº¿ç¨‹å…¨éƒ¨è§£æå¤„ç†å®Œä¹‹åï¼Œéå†LIFOè¯»å…¥é˜Ÿåˆ—(clients_pending_read)ä¸­çš„client, å¤„ç†æ‰§è¡Œå‘½ä»¤æ ¸å¿ƒé€»è¾‘(processCommand)ï¼Œæ³¨æ„è¿™é‡Œå¹¶ä¸æ˜¯I/Oå¤šçº¿ç¨‹æ¥å¤„ç†ï¼›ä¸»çº¿ç¨‹å¤„ç†å®Œå‘½ä»¤åï¼Œå°†å“åº”æ•°æ®å†™å…¥clientå†™å‡ºç¼“å­˜åŒº(buf/reply)ï¼Œç„¶åæŠŠclientæ”¾å…¥LIFO å†™å‡ºé˜Ÿåˆ—(clients_pending_write)ï¼ŒåŒæ ·ä¸»çº¿ç¨‹ç„¶åæŠŠLIFOå†™å‡ºé˜Ÿåˆ—(clients_pending_write)ä¸­çš„clientæ•°æ®RRå‡åŒ€åˆ†é…ç»™ä¸»çº¿ç¨‹å’ŒI/Oå¤šçº¿ç¨‹çš„æœ¬åœ°é˜Ÿåˆ—(io_threads_list[id])ï¼›&lt;/p&gt;
&lt;p&gt;â€‹	ä¸»çº¿ç¨‹å’ŒI/Oå¤šçº¿ç¨‹å›å†™å“åº”æ•°æ®ç»™å®¢æˆ·ç«¯ï¼›&lt;/p&gt;
&lt;p&gt;â€‹	ä¸»çº¿ç¨‹å¿™è½®è®­ç­‰å¾…I/Oå¤šçº¿ç¨‹å…¨éƒ¨å›å†™å“åº”æ•°æ®ç»™å®¢æˆ·ç«¯ å¤„ç†å®Œä¹‹åï¼Œæœ€ååœ¨éå†LIFOå†™å‡ºé˜Ÿåˆ—(clients_pending_write)ï¼Œæ£€æŸ¥æ˜¯å¦è¿˜æœ‰ client çš„å†™å‡ºç¼“å†²åŒº(buf/reply)ä¸­æœ‰æ®‹ç•™æ•°æ®ï¼Œå¦‚æœæœ‰ï¼Œä¸º client æ³¨å†Œä¸€ä¸ªå‘½ä»¤å›å¤å™¨ sendReplyToClientï¼Œç­‰å¾…clientå¯å†™ä¹‹ååœ¨äº‹ä»¶å¾ªç¯ä¸­ç»§ç»­å›å†™æ®‹ä½™çš„å“åº”æ•°æ®ã€‚&lt;/p&gt;
&lt;p&gt;å¤„ç†æµç¨‹å’Œä»¥å‰çš„å•çº¿ç¨‹reactoræ¨¡å¼å·®ä¸å¤šï¼Œä¸»è¦åŒºåˆ«æ˜¯å¯¹è¯»å†™IOä¼˜åŒ–(å¼‚æ­¥å¤šçº¿ç¨‹å¤„ç†)ï¼› è¯»å…¥è¯·æ±‚å‘½ä»¤è¯»å–è§£æå’Œå†™å‡ºå“åº”æ•°æ®ç»™å®¢æˆ·ç«¯ï¼Œå¢åŠ äº†I/Oå¤šçº¿ç¨‹æ¥å¤„ç†ï¼Œä»¥å‰çš„ä¸»çº¿ç¨‹å¤„ç†çš„æ ¸å¿ƒé€»è¾‘æ²¡æœ‰å˜ï¼Œå¢åŠ äº†å’ŒI/Oå¤šçº¿ç¨‹äº¤äº’çš„è¯»å†™LIFOé˜Ÿåˆ—(clients_pending_read / clients_pending_write)ï¼Œæœ‰ç‚¹åƒæ‰‡å…¥æ‰‡å‡ºæ¨¡å¼ï¼›å°½é‡ä¿æŒ &lt;strong&gt;less is more&lt;/strong&gt; åŸåˆ™ï¼›&lt;/p&gt;
&lt;p&gt;è€Œä¸”redis v6.0ä¸ºäº†é«˜æ€§èƒ½ï¼Œç½‘ç»œIOå¤šçº¿ç¨‹åœºæ™¯ï¼Œå’Œnginxä¸€æ ·ä¹Ÿå¯¹å¤šæ ¸CPU NUMAæ¶æ„è¿›è¡Œäº†äº²å’Œæ€§å¤„ç†(è§setcpuaffinity.cä¸­é€»è¾‘ï¼Œ&lt;a href=&#34;https://github.com/redis/redis/commit/1a0deab2a548fa306171f03439e858c00836fe69&#34;&gt;commit 1a0deab2&lt;/a&gt;)ï¼Œå……åˆ†åˆ©ç”¨CPUæœ¬åœ°ç¼“å­˜ï¼Œå¹¶è¡Œå¤„ç†ï¼›å¦å¤–redis v6.0è¿˜æœ‰ä¸€äº›æ€§èƒ½ä¼˜åŒ–éªšæ“ä½œï¼Œæ— é”åŒ–å¤„ç†ï¼Œçœ‹ä»£ç æ—¶ä¼šå‘ç°ç”¨åˆ°äº†mutex lockï¼Œé€šè¿‡ pthread_mutex_lock ç»™ io_threads_mutex[i] (0&amp;lt;=i&amp;lt;128) ä¸Šé”ï¼Œå…¶å®ç›®çš„æ˜¯ä¸»çº¿ç¨‹ç”¨æ¥é€šçŸ¥I/Oçº¿ç¨‹ä½¿ç”¨çš„ï¼Œæœ€ç»ˆè¿˜æ˜¯é€šè¿‡io_threads_pending[i] åŸå­åŒ–æ“ä½œ(atomic_load_explicit)è·å–åˆ¤è¯»æ˜¯å¦ç­‰å¾…ï¼›æ¯ä¸ªå¤„ç†I/Oçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æœ¬åœ°é˜Ÿåˆ—io_threads_list[i] ç”¨äºå¤„ç†å°è£…çš„clientç»“æ„ï¼ŒI/Oçº¿ç¨‹ä¹‹é—´äº’ä¸å¹²æ¶‰ï¼›è€Œä¸”ä¸»çº¿ç¨‹å’ŒI/Oå­çº¿ç¨‹å¤„ç†æœ¬åœ°é˜Ÿåˆ— io_threads_list[i] ä»¥åŠio_threads_op é€šè¿‡æ§åˆ¶ä¸»çº¿ç¨‹å’Œ I/O çº¿ç¨‹äº¤é”™è®¿é—®æ¥è§„é¿å…±äº«æ•°æ®ç«äº‰(data race)é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;THREADED I/O æ ¸å¿ƒæ“ä½œå˜é‡å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-c&#34; data-lang=&#34;c&#34;&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;/* ==========================================================================
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt; * Threaded I/O
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt; * ========================================================================== */&lt;/span&gt;

&lt;span style=&#34;color:#4c8317&#34;&gt;#define IO_THREADS_MAX_NUM 128
&lt;/span&gt;&lt;span style=&#34;color:#4c8317&#34;&gt;#define IO_THREADS_OP_READ 0
&lt;/span&gt;&lt;span style=&#34;color:#4c8317&#34;&gt;#define IO_THREADS_OP_WRITE 1
&lt;/span&gt;&lt;span style=&#34;color:#4c8317&#34;&gt;&lt;/span&gt;
pthread_t io_threads[IO_THREADS_MAX_NUM];
pthread_mutex_t io_threads_mutex[IO_THREADS_MAX_NUM];
redisAtomic &lt;span style=&#34;color:#0aa&#34;&gt;unsigned&lt;/span&gt; &lt;span style=&#34;color:#0aa&#34;&gt;long&lt;/span&gt; io_threads_pending[IO_THREADS_MAX_NUM];
&lt;span style=&#34;color:#0aa&#34;&gt;int&lt;/span&gt; io_threads_op;      &lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;/* IO_THREADS_OP_WRITE or IO_THREADS_OP_READ. */&lt;/span&gt;

&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;/* This is the list of clients each thread will serve when threaded I/O is
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt; * used. We spawn io_threads_num-1 threads, since one is the main thread
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt; * itself. */&lt;/span&gt;
list *io_threads_list[IO_THREADS_MAX_NUM];
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ä»¥ä¸Šé€šè¿‡å¼•å…¥å¤šçº¿ç¨‹æ¥æ”¹å–„redisä¸­I/Oå¤„ç†æ€§èƒ½ï¼Œè¿™äº›ä¼˜åŒ–éƒ½å¯ä»¥æ ¹æ®éœ€æ±‚åœºæ™¯è¿›è¡Œé…ç½®ï¼Œä¹Ÿæœ‰å…·ä½“è¯´æ˜ è§: &lt;a href=&#34;https://github.com/redis/redis/blob/unstable/redis.conf&#34;&gt;redis.conf&lt;/a&gt; (LAZY FREEING, THREADED I/O)ï¼›åŠŸèƒ½æŒ‰éœ€é…ç½®ï¼Œ&lt;strong&gt;å¯é…ç½®åŠŸèƒ½è¯´æ˜&lt;/strong&gt; é…ç½®æ–‡æ¡£åŸåˆ™ (å¼€æºè½¯ä»¶é…ç½®æ–‡ä»¶ä¸€èˆ¬éƒ½ä¼šæœ‰è¯¦ç»†è¯´æ˜å¯äº†è§£)ï¼›&lt;/p&gt;
&lt;h4 id=&#34;java-thread-pool&#34;&gt;java thread pool&lt;/h4&gt;
&lt;p&gt;javaå¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œä¹Ÿæœ‰ç›¸å…³çš„çº¿ç¨‹æ± (ThreadPoolExecutorï¼Œå­ç±»ScheduledThreadPoolExecutor - åˆ©ç”¨å»¶è¿Ÿå·¥ä½œé˜Ÿåˆ—(æœ€å°å †)å®ç°å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± )æä¾›ä½¿ç”¨ï¼›ä½¿ç”¨ThreadPoolExecutorå¯ä»¥æ»¡è¶³ä¸¤ç§åœºæ™¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¹¶è¡Œæ‰§è¡Œå­ä»»åŠ¡ï¼Œæé«˜å“åº”é€Ÿåº¦ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåº”è¯¥ä½¿ç”¨åŒæ­¥é˜Ÿåˆ—ï¼Œæ²¡æœ‰ä»€ä¹ˆä»»åŠ¡åº”è¯¥è¢«ç¼“å­˜ä¸‹æ¥ï¼Œè€Œæ˜¯åº”è¯¥ç«‹å³æ‰§è¡Œ;&lt;/li&gt;
&lt;li&gt;å¹¶è¡Œæ‰§è¡Œå¤§æ‰¹æ¬¡ä»»åŠ¡ï¼Œæå‡ååé‡ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåº”è¯¥ä½¿ç”¨æœ‰ç•Œé˜Ÿåˆ—ï¼Œä½¿ç”¨é˜Ÿåˆ—å»ç¼“å†²å¤§æ‰¹é‡çš„ä»»åŠ¡ï¼Œé˜Ÿåˆ—å®¹é‡å¿…é¡»å£°æ˜ï¼Œé˜²æ­¢ä»»åŠ¡æ— é™åˆ¶å †ç§¯ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://p0.meituan.net/travelcube/77441586f6b312a54264e3fcf5eebe2663494.png&#34; alt=&#34;ThreadPoolExecutorè¿è¡Œæµç¨‹&#34;&gt;&lt;/p&gt;
&lt;p&gt;ThreadPoolExecutorå…·ä½“çš„ä½¿ç”¨ä»‹ç»å¯ä»¥å‚è€ƒç¾å›¢çš„è¿™ç‰‡æ–‡ç« ï¼š&lt;a href=&#34;https://tech.meituan.com/2020/04/02/java-pooling-pratice-in-meituan.html&#34;&gt;Javaçº¿ç¨‹æ± å®ç°åŸç†åŠå…¶åœ¨ç¾å›¢ä¸šåŠ¡ä¸­çš„å®è·µ&lt;/a&gt;ï¼Œå¼•ç”¨ ThreadPoolExecutor è¿è¡Œæµç¨‹å¦‚ä¸Šå›¾ï¼›æ–‡ä¸­æœ‰æœ‰å®é™…çš„æ¡ˆä¾‹å’Œå‚æ•°é…ç½®è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥å€Ÿé‰´ï¼›åœ¨ä½¿ç”¨javaçº¿ç¨‹æ± å¯¹æ¥å£ååé‡è¿›è¡Œä¼˜åŒ–æ—¶ï¼Œå¦‚æœå‚æ•°ä½¿ç”¨ä¸å½“ï¼Œçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°è¿‡å°ï¼Œå¯èƒ½å¯¼è‡´æ¥å£æœåŠ¡é™çº§ï¼›æ¶ˆè´¹çº¿ç¨‹è¿‡å°ä»»åŠ¡é˜Ÿåˆ—è¿‡é•¿ï¼Œç§¯å‹ä»»åŠ¡ï¼Œå¯èƒ½å¯¼è‡´è¯·æ±‚è¶…æ—¶çš„æƒ…å†µï¼›é’ˆå¯¹è¿™äº›åœºæ™¯ï¼Œæå‡ºè§£å†³æ–¹æ¡ˆï¼šå¢åŠ çº¿ç¨‹æ± ç›‘æ§ï¼Œé€šè¿‡é…ç½®ä¸­å¿ƒï¼Œæ‰‹åŠ¨æ¥è°ƒæ•´javaçº¿ç¨‹æ± å‚æ•°, è¿›è¡ŒåŠ¨æ€é…ç½®åŒ–ç®¡ç†ï¼Œè¿™ä¸ªæ€è·¯å…¶å®ä¹Ÿæ˜¯æœåŠ¡åŸºç¡€ç¨³å®šæ€§çš„å¸¸ç”¨æ€è·¯ï¼Œåšå¥½ç›‘æ§æŠ¥è­¦ï¼Œé…ç½®åŒ–åŠæ—¶äººå·¥å“åº”ã€‚(ç¾å›¢çš„&lt;a href=&#34;https://mp.weixin.qq.com/s/C81f0_arbs23KGcaIwi56w&#34;&gt;å¤ç›˜æœºåˆ¶&lt;/a&gt;å€¼å¾—å­¦ä¹ )&lt;/p&gt;
&lt;h4 id=&#34;thread-pool-å°ç»“&#34;&gt;thread pool å°ç»“&lt;/h4&gt;
&lt;p&gt;å¼•å…¥çº¿ç¨‹æ± å…¶å®æœ¬è´¨ä¸Šè¿˜æ˜¯å¯¹å¤šçº¿ç¨‹çš„æœ‰æ•ˆç®¡ç†ï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸è¿›è¡Œå¹¶è¡Œå¤„ç†ï¼Œå‡å°‘çº¿ç¨‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€(&lt;strong&gt;ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶é—´åœ¨&lt;a href=&#34;https://eli.thegreenplace.net/2018/measuring-context-switching-and-memory-overheads-for-linux-threads/&#34;&gt;~1000 åˆ° ~1500 çº³ç§’&lt;/a&gt;ï¼Œï¼ˆå¹³å‡ï¼‰æ¯æ ¸å¿ƒ&lt;a href=&#34;https://www.youtube.com/watch?v=jEG4Qyo_4Bc&amp;amp;feature=youtu.be&amp;amp;t=266&#34;&gt;æ¯çº³ç§’ 12 æ¡æŒ‡ä»¤&lt;/a&gt;ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢å¯èƒ½ä¼šèŠ±è´¹å¤§çº¦ 12k åˆ°å¤§çº¦ 18k æ¡æŒ‡ä»¤çš„å»¶è¿Ÿ&lt;/strong&gt;)ï¼›ä»¥ä¸Šå®ç°çš„çº¿ç¨‹æ± æœ¬è´¨ä¸Šéƒ½æ˜¯é€šè¿‡å¤šçº¿ç¨‹å¼‚æ­¥ä¼˜åŒ–IOä»»åŠ¡ï¼Œé€šè¿‡çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹ï¼Œé€šè¿‡å‚æ•°è¿›è¡Œè°ƒä¼˜ï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸cpuç¡¬ä»¶èµ„æºï¼Œå¹¶è¡Œå¤„ç†ï¼Œååæœ€å¤§åŒ–(ps: rediså’Œnginxçš„æºç å€¼å¾—ä¸€æ’¸)ã€‚ ä½†æ˜¯ç”¨æˆ·åº”ç”¨å±‚ä½¿ç”¨çº¿ç¨‹æ± éœ€è¦å¯¹çº¿ç¨‹æ•°ç›®è¿›è¡Œè°ƒæ•´ï¼Œé‚£å¯å¦ä»ç”¨æˆ·åº”ç”¨å±‚é¢æ¥å°è£…ä¸€å±‚è¿›è¡Œè°ƒåº¦ç®¡ç†å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯æœ‰çš„ï¼ŒåƒGOè¯­è¨€ï¼Œç°åœ¨çš„å†…éƒ¨è¿è¡Œæ—¶runtime é€šè¿‡G-P-Mè°ƒåº¦æ¨¡å‹æ¥æœ‰æ•ˆç®¡ç†ï¼ŒGo è¯­è¨€çš„è°ƒåº¦æ¨¡å‹é€šè¿‡ä½¿ç”¨ä¸ CPU æ•°é‡ç›¸ç­‰çš„çº¿ç¨‹å‡å°‘çº¿ç¨‹é¢‘ç¹åˆ‡æ¢çš„å†…å­˜å¼€é”€(å¦‚æœæ˜¯åœ¨å®¹å™¨ç¯å¢ƒä¸­ï¼Œå¯ä»¥é€šè¿‡&lt;a href=&#34;https://github.com/uber-go/automaxprocs&#34;&gt;uber-go/automaxprocs&lt;/a&gt; è¿è¡Œæ—¶è‡ªåŠ¨é€‚é…åˆ†é…ç»™å®¹å™¨cpuæ ¸æ•°)ï¼ŒåŒæ—¶åœ¨æ¯ä¸€ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œé¢å¤–å¼€é”€æ›´ä½çš„ Goroutine åç¨‹æ¥é™ä½æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶çš„è´Ÿè½½ï¼Œç”¨æˆ·åº”ç”¨å±‚é¢ä¸éœ€è¦è€ƒè™‘å¤šçº¿ç¨‹ç¼–ç¨‹çš„ç»†èŠ‚ï¼Œé‡ç‚¹å…³æ³¨Goroutine åç¨‹çš„ä½¿ç”¨ä¼˜åŒ–ï¼Œäº†è§£G-P-Mæ¨¡å‹ï¼Œè¿è¡Œæ—¶&lt;a href=&#34;http://www1.cs.columbia.edu/~aho/cs6998/reports/12-12-11_DeshpandeSponslerWeiss_GO.pdf&#34;&gt;è°ƒåº¦æœºåˆ¶&lt;/a&gt;ã€‚(äº«å—ä¸€æ³¢è¯­è¨€,å·¥å…·ç¦åˆ©æ—¶ï¼Œ&lt;strong&gt;æ³¨æ„ç³»ç»Ÿé˜»å¡è°ƒç”¨æ—¶çš„çº¿ç¨‹æ³„éœ²,ä»¥åŠå¼‚æ­¥é˜»å¡æ—¶çš„åç¨‹æ³„æ¼, raceæ£€æŸ¥,æ€§èƒ½æµ‹è¯•,pprof/traceåˆ†æ,é€ƒé€¸åˆ†æ,GC&lt;/strong&gt;ç­‰)&lt;/p&gt;
&lt;h3 id=&#34;åç¨‹æ± coroutine-pool&#34;&gt;åç¨‹æ± (coroutine pool)&lt;/h3&gt;
&lt;p&gt;åç¨‹æ˜¯è¿è¡Œåœ¨ç”¨æˆ·æ€çš„è½»é‡çº¿ç¨‹ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ç”¨æˆ·åº”ç”¨å±‚é¢çš„çº¿ç¨‹ï¼Œ æ¯”çº¿ç¨‹åˆ†é…çš„è™šæ‹Ÿå†…å­˜æ ˆç©ºé—´è¦å°ï¼›åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ‰€å è™šæ‹Ÿå†…å­˜æ ˆç©ºé—´å¤§å°ï¼Œåœ¨linuxä¸‹é€šè¿‡&lt;code&gt;pmap &lt;/code&gt;+pid æŸ¥çœ‹stackå¤§å°ï¼Œ åœ¨macOSä¸‹é€šè¿‡&lt;code&gt;vmmap -interleaved&lt;/code&gt;+pid æŸ¥çœ‹stackå¤§å°ï¼Œå¤§å°ç”±&lt;code&gt;ulimit -s&lt;/code&gt; æ§åˆ¶ï¼Œçº¿ç¨‹æ ˆç©ºé—´ä¸€èˆ¬åœ¨8M~10Må·¦å³ï¼Œå¦‚æœä½¿ç”¨ä¸å½“ä¼šæ ˆæº¢å‡ºï¼›è€Œåç¨‹åˆ†é…ç©ºé—´æ˜¯ç”±å®ç°åç¨‹è¯­è¨€æ¥å†³å®šï¼ŒåƒGOå®ç°çš„goroutineåç¨‹åˆå§‹åˆ›å»ºæ ˆç©ºé—´å¤§å°æ˜¯2k(go 1.4+ é‡‡ç”¨è¿ç»­å †æ ˆç­–ç•¥ï¼Œä»¥å‰æ˜¯åˆ†æ®µæ ˆç­–ç•¥)ï¼Œæœ€å¤§é™åˆ¶çš„é»˜è®¤å€¼åœ¨64ä½ç³»ç»Ÿä¸Šæ˜¯1GBï¼ˆ&lt;a href=&#34;https://github.com/golang/go/blob/f296b7a6f045325a230f77e9bda1470b1270f817/src/runtime/proc.go#L120&#34;&gt;ä¸åŒçš„æ¶æ„æœ€å¤§æ•°ä¼šä¸åŒ&lt;/a&gt;ï¼‰ï¼›ç¼–è¯‘æœŸé—´æ’å…¥æ£€æŸ¥ï¼Œè°ƒç”¨æ—¶å¦‚æœæ»¡è¶³äº†æ‰©å®¹æ¡ä»¶(æ ¹æ®è¢«è°ƒç”¨å‡½æ•°æ ˆå¸§çš„å¤§å°æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œé€šè¿‡ stackguard0 æ¥åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œæ ˆå¢é•¿)ï¼Œæ‰©å®¹ä¸¤å€ç©ºé—´ï¼Œå¦‚æœåç¨‹æ‰€ä½¿ç”¨çš„æ ˆç©ºé—´å°äº1/4æ—¶ï¼Œç¼©å®¹æˆä¸€åŠç©ºé—´ï¼›(å…·ä½“ç»†èŠ‚è§ï¼š&lt;a href=&#34;https://draveness.me/golang/docs/part3-runtime/ch07-memory/golang-stack-management/&#34;&gt;æ ˆç©ºé—´ç®¡ç†&lt;/a&gt; &lt;a href=&#34;https://kirk91.github.io/posts/2d571d09/&#34;&gt;æ¨é€åœºæ™¯: èŠä¸€èŠgoroutine stack&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;å°½ç®¡goroutineåç¨‹æ¯”çº¿ç¨‹åˆ†é…æ ˆç©ºé—´å°ï¼Œä½†æ˜¯ å¤§é‡çš„ goroutine è¿˜æ˜¯å¾ˆè€—èµ„æºçš„ï¼Œè€Œä¸”å¤§é‡çš„ goroutine å¯¹äºè°ƒåº¦å’Œåƒåœ¾å›æ”¶çš„è€—æ—¶è¿˜æ˜¯ä¼šæœ‰å½±å“çš„ï¼Œå› æ­¤ï¼Œgoroutine å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œæ‰€ä»¥ä½¿ç”¨åç¨‹æ± æ¥ä¼˜åŒ–ï¼›&lt;/p&gt;
&lt;p&gt;GOä¸­ç®¡ç†åç¨‹æ± çš„å¼€å‘æ–¹æ¡ˆè¿˜æ˜¯æ¯”è¾ƒå¤šçš„ï¼Œå¤§éƒ½æ˜¯å’Œçº¿ç¨‹æ± ä»»åŠ¡å·¥ä½œæ¨¡å‹å·®ä¸å¤šï¼Œä»»åŠ¡é˜Ÿåˆ—ç”¨çš„æ˜¯GOä¸­çš„runtime/channel,  æ± åŒ–ç®¡ç†ç”¨çš„æ˜¯GOä¸­çš„sync.Pool, æ¯”å¦‚&lt;a href=&#34;https://github.com/valyala/fasthttp/blob/9f11af296864153ee45341d3f2fe0f5178fd6210/workerpool.go#L16&#34;&gt;fasthttp workerpool&lt;/a&gt; é’ˆå¯¹è‡ªèº«åœºæ™¯çš„å¤šä¸ªè¿æ¥é€šé“æ± åŒ–å¤ç”¨ -&amp;gt; &lt;a href=&#34;https://github.com/panjf2000/ants&#34;&gt;panjf2000/ants&lt;/a&gt; é€šç”¨åŒ–äº†å¤šä¸ªä»»åŠ¡é€šé“æ± åŒ–å¤ç”¨ -&amp;gt; &lt;a href=&#34;https://github.com/bytedance/gopkg/tree/develop/util/gopool&#34;&gt;bytedance/gopool&lt;/a&gt; ä»»åŠ¡taskerå’Œå·¥ä½œworkeræ± åŒ–å¤ç”¨ï¼›ç›¸å¯¹çº¿ç¨‹æ± thread poolçš„å®ç°è¦ç®€å•äº›ï¼Œå› ä¸ºåº•å±‚GO runtimeçš„&lt;a href=&#34;https://www.ardanlabs.com/blog/2018/08/scheduling-in-go-part2.html&#34;&gt;è°ƒåº¦å™¨&lt;/a&gt;ä»¥åŠsyncåº“å·²ç»åšäº†å¤§éƒ¨åˆ†çš„ä¼˜åŒ–(æ— é”æˆ–æœ€å°åŒ–é”ç²’åº¦)ã€‚&lt;a href=&#34;https://time.geekbang.org/column/article/301716&#34;&gt;Poolï¼šæ€§èƒ½æå‡å¤§æ€å™¨&lt;/a&gt; ä¸­ä»‹ç»äº†GOä¸­sync.Poolçš„å®ç°ï¼Œä»¥åŠåç¨‹æ± çš„ä¸‰æ–¹å¼€æºæ–¹æ¡ˆå®ç°ï¼›&lt;/p&gt;
&lt;p&gt;è¿™é‡Œä»‹ç»ä¸€ä¸ªå®ç°çš„ &lt;a href=&#34;https://github.com/weedge/lib/tree/main/pool/workerpool&#34;&gt;workerpool&lt;/a&gt;   é€šè¿‡channel å­˜æ”¾ä»»åŠ¡ï¼Œå¤šä¸ª Worker å…±äº«åŒä¸€ä¸ªä»»åŠ¡ Channelï¼Œé€šè¿‡å¤šä¸ªåç¨‹æ¥æ¶ˆè´¹æ± ä¸­çš„ä»»åŠ¡æ‰§è¡Œï¼Œåç¨‹æ ¹æ®æäº¤çš„ä»»åŠ¡æ•°åŠ¨æ€æ‰©ç¼©åç¨‹ï¼›ä»»åŠ¡å¯ä»¥å®šä¹‰è¾“å…¥ï¼Œè¾“å‡ºï¼Œè¶…æ—¶æ—¶é—´ï¼›é€šè¿‡channel è¿”å›æ˜¯å¦è¶…æ—¶; å¯ç”¨äºæ‰¹é‡ä»»åŠ¡å¹¶å‘æ‰§è¡Œåœºæ™¯ï¼Œé€‚ç”¨äºå¤§é‡æ‰¹é‡è€—æ—¶ç›¸å¯¹æ¯”è¾ƒé«˜çš„ä»»åŠ¡ï¼›åœ¨å®é™…å·¥ä½œä¸­ï¼Œæ¯”å¦‚ç»„ç»‡å¼•æ“ä¸­æ ‘ä¸­ç»„ç»‡èŠ‚ç‚¹çš„ç”Ÿæˆï¼Œæœ‰äº›ä»»åŠ¡è¶…æ—¶äº†ï¼Œä½¿ç”¨æ–¹å¯ä»¥é‡æ–°æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œæˆ–è€…å‡ºé”™æŠ¥è­¦ç­‰æ“ä½œã€‚ æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/lib/main/pool/workerpool/workerpool.png&#34; alt=&#34;workerpool&#34;&gt;&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰åç¨‹æ± çš„å®ç°æ–¹å¼ï¼Œä¸»è¦æ˜¯ä¸ºäº†åº”å¯¹çªå‘æµé‡(åœºæ™¯ï¼šå¤„ç†å¤§é‡è¿æ¥è¯·æ±‚)ï¼Œå¦‚ä¸‹å‡ ä¸ªï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/gammazero/workerpool.git&#34;&gt;gammazero/workerpool&lt;/a&gt;  å®ç°ç”¨åˆ°3ä¸ªé˜Ÿåˆ—ï¼Œä¸€ä¸ªç”¨äºæäº¤ä»»åŠ¡çš„ä»»åŠ¡é˜Ÿåˆ—(buffer channel length 1ï¼Œå‘é€ä»»åŠ¡éé˜»å¡)ã€ä¸€ä¸ªç­‰å¾…é˜Ÿåˆ—ï¼ˆbuf[] interface{} head,tailï¼Œä¸ºäº†åº”å¯¹çªå‘æµé‡è®¾ç½®çš„buff,æ— é™åˆ¶)ã€ ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—(block channelï¼Œç”¨é˜»å¡chanæ˜¯ä¸ºäº†è®©æ¶ˆè´¹çš„workerå…ˆå¯åŠ¨)ï¼›æœªä½¿ç”¨sync.Poolï¼›é€šè¿‡dispatchåç¨‹æ¥ç®¡ç†å·¥ä½œåç¨‹ï¼Œ å®šæ—¶(idleTimeout)æ£€æŸ¥å·¥ä½œé˜Ÿåˆ—æ˜¯å¦æœ‰ä»»åŠ¡(idle), ä»¥åŠæœ‰å·¥ä½œåç¨‹(workerCount&amp;gt;1)ï¼Œå‘é€ç©ºä»»åŠ¡(nil) ç»“æŸå·¥ä½œåç¨‹ï¼›è¿™ä¸ªæ£€æŸ¥æ˜¯å¦æœ‰ç©ºé—²å·¥ä½œåç¨‹æœºåˆ¶æ¯”è¾ƒç®€å•ï¼Œæ¯åˆ°å®šæ—¶æ—¶é—´æ“ä½œä¸€æ¬¡ï¼Œå›æ”¶é¢‘ç‡å¯ä»¥è°ƒæ•´ï¼ŒidleTimeouté»˜è®¤2ç§’ï¼›é€šè¿‡å‘é€æš‚åœä»»åŠ¡ (Context/stopSignal) æ¥æš‚åœworkerå·¥ä½œä»¥åŠæ•´ä¸ªworkerpoolï¼Œè¿˜æœ‰æäº¤ç­‰å¾…æ‰§è¡Œå®Œæˆçš„ä»»åŠ¡ï¼Œé€šè¿‡Paceræäº¤é™é€Ÿä»»åŠ¡ï¼Œä½¿ç”¨æ–¹ä¹Ÿå¯ä»¥æäº¤è¶…æ—¶ä»»åŠ¡ï¼›ä½¿ç”¨goroutine+channel+sync+contextæ•´ä½“å®ç°workerpoolå°±300è¡Œå·¦å³ï¼Œè¿™ä¸ªå’ŒThreadPoolExecutoræœ‰äº›ç±»ä¼¼ï¼Œæµç¨‹å¦‚ä¸‹ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/go-workerpool.drawio.png&#34; alt=&#34;go-workerpool&#34;&gt;&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/valyala/fasthttp/blob/9f11af296864153ee45341d3f2fe0f5178fd6210/workerpool.go#L16&#34;&gt;fasthttp workerpool&lt;/a&gt; é’ˆå¯¹è‡ªèº«åœºæ™¯çš„å¤šä¸ªè¿æ¥é€šé“æ± åŒ–å¤ç”¨ï¼› -&amp;gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/panjf2000/ants&#34;&gt;panjf2000/ants&lt;/a&gt; é€šç”¨åŒ–äº†å¤šä¸ªä»»åŠ¡é€šé“æ± åŒ–å¤ç”¨ï¼ˆä¸€æ¬¡ä»»åŠ¡Gç”¨å®Œç”Ÿå‘½å‘¨æœŸè¿˜å¯ä»¥å¤ç”¨(æŒ‰ç©ºé—²æ—¶é—´é•¿çŸ­å›æ”¶), å¯ç”¨workeræ”¾å…¥è‡ªå®šä¹‰çš„æ± ä¸­(stack/loopQueue) , å¦‚æœå·¥ä½œæ± æ²¡æœ‰å¯ç”¨worker, æ ¹æ®é…ç½®æ˜¯å¦ç­‰å¾…ï¼Œç­‰å¾…åˆ™ç­‰æœ‰å¯ç”¨workeræ—¶é€šè¿‡æ¡ä»¶å˜é‡(Cond)å”¤é†’,ä½¿ç”¨è‡ªæ—‹é”; å®šæ—¶ä»è‡ªå®šä¹‰çš„å·¥ä½œæ± ä¸­è·å–ç©ºé—²æ—¶é—´å¤§äºé…ç½®é˜ˆå€¼çš„workerè¿›è¡Œå›æ”¶ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/bytedance/gopkg/tree/develop/util/gopool&#34;&gt;bytedance/gopool&lt;/a&gt; ä»»åŠ¡taskå’Œå·¥ä½œworkeræ± åŒ–å¤ç”¨(ä¸€æ¬¡ä»»åŠ¡Gç”¨å®Œç”Ÿå‘½å‘¨æœŸå¯ä»¥å¤ç”¨ï¼Œå¤ç”¨æ ˆç©ºé—´ï¼Œå°½é‡å‡å°‘åç¨‹è°ƒåº¦æ¶ˆè€—) -&amp;gt; (å°½é‡æ— é”åŒ–é˜Ÿåˆ—);é’ˆå¯¹&lt;strong&gt;ä¼˜åŒ–æ ˆæ‰©å¼ åœºæ™¯&lt;/strong&gt;ä½¿ç”¨(RPC æœåŠ¡å¸¸è§é—®é¢˜,æ¯”å¦‚ï¼š&lt;a href=&#34;https://kirk91.github.io/posts/2d571d09/&#34;&gt;æ¨é€åœºæ™¯: èŠä¸€èŠgoroutine stack&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;Tips: 1æœ‰ç­‰å¾…å…¨éƒ¨ä»»åŠ¡ç»“æŸï¼›2ï¼Œ3ï¼Œ4 è¿™äº›åç¨‹æ± æ²¡æœ‰ç­‰å¾…ï¼Œå› ä¸ºä½¿ç”¨åœºæ™¯å¤§å¤šæ˜¯å¤šä¸ªåç¨‹å¤„ç†å®Œä»»åŠ¡ä¹‹åæ— éœ€ç­‰å¾…ç»“æœå¤„ç†ï¼Œå¯ä»¥è‡ªå·±çš„ä»»åŠ¡ä¸­å®šä¹‰ï¼›1,2,3éƒ½ä½¿ç”¨äº†channel, 1æ˜¯åœ¨æ¶ˆè´¹ä¾§å¯åŠ¨goroutineï¼Œ2,3æ˜¯åœ¨ç”Ÿäº§ä¾§å¯åŠ¨goroutineï¼Œé€šè¿‡channelå•å‘é€šä¿¡taskï¼›4 æœªä½¿ç”¨channelæ¥é€šä¿¡ï¼Œç›´æ¥é€šè¿‡FIFOå•å‘taské“¾è¡¨ï¼Œä¸Šé”å¤´å‡ºå°¾å…¥taskï¼Œåœ¨ç”Ÿäº§ä¾§å¯åŠ¨goroutineï¼›&lt;/p&gt;
&lt;p&gt;æ»¡è¶³åç¨‹å¤ç”¨çš„å‰æä¸‹ï¼Œåœ¨ç”Ÿäº§ä¾§taskï¼Œé˜Ÿåˆ—ï¼Œæ¶ˆè´¹ä¾§worker ä¸Šå°½é‡ä¼˜åŒ–ç»“æ„ï¼Œç»“åˆè°ƒåº¦ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä»¥ä¸Šçš„workerpool éƒ½æœ‰ç¼“å†²é˜Ÿåˆ—ï¼Œå¦‚æœæœåŠ¡è¿›ç¨‹é‡å¯ï¼Œéœ€è¦å¹³æ»‘åœæ­¢æœåŠ¡ï¼Œå°±æ˜¯åœ¨æ”¶åˆ°TERMä¿¡å·æ—¶ï¼Œéœ€è¦è°ƒç”¨workerpoolæä¾›çš„Waitæ¥å£, å¯¹äºæœªç­‰å¾…çš„åç¨‹æ± ï¼Œä½¿ç”¨sync.WaitGroupæ¥ç­‰å¾…å‰©ä½™çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œè¿™ç§ä»»åŠ¡å¦‚æœæ˜¯ç”¨æˆ·è¯·æ±‚ä»»åŠ¡ï¼Œä¸€èˆ¬éƒ½æ˜¯çŸ­ä»»åŠ¡ï¼Œå¤„ç†æ—¶é—´ä¸ä¼šå¾ˆé•¿ï¼ŒåƒPod ä¸­çš„ docker containeré”€æ¯çš„æ—¶å€™éƒ½ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´æ‰ä¼šå›æ”¶æ‰ï¼›å¦‚æœæ˜¯é•¿æ—¶é—´ä»»åŠ¡ï¼Œæ¯”å¦‚cron job å–å†³äºä»»åŠ¡çš„é‡è¦ç¨‹åº¦ï¼Œåˆ™éœ€è¦è½åº“å­˜æ”¾ä»»åŠ¡çŠ¶æ€ï¼Œåœ¨ä»»åŠ¡æäº¤ä¹‹å‰é€šè¿‡ä»»åŠ¡è¡¨æ¥è®°å½•ï¼Œå› ä¸ºè¿›ç¨‹æœ¬åœ°è®°å½•æ˜¯ä¸å¯è¡Œçš„ï¼Œå¦‚æœå®¹å™¨åŒ–éƒ¨ç½²åœ¨Podä¸­ï¼Œæ¯æ¬¡éƒ¨ç½²çš„Nodeä¼šä¸åŒï¼›è¯·æ ¹æ®éœ€æ±‚åœºæ™¯é€‰æ‹©åˆé€‚çš„workerpoolã€‚&lt;/p&gt;
&lt;h3 id=&#34;å°ç»“&#34;&gt;å°ç»“&lt;/h3&gt;
&lt;p&gt;çº¿ç¨‹ä½œä¸ºcpuæ‰§è¡Œè°ƒåº¦çš„æœ€å°å•å…ƒï¼Œè€Œè¿›ç¨‹ä½œä¸ºèµ„æºåˆ†é…æœ€å°å•å…ƒï¼Œè¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå…±äº«å…¶è¿›ç¨‹èµ„æºï¼Œä½œä¸ºçº¿ç¨‹çš„å®¹å™¨ï¼Œç›¸äº’éš”ç¦»ä¸åŒè¿›ç¨‹ä¹‹é—´çš„çº¿ç¨‹ï¼Œæ‰€ä»¥nginx/fpm éƒ½æ˜¯å¤šè¿›ç¨‹(å•çº¿ç¨‹)+reactorå¤šè·¯å¤ç”¨çš„æ–¹å¼å¤„ç†ç½‘ç»œIOè¯·æ±‚ï¼› php-fpm ä¸ºäº†æœ‰æ•ˆæ§åˆ¶è¯·æ±‚è¿›ç¨‹æ‰€å èµ„æºè¿‡å¤šæ¶ˆè€—å†…å­˜çš„æƒ…å†µï¼Œå¼•å…¥å·¥ä½œè¿›ç¨‹æ± æ¥é˜²æ­¢è¿‡åº¦æ¶ˆè€—å†…å­˜ï¼Œè€Œä¸”å¯ä»¥å¤ç”¨å·¥ä½œè¿›ç¨‹æ¥å¤„ç†è¯·æ±‚ï¼›nginx ä¸ºäº†ä¼˜åŒ–ç³»ç»Ÿè°ƒç”¨æ—¶é˜»å¡ioï¼Œä½¿ç”¨çº¿ç¨‹æ± æ¥å¼‚æ­¥åŒ–å¤„ç†å¤„ç†é˜»å¡ioäº‹ä»¶ï¼›redis å¼•å…¥å¤šçº¿ç¨‹æ¥è§£å†³ç£ç›˜IO,é‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œä»¥åŠç½‘ç»œIOè¯»å†™çš„æ€§èƒ½é—®é¢˜ï¼Œnginxå’Œredis å¼•å…¥å¤šçº¿ç¨‹éƒ½éœ€è¦ç¼–è¯‘é…ç½®ï¼Œå…¶ä¸­nginxå’Œredisä¸­çš„ç½‘ç»œIOä¼˜åŒ–ç»†èŠ‚å€¼å¾—å­¦ä¹ çš„ï¼›åç¨‹åˆ›å»ºåˆ†é…æ ˆç©ºé—´æ¯”çº¿ç¨‹æ›´å°ï¼ŒGolangä¸­é€šè¿‡å¯å¢é•¿æ ˆç©ºé—´ï¼Œè¿è¡Œæ—¶runtime é€šè¿‡G-P-Mè°ƒåº¦æ¨¡å‹æ¥å°† goroutine å¤šè·¯å¤ç”¨åˆ°çº¿ç¨‹ï¼Œå¦‚æœåç¨‹è¿‡å¤šï¼Œä¹Ÿä¼šå½±å“è°ƒåº¦ä»¥åŠGCæ ‡è®°æ¸…é™¤æ•ˆç‡ï¼Œæ‰€ä»¥åœ¨æ¶ˆè€—å¤§é‡åç¨‹çš„åœºæ™¯ä¸‹ï¼Œå¼•å…¥åç¨‹æ± æ¥å¤ç”¨ï¼Œå› ä¸ºgolang runtimeè°ƒåº¦æ¨¡å‹ä»¥åŠchannelæœºåˆ¶ï¼Œä½¿ç”¨&lt;a href=&#34;https://go.dev/blog/pipelines&#34;&gt;Go Concurrency Patterns&lt;/a&gt; å®ç°åç¨‹æ± æ–¹æ¡ˆå¾ˆå¤šï¼Œgolangç¤¾åŒºæ´»è·ƒï¼Œæœ€å¥½ç»“åˆéœ€æ±‚åœºæ™¯æ¥åˆ†æã€‚&lt;/p&gt;
&lt;h2 id=&#34;references&#34;&gt;references&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://hpc.llnl.gov/training/tutorials/introduction-parallel-computing-tutorial&#34;&gt;Introduction to Parallel Computing Tutorial&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.akkadia.org/drepper/nptl-design.pdf&#34;&gt;nptl-design.pdf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://sourceware.org/git/?p=glibc.git;a=blob;f=nptl/pthread_create.c;hb=627f5ede70d70c77bdaf857db07404e8bf7f60af#l619&#34;&gt;glibc pthread_create&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/torvalds/linux/blob/master/kernel/fork.c&#34;&gt;linux v2.6.38+ fork.c&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://makelinux.github.io/kernel/map/&#34;&gt;Linux 2.6.36 kernel map&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.nginx.com/blog/thread-pools-boost-performance-9x/&#34;&gt;nginx-thread-pools-boost-performance-9x&lt;/a&gt; &lt;a href=&#34;https://segmentfault.com/a/1190000010008012&#34;&gt;ç¿»è¯‘&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.nginx.com/blog/inside-nginx-how-we-designed-for-performance-scale/&#34;&gt;inside-nginx-how-we-designed-for-performance-scale&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.aosabook.org/en/nginx.html&#34;&gt;AOSA-nginx&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://antirez.com/news/93&#34;&gt;Lazy Redis is better Redis&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://redis.io/topics/benchmarks&#34;&gt;How fast is Redis?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://tech.meituan.com/2020/04/02/java-pooling-pratice-in-meituan.html&#34;&gt;Javaçº¿ç¨‹æ± å®ç°åŸç†åŠå…¶åœ¨ç¾å›¢ä¸šåŠ¡ä¸­çš„å®è·µ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://www1.cs.columbia.edu/~aho/cs6998/reports/12-12-11_DeshpandeSponslerWeiss_GO.pdf&#34;&gt;Analysis of the Go runtime scheduler&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bilibili.com/video/BV1Bq4y1q7Pi&#34;&gt;Golangæ“ä½œç³»ç»Ÿè°ƒåº¦åŸç†&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.ardanlabs.com/blog/2018/08/scheduling-in-go-part1.html&#34;&gt;Scheduling In Go : Part I - OS Scheduler&lt;/a&gt; &lt;a href=&#34;https://www.ardanlabs.com/blog/2018/08/scheduling-in-go-part2.html&#34;&gt;Part II - Go Scheduler&lt;/a&gt; &lt;a href=&#34;https://www.ardanlabs.com/blog/2018/12/scheduling-in-go-part3.html&#34;&gt;Part III - Concurrency&lt;/a&gt;  &lt;a href=&#34;https://github.com/ardanlabs/gotraining&#34;&gt;gotraining&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=f6kdp27TYZs&#34;&gt;Google I/O 2012 - Go Concurrency Patterns &lt;/a&gt; &lt;a href=&#34;https://talks.golang.org/2012/concurrency.slide#1&#34;&gt;ã€Œslideã€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=QDDwwePbDtw&#34;&gt;Google I/O 2013 - Advanced Go Concurrency Patterns&lt;/a&gt;  &lt;a href=&#34;https://talks.golang.org/2013/advconc.slide#1&#34;&gt;ã€Œslideã€&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=5zXAHh5tJqQ&#34;&gt;Rethinking Classical Concurrency Patterns&lt;/a&gt;  &lt;strong&gt;&lt;a href=&#34;https://drive.google.com/file/d/1nPdvhB0PutEJzdCq5ms6UI58dp50fcAN/view&#34;&gt;ã€Œslideã€&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.google.com/document/d/1ETuA2IOmnaQ4j81AtTGT40Y4_Jr6_IDASEKg0t0dBR8/edit&#34;&gt;Go Preemptive Scheduler Design Doc&lt;/a&gt;  &lt;a href=&#34;https://rakyll.org/scheduler/&#34;&gt;Go&amp;rsquo;s work-stealing scheduler&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://tonybai.com/2017/06/27/an-intro-about-go-portability/&#34;&gt;ä¹Ÿè°ˆGoçš„å¯ç§»æ¤æ€§&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=KINIAgRpkDA&#34;&gt;The Design of the Go Assembler&lt;/a&gt; &lt;a href=&#34;https://9p.io/sys/doc/asm.html&#34;&gt;A Manual for the Plan 9 assembler&lt;/a&gt; &lt;a href=&#34;https://github.com/cch123/golang-notes/blob/master/assembly.md&#34;&gt;plan9 assembly å®Œå…¨è§£æ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://time.geekbang.org/column/article/301716&#34;&gt;Poolï¼šæ€§èƒ½æå‡å¤§æ€å™¨&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
      
    </item>
    
    <item>
      <title>æ·±å…¥ç†è§£Linuxçš„Page Cache ã€Œè½¬è½½çš„å“¦ã€</title>
      <link>https://weedge.github.io/%E8%BD%AC%E8%BD%BD/page-cache/</link>
      <pubDate>Fri, 26 Nov 2021 11:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/%E8%BD%AC%E8%BD%BD/page-cache/</guid>
      
        <description>&lt;blockquote&gt;
&lt;p&gt;from: äº’è”ç½‘ï¼Œäº†è§£ä¸‹å¤‡ä¸ªä»½è€Œå·²å•¦ï½ï¼unix è¯·çœ‹ä¸ª man&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;1page-cache&#34;&gt;1ã€Page Cache&lt;/h2&gt;
&lt;h3 id=&#34;11-page-cache-æ˜¯ä»€ä¹ˆ&#34;&gt;1.1 Page Cache æ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†ç†è§£ Page Cacheï¼Œæˆ‘ä»¬ä¸å¦¨å…ˆçœ‹ä¸€ä¸‹ Linux çš„æ–‡ä»¶ I/O ç³»ç»Ÿï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F1124%2F2654c391j00r32mky000qc000hs00f6g.jpg&amp;amp;thumbnail=650x2147483647&amp;amp;quality=80&amp;amp;type=jpg&#34; alt=&#34;linux-io&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾ä¸­ï¼Œçº¢è‰²éƒ¨åˆ†ä¸º Page Cacheã€‚å¯è§ Page Cache çš„æœ¬è´¨æ˜¯ç”± Linux å†…æ ¸ç®¡ç†çš„å†…å­˜åŒºåŸŸã€‚æˆ‘ä»¬é€šè¿‡ mmap ä»¥åŠ buffered I/O å°†æ–‡ä»¶è¯»å–åˆ°å†…å­˜ç©ºé—´å®é™…ä¸Šéƒ½æ˜¯è¯»å–åˆ° Page Cache ä¸­ã€‚&lt;/p&gt;
&lt;h3 id=&#34;12-å¦‚ä½•æŸ¥çœ‹ç³»ç»Ÿçš„-page-cache&#34;&gt;1.2 å¦‚ä½•æŸ¥çœ‹ç³»ç»Ÿçš„ Page Cacheï¼Ÿ&lt;/h3&gt;
&lt;p&gt;é€šè¿‡è¯»å– /proc/meminfo æ–‡ä»¶ï¼Œèƒ½å¤Ÿå®æ—¶è·å–ç³»ç»Ÿå†…å­˜æƒ…å†µï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;$ cat /proc/meminfo  
...  
Buffers:            1224 kB  
Cached:           111472 kB  
SwapCached:        36364 kB  
Active:          6224232 kB  
Inactive:         979432 kB  
Active(anon):    6173036 kB  
Inactive(anon):   927932 kB  
Active(file):      51196 kB  
Inactive(file):    51500 kB  
...  
Shmem:             10000 kB  
... 
SReclaimable:      43532 kB  
... 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;æ ¹æ®ä¸Šé¢çš„æ•°æ®ï¼Œä½ å¯ä»¥ç®€å•å¾—å‡ºè¿™æ ·çš„å…¬å¼ï¼ˆç­‰å¼ä¸¤è¾¹ä¹‹å’Œéƒ½æ˜¯ 112696 KBï¼‰ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Buffers + Cached + SwapCached = Active(file) + Inactive(file) + Shmem + SwapCached 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;ä¸¤è¾¹ç­‰å¼éƒ½æ˜¯ Page Cacheï¼Œå³ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;Page Cache = Buffers + Cached + SwapCached 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;é€šè¿‡é˜…è¯» 1.4 ä»¥åŠ 1.5 å°èŠ‚ï¼Œå°±èƒ½å¤Ÿç†è§£ä¸ºä»€ä¹ˆ SwapCached ä¸ Buffers ä¹Ÿæ˜¯ Page Cache çš„ä¸€éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;p&gt;é¢˜å¤–è¯ï¼Œå°ä¼™ä¼´ç­”æ¡ˆï¼š&lt;/p&gt;
&lt;p&gt;å†…æ ¸è®¡ç®—æºç ï¼ˆlinux 2.6.19ï¼‰ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F1124%2F419841c3j00r32mky000mc000hs009jg.jpg&amp;amp;thumbnail=650x2147483647&amp;amp;quality=80&amp;amp;type=jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;å†…æ ¸ç®—æ³•ï¼šCached = files - SwapCached - Buffersï¼›&lt;/p&gt;
&lt;p&gt;Buffers + Cached + SwapCached = Active(file) + Inactive(file) + Shmem + SwapCached&lt;/p&gt;
&lt;p&gt;å…¬å¼æ¨å‡ºæ¥çš„&lt;/p&gt;
&lt;p&gt;Cached = Active(file) + Inactive(file) + Shmem - Buffers ï¼›&lt;/p&gt;
&lt;p&gt;ç”±æ­¤å¯è§ï¼Œè¿™ä¸ªCached å¹¶ä¸ç­‰äºActive(file) + Inactive(file) ï¼›&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªcacheåŒ…å«å¾ˆå¤š ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å«æœ‰æ™®é€šæ–‡ä»¶æ•°æ®çš„é¡µâ€˜ï¼›&lt;/li&gt;
&lt;li&gt;å«æœ‰ç›®å½•çš„é¡µï¼›&lt;/li&gt;
&lt;li&gt;å«æœ‰ç›´æ¥ä»å—è®¾å¤‡æ–‡ä»¶(è·³è¿‡æ–‡ä»¶ç³»ç»Ÿ)è¯»å‡ºçš„æ•°æ®çš„é¡µï¼›&lt;/li&gt;
&lt;li&gt;å«æœ‰ç”¨æˆ·æ€è¿›ç¨‹æ•°æ®çš„é¡µï¼›&lt;/li&gt;
&lt;li&gt;å±äºç‰¹æ®Šæ–‡ä»¶ç³»ç»Ÿæ–‡ä»¶çš„é¡µï¼Œå¦‚shmï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;13-page-ä¸-page-cache&#34;&gt;1.3 page ä¸ Page Cache&lt;/h3&gt;
&lt;p&gt;page æ˜¯å†…å­˜ç®¡ç†åˆ†é…çš„åŸºæœ¬å•ä½ï¼Œ Page Cache ç”±å¤šä¸ª page æ„æˆã€‚page åœ¨æ“ä½œç³»ç»Ÿä¸­é€šå¸¸ä¸º 4KB å¤§å°ï¼ˆ32bits/64bitsï¼‰ï¼Œè€Œ Page Cache çš„å¤§å°åˆ™ä¸º 4KB çš„æ•´æ•°å€ã€‚&lt;/p&gt;
&lt;p&gt;å¦ä¸€æ–¹é¢ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰ page éƒ½è¢«ç»„ç»‡ä¸º Page Cacheã€‚&lt;/p&gt;
&lt;p&gt;Linux ç³»ç»Ÿä¸Šä¾›ç”¨æˆ·å¯è®¿é—®çš„å†…å­˜åˆ†ä¸ºä¸¤ä¸ªç±»å‹[2]ï¼Œå³ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;File-backed pagesï¼šæ–‡ä»¶å¤‡ä»½é¡µä¹Ÿå°±æ˜¯ Page Cache ä¸­çš„ pageï¼Œå¯¹åº”äºç£ç›˜ä¸Šçš„è‹¥å¹²æ•°æ®å—ï¼›å¯¹äºè¿™äº›é¡µæœ€å¤§çš„é—®é¢˜æ˜¯è„é¡µå›ç›˜ï¼›&lt;/li&gt;
&lt;li&gt;Anonymous pagesï¼šåŒ¿åé¡µä¸å¯¹åº”ç£ç›˜ä¸Šçš„ä»»ä½•ç£ç›˜æ•°æ®å—ï¼Œå®ƒä»¬æ˜¯è¿›ç¨‹çš„è¿è¡Œæ˜¯å†…å­˜ç©ºé—´ï¼ˆä¾‹å¦‚æ–¹æ³•æ ˆã€å±€éƒ¨å˜é‡è¡¨ç­‰å±æ€§ï¼‰ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆ Linux ä¸æŠŠ Page Cache ç§°ä¸º block cacheï¼Œè¿™ä¸æ˜¯æ›´å¥½å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯å› ä¸ºä»ç£ç›˜ä¸­åŠ è½½åˆ°å†…å­˜çš„æ•°æ®ä¸ä»…ä»…æ”¾åœ¨ Page Cache ä¸­ï¼Œè¿˜æ”¾åœ¨ buffer cache ä¸­ã€‚ä¾‹å¦‚é€šè¿‡ Direct I/O æŠ€æœ¯çš„ç£ç›˜æ–‡ä»¶å°±ä¸ä¼šè¿›å…¥ Page Cache ä¸­ã€‚å½“ç„¶ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿæœ‰ Linux å†å²è®¾è®¡çš„åŸå› ï¼Œæ¯•ç«Ÿè¿™åªæ˜¯ä¸€ä¸ªç§°å‘¼ï¼Œå«ä¹‰éšç€ Linux ç³»ç»Ÿçš„æ¼”è¿›ä¹Ÿé€æ¸ä¸åŒã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ¯”è¾ƒä¸€ä¸‹ File-backed pages ä¸ Anonymous pages åœ¨ Swap æœºåˆ¶ä¸‹çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;å†…å­˜æ˜¯ä¸€ç§çæƒœèµ„æºï¼Œå½“å†…å­˜ä¸å¤Ÿç”¨æ—¶ï¼Œå†…å­˜ç®¡ç†å•å…ƒï¼ˆMemory Mangament Unitï¼‰éœ€è¦æä¾›è°ƒåº¦ç®—æ³•æ¥å›æ”¶ç›¸å…³å†…å­˜ç©ºé—´ã€‚å†…å­˜ç©ºé—´å›æ”¶çš„æ–¹å¼é€šå¸¸å°±æ˜¯ swapï¼Œå³äº¤æ¢åˆ°æŒä¹…åŒ–å­˜å‚¨è®¾å¤‡ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;File-backed pagesï¼ˆPage Cacheï¼‰çš„å†…å­˜å›æ”¶ä»£ä»·è¾ƒä½ã€‚Page Cache é€šå¸¸å¯¹åº”äºä¸€ä¸ªæ–‡ä»¶ä¸Šçš„è‹¥å¹²é¡ºåºå—ï¼Œå› æ­¤å¯ä»¥é€šè¿‡é¡ºåº I/O çš„æ–¹å¼è½ç›˜ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœ Page Cache ä¸Šæ²¡æœ‰è¿›è¡Œå†™æ“ä½œï¼ˆæ‰€è°“çš„æ²¡æœ‰è„é¡µï¼‰ï¼Œç”šè‡³ä¸ä¼šå°† Page Cache å›ç›˜ï¼Œå› ä¸ºæ•°æ®çš„å†…å®¹å®Œå…¨å¯ä»¥é€šè¿‡å†æ¬¡è¯»å–ç£ç›˜æ–‡ä»¶å¾—åˆ°ã€‚&lt;/p&gt;
&lt;p&gt;Page Cache çš„ä¸»è¦éš¾ç‚¹åœ¨äºè„é¡µå›ç›˜ï¼Œè¿™ä¸ªå†…å®¹ä¼šåœ¨ç¬¬äºŒèŠ‚è¿›è¡Œè¯¦ç»†è¯´æ˜ã€‚&lt;/p&gt;
&lt;p&gt;Anonymous pages çš„å†…å­˜å›æ”¶ä»£ä»·è¾ƒé«˜ã€‚è¿™æ˜¯å› ä¸º Anonymous pages é€šå¸¸éšæœºåœ°å†™å…¥æŒä¹…åŒ–äº¤æ¢è®¾å¤‡ã€‚å¦ä¸€æ–¹é¢ï¼Œæ— è®ºæ˜¯å¦æœ‰æ›´æ“ä½œï¼Œä¸ºäº†ç¡®ä¿æ•°æ®ä¸ä¸¢å¤±ï¼ŒAnonymous pages åœ¨ swap æ—¶å¿…é¡»æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;14-swap-ä¸ç¼ºé¡µä¸­æ–­&#34;&gt;1.4 Swap ä¸ç¼ºé¡µä¸­æ–­&lt;/h3&gt;
&lt;p&gt;Swap æœºåˆ¶æŒ‡çš„æ˜¯å½“ç‰©ç†å†…å­˜ä¸å¤Ÿç”¨ï¼Œå†…å­˜ç®¡ç†å•å…ƒï¼ˆMemory Mangament Unitï¼‰éœ€è¦æä¾›è°ƒåº¦ç®—æ³•æ¥å›æ”¶ç›¸å…³å†…å­˜ç©ºé—´ï¼Œç„¶åå°†æ¸…ç†å‡ºæ¥çš„å†…å­˜ç©ºé—´ç»™å½“å‰å†…å­˜ç”³è¯·æ–¹ã€‚&lt;/p&gt;
&lt;p&gt;Swap æœºåˆ¶å­˜åœ¨çš„æœ¬è´¨åŸå› æ˜¯ Linux ç³»ç»Ÿæä¾›äº†è™šæ‹Ÿå†…å­˜ç®¡ç†æœºåˆ¶ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹è®¤ä¸ºå…¶ç‹¬å å†…å­˜ç©ºé—´ï¼Œå› æ­¤æ‰€æœ‰è¿›ç¨‹çš„å†…å­˜ç©ºé—´ä¹‹å’Œè¿œè¿œå¤§äºç‰©ç†å†…å­˜ã€‚æ‰€æœ‰è¿›ç¨‹çš„å†…å­˜ç©ºé—´ä¹‹å’Œè¶…è¿‡ç‰©ç†å†…å­˜çš„éƒ¨åˆ†å°±éœ€è¦äº¤æ¢åˆ°ç£ç›˜ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;æ“ä½œç³»ç»Ÿä»¥ page ä¸ºå•ä½ç®¡ç†å†…å­˜ï¼Œå½“è¿›ç¨‹å‘ç°éœ€è¦è®¿é—®çš„æ•°æ®ä¸åœ¨å†…å­˜æ—¶ï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šå°†æ•°æ®ä»¥é¡µçš„æ–¹å¼åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ä¸Šè¿°è¿‡ç¨‹è¢«ç§°ä¸ºç¼ºé¡µä¸­æ–­ï¼Œå½“æ“ä½œç³»ç»Ÿå‘ç”Ÿç¼ºé¡µä¸­æ–­æ—¶ï¼Œå°±ä¼šé€šè¿‡ç³»ç»Ÿè°ƒç”¨å°† page å†æ¬¡è¯»åˆ°å†…å­˜ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä½†ä¸»å†…å­˜çš„ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå½“ä¸»å†…å­˜ä¸­ä¸åŒ…å«å¯ä»¥ä½¿ç”¨çš„ç©ºé—´æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šä»é€‰æ‹©åˆé€‚çš„ç‰©ç†å†…å­˜é¡µé©±é€å›ç£ç›˜ï¼Œä¸ºæ–°çš„å†…å­˜é¡µè®©å‡ºä½ç½®ï¼Œé€‰æ‹©å¾…é©±é€é¡µçš„è¿‡ç¨‹åœ¨æ“ä½œç³»ç»Ÿä¸­å«åšé¡µé¢æ›¿æ¢ï¼ˆPage Replacementï¼‰ï¼Œæ›¿æ¢æ“ä½œåˆä¼šè§¦å‘ swap æœºåˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœç‰©ç†å†…å­˜è¶³å¤Ÿå¤§ï¼Œé‚£ä¹ˆå¯èƒ½ä¸éœ€è¦ Swap æœºåˆ¶ï¼Œä½†æ˜¯ Swap åœ¨è¿™ç§æƒ…å†µä¸‹è¿˜æ˜¯æœ‰ä¸€å®šä¼˜åŠ¿ï¼šå¯¹äºæœ‰å‘ç”Ÿå†…å­˜æ³„æ¼å‡ ç‡çš„åº”ç”¨ç¨‹åºï¼ˆè¿›ç¨‹ï¼‰ï¼ŒSwap äº¤æ¢åˆ†åŒºæ›´æ˜¯é‡è¦ï¼Œè¿™å¯ä»¥ç¡®ä¿å†…å­˜æ³„éœ²ä¸è‡³äºå¯¼è‡´ç‰©ç†å†…å­˜ä¸å¤Ÿç”¨ï¼Œæœ€ç»ˆå¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚ä½†å†…å­˜æ³„éœ²ä¼šå¼•èµ·é¢‘ç¹çš„ swapï¼Œæ­¤æ—¶éå¸¸å½±å“æ“ä½œç³»ç»Ÿçš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;p&gt;Linux é€šè¿‡ä¸€ä¸ª swappiness å‚æ•°æ¥æ§åˆ¶ Swap æœºåˆ¶[2]ï¼šè¿™ä¸ªå‚æ•°å€¼å¯ä¸º 0-100ï¼Œæ§åˆ¶ç³»ç»Ÿ swap çš„ä¼˜å…ˆçº§ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;é«˜æ•°å€¼ï¼šè¾ƒé«˜é¢‘ç‡çš„ swapï¼Œè¿›ç¨‹ä¸æ´»è·ƒæ—¶ä¸»åŠ¨å°†å…¶è½¬æ¢å‡ºç‰©ç†å†…å­˜ã€‚&lt;/li&gt;
&lt;li&gt;ä½æ•°å€¼ï¼šè¾ƒä½é¢‘ç‡çš„ swapï¼Œè¿™å¯ä»¥ç¡®ä¿äº¤äº’å¼ä¸å› ä¸ºå†…å­˜ç©ºé—´é¢‘ç¹åœ°äº¤æ¢åˆ°ç£ç›˜è€Œæé«˜å“åº”å»¶è¿Ÿã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æœ€åï¼Œä¸ºä»€ä¹ˆ Buffers ä¹Ÿæ˜¯ Page Cache çš„ä¸€éƒ¨åˆ†ï¼Ÿ&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯å› ä¸ºå½“åŒ¿åé¡µï¼ˆInactive(anon) ä»¥åŠ Active(anon)ï¼‰å…ˆè¢«äº¤æ¢ï¼ˆswap outï¼‰åˆ°ç£ç›˜ä¸Šåï¼Œç„¶åå†åŠ è½½å›ï¼ˆswap inï¼‰å†…å­˜ä¸­ï¼Œç”±äºè¯»å…¥åˆ°å†…å­˜ååŸæ¥çš„ Swap File è¿˜åœ¨ï¼Œæ‰€ä»¥ SwapCached ä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯ File-backed pageï¼Œå³å±äº Page Cacheã€‚è¿™ä¸ªè¿‡ç¨‹å¦‚å›¾æ‰€ç¤ºï¼š(åŒ¿åé¡µçš„è¢«äº¤æ¢åä¹Ÿæ˜¯ Page Cache)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F1124%2F3c3bdceej00r32mkz000ac000hs0064g.jpg&amp;amp;thumbnail=650x2147483647&amp;amp;quality=80&amp;amp;type=jpg&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;15-page-cache-ä¸-buffer-cache&#34;&gt;1.5 Page Cache ä¸ buffer cache&lt;/h3&gt;
&lt;p&gt;æ‰§è¡Œ free å‘½ä»¤ï¼Œæ³¨æ„åˆ°ä¼šæœ‰ä¸¤åˆ—åä¸º buffers å’Œ cachedï¼Œä¹Ÿæœ‰ä¸€è¡Œåä¸º â€œ-/+ buffers/cacheâ€ã€‚&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;~ free -m  
             total       used       free     shared    buffers     cached  
Mem:        128956      96440      32515          0       5368      39900  
-/+ buffers/cache:      51172      77784  
Swap:        16002          0      16001 
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å…¶ä¸­ï¼Œcached åˆ—è¡¨ç¤ºå½“å‰çš„é¡µç¼“å­˜ï¼ˆPage Cacheï¼‰å ç”¨é‡ï¼Œbuffers åˆ—è¡¨ç¤ºå½“å‰çš„å—ç¼“å­˜ï¼ˆbuffer cacheï¼‰å ç”¨é‡ã€‚ç”¨ä¸€å¥è¯æ¥è§£é‡Šï¼šPage Cache ç”¨äºç¼“å­˜æ–‡ä»¶çš„é¡µæ•°æ®ï¼Œbuffer cache ç”¨äºç¼“å­˜å—è®¾å¤‡ï¼ˆå¦‚ç£ç›˜ï¼‰çš„å—æ•°æ®ã€‚é¡µæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå› æ­¤ Page Cache æ˜¯ä¸æ–‡ä»¶ç³»ç»ŸåŒçº§çš„ï¼›å—æ˜¯ç‰©ç†ä¸Šçš„æ¦‚å¿µï¼Œå› æ­¤ buffer cache æ˜¯ä¸å—è®¾å¤‡é©±åŠ¨ç¨‹åºåŒçº§çš„ã€‚&lt;/p&gt;
&lt;p&gt;Page Cacheï¼‰å ç”¨é‡ï¼Œbuffers åˆ—è¡¨ç¤ºå½“å‰çš„å—ç¼“å­˜ï¼ˆbuffer cacheï¼‰å ç”¨é‡ã€‚ç”¨ä¸€å¥è¯æ¥è§£é‡Šï¼šPage Cache ç”¨äºç¼“å­˜æ–‡ä»¶çš„é¡µæ•°æ®ï¼Œbuffer cache ç”¨äºç¼“å­˜å—è®¾å¤‡ï¼ˆå¦‚ç£ç›˜ï¼‰çš„å—æ•°æ®ã€‚é¡µæ˜¯é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå› æ­¤ Page Cache æ˜¯ä¸æ–‡ä»¶ç³»ç»ŸåŒçº§çš„ï¼›å—æ˜¯ç‰©ç†ä¸Šçš„æ¦‚å¿µï¼Œå› æ­¤ buffer cache æ˜¯ä¸å—è®¾å¤‡é©±åŠ¨ç¨‹åºåŒçº§çš„ã€‚&lt;/p&gt;
&lt;p&gt;Page Cache ä¸ buffer cache çš„å…±åŒç›®çš„éƒ½æ˜¯åŠ é€Ÿæ•°æ® I/Oï¼šå†™æ•°æ®æ—¶é¦–å…ˆå†™åˆ°ç¼“å­˜ï¼Œå°†å†™å…¥çš„é¡µæ ‡è®°ä¸º dirtyï¼Œç„¶åå‘å¤–éƒ¨å­˜å‚¨ flushï¼Œä¹Ÿå°±æ˜¯ç¼“å­˜å†™æœºåˆ¶ä¸­çš„ write-backï¼ˆå¦ä¸€ç§æ˜¯ write-throughï¼ŒLinux é»˜è®¤æƒ…å†µä¸‹ä¸é‡‡ç”¨ï¼‰ï¼›è¯»æ•°æ®æ—¶é¦–å…ˆè¯»å–ç¼“å­˜ï¼Œå¦‚æœæœªå‘½ä¸­ï¼Œå†å»å¤–éƒ¨å­˜å‚¨è¯»å–ï¼Œå¹¶ä¸”å°†è¯»å–æ¥çš„æ•°æ®ä¹ŸåŠ å…¥ç¼“å­˜ã€‚æ“ä½œç³»ç»Ÿæ€»æ˜¯ç§¯æåœ°å°†æ‰€æœ‰ç©ºé—²å†…å­˜éƒ½ç”¨ä½œ Page Cache å’Œ buffer cacheï¼Œå½“å†…å­˜ä¸å¤Ÿç”¨æ—¶ä¹Ÿä¼šç”¨ LRU ç­‰ç®—æ³•æ·˜æ±°ç¼“å­˜é¡µã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ Linux 2.4 ç‰ˆæœ¬çš„å†…æ ¸ä¹‹å‰ï¼ŒPage Cache ä¸ buffer cache æ˜¯å®Œå…¨åˆ†ç¦»çš„ã€‚ä½†æ˜¯ï¼Œå—è®¾å¤‡å¤§å¤šæ˜¯ç£ç›˜ï¼Œç£ç›˜ä¸Šçš„æ•°æ®åˆå¤§å¤šé€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ¥ç»„ç»‡ï¼Œè¿™ç§è®¾è®¡å¯¼è‡´å¾ˆå¤šæ•°æ®è¢«ç¼“å­˜äº†ä¸¤æ¬¡ï¼Œæµªè´¹å†…å­˜ã€‚æ‰€ä»¥åœ¨ 2.4 ç‰ˆæœ¬å†…æ ¸ä¹‹åï¼Œä¸¤å—ç¼“å­˜è¿‘ä¼¼èåˆåœ¨äº†ä¸€èµ·ï¼šå¦‚æœä¸€ä¸ªæ–‡ä»¶çš„é¡µåŠ è½½åˆ°äº† Page Cacheï¼Œé‚£ä¹ˆåŒæ—¶ buffer cache åªéœ€è¦ç»´æŠ¤å—æŒ‡å‘é¡µçš„æŒ‡é’ˆå°±å¯ä»¥äº†ã€‚åªæœ‰é‚£äº›æ²¡æœ‰æ–‡ä»¶è¡¨ç¤ºçš„å—ï¼Œæˆ–è€…ç»•è¿‡äº†æ–‡ä»¶ç³»ç»Ÿç›´æ¥æ“ä½œï¼ˆå¦‚ddå‘½ä»¤ï¼‰çš„å—ï¼Œæ‰ä¼šçœŸæ­£æ”¾åˆ° buffer cache é‡Œã€‚å› æ­¤ï¼Œæˆ‘ä»¬ç°åœ¨æèµ· Page Cacheï¼ŒåŸºæœ¬ä¸Šéƒ½åŒæ—¶æŒ‡ Page Cache å’Œ buffer cache ä¸¤è€…ï¼Œæœ¬æ–‡ä¹‹åä¹Ÿä¸å†åŒºåˆ†ï¼Œç›´æ¥ç»Ÿç§°ä¸º Page Cacheã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹å›¾è¿‘ä¼¼åœ°ç¤ºå‡º 32-bit Linux ç³»ç»Ÿä¸­å¯èƒ½çš„ä¸€ç§ Page Cache ç»“æ„ï¼Œå…¶ä¸­ block size å¤§å°ä¸º 1KBï¼Œpage size å¤§å°ä¸º 4KBã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F1124%2F49a9a869j00r32mkz000nc000hs00cag.jpg&amp;amp;thumbnail=650x2147483647&amp;amp;quality=80&amp;amp;type=jpg&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;p&gt;Page Cache ä¸­çš„æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸€æ£µåŸºæ•°æ ‘ï¼ˆradix treeï¼Œæœ¬è´¨ä¸Šæ˜¯å¤šå‰æœç´¢æ ‘ï¼‰ï¼Œæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªé¡µã€‚æ ¹æ®æ–‡ä»¶å†…çš„åç§»é‡å°±å¯ä»¥å¿«é€Ÿå®šä½åˆ°æ‰€åœ¨çš„é¡µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å…³äºåŸºæ•°æ ‘çš„åŸç†å¯ä»¥å‚è§è‹±æ–‡ç»´åŸºï¼Œè¿™é‡Œå°±ä¸ç»†è¯´äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F1124%2Fb103f4edj00r32mkz000pc000hs00axg.jpg&amp;amp;thumbnail=650x2147483647&amp;amp;quality=80&amp;amp;type=jpg&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;16-page-cache-ä¸é¢„è¯»&#34;&gt;1.6 Page Cache ä¸é¢„è¯»&lt;/h3&gt;
&lt;p&gt;æ“ä½œç³»ç»Ÿä¸ºåŸºäº Page Cache çš„è¯»ç¼“å­˜æœºåˆ¶æä¾›é¢„è¯»æœºåˆ¶ï¼ˆPAGE_READAHEADï¼‰ï¼Œä¸€ä¸ªä¾‹å­æ˜¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç”¨æˆ·çº¿ç¨‹ä»…ä»…è¯·æ±‚è¯»å–ç£ç›˜ä¸Šæ–‡ä»¶ A çš„ offset ä¸º 0-3KB èŒƒå›´å†…çš„æ•°æ®ï¼Œç”±äºç£ç›˜çš„åŸºæœ¬è¯»å†™å•ä½ä¸º blockï¼ˆ4KBï¼‰ï¼Œäºæ˜¯æ“ä½œç³»ç»Ÿè‡³å°‘ä¼šè¯» 0-4KB çš„å†…å®¹ï¼Œè¿™æ°å¥½å¯ä»¥åœ¨ä¸€ä¸ª page ä¸­è£…ä¸‹ã€‚&lt;/li&gt;
&lt;li&gt;ä½†æ˜¯æ“ä½œç³»ç»Ÿå‡ºäºå±€éƒ¨æ€§åŸç†ä¼šé€‰æ‹©å°†ç£ç›˜å— offset [4KB,8KB)ã€[8KB,12KB) ä»¥åŠ [12KB,16KB) éƒ½åŠ è½½åˆ°å†…å­˜ï¼Œäºæ˜¯é¢å¤–åœ¨å†…å­˜ä¸­ç”³è¯·äº† 3 ä¸ª pageï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸‹å›¾ä»£è¡¨äº†æ“ä½œç³»ç»Ÿçš„é¢„è¯»æœºåˆ¶ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2021%2F1124%2Fb5460636j00r32mkz0013c0010q00ayg.jpg&amp;amp;thumbnail=650x2147483647&amp;amp;quality=80&amp;amp;type=jpg&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾ä¸­ï¼Œåº”ç”¨ç¨‹åºåˆ©ç”¨ read ç³»ç»Ÿè°ƒåŠ¨è¯»å– 4KB æ•°æ®ï¼Œå®é™…ä¸Šå†…æ ¸ä½¿ç”¨ readahead æœºåˆ¶å®Œæˆäº† 16KB æ•°æ®çš„è¯»å–ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2page-cache-ä¸æ–‡ä»¶æŒä¹…åŒ–çš„ä¸€è‡´æ€§å¯é æ€§&#34;&gt;2ã€Page Cache ä¸æ–‡ä»¶æŒä¹…åŒ–çš„ä¸€è‡´æ€§&amp;amp;å¯é æ€§&lt;/h2&gt;
&lt;p&gt;ç°ä»£ Linux çš„ Page Cache æ­£å¦‚å…¶åï¼Œæ˜¯å¯¹ç£ç›˜ä¸Š pageï¼ˆé¡µï¼‰çš„å†…å­˜ç¼“å­˜ï¼ŒåŒæ—¶å¯ä»¥ç”¨äºè¯»/å†™æ“ä½œã€‚ä¸€åˆ‡å†…å­˜ç¼“å­˜éƒ½å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜ï¼šå†…å­˜ä¸­çš„æ•°æ®ä¸ç£ç›˜ä¸­çš„æ•°æ®ä¸ä¸€è‡´ï¼Œä¾‹å¦‚ç”¨ä½œåˆ†å¸ƒå¼ä¸­é—´ä»¶ç¼“å­˜çš„ Redis å°±ä¸ MySQL ç­‰æ•°æ®åº“ä¸­çš„æ•°æ®å­˜åœ¨ä¸ä¸€è‡´ã€‚&lt;/p&gt;
&lt;p&gt;Linux æä¾›å¤šç§æœºåˆ¶æ¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œä½†æ— è®ºæ˜¯å•æœºä¸Šçš„å†…å­˜ä¸ç£ç›˜ä¸€è‡´æ€§ï¼Œè¿˜æ˜¯åˆ†å¸ƒå¼ç»„ä»¶ä¸­èŠ‚ç‚¹ 1 ä¸èŠ‚ç‚¹ 2 ã€èŠ‚ç‚¹ 3 çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œç†è§£çš„å…³é”®æ˜¯ trade-offï¼šååé‡ä¸æ•°æ®ä¸€è‡´æ€§ä¿è¯æ˜¯ä¸€å¯¹çŸ›ç›¾ã€‚&lt;/p&gt;
&lt;p&gt;é¦–å…ˆï¼Œéœ€è¦æˆ‘ä»¬ç†è§£ä¸€ä¸‹æ–‡ä»¶çš„æ•°æ®ã€‚æ–‡ä»¶ = æ•°æ® + å…ƒæ•°æ®ã€‚å…ƒæ•°æ®ç”¨æ¥æè¿°æ–‡ä»¶çš„å„ç§å±æ€§ï¼Œä¹Ÿå¿…é¡»å­˜å‚¨åœ¨ç£ç›˜ä¸Šã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¯´ä¿è¯æ–‡ä»¶ä¸€è‡´æ€§å…¶å®åŒ…å«äº†ä¸¤ä¸ªæ–¹é¢ï¼šæ•°æ®ä¸€è‡´+å…ƒæ•°æ®ä¸€è‡´ã€‚&lt;/p&gt;
&lt;p&gt;æ–‡ä»¶çš„å…ƒæ•°æ®åŒ…æ‹¬ï¼šæ–‡ä»¶å¤§å°ã€åˆ›å»ºæ—¶é—´ã€è®¿é—®æ—¶é—´ã€å±ä¸»å±ç»„ç­‰ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä»¬è€ƒè™‘å¦‚ä¸‹ä¸€è‡´æ€§é—®é¢˜ï¼šå¦‚æœå‘ç”Ÿå†™æ“ä½œå¹¶ä¸”å¯¹åº”çš„æ•°æ®åœ¨ Page Cache ä¸­ï¼Œé‚£ä¹ˆå†™æ“ä½œå°±ä¼šç›´æ¥ä½œç”¨äº Page Cache ä¸­ï¼Œæ­¤æ—¶å¦‚æœæ•°æ®è¿˜æ²¡åˆ·æ–°åˆ°ç£ç›˜ï¼Œé‚£ä¹ˆå†…å­˜ä¸­çš„æ•°æ®å°±é¢†å…ˆäºç£ç›˜ï¼Œæ­¤æ—¶å¯¹åº” page å°±è¢«ç§°ä¸º Dirty pageã€‚&lt;/p&gt;
&lt;p&gt;å½“å‰ Linux ä¸‹ä»¥ä¸¤ç§æ–¹å¼å®ç°æ–‡ä»¶ä¸€è‡´æ€§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Write Throughï¼ˆå†™ç©¿ï¼‰ï¼šå‘ç”¨æˆ·å±‚æä¾›ç‰¹å®šæ¥å£ï¼Œåº”ç”¨ç¨‹åºå¯ä¸»åŠ¨è°ƒç”¨æ¥å£æ¥ä¿è¯æ–‡ä»¶ä¸€è‡´æ€§ï¼›&lt;/li&gt;
&lt;li&gt;Write backï¼ˆå†™å›ï¼‰ï¼šç³»ç»Ÿä¸­å­˜åœ¨å®šæœŸä»»åŠ¡ï¼ˆè¡¨ç°å½¢å¼ä¸ºå†…æ ¸çº¿ç¨‹ï¼‰ï¼Œå‘¨æœŸæ€§åœ°åŒæ­¥æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶è„æ•°æ®å—ï¼Œè¿™æ˜¯é»˜è®¤çš„ Linux ä¸€è‡´æ€§æ–¹æ¡ˆï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸Šè¿°ä¸¤ç§æ–¹å¼æœ€ç»ˆéƒ½ä¾èµ–äºç³»ç»Ÿè°ƒç”¨ï¼Œä¸»è¦åˆ†ä¸ºå¦‚ä¸‹ä¸‰ç§ç³»ç»Ÿè°ƒç”¨ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;æ–¹æ³•&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;å«ä¹‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;fsync(intfd)&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;fsync(fd)ï¼šå°† fd ä»£è¡¨çš„æ–‡ä»¶çš„è„æ•°æ®å’Œè„å…ƒæ•°æ®å…¨éƒ¨åˆ·æ–°è‡³ç£ç›˜ä¸­ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;fdatasync (int fd)&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;fdatasync(fd)ï¼šå°† fd ä»£è¡¨çš„æ–‡ä»¶çš„è„æ•°æ®åˆ·æ–°è‡³ç£ç›˜ï¼ŒåŒæ—¶å¯¹å¿…è¦çš„å…ƒæ•°æ®åˆ·æ–°è‡³ç£ç›˜ä¸­ï¼Œè¿™é‡Œæ‰€è¯´çš„å¿…è¦çš„æ¦‚å¿µæ˜¯æŒ‡ï¼šå¯¹æ¥ä¸‹æ¥è®¿é—®æ–‡ä»¶æœ‰å…³é”®ä½œç”¨çš„ä¿¡æ¯ï¼Œå¦‚æ–‡ä»¶å¤§å°ï¼Œè€Œæ–‡ä»¶ä¿®æ”¹æ—¶é—´ç­‰ä¸å±äºå¿…è¦ä¿¡æ¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;&lt;strong&gt;sync()&lt;/strong&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;sync()ï¼šåˆ™æ˜¯å¯¹ç³»ç»Ÿä¸­æ‰€æœ‰çš„è„çš„æ–‡ä»¶æ•°æ®å…ƒæ•°æ®åˆ·æ–°è‡³ç£ç›˜ä¸­&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ä¸Šè¿°ä¸‰ç§ç³»ç»Ÿè°ƒç”¨å¯ä»¥åˆ†åˆ«ç”±ç”¨æˆ·è¿›ç¨‹ä¸å†…æ ¸è¿›ç¨‹å‘èµ·ã€‚ä¸‹é¢æˆ‘ä»¬ç ”ç©¶ä¸€ä¸‹å†…æ ¸çº¿ç¨‹çš„ç›¸å…³ç‰¹æ€§ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»ºçš„é’ˆå¯¹å›å†™ä»»åŠ¡çš„å†…æ ¸çº¿ç¨‹æ•°ç”±ç³»ç»Ÿä¸­æŒä¹…å­˜å‚¨è®¾å¤‡å†³å®šï¼Œä¸ºæ¯ä¸ªå­˜å‚¨è®¾å¤‡åˆ›å»ºå•ç‹¬çš„åˆ·æ–°çº¿ç¨‹ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å…³äºå¤šçº¿ç¨‹çš„æ¶æ„é—®é¢˜ï¼ŒLinux å†…æ ¸é‡‡å–äº† Lighthttp çš„åšæ³•ï¼Œå³ç³»ç»Ÿä¸­å­˜åœ¨ä¸€ä¸ªç®¡ç†çº¿ç¨‹å’Œå¤šä¸ªåˆ·æ–°çº¿ç¨‹ï¼ˆæ¯ä¸ªæŒä¹…å­˜å‚¨è®¾å¤‡å¯¹åº”ä¸€ä¸ªåˆ·æ–°çº¿ç¨‹ï¼‰ã€‚ç®¡ç†çº¿ç¨‹ç›‘æ§è®¾å¤‡ä¸Šçš„è„é¡µé¢æƒ…å†µï¼Œè‹¥è®¾å¤‡ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰äº§ç”Ÿè„é¡µé¢ï¼Œå°±é”€æ¯è®¾å¤‡ä¸Šçš„åˆ·æ–°çº¿ç¨‹ï¼›è‹¥ç›‘æµ‹åˆ°è®¾å¤‡ä¸Šæœ‰è„é¡µé¢éœ€è¦å›å†™ä¸”å°šæœªä¸ºè¯¥è®¾å¤‡åˆ›å»ºåˆ·æ–°çº¿ç¨‹ï¼Œé‚£ä¹ˆåˆ›å»ºåˆ·æ–°çº¿ç¨‹å¤„ç†è„é¡µé¢å›å†™ã€‚è€Œåˆ·æ–°çº¿ç¨‹çš„ä»»åŠ¡è¾ƒä¸ºå•è°ƒï¼Œåªè´Ÿè´£å°†è®¾å¤‡ä¸­çš„è„é¡µé¢å›å†™è‡³æŒä¹…å­˜å‚¨è®¾å¤‡ä¸­ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ·æ–°çº¿ç¨‹åˆ·æ–°è®¾å¤‡ä¸Šè„é¡µé¢å¤§è‡´è®¾è®¡å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;æ¯ä¸ªè®¾å¤‡ä¿å­˜è„æ–‡ä»¶é“¾è¡¨ï¼Œä¿å­˜çš„æ˜¯è¯¥è®¾å¤‡ä¸Šå­˜å‚¨çš„è„æ–‡ä»¶çš„ inode èŠ‚ç‚¹ã€‚æ‰€è°“çš„å›å†™æ–‡ä»¶è„é¡µé¢å³å›å†™è¯¥ inode é“¾è¡¨ä¸Šçš„æŸäº›æ–‡ä»¶çš„è„é¡µé¢ï¼›&lt;/p&gt;
&lt;p&gt;ç³»ç»Ÿä¸­å­˜åœ¨å¤šä¸ªå›å†™æ—¶æœºï¼Œç¬¬ä¸€æ˜¯åº”ç”¨ç¨‹åºä¸»åŠ¨è°ƒç”¨å›å†™æ¥å£ï¼ˆfsyncï¼Œfdatasync ä»¥åŠ sync ç­‰ï¼‰ï¼Œç¬¬äºŒç®¡ç†çº¿ç¨‹å‘¨æœŸæ€§åœ°å”¤é†’è®¾å¤‡ä¸Šçš„å›å†™çº¿ç¨‹è¿›è¡Œå›å†™ï¼Œç¬¬ä¸‰æ˜¯æŸäº›åº”ç”¨ç¨‹åº/å†…æ ¸ä»»åŠ¡å‘ç°å†…å­˜ä¸è¶³æ—¶è¦å›æ”¶éƒ¨åˆ†ç¼“å­˜é¡µé¢è€Œäº‹å…ˆè¿›è¡Œè„é¡µé¢å›å†™ï¼Œè®¾è®¡ä¸€ä¸ªç»Ÿä¸€çš„æ¡†æ¶æ¥ç®¡ç†è¿™äº›å›å†™ä»»åŠ¡éå¸¸æœ‰å¿…è¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Write Through ä¸ Write back åœ¨æŒä¹…åŒ–çš„å¯é æ€§ä¸Šæœ‰æ‰€ä¸åŒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Write Through ä»¥ç‰ºç‰²ç³»ç»Ÿ I/O ååé‡ä½œä¸ºä»£ä»·ï¼Œå‘ä¸Šå±‚åº”ç”¨ç¡®ä¿ä¸€æ—¦å†™å…¥ï¼Œæ•°æ®å°±å·²ç»è½ç›˜ï¼Œä¸ä¼šä¸¢å¤±ï¼›&lt;/li&gt;
&lt;li&gt;Write back åœ¨ç³»ç»Ÿå‘ç”Ÿå®•æœºçš„æƒ…å†µä¸‹æ— æ³•ç¡®ä¿æ•°æ®å·²ç»è½ç›˜ï¼Œå› æ­¤å­˜åœ¨æ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚ä¸è¿‡ï¼Œåœ¨ç¨‹åºæŒ‚äº†ï¼Œä¾‹å¦‚è¢« kill -9ï¼ŒPage Cache ä¸­çš„æ•°æ®æ“ä½œç³»ç»Ÿè¿˜æ˜¯ä¼šç¡®ä¿è½ç›˜ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;3ä¸ºä»€ä¹ˆä½¿ç”¨-page-cache-ä¸ä¸ºä»€ä¹ˆä¸ä½¿ç”¨-page-cache&#34;&gt;3ã€ä¸ºä»€ä¹ˆä½¿ç”¨ Page Cache ä¸ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ Page Cache?&lt;/h2&gt;
&lt;h3 id=&#34;31-page-cache-çš„ä¼˜åŠ¿&#34;&gt;3.1 Page Cache çš„ä¼˜åŠ¿&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;1.åŠ å¿«æ•°æ®è®¿é—®&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœæ•°æ®èƒ½å¤Ÿåœ¨å†…å­˜ä¸­è¿›è¡Œç¼“å­˜ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡è®¿é—®å°±ä¸éœ€è¦é€šè¿‡ç£ç›˜ I/O äº†ï¼Œç›´æ¥å‘½ä¸­å†…å­˜ç¼“å­˜å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;ç”±äºå†…å­˜è®¿é—®æ¯”ç£ç›˜è®¿é—®å¿«å¾ˆå¤šï¼Œå› æ­¤åŠ å¿«æ•°æ®è®¿é—®æ˜¯ Page Cache çš„ä¸€å¤§ä¼˜åŠ¿ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2.å‡å°‘ I/O æ¬¡æ•°ï¼Œæé«˜ç³»ç»Ÿç£ç›˜ I/O ååé‡&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¾—ç›Šäº Page Cache çš„ç¼“å­˜ä»¥åŠé¢„è¯»èƒ½åŠ›ï¼Œè€Œç¨‹åºåˆå¾€å¾€ç¬¦åˆå±€éƒ¨æ€§åŸç†ï¼Œå› æ­¤é€šè¿‡ä¸€æ¬¡ I/O å°†å¤šä¸ª page è£…å…¥ Page Cache èƒ½å¤Ÿå‡å°‘ç£ç›˜ I/O æ¬¡æ•°ï¼Œ è¿›è€Œæé«˜ç³»ç»Ÿç£ç›˜ I/O ååé‡ã€‚&lt;/p&gt;
&lt;h3 id=&#34;32-page-cache-çš„åŠ£åŠ¿&#34;&gt;3.2 Page Cache çš„åŠ£åŠ¿&lt;/h3&gt;
&lt;p&gt;page cache ä¹Ÿæœ‰å…¶åŠ£åŠ¿ï¼Œæœ€ç›´æ¥çš„ç¼ºç‚¹æ˜¯éœ€è¦å ç”¨é¢å¤–ç‰©ç†å†…å­˜ç©ºé—´ï¼Œç‰©ç†å†…å­˜åœ¨æ¯”è¾ƒç´§ä¿çš„æ—¶å€™å¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹çš„ swap æ“ä½œï¼Œæœ€ç»ˆå¯¼è‡´ç³»ç»Ÿçš„ç£ç›˜ I/O è´Ÿè½½çš„ä¸Šå‡ã€‚&lt;/p&gt;
&lt;p&gt;Page Cache çš„å¦ä¸€ä¸ªç¼ºé™·æ˜¯å¯¹äºåº”ç”¨å±‚å¹¶æ²¡æœ‰æä¾›å¾ˆå¥½çš„ç®¡ç† APIï¼Œå‡ ä¹æ˜¯é€æ˜ç®¡ç†ã€‚åº”ç”¨å±‚å³ä½¿æƒ³ä¼˜åŒ– Page Cache çš„ä½¿ç”¨ç­–ç•¥ä¹Ÿå¾ˆéš¾è¿›è¡Œã€‚å› æ­¤ä¸€äº›åº”ç”¨é€‰æ‹©åœ¨ç”¨æˆ·ç©ºé—´å®ç°è‡ªå·±çš„ page ç®¡ç†ï¼Œä¾‹å¦‚ MySQL InnoDB å­˜å‚¨å¼•æ“ä»¥ 16KB çš„é¡µè¿›è¡Œç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;Page Cache æœ€åä¸€ä¸ªç¼ºé™·æ˜¯åœ¨æŸäº›åº”ç”¨åœºæ™¯ä¸‹æ¯” Direct I/O å¤šä¸€æ¬¡ç£ç›˜è¯» I/O ä»¥åŠç£ç›˜å†™ I/Oã€‚&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>WAL</title>
      <link>https://weedge.github.io/post/wal/</link>
      <pubDate>Sun, 21 Nov 2021 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/wal/</guid>
      
        <description>&lt;h2 id=&#34;åºè¨€&#34;&gt;åºè¨€&lt;/h2&gt;
&lt;p&gt;â€‹	æ•°æ®è½åœ°ä¹‹å‰ï¼Œå¦‚æœå‡ºç°æŒä¹…åŒ–å­˜å‚¨å¼•æ“å®ä¾‹é‡å¯ï¼Œæˆ–è€…æœåŠ¡å½“æœºé‡å¯ï¼Œå¦‚ä½•è¿›è¡Œæ•…éšœæ¢å¤ï¼ˆCrash Recoveryï¼‰å‘¢ï¼Ÿæ•°æ®å†™æ“ä½œå¢åˆ æ”¹ï¼Œè¿™äº›æ“ä½œçŠ¶æ€æ•°æ®ï¼Œæ˜¯å¦‚ä½•ä¿è¯äº‹åŠ¡ä¸­åŸå­æ€§å’ŒæŒä¹…æ€§çš„å‘¢ï¼Ÿ è¿™äº›é—®é¢˜æ•°æ®å¤§æ‹¿ä»¬æå‡ºäº†&lt;a href=&#34;https://en.wikipedia.org/wiki/Algorithms_for_Recovery_and_Isolation_Exploiting_Semantics&#34;&gt;Algorithms for Recovery and Isolation Exploiting Semantics&lt;/a&gt; ï¼ŒåŸºäºè¯­ä¹‰çš„æ¢å¤ä¸éš”ç¦»ç®—æ³•,ç°ä»£æ•°æ®åº“çš„åŸºç¡€ç†è®ºï¼›å½“å‰ä¸»æµå…³ç³»å‹æ•°æ®åœ¨äº‹åŠ¡å®ç°ä¸Šéƒ½å—åˆ°è¯¥ç†è®ºçš„å½±å“ï¼Œå…¶ä¸­æœ‰ä¸¤ç§æ•…éšœæ¢å¤çš„æ–¹æ³•ï¼š é¢„å†™æ—¥å¿—(write-ahead logging (WAL) ) å’Œshadow-page techniqueï¼›shadow-page æ–¹æ³•ç®€å•ä»‹ç»å°±æ˜¯æ¯æ¬¡äº‹åŠ¡æ“ä½œï¼Œä»¥pageä¸ºå•ä½ï¼Œå†™æ—¶å¤åˆ¶çš„æ–¹å¼ï¼Œåˆ†ä¸ºCurrentå’ŒShadowï¼Œç±»ä¼¼ä¸»å¤‡çš„å½¢å¼ï¼Œå¦‚æœcommitæˆåŠŸï¼ŒCurrentä¸­çš„pageåˆå¹¶åˆ° Shadowä¸­; å¦‚æœabortä¸æˆåŠŸä¸¢å¼ƒCurrentçš„page; å¦‚æœCrashäº†ï¼Œä»Shadowä¸­çš„pageæ¢å¤ï¼Œå¯¹æ‰€æœ‰æœªæäº¤äº‹åŠ¡çš„å›æ»šæ“ä½œï¼› ç”±äºshadow-pageæŠ€æœ¯çš„å®ç°ä»¥pageä¸ºå•ä½ï¼Œpageå†…æ— æ³•å¹¶å‘æ“ä½œï¼Œcommit/å›æ»šæ—¶ä¼šæœ‰å¤§é‡åƒåœ¾å›æ”¶æ“ä½œï¼›æœ¬æ–‡ä¸»è¦ä»‹ç»WALï¼Œä»¥åŠå¯¹åº”æŒä¹…åŒ–å­˜å‚¨å¼•æ“çš„å®ç°æœºåˆ¶ä»‹ç»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;wal&#34;&gt;WAL&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;é¢„å†™æ—¥å¿—&lt;/strong&gt;( &lt;strong&gt;WAL&lt;/strong&gt; ) æ˜¯ä¸€ç³»åˆ—æŠ€æœ¯ï¼Œç”¨äºåœ¨&lt;a href=&#34;https://en.wikipedia.org/wiki/Database_system&#34;&gt;æ•°æ®åº“ç³»ç»Ÿä¸­&lt;/a&gt;æä¾›&lt;a href=&#34;https://en.wikipedia.org/wiki/Atomicity_(database_systems)&#34;&gt;åŸå­æ€§&lt;/a&gt;å’Œ&lt;a href=&#34;https://en.wikipedia.org/wiki/Durability_(database_systems)&#34;&gt;æŒä¹…æ€§&lt;/a&gt;ï¼ˆä¸¤ä¸ª&lt;a href=&#34;https://en.wikipedia.org/wiki/ACID&#34;&gt;ACID&lt;/a&gt;å±æ€§ï¼‰ã€‚åœ¨å°†æ›´æ”¹å†™å…¥æ•°æ®åº“ä¹‹å‰ï¼Œæ›´æ”¹é¦–å…ˆè®°å½•åœ¨æ—¥å¿—ä¸­ï¼Œæ—¥å¿—å¿…é¡»å†™å…¥&lt;a href=&#34;https://en.wikipedia.org/wiki/Stable_storage&#34;&gt;ç¨³å®šå­˜å‚¨&lt;/a&gt;ï¼ˆä¿è¯ä»»ä½•ç»™å®šå†™å…¥æ“ä½œçš„åŸå­æ€§ï¼Œå¹¶å…è®¸ç¼–å†™å¯¹æŸäº›ç¡¬ä»¶å’Œç”µæºæ•…éšœå…·æœ‰&lt;a href=&#34;https://en.wikipedia.org/wiki/Robustness_(computer_science)&#34;&gt;é²æ£’æ€§çš„&lt;/a&gt;è½¯ä»¶ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ ·åšçš„ç›®çš„å¯ä»¥é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå½“è¿è¡Œå®ƒçš„æœºå™¨æ–­ç”µæ—¶ï¼Œå®ƒæ­£åœ¨æ‰§è¡ŒæŸäº›æ“ä½œã€‚é‡æ–°å¯åŠ¨æ—¶ï¼Œè¯¥ç¨‹åºå¯èƒ½éœ€è¦çŸ¥é“å®ƒæ­£åœ¨æ‰§è¡Œçš„æ“ä½œæ˜¯æˆåŠŸã€éƒ¨åˆ†æˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚å¦‚æœä½¿ç”¨é¢„å†™æ—¥å¿—ï¼Œç¨‹åºå¯ä»¥æ£€æŸ¥æ­¤æ—¥å¿—å¹¶å°†æ„å¤–æ–­ç”µæ—¶åº”è¯¥æ‰§è¡Œçš„æ“ä½œä¸å®é™…æ‰§è¡Œçš„æ“ä½œè¿›è¡Œæ¯”è¾ƒã€‚åœ¨æ­¤æ¯”è¾ƒçš„åŸºç¡€ä¸Šï¼Œç¨‹åºå¯ä»¥å†³å®šæ’¤æ¶ˆå·²å¼€å§‹çš„å†…å®¹ã€å®Œæˆå·²å¼€å§‹çš„å†…å®¹æˆ–ä¿æŒåŸæ ·ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä½¿ç”¨ WAL çš„ç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰ä¿®æ”¹åœ¨åº”ç”¨ä¹‹å‰éƒ½ä¼šå†™å…¥&lt;a href=&#34;https://en.wikipedia.org/wiki/Database_log&#34;&gt;æ—¥å¿—&lt;/a&gt;ã€‚é€šå¸¸redoå’Œundoä¿¡æ¯éƒ½å­˜å‚¨åœ¨æ—¥å¿—ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;æ³¨æ„ï¼šå†™ä¸ä¸€å®šæ˜¯é¡ºåºå†™ï¼Œä¸€èˆ¬&lt;a href=&#34;https://en.wikipedia.org/wiki/Computer_data_storage&#34;&gt;è®¡ç®—æœºå­˜å‚¨&lt;/a&gt; éæ˜“å¤±æ€§çš„ç¡¬ä»¶ç»“æ„å¯¹é¡ºåºå†™çš„æ€§èƒ½é«˜äºéšæœºå†™çš„æ€§èƒ½ï¼Œæ¯”å¦‚å¸¸ç”¨çš„ç£ç›˜HDD/SSD; ä½†æ˜¯æœ€è¿‘åŸºäºNVMæŠ€æœ¯(ç»“åˆç£ç›˜å’Œå†…å­˜çš„ç‰¹æ€§)çš„å­˜å‚¨ç¡¬ä»¶PC-RAM(Phase Change Random Access Memory), STT-RAM( Spin Transfer Torque Random Access Memory),  R-RAM(Resistive Random Access Memory)ï¼Œç»“åˆå†…å­˜ä¸­éšæœºè®¿é—®ï¼Œç£ç›˜éæ˜“å¤±æ€§ç‰¹æ€§ï¼Œéšæœºå†™å’Œé¡ºåºå†™æ²¡ä»€ä¹ˆå·®åˆ«ï¼Œ&lt;a href=&#34;http://repository.bilkent.edu.tr/bitstream/handle/11693/37609/Implications%20of%20non-volatile%20memory%20as%20primary%20storage%20for%20database%20management%20systems.pdf&#34;&gt;Implications of Non-Volatile Memory as Primary Storage for Database Management Systems&lt;/a&gt; è¿™ç¯‡è®ºæ–‡ä¸­æåˆ°Pgå¦‚æœä¸éƒ¨ç½²å†…éƒ¨çš„buffer cacheï¼Œæ‰€æœ‰å†™ç›´æ¥å†™åˆ°NVMå¯¹åº”çš„å­˜å‚¨ç¡¬ä»¶ä¸­ï¼Œå¯ä»¥å»æ‰redoæ—¥å¿—ï¼Œä½†æ˜¯undoæ—¥å¿—ä»»ç„¶éœ€è¦,åœ¨ç³»ç»Ÿé”™è¯¯æ—¶å¤åŸ; ä¸€èˆ¬å­¦æœ¯æ–¹æ¡ˆè¦é¢†å…ˆå®é™…å·¥ç¨‹è®¸å¤šï¼ŒçœŸæ­£è½åœ°åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿˜æ˜¯ç”¨èººè¿‡å‘çš„æˆç†Ÿæ–¹æ¡ˆ ï¼ˆé¡ºä¾¿æƒ³åˆ°ç°åœ¨ä¸€äº›k/vå­˜å‚¨å¼•æ“è€ƒè™‘ä¸Šäº‘ï¼Œæ”¯æŒäº‘å‚å•†çš„äº‘ç›˜ï¼Œå¯ä»¥è®¤ä¸ºæ— é™å®¹é‡ï¼‰ã€‚ç¡¬ä»¶ç»“æ„å†³å®šä¸Šå±‚è½¯ä»¶å­˜å‚¨å¼•æ“çš„è®¾è®¡çš„ä¼˜åŒ–ï¼Œä»¥ä¸‹éƒ½æ˜¯ä»¥å¸¸ç”¨çš„ç£ç›˜HDD/SSDçš„ç¡¬ä»¶ç»“æ„æ¥ä»‹ç»å­˜å‚¨å¼•æ“å®ç°WALæŠ€æœ¯ã€‚&lt;/p&gt;
&lt;h2 id=&#34;mysql-innodbå­˜å‚¨å¼•æ“&#34;&gt;mysql Innodbå­˜å‚¨å¼•æ“&lt;/h2&gt;
&lt;p&gt;mysql Innodbå­˜å‚¨å¼•æ“æ˜¯é€šè¿‡ redoã€undo æ—¥å¿—å®ç° WAL,ä¸»è¦ç”¨äºcrash æ¢å¤å’Œå›æ»šï¼Œæ»¡è¶³æœ¬åœ°äº‹åŠ¡ä¸­çš„æŒä¹…æ€§å’ŒåŸå­æ€§ï¼Œæ¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼›å½“ç„¶innodbå¼•æ“ä¸ºäº†æé«˜å¹¶å‘è¯»æ€§èƒ½ï¼Œundo logä¸­åŠ å…¥äº†MVCC (å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)ç›¸å…³ä¿¡æ¯ï¼› å¦å¤–ï¼Œmysql serverå±‚æ‰§è¡Œå™¨ä¼šå†™bin logï¼Œä¸»è¦æ˜¯ç”¨æ¥æ¢å¤æŸä¸ªæ—¶é—´çš„ç‚¹æ•°æ®ä»¥åŠä¸»ä»å¤åˆ¶æ•°æ®ä½¿ç”¨ï¼Œbin logæ–‡ä»¶å’Œå­˜å‚¨å¼•æ“æ— å…³ï¼›åˆ†åˆ«ç®€è¦ä»‹ç»redo, undo, bin log æ–‡ä»¶åœ¨mysqlä¸­çš„ä½œç”¨ã€‚&lt;/p&gt;
&lt;h3 id=&#34;redolog&#34;&gt;redolog&lt;/h3&gt;
&lt;h4 id=&#34;ä¸ºä»€ä¹ˆéœ€è¦redo-log&#34;&gt;ä¸ºä»€ä¹ˆéœ€è¦redo logï¼Ÿ&lt;/h4&gt;
&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œäº‹åŠ¡çš„å››å¤§ç‰¹æ€§é‡Œé¢æœ‰ä¸€ä¸ªæ˜¯ &lt;strong&gt;æŒä¹…æ€§&lt;/strong&gt; ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯&lt;strong&gt;åªè¦äº‹åŠ¡æäº¤æˆåŠŸï¼Œé‚£ä¹ˆå¯¹æ•°æ®åº“åšçš„ä¿®æ”¹å°±è¢«æ°¸ä¹…ä¿å­˜ä¸‹æ¥äº†ï¼Œä¸å¯èƒ½å› ä¸ºä»»ä½•åŸå› å†å›åˆ°åŸæ¥çš„çŠ¶æ€&lt;/strong&gt; ã€‚é‚£ä¹ˆmysqlæ˜¯å¦‚ä½•ä¿è¯ä¸€è‡´æ€§çš„å‘¢ï¼Ÿæœ€ç®€å•çš„åšæ³•æ˜¯åœ¨æ¯æ¬¡äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå°†è¯¥äº‹åŠ¡æ¶‰åŠä¿®æ”¹çš„æ•°æ®é¡µå…¨éƒ¨åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚ä½†æ˜¯è¿™ä¹ˆåšä¼šæœ‰ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼Œä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å› ä¸º Innodbæ˜¯ä»¥é¡µä¸ºå•ä½è¿›è¡Œç£ç›˜äº¤äº’çš„ï¼Œè€Œä¸€ä¸ªäº‹åŠ¡å¾ˆå¯èƒ½åªä¿®æ”¹ä¸€ä¸ªæ•°æ®é¡µé‡Œé¢çš„å‡ ä¸ªå­—èŠ‚ï¼Œè¿™ä¸ªæ—¶å€™å°†å®Œæ•´çš„æ•°æ®é¡µåˆ·åˆ°ç£ç›˜çš„è¯ï¼Œå¤ªæµªè´¹èµ„æºäº†ï¼&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªäº‹åŠ¡å¯èƒ½æ¶‰åŠä¿®æ”¹å¤šä¸ªæ•°æ®é¡µï¼Œå¹¶ä¸”è¿™äº›æ•°æ®é¡µåœ¨ç‰©ç†ä¸Šå¹¶ä¸è¿ç»­ï¼Œä½¿ç”¨éšæœºIOå†™å…¥æ€§èƒ½å¤ªå·®ï¼&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å› æ­¤ mysqlè®¾è®¡äº†redolog ï¼Œ &lt;strong&gt;å…·ä½“æ¥è¯´å°±æ˜¯åªè®°å½•äº‹åŠ¡å¯¹æ•°æ®é¡µåšäº†å“ªäº›ä¿®æ”¹&lt;/strong&gt;ï¼Œè¿™æ ·å°±èƒ½å®Œç¾åœ°è§£å†³æ€§èƒ½é—®é¢˜äº†(ç›¸å¯¹è€Œè¨€æ–‡ä»¶æ›´å°å¹¶ä¸”æ˜¯é¡ºåºIO)ã€‚&lt;/p&gt;
&lt;h4 id=&#34;redo-logåŸºæœ¬æ¦‚å¿µ&#34;&gt;redo logåŸºæœ¬æ¦‚å¿µ&lt;/h4&gt;
&lt;p&gt;redo logåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šä¸€ä¸ªæ˜¯å†…å­˜ä¸­çš„æ—¥å¿—ç¼“å†²( redo log buffer )ï¼Œå¦ä¸€ä¸ªæ˜¯ç£ç›˜ä¸Šçš„æ—¥å¿—æ–‡ä»¶(  redo log file )ã€‚ mysql æ¯æ‰§è¡Œä¸€æ¡ DML ä¿®æ”¹å†™è¯­å¥ï¼Œæ“ä½œçš„æ•°æ®åœ¨å†…å­˜ä¸­(å¦‚æœæ²¡æœ‰ä¼šloadåˆ°å†…å­˜ä¸­)ï¼Œé¦–å…ˆä¼šè®°ä¿®æ”¹æ“ä½œçš„åæ“ä½œé€»è¾‘æ•°æ®è®°å½•å†™å…¥undo log bufferä¸­ï¼Œç„¶åä¼šå°†ä¿®æ”¹å“ªä¸ªç‰©ç†é¡µé¢åšäº†ä»€ä¹ˆæ“ä½œè®°å½•å†™å…¥ redo log buffer ï¼Œåç»­æŸä¸ªæ—¶é—´ç‚¹å†ä¸€æ¬¡æ€§å°†å¤šä¸ªæ“ä½œè®°å½•å†™åˆ° redo log file å’Œ undo log fileã€‚è¿™ç§ &lt;strong&gt;å…ˆå†™æ—¥å¿—ï¼Œå†å†™ç£ç›˜&lt;/strong&gt; çš„æŠ€æœ¯å°±æ˜¯ MySQLä¸­çš„ WALã€‚&lt;/p&gt;
&lt;p&gt;åœ¨è®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸­ï¼Œç”¨æˆ·ç©ºé—´( user space )ä¸‹çš„ç¼“å†²åŒºæ•°æ®ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯æ— æ³•ç›´æ¥å†™å…¥ç£ç›˜çš„ï¼Œä¸­é—´å¿…é¡»ç»è¿‡æ“ä½œç³»ç»Ÿå†…æ ¸ç©ºé—´(kernel space )ç¼“å†²åŒº( OS Buffer )ã€‚å› æ­¤ï¼Œ redo/undo log buffer å†™å…¥ redo/undo log file; å®é™…ä¸Šæ˜¯å…ˆå†™å…¥ OS Buffer ï¼Œç„¶åå†é€šè¿‡ç³»ç»Ÿè°ƒç”¨ fsync() å°†å…¶åˆ·åˆ° redo/undo log file ä¸­ï¼Œè¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://image-static.segmentfault.com/755/731/755731335-aec527828a1323b6_fix732&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;p&gt;mysql æ”¯æŒä¸‰ç§å°† redo/undo log buffer å†™å…¥ redo/undo log file çš„æ—¶æœºï¼Œå¯ä»¥é€šè¿‡ innodb_flush_log_at_trx_commit  å‚æ•°é…ç½®ï¼Œå„å‚æ•°å€¼å«ä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‚æ•°å€¼&lt;/th&gt;
&lt;th&gt;å«ä¹‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0ï¼ˆå»¶è¿Ÿå†™ï¼‰&lt;/td&gt;
&lt;td&gt;äº‹åŠ¡æäº¤æ—¶ä¸ä¼šå°† redo/undo log buffer ä¸­æ—¥å¿—å†™å…¥åˆ° os buffer ï¼Œè€Œæ˜¯æ¯ç§’å†™å…¥ os buffer å¹¶è°ƒç”¨ fsync() å†™å…¥åˆ° redo/undo log file ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´è®¾ç½®ä¸º0æ—¶æ˜¯(å¤§çº¦)æ¯ç§’åˆ·æ–°å†™å…¥åˆ°ç£ç›˜ä¸­çš„ï¼Œå½“ç³»ç»Ÿå´©æºƒï¼Œä¼šä¸¢å¤±1ç§’é’Ÿçš„æ•°æ®ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1ï¼ˆå®æ—¶å†™ï¼Œå®æ—¶åˆ·ï¼‰&lt;/td&gt;
&lt;td&gt;äº‹åŠ¡æ¯æ¬¡æäº¤éƒ½ä¼šå°† redo/undo log buffer ä¸­çš„æ—¥å¿—å†™å…¥ os buffer å¹¶è°ƒç”¨ fsync() åˆ·åˆ° redo/undo log file ä¸­ã€‚è¿™ç§æ–¹å¼å³ä½¿ç³»ç»Ÿå´©æºƒä¹Ÿä¸ä¼šä¸¢å¤±ä»»ä½•æ•°æ®ï¼Œä½†æ˜¯å› ä¸ºæ¯æ¬¡æäº¤éƒ½å†™å…¥ç£ç›˜ï¼ŒIOçš„æ€§èƒ½è¾ƒå·®ã€‚ä¸€èˆ¬å¼€å¯&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2ï¼ˆå®æ—¶å†™ï¼Œå»¶è¿Ÿåˆ·ï¼‰&lt;/td&gt;
&lt;td&gt;æ¯æ¬¡æäº¤éƒ½ä»…å†™å…¥åˆ° os buffer ï¼Œç„¶åæ˜¯æ¯ç§’è°ƒç”¨ fsync() å°† os buffer ä¸­çš„æ—¥å¿—å†™å…¥åˆ° redo/undo log file ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;img src=&#34;https://image-static.segmentfault.com/706/634/706634199-04894beff4e7b54f_fix732&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;h4 id=&#34;redo-logè®°å½•å½¢å¼&#34;&gt;redo logè®°å½•å½¢å¼&lt;/h4&gt;
&lt;p&gt;å‰é¢è¯´è¿‡ï¼Œ redo log å®é™…ä¸Šè®°å½•æ•°æ®é¡µçš„å˜æ›´ï¼Œè€Œè¿™ç§å˜æ›´è®°å½•æ˜¯æ²¡å¿…è¦å…¨éƒ¨ä¿å­˜ï¼Œå› æ­¤ redo logå®ç°ä¸Šé‡‡ç”¨äº†å¤§å°å›ºå®šï¼Œå¾ªç¯å†™å…¥çš„æ–¹å¼ï¼Œå½“å†™åˆ°ç»“å°¾æ—¶ï¼Œä¼šå›åˆ°å¼€å¤´å¾ªç¯å†™æ—¥å¿—ã€‚é€šè¿‡&lt;code&gt;show variables like &#39;innodb_log%&#39;; &lt;/code&gt; æŸ¥çœ‹å‚æ•°ï¼›è®°å½•æ–‡ä»¶å½¢å¼å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://image-static.segmentfault.com/390/444/3904443652-cc3225d69e1d0476_fix732&#34; alt=&#34;img&#34;&gt;&lt;/p&gt;
&lt;p&gt;åœ¨innodbå­˜å‚¨å¼•æ“ä¸­ï¼Œæ—¢æœ‰ redo log éœ€è¦åˆ·ç›˜ï¼Œè¿˜æœ‰ æ•°æ®é¡µ ä¹Ÿéœ€è¦åˆ·ç›˜ï¼Œ redo log å­˜åœ¨çš„æ„ä¹‰ä¸»è¦å°±æ˜¯é™ä½å¯¹æ•°æ®é¡µåˆ·ç›˜çš„è¦æ±‚ ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œ write pos è¡¨ç¤º redo log å½“å‰è®°å½•çš„ LSN (é€»è¾‘åºåˆ—å·)ä½ç½®ï¼Œ check point è¡¨ç¤ºæ•°æ®é¡µæ›´æ”¹è®°å½•åˆ·ç›˜åå¯¹åº” redo log æ‰€å¤„çš„ LSN (é€»è¾‘åºåˆ—å·)ä½ç½®ã€‚ write pos åˆ° check point ä¹‹é—´çš„éƒ¨åˆ†æ˜¯ redo log ç©ºç€çš„éƒ¨åˆ†ï¼Œç”¨äºè®°å½•æ–°çš„è®°å½•ï¼› check point åˆ° write pos ä¹‹é—´æ˜¯ redo log å¾…è½ç›˜çš„æ•°æ®é¡µæ›´æ”¹è®°å½•ã€‚å½“ write pos è¿½ä¸Š check point æ—¶ï¼Œä¼šå…ˆæ¨åŠ¨ check point å‘å‰ç§»åŠ¨ï¼Œç©ºå‡ºä½ç½®å†è®°å½•æ–°çš„æ—¥å¿—ã€‚&lt;/p&gt;
&lt;p&gt;å¯åŠ¨ innodb çš„æ—¶å€™ï¼Œä¸ç®¡ä¸Šæ¬¡æ˜¯æ­£å¸¸å…³é—­è¿˜æ˜¯å¼‚å¸¸å…³é—­ï¼Œæ€»æ˜¯ä¼šè¿›è¡Œæ¢å¤æ“ä½œã€‚å› ä¸º redo log è®°å½•çš„æ˜¯æ•°æ®é¡µçš„ç‰©ç†å˜åŒ–ï¼Œå› æ­¤æ¢å¤çš„æ—¶å€™é€Ÿåº¦æ¯”é€»è¾‘æ—¥å¿—(å¦‚ binlog )è¦å¿«å¾ˆå¤šã€‚ é‡å¯ innodb æ—¶ï¼Œé¦–å…ˆä¼šæ£€æŸ¥ç£ç›˜ä¸­æ•°æ®é¡µçš„ LSN ï¼Œå¦‚æœæ•°æ®é¡µçš„ LSN å°äºæ—¥å¿—ä¸­çš„ LSN ï¼Œåˆ™ä¼šä» checkpoint å¼€å§‹æ¢å¤ã€‚ è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œåœ¨å®•æœºå‰æ­£å¤„äºcheckpoint çš„åˆ·ç›˜è¿‡ç¨‹ï¼Œä¸”æ•°æ®é¡µçš„åˆ·ç›˜è¿›åº¦è¶…è¿‡äº†æ—¥å¿—é¡µçš„åˆ·ç›˜è¿›åº¦ï¼Œæ­¤æ—¶ä¼šå‡ºç°æ•°æ®é¡µä¸­è®°å½•çš„ LSN å¤§äºæ—¥å¿—ä¸­çš„ LSNï¼Œè¿™æ—¶è¶…å‡ºæ—¥å¿—è¿›åº¦çš„éƒ¨åˆ†å°†ä¸ä¼šé‡åšï¼Œå› ä¸ºè¿™æœ¬èº«å°±è¡¨ç¤ºå·²ç»åšè¿‡çš„äº‹æƒ…ï¼Œæ— éœ€å†é‡åšã€‚&lt;/p&gt;
&lt;p&gt;Mysql8.0 InnoDBå­˜å‚¨å¼•æ“å†™æ“ä½œï¼Œå¯¹redo logçš„å†™æ“ä½œè¿›è¡Œæ— é”å…¨å¼‚æ­¥è®¾è®¡ä¼˜åŒ–ï¼Œå¢åŠ ï¼›å…·ä½“è¯¦ç»†è§å®˜æ–¹æ–‡æ¡£ï¼š&lt;a href=&#34;https://dev.mysql.com/doc/refman/8.0/en/optimizing-innodb-logging.html&#34;&gt;ä¼˜åŒ– InnoDB é‡åšæ—¥å¿—&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;undolog&#34;&gt;undolog&lt;/h3&gt;
&lt;p&gt;æ•°æ®åº“äº‹åŠ¡å››å¤§ç‰¹æ€§ä¸­æœ‰ä¸€ä¸ªæ˜¯ &lt;strong&gt;åŸå­æ€§&lt;/strong&gt; ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ &lt;strong&gt;åŸå­æ€§æ˜¯æŒ‡å¯¹æ•°æ®åº“çš„ä¸€ç³»åˆ—æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸å¯èƒ½å‡ºç°éƒ¨åˆ†æˆåŠŸçš„æƒ…å†µ&lt;/strong&gt;ã€‚å®é™…ä¸Šï¼Œ &lt;strong&gt;åŸå­æ€§&lt;/strong&gt; åº•å±‚å°±æ˜¯é€šè¿‡ undo log å®ç°çš„ã€‚ undo log ä¸»è¦è®°å½•äº†æ•°æ®çš„é€»è¾‘å˜åŒ–ï¼Œæ¯”å¦‚ä¸€æ¡  INSERT è¯­å¥ï¼Œå¯¹åº”ä¸€æ¡ DELETE çš„ undo log ï¼Œå¯¹äºæ¯ä¸ª UPDATE è¯­å¥ï¼Œå¯¹åº”ä¸€æ¡ç›¸åçš„ UPDATE çš„undo log ï¼Œè¿™æ ·åœ¨å‘ç”Ÿé”™è¯¯æ—¶ï¼Œå°±èƒ½å›æ»šåˆ°äº‹åŠ¡ä¹‹å‰çš„æ•°æ®çŠ¶æ€ã€‚åŒæ—¶ï¼Œ undo log ä¹Ÿæ˜¯ MVCC (å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)å®ç°çš„å…³é”®ï¼›é€šè¿‡ &lt;code&gt;show variables like &#39;%undo%&#39;; &lt;/code&gt;æŸ¥çœ‹å‚æ•°ã€‚&lt;/p&gt;
&lt;h3 id=&#34;binlog&#34;&gt;binlog&lt;/h3&gt;
&lt;p&gt;binlog ç”¨äºè®°å½•æ•°æ®åº“æ‰§è¡Œçš„å†™å…¥æ€§æ“ä½œ(ä¸åŒ…æ‹¬æŸ¥è¯¢)ä¿¡æ¯ï¼Œä»¥äºŒè¿›åˆ¶çš„å½¢å¼ä¿å­˜åœ¨ç£ç›˜ä¸­ã€‚ binlog æ˜¯ mysqlçš„é€»è¾‘æ—¥å¿—ï¼Œå¹¶ä¸”ç”± Server å±‚è¿›è¡Œè®°å½•ï¼Œä½¿ç”¨ä»»ä½•å­˜å‚¨å¼•æ“çš„ mysql æ•°æ®åº“éƒ½ä¼šè®°å½• binlog æ—¥å¿—ï¼ˆ&lt;code&gt;log_bin&lt;/code&gt; æ‰“å¼€çš„æƒ…å†µä¸‹ï¼‰ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€»è¾‘æ—¥å¿—&lt;/strong&gt;ï¼š å¯ä»¥ç®€å•ç†è§£ä¸ºè®°å½•çš„å°±æ˜¯sqlè¯­å¥ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰©ç†æ—¥å¿—&lt;/strong&gt;ï¼š mysql æ•°æ®æœ€ç»ˆæ˜¯ä¿å­˜åœ¨æ•°æ®é¡µä¸­çš„ï¼Œç‰©ç†æ—¥å¿—è®°å½•çš„å°±æ˜¯æ•°æ®é¡µå˜æ›´ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;binlog æ˜¯é€šè¿‡è¿½åŠ çš„æ–¹å¼è¿›è¡Œå†™å…¥çš„ï¼Œå¯ä»¥é€šè¿‡ max_binlog_size å‚æ•°è®¾ç½®æ¯ä¸ª binlogæ–‡ä»¶çš„å¤§å°ï¼Œå½“æ–‡ä»¶å¤§å°è¾¾åˆ°ç»™å®šå€¼ä¹‹åï¼Œä¼šç”Ÿæˆæ–°çš„æ–‡ä»¶æ¥ä¿å­˜æ—¥å¿—ã€‚binlogç›¸å…³å‚æ•°é€šè¿‡&lt;code&gt;show variables like &amp;quot;%binlog%&amp;quot;;&lt;/code&gt; æŸ¥çœ‹ï¼›é€šè¿‡&lt;code&gt;show variables like &amp;quot;%log_bin%&amp;quot;;&lt;/code&gt;æŸ¥çœ‹binlogæ˜¯å¦å¼€å¯,ä»¥åŠbinlogæ—¥å¿—ç›®å½•ï¼Œ8.0ç‰ˆæœ¬é»˜è®¤æ—¶å¼€å¯ã€‚&lt;/p&gt;
&lt;h4 id=&#34;binlogä½¿ç”¨åœºæ™¯&#34;&gt;binlogä½¿ç”¨åœºæ™¯&lt;/h4&gt;
&lt;p&gt;åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ binlog çš„ä¸»è¦ä½¿ç”¨åœºæ™¯æœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«æ˜¯ &lt;strong&gt;ä¸»ä»å¤åˆ¶&lt;/strong&gt; å’Œ &lt;strong&gt;æ•°æ®æ¢å¤&lt;/strong&gt; ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ä¸»ä»å¤åˆ¶&lt;/strong&gt; ï¼šåœ¨ Master ç«¯å¼€å¯ binlog ï¼Œç„¶åå°† binlog å‘é€åˆ°å„ä¸ª Slave ç«¯ï¼Œ Slave ç«¯é‡æ”¾ binlog ä»è€Œè¾¾åˆ°ä¸»ä»æ•°æ®ä¸€è‡´ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ•°æ®æ¢å¤&lt;/strong&gt; ï¼šé€šè¿‡ä½¿ç”¨ mysqlbinlog å·¥å…·æ¥æ¢å¤æ•°æ®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;binlogåˆ·ç›˜æ—¶æœº&#34;&gt;binlogåˆ·ç›˜æ—¶æœº&lt;/h4&gt;
&lt;p&gt;å¯¹äº InnoDB å­˜å‚¨å¼•æ“è€Œè¨€ï¼Œåªæœ‰åœ¨äº‹åŠ¡æäº¤æ—¶æ‰ä¼šè®°å½• biglog ï¼Œæ­¤æ—¶è®°å½•è¿˜åœ¨å†…å­˜ä¸­ï¼Œé‚£ä¹ˆ biglogæ˜¯ä»€ä¹ˆæ—¶å€™åˆ·åˆ°ç£ç›˜ä¸­çš„å‘¢ï¼Ÿ mysql é€šè¿‡ sync_binlog å‚æ•°æ§åˆ¶ biglog çš„åˆ·ç›˜æ—¶æœºï¼Œå–å€¼èŒƒå›´æ˜¯ 0-Nï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;0ï¼šä¸å»å¼ºåˆ¶è¦æ±‚ï¼Œç”±ç³»ç»Ÿè‡ªè¡Œåˆ¤æ–­ä½•æ—¶å†™å…¥ç£ç›˜ï¼›&lt;/li&gt;
&lt;li&gt;1ï¼šæ¯æ¬¡ commit çš„æ—¶å€™éƒ½è¦å°† binlog å†™å…¥ç£ç›˜ï¼›ä¸€èˆ¬å¼€å¯&lt;/li&gt;
&lt;li&gt;Nï¼šæ¯Nä¸ªäº‹åŠ¡ï¼Œæ‰ä¼šå°† binlog å†™å…¥ç£ç›˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œ sync_binlog æœ€å®‰å…¨çš„æ˜¯è®¾ç½®æ˜¯ 1 ï¼Œè¿™ä¹Ÿæ˜¯ MySQL 5.7.7ä¹‹åç‰ˆæœ¬çš„é»˜è®¤å€¼ã€‚ä½†æ˜¯è®¾ç½®ä¸€ä¸ªå¤§ä¸€äº›çš„å€¼å¯ä»¥æå‡æ•°æ®åº“æ€§èƒ½ï¼Œå› æ­¤å®é™…æƒ…å†µä¸‹ä¹Ÿå¯ä»¥å°†å€¼é€‚å½“è°ƒå¤§ï¼Œç‰ºç‰²ä¸€å®šçš„ä¸€è‡´æ€§æ¥è·å–æ›´å¥½çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;h4 id=&#34;binlogæ—¥å¿—æ ¼å¼&#34;&gt;binlogæ—¥å¿—æ ¼å¼&lt;/h4&gt;
&lt;p&gt;binlog æ—¥å¿—æœ‰ä¸‰ç§æ ¼å¼ï¼Œåˆ†åˆ«ä¸º STATMENT ã€ ROW å’Œ MIXED ã€‚åœ¨ MySQL 5.7.7 ä¹‹å‰ï¼Œé»˜è®¤çš„æ ¼å¼æ˜¯ STATEMENT ï¼Œ MySQL 5.7.7 ä¹‹åï¼Œé»˜è®¤å€¼æ˜¯ ROW ã€‚æ—¥å¿—æ ¼å¼é€šè¿‡ binlog-format æŒ‡å®š; &lt;code&gt;show variables like &amp;quot;%binlog_format%&amp;quot;;&lt;/code&gt;æŸ¥çœ‹&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;STATMENT ï¼š åŸºäº SQL è¯­å¥çš„å¤åˆ¶( statement-based replication, SBR )ï¼Œæ¯ä¸€æ¡ä¼šä¿®æ”¹æ•°æ®çš„sqlè¯­å¥ä¼šè®°å½•åˆ° binlog ä¸­ ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹ï¼š ä¸éœ€è¦è®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–ï¼Œå‡å°‘äº† binlog  æ—¥å¿—é‡ï¼ŒèŠ‚çº¦äº†  IO  , ä»è€Œæé«˜äº†æ€§èƒ½ï¼›&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹ï¼š åœ¨æŸäº›æƒ…å†µä¸‹ä¼šå¯¼è‡´ä¸»ä»æ•°æ®ä¸ä¸€è‡´ï¼Œæ¯”å¦‚æ‰§è¡Œæœ¬åœ°æ—¶é—´æ“ä½œï¼› &lt;code&gt;SELECT NOW(),SYSDATE(),SLEEP(3),NOW(),SYSDATE();&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ROW ï¼š åŸºäºè¡Œçš„å¤åˆ¶( row-based replication, RBR )ï¼Œä¸è®°å½•æ¯æ¡sqlè¯­å¥çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»…éœ€è®°å½•å“ªæ¡æ•°æ®è¢«ä¿®æ”¹äº† ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¼˜ç‚¹ï¼š ä¸ä¼šå‡ºç°æŸäº›ç‰¹å®šæƒ…å†µä¸‹çš„å­˜å‚¨è¿‡ç¨‹ã€æˆ–functionã€æˆ–triggerçš„è°ƒç”¨å’Œè§¦å‘æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜ ï¼›&lt;/li&gt;
&lt;li&gt;ç¼ºç‚¹ï¼š ä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—ï¼Œå°¤å…¶æ˜¯ alter table çš„æ—¶å€™ä¼šè®©æ—¥å¿—æš´æ¶¨ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;MIXED ï¼š åŸºäº STATMENT å’Œ ROW ä¸¤ç§æ¨¡å¼çš„æ··åˆå¤åˆ¶( mixed-based replication, MBR )ï¼Œä¸€èˆ¬çš„å¤åˆ¶ä½¿ç”¨ STATEMENT æ¨¡å¼ä¿å­˜ binlog ï¼Œå¯¹äº STATEMENT æ¨¡å¼æ— æ³•å¤åˆ¶çš„æ“ä½œä½¿ç”¨ ROW æ¨¡å¼ä¿å­˜ binlogï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;binlogæ—¥å¿—ä¸»è¦æ˜¯ç”¨æ¥ä¸»ä»åŒæ­¥å¤åˆ¶æ•°æ®ä»¥åŠæ•°æ®æ¢å¤ï¼Œæ˜¯mysql serverå±‚æ‰§è¡Œå™¨è¿›è¡Œæ“ä½œ(ä¸»)å†™å…¥å’Œ(ä»)è¯»å…¥(relaylog)ï¼›&lt;/p&gt;
&lt;p&gt;æ•°æ®å¯ä»¥æŒ‰å¤©æŒ‰å‘¨è¿›è¡Œå¤‡ä»½ï¼Œé¡ºåºå†™å…¥ï¼Œæ²¡æœ‰å¤§å°é™åˆ¶(æ–‡ä»¶å¤§å°æœ‰é™ï¼Œä½†æ˜¯æ•´ä½“æ²¡æœ‰é™åˆ¶ï¼Œå¤šä¸ªæ–‡ä»¶binlog.**å¯ä»¥é€šè¿‡binlog.indexå®šä½)ï¼›&lt;/p&gt;
&lt;h3 id=&#34;redo-logä¸binlogåŒºåˆ«&#34;&gt;redo logä¸binlogåŒºåˆ«&lt;/h3&gt;
&lt;p&gt;ä¸åŒäºredo log, è™½ç„¶ä¸¤è€…éƒ½å¯ä»¥ç”¨æ¥æ¢å¤æ•°æ®ï¼Œä½†æ˜¯åœ¨mysqlä¸­innodbå­˜å‚¨å¼•æ“çš„walæœºåˆ¶ä¸‹ç”Ÿæˆçš„redologæœ‰å¤§å°é™åˆ¶ï¼Œ redo log å®é™…ä¸Šè®°å½•æ•°æ®é¡µçš„å˜æ›´ï¼Œè€Œè¿™ç§å˜æ›´è®°å½•æ˜¯æ²¡å¿…è¦å…¨éƒ¨ä¿å­˜ï¼Œå› æ­¤ redo logå®ç°ä¸Šé‡‡ç”¨äº†å¤§å°å›ºå®šï¼Œå¾ªç¯å†™å…¥çš„æ–¹å¼ï¼Œå½“å†™åˆ°ç»“å°¾æ—¶ï¼Œä¼šå›åˆ°å¼€å¤´å¾ªç¯å†™æ—¥å¿—ï¼›è€Œbinlogä¸»è¦æ˜¯ç”¨æ¥æ•°æ®æ¢å¤ï¼Œå¦‚æœå¤‡ä»½æ—¶é—´é•¿ï¼Œç”¨æˆ·åœ¨æŸæ®µæ—¶é—´æœ‰è¯¯æ“ä½œï¼Œéœ€è¦å›æ»šæ“ä½œï¼Œå°±å¯ä»¥åŒbinlogæ¥æ¢å¤åˆ°æŸä¸ªæ—¶é—´ç‚¹çš„æ—¥å¿—çŠ¶æ€ï¼›å¯¹äºredo logæ˜¯åšä¸åˆ°çš„ï¼›è€Œä¸”binlog ä¸æ˜¯å­˜å‚¨å¼•æ“ç‰¹æœ‰çš„ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä¸åŒçš„å­˜å‚¨å¼•æ“å…¬ç”¨æ¥æ¢å¤æ•°æ®åœºæ™¯ï¼›åŒºåˆ«å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;redo log&lt;/th&gt;
&lt;th&gt;binlog&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æ–‡ä»¶å¤§å°&lt;/td&gt;
&lt;td&gt;redo log çš„å¤§å°æ˜¯å›ºå®šçš„ã€‚&lt;/td&gt;
&lt;td&gt;binlog å¯é€šè¿‡é…ç½®å‚æ•° max_binlog_size è®¾ç½®æ¯ä¸ª binlog æ–‡ä»¶çš„å¤§å°ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å®ç°æ–¹å¼&lt;/td&gt;
&lt;td&gt;redo log æ˜¯ InnoDB å¼•æ“å±‚å®ç°çš„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰å¼•æ“éƒ½æœ‰ã€‚&lt;/td&gt;
&lt;td&gt;binlog æ˜¯ Server å±‚å®ç°çš„ï¼ŒMySQL 3.23.14 ä¸­å¼•å…¥çš„ï¼Œæ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ binlog æ—¥å¿—ï¼ŒæœåŠ¡å™¨è¿è¡ŒæœŸé—´ç”Ÿæˆçš„æœåŠ¡å™¨å…¨å±€çŠ¶æ€æ›´æ”¹çš„è·Ÿè¸ªæ—¥å¿—&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è®°å½•æ–¹å¼&lt;/td&gt;
&lt;td&gt;redo log é‡‡ç”¨å¾ªç¯å†™çš„æ–¹å¼è®°å½•ï¼Œå½“å†™åˆ°ç»“å°¾æ—¶ï¼Œä¼šå›åˆ°å¼€å¤´å¾ªç¯å†™æ—¥å¿—ã€‚&lt;/td&gt;
&lt;td&gt;binlogé€šè¿‡è¿½åŠ çš„æ–¹å¼è®°å½•ï¼Œå½“æ–‡ä»¶å¤§å°å¤§äºç»™å®šå€¼åï¼Œåç»­çš„æ—¥å¿—ä¼šè®°å½•åˆ°æ–°çš„æ–‡ä»¶ä¸Š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;é€‚ç”¨åœºæ™¯&lt;/td&gt;
&lt;td&gt;redo log é€‚ç”¨äºå´©æºƒæ¢å¤(crash-safe)ï¼Œé‡å¯æ¢å¤çš„æ—¶å€™ï¼Œé€šè¿‡check pointå’Œwrite pos æ¥æ¢å¤æ•°æ®&lt;/td&gt;
&lt;td&gt;binlog é€‚ç”¨äºä¸»ä»å¤åˆ¶å’Œæ•°æ®æ¢å¤ï¼ŒæŸä¸ªæ—¶é—´ç‚¹çš„æ“ä½œè®°å½•å½’æ¡£ï¼Œå¯ä»¥æŒ‰æ—¶é—´ç‚¹è¿›è¡Œæ¢å¤ï¼›ä»¥åŠä¸»ä»ä¹‹é—´çš„å¤åˆ¶é‡æ”¾, å®ç°é«˜å¯ç”¨çš„åŸºç¡€ï¼Œä»¥åŠè®¢é˜…binlogè¿›è¡Œä¸åŒåˆ†å¸ƒå¼å­˜å‚¨æ•°æ®çš„åŒæ­¥&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;ç”± binlog å’Œ redo log çš„åŒºåˆ«å¯çŸ¥ï¼šå› ä¸ºmysql æ—©æœŸè‡ªå¸¦çš„MyISAMå­˜å‚¨å¼•æ“è®¾è®¡ç”¨ binlog æ—¥å¿—åªç”¨äºå½’æ¡£ï¼Œè¿›è¡Œæ•°æ®æ¢å¤ï¼Œåªä¾é  binlog æ˜¯æ²¡æœ‰ crash-safe èƒ½åŠ›çš„ã€‚innodbå­˜å‚¨å¼•æ“å¼•å…¥mysqlä¹‹åï¼Œå¼•å…¥redo/undo logæ–‡ä»¶æ¥æ”¯æŒäº‹åŠ¡æŒä¹…æ€§å’ŒåŸå­æ€§æ¥ä¿è¯å†™å…¥æ•°æ®çš„ä¸€è‡´æ€§ï¼›ä½†åªæœ‰ redo log ä¹Ÿä¸è¡Œï¼Œå› ä¸º redo log æ˜¯ InnoDB ç‰¹æœ‰çš„ï¼Œå¾ªç¯å†™å…¥ï¼Œæ— æ³•è¿˜åŸä¸åœ¨è¿™ä¸ªredo logä¸­çš„è®°å½•ï¼Œæ¯”å¦‚ä»æœåŠ¡å¯åŠ¨æˆ–è€…è®°å½•æ•°æ®è½åå¾ˆå¤š(é™¤éæ˜¯shared storageæ¶æ„æœºåˆ¶çš„äº‘å‚å•†æ•°æ®åº“ï¼Œåƒ&lt;a href=&#34;https://www.allthingsdistributed.com/files/p1041-verbitski.pdf&#34;&gt;Aurora&lt;/a&gt;,&lt;a href=&#34;https://www.vldb.org/pvldb/vol11/p1849-cao.pdf&#34;&gt;PolarDB&lt;/a&gt;)ï¼›å› æ­¤éœ€è¦ binlog å’Œ redo logäºŒè€…åŒæ—¶è®°å½•ï¼Œæ‰èƒ½ä¿è¯å½“æ•°æ®åº“å‘ç”Ÿè¯¯åˆ æˆ–è€…å®•æœºé‡å¯æ—¶ï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ä¸¤é˜¶æ®µæäº¤&#34;&gt;ä¸¤é˜¶æ®µæäº¤&lt;/h3&gt;
&lt;p&gt;ä¸ºäº†ä¿è¯å†™å…¥ä¸¤ä»½æ—¥å¿—redo log, binlog æœ€ç»ˆæ¢å¤æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œé‡‡ç”¨&lt;a href=&#34;https://en.wikipedia.org/wiki/Two-phase_commit_protocol&#34;&gt;ä¸¤é˜¶æ®µæäº¤(2pc)&lt;/a&gt;çš„æœºåˆ¶(XA,å†…éƒ¨/å…¨å±€äº‹åŠ¡ innodbæä¾›ä¸€æ ·çš„æ“ä½œ)ï¼Œmysql server æ‰§è¡Œå™¨ åœ¨è°ƒç”¨innodbå­˜å‚¨å¼•æ“æ¥å£è¿›è¡Œå†™æ“ä½œçš„æ—¶å€™ï¼Œèµ·åˆ°ä¸€ä¸ªäº‹åŠ¡åè°ƒè€…çš„ä½œç”¨,é€šè¿‡TC_LOG(Transaction Coordinator Log)åŸºç±»å®šä¹‰äº†äº‹åŠ¡æ—¥å¿—éœ€è¦å®ç°çš„æ¥å£: open, prepare, commit, rollback, closeï¼›å®ç°è¿™äº›æ¥å£çš„ç±»ï¼šTC_LOG_DUMMY(disable the logging), TC_LOG_MMAP(mmap logging), MYSQL_BIN_LOG(binlog)ï¼›ä¸»è¦æ˜¯æ˜¯æŸ¥çœ‹MYSQL_BIN_LOGç±»ä¸­&lt;a href=&#34;https://github.com/mysql/mysql-server/blob/8.0/sql/binlog.cc#L7881&#34;&gt;prepare&lt;/a&gt; å’Œ &lt;a href=&#34;https://github.com/mysql/mysql-server/blob/8.0/sql/binlog.cc#L7934&#34;&gt;commit&lt;/a&gt; çš„å®ç°ï¼›prepare å’Œ commitæœ€ç»ˆä¼šè°ƒç”¨å­˜å‚¨å¼•æ“åˆå§‹åŒ–æ—¶æŒ‡å‘çš„handlertonå¯¹è±¡å¯¹åº”å‡½æ•°ï¼›ï¼ˆè¿™ç§æ¥å£éš”ç¦»çš„å¸¸ç”¨è®¾è®¡ï¼Œå°†è°ƒç”¨æ–¹å’Œå®ç°æ–¹è¿›è¡Œè§£è€¦ï¼Œæ ¹æ®å‚æ•°é…ç½®æ¥ç»‘å®šå®ç°æ–¹ï¼Œè¿è¡Œæ—¶åŠ¨æ€è°ƒç”¨ï¼‰&lt;/p&gt;
&lt;p&gt;mysqlæ˜¯ä»¥pluginçš„æ–¹å¼ç®¡ç†å­˜å‚¨å¼•æ“ï¼Œreplication(ä¸»ä»å‰¯æœ¬åŒæ­¥)æ’ä»¶å’Œå…¶ä»–æ’ä»¶ï¼ˆé€šè¿‡&lt;code&gt;SHOW PLUGINS;&lt;/code&gt;æŸ¥çœ‹)ï¼›å…·ä½“çš„æ’ä»¶ä»£ç åœ¨&lt;a href=&#34;https://github.com/mysql/mysql-server/tree/8.0/plugin&#34;&gt;plugin&lt;/a&gt;æ–‡ä»¶ä¸­ï¼Œç®€å•çš„æ’ä»¶ç¤ºä¾‹&lt;a href=&#34;https://github.com/mysql/mysql-server/tree/8.0/plugin/rewrite_example&#34;&gt;rewrite_example&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;mysqld å¯åŠ¨æ—¶é€šè¿‡é…ç½®åˆå§‹çš„å­˜å‚¨å¼•æ“(é»˜è®¤innodb)ï¼Œè°ƒç”¨&lt;a href=&#34;https://github.com/mysql/mysql-server/blob/8.0/sql/mysqld.cc#L5815&#34;&gt;init_server_components&lt;/a&gt; è°ƒç”¨innodbå­˜å‚¨å¼•æ“çš„æ¥å£è¿›è¡Œåˆå§‹åŒ–ha_handler, åœ¨&lt;a href=&#34;https://github.com/mysql/mysql-server/blob/8.0/storage/innobase/handler/ha_innodb.cc#L4935&#34;&gt;innodb_init&lt;/a&gt;ä¸­è¿›è¡Œåˆå§‹åŒ–, æ¯”å¦‚åˆ·ç›˜æ“ä½œ innobase_hton-&amp;gt;flush_logs = innobase_flush_logs; ç„¶ååœ¨sql/handlerä¸­å®šä¹‰çš„ç›¸å…³æ¥å£è°ƒç”¨, æ¯”å¦‚&lt;a href=&#34;https://github.com/mysql/mysql-server/blob/8.0/sql/handler.cc#L2459&#34;&gt;ha_flush_logs&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å®‰è£…replicationæ’ä»¶æ—¶ä¼šæ³¨å†Œæ’ä»¶ä¸­ç›¸åº”çš„æ–¹æ³•åŠ å…¥observer åˆ—è¡¨ä¸­ï¼Œè¿è¡Œè§¦å‘çš„æ—¶å€™ä»¥AOPçš„æ–¹å¼RUN_HOOK æ‰«æobserveråˆ—è¡¨Observer_info-&amp;gt;observerè°ƒç”¨å¯¹åº”æ’ä»¶å‡½æ•°ï¼›replicationæ’ä»¶éœ€è¦å®ç°ä»¥ä¸‹&lt;a href=&#34;https://github.com/mysql/mysql-server/blob/8.0/sql/replication.h&#34;&gt;replicationæ–‡ä»¶ä¸­&lt;/a&gt;ç›¸å…³ç»“æ„ä½“çš„æ–¹æ³•(æ¥å£) æ‰èƒ½åŠ è½½ï¼š&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;struct Trans_observer /* Observes and extends transaction execution */
struct Server_state_observer /* Observer server state */
struct Binlog_transmit_observer /* Observe and extends the binlog dumping thread. */
struct Binlog_relay_IO_observer /* Observes and extends the service of slave IO thread. */
struct Binlog_storage_observer /* Observe binlog logging storage */
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿™é‡Œä¼šæœ‰å„ç§æ—¥å¿—çš„åˆ·æ–°æœºåˆ¶ï¼Œå¯ä»¥é€šè¿‡&lt;code&gt;show variables like &#39;%innodb%flush%&#39;; show variables like &#39;sync_binlog&#39;;&lt;/code&gt;è·å–å¯¹åº”çš„å‚æ•°ï¼Œå¯ä»¥å»å®˜ç½‘&lt;a href=&#34;https://dev.mysql.com/doc/refman/8.0/en/server-option-variable-reference.html&#34;&gt;Server Option, System Variable, and Status Variable Reference&lt;/a&gt; æŸ¥æ‰¾å¯¹åº”çš„è¯¦æƒ…è¿›è¡Œé…ç½®ä¼˜åŒ–ï¼›&lt;/p&gt;
&lt;p&gt;å½“å¼€å¯binlogæ—¶, MySQLé»˜è®¤ä½¿ç”¨è¯¥éšå¼XAæ¨¡å¼ï¼Œå¼€å¯è‡ªåŠ¨æäº¤äº‹åŠ¡autocommitã€‚äº‹åŠ¡çš„æäº¤æµç¨‹ç›¸å¯¹æ¯”è¾ƒå¤æ‚ï¼Œæ‰§è¡Œç®€å•çš„updateæ“ä½œï¼Œç®€è¿°å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;0. æ‰§è¡Œå™¨æ•°æ®è·å–ä¿®æ”¹ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ‰§è¡Œå™¨è°ƒç”¨innodbå­˜å‚¨å¼•æ“æ¥å£è·å–æ»¡è¶³æ¡ä»¶çš„æ•°æ®ï¼Œé€šè¿‡æ ‘ç´¢å¼•æŸ¥æ‰¾/å…¨è¡¨æŸ¥æ‰¾ï¼Œ å¦‚æœæ•°æ®åœ¨buffer poolä¸­æŸ¥æ‰¾åˆ°ï¼Œè¿”å›æ•°æ®ï¼›å¦åˆ™ä»ç£ç›˜è¡¨ç©ºé—´æ–‡ä»¶ä¸­è¯»å–æ•°æ®pageåˆ°buffer pool  clean pageä¸­ï¼Œè¿”å›æ•°æ®ï¼›æ— æ•°æ®ï¼Œæµç¨‹ç»ˆæ­¢è¿”å›ï¼›&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œå™¨ä¿®æ”¹æ‰¾åˆ°çš„æ•°æ®ï¼Œå°†ä¿®æ”¹çš„æ•°æ® è°ƒç”¨innodbå­˜å‚¨å¼•æ“æ¥å£å†™å…¥æ–°æ•°æ®ï¼Œè¿›è¡Œä¸¤é˜¶æ®µæäº¤ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;äº‹åŠ¡çš„æäº¤è¿‡ç¨‹å…¥å£ç‚¹ä½äº &lt;a href=&#34;https://github.com/mysql/mysql-server/blob/8.0/sql/handler.cc#L1592&#34;&gt;ha_commit_trans&lt;/a&gt;å‡½æ•°ï¼Œä»¥mysql binlog ä¸ºäº‹åŠ¡2pcåè°ƒè€…ä¸ºä¾‹ï¼Œäº‹åŠ¡æäº¤çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. mysql bin log äº‹åŠ¡2pcåè°ƒè€… å¤„ç† å‡†å¤‡prepareé˜¶æ®µ&lt;/strong&gt;ï¼š(tc_log-&amp;gt;prepare)&lt;/p&gt;
&lt;p&gt;MYSQL_BIN_LOG::prepare(THD *thd, bool all)  è®¾ç½® thd-&amp;gt;durability_property = HA_IGNORE_DURABILITY; ç”¨äºåœ¨å­˜å‚¨å¼•æ“å‡†å¤‡é˜¶æ®µä¸åˆ·æ–°äº‹åŠ¡æ—¥å¿—redo/undo log åˆ°ç£ç›˜æ—¥å¿—æ–‡ä»¶ä¸­ï¼›&lt;/p&gt;
&lt;p&gt;è°ƒç”¨æµç¨‹ï¼šha_prepare_low â†’ innobase_xa_prepare â†’ trx_prepare_for_mysql â†’   &lt;a href=&#34;https://github.com/mysql/mysql-server/blob/8.0/storage/innobase/trx/trx0trx.cc#L2919&#34;&gt;static void trx_prepare(trx_t *trx)&lt;/a&gt;   â†’ trx_prepare_low â†’ trx_undo_set_state_at_prepare&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;
&lt;p&gt;æ‰§è¡Œå™¨è°ƒç”¨innodbå­˜å‚¨å¼•æ“æ¥å£è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œé¦–å…ˆå†™å…¥æ•°æ®çš„æ—§å€¼è‡³undo log bufferä¸­ï¼Œæ›´æ–°InnoDBçš„undoå›æ»šæ®µï¼Œå°†å…¶è®¾ç½®ä¸ºPrepareçŠ¶æ€ï¼ˆ&lt;code&gt;TRX_UNDO_PREPARED&lt;/code&gt;ï¼‰å†™å…¥mlogä¸­ï¼Œè¿”å› redo log çš„LSN,&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ›´æ–°buffer poolä¸­çš„æ•°æ®(å¦‚æœæ’å…¥éœ€è¦ä»free(free list)å˜æˆclean page(lru list)ï¼Œfree list ä¸å¤Ÿæ—¶éœ€è¦ä»flush istæˆ–è€…lru listæ·˜æ±°ä¸€å®šçš„pageå˜æˆfree page åŠ å…¥free list); ä¿®æ”¹çš„clean page(lru list)å˜æˆ dirty page(lru list)(æ›´æ–°çš„æ•°æ®é¡µåœ¨ç¼“å­˜ä¸­ï¼Œè¿˜æœªåˆ·ç›˜)ï¼›dirty pageå†™å…¥flush listï¼› ä¸ºäº†æé«˜å†™æ€§èƒ½å¼‚æ­¥çº¿ç¨‹åˆ·ç›˜(åˆ·ç›˜æ—¶æœºå¯ä»¥åœ¨commitä¹‹åï¼›MySQL 5.7å¼•å…¥äº†page cleanerçº¿ç¨‹)&lt;/p&gt;
&lt;p&gt;Tips: åœ¨flush listä¸Šçš„é¡µé¢ä¸€å®šåœ¨lru Listä¸Šï¼Œä½†æ˜¯åä¹‹åˆ™ä¸æˆç«‹ã€‚ä¸€ä¸ªæ•°æ®é¡µå¯èƒ½ä¼šåœ¨ä¸åŒçš„æ—¶åˆ»è¢«ä¿®æ”¹å¤šæ¬¡ï¼Œåœ¨æ•°æ®é¡µä¸Šè®°å½•äº†æœ€è€(ä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡)çš„ä¸€æ¬¡ä¿®æ”¹çš„LSNï¼Œå³oldest_modificationã€‚ä¸åŒæ•°æ®é¡µæœ‰ä¸åŒçš„oldest_modificationï¼Œflush listä¸­çš„èŠ‚ç‚¹æŒ‰ç…§oldest_modificationæ’åºï¼Œé“¾è¡¨å°¾æ˜¯æœ€å°çš„ï¼Œä¹Ÿå°±æ˜¯æœ€æ—©è¢«ä¿®æ”¹çš„æ•°æ®é¡µï¼Œå½“éœ€è¦ä»flush listä¸­æ·˜æ±°é¡µé¢æ—¶å€™ï¼Œä»é“¾è¡¨å°¾éƒ¨å¼€å§‹æ·˜æ±°ã€‚åŠ å…¥flush listï¼Œéœ€è¦ä½¿ç”¨flush_list_mutexä¿æŠ¤ï¼Œæ‰€ä»¥èƒ½ä¿è¯flush listä¸­èŠ‚ç‚¹çš„é¡ºåºã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åŒæ—¶å°†æ•°æ®é¡µçš„ä¿®æ”¹è®°å½•LSNå†™å…¥redo log bufferä¸­ï¼Œå‡†å¤‡æäº¤äº‹åŠ¡ï¼Œæ­¤æ—¶ redo log å¤„äº prepare çŠ¶æ€ï¼Œå¦‚æœthd-&amp;gt;durability_property = HA_IGNORE_DURABILITY, å°†&lt;code&gt;LSN&lt;/code&gt; å†™å…¥redo log ç£ç›˜æ–‡ä»¶ä¸­ï¼›åŸå­åŒ–æ“ä½œ&lt;code&gt;trx_t&lt;/code&gt; äº‹åŠ¡çŠ¶æ€ä¸º PREPARED (ç”¨äºäº‹åŠ¡éš”ç¦»æ“ä½œ)ï¼› å°†&lt;code&gt;gtid_desc&lt;/code&gt;å†™å…¥undolog è¡¨ç©ºé—´ä¸­ï¼›ç„¶åå‘ŠçŸ¥æ‰§è¡Œå™¨æ‰§è¡Œå®Œæˆäº†ï¼Œéšæ—¶å¯ä»¥æäº¤äº‹åŠ¡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Tips: è¿™é‡Œä¼šå‡ºç°redo log fileå†™æ»¡çš„æƒ…å†µï¼Œbuffer å†™å…¥ä¼šhangä½ï¼ŒMySQLå°±ä¼šåœä¸‹æ‰‹å¤´çš„ä»»åŠ¡ï¼Œå…ˆæŠŠè„é¡µåˆ·åˆ°ç£ç›˜é‡Œï¼Œæ‰èƒ½ç»§ç»­å¹²æ´»ï¼Œä¼šå¯¼è‡´MySQLçš„æœåŠ¡å™¨çš„tpsæœ‰æ˜æ˜¾çš„æ³¢åŠ¨ï¼› é»˜è®¤å¼€å¯äº†innodb_adaptive_flushing ç®—æ³•è¿›è¡Œä¼˜åŒ–ï¼Œåœ¨redo log fileè¿˜æ²¡æœ‰æ»¡çš„æ—¶å€™ï¼Œä¼šæ ¹æ®redo log fileç”Ÿæˆçš„é€Ÿåº¦å’Œåˆ·æ–°é¢‘ç‡æ¥å°†redo log fileä¸­çš„è„é¡µåˆ·å…¥ç£ç›˜è¡¨ç©ºé—´æ–‡ä»¶ä¸­ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. mysql binlog äº‹åŠ¡2pcåè°ƒè€… å¤„ç† æäº¤commité˜¶æ®µï¼š&lt;/strong&gt;(tc_log-&amp;gt;commit)&lt;/p&gt;
&lt;p&gt;è°ƒç”¨æµç¨‹ï¼šTC_LOG::enum_result MYSQL_BIN_LOG::commit(THD *thd, bool all) â†’&lt;a href=&#34;https://github.com/mysql/mysql-server/blob/8.0/sql/binlog.cc#L8717&#34;&gt;int MYSQL_BIN_LOG::ordered_commit(THD *thd, bool all, bool skip_commit)&lt;/a&gt;  , å¦‚æœæ²¡æœ‰å¼€å¯log_binï¼Œæ²¡æœ‰bin logæ–‡ä»¶ï¼Œç›´æ¥è·³è‡³commité˜¶æ®µï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ç»„æäº¤&lt;/strong&gt; (æµç¨‹è§ä»£ç ä¸­ä»‹ç» &lt;a href=&#34;https://github.com/mysql/mysql-server/blob/8.0/sql/binlog.h#L568-L641&#34;&gt;ordered_commit&lt;/a&gt; )ï¼šç»„æäº¤ç¬¬ä¸€çœ¼çœ‹ç€æœ‰ç‚¹æ‡µé€¼ï¼Œå¯ä»¥ç»“åˆè¿™ç‰‡æ–‡ç«  &lt;a href=&#34;https://developer.aliyun.com/article/617776&#34;&gt;[å›¾è§£MySQL]MySQLç»„æäº¤(group commit)&lt;/a&gt; äº†è§£ï¼›ä¸»è¦æ˜¯ä¸ºäº†æå‡äº‹åŠ¡ååé‡è®¾è®¡çš„æ–¹æ¡ˆ(&lt;strong&gt;åŸåˆ™ï¼šå°½é‡å‡å°‘ç£ç›˜IO, åˆ©ç”¨æŒä¹…ç›˜çš„ç‰¹æ€§é¡ºåºå†™&lt;/strong&gt;)ï¼›å¦‚åŒæœ¨æ¡¶æ•ˆåº”ä¸€æ ·ï¼Œredo log å’Œ binlog ä¸¤è€…å…¶ä¸­æœ‰ä¸€ä¸ªæ²¡æœ‰ç»„æäº¤ï¼Œéƒ½ä¼šé™ä½äº‹åŠ¡ååé‡ï¼Œæ‰€ä»¥æœ€å¥½çš„æ–¹å¼redo log å’Œ binlog ä¸¤è€…éƒ½ç»„é˜Ÿæäº¤; mysqlè®¾è®¡è€…å°†ç»„æäº¤ä»flushé˜¶æ®µå¼€å§‹ä¼˜åŒ–ï¼Œå°†å…¶åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µï¼š flush é˜¶æ®µã€sync é˜¶æ®µã€(replicationå¤åˆ¶é˜¶æ®µ) ã€commit é˜¶æ®µï¼›å…¶ä¸­replicationå¤åˆ¶é˜¶æ®µä»¥HOOKçš„æ–¹å¼åŠ¨æ€è¿è¡Œå¯¹äºçš„replicationå¤åˆ¶ç­–ç•¥ï¼Œé»˜è®¤æ˜¯å¼‚æ­¥å¤åˆ¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;binlog_order_commits&lt;/code&gt;å‚æ•°æ§åˆ¶innodb commité¡ºåºå’Œbinlogå†™å…¥é¡ºåºæ˜¯å¦ä¸€è‡´ï¼Œé»˜è®¤å¯ç”¨ä¿è¯é¡ºåºä¸€è‡´ï¼Œæ–¹ä¾¿å¤‡ä»½å’Œå¿«é€Ÿæ¢å¤ï¼›å’Œbinlogç»„æäº¤é…åˆä½¿ç”¨ï¼Œè¿™ä¸ªå‚æ•°æ¥è‡ªå®˜ç½‘çš„ä»‹ç»ï¼š&lt;/p&gt;
&lt;p&gt;å½“åœ¨å¤åˆ¶æºæœåŠ¡å™¨ä¸Šå¯ç”¨æ­¤å˜é‡æ—¶ï¼ˆè¿™æ˜¯é»˜è®¤è®¾ç½®ï¼‰ï¼Œå‘é€ç»™å­˜å‚¨å¼•æ“çš„äº‹åŠ¡æäº¤æŒ‡ä»¤åœ¨å•ä¸ªleaderçº¿ç¨‹ä¸Šè¢«åºåˆ—åŒ–ï¼Œå› æ­¤äº‹åŠ¡æ€»æ˜¯æŒ‰ç…§å†™å…¥binlogçš„ç›¸åŒé¡ºåºæäº¤ã€‚ç¦ç”¨æ­¤å˜é‡å…è®¸ä½¿ç”¨å¤šä¸ªçº¿ç¨‹å‘å‡ºäº‹åŠ¡æäº¤æŒ‡ä»¤ã€‚ä¸binlogç»„æäº¤ç»“åˆä½¿ç”¨ï¼Œè¿™å¯ä»¥é˜²æ­¢å•ä¸ªäº‹åŠ¡çš„æäº¤ç‡æˆä¸ºååé‡çš„ç“¶é¢ˆï¼Œå› æ­¤å¯èƒ½ä¼šäº§ç”Ÿæ€§èƒ½æ”¹è¿›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Flushé˜¶æ®µï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è°ƒç”¨æµç¨‹ï¼šTC_LOG::enum_result MYSQL_BIN_LOG::commit(THD *thd, bool all) â†’&lt;a href=&#34;&#34;&gt;int MYSQL_BIN_LOG::ordered_commit(THD *thd, bool all, bool skip_commit)&lt;/a&gt;  â†’  &lt;a href=&#34;https://github.com/mysql/mysql-server/blob/8.0/sql/binlog.cc#L8301&#34;&gt;int MYSQL_BIN_LOG::process_flush_stage_queue&lt;/a&gt; ;&lt;/p&gt;
&lt;p&gt;RUN_HOOK å»è·å–åŠ è½½çš„æ’ä»¶ï¼Œrpl handler Binlog_storage_delegate::after_flush FOREACH_OBSERVERå® éå†observeråˆ—è¡¨Observer_info-&amp;gt;observerè°ƒç”¨å¯¹åº”replicationæ’ä»¶å‡½æ•°&lt;/p&gt;
&lt;p&gt;æœ€ç»ˆè°ƒç”¨&lt;a href=&#34;https://github.com/mysql/mysql-server/blob/8.0/storage/innobase/os/os0file.cc#L2847&#34;&gt;os_file_fsync_posix&lt;/a&gt; flush redolog to disk ; æ ¹æ®ä¸åŒçš„æ“ä½œç³»ç»Ÿæ¥è°ƒç”¨ï¼Œunixæ“ä½œç³»ç»Ÿè°ƒç”¨fsync/fdatasyncå‡½æ•°åˆ·ç›˜, fsyncä¼šç¡®ä¿OS cacheä¸­çš„æ•°æ®ç›´åˆ°å†™ç£ç›˜æ“ä½œç»“æŸæ‰ä¼šè¿”å›ï¼Œå¹¶ä¸”å†™å…¥å…ƒæ•°æ®ï¼Œè€Œfdatasyncä¸ä¼š; å¦‚æœæƒ³ä¸èµ°OS cacheç›´æ¥å†™ç£ç›˜ï¼Œå¯¹æ‰“å¼€/åˆ›å»ºçš„æ–‡ä»¶å¥æŸ„åŠ ä¸ŠO_DIRECTå±æ€§ï¼Œä¸€èˆ¬ç”¨äºå†™ç³»ç»Ÿè¡¨ç©ºé—´æ•°æ®è½ç›˜ï¼›&lt;/p&gt;
&lt;p&gt;æ­¤æ—¶process_flush_stage_queueå¤„ç†ä¼šå½¢æˆä¸€ç»„é˜Ÿåˆ—ï¼Œç”±ç»„leader(ä¸€ä¸ªç»„ä¸­æœ€æ—©å¼€å§‹çš„äº‹åŠ¡)ä¾æ¬¡ä¸ºåˆ«çš„çº¿ç¨‹å†™binlogæ–‡ä»¶ åœ¨å‡†å¤‡å†™binlogå‰ï¼Œä¼šå…ˆè°ƒç”¨ha_flush_logs -&amp;gt; innobase_flush_logsæ¥å£ï¼Œå°†å­˜å‚¨çš„æ—¥å¿—å†™åˆ°æœ€æ–°çš„LSNï¼›ç„¶åå†å†™binlogåˆ°æ–‡ä»¶; è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†æå‡ç»„æäº¤çš„æ•ˆç‡ã€‚&lt;/p&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;æ‰§è¡Œå™¨ è°ƒç”¨innodbå­˜å‚¨å¼•æ“innobase_flush_logs-&amp;gt;log_flush_low-&amp;gt;redo_space_flush-&amp;gt;os_file_flush-&amp;gt;&lt;a href=&#34;https://github.com/mysql/mysql-server/blob/8.0/storage/innobase/os/os0file.cc#L2847&#34;&gt;os_file_fsync_posix&lt;/a&gt; æ¥å£ å°† redo/undo log bufferä¸­çš„æ•°æ®å†™å…¥redo/undo log file ç£ç›˜ä¸­ï¼›&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œå™¨ è°ƒç”¨ MYSQL_BIN_LOG::flush_thread_caches å°† thread caches binlogç¼“å†²æ•°æ®  å†™å…¥ bin log(xid,GTID)ä¸­(è¿˜æœªåˆ·ç›˜),é€šè¿‡ &lt;code&gt;show variables like &#39;%binlog_cache%&#39;;&lt;/code&gt;æŸ¥çœ‹ç¼“å†²å¤§å°ï¼› å¹¶ä¸”è®¾ç½®å¥½äº‹åŠ¡çš„å†™å…¥ä½ç½®m_trans_end_posï¼Œå½“äº‹åŠ¡æäº¤commité˜¶æ®µçš„æ—¶å€™ï¼Œç›´æ¥è·å–ä½ç½®æäº¤ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Sync_binlogé˜¶æ®µï¼š&lt;/strong&gt; &lt;a href=&#34;https://github.com/mysql/mysql-server/blob/8.0/sql/binlog.cc#L8506&#34;&gt;std::pair&amp;lt;bool, bool&amp;gt; MYSQL_BIN_LOG::sync_binlog_file(bool force)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;RUN_HOOK å»è·å–åŠ è½½çš„æ’ä»¶ï¼Œrpl handler Binlog_storage_delegate::after_sync FOREACH_OBSERVERå®éå†observeråˆ—è¡¨Observer_info-&amp;gt;observerè°ƒç”¨å¯¹åº”replicationæ’ä»¶å‡½æ•°ï¼›&lt;/p&gt;
&lt;p&gt;æœ€ç»ˆè°ƒç”¨ &lt;a href=&#34;https://github.com/mysql/mysql-server/blob/8.0/mysys/my_sync.cc#L84&#34;&gt;int my_sync(File fd, myf my_flags)&lt;/a&gt;  Sync binlog data in file to disk&lt;/p&gt;
&lt;p&gt;å¦‚æœ&lt;code&gt;sync_binlog&lt;/code&gt;è®¡æ•°è¶…è¿‡é…ç½®å€¼ï¼Œåˆ™è¿›è¡Œä¸€æ¬¡æ–‡ä»¶fsyncï¼Œn&amp;gt;1 å¼€å¯ç»„æäº¤ï¼Œå‚æ•°&lt;code&gt;sync_binlog&lt;/code&gt;çš„å«ä¹‰ä¸æ˜¯æŒ‡çš„è¿™ä¹ˆå¤šä¸ªäº‹åŠ¡ä¹‹ååšä¸€æ¬¡fsyncï¼Œè€Œæ˜¯å¤šä¸ªäº‹åŠ¡ä¸€ç»„ä¹‹ååšä¸€æ¬¡fsyncï¼Œ&lt;code&gt;binlog_group_commit_sync_delay&lt;/code&gt;,&lt;code&gt;binlog_group_commit_sync_no_delay_count&lt;/code&gt; è¿™äº›å‚æ•°è§å®˜ç½‘æ–‡æ¡£ï¼›&lt;/p&gt;
&lt;ol start=&#34;8&#34;&gt;
&lt;li&gt;å¼€å§‹ç”Ÿæˆè¿™ä¸ªæ—¶é—´ç‚¹çš„é€»è¾‘æ“ä½œæ—¥å¿—æ ¼å¼ï¼Œé€šè¿‡&lt;code&gt;sync_binlog&lt;/code&gt; flushç­–ç•¥å¼‚æ­¥å°†thead cachesä¸­çš„æ•°æ®æ‰¹é‡å†™å…¥åˆ°ç£ç›˜binlogæ–‡ä»¶binlog.**/binlog.indexä¸­ï¼› é€šè¿‡ &lt;code&gt;show binlog events;&lt;/code&gt;æ¥æŸ¥çœ‹binlogæ–‡ä»¶ç›¸å…³çš„ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥å¯¹å•ä¸ªæ–‡ä»¶æŸ¥çœ‹ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Async/Semisync/Group å¼‚æ­¥/åŠåŒæ­¥/ç»„å¤åˆ¶é˜¶æ®µï¼š&lt;/strong&gt; (å†™æ“ä½œéƒ½åœ¨ä¸»ä¸Š)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¼‚æ­¥å¤åˆ¶&lt;/strong&gt;ï¼šä¸»åº“åœ¨è®°å½•å®Œbinlogï¼Œæ‰§è¡Œå®Œè‡ªå·±çš„äº‹åŠ¡ä¹‹åå°±ä¼šç›´æ¥è¿”å›ï¼Œmysqlä¸»ä»æ¨¡å¼é»˜è®¤æ˜¯å¼‚æ­¥å¤åˆ¶ï¼›å¼‚æ­¥å¤åˆ¶æµç¨‹å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://dev.mysql.com/doc/refman/8.0/en/images/async-replication-diagram.png&#34; alt=&#34;async-replication-diagram&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åŠåŒæ­¥å¤åˆ¶&lt;/strong&gt;ï¼šä¸»çš„äº‹åŠ¡éœ€è¦ç­‰ä¸€å°ä»åŒæ­¥binlogæ—¥å¿—æäº¤åˆ°Relay Logä¸­(sync_relay=1)ï¼Œè¿”å›ackï¼Œä¸»åº“æäº¤äº‹åŠ¡ï¼›åŠåŒæ­¥æµç¨‹å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://dev.mysql.com/doc/refman/8.0/en/images/semisync-replication-diagram.png&#34; alt=&#34;semisync-replication-diagram&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»MySQL5.5å¼€å§‹ ä»¥æ’ä»¶çš„å½¢å¼æ”¯æŒåŠåŒæ­¥å¤åˆ¶ï¼›å¦‚æœéœ€è¦æ”¯æŒï¼Œä¸»ä»éƒ½éœ€è¦å®‰è£…åŠåŒæ­¥æ’ä»¶åº“ï¼›å¯¹åº”çš„ä»£ç åœ¨&lt;a href=&#34;https://github.com/mysql/mysql-server/tree/8.0/plugin/semisync&#34;&gt;plugin/semisync&lt;/a&gt;æ–‡ä»¶å¤¹ä¸­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸» &lt;code&gt;install plugin rpl_semi_sync_master soname &#39;semisync_master.so&#39;;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä» &lt;code&gt;install plugin rpl_semi_sync_slave soname &#39;semisync_slave.so&#39;;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å¹¶ä¸”æ‰“å¼€åŠåŒæ­¥å¤åˆ¶ï¼Œ&lt;code&gt;set global rpl_semi_sync_master_enabled=1;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å…¶ä¸­é€šè¿‡å‚æ•°&lt;code&gt;rpl_semi_sync_master_wait_point&lt;/code&gt;æ¥å†³å®šä»€ä¹ˆæ—¶å€™æäº¤äº‹åŠ¡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;after_sync&lt;/strong&gt; ä¸»åº“å…ˆä¸æäº¤äº‹åŠ¡ï¼Œç­‰å¾…æŸä¸€ä¸ªä»åº“è¿”å›äº†ç»“æœä¹‹åï¼Œå†æäº¤äº‹åŠ¡ï¼Œåœ¨è¿”å›ç»“æ„é€šçŸ¥å®¢æˆ·ç«¯ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœä»åº“åœ¨æ²¡æœ‰ä»»ä½•è¿”å›çš„æƒ…å†µä¸‹å®•æœºäº†ï¼Œmasterè¿™è¾¹ä¹Ÿæ— æ³•æäº¤äº‹åŠ¡ã€‚ä¸»ä»ä»ç„¶æ˜¯ä¸€è‡´çš„ï¼Œmysql5.7ä¹‹åé»˜è®¤å€¼ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;after_commit&lt;/strong&gt; ä¸»åº“å…ˆæäº¤äº‹åŠ¡ï¼Œç­‰å¾…ä»åº“è¿”å›ç»“æœå†é€šçŸ¥å®¢æˆ·ç«¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;ç»„å¤åˆ¶&lt;/strong&gt;ï¼šåŸºäºåŸç”Ÿå¤åˆ¶åŠ paxos åè®®ï¼Œæä¾›ä¸€è‡´æ•°æ®å®‰å…¨ä¿è¯ï¼Œä¸€ç§å¯ç”¨äºå®ç°å®¹é”™ç³»ç»Ÿçš„æŠ€æœ¯ï¼›å…·ä½“è¯¦æƒ…è§å®˜æ–¹æ–‡æ¡£ï¼š&lt;a href=&#34;https://dev.mysql.com/doc/refman/8.0/en/group-replication.html&#34;&gt;MySQL8.0 Group Replication&lt;/a&gt;ï¼›ç»„å¤åˆ¶æµç¨‹å¦‚ä¸‹å›¾ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://dev.mysql.com/doc/refman/8.0/en/images/gr-replication-diagram.png&#34; alt=&#34;gr-replication-diagram&#34;&gt;&lt;/p&gt;
&lt;p&gt;MySQL 5.7.17ç‰ˆæœ¬ä¸­å¼•å…¥MySQL ç»„å¤åˆ¶ï¼ŒåŒæ ·ä¹Ÿæ˜¯ä»¥æ’ä»¶çš„å½¢å¼æ”¯æŒ; å¯¹åº”çš„ä»£ç åœ¨&lt;a href=&#34;https://github.com/mysql/mysql-server/tree/8.0/plugin/group_replication&#34;&gt;plugin/group_replication&lt;/a&gt;æ–‡ä»¶å¤¹ä¸­ã€‚ä¸€ç»„å‰¯æœ¬æœºå™¨å®‰è£…æ’ä»¶éƒ½æ˜¯&lt;code&gt;INSTALL PLUGIN group_replication SONAME &#39;group_replication.so&#39;;&lt;/code&gt;&lt;/p&gt;
&lt;ol start=&#34;8&#34;&gt;
&lt;li&gt;å¦‚æœå¼€å¯çš„ä¸»ä»å¤åˆ¶(é»˜è®¤å¼‚æ­¥)1:nï¼Œä¸»åº“ä¼šç­‰å¾…ä»åº“I/Oçº¿ç¨‹å»ºç«‹è¿æ¥ä¹‹åï¼Œåˆ›å»ºbinlog dumpçº¿ç¨‹ï¼Œé€šçŸ¥slaveæœ‰æ•°æ®æ›´æ–°ï¼Œå½“I/Oçº¿ç¨‹è¯·æ±‚æ—¥å¿—å†…å®¹æ—¶ï¼Œä¼šå°†æ­¤æ—¶çš„binlogåç§°å’Œå½“å‰æ›´æ–°çš„ä½ç½®posåŒæ—¶ä¼ ç»™slaveçš„I/Oçº¿ç¨‹, æŠŠbinlog eventå‘é€ç»™ä»åº“I/Oçº¿ç¨‹ï¼Œä»åº“I/Oçº¿ç¨‹è·å–åˆ°binlog eventä¹‹åå°†å…¶å†™å…¥åˆ°è‡ªå·±çš„Relay Logä¸­ï¼Œç„¶åä»åº“å¯åŠ¨SQLçº¿ç¨‹ï¼Œå°†Relayä¸­çš„æ•°æ®è¿›è¡Œé‡æ”¾ï¼Œå®Œæˆä»åº“çš„æ•°æ®æ›´æ–°ï¼›ä¸ºäº†ä¿è¯ä¸é‡å¤æ›´æ–°ï¼Œbinlog/relaylog ä¸­è®°å½•äº†GTIDï¼ˆmysql5.6åŠ å…¥ï¼‰, å…¨å±€å”¯ä¸€, å¦‚æœrelaylogä¸­å·²æœ‰GTID, åˆ™æ‰§è¡ŒGTIDè‡ªåŠ¨è·³è¿‡ï¼Œæ„å‘³ç€åœ¨æºä¸Šæäº¤çš„äº‹åŠ¡åªèƒ½åœ¨å‰¯æœ¬ä¸Šåº”ç”¨ä¸€æ¬¡ï¼Œè¿™æœ‰åŠ©äºä¿è¯ä¸€è‡´æ€§;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦å¤–å¦‚æœä¸»ä»å¤åˆ¶è¿‡ç¨‹çªç„¶ä¸­æ–­äº†ï¼Œæˆ–è€…ä¸»ä»åˆ‡æ¢äº†ï¼Œé‡å¯ä¹‹åå‘ç°SQLçº¿ç¨‹å®é™…æ‰§è¡Œåˆ°ä½ç½®å’Œæ•°æ®åº“è®°å½•çš„ä¸ä¸€è‡´ï¼›mysql5.6ä¹‹åå°†å¤åˆ¶çš„è¿›åº¦æ”¾åœ¨ç³»ç»Ÿçš„&lt;code&gt;mysql.slave_relay_log_info&lt;/code&gt;innodbè¡¨é‡Œï¼Œå¹¶ä¸”æŠŠæ›´æ–°è¿›åº¦ã€SQLçº¿ç¨‹æ‰§è¡Œç”¨æˆ·äº‹åŠ¡ç»‘å®šæˆä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œã€‚å³ä½¿å®•æœºäº†ï¼Œå¯ä»¥é€šè¿‡MySQLå†…å»ºçš„å´©æºƒæ¢å¤æœºåˆ¶æ¥ä½¿å®é™…æ‰§è¡Œçš„ä½ç½®å’Œæ•°æ®åº“ä¿å­˜çš„è¿›åº¦æ¢å¤åˆ°ä¸€è‡´ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Commité˜¶æ®µ:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è°ƒç”¨æµç¨‹ï¼šint MYSQL_BIN_LOG::finish_commit(THD *thd) -&amp;gt; ha_commit_low -&amp;gt; innobase_commit -&amp;gt; &lt;a href=&#34;https://github.com/mysql/mysql-server/blob/8.0/storage/innobase/trx/trx0trx.cc#L2199&#34;&gt;void trx_commit(trx_t *trx)&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;RUN_HOOK å»è·å–åŠ è½½çš„æ’ä»¶ï¼Œrpl handler Trans_delegate::after_commit  FOREACH_OBSERVERå®éå†observeråˆ—è¡¨Observer_info-&amp;gt;observerè°ƒç”¨å¯¹åº”replicationæ’ä»¶å‡½æ•°ï¼›&lt;/p&gt;
&lt;ol start=&#34;9&#34;&gt;
&lt;li&gt;
&lt;p&gt;åªæœ‰binlogå†™å…¥ç£ç›˜æˆåŠŸä¹‹åï¼Œæ‰§è¡Œå™¨æ‰ä¼šè°ƒç”¨innodbå­˜å‚¨å¼•æ“æ¥å£ï¼Œä»é˜Ÿåˆ—ä¸­è·å–äº‹åŠ¡ç»„ä¾æ¬¡è¿›è¡Œinnodb commit æäº¤é‡Šæ”¾äº‹åŠ¡ï¼Œå°†redo logä¸­å·²ç»prepareçš„äº‹åŠ¡æäº¤å†™å…¥commitæ ‡è®°ï¼Œå¹¶ä¸”å†™å…¥binlogä½ç‚¹ï¼›æœ€åè°ƒç”¨MYSQL_BIN_LOG::rotate æ˜¯å¦åˆ‡æ¢binlogæ–‡ä»¶(åœ¨åˆ‡æ¢æ–‡ä»¶æœŸé—´ï¼Œä½¿ç”¨ä¸€ä¸ªé˜²æ­¢æ–°çš„æäº¤ç»„æ‰§è¡Œåˆ·æ–°é˜¶æ®µçš„é”ï¼Œå¹¶ç­‰å¾…ç›´åˆ°å‡†å¤‡å¥½çš„äº‹åŠ¡çš„è®¡æ•°å™¨å˜ä¸º0ï¼Œç„¶åæ‰åˆ›å»ºæ–°æ–‡ä»¶)ï¼Œå¦‚æœåˆ‡æˆæ–°æ–‡ä»¶ï¼Œ è°ƒç”¨MYSQL_BIN_LOG::purge()åˆ·ç›˜ï¼›ç»“æŸordered_commit ç»„æäº¤æµç¨‹,è¿”å›æäº¤ï¼›&lt;/p&gt;
&lt;p&gt;Tips: Commité˜¶æ®µä¸ç”¨åˆ·ç›˜ï¼ŒFlushé˜¶æ®µä¸­çš„redo logåˆ·ç›˜å·²ç»è¶³å¤Ÿä¿è¯æ•°æ®åº“å´©æºƒæ—¶çš„æ•°æ®å®‰å…¨äº†; Commité˜¶æ®µé˜Ÿåˆ—çš„ä½œç”¨æ˜¯æ‰¿æ¥Syncé˜¶æ®µçš„äº‹åŠ¡ï¼Œå®Œæˆæœ€åçš„å¼•æ“æäº¤ï¼Œä½¿å¾—Syncå¯ä»¥å°½æ—©çš„å¤„ç†ä¸‹ä¸€ç»„äº‹åŠ¡ï¼Œæœ€å¤§åŒ–ç»„æäº¤çš„æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;æ•´ä½“æ›´æ–°æµç¨‹&#34;&gt;æ•´ä½“æ›´æ–°æµç¨‹ï¼š&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/mysql-innodb-w.drawio.png&#34; alt=&#34;mysql-innodb-w&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;å´©æºƒæ¢å¤&#34;&gt;å´©æºƒæ¢å¤&lt;/h3&gt;
&lt;p&gt;æ›´æ–°æµç¨‹ä¸­å†™å…¥redo logçš„è¿‡ç¨‹æ‹†æˆäº†ä¸¤ä¸ªæ­¥éª¤prepareå’Œcommit ä¸¤ä¸ªé˜¶æ®µï¼›å¦‚æœä¸ä½¿ç”¨ä¸¤é˜¶æ®µæäº¤ï¼Œæ•°æ®åº“çš„çŠ¶æ€å°±æœ‰å¯èƒ½å’Œç”¨å®ƒçš„æ—¥å¿—æ¢å¤å‡ºæ¥çš„åº“çš„çŠ¶æ€ä¸ä¸€è‡´ã€‚åœ¨å´©æºƒæ¢å¤ä¸­ï¼Œ&lt;!-- raw HTML omitted --&gt;æ˜¯ä»¥ binlog ä¸­çš„ xid å’Œ redolog ä¸­çš„ xid è¿›è¡Œæ¯”è¾ƒï¼Œxid åœ¨ binlog é‡Œå­˜åœ¨åˆ™æäº¤ï¼Œä¸å­˜åœ¨åˆ™å›æ»šï¼Œä»¥åŠåˆ¤æ–­redo logä¸­æ˜¯å¦æœ‰commitæ ‡è¯†&lt;!-- raw HTML omitted --&gt;ï¼›å´©æºƒæ¢å¤æ—¶å…·ä½“çš„æƒ…å†µ:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;binlogæ— è®°å½•ï¼Œredologæ— è®°å½•ï¼šåœ¨redologå†™ä¹‹å‰crash, æ— prepareçŠ¶æ€ï¼Œæ— undo log è®°å½•ï¼Œæ¢å¤æ“ä½œï¼šæ— ï¼Œæ— éœ€å…³å¿ƒï¼›&lt;/li&gt;
&lt;li&gt;binlogæ— è®°å½•ï¼Œredologæ— è®°å½•ï¼šåœ¨redologå†™ä¹‹å‰crash, æ— prepareçŠ¶æ€ï¼Œæœ‰undo log è®°å½•ï¼Œæ¢å¤æ“ä½œï¼šé€šè¿‡undo logå›æ»šäº‹åŠ¡ï¼›&lt;/li&gt;
&lt;li&gt;binlogæœ‰è®°å½•ï¼Œredologæœ‰è®°å½•ï¼šredologçŠ¶æ€prepareï¼Œ åˆ™åˆ¤æ–­å¯¹åº”çš„äº‹åŠ¡æ˜¯å¦å­˜åœ¨å®Œæ•´çš„binlogï¼Œæ¢å¤æ“ä½œï¼šå¦‚æœæ˜¯, åˆ™æäº¤äº‹åŠ¡ï¼Œå¦åˆ™, é€šè¿‡undo logå›æ»šäº‹åŠ¡;&lt;/li&gt;
&lt;li&gt;å¦‚æœredo logé‡Œé¢çš„äº‹åŠ¡æ˜¯å®Œæ•´çš„, ä¹Ÿå°±æ˜¯æœ‰äº†commitæ ‡è¯†, æ¢å¤æ“ä½œï¼šç›´æ¥æäº¤äº‹åŠ¡ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;å¯¹äºéœ€è¦æŒä¹…åŒ–çš„æ•°æ®åº“ç³»ç»Ÿï¼Œé¿å…ä¸äº†äº‹åŠ¡åœ¨å¤„ç†è¿‡ç¨‹ä¸­ï¼Œçªç„¶ä¸­æ–­çš„æƒ…å†µï¼›WALé€šè¿‡é¢„å†™æ—¥å¿—çš„æ–¹å¼åœ¨äº‹åŠ¡æäº¤ä¹‹å‰ï¼Œéœ€è¦æŠŠä¿®æ”¹é‡æ”¾è®°å½•å’Œæ’¤é”€è¯¦ç»†è®°å½•å†™å…¥æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿åœ¨æ•…éšœåæ¢å¤æ•°æ®ï¼›äº‹åŠ¡å¼€å§‹åï¼Œæ‰€æœ‰å¯¹æ•°æ®åº“çš„ä¿®æ”¹åœ¨å‘é€åˆ°ç¼“å†²æ± ä¹‹å‰éƒ½è¢«è®°å½•åœ¨å†…å­˜ä¸­çš„WALç¼“å†²åŒºä¸­ï¼›äº‹åŠ¡æäº¤ä¹‹å‰ï¼Œå¿…é¡»æŠŠWALç¼“å†²åŒºåˆ·æ–°åˆ°ç£ç›˜ã€‚mysql innodbå­˜å‚¨å¼•æ“å¼•å…¥redo/undo logæ–‡ä»¶æ¥æ”¯æŒäº‹åŠ¡æŒä¹…æ€§å’ŒåŸå­æ€§ï¼Œç”±äºmysql binlogç”¨æ¥å½’æ¡£æ•°æ®è®°å½•æ¢å¤å’Œå¤åˆ¶ï¼Œä¸ºäº†ä¿è¯å†™å…¥ä¸¤ä»½æ—¥å¿—redo log, binlog æœ€ç»ˆæ¢å¤æ•°æ®æ˜¯ä¸€è‡´çš„ï¼Œé‡‡ç”¨ä¸¤é˜¶æ®µæäº¤æœºåˆ¶ï¼Œé€šè¿‡æºç äº†è§£äº†äº›æ•´ä½“WALçš„å®ç°ï¼›ä»¥åŠå´©æºƒæ—¶å€™éœ€è¦ç”¨æ—¥å¿—è¿›è¡Œæ¢å¤ã€‚(å…¶ä»–æŒä¹…åŒ–å­˜å‚¨ç³»ç»Ÿçš„WALå®ç°ï¼Œå¾…ç»­)&lt;/p&gt;
&lt;h2 id=&#34;references&#34;&gt;references&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Write-ahead_logging&#34;&gt;Write-ahead_logging&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Algorithms_for_Recovery_and_Isolation_Exploiting_Semantics&#34;&gt;ARIES:Algorithms_for_Recovery_and_Isolation_Exploiting_Semantics&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cs.stanford.edu/people/chrismre/cs345/rl/aries.pdf&#34;&gt;aries.pdf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/OceanBase-Partner/lectures-on-dbms-implementation/blob/main/lecture-6.md#642-%E7%BC%93%E5%86%B2%E6%B1%A0%E7%AE%A1%E7%90%86%E7%AD%96%E7%95%A5&#34;&gt;ç¼“å†²æ± ç®¡ç†ç­–ç•¥&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://mesl.ucsd.edu/pubs/SOSP2013-MARS.pdf&#34;&gt;From ARIES to MARS: Transaction Support for Next-Generation, Solid-State Drives.pdf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://repository.bilkent.edu.tr/bitstream/handle/11693/37609/Implications%20of%20non-volatile%20memory%20as%20primary%20storage%20for%20database%20management%20systems.pdf&#34;&gt;Implications of Non-Volatile Memory as Primary Storage for Database Management Systems.pdf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://infoscience.epfl.ch/record/170505/files/aether-smpfulltext.pdf&#34;&gt;Scalability of write-ahead logging on multicore and multisocket hardware.pdf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.vldb.org/pvldb/vol10/p337-arulraj.pdf&#34;&gt;WBL.pdf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=S9nctHdkggk&#34;&gt;ARIES Overview, Types of Log Records, ARIES Helper Structures&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=4VGkRXVM5fk&#34;&gt;ARIES Database Recovery (CMU Databases Systems / Fall 2019)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://dev.mysql.com/doc/internals/en/binary-log.html&#34;&gt;mysql binary-log&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://mysql.taobao.org/monthly/2021/10/01/&#34;&gt;MySQL Â· å¼•æ“ç‰¹æ€§ Â· åº–ä¸è§£InnoDBä¹‹UNDO LOG&lt;/a&gt;  &lt;a href=&#34;http://catkang.github.io/2020/02/27/mysql-redo.html&#34;&gt;åº–ä¸è§£InnoDBä¹‹REDO LOG&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://mysql.taobao.org/monthly/2020/05/09/&#34;&gt;MySQL Â· å¼•æ“ç‰¹æ€§ Â· åŸºäºGTIDå¤åˆ¶å®ç°çš„å·¥ä½œåŸç†&lt;/a&gt;  &lt;a href=&#34;http://mysql.taobao.org/monthly/2020/05/07/&#34;&gt;MySQL Â· æºç åˆ†æ Â· å†…éƒ¨ XA å’Œç»„æäº¤&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://time.geekbang.org/column/article/73161&#34;&gt;æ—¥å¿—å’Œç´¢å¼•ç›¸å…³é—®é¢˜&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://developer.aliyun.com/article/617776&#34;&gt;[å›¾è§£MySQL]MySQLç»„æäº¤(group commit)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://mysql.taobao.org/monthly/2018/07/01/&#34;&gt;MySQL Â· å¼•æ“ç‰¹æ€§ Â· WALé‚£äº›äº‹å„¿&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/372300181&#34;&gt;æ— å¤„ä¸åœ¨çš„ MySQL XA äº‹åŠ¡&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://dev.mysql.com/doc/refman/8.0/en/server-option-variable-reference.html&#34;&gt;Server Option, System Variable, and Status Variable Reference&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://icyfenix.cn/architect-perspective/general-architecture/transaction/local.html&#34;&gt;å‡¤å‡°æ¶æ„-æœ¬åœ°äº‹åŠ¡&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
      
    </item>
    
    <item>
      <title>è®¾è®¡-é…ç½®å¹³å°</title>
      <link>https://weedge.github.io/post/conf/</link>
      <pubDate>Thu, 18 Nov 2021 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/conf/</guid>
      
        <description>&lt;h3 id=&#34;ä»‹ç»&#34;&gt;ä»‹ç»&lt;/h3&gt;
&lt;p&gt;ä¸šåŠ¡æœåŠ¡åœ¨å¯åŠ¨æ—¶åŠ è½½é…ç½®ï¼Œé…ç½®åˆ†ä¸ºé™æ€é…ç½®å’ŒåŠ¨æ€é…ç½®ï¼Œé™æ€é…ç½®å¦‚æœåŠ¡ç›‘å¬çš„ç«¯å£ï¼Œæ—¥å¿—è·¯å¾„ï¼Œè®¿é—®ä¾èµ–æœåŠ¡å•å…ƒä¸åŒäº‘(region / zone) åŸŸååœ°å€ç­‰ï¼›åŠ¨æ€é…ç½®åŒ…æ‹¬ä¸šåŠ¡é…ç½®ï¼Œæµç¨‹ç®¡ç†é…ç½®ï¼Œç­–ç•¥é…ç½®ç­‰ï¼›é™æ€é…ç½®æœåŠ¡å¯åŠ¨ä¹‹åä¸ä¼šæ›´æ”¹ï¼Œè€ŒåŠ¨æ€é…ç½®åœ¨æœåŠ¡å¯åŠ¨è¿è¡Œæ—¶å¯ä»¥åŠ¨æ€çƒ­åŠ è½½ï¼›å°†é…ç½®çš„å†…å®¹å’Œç‰ˆæœ¬è¿›è¡Œåˆ†ç¦»ï¼Œå…³æ³¨é…ç½®çš„ç®¡ç†è€Œæ— éœ€å…³æ³¨é…ç½®çš„å†…å®¹ï¼Œé…ç½®å†…å®¹ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰é…ç½®å†…å®¹ï¼Œä½¿ç”¨json-schemaè¿›è¡Œæ ¡éªŒï¼Œæä¾›è‡ªå®šä¹‰é…ç½®å†…å®¹jsonç»™åå°uiå‰ç«¯è¿›è¡Œå•ä¸ªæ•´ä½“é…ç½®çš„äº¤äº’ï¼Œé…ç½®åå°åªéœ€åŠ è½½json-schemaè¿›è¡Œæ ¡éªŒæäº¤å†…å®¹ï¼Œjson-schemaç”±ç”¨æˆ·ä¸Šä¼ æä¾›åœ°å€å³å¯ã€‚&lt;/p&gt;
&lt;h3 id=&#34;ç›®æ ‡&#34;&gt;ç›®æ ‡&lt;/h3&gt;
&lt;p&gt;é€šè¿‡é…ç½®åå°ï¼Œä¸šåŠ¡æœåŠ¡æµç¨‹å¯æ§ï¼Œå¯é…ç½®ï¼Œå¯è§†åŒ–ï¼Œéš”ç¦»å·²æœ‰ä¸šåŠ¡åœºæ™¯é…ç½®ï¼Œæé«˜äººæ•ˆï¼›&lt;/p&gt;
&lt;h3 id=&#34;åŠŸèƒ½&#34;&gt;åŠŸèƒ½&lt;/h3&gt;
&lt;h4 id=&#34;åå°åŸºç¡€åŠŸèƒ½&#34;&gt;åå°åŸºç¡€åŠŸèƒ½&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;åå°ç®¡ç†å‘å¸ƒç”Ÿäº§ç¯å¢ƒçš„åŠ¨æ€é…ç½®ï¼ŒåŒ…æ‹¬æ–°å¢ï¼Œä¿®æ”¹ï¼Œå®¡æ ¸ï¼Œå‘å¸ƒï¼Œå›æ»šç­‰åŠŸèƒ½ï¼›&lt;/li&gt;
&lt;li&gt;å¤šäººå‘å¸ƒçš„æ—¶å€™ï¼Œæ£€æŸ¥å½“å‰çš„ç‰ˆæœ¬æ˜¯å¦å·²ç»å‘å¸ƒï¼Œå¹¶è¿›è¡Œç‰ˆæœ¬diff;&lt;/li&gt;
&lt;li&gt;é…ç½®æ˜¯æœåŠ¡æ¥å£ç»´åº¦è¿›è¡Œæ“ä½œç®¡ç†ï¼Œ ä»¥æœåŠ¡ç²’åº¦è¿›è¡Œæ•´ä½“å‘å¸ƒï¼›&lt;/li&gt;
&lt;li&gt;æä¾›è·å–å½“å‰å·²å‘å¸ƒçš„æœåŠ¡é…ç½®æ¥å£ï¼Œç”¨äºè®¢é˜…ç«¯æ‹‰å–ï¼›&lt;/li&gt;
&lt;li&gt;æä¾›RBACæƒé™ç®¡ç†;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;åŠ¨æ€é…ç½®çƒ­åŠ è½½åŠŸèƒ½&#34;&gt;åŠ¨æ€é…ç½®çƒ­åŠ è½½åŠŸèƒ½&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;ä¸šåŠ¡æœåŠ¡é…ç½®è·å–æ–¹æ¡ˆï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æœåŠ¡é…ç½®ä¿®æ”¹å‘å¸ƒï¼Œé€šè¿‡å‘å¸ƒ/è®¢é˜…æ¨¡å¼(Pub-Sub Pattern)é€šçŸ¥ä¸šåŠ¡æœåŠ¡è¿›è¡ŒåŠ è½½ï¼›å¯ç”¨ç»„ä»¶ä¸ºæ”¯æŒpub/subå‘½ä»¤çš„redisåè®®kvæœåŠ¡ï¼Œæˆ–è€…é€šè¿‡get(mget)/set(mset) incr(seq)å‘½ä»¤è¿›è¡Œæ¨¡æ‹Ÿå®ç°ï¼›&lt;/li&gt;
&lt;li&gt;æœåŠ¡é…ç½®ä¿®æ”¹å‘å¸ƒï¼Œé€šè¿‡è§‚å¯Ÿè€…æ¨¡å¼(Observer Pattern) watchæœºåˆ¶é€šçŸ¥ä¸šåŠ¡æœåŠ¡è¿›è¡Œå®æ—¶åŠ è½½ï¼›å¯ä»¥ä½¿ç”¨etcdv3çš„watchæœºåˆ¶å®ç°;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸¤ç§æ–¹æ¡ˆéƒ½å¯ä»¥ï¼Œçœ‹æ˜¯å¦æœ‰å¯¹åº”çš„é«˜å¯ç”¨ç»„ä»¶æœåŠ¡æ”¯æŒï¼›å¦‚æœéƒ½æœ‰ï¼Œå»ºè®®ä½¿ç”¨etcdv3(client 3.4+)çš„watchæœºåˆ¶ï¼Œé€šè¿‡é•¿é“¾æ¥æ¥é€šçŸ¥å˜æ›´äº‹ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åŠ è½½æ–¹å¼æœ‰ä¸¤ç§å®ç°æ–¹æ¡ˆï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;é€šè¿‡éƒ¨ç½²å•ç‹¬agentè¿›ç¨‹æ¥è·å–é…ç½®è¿›è¡Œè§£æå†™å…¥æŒ‡å®šé…ç½®è·¯å¾„æ–‡ä»¶ä¸­(é‡å¯æ—¶)å’Œå…±äº«å†…å­˜ä¸­(è¿è¡Œæ—¶)ï¼Œå…ˆå†™æ–‡ä»¶ï¼ŒæˆåŠŸäº†ï¼Œåœ¨å†™å…±äº«å†…å­˜ï¼›ç„¶åç”±ä¸šåŠ¡æœåŠ¡è¯»å–ï¼›&lt;/p&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šæ–¹ä¾¿å•ç‹¬ç»´æŠ¤ï¼Œæ— éœ€ä¸šåŠ¡æ–¹å…³å¿ƒï¼Œåªéœ€å…³å¿ƒåŠ è½½é…ç½®çš„è·¯å¾„åœ¨åå°ç»´æŠ¤ï¼Œä»¥åŠå…±äº«å†…å­˜ä¸­çš„é…ç½®ç»“æ„ï¼›&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šå¤šäº†ä¸€æ¬¡è¿›ç¨‹ä¹‹é—´çš„äº¤äº’ï¼›ä¸šåŠ¡æ–¹ä»£ç ä¸­éœ€è¦æœ‰è¯»å–å…±äº«å†…å­˜çš„é€»è¾‘è€ƒè™‘ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æä¾›é…ç½®åŠ è½½libåº“ï¼Œç”±ä¸šåŠ¡æ–¹å¯åŠ¨é€»è¾‘ä»£ç ä¸­è°ƒç”¨ï¼›å°†è·å–é…ç½®è¿›è¡Œè§£æå†™å…¥æŒ‡å®šé…ç½®è·¯å¾„æ–‡ä»¶ä¸­ï¼ŒåŠ è½½åˆ°ä¸šåŠ¡è¿›ç¨‹é…ç½®ç»“æ„ä¸­ä½¿ç”¨å³å¯ï¼›&lt;/p&gt;
&lt;p&gt;ä¼˜ç‚¹ï¼šä¸šåŠ¡æ–¹ç›´æ¥è°ƒç”¨libåº“ä¸­çš„æ–¹æ³•ï¼Œæ— éœ€å…³å¿ƒåŠ è½½é€»è¾‘ï¼›&lt;/p&gt;
&lt;p&gt;ç¼ºç‚¹ï¼šå‡å¦‚ä¸šåŠ¡æ–¹æ˜¯ä¸åŒçš„è¯­è¨€ç¼–å†™ï¼Œéœ€è¦æä¾›ä¸åŒè¯­è¨€ç‰ˆæœ¬çš„libåº“æ–¹æ³•ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ€»ä½“æ¥è¯´ï¼Œ2ç§æ–¹æ¡ˆéƒ½å¯è¡Œï¼Œå¦‚æœç»Ÿä¸€æŠ€æœ¯æ ˆï¼Œæ¯”å¦‚ä½¿ç”¨golangè¿›è¡Œå¼€å‘ï¼Œå¯ä»¥é€‰ç”¨ç¬¬äºŒç§æ–¹æ¡ˆï¼›&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯è¿™æ ·å°±å¯ä»¥äº†ä¹ˆï¼Ÿè¿˜æœ‰ä¸šåŠ¡é›†ç¾¤é…ç½®ä¸€è‡´æ€§éœ€è¦è€ƒè™‘åˆ°ï¼Œæ¯”å¦‚ä¸šåŠ¡é›†ç¾¤æŸå°æœºå™¨çªç„¶æŠ½é£ï¼ŒæœªåŠ è½½æœ€æ–°çš„é…ç½®ï¼Œæ‰“åˆ°è¿™å°æœºå™¨çš„è¯·æ±‚å’Œå…¶ä»–æ­£å¸¸åŠ è½½é…ç½®çš„æœºå™¨çš„è¯·æ±‚é€»è¾‘ä¼šæœ‰æ‰€ä¸åŒï¼Œå¯¼è‡´æ•´ä½“æœåŠ¡æ¥å£ä¸æ˜¯å¹‚ç­‰çš„ï¼Œä¼šå‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µï¼›å¯ä»¥å€Ÿé‰´ä¸€ä¸‹ &lt;a href=&#34;https://github.com/XiaoMi/Gaea/blob/master/docs/config-reloading.md&#34;&gt;gaeaé…ç½®çƒ­åŠ è½½è®¾è®¡ä¸å®ç°&lt;/a&gt;ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é…ç½®ä¸€è‡´æ€§æ–¹æ¡ˆï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä¸¤é˜¶æ®µæäº¤çš„æ–¹å¼ï¼Œç”±ä¸šåŠ¡æœåŠ¡ä¾§æä¾›prepareæ¥å£å’Œcommitæ¥å£ï¼›&lt;/p&gt;
&lt;p&gt;å‡†å¤‡é˜¶æ®µï¼šconf-dashboardæ¨¡å—å‘å¸ƒçš„æ—¶å€™è·å–ä¸šåŠ¡æœåŠ¡çš„ipåˆ—è¡¨å¹¶å‘è°ƒç”¨æ¯ä¸ªä¸šåŠ¡æœåŠ¡ipçš„prepareæ¥å£ï¼Œå¼€å§‹è§¦å‘ä¸šåŠ¡æœåŠ¡æœ¬åœ°é…ç½®çš„æ›´æ–°æµç¨‹ï¼Œé¦–å…ˆé€šè¿‡conf-dashboardæ¨¡å—è·å–æœ€æ–°ç‰ˆæœ¬å’Œå½“å‰ç‰ˆæœ¬æ¯”è¾ƒï¼Œå¦‚æœç›¸åŒå°±æ— éœ€æ¯”è¾ƒäº†ï¼Œå¦åˆ™ä»è·å–é…ç½®æ¥å£è·å–é…ç½®è¿›è¡Œæ›´æ–°ï¼›æ›´æ–°æµç¨‹ä¸æ˜¯ç›´æ¥æ›¿æ¢çº¿ä¸Šæ­£åœ¨ä½¿ç”¨çš„æ–‡ä»¶ï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä¸ªå‡†å¤‡æ–‡ä»¶è¿›è¡Œæäº¤æ—¶æ›¿æ¢ï¼›æ¯ä¸ªprepareæ¥å£åŒæ­¥è°ƒç”¨è¿”å›ç»“æœéƒ½okäº†ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥æäº¤é˜¶æ®µï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªè¿”å›å¤±è´¥ï¼Œå‘å¸ƒå¤±è´¥ï¼Œå±•ç°å¤±è´¥è¯¦æƒ…ï¼›&lt;/p&gt;
&lt;p&gt;æäº¤é˜¶æ®µï¼šprepareæˆåŠŸåï¼›conf-dashboardæ¨¡å—ç»§ç»­å¹¶å‘è°ƒç”¨çš„commitæ¥å£ï¼Œå¼€å§‹æ–‡ä»¶æ›¿æ¢ï¼ŒåŠ è½½è‡³ç¼“å­˜é…ç½®ç»“æ„ä¸­ï¼›è¿™ä¸ªæ“ä½œæ¯”è¾ƒå¿«ï¼Œéƒ½æäº¤æˆåŠŸä¹‹åï¼Œå‘å¸ƒæˆåŠŸï¼Œå¦åˆ™å‘å¸ƒå¤±è´¥ï¼Œå±•ç°å¤±è´¥è¯¦æƒ…ï¼›&lt;/p&gt;
&lt;p&gt;å¤±è´¥å¤„ç†ï¼šå¦‚æœæŸå°æœºå™¨å‘å¸ƒå¤±è´¥ï¼Œå¯ä»¥æ’æŸ¥ä¸‹å…·ä½“åŸå› ä¹‹å(åŸå› åº”å°½é‡åœ¨prepareå’Œcommitæ¥å£ä¸­è¯¦ç»†ç»™å‡º)ï¼Œçœ‹æ˜¯å¦è·³è¿‡ç»§ç»­å‘å¸ƒè¿˜æ˜¯ä¼šæ»šï¼Œé‡å¤å‘å¸ƒä¸å½±å“ï¼Œæœ‰md5å’Œç‰ˆæœ¬æ¯”è¾ƒï¼›&lt;/p&gt;
&lt;p&gt;tips: å¦‚æœå‘å¸ƒæœºå™¨å¾ˆå¤šï¼Œå¹¶å‘åŠ›åº¦æ ¹æ®conf-dashboardæ¨¡å—éƒ¨ç½²æœºå™¨æ¥å£è´Ÿè½½ï¼Œå¯ä»¥è‡ªé€‚åº”è°ƒæ•´é™ä½ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å…œåº•æ£€æŸ¥æ›´æ–°æ–¹æ¡ˆï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;é…ç½®å‘å¸ƒæˆåŠŸåï¼Œè°ƒç”¨ä¸šåŠ¡æœåŠ¡æœºå™¨çš„metaæ¥å£è·å–æœ€æ–°æ›´æ–°æ–‡ä»¶ä¿¡æ¯ï¼Œè¿›è¡Œå…œåº•æ£€æŸ¥ç¡®è®¤ï¼›&lt;/p&gt;
&lt;p&gt;ä¸šåŠ¡æœåŠ¡å¼€å¯å…œåº•å®šæ—¶ä»»åŠ¡è·å–ä»conf-dashboardè·å–é…ç½®ç‰ˆæœ¬ï¼Œé…ç½®ä¿¡æ¯è¿›è¡Œå…œåº•æ›´æ–°, æ¯éš”10ï½30åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼›&lt;/p&gt;
&lt;p&gt;tips: è¯·æ±‚conf-dashboardè·å–é…ç½®ä¿¡æ¯çš„æ¥å£éšæœºæ‰“æ•£ï¼Œé˜²æ­¢å¹¶å‘æµé‡å¯¹conf-dashboardæ¨¡å—çš„å½±å“ï¼›&lt;/p&gt;
&lt;p&gt;å®šæ—¶ä»»åŠ¡æµç¨‹å›¾å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/confmg.drawio.png&#34; alt=&#34;cron-confmg&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ•´ä½“äº¤äº’æ¡†æ¶&#34;&gt;æ•´ä½“äº¤äº’æ¡†æ¶&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/config-arch.drawio.png&#34; alt=&#34;config-arch&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;æ•°æ®åº“æ ¸å¿ƒåŠ¨æ€é…ç½®è¡¨è®¾è®¡&#34;&gt;æ•°æ®åº“æ ¸å¿ƒåŠ¨æ€é…ç½®è¡¨è®¾è®¡&lt;/h3&gt;
&lt;p&gt;å½“å‰æœåŠ¡ç‰ˆæœ¬å’Œå½“å‰confç‰ˆæœ¬æ˜¯1å¯¹å¤šçš„åœºæ™¯ï¼Œè€Œå†å²æœåŠ¡å¿«ç…§ç‰ˆæœ¬å’Œå†å²confå¿«ç…§ç‰ˆæœ¬æ˜¯å¤šå¯¹å¤šçš„åœºæ™¯ï¼›&lt;/p&gt;
&lt;p&gt;å¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/config-version.png&#34; alt=&#34;config-version&#34;&gt;&lt;/p&gt;
&lt;p&gt;æœåŠ¡ç±»å‹æšä¸¾è¡¨ service_type&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æšä¸¾å€¼&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;é…ç½®ç±»å‹æšä¸¾è¡¨ conf_type&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;æšä¸¾å€¼&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0&lt;/td&gt;
&lt;td&gt;æ— &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æšä¸¾å€¼ç”±é…ç½®å¹³å°ç»Ÿä¸€åˆ†é…æ”¶æ•›ç®¡ç†&lt;/p&gt;
&lt;p&gt;å½“å‰æœåŠ¡ç‰ˆæœ¬è¡¨ tb_service_cur_ver&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;ä¸»é”®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;service_type&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;æœåŠ¡ç±»å‹ æ¯”å¦‚ï¼š0.æ—  1.liveme 2.livestation&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;cluster_name&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;æœåŠ¡é›†ç¾¤åç§°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;cur_ver&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;æœåŠ¡å½“å‰ç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;max_ver&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;æœ€å¤§ç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;pub_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;å‘å¸ƒæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;create_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;update_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å½“å‰confç‰ˆæœ¬è¡¨ tb_conf_cur_ver&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;ä¸»é”®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;cur_service_ver_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;å½“å‰æœåŠ¡ç‰ˆæœ¬ id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;conf_type&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;confç±»å‹ï¼Œæ¯”å¦‚ï¼š&lt;!-- raw HTML omitted --&gt;0.æ—  &lt;!-- raw HTML omitted --&gt;1.livemeDSL &lt;!-- raw HTML omitted --&gt;101.livestationAggrDSL 102.livestationSceneDSL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;cur_ver&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;confå½“å‰ç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;max_ver&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;æœ€å¤§ç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;conf_name&lt;/td&gt;
&lt;td&gt;varchar(128)&lt;/td&gt;
&lt;td&gt;confåç§°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;conf_target_path&lt;/td&gt;
&lt;td&gt;varchar(128)&lt;/td&gt;
&lt;td&gt;confç”Ÿæˆçš„ç›®æ ‡è·¯å¾„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;conf_val&lt;/td&gt;
&lt;td&gt;varchar(8192)&lt;/td&gt;
&lt;td&gt;confå½“å‰å†…å®¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;pub_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;å‘å¸ƒæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;create_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;update_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æœåŠ¡ç‰ˆæœ¬ç”¨æˆ·æ“ä½œè®°å½•è¡¨ tb_service_op_record&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;ä¸»é”®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;service_type&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;æœåŠ¡ç±»å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;cluster_name&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;æœåŠ¡é›†ç¾¤åç§°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;check_status&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;æœåŠ¡é…ç½®å®¡æ ¸çŠ¶æ€: 0.å¾…å®¡æ ¸ 1.å®¡æ ¸ä¸é€šè¿‡ 2.å®¡æ ¸é€šè¿‡&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;op_uid&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;æ“ä½œè€…uid&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;pub_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;å‘å¸ƒæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;create_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;update_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;confç‰ˆæœ¬ç”¨æˆ·æ“ä½œè®°å½• tb_conf_op_record&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;ä¸»é”®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;service_op_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;æœåŠ¡ç‰ˆæœ¬æ“ä½œ id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;conf_type&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;confç±»å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;conf_name&lt;/td&gt;
&lt;td&gt;varchar(128)&lt;/td&gt;
&lt;td&gt;confåç§°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;conf_target_path&lt;/td&gt;
&lt;td&gt;varchar(128)&lt;/td&gt;
&lt;td&gt;confç”Ÿæˆçš„ç›®æ ‡è·¯å¾„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;conf_val&lt;/td&gt;
&lt;td&gt;varchar(8192)&lt;/td&gt;
&lt;td&gt;confå½“å‰å†…å®¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;is_del&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;æ˜¯å¦åˆ é™¤ï¼Œ0.å¯ç”¨ï¼Œ1.ä¸å¯ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;pub_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;å‘å¸ƒæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;create_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;update_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æœåŠ¡å†å²ç‰ˆæœ¬å¿«ç…§è¡¨ tb_service_ver_snapshot&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;ä¸»é”®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;service_type&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;æœåŠ¡ç±»å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;cluster_name&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;æœåŠ¡é›†ç¾¤åç§°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;history_ver&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;æœåŠ¡å†å²ç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;pub_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;å‘å¸ƒæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;create_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;update_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;confå†å²ç‰ˆæœ¬å¿«ç…§è¡¨ tb_conf_version_snapshot&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;ä¸»é”®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;conf_type&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;confç±»å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;conf_name&lt;/td&gt;
&lt;td&gt;varchar(128)&lt;/td&gt;
&lt;td&gt;confåç§°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;history_ver&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;confå†å²ç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;conf_target_path&lt;/td&gt;
&lt;td&gt;varchar(128)&lt;/td&gt;
&lt;td&gt;confç”Ÿæˆçš„ç›®æ ‡è·¯å¾„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;conf_val&lt;/td&gt;
&lt;td&gt;varchar(8192)&lt;/td&gt;
&lt;td&gt;confå†å²å¿«ç…§å†…å®¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;pub_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;å‘å¸ƒæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;create_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;update_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æœåŠ¡confå†å²ç‰ˆæœ¬å…³è”è¡¨ tb_service_conf_ver_snapshot&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;ä¸»é”®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;service_ver_snapshot_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;æœåŠ¡å†å²ç‰ˆæœ¬å¿«ç…§ id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;conf_ver_snapshot_id&lt;/td&gt;
&lt;td&gt;bigint&lt;/td&gt;
&lt;td&gt;confå†å²ç‰ˆæœ¬å¿«ç…§ id&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;create_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;åˆ›å»ºæ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;update_time&lt;/td&gt;
&lt;td&gt;uint&lt;/td&gt;
&lt;td&gt;æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;åœºæ™¯æ¨¡æ‹Ÿ&#34;&gt;åœºæ™¯æ¨¡æ‹Ÿ&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;æ–°å¢ç‰ˆæœ¬ä¿å­˜æ›´æ–°åˆ é™¤&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®¡æ ¸&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å‘å¸ƒ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å›æ»š&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è·å–å½“å‰æœåŠ¡confç‰ˆæœ¬é…ç½®&lt;/p&gt;
&lt;p&gt;æœåŠ¡ç²’åº¦æ•´ä½“ç‰ˆæœ¬æ–‡ä»¶ä¸€æ¬¡æ‹‰å–ä¸‹æ¥ï¼Œè¿™é‡Œæ˜¯æ¥å£å½¢å¼æä¾›ï¼Œ åç»­å¯ä»¥æä¾›å°†å¯ç”¨ç‰ˆæœ¬ä»¥æœåŠ¡ç²’åº¦æ‰“ä¸ªåŒ…æäº¤ï¼›å¦‚æœåç»­æœ‰å¤šæœåŠ¡ä¸€èµ·æ†ç»‘æ‰“åŒ…ï¼Œéœ€è¦è€ƒè™‘ä¸Šçº¿ä¾èµ–é¡ºåºï¼Œæš‚æ—¶ä¸æä¾›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;æ¥å£&#34;&gt;æ¥å£&lt;/h3&gt;
&lt;p&gt;çº¿ä¸‹å†…ç½‘åŸŸåè®¿é—®éœ€è¦é…ç½®routeræ¨¡å—ä¸­çš„ngx proxyé…ç½®ï¼Œæ–°å¢ä¸€ä¸ªlocation /confdashboard è¿›è¡Œè·¯ç”±è·³è½¬ï¼›æˆ–è€…æŒ‡å®šipç«¯å£è®¿é—®è·¯å¾„ï¼›&lt;/p&gt;
&lt;p&gt;çº¿ä¸Šé€šè¿‡é€šè¿‡æœåŠ¡å‘ç°æ¨¡å—æ¥è·å–confdashboardæœåŠ¡å•å…ƒipåˆ—è¡¨è´Ÿè½½å‡è¡¡è¿›è¡Œè®¿é—®ï¼›å¯ä»¥å¤šæœºæˆ¿éƒ¨ç½²ï¼Œæ ¹æ®ä¸šåŠ¡æœåŠ¡éƒ¨ç½²åœºæ™¯å®šï¼›&lt;/p&gt;
&lt;h4 id=&#34;conf-dashboard-æ¥å£&#34;&gt;conf-dashboard æ¥å£&lt;/h4&gt;
&lt;p&gt;æä¾›ç»™åå°å‰ç«¯çš„CRUDæ¥å£ä¸åœ¨è¿™é‡Œæè¿°ï¼Œé€šè¿‡&lt;a href=&#34;https://github.com/smallnest/gen&#34;&gt;smallnest/gen&lt;/a&gt;ç”ŸæˆRESTfulæ¥å£æä¾›ç»™å‰ç«¯ä½¿ç”¨å°±è¡Œï¼Œä¿®æ”¹æ“ä½œï¼Œæ ¹æ®ä¸åŒçš„conf_typeåŠ è½½ä¸åŒçš„json_schemaè¿›è¡Œæ ¡éªŒï¼Œä»¥åŠå®¡æ ¸ï¼Œå‘å¸ƒæ¥å£ï¼›ä¸»è¦æ˜¯æä¾›ç»™ä¸šåŠ¡æœåŠ¡è°ƒç”¨çš„æ¥å£å®ç°ï¼Œå¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;è¯·æ±‚è°ƒç”¨æ–¹å¼ï¼šhttp1.1 POST æˆ–è€… GRPC&lt;/p&gt;
&lt;p&gt;å…¬å…±è¿”å›å‚æ•°ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;å­—æ®µ&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;ç±»å‹&lt;/th&gt;
&lt;th style=&#34;text-align:left&#34;&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;errNo&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;int&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;é”™è¯¯å·ï¼Œé»˜è®¤ä¸º0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;errStr&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;string&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;é”™è¯¯æè¿°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;data&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;json&lt;/td&gt;
&lt;td style=&#34;text-align:left&#34;&gt;è¿”å›å“åº”æ•°æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è·å–å½“å‰æœåŠ¡é…ç½®æ–‡ä»¶ç‰ˆæœ¬   /confdashboard/v1/getcurversion&lt;/p&gt;
&lt;p&gt;è¯·æ±‚ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;å‚æ•°æ˜¯å¦å¿…é¡»&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;serviceType&lt;/td&gt;
&lt;td&gt;å¿…é¡»&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;æœåŠ¡ç±»å‹:0.æ—  1.liveme 2.livestation&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å“åº”ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;curVer&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;å½“å‰ç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;maxVer&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;æœ€å¤§ç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è·å–å½“å‰æœåŠ¡æ–‡ä»¶é…ç½®å†…å®¹   /confdashboard/v1/getcurserverconf&lt;/p&gt;
&lt;p&gt;(æœåŠ¡ç²’åº¦æ•´ä½“ç‰ˆæœ¬æ–‡ä»¶ä¸€æ¬¡æ‹‰å–ä¸‹æ¥ï¼Œè¿™é‡Œæ˜¯æ¥å£å½¢å¼ç»™å‡ºå¯¹åº”é…ç½®æ•°æ®ï¼Œå…œåº•å®šæ—¶è½®è®­è·å–ï¼‰&lt;/p&gt;
&lt;p&gt;è¯·æ±‚ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:left&#34;&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;å‚æ•°æ˜¯å¦å¿…é¡»&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;serviceType&lt;/td&gt;
&lt;td&gt;å¿…é¡»&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;æœåŠ¡ç±»å‹:0.æ—  1.liveme 2.livestation&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;confName&lt;/td&gt;
&lt;td&gt;å¯é€‰&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;æœåŠ¡æœ¬åœ°é…ç½®æ–‡ä»¶åç§°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:left&#34;&gt;confTargetPath&lt;/td&gt;
&lt;td&gt;å¯é€‰&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;æœåŠ¡æœ¬åœ°é…ç½®è·¯å¾„&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å“åº”dataï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;downloadUrl&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;æœåŠ¡é…ç½®æ•´ä½“æ‰“åŒ…åœ°å€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;confData&lt;/td&gt;
&lt;td&gt;map&lt;!-- raw HTML omitted --&gt;confData&lt;!-- raw HTML omitted --&gt;(map&amp;lt;{confTargetPath}/{confName}&amp;gt;{confData})&lt;/td&gt;
&lt;td&gt;æœåŠ¡é…ç½®åˆ—è¡¨&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;confData&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;version&lt;/td&gt;
&lt;td&gt;int64&lt;/td&gt;
&lt;td&gt;æ–‡ä»¶å½“å‰ç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;data&lt;/td&gt;
&lt;td&gt;[]byte&lt;/td&gt;
&lt;td&gt;æ–‡ä»¶å½“å‰ç‰ˆæœ¬å†…å®¹&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸šåŠ¡æœåŠ¡é…ç½®æ›´æ–°ç»“æœæŠ¥å‘Š /confdashboard/v1/reportBizServConf&lt;/p&gt;
&lt;p&gt;è¯·æ±‚ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;å‚æ•°æ˜¯å¦å¿…é¡»&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;serviceType&lt;/td&gt;
&lt;td&gt;å¿…é¡»&lt;/td&gt;
&lt;td&gt;tinyint&lt;/td&gt;
&lt;td&gt;æœåŠ¡ç±»å‹:0.æ—  1.liveme 2.livestation&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;reportInfos&lt;/td&gt;
&lt;td&gt;å¿…é¡»&lt;/td&gt;
&lt;td&gt;map&lt;!-- raw HTML omitted --&gt;reportInfo&lt;/td&gt;
&lt;td&gt;ä¸šåŠ¡æœåŠ¡é…ç½®æ›´æ–°ç»“æœæŠ¥å‘Šåˆ—è¡¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;clusterName&lt;/td&gt;
&lt;td&gt;å¿…é¡»&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;é›†ç¾¤åç§°&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;reportInfo&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;version&lt;/td&gt;
&lt;td&gt;int64&lt;/td&gt;
&lt;td&gt;ç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;confFilePath&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;ä¸šåŠ¡é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆç»å¯¹è·¯å¾„ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;md5sum&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;æ–‡ä»¶MD5å€¼&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;confUpdateTime&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;ä¸šåŠ¡é…ç½®æ–‡ä»¶æ›´æ–°æ—¶é—´&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;updateResultCode&lt;/td&gt;
&lt;td&gt;int&lt;/td&gt;
&lt;td&gt;0, æ›´æ–°æˆåŠŸï¼Œ1ï¼Œæ›´æ–°å¤±è´¥&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;updateErrStr&lt;/td&gt;
&lt;td&gt;string&lt;/td&gt;
&lt;td&gt;æ›´æ–°å¤±è´¥åŸå› &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;å“åº”dataï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å­—æ®µ&lt;/th&gt;
&lt;th&gt;ç±»å‹&lt;/th&gt;
&lt;th&gt;æè¿°&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;conf-agentlib-ä¸šåŠ¡æœåŠ¡æ¥å£&#34;&gt;conf-agent/lib ä¸šåŠ¡æœåŠ¡æ¥å£&lt;/h4&gt;
&lt;p&gt;é€šè¿‡åœ¨ä¸šåŠ¡æœåŠ¡æœºéƒ¨ç½²agent, æˆ–è€…ä½¿ç”¨libåº“å°è£…å‡½æ•°çš„æ–¹å¼ï¼Œæœ€ç»ˆéƒ½æ˜¯éœ€è¦æä¾›è·å–é…ç½®çš„æœåŠ¡æä¾›å¯¹åº”çš„æ¥å£ï¼Œæ¥ä¿è¯æ•´ä½“æœåŠ¡é…ç½®çš„ä¸€è‡´æ€§ï¼Œè¿™é‡Œé‡‡ç”¨libåº“å°è£…å‡½æ•°æä¾›ç»™ä¸šåŠ¡æœåŠ¡å¯åŠ¨æ—¶è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„æ–¹å¼ï¼Œæ˜¯å¦å¯åŠ¨å•ç‹¬å¯åŠ¨ç«¯å£æ˜¯å¯é€‰çš„ï¼Œå¦‚æœæ˜¯åœ¨ä¸šåŠ¡æœåŠ¡ä¸­å¯åŠ¨ï¼Œå°±ç”¨ä¸šåŠ¡æœåŠ¡çš„ç«¯å£ï¼Œå¦‚æœæ˜¯å•ç‹¬agentæ–¹å¼å¯åŠ¨ï¼Œä½¿ç”¨å•ç‹¬çš„ç«¯å£ï¼›æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è·å–é…ç½®å¼€å§‹å‡†å¤‡æ›¿æ¢å·¥ä½œ prepareæ¥å£ /{serviceType}/localconf/prepare&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æäº¤æœ¬åœ°æ›¿æ¢å·¥ä½œ commitæ¥å£ /{serviceType}/localconf/commit&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è·å–æœ¬åœ°é…ç½®æ–‡ä»¶å…ƒæ•°æ®ï¼Œæ¯”å¦‚md5,è·¯å¾„,ç‰ˆæœ¬ç­‰ï¼Œmetaæ¥å£ /{serviceType}/localconf/meta&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;æ–½å·¥&#34;&gt;æ–½å·¥&lt;/h3&gt;
&lt;p&gt;å¯ä»¥è¿›è¡Œæ¨¡å—åˆ’åˆ†ï¼ŒæŒ‰äººåŠ›è¿›è¡Œåˆ†å·¥ï¼Œå¯ä»¥ç”¨Projectæˆ–è€…trelloè¿™äº›å·¥å…·æ¥ç®¡ç†æ•´ä¸ªé¡¹ç›®éœ€æ±‚ï¼Œå¼€å‘ï¼Œæµ‹è¯•ï¼Œä¸Šçº¿å‘¨æœŸï¼›ä¹Ÿå¯ä»¥å†…éƒ¨æ•´åˆjira å’Œ wiki ç­‰å¹³å°å·¥å…·è¿›è¡Œç®¡ç†;&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæœ‰ç‚¹åƒå»ºç­‘æ–½å·¥é˜Ÿï¼Œæœ‰äº†è®¾è®¡ç¨¿ï¼Œæ¨æ¼”å‡ éï¼Œæ»¡è¶³æ•´ä½“éœ€æ±‚å’Œç›®æ ‡ï¼›å‰©ä¸‹çš„æ˜¯å»å®æ–½äº†ï¼Œå®æ–½çš„è¯éœ€è¦ï¼Œæ•´ä½“ç³»ç»Ÿæ¶æ„è®¾è®¡çš„å»ºç­‘å·¥ç¨‹å¸ˆğŸ‘·ï¼Œæ‡‚è¿™è¡Œå·¥å…·çš„ä¸“å·¥ğŸ‘·ï¼Œä»¥åŠé¢†é˜ŸåŒ…å·¥å¤´ğŸ‘·ï¼Œå¤§é¡¹ç›®å¯èƒ½è¿˜æœ‰é¡¹ç›®ç›‘å·¥ğŸ‘·â€â™€ï¸ï¼Œç›‘æ§è¿›åº¦ï¼Œä»¥åŠäº¤äº’åçš„è´¨é‡æŠŠæ§å·¥ç¨‹å¸ˆğŸ‘·ï¼›ä¸€èµ·é…åˆæŠŠäº‹å¹²å¥½ï¼Œè®©ç”¨æˆ·å’Œè€æ¿æ»¡æ„ã€‚&lt;/p&gt;
&lt;h3 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h3&gt;
&lt;p&gt;å‰æœŸä¸šåŠ¡ä¸ºäº†æ»¡è¶³å¿«é€Ÿä¸šåŠ¡è¿­ä»£ï¼Œä¸šåŠ¡åŠ¨æ€é…ç½®å¯èƒ½éƒ½æ˜¯éšç€ä¸šåŠ¡æœåŠ¡ä¸€èµ·ä¸Šçº¿ï¼Œæˆ–è€…é€šè¿‡å•ç‹¬çš„ä»£ç åº“è¿›è¡Œç®¡ç†åˆ†å¼€å•ç‹¬ä¸Šçº¿ï¼›è¿™ä¸ªå¯èƒ½ä¼šå› ä¸ºä»£ç ä¸Šçº¿äº†ï¼Œä½†æ˜¯é…ç½®å¿˜è®°ä¸Šçº¿çš„æƒ…å†µï¼›æˆ–è€…åªéœ€è¦ä¿®æ”¹é…ç½®ä¸Šçº¿ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ä»£ç ï¼Œä¹Ÿéœ€è¦å•ç‹¬éƒ¨ç½²ä¸€æ¬¡ä¸šåŠ¡æœåŠ¡ï¼Œå¦‚æœæ¶‰åŠå¤šä¸ªæœåŠ¡æ¨¡å—ï¼Œä¸èƒ½åŠæ—¶å“åº”äº†ï¼Œä¸å¤ŸKISSï¼›ä¸ºäº†æ»¡è¶³ä¸šåŠ¡é›†ç¾¤é…ç½®åŒ–ç®¡ç†ï¼Œé…ç½®å¹³å°éœ€è¦ç®¡ç†ä¸šåŠ¡åŠ¨æ€é…ç½®æ¥æé«˜äººæ•ˆï¼Œä¿è¯ä¸šåŠ¡é›†ç¾¤ä¸Šçº¿é…ç½®çš„æ•´ä½“ä¸€è‡´ï¼Œé€šè¿‡åå°é¡µé¢æ¥ç®¡ç†é…ç½®å’Œå†å²é…ç½®ï¼Œè¿½è¸ªé…ç½®çš„ä¿®æ”¹æƒ…å†µï¼›éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¬¬ä¸€æ¬¡ä¸Šçº¿çš„é…ç½®ï¼Œå¯ä»¥å…ˆåœ¨æµ‹è¯•ç¯å¢ƒé…ç½®å¹³å°ä¸Šé…ç½®å¥½ï¼Œæµ‹è¯•å¥½ä¹‹åï¼Œåœ¨åˆ°çº¿ä¸Šå¹³å°é…ç½®å‘å¸ƒä¸Šçº¿ï¼Œç„¶ååœ¨éƒ¨ç½²ä¸šåŠ¡æœåŠ¡ä»£ç ï¼›å‘å¸ƒé…ç½®ä¹Ÿéœ€è¦åœ¨çº¿ä¸Šæœªæ¥å…¥æµé‡çš„æœºå™¨ä¸Šï¼Œæµ‹è¯•ä¹‹åæ‰èƒ½ä¸Šã€‚&lt;/p&gt;
&lt;h3 id=&#34;qa&#34;&gt;Q&amp;amp;A&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨etcdæ¥ç®¡ç†é…ç½®å‘¢ï¼Ÿå»æ‰mysql, é…ç½®ç›´æ¥å­˜etcdä¸è¡Œä¹ˆï¼Ÿ&lt;/p&gt;
&lt;p&gt;ä¸»è¦æ˜¯å› ä¸ºmysqlç”¨æ¥æä¾›ç®¡ç†é…ç½®å®ä½“çš„å…³ç³»ï¼Œç”¨äºåå°é¡µé¢ä¿®æ”¹ä½¿ç”¨ï¼›å¦‚æœæ˜¯k8sä¸­çš„åœºæ™¯ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨etcdæ¥å­˜æ”¾(100Gä»¥ä¸‹çš„æ•°æ®, å¤§å‚å¤šæœºæˆ¿å¤§é›†ç¾¤ä¼šé­”æ”¹etcd)ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœä¸šåŠ¡æœåŠ¡éƒ¨ç½²åœ¨Podå®¹å™¨ä¸­, æ€ä¹ˆæ›´æ–°é…ç½®å‘¢ï¼Ÿ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;agenté€šè¿‡DaemonSetå®¹å™¨åŒ–éƒ¨ç½²,å•ç‹¬å‡çº§, agentä¸ä¸šåŠ¡Podä¹‹é—´é€šè¿‡å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡æ›´æ–°é…ç½®ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»¥SideCar Containeræ–¹å¼å°†agentä¸ä¸šåŠ¡Containeréƒ¨ç½²åœ¨åŒä¸€Podä¸­ï¼Œåˆ©ç”¨Podçš„å…±äº«IPCç‰¹æ€§åŠMemory Medium EmptyDir Volumeæ–¹å¼å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡æ›´æ–°é…ç½®ï¼Œéšä¸šåŠ¡å®¹å™¨åŒ–éƒ¨ç½²ä¸Šçº¿ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;agenté€šè¿‡&lt;a href=&#34;https://github.com/openkruise/kruise&#34;&gt;OpenKruise&lt;/a&gt; SidecarSetéƒ¨ç½²åœ¨SideCarå®¹å™¨ä¸­ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;references&#34;&gt;references&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/Qihoo360/QConf/wiki&#34;&gt;QConf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.apolloconfig.com/#/zh/design/apollo-design&#34;&gt;apollo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://icyfenix.cn/distribution/connect/service-discovery.html&#34;&gt;å‡¤å‡°æ¶æ„-service-discovery&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://time.geekbang.org/column/article/341060&#34;&gt;etcd-watch&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://redisbook.readthedocs.io/en/latest/feature/pubsub.html&#34;&gt;redis-pub/sub&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s?__biz=MzU4NzU0MDIzOQ==&amp;amp;mid=2247490475&amp;amp;idx=2&amp;amp;sn=83e79449b409c363239de1b37b96f8c8&#34;&gt;Service Mesh åœ¨è¶…å¤§è§„æ¨¡åœºæ™¯ä¸‹çš„è½åœ°æŒ‘æˆ˜&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
      
    </item>
    
    <item>
      <title>å…±äº«å†…å­˜ä¸å†…å­˜æ˜ å°„(mmap)ã€Œè½¬è½½çš„å“¦ã€</title>
      <link>https://weedge.github.io/%E8%BD%AC%E8%BD%BD/mmap/</link>
      <pubDate>Tue, 16 Nov 2021 11:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/%E8%BD%AC%E8%BD%BD/mmap/</guid>
      
        <description>&lt;h2 id=&#34;åºè¨€&#34;&gt;åºè¨€&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;from: &lt;a href=&#34;https://www.cnblogs.com/huangfuyuan/p/9476951.html&#34;&gt;https://www.cnblogs.com/huangfuyuan/p/9476951.html&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;é¦–å…ˆå…³äºå…±äº«å†…å­˜çš„é“¾æ¥ï¼š&lt;a href=&#34;http://blog.csdn.net/qq_26768741/article/details/56014845&#34;&gt;å…±äº«å†…å­˜&lt;/a&gt;ã€‚&lt;strong&gt;é‡Œé¢åŒ…å«äº†åˆ›å»ºå…±äº«å†…å­˜åŒºåŸŸçš„å‡½æ•°ï¼Œä»¥åŠä¸¤ä¸ªè¿›ç¨‹æ€ä¹ˆæŒ‚è½½å…±äº«å†…å­˜é€šä¿¡ï¼Œåˆ†ç¦»ã€é‡Šæ”¾å…±äº«å†…å­˜&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;å…±äº«å†…å­˜çš„å¥½å¤„å°±æ˜¯æ•ˆç‡é«˜ï¼Œä¸éœ€è¦å¤ªå¤šæ¬¡çš„è¿›è¡Œæ•°æ®çš„copyã€‚å¯ä»¥ç›´æ¥è¿›è¡Œè¯»å†™å†…å­˜ã€‚æ‰€ä»¥ï¼Œç›¸å¯¹æ¥è¯´åœ¨IPCè¿›ç¨‹é—´é€šä¿¡ä¸‰å¤§ä¸»é¢˜ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¿¡å·é‡ï¼Œå…±äº«å†…å­˜ï¼‰é‡Œé¢ï¼Œå…±äº«å†…å­˜è¦æ¯”æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨å¤šï¼Œè€Œä¸”æ¶ˆæ¯é˜Ÿåˆ—åªåœ¨æœ‰è¡€ç¼˜å…³ç³»çš„è¿›ç¨‹é—´é€šä¿¡ï¼›ä½†æ˜¯ï¼Œå…±äº«å†…å­˜ä¸ä¿è¯åŒæ­¥ï¼Œå¯ä»¥ä½¿ç”¨ä¿¡å·é‡æ¥ä¿è¯å…±äº«å†…å­˜åŒæ­¥ã€‚&lt;strong&gt;Linuxä¸­çš„ä¸¤ç§å…±äº«å†…å­˜&lt;/strong&gt;ã€‚ä¸€ç§æ˜¯æˆ‘ä»¬çš„IPCé€šä¿¡System Vç‰ˆæœ¬çš„å…±äº«å†…å­˜ï¼Œå¦å¤–çš„ä¸€ç§å°±æ˜¯æˆ‘ä»¬ä»Šå¤©æåˆ°çš„å­˜å‚¨æ˜ å°„I/Oï¼ˆmmapå‡½æ•°ï¼‰ï¼Œå½“ç„¶è¿˜æœ‰ä¸€ç§POSIXçš„å…±äº«å†…å­˜ï¼Œå®ƒæ˜¯åœ¨mmapåŸºç¡€ä¹‹ä¸Šæ„å»ºçš„ã€‚&lt;/p&gt;
&lt;h2 id=&#34;mmap&#34;&gt;mmap&lt;/h2&gt;
&lt;p&gt;mmap I/Oçš„æè¿°ç¬¦é—´æ¥è¯´æ˜å†…å­˜æ˜ å°„æ˜¯å¯¹æ–‡ä»¶æ“ä½œã€‚å¦å¤–ï¼Œmmapå¦å¤–å¯ä»¥åœ¨æ— äº²ç¼˜çš„è¿›ç¨‹ä¹‹é—´æä¾›å…±äº«å†…å­˜åŒºã€‚è¿™æ ·ï¼Œç±»ä¼¼çš„ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´å°±æ˜¯å¯ä»¥è¿›è¡Œäº†é€šä¿¡ã€‚&lt;/p&gt;
&lt;p&gt;Linuxæä¾›äº†å†…å­˜æ˜ å°„å‡½æ•°mmap, å®ƒæŠŠæ–‡ä»¶å†…å®¹æ˜ å°„åˆ°ä¸€æ®µå†…å­˜ä¸Š(å‡†ç¡®è¯´æ˜¯&lt;strong&gt;è™šæ‹Ÿå†…å­˜&lt;/strong&gt;ä¸Šï¼Œè¿è¡Œç€è¿›ç¨‹), &lt;strong&gt;é€šè¿‡å¯¹è¿™æ®µå†…å­˜çš„è¯»å–å’Œä¿®æ”¹, å®ç°å¯¹æ–‡ä»¶çš„è¯»å–å’Œä¿®æ”¹&lt;/strong&gt;ã€‚mmap()ç³»ç»Ÿè°ƒç”¨ä½¿å¾—è¿›ç¨‹ä¹‹é—´å¯ä»¥é€šè¿‡æ˜ å°„ä¸€ä¸ªæ™®é€šçš„æ–‡ä»¶å®ç°å…±äº«å†…å­˜ã€‚&lt;strong&gt;æ™®é€šæ–‡ä»¶æ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´åï¼Œè¿›ç¨‹å¯ä»¥åƒè®¿é—®å†…å­˜çš„æ–¹å¼å¯¹æ–‡ä»¶è¿›è¡Œè®¿é—®ï¼Œä¸éœ€è¦å…¶ä»–å†…æ ¸æ€çš„ç³»ç»Ÿè°ƒç”¨(read,write)å»æ“ä½œã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæ˜¯è®²è®¾å¤‡æˆ–è€…ç¡¬ç›˜å­˜å‚¨çš„ä¸€å—ç©ºé—´æ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œç„¶åæ“ä½œè¿™å—ç‰©ç†å†…å­˜å°±æ˜¯åœ¨æ“ä½œå®é™…çš„ç¡¬ç›˜ç©ºé—´ï¼Œä¸éœ€è¦ç»è¿‡å†…æ ¸æ€ä¼ é€’ã€‚æ¯”å¦‚ä½ çš„ç¡¬ç›˜ä¸Šæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨linuxç³»ç»Ÿæä¾›çš„mmapæ¥å£ï¼Œå°†è¿™ä¸ªæ–‡ä»¶æ˜ å°„åˆ°è¿›ç¨‹ä¸€å—è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè¿™å—ç©ºé—´ä¼šå¯¹åº”ä¸€å—ç‰©ç†å†…å­˜ï¼Œå½“ä½ è¯»å†™è¿™å—ç‰©ç†ç©ºé—´çš„æ—¶å€™ï¼Œå°±æ˜¯åœ¨è¯»å–å®é™…çš„ç£ç›˜æ–‡ä»¶ï¼Œå°±æ˜¯è¿™ä¹ˆç›´æ¥é«˜æ•ˆã€‚&lt;strong&gt;é€šå¸¸è¯¸å¦‚å…±äº«åº“çš„åŠ è½½éƒ½æ˜¯é€šè¿‡å†…å­˜æ˜ å°„çš„æ–¹å¼åŠ è½½åˆ°ç‰©ç†å†…å­˜çš„&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;mmapç³»ç»Ÿè°ƒç”¨å¹¶ä¸å®Œå…¨æ˜¯ä¸ºäº†å…±äº«å†…å­˜æ¥è®¾è®¡çš„ï¼Œå®ƒæœ¬èº«æä¾›äº†ä¸åŒäºä¸€èˆ¬å¯¹&lt;strong&gt;æ™®é€šæ–‡ä»¶&lt;/strong&gt;çš„è®¿é—®çš„æ–¹å¼ï¼Œè¿›ç¨‹å¯ä»¥åƒè¯»å†™å†…å­˜ä¸€æ ·å¯¹æ™®é€šæ–‡ä»¶è¿›è¡Œæ“ä½œï¼ˆæ— éœ€ç³»ç»Ÿè°ƒç”¨ï¼‰ï¼ŒIPCçš„å…±äº«å†…å­˜æ˜¯çº¯ç²¹ä¸ºäº†å…±äº«ã€‚&lt;/p&gt;
&lt;h3 id=&#34;mmapç³»ç»Ÿè°ƒç”¨ä»‹ç»&#34;&gt;mmapç³»ç»Ÿè°ƒç”¨ä»‹ç»&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;void *mmap(void *addr, size_t length, int prot, int flags, int fd, off_t offset);&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¿™å°±æ˜¯mmapç³»ç»Ÿè°ƒç”¨çš„æ¥å£ï¼Œmmapå‡½æ•°æˆåŠŸè¿”å›æŒ‡å‘å†…å­˜åŒºåŸŸçš„æŒ‡é’ˆï¼Œå¤±è´¥è¿”å›MAP_FAILEDã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;addrï¼ŒæŸä¸ªç‰¹å®šçš„åœ°å€ä½œä¸ºèµ·å§‹åœ°å€ï¼Œå½“è¢«è®¾ç½®ä¸ºNULLï¼Œæ ‡è¯†ç³»ç»Ÿè‡ªåŠ¨åˆ†é…åœ°å€ã€‚å®å®åœ¨åœ¨çš„ç‰©ç†åŒºåŸŸã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;lengthè¯´çš„æ˜¯å†…å­˜æ®µçš„é•¿åº¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;protæ˜¯ç”¨æ¥è®¾å®šå†…å­˜æ®µçš„è®¿é—®æƒé™ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;protå‚æ•°&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;PROT_READ&lt;/td&gt;
&lt;td&gt;å†…å­˜æ®µå¯è¯»&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PROT_WRITE&lt;/td&gt;
&lt;td&gt;å†…å­˜æ®µå¯å†™&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PROT_EXEC&lt;/td&gt;
&lt;td&gt;å†…å­˜æ®µå¯æ‰§è¡Œ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PROT_NONE&lt;/td&gt;
&lt;td&gt;å†…å­˜æ®µä¸èƒ½è¢«è®¿é—®&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;fdå‚æ•°æ˜¯ç”¨æ¥è¢«æ˜ å°„æ–‡ä»¶å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ã€‚é€šè¿‡openç³»ç»Ÿè°ƒç”¨å¾—åˆ°ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;flagså‚æ•°&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;MAP_SHARED&lt;/td&gt;
&lt;td&gt;è¿›ç¨‹é—´å…±äº«å†…å­˜ï¼Œå¯¹è¯¥å†…å­˜æ®µä¿®æ”¹åæ˜ åˆ°æ˜ å°„æ–‡ä»¶ä¸­ã€‚æä¾›äº†POSIXå…±äº«å†…å­˜&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MAP_PRIVATE&lt;/td&gt;
&lt;td&gt;å†…å­˜æ®µä¸ºè°ƒç”¨è¿›ç¨‹æ‰€ç§æœ‰ã€‚å¯¹è¯¥å†…å­˜æ®µçš„ä¿®æ”¹ä¸ä¼šåæ˜ åˆ°æ˜ å°„æ–‡ä»¶&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MAP_ANNOYMOUS&lt;/td&gt;
&lt;td&gt;è¿™æ®µå†…å­˜ä¸æ˜¯ä»æ–‡ä»¶æ˜ å°„è€Œæ¥çš„ã€‚å†…å®¹è¢«åˆå§‹åŒ–ä¸ºå…¨0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MAP_FIXED&lt;/td&gt;
&lt;td&gt;å†…å­˜æ®µå¿…é¡»ä½äºstartå‚æ•°æŒ‡å®šçš„åœ°å€å¤„ï¼Œstartå¿…é¡»æ˜¯é¡µå¤§å°çš„æ•´æ•°å€ï¼ˆ4Kæ•´æ•°å€ï¼‰&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MAP_HUGETLB&lt;/td&gt;
&lt;td&gt;æŒ‰ç…§å¤§å†…å­˜é¡µé¢æ¥åˆ†é…å†…å­˜ç©ºé—´&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;offsetè®¾å®šä»ä½•å¤„è¿›è¡Œæ˜ å°„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;mmapç”¨äºå…±äº«å†…å­˜çš„æ–¹å¼&#34;&gt;mmapç”¨äºå…±äº«å†…å­˜çš„æ–¹å¼&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ™®é€šæ–‡ä»¶è¿›è¡Œæä¾›å†…å­˜æ˜ å°„ï¼Œä¾‹å¦‚ï¼Œopenç³»ç»Ÿè°ƒç”¨æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åè¿›è¡Œmmapæ“ä½œï¼Œå¾—åˆ°å…±äº«å†…å­˜ï¼Œè¿™ç§æ–¹å¼é€‚ç”¨äºä»»ä½•è¿›ç¨‹ä¹‹é—´ã€‚&lt;/li&gt;
&lt;li&gt;ä»¥ä½¿ç”¨ç‰¹æ®Šæ–‡ä»¶è¿›è¡ŒåŒ¿åå†…å­˜æ˜ å°„ï¼Œè¿™ä¸ªç›¸å¯¹çš„æ˜¯å…·æœ‰è¡€ç¼˜å…³ç³»çš„è¿›ç¨‹ä¹‹é—´ï¼Œå½“çˆ¶è¿›ç¨‹è°ƒç”¨mmapï¼Œç„¶åè¿›è¡Œforkï¼Œè¿™æ ·çˆ¶è¿›ç¨‹åˆ›å»ºçš„å­è¿›ç¨‹ä¼šç»§æ‰¿çˆ¶è¿›ç¨‹åŒ¿åæ˜ å°„åçš„åœ°å€ç©ºé—´ï¼Œè¿™æ ·ï¼Œçˆ¶å­è¿›ç¨‹ä¹‹é—´å°±å¯ä»¥è¿›è¡Œé€šä¿¡äº†ã€‚ç›¸å½“äºæ˜¯mmapçš„è¿”å›åœ°å€æ­¤æ—¶æ˜¯çˆ¶å­è¿›ç¨‹åŒæ—¶æ¥ç»´æŠ¤ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¦å¤–&lt;a href=&#34;https://www.cnblogs.com/LubinLew/p/POSIX-shared_memory.html&#34;&gt;POSIXç‰ˆæœ¬çš„å…±äº«å†…å­˜&lt;/a&gt;åº•å±‚ä¹Ÿæ˜¯ä½¿ç”¨äº†mmapã€‚æ‰€ä»¥ï¼Œå…±äº«å†…å­˜åœ¨åœ¨posixä¸Šä¸€å®šç¨‹åº¦ä¸Šå°±æ˜¯æŒ‡çš„å†…å­˜æ˜ å°„äº†&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;mmapå’Œsystem-vå…±äº«å†…å­˜çš„æ¯”è¾ƒ&#34;&gt;mmapå’ŒSystem Vå…±äº«å†…å­˜çš„æ¯”è¾ƒ&lt;/h2&gt;
&lt;h3 id=&#34;system-vç‰ˆæœ¬çš„å…±äº«å†…å­˜ä»¥ä¸‹æˆ‘ä»¬ç»Ÿç§°ä¸ºshm&#34;&gt;System Vç‰ˆæœ¬çš„å…±äº«å†…å­˜ï¼ˆä»¥ä¸‹æˆ‘ä»¬ç»Ÿç§°ä¸ºshmï¼‰&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://gitee.com/lienhui68/picStore/raw/master/null/20200917180539.png&#34; alt=&#34;https://gitee.com/lienhui68/picStore/raw/master/null/20200917180539.png&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;mmapç‰ˆæœ¬çš„å…±äº«å†…å­˜&#34;&gt;mmapç‰ˆæœ¬çš„å…±äº«å†…å­˜&lt;/h3&gt;
&lt;p&gt;&lt;img src=&#34;https://gitee.com/lienhui68/picStore/raw/master/null/20200917180729.png&#34; alt=&#34;https://gitee.com/lienhui68/picStore/raw/master/null/20200917180729.png&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;mmapæ˜¯åœ¨ç£ç›˜ä¸Š&lt;strong&gt;å»ºç«‹ä¸€ä¸ªæ–‡ä»¶&lt;/strong&gt;ï¼Œæ¯ä¸ªè¿›ç¨‹åœ°å€ç©ºé—´ä¸­å¼€è¾Ÿå‡ºä¸€å—ç©ºé—´è¿›è¡Œæ˜ å°„ã€‚è€Œshmå…±äº«å†…å­˜ï¼Œæ¯ä¸ªè¿›ç¨‹æœ€ç»ˆä¼š&lt;strong&gt;æ˜ å°„åˆ°åŒä¸€å—ç‰©ç†å†…å­˜&lt;/strong&gt;ã€‚shmä¿å­˜åœ¨ç‰©ç†å†…å­˜ï¼Œè¿™æ ·è¯»å†™çš„é€Ÿåº¦è‚¯å®šè¦æ¯”ç£ç›˜è¦å¿«ï¼Œä½†æ˜¯å­˜å‚¨é‡ä¸æ˜¯ç‰¹åˆ«å¤§ã€‚&lt;/li&gt;
&lt;li&gt;ç›¸å¯¹äºshmæ¥è¯´ï¼Œmmapæ›´åŠ ç®€å•ï¼Œè°ƒç”¨æ›´åŠ æ–¹ä¾¿ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯å¤§å®¶éƒ½å–œæ¬¢ç”¨çš„åŸå› ã€‚&lt;/li&gt;
&lt;li&gt;å¦å¤–mmapæœ‰ä¸€ä¸ªå¥½å¤„æ˜¯å½“æœºå™¨é‡å¯ï¼Œå› ä¸ºmmapæŠŠæ–‡ä»¶ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œè¿™ä¸ªæ–‡ä»¶è¿˜ä¿å­˜äº†æ“ä½œç³»ç»ŸåŒæ­¥çš„æ˜ åƒï¼Œæ‰€ä»¥mmapä¸ä¼šä¸¢å¤±ï¼Œä½†æ˜¯shmgetåœ¨å†…å­˜é‡Œé¢å°±ä¼šä¸¢å¤±ã€‚&lt;/li&gt;
&lt;li&gt;æ€»ä¹‹ï¼Œshmæ˜¯åœ¨å†…å­˜ä¸­åˆ›å»ºç©ºé—´ï¼Œæ¯ä¸ªè¿›ç¨‹æ˜ å°„åˆ°æ­¤å¤„ã€‚å†…å­˜æ˜ å°„æ˜¯åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æ˜ å°„åˆ°æ¯ä¸ªè¿›ç¨‹å¼€è¾Ÿçš„ç©ºé—´ä¸­ã€‚&lt;/li&gt;
&lt;/ol&gt;</description>
      
    </item>
    
    <item>
      <title>å·¥å…·ç›’å­-ping/traceroute</title>
      <link>https://weedge.github.io/post/ping/</link>
      <pubDate>Mon, 15 Nov 2021 14:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/ping/</guid>
      
        <description>&lt;h2 id=&#34;åºè¨€&#34;&gt;åºè¨€&lt;/h2&gt;
&lt;p&gt;åœ¨è®¿é—®ç½‘ç»œæ˜¯å¦ok, é€šå¸¸å–œæ¬¢ç”¨ping å‘½ä»¤æ¥è®¿é—®&lt;code&gt;ping www.baidu.com&lt;/code&gt; çœ‹æ˜¯å¦å‡ºç°è¶…æ—¶ï¼›pingåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿå¹³å°å®ç°æ–¹å¼å·®ä¸å¤šï¼Œåº•å±‚éƒ½æ˜¯ç”¨ICMPåè®®ï¼Œæ¯æ¬¡å‘ICMP ECHO_REQUEST packet (IPåœ°å€/Host, ttlï¼Œicmp_seqåºåˆ—å·ï¼Œ&lt;a href=&#34;https://en.wikipedia.org/wiki/Round-trip_delay&#34;&gt;RTD/RTT&lt;/a&gt;(å¾€è¿”å»¶æ—¶)è®°å½• ),  è¿è¡Œç»“æŸåç»Ÿè®¡æ¯ä¸ªRTT, æœ€å¤§RTT, æœ€å°RTT, å¹³å‡RTT, &lt;a href=&#34;https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance#Welford&#34;&gt;æ ‡å‡†åå·®&lt;/a&gt;RTT, å‘é€/æ¥å—packetsæ€»æ•°ï¼Œä¸¢åŒ…ç‡ ç­‰æ•°æ®ï¼Œpingå·¥å…·åœ¨PING(8)ä¸­çš„å®šä¹‰å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The ping utility uses the ICMP protocol&amp;rsquo;s mandatory ECHO_REQUEST datagram to elicit an ICMP ECHO_RESPONSE from a host or gateway.  ECHO_REQUEST datagrams  (&amp;ldquo;pings&#39;&#39;) have an IP and ICMP header, followed by a &amp;ldquo;struct timeval&#39;&#39; and then an arbitrary number of &amp;ldquo;pad&amp;rdquo; bytes used to fill out the packet.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;icmphttpsenwikipediaorgwikiinternet_control_message_protocol&#34;&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol&#34;&gt;ICMP&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;äº’è”ç½‘æ§åˆ¶æ¶ˆæ¯åè®®&lt;/strong&gt;ï¼ˆè‹±è¯­ï¼š&lt;strong&gt;I&lt;/strong&gt;nternet &lt;strong&gt;C&lt;/strong&gt;ontrol &lt;strong&gt;M&lt;/strong&gt;essage &lt;strong&gt;P&lt;/strong&gt;rotocolï¼Œç¼©å†™ï¼š&lt;strong&gt;ICMP&lt;/strong&gt;ï¼‰æ˜¯&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E4%BA%92%E8%81%94%E7%BD%91&#34;&gt;äº’è”ç½‘&lt;/a&gt;åè®®æ—çš„æ ¸å¿ƒåè®®ä¹‹ä¸€ã€‚å®ƒç”¨äº&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E7%BD%91%E9%99%85%E5%8D%8F%E8%AE%AE&#34;&gt;ç½‘é™…åè®®&lt;/a&gt;ï¼ˆIPï¼‰ä¸­å‘é€æ§åˆ¶æ¶ˆæ¯ï¼Œæä¾›å¯èƒ½å‘ç”Ÿåœ¨é€šä¿¡ç¯å¢ƒä¸­çš„å„ç§é—®é¢˜åé¦ˆã€‚é€šè¿‡è¿™äº›ä¿¡æ¯ï¼Œä½¿ç®¡ç†è€…å¯ä»¥å¯¹æ‰€å‘ç”Ÿçš„é—®é¢˜ä½œå‡ºè¯Šæ–­ï¼Œç„¶åé‡‡å–é€‚å½“çš„æªæ–½è§£å†³ï¼›ä½¿ç”¨åœ¨ç½‘ç»œè®¾å¤‡ä¸Šï¼Œæ¯”å¦‚äº¤æ¢æœºï¼Œè·¯ç”±å™¨&lt;/p&gt;
&lt;h3 id=&#34;ä¸ºæ¯›icmpè®¾è®¡åœ¨ç½‘ç»œå±‚å‘¢&#34;&gt;ä¸ºæ¯›ICMPè®¾è®¡åœ¨ç½‘ç»œå±‚å‘¢ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;å› ä¸ºéœ€è¦ç›®çš„åœ°å€ip, é“¾è·¯å±‚æ— æ³•é€šè¿‡ip socketç¼–ç¨‹ï¼Œé‚£ä¸ºå•¥ä¸ç”¨é“¾è·¯å±‚çš„MACåœ°å€å‘¢ï¼Ÿå› ä¸ºé“¾è·¯å±‚çš„MACåœ°å€åªåœ¨å±€åŸŸç½‘å”¯ä¸€ï¼Œç”±äº¤æ¢æœºå­¦ä¹ ç¼“å­˜ç­–ç•¥å†³å®š(ä¼šç¼“å­˜MACåœ°å€ï¼Œç”¨äºè·³è½¬)ï¼Œå¦‚æœå¹¿åŸŸç½‘è®¿é—®ä¸åŒå±€åŸŸç½‘ï¼ŒMACåœ°å€å¯ä»¥ä¸å”¯ä¸€(ç½‘ç»œå†å²æ¼”å˜åŸå› )ï¼Œä½†æ˜¯å…¬ç½‘IPåœ°å€æ˜¯å…¨å±€å”¯ä¸€ï¼Œç›¸äº’è½¬åŒ–é€šè¿‡NATè·¯ç”±å™¨(å…·ä½“ä»‹ç»çœ‹wiki: &lt;strong&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Network_address_translation&#34;&gt;Network address translation&lt;/a&gt;&lt;/strong&gt;)ï¼› å¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/lib/main/net/NAT.png&#34; alt=&#34;NAT&#34;&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœåœ¨ä¼ è¾“å±‚çš„è¯ï¼Œæ— éœ€ç«¯å£å¤šäº†ä¸€æ¬¡è§£åŒ…ï¼›ICMPä¸&lt;a href=&#34;https://en.wikipedia.org/wiki/Transmission_Control_Protocol&#34;&gt;TCP&lt;/a&gt;ã€&lt;a href=&#34;https://en.wikipedia.org/wiki/User_Datagram_Protocol&#34;&gt;UDP&lt;/a&gt;ç­‰&lt;a href=&#34;https://en.wikipedia.org/wiki/Transport_protocol&#34;&gt;ä¼ è¾“åè®®&lt;/a&gt;ä¸åŒå› ä¸ºå®ƒé€šå¸¸ä¸ç”¨äºåœ¨ç³»ç»Ÿä¹‹é—´äº¤æ¢æ•°æ®ï¼Œä¹Ÿä¸ç»å¸¸è¢«æœ€ç»ˆç”¨æˆ·ç½‘ç»œåº”ç”¨ç¨‹åºä½¿ç”¨ï¼ˆé™¤äº†ä¸€äº›è¯Šæ–­å·¥å…·ï¼Œå¦‚&lt;a href=&#34;https://en.wikipedia.org/wiki/Ping_(networking_utility)&#34;&gt;ping&lt;/a&gt;å’Œ&lt;a href=&#34;https://en.wikipedia.org/wiki/Traceroute&#34;&gt;traceroute&lt;/a&gt;ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;ICMP ä¾é ipæ¥å®Œæˆå®ƒçš„ä»»åŠ¡ï¼Œå®ƒæ˜¯ipçš„ä¸»è¦éƒ¨åˆ†ã€‚å®ƒä¸ä¼ è¾“åè®®ï¼ˆå¦‚&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E4%BC%A0%E8%BE%93%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AE&#34;&gt;TCP&lt;/a&gt;å’Œ&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%8D%8F%E8%AE%AE&#34;&gt;UDP&lt;/a&gt;ï¼‰æ˜¾è‘—ä¸åŒï¼šå®ƒä¸€èˆ¬ä¸ç”¨äºåœ¨ä¸¤ç‚¹é—´ä¼ è¾“æ•°æ®ã€‚å®ƒé€šå¸¸ä¸ç”±ç½‘ç»œç¨‹åºç›´æ¥ä½¿ç”¨ï¼Œé™¤äº† &lt;a href=&#34;https://zh.wikipedia.org/wiki/Ping&#34;&gt;ping&lt;/a&gt; å’Œ &lt;a href=&#34;https://zh.wikipedia.org/wiki/Traceroute&#34;&gt;traceroute&lt;/a&gt; è¿™ä¸¤ä¸ªç‰¹åˆ«çš„ä¾‹å­ã€‚ &lt;a href=&#34;https://zh.wikipedia.org/wiki/IPv4&#34;&gt;IPv4&lt;/a&gt;ä¸­çš„ICMPè¢«ç§°ä½œICMPv4ï¼Œ&lt;a href=&#34;https://zh.wikipedia.org/wiki/IPv6&#34;&gt;IPv6&lt;/a&gt;ä¸­çš„ICMPåˆ™è¢«ç§°ä½œ&lt;a href=&#34;https://zh.wikipedia.org/wiki/ICMPv6&#34;&gt;ICMPv6&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;pinghttpsenwikipediaorgwikiping_networking_utility&#34;&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Ping_(networking_utility)&#34;&gt;ping&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Ping (Packet Internet Grope)ï¼Œå› ç‰¹ç½‘åŒ…æ¢ç´¢å™¨ï¼Œç”¨äºæµ‹è¯•ç½‘ç»œè¿æ¥é‡çš„ç¨‹åºã€‚Pingå‘é€ä¸€ä¸ªICMPå›å£°è¯·æ±‚æ¶ˆæ¯ç»™ç›®çš„åœ°å¹¶æŠ¥å‘Šæ˜¯å¦æ”¶åˆ°æ‰€å¸Œæœ›çš„ICMPå›å£°åº”ç­”ï¼›å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/lib/main/net/ping-icmp.png&#34; alt=&#34;ping-icmp&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;TTL&lt;/strong&gt;ï¼š ç”Ÿå­˜æ—¶é—´ï¼ŒæŒ‡å®š&lt;!-- raw HTML omitted --&gt;æ•°æ®åŒ…è¢«è·¯ç”±å™¨ä¸¢å¼ƒä¹‹å‰å…è®¸é€šè¿‡çš„ç½‘æ®µæ•°é‡&lt;!-- raw HTML omitted --&gt;ï¼›&lt;!-- raw HTML omitted --&gt;&lt;strong&gt;TTL æ˜¯ç”±å‘é€ä¸»æœºè®¾ç½®çš„ï¼Œå½“å…¶å­˜æ´»æ¬¡æ•°ä¸º0æ—¶ï¼Œè·¯ç”±å™¨ä¾¿ä¼šå–æ¶ˆæ•°æ®åŒ…å¹¶å‘é€ä¸€ä¸ªICMP TTLæ•°æ®åŒ…ç»™åŸæ•°æ®åŒ…çš„å‘å‡ºè€…, ä»¥é˜²æ­¢æ•°æ®åŒ…ä¸æ–­åœ¨ ip äº’è”ç½‘ç»œä¸Šæ°¸ä¸ç»ˆæ­¢åœ°å¾ªç¯, è€Œæ— æ³•é€è¾¾åŠè€—å°½ç½‘ç»œèµ„æº&lt;/strong&gt;&lt;!-- raw HTML omitted --&gt;ã€‚è½¬å‘ ip æ•°æ®åŒ…æ—¶ï¼Œè¦æ±‚è·¯ç”±å™¨è‡³å°‘å°† TTL å‡å° 1ï¼›TTL å­—æ®µå€¼ä¸åŒæ“ä½œç³»ç»Ÿç±»å‹å¯¹åº”çš„å€¼ä¸åŒï¼Œå¯ä»¥é€šè¿‡&lt;code&gt;ping 127.0.0.1&lt;/code&gt; æœ¬åœ°æ¥æŸ¥çœ‹åˆå§‹å€¼,æˆ–è€…&lt;code&gt;sysctl -a |grep ttl &lt;/code&gt;æŸ¥çœ‹å¯¹åº”å€¼(macOS Darwinä¸‹æ˜¯net.inet.ip.ttl, linuxä¸‹æ˜¯net.ipv4.ip_default_ttl)ï¼›å¦‚æœä¸ä¿®æ”¹è¿™äº›å€¼ï¼Œlinuxç³»ç»Ÿä¸€èˆ¬æ˜¯64ï¼Œwindowç³»ç»Ÿä¸€èˆ¬æ˜¯128ã€‚&lt;/p&gt;
&lt;h2 id=&#34;traceroutehttpsenwikipediaorgwikitraceroute&#34;&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Traceroute&#34;&gt;traceroute&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;tracerouteæ˜¯unixç³»ç»Ÿä¸­ï¼Œè¯Šæ–­&lt;a href=&#34;https://en.wikipedia.org/wiki/Computer_network&#34;&gt;è®¡ç®—æœºç½‘ç»œ&lt;/a&gt;çš„å‘½ä»¤ç¨‹åº(windosä¸­å¯¹åº”tracertå‘½ä»¤)ï¼›ç”¨äºæ˜¾ç¤ºå¯èƒ½çš„è·¯çº¿ï¼ˆè·¯å¾„ï¼‰å’Œæµ‹é‡çš„ä¼ é€å»¶è¿Ÿã€‚è·¯ç”±çš„å†å²è®°å½•ä¸ºä»è·¯ç”±ï¼ˆè·¯å¾„ï¼‰ä¸­æ¯ä¸ªè¿ç»­ä¸»æœºï¼ˆè¿œç¨‹èŠ‚ç‚¹ï¼‰æ¥æ”¶åˆ°çš„æ•°æ®åŒ…çš„å¾€è¿”æ¬¡æ•°ï¼›æ¯&lt;a href=&#34;https://en.wikipedia.org/wiki/Hop_(networking)&#34;&gt;è·³&lt;/a&gt;å¹³å‡æ—¶é—´çš„æ€»å’Œæ˜¯å»ºç«‹è¿æ¥æ‰€èŠ±è´¹çš„æ€»æ—¶é—´çš„åº¦é‡ï¼›å¦‚æœæ‰€æœ‰ï¼ˆé€šå¸¸æ˜¯ä¸‰ä¸ªï¼‰å‘é€çš„æ•°æ®åŒ…ä¸¢å¤±ä¸¤æ¬¡ä»¥ä¸Šï¼Œè¿æ¥å°±ä¼šä¸¢å¤±å¹¶ä¸”æ— æ³•è¯„ä¼°è·¯ç”±ï¼Œå¦åˆ™ Traceroute ä¼šç»§ç»­ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»å«æ–¹é¦–å…ˆå‘å‡º TTL=1 çš„æ•°æ®åŒ…ï¼Œç¬¬ä¸€ä¸ªè·¯ç”±å™¨å°† TTL å‡1å¾—0åå°±ä¸å†ç»§ç»­è½¬å‘æ­¤æ•°æ®åŒ…ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ª ICMP è¶…æ—¶æŠ¥æ–‡ï¼Œä¸»å«æ–¹ä»è¶…æ—¶æŠ¥æ–‡ä¸­å³å¯æå–å‡ºæ•°æ®åŒ…æ‰€ç»è¿‡çš„ç¬¬ä¸€ä¸ªç½‘å…³åœ°å€ã€‚ç„¶ååˆå‘å‡ºä¸€ä¸ª TTL=2 çš„ ICMP æ•°æ®åŒ…ï¼Œå¯è·å¾—ç¬¬äºŒä¸ªç½‘å…³åœ°å€ï¼Œä¾æ¬¡é€’å¢ TTL ä¾¿è·å–äº†æ²¿é€”æ‰€æœ‰ç½‘å…³åœ°å€ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰ç½‘å…³éƒ½ä¼šå¦‚å®è¿”å› ICMP è¶…æ—¶æŠ¥æ–‡ã€‚å‡ºäºå®‰å…¨æ€§è€ƒè™‘ï¼Œå¤§å¤šæ•°é˜²ç«å¢™ä»¥åŠå¯ç”¨äº†é˜²ç«å¢™åŠŸèƒ½çš„è·¯ç”±å™¨ç¼ºçœé…ç½®ä¸ºä¸è¿”å›å„ç§ ICMP æŠ¥æ–‡ï¼Œå…¶ä½™è·¯ç”±å™¨æˆ–&lt;a href=&#34;https://zh.wikipedia.org/wiki/%E4%BA%A4%E6%8D%A2%E6%9C%BA&#34;&gt;äº¤æ¢æœº&lt;/a&gt;ä¹Ÿå¯è¢«ç®¡ç†å‘˜ä¸»åŠ¨ä¿®æ”¹é…ç½®å˜ä¸ºä¸è¿”å› ICMP æŠ¥æ–‡ã€‚å› æ­¤ Traceroute ç¨‹åºä¸ä¸€å®šèƒ½æ‹¿å…¨æ‰€æœ‰çš„æ²¿é€”ç½‘å…³åœ°å€ã€‚æ‰€ä»¥ï¼Œå½“æŸä¸ª TTL å€¼çš„æ•°æ®åŒ…å¾—ä¸åˆ°å“åº”æ—¶ï¼Œå¹¶ä¸èƒ½åœæ­¢è¿™ä¸€è¿½è¸ªè¿‡ç¨‹ï¼Œç¨‹åºä»ç„¶ä¼šæŠŠ TTL é€’å¢è€Œå‘å‡ºä¸‹ä¸€ä¸ªæ•°æ®åŒ…ã€‚ä¸€ç›´è¾¾åˆ°é»˜è®¤æˆ–ç”¨å‚æ•°æŒ‡å®šçš„è¿½è¸ªé™åˆ¶ï¼ˆmaximum_hopsï¼‰æ‰ç»“æŸè¿½è¸ªï¼ˆæ²¡æœ‰åˆ°è¾¾ç›®æ ‡ip, æ‰€ä»¥æ”¶ä¸åˆ°ç›®æ ‡ipçš„ICMPæŠ¥æ–‡ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;è€Œpingå·¥å…·åªè®¡ç®—ä»ç›®çš„åœ°ç‚¹çš„æœ€ç»ˆå¾€è¿”æ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;å½“ç„¶ping/tracerouteï¼Œä¸ä¸€å®šç”¨ç½‘ç»œå±‚çš„ICMPåè®®æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥ç”¨ä¼ è¾“å±‚çš„&lt;a href=&#34;https://en.wikipedia.org/wiki/User_Datagram_Protocol&#34;&gt;UDPåè®®&lt;/a&gt;æ¥å®ç°(å‘é€udpåè®®æŠ¥æ–‡),é»˜è®¤ä¸»ç›®çš„ä¸»æœºç«¯å£æ˜¯33434å¼€å§‹)ï¼Œè¿™ä¸ªç«¯å£æ˜¯æœ‰è®²ç©¶çš„ï¼›åˆ©ç”¨äº† UDP æ•°æ®åŒ…çš„ traceroute ç¨‹åºåœ¨æ•°æ®åŒ…åˆ°è¾¾çœŸæ­£çš„ç›®çš„ä¸»æœºæ—¶ï¼Œå°±å¯èƒ½å› ä¸ºè¯¥ä¸»æœºæ²¡æœ‰æä¾› &lt;a href=&#34;https://zh.wikipedia.org/wiki/%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%8D%8F%E8%AE%AE&#34;&gt;UDP&lt;/a&gt; æœåŠ¡è€Œç®€å•å°†æ•°æ®åŒ…æŠ›å¼ƒï¼Œå¹¶ä¸è¿”å›ä»»ä½•ä¿¡æ¯ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œtraceroute æ•…æ„ä½¿ç”¨äº†ä¸€ä¸ªå¤§äº 30000 çš„ç«¯å£å·(å›  UDP åè®®è§„å®šç«¯å£å·å¿…é¡»å°äº 30000)ï¼Œæ‰€ä»¥ç›®æ ‡ä¸»æœºæ”¶åˆ°æ•°æ®åŒ…åå”¯ä¸€èƒ½åšçš„äº‹å°±æ˜¯è¿”å›ä¸€ä¸ªâ€œç«¯å£ä¸å¯è¾¾(ICMP PORT_UNREACHABLE)â€çš„ ICMP æŠ¥æ–‡ï¼Œäºæ˜¯ä¸»å«æ–¹å°±å°†ç«¯å£ä¸å¯è¾¾æŠ¥æ–‡å½“ä½œè·Ÿè¸ªç»“æŸçš„æ ‡å¿—ã€‚&lt;/p&gt;
&lt;p&gt;ç”šè‡³tracerouteè¿˜ç”¨&lt;a href=&#34;https://en.wikipedia.org/wiki/Transmission_Control_Protocol&#34;&gt;TCPåè®®&lt;/a&gt;æ¥å®ç°(å‘é€tcpåè®®æŠ¥æ–‡)ï¼Œè¿™ä¸ªéœ€è¦çœ‹åœºæ™¯ä¸‹ï¼Œéœ€è¦è·å–çš„æµ‹è¯•ç›‘æ§æ•°æ®æ˜¯å“ªäº›ï¼Œæ˜¯å¦æœ‰å¿…è¦å»ºç«‹å¯é è¿æ¥ã€‚æ¯”å¦‚ä¸€äº›traceroute å®ç°ä½¿ç”¨TCP æ•°æ®åŒ…ï¼Œä¾‹å¦‚&lt;em&gt;tcptraceroute&lt;/em&gt;å’Œ&lt;a href=&#34;https://en.wikipedia.org/wiki/Layer_four_traceroute&#34;&gt;ç¬¬å››å±‚traceroute&lt;/a&gt; (LFT)ã€‚&lt;/p&gt;
&lt;p&gt;å…·ä½“ä½¿ç”¨å¯ä»¥å‚è€ƒ&lt;code&gt;man traceroute&lt;/code&gt; ä¸­çš„ä»‹ç»ï¼Œä»¥ä¸Šè¯´çš„ï¼Œåœ¨manæ–‡æ¡£é‡Œéƒ½æœ‰ä»‹ç»åˆ°ï¼›&lt;/p&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡&lt;code&gt;traceroute -P ICMP  www.baidu.com&lt;/code&gt; ä½¿ç”¨ICMPåè®®æ¥è¿½è¸ªæ¯ä¸€è·³çš„è·¯ç”±æƒ…å†µï¼›æ”¯æŒICMP, UDP(é»˜è®¤å‘é€æ–¹å¼), TCPåè®®ï¼Œå…·ä½“è§æ–‡æ¡£ï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœæƒ³æŸ¥çœ‹ICMPåè®®åŒ…çš„å†…å®¹å¯ä»¥é€šè¿‡&lt;a href=&#34;https://gitlab.com/wireshark/wireshark/-/wikis/home&#34;&gt;Wireshark/TShark(å‘½ä»¤)&lt;/a&gt;æ¥æŠ“åŒ…ï¼Œä¸»è¦æ˜¯é€šè¿‡&lt;strong&gt;åè®®æŠ¥æ–‡&lt;/strong&gt;ï¼Œæ¥åˆ†æç½‘ç»œé—®é¢˜ï¼›ä½ ä¼šå‘ç°ping å‘½ä»¤ç¨‹åºåªç”¨åˆ°äº†IP/ICMPåè®®(send Type: 8 (Echo (ping) request)ï¼›recv Type: 0 (Echo (ping) reply) from dst ip)ï¼Œ è€Œtraceroute å‘½ä»¤ç¨‹åºä¼šç”¨åˆ°IP/ICMP(send Type: 8 (Echo (ping) request)ï¼›recv Type: 11 (Time-to-live exceeded) code:0 from æ¯ä¸ªè·¯ç”±ï¼Œrecv Type: 0 (Echo (ping) reply) from dst ip), IP/UDPåè®®(å¦‚æœç”¨UDPå‘é€ï¼Œsend udp æ•°æ®æŠ¥æ–‡, recv Type: 11 (Time-to-live exceeded) code:0 from  æ¯ä¸ªè·¯ç”±ï¼Œ recv Type: 3 (Destination unreachable) code:3 from dst ip)ã€‚&lt;/p&gt;
&lt;p&gt;å¯ä»¥åˆ†æå‡ºï¼Œping å’Œ traceroute éƒ½ä½¿ç”¨IP/ICMPåè®®æ—¶ï¼Œtraceroute æ˜¯æ¥æ”¶äº†æ¯ä¸€è·³è·¯ç”±çš„å“åº”è¿›è¡Œå¤„ç†ï¼Œç„¶åå±•ç°çš„æ¯ä¸€è·³ç´¯è®¡çš„æ€»è€—æ—¶ã€‚æµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/lib/main/net/traceroute-icmp.png&#34; alt=&#34;traceroute-icmp&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;è½®å­&#34;&gt;è½®å­&lt;/h2&gt;
&lt;p&gt;ä¸ºå•¥è¦ç”¨golangé‡æ–°å†™ä¸€ä¸ªå·¥å…·å‘¢ï¼Ÿ ï¼ˆå·²æœ‰å¼€æºçš„ &lt;a href=&#34;https://github.com/go-ping/ping.git&#34;&gt;go-ping&lt;/a&gt;, æ”¯æŒicmp, udp (icmp.ListenPacket &lt;a href=&#34;https://godoc.org/golang.org/x/net/icmp&#34;&gt;x/net/icmp&lt;/a&gt;) ç›´æ¥æŸ¥çœ‹æºç å§ï¼‰&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¹³æ—¶è™½ç„¶ç”¨ï¼Œä½†æ˜¯å…·ä½“å®ç°æƒ³äº†è§£ä¸‹ï¼Œä¸»è¦æ˜¯&lt;a href=&#34;https://en.wikipedia.org/w/index.php?title=Internet_Control_Message_Protocol&#34;&gt;ICMPåè®®&lt;/a&gt;ä¸­çš„æ§åˆ¶ä¿¡æ¯(&lt;a href=&#34;https://en.wikipedia.org/w/index.php?title=Internet_Control_Message_Protocol#Control_messages&#34;&gt;Control messages&lt;/a&gt;), ä»¥ä¾¿åœ¨æ¬¡åè®®ä¸ŠDIYç½‘ç»œéœ€æ±‚ï¼›&lt;/li&gt;
&lt;li&gt;golangæ˜¯è·¨ç³»ç»Ÿå¹³å°ç¼–è¯‘è¯­è¨€ï¼ŒåŒä¸€ä»½ä»£ç ç¼–è¯‘è¿è¡Œåœ¨ä¸åŒå¹³å°ï¼›&lt;/li&gt;
&lt;li&gt;å¯ä»¥åšä¸€äº›æ‰©å±•ï¼Œè¿ç”¨åœ¨K8Sçš„ç¼–æ’å®¹å™¨ä¸­æµ‹è¯•ç½‘ç»œç¯å¢ƒï¼›å› ä¸ºicmpå®šä¹‰åœ¨ç½‘ç»œå±‚ï¼Œåªéœ€ipï¼Œæ— éœ€æœåŠ¡ç«¯å£ï¼Œåˆ©ç”¨icmpåè®®åšä¸€äº›æ‰©å±•åŠŸèƒ½ï¼›æ¯”å¦‚æœºå™¨æ˜¯å¦æŒ‚äº†ï¼Œç›®çš„ipæ˜¯å¦ä¸å¯åˆ°è¾¾äº†ï¼Œä»¥åŠåšä¸€äº›ç½‘ç»œå±‚ç›‘æ§ç­‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;reference&#34;&gt;reference&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Ping_(networking_utility)&#34;&gt;PING&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol&#34;&gt;ICMP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.techtarget.com/searchnetworking/definition/time-to-live&#34;&gt;TTL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Network_address_translation&#34;&gt;NAT&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=IIicPE38O-s&#34;&gt;PING Command - Troubleshooting&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
      
    </item>
    
    <item>
      <title>ç¼“å­˜æ·˜æ±°ç­–ç•¥-LRU</title>
      <link>https://weedge.github.io/post/lru/</link>
      <pubDate>Mon, 08 Nov 2021 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/lru/</guid>
      
        <description>&lt;h2 id=&#34;åºè¨€&#34;&gt;åºè¨€&lt;/h2&gt;
&lt;p&gt;â€‹	åœ¨è®¡ç®—æœºç¡¬ä»¶ä¸­ç¼“/å†…å­˜è®¾è®¡æ˜¯ç”¨æ¥æœºå™¨å¯åŠ¨çš„æ—¶å€™åŠ è½½ç¨‹åºï¼Œåˆ†é…è¿è¡Œç©ºé—´æ•°æ®ï¼Œåœæœºï¼Œç¼“/å†…å­˜ä¸­çš„æ•°æ®ä¼šä¸¢å¤±ï¼›ç£ç›˜ç”¨æ¥æŒä¹…åŒ–å­˜å‚¨ï¼Œæä¾›æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå†…å­˜çš„è¯»å†™é€Ÿåº¦æ¯”ç£ç›˜å¿«å¾ˆå¤šï¼Œä»¥ä¸‹æ˜¯&lt;a href=&#34;https://research.google/people/jeff/&#34;&gt;Jeff Dean&lt;/a&gt;  &amp;ldquo;&lt;a href=&#34;http://brenocon.com/dean_perf.html&#34;&gt;Numbers Everyone Should Know&lt;/a&gt;&amp;rdquo; ä¸­æä¾›çš„æ•°æ®(è™½ç„¶è¿‡å»10å¤šå¹´äº†)ï¼Œ è¯»å–1MBæ•°æ®ï¼Œä»å†…å­˜ä¸­è¯»æ¯”ä»ç£ç›˜ä¸­è¯»å–å¿«100+å€ï¼›ä½†æ˜¯ç¼“/å†…å­˜çš„ç©ºé—´æ¯”ç£ç›˜ç©ºé—´å°‘ï¼Œä¸ºäº†åŠ å¿«æ•°æ®çš„è®¿é—®ï¼Œå‡å°‘ç¼“å­˜/ç£ç›˜ioï¼Œå¤§æ¦‚åˆ†ä¸ºä¸‰ç§ï¼š1. å¯ä»¥æå‰å°†æ•°æ®ä»ç£ç›˜åŠ è½½åˆ°å†…/ç¼“å­˜ä¸­(page)ã€2. å†…/ç¼“å­˜missä»ä¸‹å±‚å­˜å‚¨è·å–æ•°æ®(cache,pool,page)ã€3. æ— éœ€åŠ è½½ï¼Œç›´æ¥å†…/ç¼“å­˜evictï¼›å¦‚æœæä¾›ç»™è¿›ç¨‹çš„æœ€å¤§å†…/ç¼“å­˜èµ„æºåˆ°äº†æœ€å¤§é™åˆ¶ï¼Œéœ€è¦å¯¹å­˜å‚¨èµ„æºè¿›è¡Œevictæ“ä½œï¼Œå¸¸ç”¨çš„evictç­–ç•¥å¯ä»¥ä»&lt;a href=&#34;https://en.wikipedia.org/wiki/Cache_replacement_policies&#34;&gt;Cache_replacement_policies&lt;/a&gt;ä¸­äº†è§£ï¼›æœ‰å…³ç‰¹å®šäºåˆ†é¡µçš„è¯¦ç»†ç®—æ³•ï¼Œè¯·å‚é˜…&lt;a href=&#34;https://en.wikipedia.org/wiki/Page_replacement_algorithm&#34;&gt;é¡µé¢æ›¿æ¢ç®—æ³•&lt;/a&gt;ï¼›æœ‰å…³ç‰¹å®šäº CPU å’Œ RAM ä¹‹é—´ç¼“å­˜çš„è¯¦ç»†ç®—æ³•ï¼Œè¯·å‚é˜…&lt;a href=&#34;https://en.wikipedia.org/wiki/CPU_cache&#34;&gt;CPU ç¼“å­˜&lt;/a&gt;ã€‚è¿™é‡Œä¸»è¦å…³æ³¨LRU evictç›¸å…³ç­–ç•¥ã€‚&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;OP(io)&lt;/th&gt;
&lt;th&gt;cost&lt;!-- raw HTML omitted --&gt;ï¼ˆ1s= 10^9ns)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;L1 cache reference è¯»å–CPUçš„ä¸€çº§ç¼“å­˜&lt;/td&gt;
&lt;td&gt;0.5 ns&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Branch mispredict(è½¬ç§»ã€åˆ†æ”¯é¢„æµ‹)&lt;/td&gt;
&lt;td&gt;5 ns&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;L2 cache reference è¯»å–CPUçš„äºŒçº§ç¼“å­˜&lt;/td&gt;
&lt;td&gt;7 ns&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Mutex lock/unlock äº’æ–¥é”\è§£é”&lt;/td&gt;
&lt;td&gt;100 ns&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Main memory reference è¯»å–å†…å­˜æ•°æ®&lt;/td&gt;
&lt;td&gt;100 ns&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Compress 1K bytes with Zippy 1kå­—èŠ‚å‹ç¼©&lt;/td&gt;
&lt;td&gt;10,000 ns&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Send 2K bytes over 1 Gbps network åœ¨1Gbpsçš„ç½‘ç»œä¸Šå‘é€2kå­—èŠ‚&lt;/td&gt;
&lt;td&gt;20,000 ns&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Read 1 MB sequentially from memory ä»å†…å­˜é¡ºåºè¯»å–1MB&lt;/td&gt;
&lt;td&gt;250,000 ns&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Round trip within same datacenter ä»ä¸€ä¸ªæ•°æ®ä¸­å¿ƒå¾€è¿”ä¸€æ¬¡ï¼Œpingä¸€ä¸‹&lt;/td&gt;
&lt;td&gt;500,000 ns&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Disk seek  ç£ç›˜æœç´¢&lt;/td&gt;
&lt;td&gt;10,000,000 ns&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Read 1 MB sequentially from network ä»ç½‘ç»œä¸Šé¡ºåºè¯»å–1å…†çš„æ•°æ®&lt;/td&gt;
&lt;td&gt;10,000,000 ns&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Read 1 MB sequentially from disk ä»ç£ç›˜é‡Œé¢è¯»å‡º1MB&lt;/td&gt;
&lt;td&gt;30,000,000 ns&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Send packet CA-&amp;gt;Netherlands-&amp;gt;CA ä¸€ä¸ªåŒ…çš„ä¸€æ¬¡è¿œç¨‹è®¿é—®&lt;/td&gt;
&lt;td&gt;150,000,000 ns&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;lruç®—æ³•&#34;&gt;LRUç®—æ³•&lt;/h2&gt;
&lt;p&gt;â€‹	LRU(least recently used)æ˜¯ä¸€ç§ç¼“å­˜ evict ç­–ç•¥ç®—æ³•ï¼šåœ¨ç¼“å­˜æœ‰é™çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæœ‰æ–°çš„æ•°æ®éœ€è¦åŠ è½½è¿›ç¼“å­˜ï¼Œåˆ™éœ€è¦å°†æœ€ä¸å¯èƒ½è¢«ç»§ç»­è®¿é—®çš„ç¼“å­˜å‰”é™¤æ‰ã€‚è¿™æ˜¯ä¸€ç§æå‰é¢„åˆ¤å‡è®¾çš„ç®—æ³•ï¼Œå› ä¸ºç¼“å­˜æ˜¯å¦å¯èƒ½è¢«è®¿é—®åˆ°æ²¡æ³•åšé¢„æµ‹çš„ï¼Œæ‰€ä»¥å‡è®¾ &lt;strong&gt;ä¸€ä¸ªkeyç»å¸¸è¢«è®¿é—®ï¼Œé‚£ä¹ˆè¯¥keyçš„idle timeåº”è¯¥æ˜¯æœ€å°çš„ã€‚&lt;/strong&gt; (ä½†è¿™ä¸ªå‡è®¾ä¹Ÿæ˜¯åŸºäºæ¦‚ç‡ï¼Œå¹¶ä¸æ˜¯å……è¦æ¡ä»¶,å¾ˆæ˜æ˜¾,idle timeæœ€å°çš„,ç”šè‡³éƒ½ä¸ä¸€å®šä¼šè¢«å†æ¬¡è®¿é—®åˆ°)ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	LRU çš„å·¥ä½œåŸç†æ˜¯ä¸€ç§æ—¶é—´å±€éƒ¨æ€§åŸç†çš„å‡è®¾ï¼Œåœ¨è¿‡å»çš„å‡ æ¡æŒ‡ä»¤ä¸­ä½¿ç”¨æœ€å¤šçš„é¡µé¢æœ€æœ‰å¯èƒ½åœ¨æ¥ä¸‹æ¥çš„å‡ æ¡æŒ‡ä»¤ä¸­ä¹Ÿè¢«å¤§é‡ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;â€‹	å®ç°æ–¹å¼å¯ä»¥é‡‡ç”¨wikiä¸­çš„å®ç°ï¼Œæ¯ä¸ªç¼“å­˜itemä¸­æœ‰åºåˆ—å·(æ¯ä¸ªæ–°è®¿é—®çš„å¢é‡ä¸º 1)ï¼Œç¼“å­˜æ»¡äº†å°†åºåˆ—å·æœ€ä½çš„æ›¿æ¢æ‰ï¼Œè¿™ç§å®ç°éœ€è¦æ‰¾åˆ°æœ€ä½çš„è¿›è¡Œæ¯”è¾ƒæ›¿æ¢ï¼›è¿˜æœ‰ç§å®ç°å®ç°æ–¹å¼æ˜¯é€šè¿‡hashMap+åŒå‘é“¾è¡¨çš„æ–¹å¼å®ç°ï¼Œç©ºé—´æ¢æ—¶é—´çš„æ–¹å¼ï¼Œ&lt;a href=&#34;https://leetcode-cn.com/problems/lru-cache/&#34;&gt;leetcodeä¸Šæœ‰è¿™é“é¢˜&lt;/a&gt;ï¼Œä¸€èˆ¬é¢è¯•ä¼šé—®åˆ°ï¼›&lt;/p&gt;
&lt;p&gt;å®é™…å·¥ç¨‹å®ç°ä¸­ï¼Œç”±äºå®ç°æˆæœ¬ï¼Œæ ¹æ®ä½¿ç”¨åœºæ™¯ï¼Œè€ƒè™‘ç©ºé—´åˆ©ç”¨å’Œæ—¶é—´çš„æŠ˜ä¸­ï¼Œä½¿ç”¨çš„&lt;a href=&#34;https://en.wikipedia.org/wiki/Page_replacement_algorithm#Variants_on_LRU&#34;&gt;LRUç®—æ³•å˜ä½“&lt;/a&gt;ï¼š(ä»¥ä¸‹å®šä¹‰æ¥è‡ªwiki)&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Page_replacement_algorithm#cite_note-15&#34;&gt;LRU-K&lt;/a&gt; é©±é€è¿‡å»ç¬¬ K æ¬¡æœ€è¿‘è®¿é—®æœ€è¿œçš„é¡µé¢ã€‚ä¾‹å¦‚ï¼ŒLRU-1 åªæ˜¯ LRUï¼Œè€Œ LRU-2 æ ¹æ®å€’æ•°ç¬¬äºŒæ¬¡è®¿é—®çš„æ—¶é—´é©±é€é¡µé¢ã€‚LRU-K åœ¨æ—¶é—´ä¸Šçš„å±€éƒ¨æ€§æ–¹é¢å¤§å¤§æ”¹è¿›äº† LRUã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Page_replacement_algorithm#cite_note-16&#34;&gt;ARC&lt;/a&gt; ç®—æ³•é€šè¿‡ä¿æŒæœ€è¿‘é©±é€é¡µé¢çš„å†å²å¯LRUï¼Œå¹¶ä½¿ç”¨æ­¤é€‰é¡¹å¯ä»¥æ›´æ”¹çš„åå¥½è¿‘æœŸæˆ–é¢‘ç¹è®¿é—®ã€‚å®ƒå¯¹é¡ºåºæ‰«æç‰¹åˆ«æœ‰æŠµæŠ—åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Page_replacement_algorithm#cite_note-17&#34;&gt;2Q&lt;/a&gt; ç®—æ³•æ”¹è¿›äº† LRU å’Œ LRU/2 ç®—æ³•ã€‚é€šè¿‡å…·æœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œä¸€ä¸ªç”¨äºçƒ­è·¯å¾„é¡¹ç›®ï¼Œå¦ä¸€ä¸ªç”¨äºæ…¢è·¯å¾„é¡¹ç›®ï¼Œé¡¹ç›®é¦–å…ˆè¢«æ”¾ç½®åœ¨æ…¢è·¯å¾„é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä¸”åœ¨ç¬¬äºŒæ¬¡è®¿é—®æ”¾ç½®åœ¨çƒ­è·¯å¾„é¡¹ç›®ä¸­çš„é¡¹ç›®ä¹‹åï¼›ç”±äºå¯¹æ·»åŠ é¡¹çš„å¼•ç”¨æ¯” LRU å’Œ LRU/2 ç®—æ³•ä¸­çš„ä¿ç•™æ—¶é—´æ›´é•¿ï¼Œå› æ­¤å®ƒå…·æœ‰æ›´å¥½çš„çƒ­è·¯å¾„é˜Ÿåˆ—ï¼Œä»è€Œæé«˜äº†ç¼“å­˜çš„å‘½ä¸­ç‡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Cache_replacement_policies#Segmented_LRU_(SLRU)&#34;&gt;SLRU&lt;/a&gt; ç¼“å­˜åˆ†ä¸ºä¸¤ä¸ªæ®µï¼Œè¯•ç”¨æ®µå’Œä¿æŠ¤æ®µã€‚æ¯ä¸ªæ®µä¸­çš„è¡ŒæŒ‰ä»æœ€è¿‘è®¿é—®åˆ°æœ€è¿‘æœ€å°‘è®¿é—®çš„é¡ºåºæ’åˆ—ã€‚æ¥è‡ªæœªå‘½ä¸­çš„æ•°æ®è¢«æ·»åŠ åˆ°è¯•ç”¨æ®µæœ€è¿‘è®¿é—®çš„æœ«ç«¯çš„ç¼“å­˜ä¸­ã€‚å‘½ä¸­ä»å®ƒä»¬å½“å‰æ‰€åœ¨çš„ä»»ä½•åœ°æ–¹åˆ é™¤ï¼Œå¹¶æ·»åŠ åˆ°å—ä¿æŠ¤æ®µçš„æœ€è¿‘è®¿é—®ç«¯ã€‚å› æ­¤ï¼Œå—ä¿æŠ¤æ®µä¸­çš„è¡Œè‡³å°‘è¢«è®¿é—®äº†ä¸¤æ¬¡ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æœ¬åœ°ç¼“å­˜ä¸­çš„å®ç°æœºåˆ¶&#34;&gt;æœ¬åœ°ç¼“å­˜ä¸­çš„å®ç°æœºåˆ¶&lt;/h2&gt;
&lt;p&gt;goè¯­è¨€å®ç°çš„æœ¬åœ°ç¼“å­˜ç­–ç•¥ä¸­æœ‰å¼€æºæ–¹æ¡ˆ&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/golang/groupcache&#34;&gt;https://github.com/golang/groupcache&lt;/a&gt;  (LRU)&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;http://github.com/dgryski/go-s4lru&#34;&gt;http://github.com/dgryski/go-s4lru&lt;/a&gt; (S4LRU)&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/dgryski/go-arc&#34;&gt;https://github.com/dgryski/go-arc&lt;/a&gt; (ARC)&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/hashicorp/golang-lru&#34;&gt;https://github.com/hashicorp/golang-lru&lt;/a&gt; (LRU, ARC, TwoQueue)&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/vmihailenco/go-cache-benchmark&#34;&gt;https://github.com/vmihailenco/go-cache-benchmark&lt;/a&gt; å¯¹ä¸åŒçš„cache æ·˜æ±°ç­–ç•¥çš„å¯¹æ¯”ï¼Œå¼•ç”¨ç»“æœï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;TinyLFUæœ€é€‚åˆå°‘é‡çš„key(å°‘äº100k)ã€‚TinyLFUå†…å­˜å¼€é”€å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°è¿›è¡Œè°ƒæ•´ã€‚
Clock-proæœ‰æ˜æ˜¾è¾ƒå°çš„å†…å­˜ä½¿ç”¨å¤§é‡çš„key(å½“keyçš„æ•°é‡è¶…è¿‡ 1m)ã€‚
åˆ†æ®µLRUçš„å†…å­˜ä½¿ç”¨é‡æ›´å°ï¼Œä½†å‘½ä¸­ç‡ä¸ä¸€è‡´ã€‚
å¦‚æœä½ éœ€è¦å®ƒæä¾›çš„é¢å¤–åŠŸèƒ½ï¼ŒRistrettoä»ç„¶æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;å­˜å‚¨ç»„ä»¶ä¸­çš„å®ç°æœºåˆ¶&#34;&gt;å­˜å‚¨ç»„ä»¶ä¸­çš„å®ç°æœºåˆ¶&lt;/h2&gt;
&lt;h3 id=&#34;redis-dictsdsredisobject-lru-evictç­–ç•¥&#34;&gt;redis Dict(sds,redisObject) LRU evictç­–ç•¥&lt;/h3&gt;
&lt;p&gt;redis æ˜¯ç¼“å­˜æ•°æ®åº“ï¼Œç¼“å­˜ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå¯ä»¥æŒ‡å®šæœ€å¤§å†…å­˜ä½¿ç”¨ç©ºé—´ï¼›redisæä¾›è¿‡æœŸæœºåˆ¶ï¼Œç»™keyåˆ¶å®šè¿‡æœŸæ—¶é—´ï¼Œrediså®ç°äº†åˆ é™¤è¿™äº›è¿‡æœŸkeyçš„åˆ é™¤ç­–ç•¥ï¼ˆå®šæœŸåˆ é™¤+æƒ°æ€§åˆ é™¤ï¼‰ï¼Œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨é—®é¢˜ï¼Œå¯¹äºä¸€äº›keyæ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ€»ä¼šåˆ°æœ€å¤§å†…å­˜ä½¿ç”¨ç©ºé—´ï¼Œéœ€è¦å®ç°å†…å­˜æ·˜æ±°å›æ”¶ç­–ç•¥ï¼Œå…¶ä¸­ç­–ç•¥å°±æ˜¯LRU, æ“ä½œå¯¹è±¡åˆ†ä¸ºå…¨éƒ¨key (allkeys-lru) å’Œ è¿‡æœŸkey(volatile-lru)ï¼›è¿™é‡Œæ•´ä½“ä»‹ç»ä¸‹redisç¼“å­˜ç­–ç•¥ï¼Œç„¶åå•ç‹¬ä»‹ç»å¯¹åº”çš„redis LRU evictç­–ç•¥:&lt;/p&gt;
&lt;h4 id=&#34;æœ€å¤§å†…å­˜é…ç½®é€‰é¡¹&#34;&gt;æœ€å¤§å†…å­˜é…ç½®é€‰é¡¹&lt;/h4&gt;
&lt;p&gt;maxmemory é…ç½®é€‰é¡¹ä½¿ç”¨æ¥é…ç½® Redis çš„å­˜å‚¨æ•°æ®æ‰€èƒ½ä½¿ç”¨çš„æœ€å¤§å†…å­˜é™åˆ¶ã€‚å¯ä»¥é€šè¿‡åœ¨å†…ç½®æ–‡ä»¶redis.confä¸­é…ç½®ï¼Œä¹Ÿå¯åœ¨Redisè¿è¡Œæ—¶é€šè¿‡å‘½ä»¤CONFIG SETæ¥é…ç½®ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦é…ç½®å†…å­˜ä¸Šé™æ˜¯100Mçš„Redisç¼“å­˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨ redis.conf é…ç½®å¦‚ä¸‹ï¼šmaxmemory 100mb&lt;/p&gt;
&lt;p&gt;è®¾ç½® maxmemory ä¸º 0 è¡¨ç¤ºæ²¡æœ‰å†…å­˜é™åˆ¶ã€‚åœ¨ 64-bit ç³»ç»Ÿä¸­ï¼Œé»˜è®¤æ˜¯ 0 æ— é™åˆ¶ï¼Œä½†æ˜¯åœ¨ 32-bit ç³»ç»Ÿä¸­é»˜è®¤æ˜¯ 3GBã€‚å½“å­˜å‚¨æ•°æ®è¾¾åˆ°é™åˆ¶æ—¶ï¼ŒRedis ä¼šæ ¹æ®æƒ…å½¢é€‰æ‹©ä¸åŒç­–ç•¥ï¼Œæˆ–è€…è¿”å›errorsï¼ˆè¿™æ ·ä¼šå¯¼è‡´æµªè´¹æ›´å¤šçš„å†…å­˜ï¼‰ï¼Œæˆ–è€…æ¸…é™¤ä¸€äº›æ—§æ•°æ®å›æ”¶å†…å­˜æ¥æ·»åŠ æ–°æ•°æ®ã€‚&lt;/p&gt;
&lt;h4 id=&#34;æƒ°æ€§é‡Šæ”¾çš„ç­–ç•¥&#34;&gt;æƒ°æ€§é‡Šæ”¾çš„ç­–ç•¥&lt;/h4&gt;
&lt;p&gt;åº”ç”¨è¿™ç§ç­–ç•¥çš„åŸå› åœ¨äºå¯¹äºæŸäº›æ•°æ®å¯¹è±¡çš„é‡Šæ”¾éœ€è¦æ¶ˆè€—è¿‡å¤šçš„ç³»ç»Ÿèµ„æºï¼Œå¦‚æœåœ¨&lt;em&gt;Redis&lt;/em&gt;çš„ä¸»çº¿ç¨‹ä¸­é‡‡ç”¨åŒæ­¥çš„æ–¹å¼å»åˆ é™¤ä»¥åŠé‡Šæ”¾è¿™æ ·çš„&lt;em&gt;key-value&lt;/em&gt;æ•°æ®ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´ç³»ç»Ÿé•¿æ—¶é—´çš„é˜»å¡åœ¨é‡Šæ”¾æ•°æ®æ“ä½œä¸Šï¼Œè€Œæ— æ³•å¤„ç†å…¶ä»–çš„ä¸šåŠ¡é€»è¾‘ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä»¥æƒ°æ€§é‡Šæ”¾çš„ç­–ç•¥ï¼Œä½¿ç”¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œé€šè¿‡å¼‚æ­¥çš„æ–¹å¼æ¥å¯¹æ•°æ®å¯¹è±¡è¿›è¡Œé‡Šæ”¾ï¼Œæ— ç–‘æ˜¯ä¸€ç§è¾ƒä¸ºåˆé€‚çš„é€‰æ‹©ï¼Œå¯é…ç½®ä¸‰ç§æƒ…å†µï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;redisServer.lazyfree_lazy_evictionï¼š æ˜¯å¦åœ¨æ·˜æ±°æŸä¸ª&lt;em&gt;key&lt;/em&gt;æ—¶ï¼Œä½¿ç”¨æƒ°æ€§é‡Šæ”¾ç­–ç•¥ï¼›è¿™ä¸ªåœ¨å†…å­˜æ·˜æ±°ç­–ç•¥å¼‚æ­¥é‡Šæ”¾ä¼šç”¨åˆ°ï¼›&lt;/li&gt;
&lt;li&gt;redisServer.lazyfree_lazy_expireï¼šæ˜¯å¦åœ¨è¿‡æœŸæŸä¸ª&lt;em&gt;key&lt;/em&gt;æ—¶ï¼Œä½¿ç”¨æƒ°æ€§é‡Šæ”¾ç­–ç•¥;&lt;/li&gt;
&lt;li&gt;redisServer.lazyfree_lazy_server_del: æœåŠ¡å™¨ç«¯åˆ é™¤æŸä¸ª&lt;em&gt;key&lt;/em&gt;æ—¶ï¼Œæ˜¯å¦ä½¿ç”¨æƒ°æ€§é‡Šæ”¾ç­–ç•¥;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;è¿‡æœŸåˆ é™¤ç¼“å­˜ç­–ç•¥&#34;&gt;è¿‡æœŸåˆ é™¤ç¼“å­˜ç­–ç•¥&lt;/h4&gt;
&lt;p&gt;åˆ†ä¸ºå®šæœŸåˆ é™¤ï¼Œæƒ°æ€§åˆ é™¤, ä¸¤ç§ç­–ç•¥é…åˆä½¿ç”¨ï¼š&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å®šæœŸåˆ é™¤&lt;/strong&gt; æŒ‡çš„æ˜¯Redisé»˜è®¤ä¼šæ¯éš”ä¸€å®šæ—¶é—´ï¼ˆé»˜è®¤100msï¼‰å°±ä¼š&lt;!-- raw HTML omitted --&gt;æŠ½å–ä¸€æ‰¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„key&lt;!-- raw HTML omitted --&gt;æ¥æ£€æµ‹æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸå°±åˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Redis2.6ç‰ˆæœ¬ä¸­ï¼Œè§„å®šæ¯ç§’è¿è¡Œ10æ¬¡ï¼Œå¤§æ¦‚100msè¿è¡Œä¸€æ¬¡ã€‚åœ¨Redis2.8ç‰ˆæœ¬åï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶redis.conf çš„ &lt;strong&gt;hz&lt;/strong&gt; é€‰é¡¹æ¥è°ƒæ•´æ¯ç§’æ¬¡æ•°(ä¸€èˆ¬ç”¨é»˜è®¤å€¼ï¼Œ è¿‡é«˜ä¼šçš„cpué€ æˆä¸€å®šå‹åŠ›)ã€‚ç”±redis.c/activeExpireCycle å‡½æ•°å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æƒ°æ€§åˆ é™¤&lt;/strong&gt; åœ¨è·å–æŸä¸ªKeyæ—¶Redisä¼šå…ˆæ£€æµ‹ä¸€ä¸‹ï¼Œè¿™ä¸ªkeyæ˜¯å¦è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Ÿå¦‚æœè®¾ç½®äº†è¿‡æœŸæ—¶é—´é‚£ä¹ˆæ˜¯å¦è¿‡æœŸï¼Ÿè¿‡æœŸå°±åˆ é™¤ã€‚ç”± db.c/expireIfNeeded å‡½æ•°å®ç°ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœå®šæœŸæŠ½å–ä¸€æ‰¹è¿‡æœŸkeyåˆ é™¤, ä»¥åŠæ²¡æœ‰å¯¹è¿‡æœŸkeyè®¿é—®äº†ï¼Œè¿™æ ·ä¼šå­˜åœ¨å¤§é‡è¿‡æœŸkeyæœªåˆ é™¤å›æ”¶çš„æƒ…å†µï¼Œä¼šå¯¼è‡´å†…å­˜ä½¿ç”¨ç‡å¤§å¤§é™ä½ï¼›æ‰€ä»¥rediså†…éƒ¨æä¾›äº†ä¸åŒçš„å†…å­˜æ·˜æ±°å›æ”¶ç­–ç•¥ã€‚&lt;/p&gt;
&lt;h4 id=&#34;å†…å­˜æ·˜æ±°å›æ”¶ç­–ç•¥&#34;&gt;å†…å­˜æ·˜æ±°å›æ”¶ç­–ç•¥&lt;/h4&gt;
&lt;p&gt;å½“å†…å­˜è¾¾åˆ°é™åˆ¶æ—¶ï¼ŒRedis å…·ä½“çš„å›æ”¶ç­–ç•¥æ˜¯é€šè¿‡ maxmemory-policy é…ç½®é¡¹é…ç½®çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹çš„ç­–ç•¥éƒ½æ˜¯å¯ç”¨çš„ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;noenvictionï¼šä¸æ¸…é™¤æ•°æ®ï¼Œåªæ˜¯è¿”å›é”™è¯¯ï¼Œè¿™æ ·ä¼šå¯¼è‡´æµªè´¹æ‰æ›´å¤šçš„å†…å­˜ï¼Œå¯¹å¤§å¤šæ•°å†™å‘½ä»¤ï¼ˆDEL å‘½ä»¤å’Œå…¶ä»–çš„å°‘æ•°å‘½ä»¤ä¾‹å¤–ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;allkeys-lruï¼šä»æ‰€æœ‰çš„æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ï¼Œä»¥ä¾›æ–°æ•°æ®ä½¿ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;volatile-lruï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ï¼Œä»¥ä¾›æ–°æ•°æ®ä½¿ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;allkeys-randomï¼šä»æ‰€æœ‰æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ï¼Œä»¥ä¾›æ–°æ•°æ®ä½¿ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;volatile-randomï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ï¼Œä»¥ä¾›æ–°æ•°æ®ä½¿ç”¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;volatile-ttlï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°ï¼Œä»¥ä¾›æ–°æ•°æ®ä½¿ç”¨&lt;/p&gt;
&lt;p&gt;ä» Redis 4.0 ç‰ˆå¼€å§‹ï¼Œå¼•å…¥äº†æ–°çš„ LFUï¼ˆæœ€è¿‘æœ€ä¸å¸¸ç”¨ï¼‰ç­–ç•¥ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;volatile-lfuï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†ï¼ˆserver.db[i].expiresï¼‰ä¸­æŒ‘é€‰è¿‘ä¼¼ LFU æ•°æ®æ·˜æ±°ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;allkeys-lfuï¼šä»æ‰€æœ‰çš„æ•°æ®é›†ï¼ˆserver.db[i].dictï¼‰ä¸­æŒ‘é€‰è¿‘ä¼¼ LFU æ•°æ®æ·˜æ±°ã€‚&lt;/p&gt;
&lt;p&gt;LFU ç±»ä¼¼äº LRUï¼šå®ƒä½¿ç”¨ä¸€ä¸ªæ¦‚ç‡è®¡æ•°å™¨ï¼Œç§°ä¸º&lt;a href=&#34;https://en.wikipedia.org/wiki/Approximate_counting_algorithm&#34;&gt;è«é‡Œæ–¯è®¡æ•°å™¨&lt;/a&gt;ï¼Œä»¥ä¾¿ä»…ä½¿ç”¨æ¯ä¸ªå¯¹è±¡çš„å‡ ä½æ¥ä¼°è®¡å¯¹è±¡è®¿é—®é¢‘ç‡ï¼Œå¹¶ç»“åˆè¡°å‡å‘¨æœŸï¼Œä»¥ä¾¿è®¡æ•°å™¨éšç€æ—¶é—´çš„æ¨ç§»è€Œå‡å°‘ï¼šåœ¨æŸäº›æ—¶å€™ï¼Œæˆ‘ä»¬ä¸å†å¸Œæœ›å°†keyè§†ä¸ºç»å¸¸è®¿é—®çš„keyï¼Œå³ä½¿å®ƒä»¬è¿‡å»æ˜¯è¿™æ ·ï¼Œä»¥ä¾¿ç®—æ³•å¯ä»¥é€‚åº”è®¿é—®çš„è½¬å˜ã€‚LFUå…·æœ‰å¯è°ƒå‚æ•°:  ï¼ˆè§ï¼š&lt;a href=&#34;http://antirez.com/news/109&#34;&gt;Random notes on improving the Redis LRU algorithm&lt;/a&gt; Least Frequently Used)&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;lfu-log-factor 10 //åœ¨å¤§çº¦ä¸€ç™¾ä¸‡ä¸ªè¯·æ±‚æ—¶ä½¿è®¡æ•°å™¨é¥±å’Œå› å­ï¼Œè®¡æ•°å™¨å¯¹æ•°å› å­ä¼šæ”¹å˜éœ€è¦å¤šå°‘æ¬¡å‘½ä¸­æ‰èƒ½ä½¿é¢‘ç‡è®¡æ•°å™¨é¥±å’Œï¼Œè¿™æ°å¥½åœ¨ 0-255 çš„èŒƒå›´å†…ã€‚ç³»æ•°è¶Šé«˜ï¼Œéœ€è¦è¶Šå¤šçš„è®¿é—®ä»¥è¾¾åˆ°æœ€å¤§å€¼ã€‚ç³»æ•°è¶Šä½ï¼Œä½è®¿é—®è®¡æ•°å™¨çš„åˆ†è¾¨ç‡è¶Šå¥½ï¼Œè§redisç¤ºä¾‹redis.confæ–‡ä»¶
lfu-decay-time 1 //æ¯ä¸€åˆ†é’Ÿè¡°å‡ä¸€æ¬¡è®¡æ•°å™¨ã€‚
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“ cache ä¸­æ²¡æœ‰ç¬¦åˆæ¸…é™¤æ¡ä»¶çš„ key æ—¶ï¼Œå›æ”¶ç­–ç•¥ volatile-lru, volatile-random å’Œvolatile-ttl å°†ä¼šå’Œ ç­–ç•¥ noeviction ä¸€æ ·è¿”å›é”™è¯¯ã€‚é€‰æ‹©æ­£ç¡®çš„å›æ”¶ç­–ç•¥æ˜¯å¾ˆé‡è¦çš„ï¼Œå–å†³äºä½ çš„åº”ç”¨ç¨‹åºçš„è®¿é—®æ¨¡å¼ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶é‡æ–°é…ç½®ç­–ç•¥ï¼Œä½¿ç”¨ INFO è¾“å‡ºæ¥ç›‘æ§ç¼“å­˜å‘½ä¸­å’Œé”™è¿‡çš„æ¬¡æ•°ï¼Œä»¥è°ƒä¼˜ä½ çš„è®¾ç½®ã€‚&lt;/p&gt;
&lt;p&gt;æ™®é€‚ç»éªŒè§„åˆ™ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœæœŸæœ›ç”¨æˆ·è¯·æ±‚å‘ˆç°å¹‚å¾‹åˆ†å¸ƒ(power-law distribution)ï¼Œä¹Ÿå°±æ˜¯ï¼ŒæœŸæœ›ä¸€éƒ¨åˆ†å­é›†å…ƒç´ è¢«è®¿é—®å¾—è¿œæ¯”å…¶ä»–å…ƒç´ å¤šæ—¶ï¼Œå¯ä»¥ä½¿ç”¨allkeys-lruç­–ç•¥ã€‚åœ¨ä½ ä¸ç¡®å®šæ—¶è¿™æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæœŸæœ›æ˜¯å¾ªç¯å‘¨æœŸçš„è®¿é—®ï¼Œæ‰€æœ‰çš„é”®è¢«è¿ç»­æ‰«æï¼Œæˆ–è€…æœŸæœ›è¯·æ±‚ç¬¦åˆå¹³å‡åˆ†å¸ƒ(æ¯ä¸ªå…ƒç´ ä»¥ç›¸åŒçš„æ¦‚ç‡è¢«è®¿é—®)ï¼Œå¯ä»¥ä½¿ç”¨allkeys-randomç­–ç•¥ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ æœŸæœ›èƒ½è®© Redis é€šè¿‡ä½¿ç”¨ä½ åˆ›å»ºç¼“å­˜å¯¹è±¡çš„æ—¶å€™è®¾ç½®çš„TTLå€¼ï¼Œç¡®å®šå“ªäº›å¯¹è±¡åº”è¯¥æ˜¯è¾ƒå¥½çš„æ¸…é™¤å€™é€‰é¡¹ï¼Œå¯ä»¥ä½¿ç”¨volatile-ttlç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å½“ä½ æƒ³ä½¿ç”¨å•ä¸ªRediså®ä¾‹æ¥å®ç°ç¼“å­˜å’ŒæŒä¹…åŒ–ä¸€äº›é”®ï¼Œallkeys-lruå’Œvolatile-randomç­–ç•¥ä¼šå¾ˆæœ‰ç”¨ã€‚ä½†æ˜¯ï¼Œé€šå¸¸æœ€å¥½æ˜¯è¿è¡Œä¸¤ä¸ªRediså®ä¾‹æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;å¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸ºé”®è®¾ç½®è¿‡æœŸæ—¶é—´éœ€è¦æ¶ˆè€—å†…å­˜ï¼Œæ‰€ä»¥ä½¿ç”¨åƒallkeys-lruè¿™æ ·çš„ç­–ç•¥ä¼šæ›´é«˜æ•ˆï¼Œå› ä¸ºåœ¨å†…å­˜å‹åŠ›ä¸‹æ²¡æœ‰å¿…è¦ä¸ºé”®çš„å›æ”¶è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å›æ”¶è¿‡ç¨‹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ç†è§£å›æ”¶è¿‡ç¨‹æ˜¯è¿ä½œæµç¨‹éå¸¸çš„é‡è¦ï¼Œå›æ”¶è¿‡ç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸€ä¸ªå®¢æˆ·ç«¯è¿è¡Œä¸€ä¸ªæ–°å‘½ä»¤ï¼Œæ·»åŠ äº†æ–°æ•°æ®ã€‚&lt;/li&gt;
&lt;li&gt;Redisæ£€æŸ¥å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœå¤§äºmaxmemoryé™åˆ¶ï¼Œæ ¹æ®ç­–ç•¥æ¥å›æ”¶é”®ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªæ–°çš„å‘½ä»¤è¢«æ‰§è¡Œï¼Œå¦‚æ­¤ç­‰ç­‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æˆ‘ä»¬æ·»åŠ æ•°æ®æ—¶é€šè¿‡æ£€æŸ¥ï¼Œç„¶åå›æ”¶é”®ä»¥è¿”å›åˆ°é™åˆ¶ä»¥ä¸‹ï¼Œæ¥è¿ç»­ä¸æ–­çš„ç©¿è¶Šå†…å­˜é™åˆ¶çš„è¾¹ç•Œã€‚å¦‚æœä¸€ä¸ªå‘½ä»¤å¯¼è‡´å¤§é‡çš„å†…å­˜è¢«å ç”¨(æ¯”å¦‚ä¸€ä¸ªå¾ˆå¤§çš„é›†åˆä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„é”®)ï¼Œé‚£ä¹ˆå†…å­˜é™åˆ¶å¾ˆå¿«å°±ä¼šè¢«è¿™ä¸ªæ˜æ˜¾çš„å†…å­˜é‡æ‰€è¶…è¶Šã€‚&lt;/p&gt;
&lt;h4 id=&#34;è¿‘ä¼¼lruç®—æ³•&#34;&gt;è¿‘ä¼¼LRUç®—æ³•&lt;/h4&gt;
&lt;p&gt;Redisæ•´ä½“ä¸Šæ˜¯ä¸€ä¸ªå¤§çš„dictï¼Œå¦‚æœå®ç°ä¸€ä¸ªåŒå‘é“¾è¡¨éœ€è¦åœ¨æ¯ä¸ªkeyä¸Šé¦–å…ˆå¢åŠ ä¸¤ä¸ªæŒ‡é’ˆï¼Œéœ€è¦16ä¸ªå­—èŠ‚ï¼Œå¹¶ä¸”é¢å¤–éœ€è¦ä¸€ä¸ªlistç»“æ„ä½“å»å­˜å‚¨è¯¥åŒå‘é“¾è¡¨çš„å¤´å°¾èŠ‚ç‚¹ä¿¡æ¯ã€‚Redisä½œè€…è®¤ä¸ºè¿™æ ·å®ç°ä¸ä»…å†…å­˜å ç”¨å¤ªå¤§ï¼Œè€Œä¸”å¯èƒ½å¯¼è‡´æ€§èƒ½é™ä½ã€‚å…·ä½“è¯¦è§ä½œè€…åšå®¢æ–‡ç« ï¼š&lt;a href=&#34;http://antirez.com/news/109&#34;&gt;Random notes on improving the Redis LRU algorithm&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;â€ƒâ€ƒ&lt;strong&gt;Redisä¸ºä»€ä¹ˆä¸ä½¿ç”¨åŸç”ŸLRUç®—æ³•ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸç”ŸLRUç®—æ³•éœ€è¦ åŒå‘é“¾è¡¨ æ¥ç®¡ç†æ•°æ®ï¼Œéœ€è¦&lt;strong&gt;é¢å¤–å†…å­˜&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;li&gt;æ•°æ®è®¿é—®æ—¶æ¶‰åŠ&lt;strong&gt;æ•°æ®ç§»åŠ¨ï¼Œæœ‰æ€§èƒ½æŸè€—&lt;/strong&gt;ï¼›&lt;/li&gt;
&lt;li&gt;Redisç°æœ‰&lt;strong&gt;æ•°æ®ç»“æ„éœ€è¦æ”¹é€ &lt;/strong&gt;ï¼ŒdictEntry, keyæŒ‡å‘sds, valæŒ‡å‘redisObjectï¼ŒdictEntry æ˜¯ä¸ªå•å‘é“¾è¡¨ï¼›&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Redisçš„LRUç®—æ³•ä¸æ˜¯ä¸€ä¸ªä¸¥æ ¼çš„LRUå®ç°ã€‚è¿™æ„å‘³ç€Redisä¸èƒ½é€‰æ‹©æœ€ä½³å€™é€‰é”®æ¥å›æ”¶ï¼Œä¹Ÿå°±æ˜¯æœ€ä¹…æœªè¢«è®¿é—®çš„é‚£äº›é”®ã€‚ç›¸åï¼ŒRedis ä¼šå°è¯•æ‰§è¡Œä¸€ä¸ªè¿‘ä¼¼çš„LRUç®—æ³•ï¼Œé€šè¿‡é‡‡æ ·ä¸€å°éƒ¨åˆ†é”®ï¼Œç„¶ååœ¨é‡‡æ ·é”®ä¸­å›æ”¶æœ€é€‚åˆ(æ‹¥æœ‰æœ€ä¹…è®¿é—®æ—¶é—´)çš„é‚£ä¸ªã€‚ç„¶è€Œï¼Œä»Redis3.0å¼€å§‹ï¼Œç®—æ³•è¢«æ”¹è¿›ä¸ºç»´æŠ¤ä¸€ä¸ªå›æ”¶å€™é€‰é”®æ± ã€‚è¿™æ”¹å–„äº†ç®—æ³•çš„æ€§èƒ½ï¼Œä½¿å¾—æ›´æ¥è¿‘äºçœŸå®çš„LRUç®—æ³•çš„è¡Œä¸ºã€‚Redisçš„LRUç®—æ³•æœ‰ä¸€ç‚¹å¾ˆé‡è¦ï¼Œä½ å¯ä»¥è°ƒæ•´ç®—æ³•çš„ç²¾åº¦ï¼Œé€šè¿‡æ”¹å˜æ¯æ¬¡å›æ”¶æ—¶æ£€æŸ¥çš„é‡‡æ ·æ•°é‡ã€‚è¿™ä¸ªå‚æ•°å¯ä»¥é€šè¿‡å¦‚ä¸‹é…ç½®æŒ‡ä»¤ï¼š&lt;code&gt;maxmemory-samples 5&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Redisæ²¡æœ‰ä½¿ç”¨çœŸå®çš„LRUå®ç°çš„åŸå› ï¼Œæ˜¯å› ä¸ºè¿™ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ã€‚ç„¶è€Œï¼Œè¿‘ä¼¼å€¼å¯¹ä½¿ç”¨Redisçš„åº”ç”¨æ¥è¯´åŸºæœ¬ä¸Šä¹Ÿæ˜¯ç­‰ä»·çš„ã€‚æ–‡ç« &lt;a href=&#34;https://redis.io/topics/lru-cache&#34;&gt;Using Redis as an LRU cache&lt;/a&gt;ä¸ºRedisä½¿ç”¨çš„LRUè¿‘ä¼¼å€¼å’ŒçœŸå®LRUä¹‹é—´çš„æ¯”è¾ƒã€‚&lt;/p&gt;
&lt;p&gt;â€ƒè§¦å‘æ—¶æœºæ˜¯åœ¨redis serveræ‰§è¡Œæ–°çš„å†™å‘½ä»¤æ—¶, å½“ mem_used &amp;gt; maxmemory çš„æ—¶å€™ï¼Œé€šè¿‡ &lt;a href=&#34;https://github.com/redis/redis/blob/c1718f9d862267bc44b2a326cdc8cb1ca5b81a39/src/evict.c#L531:5&#34;&gt;performEvictions&lt;/a&gt; æ–¹æ³•å®Œæˆæ•°æ®æ·˜æ±°(æ‰€çœ‹çš„Redis6.2.6æºç )ã€‚LRUç­–ç•¥æ·˜æ±°æ ¸å¿ƒé€»è¾‘åœ¨ &lt;a href=&#34;https://github.com/redis/redis/blob/c1718f9d862267bc44b2a326cdc8cb1ca5b81a39/src/evict.c#L145:6&#34;&gt;evictionPoolPopulate&lt;/a&gt;ï¼ˆæ·˜æ±°æ•°æ®é›†åˆå¡«å……ï¼‰ æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Redis6.2.6 æ·˜æ±°ç­–ç•¥æ•´ä½“é€»è¾‘&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/weedge/lib/blob/main/client/redis/redis-lru.png?raw=true&#34; alt=&#34;redis-lru&#34;&gt;&lt;/p&gt;
&lt;p&gt;keyè®¿é—®å˜æ›´ç­–ç•¥å€¼(ç”¨äºè®¡ç®—idle)ï¼š&lt;/p&gt;
&lt;p&gt;åœ¨Redisçš„dictä¸­æ¯æ¬¡æŒ‰keyè·å–ä¸€ä¸ªå€¼çš„æ—¶å€™ï¼Œéƒ½ä¼šè°ƒç”¨&lt;code&gt;lookupKey&lt;/code&gt;å‡½æ•°ï¼Œå‰ææ˜¯æ²¡æœ‰forkå‡ºæ¥çš„savingå­è¿›ç¨‹(ä¼šè§¦å‘copy on write)
å¦‚æœé…ç½®ä½¿ç”¨äº†LRUæ¨¡å¼,è¯¥å‡½æ•°&lt;code&gt;LRU_CLOCK&lt;/code&gt;ä¼šæ›´æ–°val-&amp;gt;redisObjectä¸­çš„lruå­—æ®µä¸ºå½“å‰ç§’çº§åˆ«çš„æ—¶é—´æˆ³, åœ¨ä¼°ç®—idle timeçš„æ—¶å€™ï¼Œ&lt;code&gt;estimateObjectIdleTime&lt;/code&gt;ä¼šå†æ¬¡è°ƒç”¨&lt;code&gt;LRU_CLOCK&lt;/code&gt;è·å–æ—¶é—´æˆ³å’Œæœ€è¿‘ä¸€æ¬¡val-&amp;gt;redisObjectä¸­çš„lruç›¸å‡è·å–idleï¼›
ä¸ºåé¢çš„æ ·æœ¬æ± ä¸­è·å–bestKeyæ¥æ·˜æ±°åˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;é‡‡æ ·æ–¹æ³•ï¼š&lt;/p&gt;
&lt;p&gt;éå†æ•°æ®åº“ï¼Œæ ¹æ®æ·˜æ±°ç­–ç•¥ä»dict(æ²¡æœ‰è¿‡æœŸæ—¶é—´çš„key)è¿˜æ˜¯expires(æœ‰è¿‡æœŸæ—¶é—´çš„key)ä¸­è·å–éšæœº&lt;code&gt;maxmemory_samples&lt;/code&gt;ä¸ªæ ·æœ¬ï¼Œæ”¾å…¥&lt;code&gt;static struct evictionPoolEntry *EvictionPoolLRU&lt;/code&gt; poolæ ·æœ¬æ± ä¸­ã€‚æ ·æœ¬æ± ä¸­çš„æ ·æœ¬idleå€¼ä»ä½åˆ°é«˜æ’å…¥æ’åºï¼Œæ•°æ®æ·˜æ±°ç­–ç•¥æ¯æ¬¡é€‰æ‹©idleæœ€é«˜æ•°æ®è¿›è¡Œæ·˜æ±°é‡Šæ”¾(æ ¹æ®é…ç½®æ˜¯å¦å¼€å¯æƒ°æ€§æ·˜æ±°ç­–ç•¥é‡Šæ”¾å¼‚æ­¥é‡Šæ”¾è¿˜æ˜¯åŒæ­¥é‡Šæ”¾)ï¼›æ ·æœ¬æ± å¤§å°æ˜¯&lt;code&gt;EVPOOL_SIZE 16&lt;/code&gt;ï¼Œæ‰€ä»¥é‡‡é›†æ ·æœ¬è¦æ ¹æ®è‡ªå·±çš„idleå€¼å¤§å°æˆ–æ± ä¸­æ˜¯å¦æœ‰ç©ºä½æ¥ç¡®å®šæ˜¯å¦æˆåŠŸæ’å…¥æ ·æœ¬æ± ä¸­ï¼Œå¦‚æœæ± ä¸­æ²¡æœ‰ç©ºä½ï¼Œæˆ–è€…è¢«æ’å…¥æ ·æœ¬çš„idleå€¼éƒ½å°äºæ± å­ä¸­çš„æ•°æ®ï¼Œé‚£æ’å…¥å°†ä¼šå¤±è´¥ï¼›è¿™æ ·æ ·æœ¬æ± ä¸­ä¸€è‡´å­˜æ”¾idleæœ€å¤§ï¼Œæœ€å¤§å‡ ç‡è¢«æ·˜æ±°çš„key(sds)æ ·æœ¬(é€šè¿‡keyæ‰¾åˆ°dictEntryä¸­çš„val-&amp;gt;redisObject å»é‡Šæ”¾)ã€‚&lt;/p&gt;
&lt;p&gt;Idleè·å–ï¼š&lt;/p&gt;
&lt;p&gt;å¦‚æœæ˜¯LRUç­–ç•¥ï¼šestimateObjectIdleTime(o)  è·å–redisObject çš„ idle æ—¶é—´ï¼Œä¸€ä¸ªkeyç»å¸¸è¢«è®¿é—®ï¼Œé‚£ä¹ˆè¯¥keyçš„idle timeåº”è¯¥æ˜¯æœ€å°ï¼›
å¦‚æœæ˜¯LFUç­–ç•¥ï¼š255-LFUDecrAndReturn(o) æœ€å¤§ä½¿ç”¨é¢‘ç‡255å‡å»redisObjectçš„ä½¿ç”¨é¢‘ç‡ï¼Œæ‰€ä»¥æœ€å°ä½¿ç”¨é¢‘ç‡ï¼Œidleè¶Šå¤§ï¼›
å¦‚æœæ˜¯å·²è¿‡æœŸä¸­æ·˜æ±°ç­–ç•¥ï¼š ULLONG_MAX - (long)dictGetVal(de);  è¿‡æœŸè¶Šæ—©è¶Šå¥½ï¼›
poolä¸­æŒ‰idleä»å°åˆ°å¤§æ’å…¥æ’åºï¼Œä¾¿äºè·å–bestKey,ç”¨äºåˆ é™¤ã€‚&lt;/p&gt;
&lt;p&gt;æ·˜æ±°åˆ é™¤ç­–ç•¥ï¼š&lt;/p&gt;
&lt;p&gt;å¦‚æœå¼€å¯æƒ°æ€§æ·˜æ±°ç­–ç•¥ï¼Œåˆ™ä½¿ç”¨dbAsyncDelete å¼‚æ­¥å›æ”¶åªé‡Šæ”¾key, ä¸ä¼šå¯¹ä¸»çº¿ç¨‹é€ æˆè¿‡å¤§çš„è´Ÿæ‹…ï¼Œå¦åˆ™ä½¿ç”¨dbSyncDeleteåŒæ­¥å›æ”¶ï¼›
å¼‚æ­¥å›æ”¶å¦‚æœé‡Šæ”¾å¯¹è±¡æ•°ç›®&amp;gt;64, å°†å¯¹è±¡åˆ›å»ºjobåŠ å…¥lazy free listï¼›é€šçŸ¥&lt;code&gt;signal type: bio_lazy_free&lt;/code&gt;å›æ”¶å¤„ç†çº¿ç¨‹è¿›è¡Œå›æ”¶ï¼›
è¿™ä¸¤ç§æ“ä½œéƒ½æ˜¯ä¼šå°†keyä»æ•°æ®åº“çš„é”®ç©ºé—´ä¸­ç§»é™¤ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±åœ¨äºï¼Œå¯¹valueæ•°æ®çš„é‡Šæ”¾ï¼Œæ˜¯åŒæ­¥æ“ä½œè¿˜æ˜¯å¼‚æ­¥æ“ä½œã€‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/redis/redis/blob/79ac57561f268814babe212c9216efe45cfdf937/src/server.c#L5330&#34;&gt;è§¦å‘ä»£ç åœ¨server.cä¸­&lt;/a&gt;ï¼šactiveExpireCycle performEvictions å‡½æ•° åœ¨ &lt;a href=&#34;https://github.com/redis/redis/blob/b71c5849e3e5c040b029c6e25cec2069d70760c1/README.md#serverc&#34;&gt;server.c&lt;/a&gt; readmeä¸­æœ‰ä»‹ç»ä»€ä¹ˆæ—¶å€™è§¦å‘ã€‚&lt;/p&gt;
&lt;h3 id=&#34;mysql80-innodb-page-buffer-pool-lru-evictç­–ç•¥&#34;&gt;Mysql8.0 InnoDB page buffer pool LRU evictç­–ç•¥&lt;/h3&gt;
&lt;h4 id=&#34;é¡µpage&#34;&gt;é¡µPage&lt;/h4&gt;
&lt;p&gt;æ•°æ®åº“çš„æ•°æ®æ˜¯æ”¾åœ¨ç£ç›˜ç©ºé—´ä»¥è¡¨ç©ºé—´å­˜æ”¾çš„ï¼ŒåŠ è½½çš„æ—¶å€™ä»¥é¡µpageä¸ºå•ä½è¿›è¡ŒåŠ è½½ï¼Œé¡µæ˜¯InnoDBå­˜å‚¨å¼•æ“ç£ç›˜ç®¡ç†çš„æœ€å°å•ä½ï¼Œæ¯ä¸ªé¡µé»˜è®¤16KBï¼›å¯ä»¥é€šè¿‡å‚æ•°innodb_page_sizeè®¾ç½®(ä¸€ä¸ªé¡µå†…å¿…é¡»å­˜å‚¨2è¡Œè®°å½•ï¼Œå¦åˆ™å°±ä¸æ˜¯B+treeï¼Œè€Œæ˜¯é“¾è¡¨äº†)ï¼Œé¡µé¢ç±»å‹ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æ•°æ®é¡µï¼ˆB-tree Nodeï¼‰&lt;/p&gt;
&lt;p&gt;undoé¡µï¼ˆundo Log Pageï¼‰&lt;/p&gt;
&lt;p&gt;ç³»ç»Ÿé¡µï¼ˆSystem Pageï¼‰&lt;/p&gt;
&lt;p&gt;äº‹åŠ¡æ•°æ®é¡µï¼ˆTransaction system Pageï¼‰&lt;/p&gt;
&lt;p&gt;æ’å…¥ç¼“å†²ä½å›¾é¡µï¼ˆInsert Buffer Pageï¼‰&lt;/p&gt;
&lt;p&gt;æ’å…¥ç¼“å†²ç©ºé—²åˆ—è¡¨é¡µï¼ˆInsert Buffer Free Listï¼‰&lt;/p&gt;
&lt;p&gt;æœªå‹ç¼©çš„äºŒè¿›åˆ¶å¤§å¯¹è±¡é¡µï¼ˆUncompressd BLOB Pageï¼‰&lt;/p&gt;
&lt;p&gt;å‹ç¼©çš„äºŒè¿›åˆ¶å¤§å¯¹è±¡é¡µï¼ˆCompressd BLOB Pageï¼‰&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;img src=&#34;https://blogstatic.haohtml.com/uploads/2019/08/innodb_engine_struct.png&#34; alt=&#34;innodb_engine_struct&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»InnoDBå­˜å‚¨å¼•æ“çš„é€»è¾‘ç»“æ„çœ‹ï¼Œæ‰€æœ‰æ•°æ®éƒ½è¢«é€»è¾‘åœ°å­˜æ”¾åœ¨ä¸€ä¸ªç©ºé—´å†…ï¼Œç§°ä¸ºè¡¨ç©ºé—´(tablespace)ï¼Œè€Œè¡¨ç©ºé—´ç”±æ®µï¼ˆsengmentï¼‰ã€åŒºï¼ˆextentï¼‰ã€é¡µï¼ˆpageï¼‰ç»„æˆã€‚ åœ¨ä¸€äº›æ–‡æ¡£ä¸­extendåˆç§°å—ï¼ˆblockï¼‰ã€‚è¿™é‡Œæœ‰å‡ ä¸ªæ¦‚å¿µç®€å•ä»‹ç»ä¸‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¡¨ç©ºé—´ï¼ˆTablespaceï¼‰&lt;/strong&gt; æ˜¯ä¸€ä¸ªé€»è¾‘å®¹å™¨ï¼Œè¡¨ç©ºé—´å­˜å‚¨çš„å¯¹è±¡æ˜¯æ®µï¼Œåœ¨ä¸€ä¸ªè¡¨ç©ºé—´ä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ®µï¼Œä½†æ˜¯ä¸€ä¸ªæ®µåªèƒ½å±äºä¸€ä¸ªè¡¨ç©ºé—´ã€‚æ•°æ®åº“ç”±ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨ç©ºé—´ç»„æˆï¼Œè¡¨ç©ºé—´ä»ç®¡ç†ä¸Šå¯ä»¥åˆ’åˆ†ä¸º&lt;a href=&#34;https://dev.mysql.com/doc/refman/5.7/en/innodb-system-tablespace.html&#34;&gt;ç³»ç»Ÿè¡¨ç©ºé—´&lt;/a&gt;ã€&lt;a href=&#34;https://dev.mysql.com/doc/refman/5.7/en/innodb-file-per-table-tablespaces.html&#34;&gt;File-per-table è¡¨ç©ºé—´&lt;/a&gt;ã€&lt;a href=&#34;https://dev.mysql.com/doc/refman/5.7/en/general-tablespaces.html&#34;&gt;é€šç”¨è¡¨ç©ºé—´&lt;/a&gt;ã€&lt;a href=&#34;https://dev.mysql.com/doc/refman/5.7/en/innodb-undo-tablespaces.html&#34;&gt;æ’¤é”€è¡¨ç©ºé—´&lt;/a&gt;ã€&lt;a href=&#34;https://dev.mysql.com/doc/refman/5.7/en/innodb-temporary-tablespace.html&#34;&gt;ä¸´æ—¶è¡¨ç©ºé—´&lt;/a&gt;ã€‚(è¡¨ç©ºé—´æ–‡ä»¶å¯ä»¥é€šè¿‡xxdè¿›è¡Œåˆ†æ)&lt;/p&gt;
&lt;p&gt;åœ¨ InnoDB ä¸­å­˜åœ¨ä¸¤ç§è¡¨ç©ºé—´çš„ç±»å‹ï¼šå…±äº«è¡¨ç©ºé—´(ä¾‹å¦‚ç³»ç»Ÿè¡¨ç©ºé—´æˆ–é€šç”¨è¡¨ç©ºé—´)å’Œç‹¬ç«‹è¡¨ç©ºé—´(File-per-table è¡¨ç©ºé—´)ã€‚å¦‚æœæ˜¯å…±äº«è¡¨ç©ºé—´å°±æ„å‘³ç€å¤šå¼ è¡¨å…±ç”¨ä¸€ä¸ªè¡¨ç©ºé—´ã€‚å¦‚æœæ˜¯ç‹¬ç«‹è¡¨ç©ºé—´ï¼Œå°±æ„å‘³ç€æ¯å¼ è¡¨æœ‰ä¸€ä¸ªç‹¬ç«‹çš„è¡¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯æ•°æ®å’Œç´¢å¼•ä¿¡æ¯éƒ½ä¼šä¿å­˜åœ¨è‡ªå·±çš„è¡¨ç©ºé—´ä¸­ã€‚ç‹¬ç«‹çš„è¡¨ç©ºé—´å¯ä»¥åœ¨ä¸åŒçš„æ•°æ®åº“ä¹‹é—´è¿›è¡Œè¿ç§»ã€‚ç¦ç”¨&lt;a href=&#34;https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_file_per_table&#34;&gt;&lt;code&gt;innodb_file_per_table&lt;/code&gt;&lt;/a&gt; ä¼šåœ¨ç³»ç»Ÿè¡¨ç©ºé—´ä¸­åˆ›å»ºè¡¨ã€‚&lt;/p&gt;
&lt;p&gt;mysql8.0 InnoDBå­˜å‚¨å¼•æ“å¯¹ç£ç›˜ç»“æ„ä¸­çš„è¡¨ç©ºé—´æ“ä½œæœ‰äº›æ”¹å˜ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;8.0ç‰ˆæœ¬ä¸­ï¼Œç³»ç»Ÿè¡¨ç©ºé—´åªæ˜¯æ›´æ”¹ç¼“å†²åŒºçš„å­˜å‚¨åŒºåŸŸï¼›ä»¥å‰ç‰ˆæœ¬æ˜¯InnoDBæ•°æ®å­—å…¸ã€åŒå†™ç¼“å†²åŒºã€æ›´æ”¹ç¼“å†²åŒºå’Œæ’¤æ¶ˆæ—¥å¿—çš„å­˜å‚¨åŒºåŸŸ ã€‚(å¦‚æœè¡¨æ˜¯åœ¨ç³»ç»Ÿè¡¨ç©ºé—´ä¸­åˆ›å»ºçš„ï¼Œè€Œä¸æ˜¯åœ¨æ¯ä¸ªè¡¨æ–‡ä»¶æˆ–é€šç”¨è¡¨ç©ºé—´ä¸­åˆ›å»ºï¼Œåˆ™å®ƒè¿˜å¯èƒ½åŒ…å«è¡¨å’Œç´¢å¼•æ•°æ®)&lt;/li&gt;
&lt;li&gt;åœ¨8.0ä»¥å‰çš„ MySQL ç‰ˆæœ¬ä¸­ï¼Œç³»ç»Ÿè¡¨ç©ºé—´åŒ…å«InnoDBæ•°æ®å­—å…¸mysql.* ã€‚åœ¨ MySQL 8.0 ä¸­InnoDBå°†å…ƒæ•°æ®å­˜å‚¨åœ¨ MySQL æ•°æ®å­—å…¸è¡¨ç©ºé—´ä¸­ï¼Œè¡¨ç»“æ„ç­‰æ•°æ®å­—å…¸å…ƒæ•°æ®éƒ½æ˜¯é€šè¿‡InnoDBæ¥ç®¡ç†(mysql.ibdæˆ–è€…ç‹¬ç«‹è¡¨ç©ºé—´*.ibdæ–‡ä»¶ä¸­ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ MySQL 8.0.20 ä¹‹å‰ï¼Œdoublewrite ç¼“å†²åŒºå­˜å‚¨åŒºä½äºInnoDBç³»ç»Ÿè¡¨ç©ºé—´ä¸­ï¼›ä» MySQL 8.0.20 å¼€å§‹ï¼ŒåŒå†™ç¼“å†²åŒºå­˜å‚¨åŒºåŸŸä½äºåŒå†™æ–‡ä»¶ä¸­ã€‚é™„ä¸Šå®˜æ–¹mysql8.0 InnoDBå­˜å‚¨å¼•æ“æ¶æ„å›¾(å¯¹æ¯” &lt;a href=&#34;https://dev.mysql.com/doc/refman/5.7/en/innodb-architecture.html&#34;&gt;5.7ç‰ˆæœ¬æ¶æ„&lt;/a&gt;)ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;img src=&#34;https://dev.mysql.com/doc/refman/8.0/en/images/innodb-architecture.png&#34; alt=&#34;innodb-architecture&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ®µï¼ˆSegmentï¼‰&lt;/strong&gt; ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåŒºç»„æˆï¼ŒåŒºåœ¨æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªè¿ç»­åˆ†é…çš„ç©ºé—´ï¼ˆåœ¨ InnoDB ä¸­æ˜¯è¿ç»­çš„ 64 ä¸ªé¡µï¼‰ï¼Œä¸è¿‡åœ¨æ®µä¸­ä¸è¦æ±‚åŒºä¸åŒºä¹‹é—´æ˜¯ç›¸é‚»çš„ã€‚æ®µæ˜¯æ•°æ®åº“ä¸­çš„åˆ†é…å•ä½ï¼Œä¸åŒç±»å‹çš„æ•°æ®åº“å¯¹è±¡ä»¥ä¸åŒçš„æ®µå½¢å¼å­˜åœ¨ã€‚å½“æˆ‘ä»¬åˆ›å»ºæ•°æ®è¡¨ã€ç´¢å¼•çš„æ—¶å€™ï¼Œå°±ä¼šç›¸åº”åˆ›å»ºå¯¹åº”çš„æ®µï¼Œæ¯”å¦‚åˆ›å»ºä¸€å¼ è¡¨æ—¶ä¼šåˆ›å»ºä¸€ä¸ªè¡¨æ®µï¼Œåˆ›å»ºä¸€ä¸ªç´¢å¼•æ—¶ä¼šåˆ›å»ºä¸€ä¸ªç´¢å¼•æ®µã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŒºï¼ˆextentï¼‰&lt;/strong&gt; åœ¨ InnoDB å­˜å‚¨å¼•æ“ä¸­ï¼Œä¸€ä¸ªåŒºä¼šåˆ†é… 64 ä¸ªè¿ç»­çš„é¡µã€‚å› ä¸º InnoDB ä¸­çš„é¡µå¤§å°é»˜è®¤æ˜¯ 16KBï¼Œæ‰€ä»¥ä¸€ä¸ªåŒºçš„å¤§å°æ˜¯ 64*16KB=1MBã€‚åœ¨ä»»ä½•æƒ…å†µä¸‹æ¯ä¸ªåŒºå¤§å°éƒ½ä¸º1MBï¼Œä¸ºäº†ä¿è¯é¡µçš„è¿ç»­æ€§ï¼ŒInnoDBå­˜å‚¨å¼•æ“æ¯æ¬¡ä»ç£ç›˜ä¸€æ¬¡ç”³è¯·4-5ä¸ªåŒºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒInnoDBå­˜å‚¨å¼•æ“çš„é¡µå¤§å°ä¸º16KBï¼Œå³ä¸€ä¸ªåŒºä¸­æœ‰64ä¸ªè¿ç»­çš„é¡µã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;é¡µï¼ˆpageï¼‰&lt;/strong&gt; æ˜¯InnoDBå­˜å‚¨å¼•æ“ç£ç›˜ç®¡ç†çš„æœ€å°å•ä½ï¼Œæ¯ä¸ªé¡µé»˜è®¤16KBï¼Œé¡µç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blogstatic.haohtml.com/uploads/2019/08/1d49c975639e53fe92466f0b1ebe2b2a99672e8b-1024x828.jpeg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;Page directory é¡µç›®å½•ç”¨æ¥å­˜å‚¨æ¯ç»„æœ€åä¸€æ¡è®°å½•çš„åœ°å€åç§»é‡ï¼Œè¿™äº›åœ°å€åç§»é‡ä¼šæŒ‰ç…§å…ˆåé¡ºåºå­˜å‚¨èµ·æ¥ï¼Œæ¯ç»„çš„åœ°å€åç§»é‡ä¹Ÿè¢«ç§°ä¹‹ä¸ºæ§½ï¼ˆslotï¼‰ï¼Œæ¯ä¸ªæ§½ç›¸å½“äºæŒ‡é’ˆæŒ‡å‘äº†ä¸åŒç»„çš„æœ€åä¸€ä¸ªè®°å½•ï¼Œè¿™æ ·æ–¹ä¾¿äºŒåˆ†æŸ¥æ‰¾å¿«é€Ÿå®šä½åˆ°è®°å½•ï¼›&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://blogstatic.haohtml.com/uploads/2019/08/innodb-page-dir-1024x959.jpg&#34; alt=&#34;page-slot&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;è¡Œï¼ˆrowï¼‰&lt;/strong&gt; InnoDBå­˜å‚¨å¼•æ“æ˜¯æŒ‰è¡Œè¿›è¡Œå­˜æ”¾çš„ï¼Œæ¯ä¸ªé¡µå­˜æ”¾çš„è¡Œè®°å½•ä¹Ÿæ˜¯æœ‰ç¡¬æ€§å®šä¹‰çš„ï¼Œæœ€å¤šå…è®¸å­˜æ”¾16KB/2-200ï¼Œå³7992è¡Œè®°å½•ã€‚&lt;a href=&#34;https://dev.mysql.com/doc/refman/8.0/en/innodb-row-format.html&#34;&gt;InnoDB è¡Œæ ¼å¼&lt;/a&gt;æ”¯æŒå››åçš„æ ¼å¼ï¼šREDUNDANTï¼ŒCOMPACTï¼Œ DYNAMICï¼Œå’ŒCOMPRESSEDï¼Œé»˜è®¤DYNAMIC&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;B+ æ ‘æ˜¯å¦‚ä½•è¿›è¡Œè®°å½•æ£€ç´¢çš„ï¼Ÿ&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœé€šè¿‡ B+ æ ‘çš„ç´¢å¼•æŸ¥è¯¢è¡Œè®°å½•ï¼Œé¦–å…ˆæ˜¯ä» B+ æ ‘çš„æ ¹å¼€å§‹ï¼Œé€å±‚æ£€ç´¢ï¼Œç›´åˆ°æ‰¾åˆ°&lt;strong&gt;å¶å­èŠ‚ç‚¹&lt;/strong&gt;ï¼Œä¹Ÿå°±æ˜¯æ‰¾åˆ°å¯¹åº”çš„&lt;strong&gt;æ•°æ®é¡µ&lt;/strong&gt;ä¸ºæ­¢ï¼Œå¦‚æœæ•°æ®é¡µæ²¡åœ¨ç¼“å†²æ± ä¸­ï¼Œå°†æ•°æ®é¡µåŠ è½½åˆ°å†…å­˜ &lt;strong&gt;ç¼“å†²æ± (buffer pool)&lt;/strong&gt; ä¸­ï¼Œé¡µç›®å½•ä¸­çš„ &lt;strong&gt;æ§½(slot)&lt;/strong&gt; é‡‡ç”¨äºŒåˆ†æŸ¥æ‰¾çš„æ–¹å¼å…ˆæ‰¾åˆ°ä¸€ä¸ªç²—ç•¥çš„&lt;strong&gt;è®°å½•åˆ†ç»„&lt;/strong&gt;ï¼Œç„¶åå†åœ¨åˆ†ç»„ä¸­é€šè¿‡é“¾è¡¨éå†çš„æ–¹å¼æŸ¥æ‰¾&lt;strong&gt;è®°å½•&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h4 id=&#34;ç¼“å†²æ± buffer-pool--lruunzip_lru-é“¾è¡¨&#34;&gt;ç¼“å†²æ± (buffer pool)  LRU/unzip_LRU é“¾è¡¨&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;ç¼“å†²æ± (buffer pool)&lt;/strong&gt; æ˜¯ä¸»å†…å­˜ä¸­çš„ä¸€ä¸ªåŒºåŸŸï¼Œç”¨äºåœ¨ &lt;code&gt;InnoDB&lt;/code&gt;è®¿é—®æ—¶ç¼“å­˜è¡¨å’Œç´¢å¼•æ•°æ®ã€‚ç¼“å†²æ± å…è®¸ç›´æ¥ä»å†…å­˜è®¿é—®ç»å¸¸ä½¿ç”¨çš„æ•°æ®ï¼Œä»è€ŒåŠ å¿«å¤„ç†é€Ÿåº¦ã€‚åœ¨ä¸“ç”¨æœåŠ¡å™¨ä¸Šï¼Œå¤šè¾¾ 80% çš„ç‰©ç†å†…å­˜é€šå¸¸åˆ†é…ç»™ç¼“å†²æ± ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚æœ‰å¦‚ä¸‹ åœºæ™¯ï¼Œä¸€ä¸ªç›´æ’­é—´idä¸º1çš„è§‚çœ‹äººæ•°ä¸Šç™¾ä¸‡ï¼Œå‡å¦‚è¿è¥åå°éœ€è¦æŸ¥æ‰¾å…¨éƒ¨æ•°æ®ï¼Œï¼ˆè¿™é‡Œå‡è®¾æ²¡æœ‰é€šè¿‡CQRSæ¨¡å¼å°†æ•°æ®æ”¾å…¥ESä¸­ï¼ŒESæŸ¥è¯¢ç¼“å­˜ä¹Ÿç”¨åˆ°äº†LRU, å¯ä»¥å‚è€ƒè¿™ç¯‡&lt;a href=&#34;https://www.easyice.cn/archives/367&#34;&gt;Elasticsearch çš„æŸ¥è¯¢ç¼“å­˜&lt;/a&gt;ï¼‰&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;select * from room_student_history where room_id=1  and id&amp;gt;=(select id from room_student_history where order by id limit 1000000,1) order by id limit 1000&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¦‚æœroom_student_historyä¸­æœ‰å¤§é‡é•¿å°¾ç”¨æˆ·æ•°æ®å¹¶ä¸”è¯»å–ä¹‹åä¸ä¼šç»§ç»­ä½¿ç”¨,åˆ™LRUå¤´éƒ¨ä¼šè¢«å¤§é‡çš„room_student_historyä¸­çš„æ•°æ®å æ®ã€‚è¿™æ ·ä¼šé€ æˆçƒ­ç‚¹æ•°æ®è¢«é€å‡ºç¼“å­˜ä»è€Œå¯¼è‡´å¤§é‡çš„ç£ç›˜io ;&lt;/p&gt;
&lt;p&gt;mysql innodbçš„buffer poolä½¿ç”¨äº†ä¸€ç§æ”¹è¿›çš„LRUç®—æ³•ï¼Œå¤§æ„æ˜¯å°†LRUé“¾è¡¨åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä¸ºnewlist,ä¸€éƒ¨åˆ†ä¸ºoldlist,newlistæ˜¯å¤´éƒ¨çƒ­ç‚¹æ•°æ®ï¼Œoldlistæ˜¯éçƒ­ç‚¹æ•°æ®,oldlisté»˜è®¤å æ•´ä¸ªlisté•¿åº¦çš„3/8.å½“åˆæ¬¡åŠ è½½ä¸€ä¸ªpageçš„æ—¶å€™ï¼Œä¼šé¦–å…ˆæ”¾å…¥oldlistçš„å¤´éƒ¨ï¼Œåªæœ‰æ»¡è¶³ä¸€å®šæ¡ä»¶åï¼Œæ‰è¢«ç§»åˆ°new listä¸Šï¼Œä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢é¢„è¯»çš„æ•°æ®é¡µå’Œå…¨è¡¨æ‰«ææ±¡æŸ“buffer poolã€‚è¯¦ç»†ä»‹ç»è§&lt;a href=&#34;https://dev.mysql.com/doc/refman/8.0/en/innodb-buffer-pool.html&#34;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://dev.mysql.com/doc/refman/8.0/en/images/innodb-buffer-pool-list.png&#34; alt=&#34;innodb-buffer-pool&#34;&gt;&lt;/p&gt;
&lt;p&gt;é™„macä¸‹æŠŠç©æ“ä½œï¼šï¼ˆå•æœºå®ä¾‹ï¼Œé€šè¿‡brewåˆ‡æ¢ç‰ˆæœ¬æœåŠ¡æŒºæ–¹ä¾¿çš„ï¼›ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–é…ç½®: é«˜å¯ç”¨ï¼Œæ€§èƒ½ä¼˜åŒ–ç¨³å®šç­‰é…ç½®ï¼‰&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;brew install &lt;a href=&#34;mailto:mysql@5.7&#34;&gt;mysql@5.7&lt;/a&gt; //å®‰è£…5.7ç‰ˆæœ¬&lt;/li&gt;
&lt;li&gt;brew services start &lt;a href=&#34;mailto:mysql@5.7&#34;&gt;mysql@5.7&lt;/a&gt; //å¯åŠ¨5.7ç‰ˆæœ¬mysqld,mysqld_safe&lt;/li&gt;
&lt;li&gt;å»ºè¡¨ï¼ŒæŸ¥çœ‹/usr/local/var/mysql ç›®å½•ä¸‹çš„æ•°æ®æ–‡ä»¶ï¼Œå¯ä»¥å¯¹ç…§ &lt;a href=&#34;https://dev.mysql.com/doc/refman/5.7/en/innodb-architecture.html&#34;&gt;5.7ç‰ˆæœ¬æ¶æ„&lt;/a&gt; æŸ¥çœ‹è¡¨ç©ºé—´æ–‡ä»¶ï¼›&lt;/li&gt;
&lt;li&gt;å†™äº›æ•°æ®ï¼ŒæŸ¥çœ‹ç›¸å…³æ•°æ®æ–‡ä»¶çš„æ•°æ®å˜åŒ–ï¼Œ é€šè¿‡ xxd/hexdump ä»¥åå…­è¿›åˆ¶çš„æ–¹å¼æŸ¥çœ‹è¡¨ç©ºé—´äºŒè¿›åˆ¶æ–‡ä»¶*.ibdç­‰&lt;/li&gt;
&lt;li&gt;brew install mysql //å®‰è£…æœ€æ–°ç‰ˆæœ¬8.0&lt;/li&gt;
&lt;li&gt;brew services stop &lt;a href=&#34;mailto:mysql@5.7&#34;&gt;mysql@5.7&lt;/a&gt;  //åœæ­¢mysql@5.7æœåŠ¡&lt;/li&gt;
&lt;li&gt;brew services start mysql //å¯åŠ¨8.0ç‰ˆæœ¬mysqld,mysqld_safe&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹/usr/local/var/mysql ç›®å½•ä¸‹çš„æ•°æ®æ–‡ä»¶, å¯¹æ¯”5.7ç‰ˆæœ¬çš„æ–‡ä»¶å˜åŒ–ï¼Œæ–°å¢äº†å“ªäº›æ–‡ä»¶åˆ†å¼€ç®¡ç†, ä»¥åŠå¯¹æ•°æ®å­—å…¸çš„å˜åŒ–&lt;/li&gt;
&lt;li&gt;/usr/local/opt/mysql/bin/ibd2sdi (utilities/ibd2sdi.ccæ–‡ä»¶)  æŸ¥çœ‹ibdæ–‡ä»¶ä¸­çš„å­—å…¸åºåˆ—åŒ–ä¿¡æ¯,mysqlbinlog binlog.* æ‰“å°binlo gä¿¡æ¯&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯å‘½ä»¤æ‰§è¡Œshow VARIABLES like &amp;ldquo;%Innodb%&amp;quot;; show status like &amp;ldquo;%Innodb%&amp;quot;; æŸ¥çœ‹Innodbå‚æ•°å’ŒçŠ¶æ€ç»Ÿè®¡ï¼›&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯å‘½ä»¤æ‰§è¡Œ  SHOW ENGINE INNODB STATUS; æŸ¥çœ‹æ•´ä½“è¿è¡ŒçŠ¶æ€ç›‘æ§æ•°æ®(io,thread, buffer pool memory, SEMAPHORES, TRANSACTIONS,INSERT BUFFER AND ADAPTIVE HASH INDEX,LOG,ROW OPERATIONS)&lt;/li&gt;
&lt;li&gt;å®¢æˆ·ç«¯æ‰§è¡Œå‘½ä»¤ï¼Œé€šè¿‡dtruss -p  æŸ¥çœ‹mysqldè¿›ç¨‹å¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨&lt;/li&gt;
&lt;li&gt;ç›¸å…³çš„å‚æ•°å¯ä»¥ä»å®˜ç½‘æŸ¥çœ‹ä»‹ç»&lt;a href=&#34;https://dev.mysql.com/doc/refman/8.0/en/server-option-variable-reference.html&#34;&gt;Server Option, System Variable, and Status Variable Reference&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ä¸‹è½½æºç  &lt;a href=&#34;https://github.com/mysql/mysql-server&#34;&gt;https://github.com/mysql/mysql-server&lt;/a&gt; 8.0 ç‰ˆæœ¬åˆ†æ”¯ï¼Œdownload zipæ–‡ä»¶ï¼Œè§£å‹ï¼Œç¼–è¯‘ï¼Œè¿è¡Œï¼Œgdb debug&lt;/li&gt;
&lt;li&gt;é€šè¿‡dockeræ¥éƒ¨ç½²ï¼š &lt;a href=&#34;https://hub.docker.com/_/mysql&#34;&gt;https://hub.docker.com/_/mysql&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;â€‹	ç¼“/å†…å­˜ioæ¯”ç£ç›˜ioå¿«è®¸å¤šï¼Œä½†æ˜¯ç¼“/å†…å­˜ç©ºé—´æœ‰é™ï¼Œä¸”æ— æ³•æŒä¹…åŒ–ï¼Œæ‰€ä»¥éœ€è¦æä¾›ç¼“/å†…å­˜æ·˜æ±°æœºåˆ¶æ¥ä¿è¯ç¼“/å†…å­˜ä½¿ç”¨å‘½ä¸­ç‡ï¼Œæœ¬æ–‡ä»‹ç»å¸¸ç”¨çš„LRUç®—æ³•ï¼›golangå®ç°çš„å¼€æºæ–¹æ¡ˆï¼Œå¯ä»¥ç»“åˆä¸šåŠ¡åœºæ™¯ï¼Œè¿›è¡Œä½¿ç”¨ï¼Œredis ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œé€šè¿‡æŠ½æ ·å°†æ·˜æ±°çš„æ•°æ®æ”¾å…¥å¾…æ·˜æ±°æ•°æ®æ± (evictionPoolEntry) è¿›è¡Œæ·˜æ±°ï¼Œåœ¨ Redis 3.0 ä¸­ä½¿ç”¨ 10 ä¸ªæ ·æœ¬å¤§å°ï¼Œè¯¥è¿‘ä¼¼å€¼éå¸¸æ¥è¿‘ Redis 3.0 çš„åŸå§‹LRUç†è®ºæ€§èƒ½ã€‚mysql éœ€è¦å……åˆ†åˆ©ç”¨ç¼“å­˜æ± èµ„æºï¼Œå‡å°‘ç£ç›˜io, å› ä¸ºåŠ è½½å•å…ƒæ˜¯page, å¦‚æœç¬¬ä¸€æ¬¡åŠ è½½æ”¾å…¥LRUé“¾è¡¨å¤´ï¼Œå¯èƒ½è¿™äº›æ•°æ®ä½¿ç”¨é¢‘ç‡ä¸é«˜ï¼Œå¯¼è‡´ç¼“å­˜æ± å‘½ä¸­ç‡ä½ï¼Œå°†LRUé“¾è¡¨æŒ‰3/8åˆ†æˆold list å’Œnew list , ç¬¬ä¸€æ¬¡åŠ è½½æ”¾å…¥oldListå¤´ï¼Œå†æ¬¡è®¿é—®æ—¶æ‰ä¼šç§»åŠ¨åˆ°newlistã€‚æ ¹æ®æ·˜æ±°çš„ç»“æ„ï¼Œæ ¹æ®æ•°æ®ä½¿ç”¨åœºæ™¯ï¼Œå°†LRUç®—æ³•ä¼˜åŒ–, rediså’Œmysql éƒ½ç”¨åˆ°äº†pool, ä½†æ˜¯æ˜¯ä¸¤ç§åœºæ™¯ï¼Œredisæ˜¯ä¸ºäº†æ·˜æ±°é‡Šæ”¾ä½¿ç”¨æ ·æœ¬pool, æ ·æœ¬æ± ä¸­æ”¾å…¥çš„æ˜¯idleå€¼ï¼Œæ ¹æ®ä¸åŒç­–ç•¥ç®—å‡ºçš„å€¼ï¼Œç”¨æ¥æ·˜æ±°æœ€å¤§çš„idle, æ–¹ä¾¿æ‰©å±•ä¼˜åŒ–ç®—æ³•ï¼› mysql ä¸­çš„poolæ˜¯buffer pool ç¼“å†²æ± ï¼Œä¸»è¦æ˜¯ä¸ºäº†å­˜æ”¾page, page æ˜¯innodbç£ç›˜ç®¡ç†çš„æœ€å°å•ä½ï¼Œä¸ºäº†å‡å°‘ç£ç›˜io, å°½é‡å‡å°‘ç¼“å­˜miss, å¢åŠ hitç‡ï¼Œæé«˜è¯»å†™æ“ä½œæ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h2 id=&#34;references&#34;&gt;references&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Cache_replacement_policies#Least_recently_used_(LRU)&#34;&gt;Cache_replacement_policies#Least_recently_used_(LRU)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Adaptive_replacement_cache&#34;&gt;Adaptive_replacement_cache&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Page_replacement_algorithm&#34;&gt;Page_replacement_algorithm&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://antirez.com/news/109&#34;&gt;Random notes on improving the Redis LRU algorithm&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://redis.io/topics/lru-cache&#34;&gt;Using Redis as an LRU cache&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://brenocon.com/dean_perf.html&#34;&gt;Numbers Everyone Should Know&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://videolectures.net/wsdm09_dean_cblirs/&#34;&gt;Challenges in Building Large-Scale Information Retrieval Systems&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://dev.mysql.com/doc/refman/8.0/en/innodb-buffer-pool.html&#34;&gt;mysql8.0 innodb-buffer-pool&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://dev.mysql.com/doc/dev/mysql-server/latest/buf0lru_8cc.html&#34;&gt;mysql8.0 source code buf0lru.cc File Reference&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://mysql.taobao.org/monthly/2017/11/05/&#34;&gt;MySQL Â· æºç åˆ†æ Â· InnoDB LRU Liståˆ·è„æ”¹è¿›ä¹‹è·¯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://mysql.taobao.org/monthly/2017/05/01/&#34;&gt;MySQL Â· å¼•æ“ç‰¹æ€§ Â· InnoDB Buffer Pool&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://mysql.taobao.org/monthly/2021/01/06/&#34;&gt;MySQL Â· æºç é˜…è¯» Â· Innodbå†…å­˜ç®¡ç†è§£æ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://dev.mysql.com/doc/internals/en/&#34;&gt;MySQL Internals Manual&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://dev.mysql.com/doc/refman/8.0/en/server-option-variable-reference.html&#34;&gt;Server Option, System Variable, and Status Variable Reference&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
      
    </item>
    
    <item>
      <title>æœåŠ¡æ”¹é€ ç®€è¿°</title>
      <link>https://weedge.github.io/post/servicetransformation/</link>
      <pubDate>Tue, 26 Oct 2021 22:04:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/servicetransformation/</guid>
      
        <description>&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;p&gt;éšç€å‰æœŸä¸šåŠ¡è¿­ä»£ä¸æ–­å¢å¤šï¼Œä¼šç•™ä¸‹ä¸€äº›æŠ€æœ¯å€ºåŠ¡ï¼›ç”¨æˆ·ä¸æ–­ç´¯è®¡å¢åŠ ï¼Œæ•´ä½“DAU,MAU,PV/UVçš„ä¸æ–­ä¸Šå‡ï¼Œä¸ºäº†ç¬¦åˆæ ¹æ®ç»„ç»‡ç»“æ„å’Œä¸šåŠ¡éœ€æ±‚æ›´åŠ ç¨³å®šå¥åº·çš„å‘å±•ï¼Œéœ€è¦å¯¹ä¸šåŠ¡æœåŠ¡è¿›è¡Œæ”¹é€ /é‡æ„ï¼›é‡‡ç”¨å›¢é˜Ÿé€‚åˆçš„è¯­è¨€å¼€å‘ï¼Œå°†æœåŠ¡è¿›è¡Œåˆ†å±‚ï¼ŒæŠ½è±¡åº•å±‚æ¨¡å‹ï¼Œåˆ†ç¦»å‡ºä¸å˜/æ˜“å˜ä¸šåŠ¡é€»è¾‘ï¼›ä¸šåŠ¡æ”¹é€ å’ŒåŸºç¡€å»ºè®¾æœåŠ¡å‡çº§ï¼ˆæ•´ä½“ç³»ç»Ÿè®¤çŸ¥çš„æ”¹å˜ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;è¿‡ç¨‹&#34;&gt;è¿‡ç¨‹&lt;/h2&gt;
&lt;p&gt;æ•´ä½“æœåŠ¡åˆ†ä¸º4ä¸ªé˜¶æ®µè¿›è¡Œç®€è¿°ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¿«é€Ÿä¸Šçº¿ï¼Œéœ€æ±‚å¤šï¼Œè¿­ä»£å¿«ï¼Œå¼€å‘å›¢é˜Ÿæ•´ä½“ä½¿ç”¨ç†Ÿæ‚‰å¼€å‘æ¡†æ¶ï¼ˆæ•ˆç›Šï¼šå‰æœŸèµ·æ­¥ä½¿ç”¨rdç†Ÿæ‚‰çš„å¼€å‘è„šæœ¬è¯­è¨€ï¼Œæ”¯æŒéœ€æ±‚å¿«é€Ÿè¿­ä»£ï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åé¢åŠŸèƒ½å¤ç”¨ï¼Œ å»ºè®¾ä¸šåŠ¡ä¸­å°ï¼Œ ç›´æ’­ä¸­å°ï¼Œäº’åŠ¨ä¸­å°çš„å»ºè®¾ï¼Œä¸­å°çš„è¯·æ±‚å¤§ï¼Œé‡‡ç”¨golangè¿›è¡Œå¼€å‘ï¼Œï¼ˆæ•ˆç›Šï¼šæ•´ä½“æœºå™¨èµ„æºæ¶ˆè€—å‡å°‘, é«˜å³°æœŸæœºå™¨è´Ÿè½½é™ä½)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ ¹æ®ç›´æ’­ä¸šåŠ¡åœºæ™¯ï¼ŒæŠ½è±¡ä¸­å°åº•å±‚æ•°æ®æ¨¡å‹ï¼Œï¼ˆæ•ˆç›Šï¼šå‡å°‘äººåŠ›ï¼Œæé«˜å¤ç”¨ï¼Œå¢åŠ æ•´ä½“ç ”å‘æ•ˆèƒ½ï¼‰&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¼€å‘è¯­è¨€è¿ç§»ï¼Œ æœåŠ¡æ¨¡å‹ä»å¤šè¿›ç¨‹è„šæœ¬å¼±ç±»å‹è¯­è¨€åˆ‡åˆ°å¤šåç¨‹å¼ºç±»å‹è¯­è¨€ï¼Œéœ€è¦é€‚é…æ¥å£&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;éœ€è¦æ¢³ç†æ ¸å¿ƒæœåŠ¡æ¥å£å’Œéæ ¸å¿ƒæœåŠ¡æ¥å£ï¼Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœåŠ¡ä¸Šçº¿ï¼Œè¿ç§»è€æ¥å£ï¼Œ éœ€è¦åšæµé‡çš„åˆ‡åˆ†ï¼Œæ–°è€æ¥å£çš„diff , æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åœ¨ä¸šåŠ¡å±‚é¢åŠ ä¸Šç°åº¦ç­–ç•¥ï¼Œé€šè¿‡ç­–ç•¥é…ç½®ï¼Œå¯¹ä¸åŒçš„ä¸šåŠ¡idè¿›è¡Œå¼‚æ­¥åˆ†æµï¼Œä¸€ä»½è¯·æ±‚æ•°æ®ï¼Œ2ä»½å“åº”æ•°æ®ï¼Œåªè¿”å›è€çš„å“åº”æ•°æ®ï¼Œæ–°è€å“åº”æ•°æ®è¿›è¡Œdiffå¤„ç†ï¼›ä¼˜ç‚¹ï¼šä¸šåŠ¡æ”¹é€ æ–¹è‡ªå·±æŠŠæ§ï¼›ç¼ºç‚¹ï¼šå¯¹ä¸šåŠ¡ä»£ç æœ‰ä¾µå…¥ï¼Œå¦‚æœæ”¹é€ ç°åº¦ç­–ç•¥å¤šçš„è¯ï¼Œä¼šé™ä½ä¸šåŠ¡ä»£ç é€»è¾‘ç¨³å®šæ€§ï¼›&lt;/li&gt;
&lt;li&gt;åœ¨æ–°è€æœåŠ¡ä¹‹ä¸ŠåŠ ä¸€å±‚æ¥å£ä»£ç†å±‚ï¼Œæ¥å£é€‚é…ï¼Œç°åº¦ç­–ç•¥æµé‡åˆ‡åˆ†ï¼Œæ–°è€æ¥å£diffåŠŸèƒ½ ç§»è‡³ æ¥å£ä»£ç†å±‚åšï¼Œç›¸å½“äºæä¾›ä¸€å±‚ç½‘å…³æœåŠ¡æ¥å¤„ç†ï¼›ä¼˜ç‚¹ï¼š å¯¹æ¥å£ç°åº¦è¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œä¸ä¼šå¯¹ä¸šåŠ¡ä»£ç æœ‰æµ¸å…¥æ“ä½œï¼›ç¼ºç‚¹ï¼šå¤šäº†ä¸€å±‚ä»£ç†å±‚ï¼Œæ¥å£å“åº”æ—¶é—´ä¼šæœ‰æ‰€å¢åŠ ï¼Œéœ€è¦ä¿è¯ä»£ç†å±‚çš„ç¨³å®šæ€§ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ä¸¤ç§æ–¹æ¡ˆéƒ½å¯ä»¥ï¼Œéœ€è¦ç»“åˆç»„ç»‡ç»“æ„æ¥è€ƒè™‘å¼€å‘æŠ€æœ¯æˆæœ¬ï¼Œ æ–¹æ¡ˆä¸€ï¼šä¸éœ€è¦é¢å¤–çš„äººåŠ›æ¥æ”¯æŒç»´æŠ¤ä»£ç†å±‚ï¼›æ–¹æ¡ˆäºŒï¼šéœ€è¦å•ç‹¬çš„å›¢é˜Ÿæˆ–è€…å¼€å‘äººå‘˜æ¥ç»´æŠ¤ä»£ç†å±‚ï¼› å¦‚æœçœ‹æ•´ä½“æ”¶ç›Šçš„è¯ï¼Œåå‘äºç¬¬äºŒç§æ–¹æ¡ˆï¼Œå‰è€…å°±æ˜¯æˆ˜æœ¯ç¼–ç¨‹ï¼Œåè€…å°±æ˜¯æˆ˜ç•¥ç¼–ç¨‹ï¼Œåº”è¯¥ä¾§é‡æˆ˜ç•¥ç¼–ç¨‹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¯¾ä¸­ç›´æ’­æ˜¯æµé‡çªå‘çš„åœºæ™¯ï¼Œå¯¹äºæœåŠ¡ä¼˜åŒ–æ”¹é€ ï¼ŒæœåŠ¡å‹åŠ›æµ‹è¯•å¿…ä¸å¯å°‘ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¥å£å‹æµ‹ï¼Œå…³æ³¨qpsï¼Œæ¥å£å“åº”æ—¶é—´ï¼ŒæœåŠ¡ç›‘æ§ï¼Œè´Ÿè½½ç­‰æƒ…å†µï¼›&lt;/li&gt;
&lt;li&gt;å…¨é“¾è·¯å‹ä¾§ï¼Œå…³æ³¨tpsï¼Œæ•´ä½“é“¾è·¯è°ƒç”¨æ¥å£å“åº”æ—¶é—´è€—æ—¶ï¼Œæ€»å“åº”æ—¶é—´è€—æ—¶ï¼Œå„æœåŠ¡ç›‘æ§ï¼Œè´Ÿè½½ç­‰æƒ…å†µï¼›å¹¶ä¸”è¾“å‡ºæµ‹è¯•æŠ¥è¡¨ï¼›ä¸ºäº†ä¸æ±¡æŸ“çº¿ä¸Šæ•°æ®ï¼Œéœ€è¦å¯¹åŸºç¡€å­˜å‚¨ç»„ä»¶ å•ç‹¬éƒ¨ç½²ä¸€å¥—å½±å­ç³»ç»Ÿï¼ŒæœåŠ¡é“¾è·¯ä¸Šéœ€è¦åŠ ä¸Šå‹ä¾§æ ‡ç­¾å‚æ•°ï¼›å¯å‚è€ƒï¼š&lt;a href=&#34;https://help.aliyun.com/document_detail/29337.html&#34;&gt;æ€§èƒ½æµ‹è¯• PTS&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¿è¯åˆ‡æµè¿‡ç¨‹ä¸­æœåŠ¡æ¯”è¾ƒç¨³å®šï¼Œè¿›è¡Œå‘¨æœŸæ€§å¼•æµï¼Œåˆ‡æµè§‚å¯Ÿï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ—è·¯å¼•æµdiffï¼Œè¦†ç›–åˆ°ä¸šåŠ¡å…¨åœºæ™¯çš„æƒ…å†µï¼Œdiffåœ¨å¯æ¥å—èŒƒå›´å†…ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥ æµé‡åˆ‡æµ&lt;/li&gt;
&lt;li&gt;ä¸ºäº†ä¿è¯æœåŠ¡ç¨³å®šæ€§ï¼Œä¸å‡ºç°p0,p1,p2äº‹æ•…ï¼Œæµé‡åˆ‡æ¢çš„å‘¨æœŸä¸€èˆ¬æ¯”è¾ƒé•¿ï¼ŒæŒ‰è¦†ç›–åˆ°çš„ä¸šåŠ¡åœºæ™¯å’Œæ•´ä½“æœåŠ¡ç›‘æ§æƒ…å†µè€Œå®šï¼ŒæŒ‰1%ã€2%ã€10%ã€20%ï¼Œ40%ï¼Œ80%æ”¾é‡ï¼›æŸ¥çœ‹å®¢æˆ·ç«¯æ˜¯å¦æœ‰å¼‚å¸¸ä»¥åŠç”¨æˆ·çš„åé¦ˆå·¥å•ï¼Œåˆ‡æµæ”¾é‡é˜¶æ®µdiffè¿˜æ˜¯æ­£å¸¸è¿›è¡Œï¼Œè¿”å›æ˜¯å¦æœ‰é—®é¢˜ï¼Œå­˜æ”¾æ•°æ®æ˜¯å¦ä¸€è‡´ï¼›æ²¡æœ‰é—®é¢˜ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥  çº¿ä¸Šè§‚å¯Ÿ&lt;/li&gt;
&lt;li&gt;çº¿ä¸Šè§‚å¯Ÿä¸€æ®µæ—¶é—´ï¼Œä¼šä»¥æœˆä¸ºå•ä½ï¼Œè§‚å¯Ÿé˜¶æ®µä¸»è¦æœåŠ¡æµé‡æ˜¯æ–°æ”¹é€ çš„æœåŠ¡ï¼Œå¦‚æœå‘ç°æœ‰å¼‚åŠ¨ï¼Œè¿˜å¯ä»¥åˆ‡å›åŸæ¥çš„æœåŠ¡ï¼›å¦‚æœè§‚å¯Ÿé˜¶æ®µæ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥ä¸‹æ‰åŸæ¥çš„æœåŠ¡äº†ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æœåŠ¡æ”¹é€ è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰æ–°çš„ä¸šåŠ¡éœ€æ±‚è¿›æ¥ï¼Œå¦‚æœæ˜¯å¤§çš„éœ€æ±‚ï¼Œå¼€å‘å‘¨æœŸæ¯”è¾ƒé•¿çš„é¡¹ç›®ï¼Œå¦‚æœæ˜¯ç´§æ€¥é¡¹ç›®ï¼Œåªèƒ½åœ¨åŸæœ‰æœåŠ¡ä¸Šè¿›è¡Œå¼€å‘ï¼Œåç»­åœ¨è¿ç§»è‡³æ–°ç³»ç»Ÿä¸­ï¼›å¯¹äºéç´§æ€¥éœ€æ±‚ï¼Œå¯ä»¥æš‚ç¼“å‹å‹ï¼Œå¯ä»¥ç­‰æ–°æœåŠ¡ä¸Šçº¿ç¨³å®šä¹‹åï¼Œåœ¨ä½¿ç”¨æ–°æœåŠ¡æ¡†æ¶å¼€å‘ï¼Œä¸Šçº¿éƒ¨ç½²ï¼Œä¸»è¦çœ‹éœ€æ±‚ä¸­æ˜¯å¦éœ€è¦ä¿®æ”¹è€æ¥å£ï¼Œè¿˜æ˜¯ç›´æ¥æä¾›æ–°æ¥å£å°±å¯ä»¥æ»¡è¶³ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å®¹å™¨åŒ–æ”¹é€ ï¼Œä¸Šäº‘ï¼ˆæ•ˆç›Šï¼šæ•´ä½“æµ‹è¯•ï¼Œçº¿ä¸Šç¯èŠ‚ä¿æŒä¸€è‡´ï¼ŒèŠ‚çº¦å¼€å‘æµ‹è¯•æ—¶é—´ï¼›çº¿ä¸ŠæœåŠ¡æ²»ç†é€šè¿‡K8S+Istio,è¿›è¡Œç½‘æ ¼åŒ–æ²»ç†, ä»¥å‰éƒ¨ç½²åœ¨ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºä¸Šï¼Œæ··éƒ¨çš„æƒ…å†µï¼Œèµ„æºåˆ†é…å’Œéš”ç¦»ä¸åˆç†ï¼Œè¿ç§»åï¼Œå¯ä»¥å……åˆ†åˆç†åˆ©ç”¨å®¿ä¸»ç‰©ç†æœº/è™šæ‹Ÿæœºèµ„æºï¼Œéš”ç¦»ï¼Œå¼¹æ€§æ‰©ç¼©å®¹ï¼Œéƒ¨ç½²ä¸Šçº¿å‰ææ¡ä»¶æ˜¯éœ€è¦ä¿è¯K8Så¯ç”¨æ€§ï¼‰&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹ä¸åŒè¯­è¨€æœåŠ¡è¿›è¡Œå®¹å™¨åŒ–æ”¹é€ ï¼Œæœ‰ä¸åŒä¸šåŠ¡éƒ¨é—¨æ¨è¿›(ä¸»è¦æ˜¯é¡¹ç›®æ„å»ºæ‰“åŒ…æˆé•œåƒï¼Œdockerçš„è¯éœ€è¦ç¼–å†™Dockerfile)ï¼ŒåŸºç¡€çš„èµ„æºç®¡ç†ç”±devopsæä¾›CI(gitlab ci)/CDå¹³å°æ•´åˆä¸Šçº¿(å¯ä»¥éƒ¨ç½²ç‰©ç†æœº/è™šæ‹Ÿæœº/éƒ¨ç½²(kubectl/istioctl)å®¹å™¨ä¸Šäº‘)&lt;/li&gt;
&lt;li&gt;åœ¨è¿ç§»è‡³å®¹å™¨äº‘(Kubernetes é›†ç¾¤ä¸­çš„åº”ç”¨)çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæ¶‰åŠåˆ°ä¸€éƒ¨åˆ†æœåŠ¡å®¹å™¨åŒ–éƒ¨ç½²ä¸Šçº¿ï¼Œä¸€éƒ¨åˆ†è¿˜æ˜¯éƒ¨ç½²åœ¨ç‰©ç†æœº/è™šæ‹Ÿæœºä¸Šï¼ŒæœåŠ¡ä¹‹é—´ç›¸äº’è®¿é—®ï¼Œå®¹å™¨äº‘-&amp;gt;å®¹å™¨äº‘ï¼Œå®¹å™¨äº‘-&amp;gt;ç‰©ç†æœº/è™šæ‹Ÿæœºï¼Œ ç‰©ç†æœº/è™šæ‹Ÿæœº-&amp;gt;å®¹å™¨äº‘ï¼Œéœ€è¦ä¸šåŠ¡æ¢³ç†å‡ºæœåŠ¡ä¹‹é—´çš„è°ƒç”¨å…³ç³»ï¼Œç„¶åå¯¹3ç§æœåŠ¡è°ƒç”¨æƒ…å†µè¿›è¡Œæ”¹é€ ï¼Œå…¶ä¸­å¯ä»¥ä½¿ç”¨sidecaræ¨¡å¼è¿›è¡Œæµé‡è¾“å…¥è¾“å‡º&lt;/li&gt;
&lt;li&gt;é€šè¿‡K8Sæ¥ç¼–æ’æœåŠ¡ï¼Œä¼šå‡ºç°æœåŠ¡æ²»ç†çš„é—®é¢˜ï¼Œéœ€è¦å¯è§†åŒ–ï¼Œç›‘æ§ï¼Œè¿½æŸ¥å®šä½é—®é¢˜ç­‰ç›¸å…³å¹³å°æ¥æ•´åˆï¼Œå¯¹åº”çš„è§„èŒƒå’Œå¼€æºå·¥å…·æ•´åˆè¿›æ¥ï¼Œlog: é‡‡é›†æ—¥å¿—ï¼Œå­˜å‚¨æ—¥å¿—(çƒ­/å†·)ï¼ŒæŸ¥æ‰¾æ—¥å¿—ï¼›metric: ç›‘æ§æ•°æ®é‡‡é›†ï¼Œç›‘æ§æŒ‡æ ‡ï¼Œç›‘æ§çœ‹æ¿/å¤§ç›˜ï¼›trace: æœåŠ¡è¯·æ±‚è®¿é—®é“¾è·¯è¿½è¸ªï¼ŒæœåŠ¡è°ƒç”¨å“åº”æ—¶é—´ï¼Œæ•´ä½“å“åº”æ—¶é—´ï¼›ä»¥åŠk8sæœ¬èº«è°ƒåº¦èŠ‚ç‚¹ä¸­podèµ„æºç›‘æ§&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²è‡³å®¹å™¨äº‘åçš„æ•´ä½“æµ‹è¯•ï¼Œæ¥å£å‹ä¾§ï¼Œæ•´ä½“é“¾è·¯å‹ä¾§&lt;/li&gt;
&lt;li&gt;ä¸Šçº¿åçš„åˆ‡æµæ–¹æ¡ˆ&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ•´ä½“æµç¨‹&#34;&gt;æ•´ä½“æµç¨‹&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/cicd.png&#34; alt=&#34;cicd&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;éšç€ä¸šåŠ¡çš„å‘å±•ï¼ŒæœåŠ¡ä¸æ–­è¿­ä»£æ”¹é€ ï¼Œæ¶‰åŠåˆ°ä¸šåŠ¡å±‚é¢æŠ½è±¡æ”¹é€ ï¼Œä»¥åŠåŸºç¡€å¹³å°æœåŠ¡çš„å‡çº§ï¼›æœ€ç»ˆç›®çš„éƒ½æ˜¯ä¸ºäº†æ»¡è¶³æ—¥ç›Šå¢é•¿çš„éœ€æ±‚ï¼Œç¼©çŸ­éœ€æ±‚å‘å¸ƒåˆ°ä¸Šçº¿çš„å‘¨æœŸï¼Œå¤ç”¨ï¼Œå‡å°‘è¿­ä»£å¯¹æœåŠ¡æ•´ä½“ç¨³å®šæ€§çš„å½±å“ã€‚&lt;/p&gt;
&lt;h4 id=&#34;references&#34;&gt;References&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://jimmysong.io/kubernetes-handbook/practice/service-discovery-and-loadbalancing.html&#34;&gt;k8s-service-discovery-and-loadbalancing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.servicemesher.com/istio-handbook/practice/integration-registry.html&#34;&gt;istioé›†æˆæœåŠ¡æ³¨å†Œä¸­å¿ƒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.servicemesher.com/istio-handbook/concepts/sidecar-injection.html&#34;&gt;Sidecar æ¨¡å¼&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://zhaohuabing.com/post/2019-10-21-pilot-discovery-code-analysis/&#34;&gt;Istio Pilot ç»„ä»¶ä»‹ç»&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
      
    </item>
    
    <item>
      <title>å·¥ç¨‹å¸ˆå…­å¤§æ„è¯†</title>
      <link>https://weedge.github.io/post/rd/</link>
      <pubDate>Sat, 02 Oct 2021 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/rd/</guid>
      
        <description>&lt;h2 id=&#34;1æ—¶é—´æ„è¯†&#34;&gt;&lt;strong&gt;1.æ—¶é—´æ„è¯†&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;â€‹    æ—¶é—´æ„è¯†çš„ç»ˆæç›®æ ‡æ˜¯æŒ‰æ—¶ä¿è´¨çš„å®Œæˆå·¥ä½œã€‚æ—¶é—´æ˜¯ä¸€ç§å®è´µçš„èµ„æºï¼Œç”±äºæ¯å¤©å·¥ä½œæ—¶é—´çš„æœ‰é™çš„è€Œéœ€è¦å¤„ç†äº‹æƒ…æ˜¯å¤æ‚å¤šå˜æ€§çš„ï¼Œä¸ºäº†æŒ‰æ—¶ä¿è´¨çš„å®Œæˆå·¥ä½œï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æœ‰æå¼ºçš„æ—¶é—´æ„è¯†ï¼Œä½¿ç”¨ç§‘å­¦çš„æ—¶é—´ç®¡ç†ç­–ç•¥ã€‚æ€»çš„æ¥è¯´ï¼Œæ—¶é—´ç®¡ç†å°±æ˜¯è®©æˆ‘ä»¬æ›´æœ‰è®¡åˆ’çš„çŸ¥é“éœ€è¦åšä»€ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™åšä»€ä¹ˆï¼Œè€Œæ—¶é—´ç®¡ç†çš„éš¾ç‚¹ä¸ºï¼šäº‹æƒ…å…·æœ‰çªå‘æ€§ã€å®Œæˆæ—¶é—´éš¾ä»¥é¢„ç®—æ€§ã€æ‰§è¡ŒåŠ›å’Œé¢„æœŸä¸ç¬¦åˆã€‚&lt;/p&gt;
&lt;h3 id=&#34;11åšæ˜ç¡®è®¡åˆ’&#34;&gt;1.1åšæ˜ç¡®è®¡åˆ’&lt;/h3&gt;
&lt;p&gt;â€‹    èŠ±ä¸€å®šçš„æ—¶é—´ä¸“é—¨åšè®¡åˆ’ï¼Œç²¾ç¡®åˆ°å°æ—¶ï¼Œç£¨åˆ€ä¸è¯¯ç æå·¥ã€‚ä¸ºäº†åšå‡ºç²¾ç¡®çš„è®¡åˆ’ï¼Œæé«˜æ—¶é—´çš„åˆ©ç”¨ç‡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸ªäººæ—¶é—´å’Œä»»åŠ¡å®‰æ’åˆ†å—åŒ–ï¼Œè®©åŒæ€§è´¨çš„ä»»åŠ¡éƒ¨é—¨åˆ†é…åŒä¸€æ®µæ—¶é—´æ¥å¤„ç†ï¼Œè®©é›¶ç¢çš„æ—¶é—´å¤„ç†ç»†ç¢çš„é—®é¢˜ï¼Œé«˜æ•ˆç‡çš„æ—¶é—´åšå¤§å—é‡è¦å›°éš¾çš„é—®é¢˜ã€‚&lt;/p&gt;
&lt;h3 id=&#34;12èƒ½å°½å¿«å®Œæˆå°±å°½å¿«å®Œæˆç»™ä»¥çªå‘äº‹æƒ…ä¸€å®šé¢„ç®—ä½™åœ°&#34;&gt;1.2èƒ½å°½å¿«å®Œæˆå°±å°½å¿«å®Œæˆï¼Œç»™ä»¥çªå‘äº‹æƒ…ä¸€å®šé¢„ç®—ä½™åœ°&lt;/h3&gt;
&lt;p&gt;â€‹    å³ä½¿æ¯å¤©è®¡åˆ’çš„æ¸…æ¸…æ¥šæ¥šçš„å·¥ä½œå®‰æ’ï¼Œè¿˜æ˜¯å¾ˆå¤§å¯èƒ½å‡ºç°çªå‘äº‹æƒ…æ‰“ä¹±è®¡åˆ’ï¼Œå› ä¸ºæˆ‘ä»¬çš„å·¥ä½œæ€§è´¨å°±æ˜¯è¿™æ ·çš„ï¼Œéœ€è¦éšæ—¶å¾…å‘½è§£å†³çªå‘çš„é—®é¢˜ï¼Œå¹¶ä¸”å¾ˆå¤šäº‹æƒ…æ˜¯éš¾ä»¥å‡†ç¡®é¢„ç®—å®Œæˆæ—¶é—´çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å°½å¿«çš„å®Œæˆä»»åŠ¡è€Œä¸æ˜¯æ‹–åˆ°æœ€åç”šè‡³æ‹–åˆ°æ˜å¤©ï¼Œè¿™æ ·æ‰èƒ½æœ€å¤§é™åº¦çš„ç•™ç»™æœªçŸ¥å¯èƒ½çš„å¤„ç†ç©ºé—´ã€‚&lt;/p&gt;
&lt;p&gt;â€‹    ç°åœ¨çš„ç¤¾ä¼šå¤„äºäº’è”ç½‘äº§ä¸šé«˜é€Ÿå‘å±•æ—¶æœŸï¼Œåˆ°å¤„å……æ»¡ç€æœºé‡ï¼Œä½†æ˜¯ä¸ç®¡å¯¹ä¼ä¸šè¿˜å¯¹ä¸ªäººæ¥è¯´åˆéƒ½é¢é¢†ç€æå¤§çš„ç«äº‰æŒ‘æˆ˜ã€‚æƒ³è¦åœ¨è¿™æ ·çš„ç¯å¢ƒä¸‹ç”Ÿå­˜å¹¶ä¸”å‰è¿›ï¼Œéœ€è¦æˆ‘ä»¬å…·æœ‰äº‰åˆ†å¤ºç§’çš„æ„è¯†ï¼Œä»Šå¤©è½åä¸€æ­¥ï¼Œå°±éœ€è¦æ— æ•°å¤©çš„åŠ é€Ÿæ‰èƒ½è¿½ä¸Šåˆ«äººï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œèº«ä¸ºå›¢é˜Ÿçš„ä¸€å‘˜ï¼Œå¾ˆå¯èƒ½å› ä¸ºè‡ªå·±çš„ä¸€ç‚¹æ‡ˆæ€ è€Œæ‹–æ…¢å›¢é˜Ÿçš„è„šæ­¥ã€‚&lt;/p&gt;
&lt;h3 id=&#34;13æ€»ç»“æé«˜é”»ç‚¼åšæ¯…çš„æ€§æ ¼æé«˜æ‰§è¡ŒåŠ›åº¦&#34;&gt;1.3æ€»ç»“æé«˜ï¼Œé”»ç‚¼åšæ¯…çš„æ€§æ ¼ï¼Œæé«˜æ‰§è¡ŒåŠ›åº¦&lt;/h3&gt;
&lt;p&gt;â€‹    é™¤äº†äº‹æƒ…æœ¬èº«çš„å¤šå˜æ€§å’Œç«äº‰çš„æ¿€çƒˆæ€§ï¼Œè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯æˆ‘ä»¬é€šå¸¸ä¼šé«˜ä¼°è‡ªå·±çš„æ‰§è¡ŒåŠ›ï¼Œè¿™éœ€è¦æˆ‘ä»¬æˆ‘ä»¬è¿›è¡Œè‡ªæˆ‘ç®¡ç†è‡ªæˆ‘çº¦æŸï¼ŒåŸ¹å…»åšæ¯…çš„æ€§æ ¼ï¼Œå…·æœ‰å¾ˆå¼ºçš„è´£ä»»å¿ƒï¼Œé«˜æ•ˆç‡çš„æ‰§è¡ŒåŠ›ï¼Œä¸»åŠ¨çš„å‘åˆ«äººæ±‡æŠ¥è¿›åº¦ï¼Œæ ‘ç«‹èµ·ä¸€ä¸ªè®©è‡ªå·±å’Œåˆ«äººéƒ½ä¿¡å¾—è¿‡çš„å½¢è±¡ã€‚æˆ‘ä»¬è¿˜éœ€è¦ä¸æ–­çš„æ€»ç»“æé«˜è®¡åˆ’çš„å‡†ç¡®æ€§ï¼Œçœ‹æ¸…è‡ªå·±ï¼Œçœ‹æ¸…é—®é¢˜ï¼Œå°†è‡ªå·±å’Œé—®é¢˜å‡†ç¡®çš„åœ¨æ—¶é—´ç»´åº¦ä¸Šæ¥å¯¹åº”èµ·æ¥ã€‚&lt;/p&gt;
&lt;h2 id=&#34;2è´¨é‡æ„è¯†&#34;&gt;&lt;strong&gt;2.è´¨é‡æ„è¯†&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;â€‹    æ—¶é—´æ˜¯å®è´µçš„èµ„æºï¼Œä½†æ˜¯ä¸èƒ½ä¸ºäº†èŠ‚çœæ—¶é—´è€Œé™ä½è´¨é‡ï¼Œæ—¶é—´æ˜¯ç”¨æ¥ä½¿ç”¨çš„ï¼ŒçœŸæ­£çš„èŠ‚çœæ—¶é—´å°±æ˜¯åˆç†é«˜æ•ˆçš„ä½¿ç”¨æ—¶é—´ã€‚æ¬²é€Ÿåˆ™ä¸è¾¾ï¼Œåœ¨å¤æ‚åºå¤§çš„ç½‘ç»œç¯å¢ƒä¸­ï¼Œæ¯ä¸€ä¸ªå°å°çš„è´¨é‡é—®é¢˜ï¼Œéƒ½å¯èƒ½å¯¼è‡´å·¨å¤§çš„ç¾éš¾ï¼Œæ¯”å¦‚æœ‰å¯èƒ½è¿™ä¸ªç¾éš¾åªæ˜¯å› ä¸ºæŸä¸€ä¸ªè¿›åˆ¶è½¬æ¢ç²¾åº¦æŸå¤±å¼•èµ·çš„ã€‚å¦‚ä½•ä¿è¯è´¨é‡ï¼Œéœ€è¦ä¸ªäººçš„è´£ä»»å¿ƒã€éœ€è¦å›¢é˜Ÿçš„æ­£ç¡®æ–‡åŒ–æ°›å›´ã€éœ€è¦ç§‘å­¦çš„è´¨é‡ä¿è¯æµç¨‹ã€‚&lt;/p&gt;
&lt;p&gt;â€‹    é¦–å…ˆéœ€è¦æˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªä¿è¯è´¨é‡çš„è´£ä»»å¿ƒï¼Œæ¯ä¸€ä¸ªäººéƒ½è¦å¯¹è´¨é‡è´Ÿè´£ï¼Œè¦æœ‰å±…å®‰æ€å±çš„æ„è¯†ï¼Œä¸èƒ½é»˜è®¤æ²¡é—®é¢˜ï¼Œè€Œæ˜¯è¦åå¤æ ¸å¯¹è‡ªå·±çš„å·¥ä½œï¼Œä¸è¦ç­‰ç€åˆ«äººæ¥å‘ç°è‡ªå·±çš„é—®é¢˜ï¼Œä¸è¦ä¾èµ–æµç¨‹ï¼Œæ¯”å¦‚å¼€å‘ä¸èƒ½ä¾èµ–æµ‹è¯•ï¼Œæµ‹è¯•åªæ˜¯æœ€åçš„è´¨é‡æ£€æŸ¥è€Œå·²ï¼Œè€Œä¸æ˜¯ä¿è¯ï¼Œè€Œä¸”å±€é™æ€§å°ï¼Œå³ä½¿æµ‹è¯•å‡ºé—®é¢˜ï¼Œä¿®æ”¹ä¹Ÿæ˜¯è´¹æ—¶è´¹åŠ›ã€‚&lt;/p&gt;
&lt;p&gt;â€‹    ç„¶åå°±æ˜¯æœ‰ä¸€å¥—ç§‘å­¦çš„è´¨é‡ä¿è¯æµç¨‹ï¼Œæ¯”å¦‚éœ€æ±‚çš„å®¡æ ¸ã€å¼€å‘çš„æµ‹è¯•ã€ä¸Šçº¿è¿‡ç¨‹è¯„å®¡ç­‰ï¼Œè´¨é‡ä¿è¯å·¥ä½œå­˜åœ¨äºæ¯ä¸€ä¸ªç¯èŠ‚ï¼Œæ—©å‘ç°æ—©è§£å†³ï¼Œå› ä¸ºè¶Šåˆ°åé¢æŒ½æ•‘çš„ä»£ä»·è¶Šå¤§ã€‚&lt;/p&gt;
&lt;h2 id=&#34;3æ²Ÿé€šæ„è¯†&#34;&gt;&lt;strong&gt;3.æ²Ÿé€šæ„è¯†&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;â€‹    æ²Ÿé€šçš„æœ¬è´¨å°±æ˜¯ï¼Œäº†è§£ä»–äººçš„éœ€è¦ï¼Œè¡¨è¾¾è‡ªå·±çš„éœ€è¦ï¼Œæ²Ÿé€šæ˜¯é¡¹ç›®æˆåŠŸçš„é‡è¦æŠ€å·§ä¹‹ä¸€ã€‚æ²Ÿé€šæ— å¤„ä¸åœ¨ï¼ŒåŒ…æ‹¬ï¼šæ–‡æ¡£ã€é‚®ä»¶ã€åˆåŒï¼Œæ›´ç›´æ¥ç‚¹çš„å°±æ˜¯ç”µè¯ã€å£å¤´ã€‚å¯¹äºå¼€å‘è€Œè¨€ï¼Œä»£ç æœ¬èº«å°±æ˜¯ç”¨äºæ²Ÿé€šï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¸¥æ ¼è¦æ±‚ä»£ç è§„èŒƒï¼Œè¦æ„è¯†åˆ°ä»£ç æ˜¯è¦ç”¨äºæ²Ÿé€šçš„ï¼Œè®©äººä¸€çœ‹å°±æ‡‚çš„æ‰æ˜¯å¥½ä»£ç ã€‚&lt;/p&gt;
&lt;h3 id=&#34;31æ²Ÿé€šçš„æ€åº¦&#34;&gt;3.1æ²Ÿé€šçš„æ€åº¦&lt;/h3&gt;
&lt;p&gt;â€‹    æ²Ÿé€šä¸­çš„åŒå‘æ˜¯ä»£è¡¨å„è‡ªè§’è‰²çš„æ²Ÿé€šï¼Œè€Œä¸æ˜¯ä¸ªäººé—´çš„æ²Ÿé€šï¼Œä¹Ÿæ˜¯é€šå¸¸æˆ‘ä»¬è¯´çš„ å¯¹äº‹ä¸å¯¹äºº ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ²Ÿé€šä¸­ä¸è¦å¿˜è®°è‡ªå·±çš„èŒä¸šè§’è‰²ï¼Œä¹Ÿä¸è¦å¿½è§†å¯¹æ–¹çš„èŒä¸šè§’è‰²ã€‚åœ¨æ²Ÿé€šä¸­æˆ‘ä»¬è¦å…¬å¼€å’Œå¦è¯šåœ°è¡¨è¾¾è‡ªå·±çš„æ„è§ï¼ŒåŒæ—¶è¦æœ‰å°Šé‡åˆ«äººçš„æƒåˆ©çš„æ€åº¦ï¼Œå¤šç”¨æè¿°æ€§è¯­å¥ï¼Œå°‘ç”¨åˆ¤æ–­æ€§è¯­å¥ï¼Œè¦æœ‰ç§¯æçš„æ€åº¦ã€‚&lt;/p&gt;
&lt;h3 id=&#34;32ä¸»åŠ¨æ²Ÿé€š&#34;&gt;3.2ä¸»åŠ¨æ²Ÿé€š&lt;/h3&gt;
&lt;p&gt;â€‹    çœ‹é—®é¢˜çš„è§’åº¦ä¸åŒï¼Œçœ‹æ³•å’Œè§‚ç‚¹ä¼šä¸ä¸€è‡´ï¼Œæˆ‘ä»¬æ— æ³•å¯„å¸Œæœ›äºå¯¹æ–¹ä¸»åŠ¨æ¥æ‰¾æˆ‘ä»¬æ²Ÿé€šï¼Œæ‰€ä»¥ä¸ºäº†å¾—åˆ°å¥½çš„ç»“æœï¼Œæˆ‘ä»¬éœ€è¦ä¸»åŠ¨å»æ²Ÿé€šã€‚æ‰€ä»¥è¦åšå¥½ä»¥ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;
&lt;p&gt;ï¼ˆ1ï¼‰åšå¥½æ²Ÿé€šå‰çš„å‡†å¤‡ï¼Œæƒ³å¥½è¦è¡¨è¿°çš„é—®é¢˜å’Œæƒ³çŸ¥é“çš„é—®é¢˜&lt;/p&gt;
&lt;p&gt;ï¼ˆ2ï¼‰æŠŠæ¡æ²Ÿé€šæ—¶æœºï¼Œè¦åœ¨é€‚å½“çš„æ—¶é—´ã€åœ°ç‚¹ï¼ŒåŒæ—¶è€ƒè™‘å¥½æ²Ÿé€šå¯¹è±¡çš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆ3ï¼‰é€‰æ‹©å¥½æ²Ÿé€šæ–¹å¼ï¼Œæ ¹æ®æ²Ÿé€šç´§æ€¥ç¨‹åº¦ï¼Œå…·ä½“é—®é¢˜çš„ä¸åŒï¼Œé€‰æ‹©åˆé€‚çš„æ²Ÿé€šæ–¹å¼ï¼Œå¦‚ï¼šé¢è°ˆã€ç”µè¯ã€ä¹¦é¢ï¼ˆå«å³æ—¶é€šè®¯å·¥å…·ï¼‰ç­‰&lt;/p&gt;
&lt;h2 id=&#34;4å›¢é˜Ÿæ„è¯†&#34;&gt;&lt;strong&gt;4.å›¢é˜Ÿæ„è¯†&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;â€‹    è¦å®ç°ç›®æ ‡ï¼Œæœ€é‡è¦çš„å°±æ˜¯å›¢é˜Ÿï¼Œæˆ‘ä»¬è®©è‡ªå·±å˜å¾—ä¼˜ç§€çš„æœ¬è´¨ä¹Ÿæ˜¯ä¸ºäº†èƒ½å¤Ÿä¸ºå›¢é˜Ÿåšæ›´å¤§çš„è´¡çŒ®ï¼Œé€šè¿‡å›¢é˜Ÿå®ç°ä¸ªäººï¼Œä¹Ÿé€šè¿‡ä¸ªäººè´¡çŒ®å›¢é˜Ÿã€‚å¬è¯´è¿™æ ·ä¸€å¥è¯ï¼Œä¸€ä¸ªä¸­å›½äººæ˜¯ä¸€æ¡é¾™ï¼Œä¸€ç¾¤ä¸­å›½äººæ˜¯ä¸€ç¾¤è™«ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åœ¨å›½å¤–äººçœ¼ä¸­ç¼ºå°‘å›¢é˜Ÿçš„æ„è¯†ã€‚å¯¹äºå›¢é˜Ÿæˆ‘ä»¬è¦æœ‰ä»¥ä¸‹æ„è¯†ï¼š&lt;/p&gt;
&lt;h3 id=&#34;41é›†ä½“è£èª‰æ„Ÿ&#34;&gt;4.1é›†ä½“è£èª‰æ„Ÿ&lt;/h3&gt;
&lt;p&gt;â€‹    è¦æœ‰é›†ä½“è£èª‰æ„Ÿï¼Œå‡¡äº‹çœ‹å¤§å±€ï¼Œæ¯ä¸ªäººéƒ½æ˜¯å›¢é˜Ÿçš„ä¸€ä»½å­ï¼Œä¸èƒ½æœ‰æ‰“é…±æ²¹çš„å¿ƒæ€ã€‚&lt;/p&gt;
&lt;h3 id=&#34;42å»ºç«‹å®Œå–„çš„è§„åˆ™&#34;&gt;4.2å»ºç«‹å®Œå–„çš„è§„åˆ™&lt;/h3&gt;
&lt;p&gt;â€‹    æ²¡æœ‰è§„çŸ©ï¼Œä¸ä»¥æˆæ–¹åœ†ï¼Œæ²¡æœ‰æ²¡æœ‰çºªå¾‹çš„å†›é˜Ÿï¼Œä¸å¯èƒ½æ‰“èƒœä»—ã€‚å¯¹äºç ”å‘å›¢é˜Ÿï¼Œç»Ÿä¸€çš„è§„åˆ™å¯ä»¥æœ‰æ•ˆçš„å‡ä½æ²Ÿé€šæˆæœ¬ï¼Œé›†åˆæ•´ä¸ªå›¢é˜Ÿçš„æ™ºæ…§ï¼Œé™ä½é”™è¯¯çš„å¯èƒ½æ€§ï¼Œè§„åˆ™è¦ä¸æ–­æ€»ç»“ï¼Œä¸æ–­ä¼˜åŒ–ã€‚&lt;/p&gt;
&lt;h3 id=&#34;43å›¢ç»“äº’è¿›&#34;&gt;4.3å›¢ç»“äº’è¿›&lt;/h3&gt;
&lt;p&gt;â€‹    å›¢é˜Ÿä¹‹é—´è¦äº’ç›¸ä¿¡ä»»ï¼Œä¹äºä¸ºåˆ«äººæä¾›å¸®åŠ©ï¼Œä¹äºå’Œå–„äºä»å…¶ä»–åŒäº‹é‚£é‡Œè·å¾—å¸®åŠ©ï¼Œäº’ç›¸å­¦ä¹ å…±åŒè¿›æ­¥ã€‚å¼€è¯šå¸ƒå…¬ã€ç›¸äº’å°Šé‡ã€ç›¸äº’ç†è§£ï¼Œå¤šç«™åœ¨å¯¹æ–¹çš„ç«‹åœºä¸Šè€ƒè™‘ï¼Œå¯¹äº‹ä¸å¯¹äººã€‚å›¢é˜Ÿæ„è¯†ä¸ç­‰äºå“¥ä»¬ä¹‰æ°”ã€æ‹‰å¸®ç»“æ´¾ï¼Œä¹Ÿä¸ç­‰äºå¥½å¥½å…ˆç”Ÿï¼Œå»ºç«‹ä¼˜ç§€çš„å›¢é˜Ÿæ°›å›´ã€‚&lt;/p&gt;
&lt;h3 id=&#34;44å»ºç«‹å¼ºæ²Ÿé€š&#34;&gt;4.4å»ºç«‹å¼ºæ²Ÿé€š&lt;/h3&gt;
&lt;p&gt;â€‹    å›¢é˜Ÿè¦å¼ºè°ƒæ²Ÿé€šæ„è¯†ï¼Œä»¥å„ç§æ–¹å¼å»ºç«‹èµ·æˆå‘˜ä¹‹é—´çš„è”ç³»ã€‚&lt;/p&gt;
&lt;h2 id=&#34;5è¿›å–æ„è¯†&#34;&gt;&lt;strong&gt;5.è¿›å–æ„è¯†&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;â€‹    è¦æœ‰ç†æƒ³ï¼Œæœ‰è¿›å–å¿ƒï¼Œä¸æ–­çš„è¿½æ±‚æ›´é«˜çš„ç›®æ ‡ã€‚åœ¨æ¿€çƒˆç«äº‰çš„ç¯å¢ƒï¼Œè¦æœ‰å¿§æ‚£æ„è¯†ï¼Œä¸æ–­è¿›æ­¥ï¼Œå¦åˆ™è¿Ÿæ—©è¦æ·˜æ±°ã€‚è€Œè¿›å–æ„è¯†æœ€ç»ˆè¦çš„æ˜¯å®¢æœè‡ªå·±çš„å¿ƒæ€ï¼Œâ€œç ´å±±ä¸­è´¼æ˜“ï¼Œç ´å¿ƒä¸­è´¼éš¾â€ï¼Œ&lt;strong&gt;å¯¹è‡ªå·±çš„è¦æ±‚æ¯”åˆ«äººå¯¹è‡ªå·±çš„è¦æ±‚æ›´ä¸¥æ ¼&lt;/strong&gt; ï¼Œå®¢æœè‡ªå·±çš„å†…å¿ƒï¼ŒåŠ å¼ºè®¡åˆ’æ€§å’Œæ‰§è¡ŒåŠ›ï¼Œè¿™æ˜¯è§äºæ‰€æœ‰èƒ½å¿«é€Ÿæˆé•¿çš„ä¼˜ç§€å·¥ç¨‹å¸ˆæ‰€å…±æœ‰ç‰¹è´¨ï¼Œè€Œæ°æ°æ˜¯é‚£äº›ä¸é€‚åº”ä¸€ä¸ªé«˜é€Ÿæˆé•¿çš„å›¢é˜Ÿè€Œè¢«æ·˜æ±°æ‰çš„å·¥ç¨‹å¸ˆèº«ä¸Šæ‰€æœ€ç¼ºä¹çš„ä¸œè¥¿ã€‚&lt;/p&gt;
&lt;p&gt;â€‹    è¦æœªé›¨ç»¸ç¼ªï¼Œä¹Ÿè¦å®¹å¿å¤±è´¥ã€‚è¿›å–æ˜¯ä¸ºäº†æœªé›¨ç»¸ç¼ªï¼Œä½†æ˜¯è¿›å–ä¸ä»£è¡¨ä¸ä¼šå¤±è´¥ï¼Œè€Œæ˜¯æŒ‡èƒ½åœ¨å¤±è´¥é¢å‰å‹‡äºå‰–æã€å‹‡äºæ‰¿æ‹…è´£ä»»ï¼Œåˆèƒ½è‡ªæˆ‘æ€»ç»“ç»éªŒæ•™è®­ã€ä¿æŒè‡ªå·±çš„è¿›å–å¿ƒã€‚ Â¡&lt;/p&gt;
&lt;h2 id=&#34;6æ±‚å®æ„è¯†&#34;&gt;&lt;strong&gt;6.æ±‚å®æ„è¯†&lt;/strong&gt;&lt;/h2&gt;
&lt;p&gt;â€‹    å®äº‹æ±‚æ˜¯ï¼Œæ˜¯ã€Šæ¯›æ³½ä¸œæ€æƒ³ã€‹çš„ç²¾é«“ä¹‹ä¸€ï¼Œä¹Ÿæ­£æ˜¯å®äº‹æ±‚æ˜¯ï¼Œä¸æè™šçš„ï¼Œæ‰èƒ½æœ‰é«˜é€Ÿå‘å±•çš„ä¸­å›½çš„ä»Šå¤©ã€‚åœ¨å®é™…é¡¹ç›®ä¸­è¦æ³¨é‡äº‹å®ï¼Œåå¯¹å¼„è™šä½œå‡ï¼Œå¤§èƒ†çš„å‡è®¾å°å¿ƒåœ°æ±‚è¯ï¼Œä¸€åˆ‡ä»¥æ•°æ®è¯´è¯ï¼Œç”¨å‡†ç¡®çš„æ•°å­—å’Œäº‹å®æ¥è®ºè¯ï¼Œä¸èƒ½åªæœ‰è‡†æµ‹çš„ç»“è®ºã€‚&lt;/p&gt;
&lt;p&gt;â€‹    ä»¥é‡åŒ–æŒ‡æ ‡ä½œä¸ºåˆ¤æ–­çš„ä¾æ®ï¼Œå®é™…æ•°æ®ä¸ºç‹ï¼Œæ²¡æœ‰é‡åŒ–ï¼Œå°±æ²¡æœ‰ç»©æ•ˆï¼Œé€šè¿‡è¿™äº›æŒ‡æ ‡è¡¡é‡è‡ªå·±çš„æˆé•¿å’Œè¿›æ­¥ï¼Œé€šè¿‡è¿™äº›æŒ‡æ ‡çŸ¥é“å·¥ä½œçš„æ–¹å‘å’Œé‡ç‚¹ã€‚&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;
&lt;p&gt;å·¥ç¨‹å¸ˆï¼Œæ˜¯ä»å¤æ‚çš„éœ€æ±‚ä¸­ï¼Œ&lt;strong&gt;å®šä¹‰é—®é¢˜&lt;/strong&gt;ï¼Œè§£å†³é—®é¢˜ï¼Œç»™å‡ºå…·ä½“æ–¹æ¡ˆè€Œç”Ÿçš„å·¥ç§ï¼Œä¸èƒ½å•å…µä½œæˆ˜ï¼Œéœ€è¦é€šè¿‡é«˜æ•ˆçš„å·¥å…·è¿›è¡Œæ­¦è£…ï¼Œå¯¹å¤æ‚é‡å¤é€šç”¨çš„åœºæ™¯è¿›è¡Œæ²‰æ·€ä¸‹ç§»ï¼Œæ–¹ä¾¿å…¶ä»–å·¥ç¨‹å¸ˆä½¿ç”¨ï¼Œæ‰€è°“å¼€æºï¼›åœ¨ä¸æ–­æŒ–å‘å¡«å‘ä¸­ï¼Œè§£å†³ç‰¹å®šä»»åŠ¡ï¼Œé”»ç‚¼å‡ºçš®å®è€æ“çš„éš¾å¾—å“æ ¼ï¼Œéœ€æ±‚è™æˆ‘åƒç™¾éï¼Œæˆ‘å¯¹éœ€æ±‚å¦‚åˆæ‹ï¼›æ²¡æœ‰éœ€æ±‚ä½•æ¥æ¶æ„è½åœ°å‘¢ï¼Œä½•æ¥é‡åŒ–æŒ‡æ ‡ï¼Œå‡å€¼åŠ è–ªå‘¢ï½&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>ç»„ç»‡å¼•æ“</title>
      <link>https://weedge.github.io/post/zborg/</link>
      <pubDate>Sun, 05 Sep 2021 21:04:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/zborg/</guid>
      
        <description>&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯ï¼š&lt;/h2&gt;
&lt;p&gt;æ•™å­¦ç›´æ’­é—´åœºæ™¯å¤šæ ·æ€§ï¼ŒæŒ‰å¹´é¾„æ®µåŒºåˆ†è¾…å¯¼åå°è§’è‰²ï¼Œæ„æˆæ•´ä¸ªæ•™å­¦è¯¾ä¸­ç›´æ’­å’Œäº’åŠ¨çš„å¤šæ ·æ€§ï¼Œä¸ºäº†å¿«é€Ÿæ”¯æŒä¸šåŠ¡å‘å±•ï¼Œå¯¼è‡´åç«¯æœåŠ¡æ¥å£è¿‡å¤šï¼Œä¸æ˜“ç»´æŠ¤ï¼Œç»Ÿä¸€ç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;ä¸»è¦åˆ†ä¸ºå¦‚ä¸‹åœºæ™¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å¯¹æ¥è¾…å¯¼ä¾§åå°çš„åœºæ™¯ï¼š&lt;/strong&gt; è¾…å¯¼ä¾§ä¸åŒçš„è¾…å¯¼è¿è¥åå°ï¼Œæ¯”å¦‚ï¼šä½å¹¼è¾…å¯¼ï¼Œç­ä¸»ä»»(ç­è¯¾)ï¼Œç£å­¦æœåŠ¡ï¼Œ0è½¬åŒ–ç£å­¦æœåŠ¡ç­‰ï¼Œåç»­å¯èƒ½è¿˜æœ‰å°é¹¿ç¼–ç¨‹ï¼Œå¤§å¸ˆç´ å…»è¯¾å¯¹åº”çš„è¾…å¯¼ä¾§ï¼›è¾…å¯¼ä¾§ä¼šåˆ†ç­å»å¸¦å­¦ç”Ÿï¼Œä¸åŒçš„è¾…å¯¼ä¾§ä¼šæœ‰å•ç‹¬çš„è¯¾ä¸­ä¸šåŠ¡æœåŠ¡æ¥å¯¹æ¥è¾…å¯¼åå°çš„æ¥å£ï¼Œè¯¾ä¸­ç†è§£ä¸åŒçš„ä¸šåŠ¡ç»„ç»‡å½¢æ€ï¼Œä»£ç é€»è¾‘å’Œå­˜æ”¾æ•°æ®å†—ä½™ï¼Œä¸æ–¹ä¾¿ç»´æŠ¤ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸šåŠ¡å‰å°å¯¹æ¥ç›´æ’­æ¥å£åœºæ™¯&lt;/strong&gt;ï¼šç›´æ’­ä¸šåŠ¡æœåŠ¡å¤šæ ·ï¼›æŒ‰ç…§è¯¾ç¨‹ç±»å‹åˆ†ä¸ºä¸“é¢˜è¯¾ï¼Œç­è¯¾ï¼ŒçŸ­è®­ç­ï¼Œç´ å…»è¯¾ï¼Œç¼–ç¨‹è¯¾ç­‰ï¼›ç›´æ’­æœåŠ¡ï¼šç­ä¸»ä»»å‡ºé•œï¼ˆè¯¾å‰ï¼Œè¯¾ä¸­ï¼Œè¯¾åï¼‰ï¼Œå°ç­ï¼Œå°ç»„ï¼Œå¤§ç­ï¼Œè‡ªä¹ å®¤ç­‰ï¼›æœåŠ¡çš„å¤šæ ·æ€§ï¼Œå¯¼è‡´ä¸šåŠ¡æ¥å£ç¹çï¼Œå‰æœŸå¿«é€Ÿå¼€å‘ä¸Šçº¿ï¼Œé’ˆå¯¹æ¯ä¸ªç›´æ’­æœåŠ¡ä¸šåŠ¡åœºæ™¯å•ç‹¬æä¾›æ¥å£ï¼Œ å¸¦æ¥çš„é—®é¢˜ä¸æ–¹ä¾¿ç»Ÿä¸€ç®¡ç†ç»´æŠ¤ï¼›&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¯¾ä¸­äº’åŠ¨ä¸­å°äº’åŠ¨èŠå¤©åœºæ™¯ï¼š&lt;/strong&gt; å¤§ç­ï¼Œå°ç­ï¼Œå°ç»„ç›´æ’­é—´åœºæ™¯ä¾èµ–å”®å–å’Œè¾…å¯¼ä¾§çš„ç»„ç»‡ç»“æ„è¿›è¡ŒèŠå¤©ï¼Œç­”é¢˜ï¼Œé¼“åŠ±ï¼ŒPKï¼Œå‘çº¢åŒ…ç­‰äº’åŠ¨ï¼›å¯¼è‡´è¯¾å‰éœ€è¦å¯¹è¿™äº›ç»„ç»‡ç»“æ„æŒ‰ç…§ä¸åŒç›´æ’­åœºæ™¯+ä¸åŒè¾…å¯¼ä¾§æ•°æ®è¿›è¡Œæå‰é¢„çƒ­å¤„ç†ï¼Œé€»è¾‘é‡å¤ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;è®¾è®¡ç›®æ ‡&#34;&gt;è®¾è®¡ç›®æ ‡ï¼š&lt;/h2&gt;
&lt;p&gt;éœ€è¦ä¸€ä¸ªæ‰¿ä¸Šå¯ä¸‹çš„æ¨¡å—æ¥è¿æ¥è¾…å¯¼ä¾§æ”¯æ’‘è¯¾ä¸­ç›´æ’­/å›æ”¾äº’åŠ¨åœºæ™¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¯¹ä¸åŒä¸šåŠ¡ç›´æ’­åœºæ™¯è¿›è¡Œæ”¶æ•›ï¼Œå‡å°‘é‡å¤å¼€å‘ï¼›&lt;/li&gt;
&lt;li&gt;éš”ç¦»åº•å±‚ä¸šåŠ¡åå°è¾…å¯¼ä¾§ï¼Œå”®å–ä¾§æ•°æ®ï¼Œç»Ÿä¸€æ¥å…¥è¾…å¯¼/å”®å–ä¾§å…¨é‡æ•°æ®ï¼Œä»¥åŠå¼‚åŠ¨ï¼Œå‡å°‘æ•°æ®å†—ä½™ï¼›&lt;/li&gt;
&lt;li&gt;éš”ç¦»åº•å±‚ä¸šåŠ¡æ•°æ®ï¼ŒæŠ½è±¡ç›´æ’­ä¸­å°æ•°æ®æ¨¡å‹ï¼Œä¸­å°é¢å‘è¿™ä¸ªæ•°æ®æ¨¡å‹è¿›è¡Œç¼–ç¨‹ï¼Œæä¾›åŸå­åŒ–æ¥å£ï¼›&lt;/li&gt;
&lt;li&gt;å½“å¤©ä¸Šè¯¾è¯¾å‰é¢„çƒ­æ•°æ®éœ€è¦åœ¨0-6ç‚¹å°½é‡å…¨éƒ¨é¢„çƒ­å®Œæˆï¼›é¢„çƒ­åŠ é€Ÿï¼Œé¢„çƒ­åçš„æ•°æ®æ£€æŸ¥ï¼›&lt;/li&gt;
&lt;li&gt;å¤ç”¨ä¸­å°æ•°æ®æ¨¡å‹å·²æ”¯æŒçš„ç›´æ’­åœºæ™¯èƒ½åŠ›ï¼Œæä¾›saasåŒ–æœåŠ¡ï¼Œå‰å°ä½¿ç”¨ä¸­å°å®šä¹‰çš„dslï¼Œæ ¹æ®ä¸šåŠ¡åœºæ™¯è¿›è¡Œç»„è£…ï¼Œæé«˜å¼€å‘æ•ˆç‡ï¼›&lt;/li&gt;
&lt;li&gt;æä¾›å¯é…ç½®åå°ï¼Œç®¡ç†æœåŠ¡æ¥å£ï¼›&lt;/li&gt;
&lt;li&gt;å°†è¯»å†™ioæœ€å°åŒ–ï¼Œæé«˜åŸå­åŒ–æ¥å£å“åº”æ—¶é—´RT&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;åŸåˆ™ï¼š é«˜å†…èšä½è€¦åˆã€ç©ºé—´æ¢æ—¶é—´&lt;/p&gt;
&lt;h2 id=&#34;æ•°æ®æ¨¡å‹&#34;&gt;æ•°æ®æ¨¡å‹ï¼š&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ä¸€ä¸ªç« èŠ‚ä¼šæœ‰å¤šä¸ªç›´æ’­é—´ï¼Œæ¯”å¦‚è¾…å¯¼è€å¸ˆå‡ºé•œ(è¯¾å‰ï¼Œè¯¾ä¸­ï¼Œè¯¾å)ï¼Œæœ€å¤š3n+1ä¸ªç›´æ’­é—´ï¼Œnä¸ºè¯¾ç¨‹ç« èŠ‚ä¸‹çš„è¾…å¯¼è€å¸ˆæ•°ç›®ï¼ŒliveRoom&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸åŒç›´æ’­é—´ï¼Œå¯¹åº”ä¸åŒçš„ç›´æ’­é—´ä¸šåŠ¡æµç¨‹:  bizType&lt;/p&gt;
&lt;p&gt;ä¸‰åˆ†å±ç›´æ’­é—´ï¼Œè¿›å…¥æ•™å®¤â†’ç­¾åˆ°â†’ç›´æ’­/äº’åŠ¨â†’ç¦»å¼€(åˆ‡ç›´æ’­é—´)&lt;/p&gt;
&lt;p&gt;å°ç»„ç›´æ’­é—´ï¼Œè¿›å…¥æ•™å®¤â†’è¯¾ä»¶ä¸‹è½½â†’åˆ†ç»„â†’ç­¾åˆ°â†’ç›´æ’­/äº’åŠ¨â†’ç¦»å¼€(åˆ‡ç›´æ’­é—´)&lt;/p&gt;
&lt;p&gt;å°ç­ç›´æ’­é—´ï¼Œè¿›å…¥ç›´æ’­é—´â†’ è¯¾ä»¶ä¸‹è½½â†’ åˆ†ç­â†’ ç›´æ’­/äº’åŠ¨â†’ç¦»å¼€(åˆ‡ç›´æ’­é—´)&lt;/p&gt;
&lt;p&gt;è‡ªä¹ å®¤ç›´æ’­é—´ï¼Œè¿›å…¥ç›´æ’­é—´â†’ ç­¾åˆ°â†’ç›´æ’­&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸åŒç›´æ’­é—´ï¼Œå¯¹åº”ä¸åŒçš„æµåª’ä½“æ¨æ‹‰æµæ–¹æ¡ˆï¼šstreamPolicy&lt;/p&gt;
&lt;p&gt;ä¸‰åˆ†å±ç›´æ’­é—´ï¼Œrtmp + é•¿é“¾æ¥&lt;/p&gt;
&lt;p&gt;å°ç»„ç›´æ’­é—´ï¼Œrtc + é•¿é“¾æ¥&lt;/p&gt;
&lt;p&gt;å°ç­ç›´æ’­é—´ï¼Œrtc + é•¿é“¾æ¥&lt;/p&gt;
&lt;p&gt;è‡ªä¹ å®¤ç›´æ’­é—´ï¼Œrtmp + é•¿é“¾æ¥&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä¸åŒç»„ç»‡å…³ç³»å¯¹åº”èŠå¤©äº’åŠ¨å¹¿æ’­ç»Ÿè®¡ç»´åº¦ï¼ŒæŠ½è±¡ç»„ç»‡ç»“æ„ï¼šorgPolicy, orgTree(node)&lt;/p&gt;
&lt;p&gt;ä¸€è¯¾ä¸‰åˆ†å±ï¼š/è¯¾ç¨‹ç« èŠ‚,  æ— ç­ä¸»ä»»ï¼Œå…¨å‘˜äº’åŠ¨ï¼›è¯¾ä¸­è‡ªåŠ¨ç”Ÿæˆï¼›&lt;/p&gt;
&lt;p&gt;å°è‹±å°æ•°å°è¯­æ–‡å°ç»„ç›´æ’­é—´ï¼Œ/è¯¾ç¨‹ç« èŠ‚/è¾…å¯¼è€å¸ˆ/{é˜Ÿ/å°ç»„}ï¼Œ  è¾…å¯¼è€å¸ˆï¼š ä½å¹¼è¾…å¯¼ï¼Œç­ä¸»ä»»(ç­è¯¾)ï¼Œç£å­¦æœåŠ¡ï¼Œ0è½¬åŒ–ç£å­¦æœåŠ¡ç­‰ï¼Œ é˜Ÿ/å°ç»„ç”±è¯¾ä¸­å­¦ç”Ÿé€‰ç»„è‡ªåŠ¨ç”Ÿæˆï¼›ä½å¹¼è¾…å¯¼ï¼Œç­ä¸»ä»»ï¼Œç£å­¦æœåŠ¡ï¼Œ0è½¬åŒ–ç£å­¦æœåŠ¡æä¾›æ•°æ®ï¼›&lt;/p&gt;
&lt;p&gt;ç­ä¸»ä»»å°ç­ç›´æ’­é—´ï¼Œ/è¯¾ç¨‹ç« èŠ‚/è¾…å¯¼è€å¸ˆ/å°ç­ï¼Œè¾…å¯¼è€å¸ˆï¼š ä½å¹¼è¾…å¯¼ï¼Œç­ä¸»ä»»(ç­è¯¾)ï¼Œå°ç­ç”±è¾…å¯¼ä¾§è¯¾å‰æ’çŒç­ç”Ÿæˆï¼›ä½å¹¼è¾…å¯¼ï¼Œç­ä¸»ä»»æœåŠ¡æä¾›æ•°æ®ï¼›&lt;/p&gt;
&lt;p&gt;çŸ­è®­ç­ï¼Œ/è¯¾ç¨‹ç« èŠ‚/ç£å­¦LPC/å¾®ä¿¡ç¾¤ï¼Œå¾®ä¿¡ç¾¤æœ‰ç£å­¦è€å¸ˆè¯¾å‰æ’çŒç­ç”Ÿäº§ï¼Œç£å­¦æœåŠ¡æä¾›æ•°æ®ï¼›&lt;/p&gt;
&lt;p&gt;0è½¬åŒ–æœåŠ¡ï¼Œ/è¯¾ç¨‹ç« èŠ‚/ç£å­¦LPC , 0è½¬åŒ–ç£å­¦æœåŠ¡æä¾›æ•°æ®ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;lessonPolicy: (bizType,streamPolicy,orgPolicy)&lt;/p&gt;
&lt;p&gt;åŸåˆ™ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç›´æ’­ä¸­å°è§£è€¦ä¸šåŠ¡å±æ€§ï¼Œæ”¯æŒæŠ½è±¡ä¸šåŠ¡åœºæ™¯ï¼Œä½œä¸ºåº•å±‚ç›´æ’­èƒ½åŠ›è¾“å‡ºï¼›&lt;/li&gt;
&lt;li&gt;å¯å¤ç”¨ï¼Œç›´æ’­åŠŸèƒ½ï¼Œæ€§èƒ½ï¼Œç¨³å®šæ€§çš„å¤ç”¨ï¼›æ¯”å¦‚ä¸‰åˆ†å±ï¼Œç­è¯¾ï¼Œå°ç»„ï¼Œä¼ªç›´æ’­ç­‰ä¸åŒç»´åº¦ä¸šåŠ¡å±æ€§è§£è€¦å‰ç½®åˆ°é¢„çƒ­é˜¶æ®µï¼›&lt;/li&gt;
&lt;li&gt;å¯æ‰©å±•ï¼Œç›´æ’­æ•°æ®æ¨¡å‹å±æ€§å¦‚æœ‰æ–°å¢ï¼Œä¸ä¼šå½±å“åŸæœ‰å±æ€§ï¼›&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ•°æ®é‡&#34;&gt;æ•°æ®é‡ï¼š&lt;/h2&gt;
&lt;p&gt;1å¤©æœ€é«˜å³°2wèŠ‚è¯¾ï¼Œæ€»æŠ¥åå­¦ç”Ÿæ•°é‡600w+ï¼Œ åœ¨çº¿å­¦ç”Ÿ100w+ ï¼Œ è¯¾ä¸­è¿›å…¥ä¸Šè¯¾é¡µé¢qps 120w+&lt;/p&gt;
&lt;p&gt;å¤„ç†æ•°æ®é‡ï¼šæŒ‰ä¸€ä¸ªè¯¾ç¨‹ç« èŠ‚æ¥è®¡ç®—ï¼Œæœ€å¤§çš„æŠ¥åå­¦ç”Ÿæ•°ç›®3w+  å®é™…æµ‹è¯•ç”¨60w+ çš„æŠ¥åå­¦ç”Ÿï¼Œé¢„çƒ­å¤§æ¦‚45å¤šåˆ†é’Ÿ&lt;/p&gt;
&lt;p&gt;3w çš„æŠ¥åå­¦ç”Ÿï¼Œ å°ç»„ç›´æ’­é—´ï¼Œç­ä¸»ä»»å‡ºé•œï¼Œä¸€ä¸ªç­ä¸»ä»»æœ€å¤šå¸¦500å­¦ç”Ÿï¼Œé¢„çƒ­å¤§æ¦‚ 1åˆ†é’Ÿ30å¤šç§’&lt;/p&gt;
&lt;p&gt;ç­–ç•¥æ•°æ®ï¼š ä¸€ä¸ªç« èŠ‚å¯¹åº”ä¸€ä¸ªç­–ç•¥ï¼Œä¸€ä¸ªç­–ç•¥å¯ä»¥ç»™å¤šä¸ªç« èŠ‚ä½¿ç”¨ï¼Œ&lt;/p&gt;
&lt;p&gt;policy (id,conf,desc,name)&lt;/p&gt;
&lt;p&gt;lessonPolicy (keyId,keyType,bizType,partition,policyId)&lt;/p&gt;
&lt;p&gt;ç›´æ’­é—´æ•°é‡ï¼š 3n+1 (næ˜¯ç­ä¸»ä»»æ•°ç›®ï¼Œå‡ºé•œåœºæ™¯ï¼‰ æœ€å¤š181ä¸ªç›´æ’­é—´ 180*8*5(id,roomId,virturalRoomId,rootId,bizId,roomType,teacherUid,startTime,endTime,status) = 7.2KB&lt;/p&gt;
&lt;p&gt;ç»„ç»‡èŠ‚ç‚¹æ•°é‡ï¼š3w/6=5000ä¸ªå°ç»„èŠ‚ç‚¹ï¼Œ5000/6 = 800å¤šä¸ªé˜ŸèŠ‚ç‚¹ï¼Œ60ä¸ªè¾…å¯¼è€å¸ˆèŠ‚ç‚¹ï¼Œæ€»å…±6000ä¸ªç»„ç»‡èŠ‚ç‚¹ï¼Œ 6000*8*7(id, nodeId,parentId,rootId,virturalNodeId,sourceId,path) =328KB&lt;/p&gt;
&lt;p&gt;ç”¨æˆ·æ•°é‡ï¼š 3w+  æ¯ä¸ªç­ä¸»ä»»æœ€å¤šå¸¦500ä¸ªå­¦ç”Ÿï¼Œ  3w/500 = 60  ä¸ªç­ä¸»ä»»ï¼Œæœ€å¤š 181 ä¸ªç›´æ’­é—´ï¼Œ 180*500 + 3w =12wæ¡ç›´æ’­é—´ç”¨æˆ·æ•°æ®ï¼Œ æŒ‰ç›´æ’­é—´ç»´åº¦åç¨‹ä»»åŠ¡åˆ†æ‰¹å¤„ç†; 12w*8*4(id,uid,nodeId,roomId) =3.7MB&lt;/p&gt;
&lt;p&gt;ä¸€å¤©å¤§æ¦‚æ€»å…± 2w * 4M =  78GBæ•°æ®å¯èƒ½éœ€è¦è¯¾å‰é¢„çƒ­ ï¼ˆä»¥ä¸€å¤©æœ€å¤§2wèŠ‚è¯¾ç¨‹ç« èŠ‚ï¼Œæ¯ä¸ªç« èŠ‚æŠ¥åäººæ•°3wè®¡ç®—, æŠ¥åå­¦ç”Ÿ2w*3w =6äº¿ï¼‰&lt;/p&gt;
&lt;h2 id=&#34;ä¾èµ–ä¸­é—´ä»¶åŸºç¡€æœåŠ¡&#34;&gt;ä¾èµ–ä¸­é—´ä»¶åŸºç¡€æœåŠ¡&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;redis (stored k/vå­˜å‚¨ï¼‰  å‰æœŸæ˜¯å“¨å…µæ¨¡å¼æ¶æ„ï¼Œ åæœŸé‡‡ç”¨proxyæ¨¡å¼æ¶æ„&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;DB(mysql ) ä¸»ä»æ¶æ„ï¼Œæœªä½¿ç”¨proxyæ•°æ®åº“ä¸­é—´ä»¶&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;MQ(NMQ, RocketMQ) æ¶ˆæ¯é˜Ÿåˆ—&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å‰æœŸç”¨çš„NMQ  æ¶ˆæ¯ä»¥pushçš„æ–¹å¼å‘é€çš„æ¶ˆè´¹æ–¹ï¼Œé€šè¿‡groupKeyæ¥ä¿è¯æœ‰åºï¼Œä»¥åŠæ¶ˆæ¯ç§¯å‹æŠ¥è­¦ï¼Œæ— é™é‡è¯•ï¼Œæ¶ˆè´¹æ–¹æ¥ä¿è¯å¹‚ç­‰&lt;/p&gt;
&lt;p&gt;RMQæ˜¯ä¸ºäº†å…¼å®¹NMQ , å¯¹rocketMQè¿›è¡Œæ¥å°è£…ï¼Œ æ¶ˆæ¯ç”Ÿæˆä¾§æä¾›proxy, å…¼å®¹nmqproxyï¼›æ¶ˆè´¹ä¾§rocketMQæ˜¯pullé•¿è½®è®­æ–¹å¼ï¼Œä¸ºäº†å…¼å®¹NMQçš„pushæ–¹å¼ï¼Œæä¾›pusheræ¨¡å—ï¼›æ•°æ®å­˜æ”¾ç”¨rocketMQçš„broker&lt;/p&gt;
&lt;p&gt;rocketMQ : &lt;a href=&#34;https://github.com/apache/rocketmq/tree/master/docs/cn&#34;&gt;https://github.com/apache/rocketmq/tree/master/docs/cn&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;kafka : &lt;a href=&#34;https://kafka.apachecn.org/intro.html&#34;&gt;https://kafka.apachecn.org/intro.html&lt;/a&gt; é•¿é“¾æ¥å¿ƒè·³æ‰“ç‚¹æ•°æ® â†’ kafka â†’ è®¡ç®—å¼•æ“&lt;/p&gt;
&lt;h2 id=&#34;æµç¨‹&#34;&gt;æµç¨‹&lt;/h2&gt;
&lt;h3 id=&#34;æ•°æ®å¯¹æ¥æ–¹&#34;&gt;&lt;strong&gt;æ•°æ®å¯¹æ¥æ–¹&lt;/strong&gt;&lt;/h3&gt;
&lt;p&gt;é¢„çƒ­æ¨¡å—æ¥å…¥è¾…å¯¼ä¾§ä¸‰æ–¹æ•°æ®ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ç­ä¸»ä»»ä¾§ï¼ˆå°ç­ï¼Œè¾…å¯¼è€å¸ˆï¼šç­ä¸»ä»»ï¼‰&lt;/li&gt;
&lt;li&gt;ç£å­¦æœåŠ¡ä¾§ï¼ˆå¾®ä¿¡æœåŠ¡ï¼Œè¾…å¯¼è€å¸ˆï¼šç£å­¦ï¼‰&lt;/li&gt;
&lt;li&gt;0è½¬åŒ–ç£å­¦æœåŠ¡ä¾§ï¼ˆæ‹‰æ–°è½¬åŒ–ï¼Œè¾…å¯¼è€å¸ˆï¼š0è½¬åŒ–ç£å­¦ï¼‰&lt;/li&gt;
&lt;li&gt;ä½å¹¼æœåŠ¡ä¾§ï¼ˆå°ç­ï¼Œè¾…å¯¼è€å¸ˆï¼šç­ä¸»ä»»ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;åœºæ™¯ç›´æ’­é—´ç»´åº¦&#34;&gt;&lt;strong&gt;åœºæ™¯ï¼ˆç›´æ’­é—´ç»´åº¦ï¼‰&lt;/strong&gt;&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;ä¸€ä¸ªç« èŠ‚é‡Œä¸€ä¸ªä¸»ç›´æ’­é—´ä¸€ä¸ªç»„ç»‡æ ‘ ï¼ˆéå‡ºå¢ƒï¼‰&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªç« èŠ‚é‡Œå¤šä¸ªä¸»ç›´æ’­é—´ä¸€ä¸ªç»„ç»‡æ ‘ ï¼ˆå‡ºå¢ƒï¼‰&lt;/li&gt;
&lt;li&gt;ä¸€ä¸ªç« èŠ‚é‡Œå¤šä¸ªä¸»ç›´æ’­é—´å¯¹åº”å¤šä¸ªä»ç›´æ’­é—´å¤šä¸ªç»„ç»‡æ ‘ ï¼ˆæ—å¬+å‡ºå¢ƒï¼‰&lt;/li&gt;
&lt;li&gt;å¤šä¸ªç« èŠ‚æƒ…å†µéƒ½è½¬åŒ–æˆä¸€ä¸ªç« èŠ‚ä¸‹çš„ç›´æ’­é—´æƒ…å†µ ï¼ˆå…±äº«ï¼‰&lt;/li&gt;
&lt;li&gt;è·Ÿè¯¾åœºæ™¯ï¼šä¸€ä¸ªç« èŠ‚å¯èƒ½ç»™ä¸åŒçš„è¾…å¯¼ä¾§åœ¨ä½¿ç”¨ï¼Œè¾…å¯¼å¹³å°çš„æ•°æ®æºä¸åŒï¼Œä¸€ä¸ªç»„ç»‡æ ‘å¯¹åº”å¤šä¸ªä¸šåŠ¡ç»„ç»‡ï¼Œä¸€ä¸ªç›´æ’­é—´ä¸»è®²æ¨æµï¼Œå¤šä¸ªè¾…å¯¼ä¾§åå°æ‹‰æµç›‘æ§&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;æµç¨‹-1&#34;&gt;æµç¨‹&lt;/h3&gt;
&lt;p&gt;å®šä¹‰è§„èŒƒè¾…å¯¼ä¾§æ•°æ®æ¥å…¥ â†’ ä¸Šè¯¾è¯¾ç¨‹ç« èŠ‚ç»‘å®šå¯¹åº”ç­–ç•¥(å¦‚ä¸æ»¡è¶³ï¼Œæ–°å¢æ”¯æŒï¼‰â†’ åˆ†å‘ä»»åŠ¡å‰ç½®é¢„çƒ­ â†’ ç”Ÿæˆä¸­å°ç†è§£çš„å±æ€§ (liveRoom,lessonPolicy,orgTree ç­‰)  â†’ç›´æ’­ä¸­å°é¢å‘è¿™äº›å±æ€§ç¼–ç¨‹ï¼Œæä¾›åŸå­åŒ–è¯»å†™æ¥å£&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/%E7%9B%B4%E6%92%AD%E4%B8%AD%E5%8F%B0-%E7%BB%84%E7%BB%87%E5%BC%95%E6%93%8E%E6%B5%81%E7%A8%8B%E6%A1%86%E6%A1%86%E6%96%BD%E5%B7%A5%E5%9B%BE.jpg&#34; alt=&#34;ç›´æ’­ä¸­å°-ç»„ç»‡å¼•æ“æµç¨‹æ¡†æ¡†æ–½å·¥å›¾.jpg&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;ç­–ç•¥è§„åˆ™å¹³å°policy&#34;&gt;ç­–ç•¥è§„åˆ™å¹³å°policyï¼š&lt;/h2&gt;
&lt;p&gt;ç”¨äºä¸åŒçš„ä¸šåŠ¡ç›´æ’­é—´ç±»å‹ç»‘å®šç»„ç»‡ç­–ç•¥ï¼Œå¼€å‘æä¾›ç»™è¿è¥äº§å“å›¢é˜Ÿä½¿ç”¨&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ¨æ‹‰æµç­–ç•¥ï¼ˆrtc(udp),rtmp(tcp)+CDN å»¶è¿Ÿè¾ƒé«˜ï¼Œä»·æ ¼ä½ï¼› å­¦ç”Ÿï¼Œè€å¸ˆå°ç»„ç›´æ’­é—´äº’åŠ¨åœºæ™¯ç”¨çš„rtc, ä¸€è¯¾(ä¸‰åˆ†å±)ç›´æ’­é—´ç”¨çš„rtmp; è¾…å¯¼è·Ÿè¯¾åå°ï¼Œç›‘æ§åå°ç”¨çš„rtmpï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;ç›´æ’­é—´ç­–ç•¥(ç­ä¸»ä»»è¯¾å‰/è¯¾ä¸­/è¯¾åå‡ºé•œç›´æ’­é—´ï¼Œä¸»è®²ç›´æ’­é—´)ï¼›&lt;/li&gt;
&lt;li&gt;äº’åŠ¨ç»„ç»‡ç­–ç•¥ï¼ˆåŸºäºç»„ç»‡æ ‘ï¼Œå­¦ç”Ÿï¼Œç­ä¸»ä»»ï¼Œè€å¸ˆ é€šè¿‡é•¿é“¾æ¥çš„èŠå¤©å¹¿æ’­æ¨¡å¼ï¼‰;&lt;/li&gt;
&lt;li&gt;é¢„çƒ­ç­–ç•¥ï¼ˆæç®€ï¼Œç®€å•ï¼Œå…¨éƒ¨é¢„çƒ­ï¼‰;&lt;/li&gt;
&lt;li&gt;é¢„çƒ­æ—¶é—´è®¡ç®—é¢„çƒ­æ—¶é•¿(æ ¹æ®ç›´æ’­é—´æ•°ï¼Œç»„ç»‡èŠ‚ç‚¹æ•°ï¼Œç”¨æˆ·æ•°ï¼Œè®¡ç®—é¢„çƒ­æ—¶é•¿ï¼‰ï¼›ç”¨äºåˆ†å±‚æ—¶é—´è½®æ¥ç›‘æ§é¢„çƒ­ä»»åŠ¡è¶…æ—¶æŠ¥è­¦&lt;/li&gt;
&lt;li&gt;ç¼“å­˜è®¾è®¡ä¸­ç›´æ’­é—´çš„å­¦ç”Ÿé›†åˆå’Œåœ¨çº¿å­¦ç”Ÿé›†åˆ zset åˆ†ç‰‡ç­–ç•¥ï¼ˆæ ¹æ®è¯¾ç¨‹æŠ¥åäººæ•°å’Œå•†å“åº“å­˜æ•°è°ƒæƒç›¸åŠ è·å–ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;æ•°æ®æºå®šä¹‰ï¼ˆè¾…å¯¼ä¾§æ•°æ®ï¼šä½å¹¼ï¼Œ0è½¬åŒ–ç£å­¦ï¼Œç£å­¦ï¼Œç­ä¸»ä»»ç­‰ï¼Œå”®å–ä¾§æ•°æ®ï¼‰ï¼›&lt;/li&gt;
&lt;li&gt;å¼‚åŠ¨æ•°æ®é€šçŸ¥å®šä¹‰ (å­¦ç”Ÿæ›´æ¢ç­ä¸»ä»»/å°ç­ï¼Œè€å¸ˆæ›´æ¢ï¼Œè¯¾ç¨‹ç« èŠ‚ä¸Šè¯¾æ—¶é—´æ›´æ”¹ï¼Œè¯¾ç¨‹ç« èŠ‚é‡å¼€ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;ç»„ç»‡æ•°æ®ç”Ÿæˆå¼•æ“core&#34;&gt;ç»„ç»‡æ•°æ®ç”Ÿæˆå¼•æ“coreï¼š&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;ç¼“å­˜è®¾è®¡ï¼š&lt;/p&gt;
&lt;p&gt;ç­–ç•¥ç¼“å­˜/æœ¬åœ°ç¼“å­˜ï¼Œç»„ç»‡æ ‘ç¼“å­˜ï¼Œç›´æ’­é—´ç¼“å­˜ï¼Œå­¦ç”Ÿç¼“å­˜ï¼Œé¢„çƒ­ä»»åŠ¡ç¼“å­˜&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ•°æ®åº“æ•°æ®è®¾è®¡ï¼š&lt;/p&gt;
&lt;p&gt;ä¸šåŠ¡ç­–ç•¥è¡¨ï¼Œç»„ç»‡èŠ‚ç‚¹è¡¨ï¼Œç›´æ’­é—´è¡¨ï¼Œå­¦ç”Ÿè¡¨&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›´æ’­ä¸­å°ç»„ç»‡å¼•æ“è¯¾ä¸­æ•°æ®æ¥å£è®¾è®¡ï¼š&lt;/p&gt;
&lt;p&gt;ç›´æ¥ä»ç¼“å­˜ä¸­å–ï¼Œäº¤äº’çš„æ•°æ®é€šè¿‡write-behind æ¨¡å¼å†™å…¥&lt;/p&gt;
&lt;p&gt;è·å–ç»„ç»‡æ ‘èŠ‚ç‚¹ä¿¡æ¯ï¼ŒèŠ‚ç‚¹åŸå§‹èŠ‚ç‚¹ä¿¡æ¯ï¼Œå­èŠ‚ç‚¹ä¿¡æ¯ï¼Œå­¦ç”Ÿæ‰€åœ¨ç›´æ’­é—´èŠ‚ç‚¹ï¼Œé€‰ç»„/ä½ç½®&lt;/p&gt;
&lt;p&gt;è·å–ä¸šåŠ¡è¯¾ç¨‹ç« èŠ‚ä¸šåŠ¡idçš„ç›´æ’­é—´ä¿¡æ¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›´æ’­ä¸­å°ç»„ç»‡å¼•æ“å›æ”¾æ•°æ®æ¥å£è®¾è®¡ï¼š&lt;/p&gt;
&lt;p&gt;æ¥å£æ•°æ®ç¼“å­˜ï¼Œcache-aside æ¨¡å¼è¯»å–ï¼Œè¯¾åå›æ”¾æ•°æ®éƒ½æ˜¯è¯»çš„åœºæ™¯&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ¶ˆæ¯é˜Ÿåˆ—topic æ¶ˆæ¯ä½“è®¾è®¡ ï¼šå¼‚æ­¥è½åº“ï¼Œä¸ºäº†åŒæ­¥db,  åŒæ­¥dbé€»è¾‘å¹‚ç­‰ï¼Œé™ä½dbçš„å†™å‹åŠ›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç›´æ’­é—´ï¼Œç»„ç»‡èŠ‚ç‚¹ï¼Œå­¦ç”Ÿæ•°æ®&lt;/p&gt;
&lt;p&gt;å†…éƒ¨ä¼˜åŒ–è®¾è®¡ï¼šï¼ˆåŸåˆ™ï¼šå°½é‡å‡å°‘è¯»å†™io, è¾¾åˆ°æœ€ä¼˜è§£ï¼‰&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;å¼‚æ­¥ç¼“å†²bufferæ•°æ®æ‰¹é‡å‘é€é˜Ÿåˆ—å…¥åº“ï¼Œå‡å°‘ç½‘ç»œioï¼Œé™ä½dbçš„å†™å‹åŠ›&lt;/li&gt;
&lt;li&gt;è¯¾ä¸­è€å¸ˆçš„è¯¾ä»¶ä¿¡ä»¤è®°å½•ï¼Œzsetå­˜ç¼“å­˜ï¼Œå­¦ç”Ÿé«˜å¹¶å‘åœºæ™¯è·å–ç›´æ’­é—´ä¿¡ä»¤è®°å½•ï¼Œé€šè¿‡æœ¬åœ°ç¼“å­˜æ¥å‡å°‘å¯¹zset å¤§keyæ•°æ®è¯»å–å‹åŠ›&lt;/li&gt;
&lt;li&gt;ä»»åŠ¡æ± åŒ–ï¼Œå¹¶å‘æ‰¹é‡å¤„ç†ä»»åŠ¡ï¼Œæé«˜ååç›¸åº”é€Ÿåº¦&lt;/li&gt;
&lt;li&gt;ä¸´æ—¶å¯¹è±¡æ± åŒ–ï¼Œé«˜å¹¶å‘ååå‡å°‘gc&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;é…ç½®å¹³å°conf-dashboard&#34;&gt;é…ç½®å¹³å°conf-dashboardï¼š&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;é¢„çƒ­æµç¨‹ DSL pipeline é…ç½®,&lt;/li&gt;
&lt;li&gt;ä¾èµ–ç¼“å­˜å’Œæ•°æ®é…ç½® ï¼Œ&lt;/li&gt;
&lt;li&gt;ä¸šåŠ¡é…ç½®ï¼Œ&lt;/li&gt;
&lt;li&gt;é¢„çƒ­æŠ¥è­¦é€šçŸ¥é…ç½®,&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;é¢„çƒ­æ•°æ®ç›‘æ§å¹³å°monitor-dashboard&#34;&gt;é¢„çƒ­æ•°æ®ç›‘æ§å¹³å°monitor-dashboard:&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;æä¾›æ‰‹åŠ¨è§¦å‘é¢„çƒ­å’Œé¢„çƒ­æ•°æ®æ£€æŸ¥ï¼›&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹é¢„çƒ­å¥½çš„ç›´æ’­é—´ï¼Œç»„ç»‡æ ‘ï¼Œå­¦ç”Ÿæ‰€åœ¨ç›´æ’­é—´çš„ç»„ç»‡èŠ‚ç‚¹ä¿¡æ¯ï¼Œä»¥åŠè¯¾ä¸­ç›´æ’­é—´å¼€å§‹ç»“æŸæ—¶é—´ï¼Œç›´æ’­é—´çŠ¶æ€ï¼Œå­¦ç”Ÿåœ¨çº¿çŠ¶æ€ï¼ŒèŠå¤©çŠ¶æ€ï¼ˆç¦è¨€/å¯èŠå¤©), åˆ†ç»„ä¿¡æ¯ï¼Œåˆ°è¯¾æ—¶é—´&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å¼€å‘å·¥å…·&#34;&gt;å¼€å‘å·¥å…·&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;çº¿ä¸Š/çº¿ä¸‹é¢„çƒ­é€šçŸ¥ç¾¤&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é¢„çƒ­æŠ¥è­¦é€šçŸ¥ç¾¤&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;é¢„çƒ­å›å½’diffæ£€æŸ¥å·¥å…·&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/%E9%A2%84%E7%83%AD%E6%A3%80%E6%9F%A5.jpg&#34; alt=&#34;é¢„çƒ­æ£€æŸ¥&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/preload-diff.png&#34; alt=&#34;preload-diff&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;å®¹é”™å¤„ç†&#34;&gt;å®¹é”™å¤„ç†&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åˆ†å¸ƒå¼ä»»åŠ¡å¤„ç†ï¼Œå¦‚æœä¸€ä¸ªæœºå™¨æŒ‚äº†ä¸å½±å“ä»»åŠ¡å¤„ç†ï¼Œfailoveræœºåˆ¶&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä»»åŠ¡æ‰§è¡Œå¤±è´¥ä¼šå³æŠ¥è­¦æœºåˆ¶ï¼Œå¯ä»¥æ‰‹åŠ¨å¤„ç†é‡æ–°é¢„çƒ­ï¼Œè¿˜æœ‰è‡ªåŠ¨è½®è®­æ£€æŸ¥é¢„çƒ­æ˜¯å¦æˆåŠŸæœºåˆ¶ï¼Œå¦‚æœé¢„çƒ­å¤±è´¥ï¼Œä¼šåœ¨ä¸‹ä¸ªè½®è®­å‘¨æœŸå‡ºå‘é¢„çƒ­ï¼Œ è½®è®­å‘¨æœŸå¯è°ƒï¼Œé»˜è®¤æ˜¯10åˆ†é’Ÿ&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æŠ€æœ¯éš¾ç‚¹å’Œæ”¶ç›Š&#34;&gt;æŠ€æœ¯éš¾ç‚¹å’Œæ”¶ç›Š&lt;/h2&gt;
&lt;h3 id=&#34;ç»„ç»‡å¼•æ“&#34;&gt;ç»„ç»‡å¼•æ“ï¼š&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ä¸šåŠ¡æ•°æ®æºæ¢³ç†ï¼Œè®¾è®¡é€šç”¨çš„æ¨¡å‹ï¼Œé€šè¿‡ç­–ç•¥é…ç½®å°†ä¸å±äºè¯¾ä¸­ç›´æ’­ä¸­å°çš„ä¸šåŠ¡å±æ€§è¿›è¡Œéš”ç¦»&lt;/strong&gt;ï¼Œ&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚å”®å–å¹³å°å’Œè¾…å¯¼ä¾§è¿è¥å¹³å° å”®å–çš„è¯¾ç¨‹äº§å“ï¼Œåˆ†ç­æ’ç®¡ç­ç­–ç•¥ï¼Œä»¥åŠè¯¾ç¨‹ä¸­æ¯ä¸€èŠ‚å¤§çº²ç« èŠ‚ä¸šåŠ¡å±æ€§ï¼Œéƒ½é€šè¿‡è¯¾å‰é¢„çƒ­çš„æ—¶å€™è¿›è¡Œè§£è€¦ï¼Œç”Ÿæˆè¯¾ä¸­ç†è§£çš„å†…èšæ¨¡å‹ï¼Œç›´æ’­é—´ï¼Œç»„ç»‡æ ‘ï¼›ä¸»è®²ï¼Œè¾…å¯¼è€å¸ˆå’Œå­¦ç”Ÿåœ¨ç›´æ’­é—´ä¸Šè¯¾ï¼Œé€šè¿‡ç»„ç»‡æ ‘è¿›è¡Œäº’åŠ¨ï¼›è¯¾ä¸­å­¦ç”Ÿè€å¸ˆè¿›å…¥æ•™å®¤è·å–è¯¾å‰ç»‘å®šçš„ç­–ç•¥ï¼Œåˆå§‹åŒ–ç›´æ’­é—´å’Œç»„ç»‡æ ‘å±æ€§ã€‚è¿™æ ·èƒ½å¤Ÿæœç”¨å·²æœ‰æ²‰æ·€ä¸‹æ¥çš„ç¨³å®šåŠŸèƒ½ï¼›è€Œä¸”åœ¨æ”¯æŒæ–°ä¸šåŠ¡ç›´æ’­åœºæ™¯ä¸‹ï¼ŒèŠ‚çœå¼€å‘äººåŠ›ï¼ŒåŠ é€Ÿäº§å“è¿­ä»£ï¼Œå°†ä¸šåŠ¡å±æ€§éš”ç¦»ï¼Œä¹Ÿæœ‰åŠ©äºæœåŠ¡ç¨³å®šè¿è¡Œ&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;ç»„ç»‡æ ‘åœ¨åˆ†å¸ƒå¼ç¼“å­˜å’Œæ•°æ®åº“ä¸­çš„è®¾è®¡ï¼›&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å¦‚ä½•åœ¨k/vå­˜å‚¨ä¸­è¡¨ç¤ºä¸€é¢—ç»„ç»‡æ ‘ï¼Œä»¥åŠåœ¨dbæ•°æ®åº“è¡¨ä¸­è¡¨ç¤ºä¸€é¢—ç»„ç»‡æ ‘å’Œå­¦ç”Ÿï¼Œè€å¸ˆä¹‹é—´çš„å…³ç³»ï¼›&lt;/p&gt;
&lt;p&gt;æ•°æ®åº“éœ€è¦è€ƒè™‘æ¯å¤©çš„æ•°æ®å®¹é‡ï¼Œä»¥åŠæœªæ¥3å¹´çš„æ•°æ®å®¹é‡(æŒ‰ä¸€å¤©2wèŠ‚è¯¾ï¼Œä¸€èŠ‚è¯¾3w+æŠ¥åï¼Œä¼°ç®—78GBæ•°æ®é‡)ï¼›&lt;/p&gt;
&lt;p&gt;ä¸ºäº†æ–¹ä¾¿è¯¾åé—®é¢˜æ’æŸ¥ï¼Œç¼“å­˜æ•°æ®è¿‡æœŸæ—¶é—´7å¤©ï¼ˆå¯è°ƒæ•´ï¼‰ï¼Œè¯¾ä¸­æ¥å£æ˜¯ç›´æ¥å’Œç¼“å­˜äº¤äº’ï¼Œæ”¹å˜çš„æ•°æ®çŠ¶æ€é€šè¿‡Write behindæ¨¡å¼å¼‚æ­¥åˆ·ç›˜å†™å…¥dbä¸­ï¼Œåå°çš„æ¥å£æ•°æ®é€šè¿‡Cache aside è¯¾å‰é¢„è¯»æå‰åŠ è½½è‡³ç¼“å­˜ä¸­(å»¶è¿ŸåŒåˆ )ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;åŠå¤œ0ç‚¹ï½6ç‚¹è¿™æ®µæ—¶é—´éœ€è¦ä¿è¯å½“å¤©é¢„çƒ­æ•°æ®çš„é«˜æ•ˆæ€§ï¼Œå‡†ç¡®æ€§ï¼Œä»¥åŠå¯è§†åŒ–ç›‘æ§æŠ¥è­¦&lt;/strong&gt;:&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;â€‹	1. &lt;strong&gt;é¢„çƒ­æ¡†æ¶çš„è®¾è®¡&lt;/strong&gt; ï¼Œä¸šåŠ¡æ•°æ®å’Œè¯¾ä¸­ç›´æ’­ç»„ç»‡æ¨¡å‹ ç­–ç•¥ç»‘å®šå¹³å°ï¼Œç”Ÿäº§é¢„çƒ­ä»»åŠ¡ï¼Œè´Ÿè½½å‡è¡¡åˆ†å‘è‡³é¢„çƒ­workerèŠ‚ç‚¹ï¼Œè®°å½•é¢„çƒ­ï¼Œä»»åŠ¡ç›‘æ§(é¢„çƒ­å’Œæ£€æŸ¥)ï¼Œé¢„çƒ­å¤±è´¥çš„å®¹é”™ï¼Œfailoverï¼ŒæŠ¥è­¦ï¼›&lt;/p&gt;
&lt;p&gt;â€‹	å°†ä¸šåŠ¡å±æ€§å’Œç›´æ’­å±æ€§é€šè¿‡ç­–ç•¥è¿›è¡Œç»‘å®šï¼Œç”Ÿæˆä»»åŠ¡å‘é€ç»™æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—pusheråˆ° é¢„çƒ­æ¨¡å—, åˆ©ç”¨å†…éƒ¨çš„nmqå·¥å…·å±æ€§ï¼Œè¿›è¡Œä»»åŠ¡çš„è´Ÿè½½å‡è¡¡å‘å¸ƒåˆ°æ¯å°workeråç¨‹æ¥é¢„çƒ­ï¼Œè€ƒè™‘åˆ°å¯èƒ½ä¼šåŒæ—¶å‘å¤šä¸ªç›¸åŒçš„ä»»åŠ¡åœ¨ä¸åŒçš„workerä¸Šæ‰§è¡Œï¼Œéœ€è¦åŠ é”ï¼›é¢„çƒ­è®°å½•åœ¨é¢„çƒ­è®°å½•è¡¨ä¸­ï¼Œè¿›è¡Œç›‘æ§ï¼›&lt;/p&gt;
&lt;p&gt;â€‹	æ¯ä¸ªé¢„çƒ­workerä¼šç»Ÿè®¡æœ¬æœºå¤„ç†çš„ç« èŠ‚ï¼Œç›´æ’­é—´ï¼Œç»„ç»‡èŠ‚ç‚¹/æ ‘ï¼Œå­¦ç”Ÿæ•°ç›®ï¼Œé¢„çƒ­å®Œä¹‹åï¼Œé€šè¿‡ä¸ä¸é€šçŸ¥é¢„çƒ­ç»“æœï¼Œä¹Ÿä¼šåŒæ—¶è§¦å‘æ•°æ®æ£€æŸ¥æµç¨‹ï¼›&lt;/p&gt;
&lt;p&gt;â€‹	ä¸ºäº†æ”¯æŒä¸åŒçš„é¢„çƒ­åœºæ™¯ï¼ŒåŠ å…¥äº†æé€Ÿé¢„çƒ­ï¼Œå¿«é€Ÿé¢„çƒ­ç­–ç•¥ï¼Œæ»¡è¶³æ–°å»ºä¸€ä¸ªè¯¾ç›´æ¥ä¸Šè¯¾çš„åœºæ™¯(è¿™äº›åœºæ™¯åœ¨å†…éƒ¨è€å¸ˆçš„æµ‹è¯•è¯¾ä¼šä½¿ç”¨åˆ°), ç§’çº§å†…å®Œæˆï¼›&lt;/p&gt;
&lt;p&gt;â€‹&lt;/p&gt;
&lt;p&gt;â€‹	2. &lt;strong&gt;é¢„çƒ­æ•°æ®æ£€æŸ¥&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;â€‹	æ£€æŸ¥é¢„çƒ­æ•°æ®çš„å®Œæ•´æ€§ï¼Œé€šè¿‡å’Œæ•°æ®æºçš„å¯¹æ¯”ï¼Œæ£€æŸ¥ç»‘å®šçš„ç­–ç•¥å±æ€§æ˜¯å¦æ˜¯å¥½çš„ï¼›ç¼“å­˜å’Œdbä¸­çš„ç›´æ’­é—´ï¼Œç»„ç»‡æ•°æ®ï¼Œä»¥åŠå­¦ç”Ÿæ‰€åœ¨ç»„ç»‡æ ‘ï¼Œè€å¸ˆæ‰€åœ¨çš„ç›´æ’­é—´ç­‰æ•°æ®çš„æ£€æŸ¥&lt;/p&gt;
&lt;p&gt;â€‹	æ‰¹é‡æ•°æ®æ£€æŸ¥ä¸èƒ½å½±å“çº¿ä¸Šçš„ç¨³å®šæ€§ï¼Œä¸»è¦æ˜¯è¯»å–çº¿ä¸Šç¼“å­˜å’Œdbä¸­çš„æ•°æ®ï¼Œä¹Ÿä¼šåƒé¢„çƒ­é‚£æ ·åˆ†å‘åˆ°é›†ç¾¤æœºå™¨ä¸Šå»å¹¶è¡Œå¤„ç†ï¼›å¦‚æœæ˜¯ä¸šåŠ¡é«˜å³°æœŸè¿›è¡Œæ£€æŸ¥ï¼Œéœ€è¦å¯¹æ£€æŸ¥æµé‡è¿›è¡Œé™æµï¼Œ&lt;/p&gt;
&lt;p&gt;é™æµæ–¹æ¡ˆï¼šå¯¹å•æœºè¿›è¡Œé™æµï¼Œå¯¹æ•´ä½“æ£€æŸ¥é›†ç¾¤è¿›è¡Œé™æµï¼Œéƒ½æ˜¯ä»¥å½“å‰è¿è¡Œçš„æ£€æŸ¥ä»»åŠ¡æ•°è¿›è¡Œè®¡æ•°é™æµæ§åˆ¶(redis hincr)ï¼›æ¯ä¸ªæ£€æŸ¥workerè¿›ç¨‹ä¼šç»Ÿè®¡å½“å‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡æ•°ï¼Œå¦‚æœåˆ°äº†å•æœºæœ€å¤§ä»»åŠ¡æ•°ï¼Œæ–°çš„æ£€æŸ¥è¯·æ±‚ä¼šç›´æ¥è¿”å›æ£€æŸ¥å®¹é‡å·²è¶…é™åˆ¶é”™è¯¯ï¼Œpusherä¼šé‡è¯•åˆ°å¦å¤–ä¸€å°æœºå™¨ä¸Šï¼Œ&lt;/p&gt;
&lt;p&gt;â€‹	3. &lt;strong&gt;é¢„çƒ­æ•°æ®ç›‘æ§&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;â€‹	è¯¾å‰ é¢„çƒ­ä»»åŠ¡å’Œæ£€æŸ¥ä»»åŠ¡çš„ç›‘æ§ï¼›&lt;/p&gt;
&lt;p&gt;â€‹	è¯¾å‰ ä¸šåŠ¡æ•°æ®å’Œè¯¾ä¸­ç›´æ’­ç»„ç»‡æ¨¡å‹ ç»‘å®šç­–ç•¥ï¼Œ è€å¸ˆç›´æ’­é—´ï¼Œç»„ç»‡æ ‘ï¼Œå­¦ç”Ÿç­‰æ•°æ®ï¼Œåœ¨ç¼“å­˜ï¼Œdbä¸­çš„ç›‘æ§ï¼›&lt;/p&gt;
&lt;p&gt;â€‹	è¯¾ä¸­ ç›´æ’­é—´çŠ¶æ€ï¼Œæ‰€åœ¨ç»„ç»‡æ ‘ä¸‹çš„å­¦ç”Ÿæ•°æ®çŠ¶æ€çš„ç›‘æ§ï¼›&lt;/p&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;&lt;strong&gt;éœ€è¦è€ƒè™‘è¯¾å‰ï¼Œè¯¾ä¸­çš„å¼‚åŠ¨åœºæ™¯&lt;/strong&gt;ï¼Œæ¯”å¦‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;â€‹	è¯¾å‰ï¼Œè¾…å¯¼ä¾§ç»™åˆ†å¥½ç­çš„å­¦ç”Ÿé‡æ–°åˆ†ç­ï¼Œéœ€è¦è®¢é˜…è¾…å¯¼æµ‹çš„å¼‚åŠ¨ï¼Œå¦‚æœæ˜¯åŒä¸€æ—¶é—´æ‰¹é‡ä¿®æ”¹ï¼Œè¯¾ä¸­ç›´æ’­ä¸­å°é¢„çƒ­å¥½çš„ç»„ç»‡æ ‘éœ€è¦è€ƒè™‘ å¹¶å‘å¼‚åŠ¨ä¿®æ”¹å­¦ç”Ÿæ‰€åœ¨çš„èŠ‚ç‚¹ï¼›&lt;/p&gt;
&lt;p&gt;â€‹	è¯¾ä¸­ï¼Œå¹¶å‘åœºæ™¯åŠ¨æ€æ‰©å®¹ï¼Œæ¯”å¦‚å­¦ç”Ÿè¿›å…¥æ•™å®¤ä¹‹å‰éœ€è¦é€‰ç»„ï¼Œå¦‚æœåˆå§‹å°ç»„èŠ‚ç‚¹ä¸å¤Ÿï¼Œåˆ°äº†é˜ˆå€¼ï¼Œå‘é€æ‰©å®¹ä»»åŠ¡ï¼Œé€šè¿‡å¼‚æ­¥åŠ¨æ€æ‰©å®¹åç¨‹è¿›è¡Œæ‰©å®¹ï¼›&lt;/p&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;&lt;strong&gt;è¯¾ä¸­è·å–ç¼“å­˜æ•°æ®çš„æ¥å£ä¼˜åŒ–ï¼Œåˆ†å¸ƒå¼ç¼“å­˜ä¸­çš„å¤§keyå’Œçƒ­keyçš„ä¼˜åŒ–&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;â€‹	å¤§keyä¼˜åŒ– é€šè¿‡åˆ†ç‰‡å¤„ç†ï¼Œç›´æ’­é—´çš„åœ¨çº¿å­¦ç”Ÿé›†åˆ å’Œ æŠ¥åå­¦ç”Ÿé›†åˆï¼Œå¯¹key è¿›è¡Œpartitionåˆ†ç‰‡ï¼Œæ¯ä¸ªpartition 5000ä¸ªå­¦ç”Ÿï¼Œ partitionçš„å€¼æ˜¯åœ¨è¯¾å‰é¢„çƒ­çš„æ—¶å€™é€šè¿‡æŠ¥åäººæ•°å’Œè¯¾ç¨‹çš„åº“å­˜æ•°é‡è¿›è¡ŒåŠ æƒå’Œé¢„ä¼°çš„å€¼ï¼›&lt;/p&gt;
&lt;p&gt;â€‹	çƒ­keyä¼˜åŒ– é€šè¿‡åŠ æœ¬åœ°ç¼“å­˜ï¼Œé€šè¿‡LRUè¿›è¡Œevictï¼Œæ¯”å¦‚ ä¸€ä¸ªè€å¸ˆä¸Šè¯¾æ—¶äº§ç”Ÿçš„ä¿¡ä»¤åˆ—è¡¨(ç›´æ’­é—´ç»´åº¦ï¼ŒæŒ‰æ—¶é—´é¡ºåº)ï¼Œå­˜æ”¾åœ¨zsetä¸­ï¼Œæä¾›å­¦ç”Ÿè¿›å…¥æ•™å®¤æ—¶æ‹‰å–ï¼Œä»¥åŠæ•°æ®æ»åæ—¶å€™çš„æ‹‰å–ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªçƒ­é—¨ç›´æ’­é—´ï¼Œä¼šåŒæ—¶ä¸Šä¸‡ä¸ªå­¦ç”Ÿè·å–è¿™ä¸ªè€å¸ˆäº§ç”Ÿçš„ä¿¡ä»¤åˆ—è¡¨ï¼Œä¼šå¯¹åˆ†å¸ƒå¼ç¼“å­˜ä¸­çš„slotå¸¦äº†å‹åŠ›ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°†ä»¥è·å–çš„ä¿¡ä»¤åˆ—è¡¨æ•°æ®ç¼“å­˜åˆ°æœ¬åœ°çš„æœ‰åºåˆ—è¡¨ä¸­(sortedlist -&amp;gt; skiplist), è¿™äº›æœ‰åºåˆ—è¡¨é€šè¿‡ç›´æ’­é—´ç»´åº¦hashåˆ†æ¡¶ï¼Œ æœ¬åœ°çš„æœ‰åºåˆ—è¡¨æ•°æ®åªéœ€ç»´æŠ¤ æ–°å¢çš„æ•°æ®ï¼Œè€Œä¸éœ€è¦æ•´æ®µå»è·å–ç¼“å­˜ï¼Œå‡å°‘è·å–çƒ­keyçš„ç½‘ç»œioï¼› è¿™é‡Œä¼šæ‰“ç‚¹è®°å½•æ¯ä¸ªkeyçš„hitå‘½ä¸­/missæœªå‘½ä¸­çš„æ•°æ®é‡ï¼Œæ•°æ®æ—¥å¿—é‡‡é›†æ¥å…¥åŸºç¡€ç›‘æ§å¹³å°ï¼Œå®æ—¶æŸ¥çœ‹ï¼›&lt;/p&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;æ–°ä¸šåŠ¡æ¥å…¥ï¼Œå¯¹æ–°ç­–ç•¥çš„å¢åŠ ï¼Œä»¥åŠå¯¹è€ç­–ç•¥çš„ä¿®æ”¹ï¼Œå¦‚ä½•ä¿è¯ç³»ç»Ÿç¨³å®šæ€§&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿›è¡Œé¢„çƒ­é€»è¾‘å‡çº§ä¹‹åï¼Œä¸Šçº¿ä¹‹å‰éƒ½ä¼šåœ¨çº¿ä¸‹è¿›è¡Œä¸€è½®æœªæ”¹ç­–ç•¥çš„é¢„çƒ­æ•°æ®è‡ªåŠ¨åŒ–diffï¼Œæ˜¯æ‹‰å–ä¸åŒçš„ç‰ˆæœ¬ï¼Œè¿˜æœªåˆå…¥masterçš„çº¿ä¸Šç‰ˆæœ¬å’Œä¿®æ”¹äº†çš„ç‰ˆæœ¬ï¼Œåˆ†å¸ƒéƒ¨ç½²åœ¨ä¸¤ä¸ªå®¹å™¨ä¸­ï¼›æ ¹æ®ä¸åŒçš„ç›´æ’­åœºæ™¯ï¼Œä»çº¿ä¸Šè·å–æ•°æ®ï¼Œé¢„çƒ­å†™å…¥çº¿ä¸‹ç¼“å­˜å®ä¾‹k/vå’Œæ•°æ®åº“å®ä¾‹è¡¨ä¸­ï¼Œç„¶ååˆ†åˆ«è¯»å–ä¸¤ä»½æ•°æ®è¿›è¡Œå¯¹æ¯”ï¼Œæ¯”è¾ƒä¸ºä¿®æ”¹çš„ç­–ç•¥æ˜¯å¦æœ‰å½±å“ï¼Œæœ‰æ•°æ®diff, å¹¶æŠ¥å‘Šdiffçš„æ•°æ®ç‚¹ï¼Œè¿›è¡Œçº¿ä¸‹ä¿®å¤ï¼Œå†æ¬¡è¿›è¡Œè‡ªåŠ¨åŒ–diff, æ— diffä¹‹åï¼Œæ‰èƒ½åˆå¹¶åˆ°masterä¸Šçº¿åˆ†æ”¯ï¼Œä¸Šçº¿ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;å»ºè®¾ç»„ç»‡å¼•æ“è¯¾å‰é¢„çƒ­æ•´ä½“æ”¶ç›Š&#34;&gt;å»ºè®¾ç»„ç»‡å¼•æ“è¯¾å‰é¢„çƒ­æ•´ä½“æ”¶ç›Šï¼š&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;èŠ‚çº¦äº†äººåŠ›ï¼ŒåŠ é€Ÿäº§å“å¼€å‘è¿­ä»£å‘¨æœŸï¼›ä»¥å‰å¦‚æœæ¥å…¥æ–°çš„ä¸šåŠ¡è¾…å¯¼ä¾§æ•°æ®ï¼Œä»¥åŠæä¾›ç›¸å…³çš„è¯¾ä¸­æ¥å£ï¼Œä»å¼€å‘ï¼Œæµ‹è¯•ä¸Šçº¿ï¼Œå¤§æ¦‚3ï½4ä¸ªäººåŠ›ï¼Œéœ€è¦2ï½3å‘¨çš„æ—¶é—´ï¼Œ æ”¹é€ ä¹‹åï¼Œå¼€å‘ï¼Œæµ‹è¯•ä¸Šçº¿ï¼Œå¤§æ¦‚1-2ä¸ªäººï¼Œéœ€è¦1å‘¨çš„å¼€å‘æ—¶é—´ï¼ŒèŠ‚çº¦äº†ä¸€åŠçš„æˆæœ¬ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¤ç”¨ç°æœ‰ç›´æ’­åœºæ™¯åŠŸèƒ½ï¼Œå°†åº•å±‚ä¸šåŠ¡å’Œç›´æ’­å±æ€§è¿›è¡Œéš”ç¦»ï¼Œ ç›´æ’­åªå…³æ³¨ç›´æ’­å±æ€§ï¼Œæ— éœ€å…³æ³¨ä¸šåŠ¡å±æ€§ï¼›ä¿è¯ç›´æ’­æœåŠ¡çš„ç¨³å®šæ€§ï¼Œå°†ä¸šåŠ¡æ•°æ®æä¾›è§„èŒƒåŒ–æ¥å…¥åï¼Œå¯ä»¥å°†ä¸šåŠ¡ä¾èµ–è¿›è¡Œåæ­£ï¼Œä¸ºåç»­saasåŒ–æä¾›ä¿éšœï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç›´æ’­æ¥å£æ€§èƒ½æœ‰æ‰€æé«˜ï¼Œä»¥å‰æ˜¯æœ‰ä¸åŒçš„ä¸šåŠ¡æ–¹å»æŠŠæ§ï¼Œç°åœ¨æ”¶æ•›æ•´ä½“æŠŠæ§ï¼Œé™ä½èµ„æºæ¶ˆè€—ï¼ˆcpu, å†…å­˜ï¼Œç£ç›˜ç©ºé—´ï¼Œç½‘ç»œio)ï¼Œæœ‰äº›ä¸šåŠ¡å½“æ—¶è¿˜æ˜¯ç”¨phpå¼€å‘ï¼Œphpæ˜¯å¤šè¿›ç¨‹çš„æ–¹å¼å¤„ç†ä¸šåŠ¡è¯·æ±‚é€»è¾‘ï¼Œç›¸å¯¹äºgoåç¨‹ï¼Œå ç”¨èµ„æºæ›´å¤šï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ç³»ç»Ÿæ›´åŠ ç¨³å®šï¼Œå¼•å…¥è‡ªåŠ¨åŒ–å·¥å…·æ£€æŸ¥é¢„çƒ­æ•°æ®ï¼Œç›‘æ§æŠ¥è­¦æœºåˆ¶ï¼Œä¿®æ”¹ç­–ç•¥çº¿ä¸‹æ£€æŸ¥æœºåˆ¶ï¼Œèƒ½ä¿éšœç³»ç»Ÿç¨³å®šå‡çº§ï¼Œå‡å°‘çº¿ä¸Šå‡ºé”™ç‡ï¼›&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;qa&#34;&gt;Q&amp;amp;A&lt;/h2&gt;
&lt;p&gt;Qï¼šè¯¾å‰é¢„çƒ­ç›´æ’­é—´æ•°æ®ä¸ºä»€ä¹ˆé€‰æ‹©å…ˆå†™ç¼“å­˜ï¼Œç„¶ååœ¨é€šè¿‡mqå¼‚æ­¥è½dbå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Aï¼š å› ä¸ºé¢„çƒ­çš„è¿‡ç¨‹æ˜¯å¼‚æ­¥å¤šå°æœºå™¨å•æœºè¿›ç¨‹å¹¶è¡Œé¢„çƒ­ï¼Œè¿›ç¨‹ä¸­é€šè¿‡åç¨‹å¹¶å‘å¤„ç†æµç¨‹é¢„çƒ­ï¼Œä¸ºäº†é¢„çƒ­æé€Ÿï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœç›´æ¥å†™db, ç„¶ååœ¨æ›´æ–°ç¼“å­˜ï¼Œå› ä¸ºmysqlæ˜¯ä¸»ä»æ¶æ„ï¼Œé¢„çƒ­æ˜¯å†™å¤šè¯»å¤šåœºæ™¯ï¼Œ å†™å¤šæ˜¯å› ä¸ºé¢„çƒ­æ•°æ®åˆå§‹å†™å…¥æ•°æ®åº“ï¼Œè¯»å¤šæ˜¯å› ä¸ºæ•°æ®å…¥åº“ä¹‹åï¼Œä¼šé€šçŸ¥æ¥å£ç¼“å­˜æ¨¡å—å»è¯·æ±‚è¯»dbæ¥å£ç¼“å­˜æ•°æ®(æ¥å£æ•°æ®ä¸ºç©ºï¼Œä¸ä¼šå­˜å‚¨ï¼Œéƒ½ä¸ºinsertæ“ä½œæˆåŠŸä¹‹åï¼Œæ‰é€šçŸ¥æ¥å£ç¼“å­˜æ¨¡å—ï¼Œä¸ä¼šå‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µ)ï¼›è¯»è¯·æ±‚å¯ä»¥é€šè¿‡å¤šä¸ªä»æ¥åˆ†æ‹…ï¼Œä½†æ˜¯å†™çš„è¯éƒ½æ˜¯åœ¨ä¸»ä¸Šï¼Œåˆ†åº“åˆ†è¡¨éƒ½æ˜¯åœ¨å•å®ä¾‹ä¸Š, å•æœºæŠ—å¤§é‡å†™è¯·æ±‚ä¼šæˆä¸ºæ•´ä½“é¢„çƒ­çš„ç“¶é¢ˆï¼›&lt;/p&gt;
&lt;p&gt;å¦‚æœç›´æ¥å†™å…¥ç¼“å­˜ï¼Œç„¶åmqå¼‚æ­¥è½db çš„å½¢å¼å¯ä»¥å……åˆ†åˆ©ç”¨ç¼“å­˜æ¯”ç£ç›˜è¯»å†™ioé€Ÿåº¦å¿«çš„ä¼˜åŠ¿ï¼Œç¼“å­˜çš„å®ä¾‹éƒ¨ç½²æ˜¯ä»¥proxyçš„å½¢å¼åˆ†å¸ƒå¼éƒ¨ç½²ï¼Œå¯ä»¥å¯¹slotåˆ†ç‰‡è¿›è¡Œè¯»å†™ æ‰©å®¹ï¼Œåˆ†æ•£è¯»å†™å‹åŠ›ï¼›ä¸ä¼šæˆä¸ºé¢„çƒ­çš„ç“¶é¢ˆï¼›ï¼ˆä»¥å‰æ˜¯æ— ä¸­å¿ƒåŒ–çš„å½¢å¼é€šè¿‡ä¸šåŠ¡ä½¿ç”¨æ–¹ä¸€è‡´æ€§hash æ¥è®¿é—®åˆ†å¸ƒå¼ç¼“å­˜slotåˆ†ç‰‡, åé¢æ”¹æˆproxyä¸­å¿ƒåŒ–çš„æ–¹å¼ï¼Œç»Ÿä¸€ç®¡ç†æ–¹ä¾¿è¿ç»´ï¼Œä¸šåŠ¡ä½¿ç”¨æ–¹ç›´æ¥é€šè¿‡redisåè®®è¯·æ±‚ï¼Œæ— éœ€å…³å¿ƒåˆ†ç‰‡æ“ä½œï¼‰&lt;/p&gt;
&lt;p&gt;é€šè¿‡mqå¼‚æ­¥è½dbï¼Œmqæ˜¯é€šè¿‡pushçš„æ–¹å¼ç›´æ¥å‘ç»™åç«¯æ¥å£å…¥åº“çš„ï¼Œé™ä½mqçš„pushçš„å¹¶å‘çª—å£ï¼Œå¯ä»¥å‡å°‘pushé¢‘ç‡ï¼Œé™ä½åç«¯æ¥å£çš„è¯·æ±‚é‡ï¼Œä½†æ˜¯ä¼šæ¶ˆè´¹å˜æ…¢ï¼Œä¸ºäº†åŠ å¿«æ“ä½œï¼Œå¯¹å‘é€ç»™mqçš„æ•°æ®è¿›è¡Œbuffer å¤„ç†ï¼Œæ‰¹é‡å‘é€ï¼Œé€šè¿‡åç«¯æ¥å£æ‰¹é‡å†™å…¥æ•°æ®åº“ï¼Œå‡å°‘ç½‘ç»œi/o, æé«˜å†™å…¥ååé‡ï¼›&lt;/p&gt;
&lt;p&gt;Q: é¢„çƒ­è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰ä¸Šçº¿ï¼Œé¢„çƒ­ä¸­æ–­äº†ï¼Œæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Aï¼š åœ¨é¢„çƒ­çš„æ—¶å€™ä¼šä¸ŠæŠ¥é¢„çƒ­çš„å¯åŠ¨çŠ¶æ€ï¼Œ æ—è·¯è„šæœ¬æ¯åŠå°æ—¶ä¼šæ£€æŸ¥ä¸€æ¬¡é¢„çƒ­çš„å¯åŠ¨çŠ¶æ€ï¼Œå¦‚æœä¸€ç›´å¤„äºè¿è¡Œä¸­ï¼Œåˆ™æŠ¥è­¦ï¼Œæ ¹æ®é˜ˆå€¼åˆ¤æ–­(æ¯”å¦‚æŠ¥åäººæ•°ä¼°ç®—å¤„é¢„çƒ­æ—¶é—´ï¼ŒæŠ¥è­¦æ¬¡æ•°) è§¦å‘è‡ªåŠ¨é¢„çƒ­é‡æ–°é¢„çƒ­ä¸Šï¼›é¢„çƒ­ç›‘æ§åå°ä¹Ÿæä¾›äº†æ‰‹åŠ¨è§¦å‘é¢„çƒ­ï¼›&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæ²¡æœ‰åƒæ•°æ®åº“é‚£æ ·ä½¿ç”¨WALæœºåˆ¶ï¼ˆè¿›ç¨‹crashåï¼Œç¼“å­˜ä¸­çš„æ•°æ®æ²¡æœ‰äº†ï¼Œå¯ä»¥é€šè¿‡WALæ—¥å¿—æ‰¾å›ï¼‰ï¼Œä¸šåŠ¡åœºæ™¯å¯ä»¥å›æº¯æ•°æ®ï¼ŒæŒ‰ç« èŠ‚æˆ–è€…ç›´æ’­é—´é‡æ–°é¢„çƒ­&lt;/p&gt;
&lt;p&gt;Q: ç»„ç»‡æ ‘çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Aï¼š å°†ä¸šåŠ¡ç»„ç»‡å…³ç³»è¿›è¡Œè§£å¶ï¼Œå¦‚æœæ¥å…¥å…¶ä»–ä¸šåŠ¡ç»„ç»‡å…³ç³»ï¼Œåªéœ€è¦æä¾›åŸå§‹æ•°æ®ï¼Œå°±å¯ä»¥æœåŠ¡ç”¨è¯¾ä¸­çš„ç»„ç»‡å…³ç³»èƒ½åŠ›ï¼Œæä¾›è¯¾ä¸­ç»„ç»‡å…³ç³»ä¸‹çš„ç›´æ’­äº’åŠ¨ï¼›è¯¾ä¸­ç»„ç»‡æ ‘æ˜¯å¯ä»¥åŠ¨æ€æ‰©å±•çš„ï¼Œæ»¡è¶³è¯¾ä¸­æŠ¥åäººæ•°çªå¢çš„æƒ…å†µï¼›&lt;/p&gt;
&lt;p&gt;Q: åç»­ä¼šæä¾›ç”¨æˆ·ç»´åº¦çš„ç»„ç»‡æ ‘æ“ä½œæ¥å£å—ï¼Ÿ&lt;/p&gt;
&lt;p&gt;Aï¼š ç°åœ¨æ˜¯é€šè¿‡é‡‡é›†å…¶ä»–å¹³å°çš„ç»„ç»‡æ•°æ®è¿›è¡Œä¸€ä»½è½¬åŒ–ç”Ÿæˆæä¾›ç»™è¯¾ä¸­ç›´æ’­äº’åŠ¨ä½¿ç”¨çš„ç»„ç»‡æ ‘ï¼Œåç»­æä¾›ç›¸å…³çš„åŸºç¡€è¯»å†™æ¥å£æ¥åˆå§‹/æ›´æ”¹é¢„çƒ­æ•°æ®ï¼Œä½¿ç”¨æ–¹åªéœ€è¦åœ¨æ„é€ ä¸šåŠ¡ç»„ç»‡ç»“æ„çš„æ—¶å€™è°ƒç”¨å†™å…¥ç¼“å­˜&lt;/p&gt;
&lt;p&gt;Q: ç°åœ¨ä¸šåŠ¡æ•°æ®é‡æœ‰å¤šå¤§ï¼Ÿ&lt;/p&gt;
&lt;p&gt;A: ç³»ç»Ÿæ˜¯æŒ‰ç…§æœ€å¤§é‡ä¼°ç®—çš„ï¼Œä¸€å¤©å¤§æ¦‚æ€»å…± 2w * 4M =  78GBæ•°æ®å¯èƒ½éœ€è¦è¯¾å‰é¢„çƒ­ ï¼ˆæŠ¥åå­¦ç”Ÿ2w*3w =6äº¿ï¼‰&lt;/p&gt;
&lt;p&gt;Q: æ˜¯å¦è€ƒè™‘ç”¨å·¥ä½œæµä»»åŠ¡è°ƒåº¦çš„æ–¹å¼å¤„ç†å‘¢ï¼Ÿ&lt;/p&gt;
&lt;p&gt;A: æ­£åœ¨è€ƒè™‘ä¸­ï¼Œç°åœ¨æ–¹å¼æ˜¯åå°ç»‘å®šå¥½é¢„çƒ­ç­–ç•¥ï¼ŒæŠŠç­–ç•¥å‘åˆ°æ¶ˆæ¯é˜Ÿåˆ—é‡Œï¼Œç„¶åé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è´Ÿè½½å‡è¡¡æ¨é€ç»™é¢„çƒ­ä»»åŠ¡æ‰§è¡Œï¼›&lt;/p&gt;
&lt;p&gt;åé¢ä¼šä¼˜åŒ–æˆå·¥ä½œæµä»»åŠ¡è°ƒåº¦çš„æ–¹å¼ï¼Œå°†æ•´ä¸ªé¢„çƒ­æµç¨‹æ‹†åˆ†æˆå¯å•ç‹¬æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªDAGå·¥ä½œæµï¼Œé€šè¿‡ä»»åŠ¡è°ƒåº¦æ¨¡å—ï¼Œåˆ†å‘åˆ°é¢„çƒ­æ‰§è¡Œæœºå™¨ä¸Šæ‰§è¡Œï¼Œå…¥åº¦ä¸º0çš„ä»»åŠ¡å¼€å§‹å¯åŠ¨æ‰§è¡Œ&lt;/p&gt;</description>
      
    </item>
    
    <item>
      <title>ç½‘ç»œæ¨¡å‹</title>
      <link>https://weedge.github.io/post/poller/</link>
      <pubDate>Thu, 02 Sep 2021 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/poller/</guid>
      
        <description>&lt;p&gt;çœ‹äº†ä¸€äº›å¼€æºçš„ç½‘ç»œI/Oæ¨¡å‹æ¡†æ¶åº“ï¼Œå°è¯•ç€æŒ‰ç…§ç†è§£ç®€å•å®ç°ä¸€ä¸ªç›¸å¯¹ç®€å•çš„ç½‘ç»œI/Oæ¨¡å‹æ¡†æ¶ï¼Œç±»ä¼¼nettyçš„reactoræ¨¡å‹ã€‚&lt;/p&gt;
&lt;p&gt;Nettyçš„NIOæ¨¡å‹æ˜¯Reactorååº”å †æ¨¡å‹ï¼ˆReactorç›¸å½“äºæœ‰åˆ†å‘åŠŸèƒ½çš„å¤šè·¯å¤ç”¨å™¨Selectorï¼‰ã€‚æ¯ä¸€ä¸ªè¿æ¥å¯¹åº”ä¸€ä¸ªChannelï¼ˆå¤šè·¯æŒ‡å¤šä¸ªChannelï¼Œå¤ç”¨æŒ‡å¤šä¸ªè¿æ¥å¤ç”¨äº†ä¸€ä¸ªçº¿ç¨‹æˆ–å°‘é‡çº¿ç¨‹ï¼Œåœ¨NettyæŒ‡EventLoopï¼‰ï¼Œä¸€ä¸ªChannelå¯¹åº”å”¯ä¸€çš„ChannelPipelineï¼Œå¤šä¸ªHandlerä¸²è¡Œçš„åŠ å…¥åˆ°Pipelineä¸­ï¼Œæ¯ä¸ªHandlerå…³è”å”¯ä¸€çš„ChannelHandlerContextã€‚&lt;/p&gt;
&lt;p&gt;Reactor æ¨¡å¼çš„åŸºæœ¬å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Server ç«¯å®Œæˆåœ¨ &lt;code&gt;bind&amp;amp;listen&lt;/code&gt; ä¹‹åï¼Œå°† listenfd æ³¨å†Œåˆ° epollfd ä¸­ï¼Œæœ€åè¿›å…¥ event-loop äº‹ä»¶å¾ªç¯ã€‚å¾ªç¯è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ &lt;code&gt;select/poll/epoll_wait&lt;/code&gt; é˜»å¡ç­‰å¾…ï¼Œè‹¥æœ‰åœ¨ listenfd ä¸Šçš„æ–°è¿æ¥äº‹ä»¶åˆ™è§£é™¤é˜»å¡è¿”å›ï¼Œå¹¶è°ƒç”¨ &lt;code&gt;socket.accept&lt;/code&gt; æ¥æ”¶æ–°è¿æ¥ connfdï¼Œå¹¶å°† connfd åŠ å…¥åˆ° epollfd çš„ I/O å¤ç”¨ï¼ˆç›‘å¬ï¼‰é˜Ÿåˆ—ã€‚&lt;/li&gt;
&lt;li&gt;å½“ connfd ä¸Šå‘ç”Ÿå¯è¯»/å¯å†™äº‹ä»¶ä¹Ÿä¼šè§£é™¤ &lt;code&gt;select/poll/epoll_wait&lt;/code&gt; çš„é˜»å¡ç­‰å¾…ï¼Œç„¶åè¿›è¡Œ I/O è¯»å†™æ“ä½œï¼Œè¿™é‡Œè¯»å†™ I/O éƒ½æ˜¯éé˜»å¡ I/Oï¼Œè¿™æ ·æ‰ä¸ä¼šé˜»å¡ event-loop çš„ä¸‹ä¸€ä¸ªå¾ªç¯ã€‚ç„¶è€Œï¼Œè¿™æ ·å®¹æ˜“å‰²è£‚ä¸šåŠ¡é€»è¾‘ï¼Œä¸æ˜“ç†è§£å’Œç»´æŠ¤ã€‚&lt;/li&gt;
&lt;li&gt;è°ƒç”¨ &lt;code&gt;read&lt;/code&gt; è¯»å–æ•°æ®ä¹‹åè¿›è¡Œè§£ç å¹¶æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…å·¥ä½œçº¿ç¨‹å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;å·¥ä½œçº¿ç¨‹å¤„ç†å®Œæ•°æ®ä¹‹åï¼Œè¿”å›åˆ° event-loop çº¿ç¨‹ï¼Œç”±è¿™ä¸ªçº¿ç¨‹è´Ÿè´£è°ƒç”¨ &lt;code&gt;write&lt;/code&gt; æŠŠæ•°æ®å†™å› clientã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å‚è€ƒè¿™äº›ç½‘ç»œæ¨¡å‹ï¼Œé‡‡ç”¨golangå°è£…çš„åº•å±‚epoll/kqueueç³»ç»Ÿè°ƒç”¨æ–¹æ³•ï¼Œæ”¯æŒtcpåè®®ï¼Œå®ç°ä¸€ä¸ªç›¸å¯¹ç®€å•çš„ç½‘ç»œæ¨¡å‹ï¼Œæ¡†æ¶å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/im/main/go-epoll.png&#34; alt=&#34;go-epoll.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;ä»£ç å®ç°ï¼š&lt;a href=&#34;https://github.com/weedge/lib/tree/main/poller&#34;&gt;https://github.com/weedge/lib/tree/main/poller&lt;/a&gt;  (å¯¹ä¸€ä¸ªå¼€æºåº“è¿›è¡Œçš„æ”¹é€ ï¼Œcodecç¼–è§£ç å™¨å¾…å®Œå–„)&lt;/p&gt;
&lt;h4 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒï¼š&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/panjf2000/gnet&#34;&gt;gnet&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/cloudwego/netpoll&#34;&gt;netpoll&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/tidwall/evio&#34;&gt;evio&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/AlexStocks/getty&#34;&gt;getty&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/netty/netty&#34;&gt;netty&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/xinali/articles/issues/57&#34;&gt;Linuxç½‘ç»œç¼–ç¨‹æ¨¡å‹&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description>
      
    </item>
    
    <item>
      <title>æ•™å­¦ç›´æ’­æ¦‚æ‹¬</title>
      <link>https://weedge.github.io/post/jxzb/</link>
      <pubDate>Wed, 01 Sep 2021 22:04:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/jxzb/</guid>
      
        <description>&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯ï¼š&lt;/h2&gt;
&lt;p&gt;ä¸åŒäºå¸¸è§„çš„ä¸»æ’­äº’åŠ¨ç›´æ’­ï¼›æ•™å­¦ç›´æ’­ï¼Œé¢å‘k12äººç¾¤ï¼Œ&lt;/p&gt;
&lt;p&gt;å‰æœŸä¼šæœ‰è¯¾å‰çš„å‡†å¤‡å·¥ä½œæ¯”å¦‚è¯¾ç¨‹åˆ›å»ºï¼Œå­¦ç”Ÿè´­ä¹°æ•°æ®ï¼Œè€å¸ˆè¯¾ä»¶ï¼Œè¯•å·é¢˜ç›®çš„å‡†å¤‡ï¼›&lt;/p&gt;
&lt;p&gt;åŒå¸ˆæ¨¡å¼ï¼šå­¦ç”Ÿä¼šåˆ†é…ç»™ä¸åŒçš„è¾…å¯¼è€å¸ˆï¼Œè¾…å¯¼è€å¸ˆä¼šå¯¹å­¦ç”Ÿè¿›è¡Œåˆ†ç­å¤„ç†ï¼Œè¯¾ä¸­ä¹Ÿä¼šæœ‰å­¦ç”Ÿé€‰ç»„ä¸Šè¯¾äº’åŠ¨çš„åœºæ™¯ï¼Œè¾…å¯¼è€å¸ˆä¹Ÿå¯ä»¥ç»™å­¦ç”Ÿä¸Šè¯¾ï¼Œä¹Ÿä¼šåœ¨åå°è¿›è¡Œè·Ÿè¯¾ï¼Œç›‘ç£å­¦ç”Ÿä¸Šè¯¾ï¼›&lt;/p&gt;
&lt;p&gt;ç›¸å¯¹äºå¸¸è§„çš„ä¸»æ’­äº’åŠ¨ï¼Œä¼šæ¨¡æ‹Ÿçº¿ä¸‹ä¸Šè¯¾çš„åœºæ™¯åˆ°çº¿ä¸Šè¯¾ä¸­ç›´æ’­ï¼Œå½¢æˆä¸€å¥—çº¿ä¸Šæ•™å­¦ç›´æ’­é—´åœºæ™¯æ¨¡å¼&lt;/p&gt;
&lt;h2 id=&#34;ä¸šåŠ¡å‘å±•&#34;&gt;ä¸šåŠ¡å‘å±•ï¼š&lt;/h2&gt;
&lt;p&gt;è¯¾ä¸­ç›´æ’­æ˜¯æŒ‰ç« èŠ‚ç»´åº¦è¿›è¡Œç›´æ’­äº¤äº’çš„ï¼Œä¸€ä¸ªç« èŠ‚ä¸€ä¸ªç›´æ’­é—´ï¼›&lt;/p&gt;
&lt;p&gt;éšç€ä¸šåŠ¡å‘å±•ï¼Œå‡ºç°äº†ä¸€ä¸ªç« èŠ‚å¤šä¸ªä¸åŒç›´æ’­é—´çš„åœºæ™¯ï¼ˆå‡ºé•œï¼‰ï¼Œå¤šä¸ªç« èŠ‚å…±äº«ä¸€ä¸ªç« èŠ‚ç›´æ’­é—´çš„åœºæ™¯(å…±äº«ç›´æ’­é—´ï¼‰ï¼› ä¸€ä¸ªç« èŠ‚æœ‰2ä¸ªç›¸åŒè¯¾ä¸­ä¸»è®²ç›´æ’­é—´çš„åœºæ™¯ï¼ˆæ—å¬ï¼‰; åé¢æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¡ç”Ÿå‡ºå…¶ä»–ç»„åˆç©æ³•ï¼›&lt;/p&gt;
&lt;h2 id=&#34;ä¸Šè¯¾ä¸šåŠ¡æµç¨‹ä»‹ç»&#34;&gt;ä¸Šè¯¾ä¸šåŠ¡æµç¨‹ä»‹ç»ï¼š&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;å”®å–ä¾§å»ºè¯¾&lt;/strong&gt;ï¼šå”®å–è€å¸ˆåœ¨å”®å–åå°æ–°å»ºè¯¾ç¨‹ç« èŠ‚ï¼Œå®šä¹‰è¯¾ç¨‹ç« èŠ‚çš„å±æ€§ï¼Œå½¢æˆå”®å–å•†å“ä¸Šæ¶ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å­¦ç”Ÿä¾§è´­ä¹°æŠ¥å&lt;/strong&gt;ï¼šå­¦ç”Ÿåœ¨å”®å–é¡µé¢å¯ä»¥è´­ä¹°è¯¾ç¨‹ç« èŠ‚ä¸Šè¯¾ï¼Œæˆ–è€…0å…ƒè¯¾æ‰«äºŒç»´ç ç›´æ¥è´­ä¹°æŠ¥åä¸Šè¯¾ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¾…å¯¼ä¾§&lt;/strong&gt;ï¼š æ ¹æ®ä¸Šè¯¾ç”¨æˆ·çš„å¹´é¾„æ®µè¿›è¡Œåˆ†ç±»ï¼šä½å¹¼ï¼Œç­ä¸»ä»»ï¼Œç£å­¦ï¼Œ0è½¬åŒ–ç£å­¦ï¼›å¯¹æŠ¥åçš„ç”¨æˆ·è¯¾å‰æ’çŒç­ï¼Œä»¥å¤§ç­/å°ç­/å°ç»„çš„ç»„ç»‡å½¢å¼ä¸Šè¯¾ï¼›&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ•™å­¦ç›´æ’­è¯¾å‰é¢„çƒ­ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å°†å½“å¤©è¯¾å‰å‡†å¤‡çš„è¯¾ä»¶ï¼Œè¯•å·é¢˜ç›®ï¼Œè¯¾ç¨‹ç« èŠ‚è€å¸ˆè¾…å¯¼ç›¸å…³çš„ç­‰éçŠ¶æ€éæ˜“å˜æ¥å£æ•°æ®åœ¨ä¸Šè¯¾ä¹‹å‰é¢„çƒ­è‡³ç¼“å­˜ä¸­ï¼›å› ä¸ºè¯¾ä¸­ä¸Šè¯¾æ˜¯çªå‘æµé‡åœºæ™¯ï¼Œå‡å°‘å¯¹åå°æ¥å£dbçš„å¹¶å‘å‹åŠ›ï¼› å¯¹è¯¾ä¸­ä¸ä¼šå˜çš„æ¥å£æ•°æ®å¯ä»¥åŠ ä¸Šæœ¬åœ°ç¼“å­˜ï¼Œæé«˜ç›¸åº”ååæ•ˆç‡ï¼›(è¯»å¤šå†™å°‘åœºæ™¯æ¥å£ï¼Œcache-asideæ¨¡å¼ï¼‰&lt;/li&gt;
&lt;li&gt;è¯¾å‰å¯¹è¯¾ä¸­å¼‚åŠ¨æ˜“å˜æ•°æ®éœ€è¦ç›´æ’­é—´ç¼“å­˜ï¼Œä¸šåŠ¡ç»„ç»‡ç¼“å­˜ç­‰åˆå§‹åŒ–ç¼“å­˜æ•°æ®ï¼›æä¾›ç»™è¯¾ä¸­äº’åŠ¨åœºæ™¯ä½¿ç”¨ï¼›åé¢é€šè¿‡ä¸šåŠ¡ç­–ç•¥ç»‘å®šï¼ŒæŠŠä¸šåŠ¡ç»„ç»‡æ•°æ®æŠ½è±¡ä¸€ä¸ªè¯¾ä¸­ç†è§£çš„æ•°æ®æ¨¡å‹ï¼Œç›´æ’­é—´ç¼“å­˜ï¼Œ ç»„ç»‡æ ‘èŠ‚ç‚¹ç¼“å­˜ï¼Œå­¦ç”Ÿæ‰€åœ¨ç›´æ’­é—´èŠ‚ç‚¹ç¼“å­˜ç­‰åˆå§‹æ•°æ®ï¼›ï¼ˆåŸºäºè¿™ä¸ªè¯¾ä¸­ç¼“å­˜æ•°æ®æ¨¡å‹ï¼Œè¿›è¡Œç¼–ç ï¼Œéš”ç¦»ä¸šåŠ¡å±æ€§ï¼‰&lt;/li&gt;
&lt;li&gt;å¯¹äºå¼‚åŠ¨çŠ¶æ€æ˜“å˜æ›´æ–°é¢‘ç¹çš„æ¥å£ç›´æ¥è¯¾ä¸­ç¼“å­˜äº¤äº’ï¼Œå¼‚æ­¥è½ç›˜ï¼Œé™ä½ç›¸åº”å»¶è¿Ÿå‡å°‘å¯¹åå°æ¥å£çš„è¯»å†™å‹åŠ›ï¼›ï¼ˆå†™å¤šé¢‘ç¹åœºæ™¯æ¥å£ï¼Œwrite-behindæ¨¡å¼ï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æ•™å­¦ç›´æ’­è¯¾ä¸­äº’åŠ¨ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸åŒç”¨æˆ·è§’è‰²ç›´æ’­é“¾è·¯
&lt;ol&gt;
&lt;li&gt;è€å¸ˆç«¯ï¼šåˆå§‹åŒ–ç›´æ’­é—´(é…ç½®åŠ è½½ï¼Œä¸åŒçš„äº’åŠ¨ui, äº’åŠ¨åŠŸèƒ½æ˜¯å¦å¯ç”¨ï¼Œæµåª’ä½“appid/token)â†’ åŠ è½½è¯¾ä»¶(cocosèµ„æº) â†’è¿›å…¥ç›´æ’­é—´ â†’ é€šè¿‡æµåª’ä½“æ¨æµæ‹‰æµ/è¿éº¦/é€šè¿‡é•¿é“¾æ¥å‘é€èŠå¤©æ¶ˆæ¯å’Œä¿¡ä»¤â†’äº’åŠ¨ï¼ˆå‘é¢˜ç›®/ç­”æ¡ˆ/çº¢åŒ…/å¥–åŠ±ï¼‰â†’ åˆ‡æ¢ç›´æ’­é—´(è¾…å¯¼å‡ºé•œ)/ç»“æŸç›´æ’­&lt;/li&gt;
&lt;li&gt;å­¦ç”Ÿç«¯ï¼šåˆå§‹åŒ–ç›´æ’­é—´(é…ç½®åŠ è½½ï¼Œæµåª’ä½“appid/token, æµç¨‹é…ç½®)â†’åŠ è½½èµ„æº(cocosäº’åŠ¨èµ„æºåŒ…/aiæ¨¡å‹èµ„æºåŒ…)â†’ç­¾åˆ°/åˆ†ç»„â†’è¿›å…¥ç›´æ’­é—´â†’é€šè¿‡æµåª’ä½“æ‹‰æµæ¨æµ/è¿éº¦/é€šè¿‡é•¿é“¾æ¥å‘é€èŠå¤©æ¶ˆæ¯â†’äº’åŠ¨ï¼ˆå‘é¢˜ç›®/ç­”æ¡ˆ/çº¢åŒ…/å¥–åŠ±/pkï¼‰â†’ é€€å‡ºç›´æ’­é—´&lt;/li&gt;
&lt;li&gt;è¾…å¯¼è·Ÿè¯¾åå°ï¼šè¿›å…¥è·Ÿè¯¾åå°â†’ è¿›å…¥ç›´æ’­é—´â†’é€šè¿‡æµåª’ä½“æ‹‰æµ/é€šè¿‡é•¿é“¾æ¥å‘é€èŠå¤©æ¶ˆæ¯â†’å¤„ç†æŠ¥è­¦/é®ç›–/é‰´é»„/æ ‡è®°â†’ç›´æ’­ç»“æŸè·å–è®¡ç®—å¥½çš„å­¦ç”Ÿåˆ°è¯¾æ—¶é•¿ï¼Œä½œç­”ç‡ï¼Œå‡ºå‹¤ç‡ï¼Œå®Œè¯¾ç‡ç­‰&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;äº’åŠ¨ä¾èµ–é•¿é“¾æ¥ï¼Œç­”é¢˜ï¼Œpkç­‰åœºæ™¯ï¼Œéƒ½æœ‰å¼€å§‹åˆ°ç»“æŸçš„è¿‡ç¨‹ï¼Œå¯¹æ¯ä¸ªäº’åŠ¨åœºæ™¯ç”¨äº’åŠ¨idæ¥ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼Œæ¶‰åŠé‡‘é¢çš„äº’åŠ¨ï¼Œéœ€è¦è€ƒè™‘é»‘äº§çš„å½±å“ï¼Œéœ€è¦å¯¹ç­”æ¡ˆåŠ å¯†ï¼Œä»¥åŠé‡‘é¢çš„æå‰è®¡ç®—é¢„çƒ­å’Œé˜²æ­¢å¤šå‘å°‘å‘ï¼Œäº’åŠ¨è¯»å†™æ¥å£å°½é‡ç»†åŒ–ï¼Œé˜²æ­¢è¯»å†™ioå¤šåœ¨åŒä¸€ä¸ªæ¥å£ä¸­ï¼›å°½é‡æŠŠè®¡ç®—æ”¾åœ¨ç”¨æˆ·ç«¯æ¥å¤„ç†ï¼Œ æ¯”å¦‚ ç­”é¢˜æ˜¯å¦æˆåŠŸï¼Œpkæ˜¯å¦èµ¢äº†ç­‰ï¼Œåˆ†æ•£æœåŠ¡ç«¯æµé‡å‹åŠ›ï¼›(åŸåˆ™ï¼šç»Ÿä¸€ç®¡ç†äº’åŠ¨ç±»å‹ï¼Œå¯é…ç½®åŒ–ï¼Œç»†åŒ–io, è®¡ç®—å‰ç½®,åˆ†æµ)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;æ•™å­¦ç›´æ’­è¯¾åå›æ”¾ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å»ºè¯¾åç›´æ¥æ ¹æ®ç»‘å®šçš„ç­–ç•¥ç›´æ¥ç”Ÿæˆç›´æ’­é—´ï¼Œæä¾›å›æ”¾æ•°æ®ï¼Œæ¯”å¦‚ç´ å…»è¯¾ï¼Œä¼ªç›´æ’­&lt;/li&gt;
&lt;li&gt;è¯¾ä¸­çš„å›æ”¾æ•°æ®ï¼Œä¼šæœ‰ç›´æ’­é—´å’Œç”¨æˆ·äº’åŠ¨æœ€ç»ˆçŠ¶æ€æ•°æ®è½åº“&lt;/li&gt;
&lt;li&gt;å›æ”¾æ•°æ®æ˜¯ä¸ä¼šæ›´æ”¹ï¼Œè¯»å¤šå†™éå¸¸å°‘çš„åœºæ™¯ï¼Œç¼“å­˜ç›´æ¥é€šè¿‡cache-asideçš„æ¨¡å¼ç¼“å­˜dbåå°æ¥å£æ•°æ®&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;æ•™å­¦æ•´ä½“æ¦‚æ‹¬æ¶æ„&#34;&gt;æ•™å­¦æ•´ä½“æ¦‚æ‹¬æ¶æ„&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;https://raw.githubusercontent.com/weedge/mypic/master/zyb-jx.png&#34; alt=&#34;jxzb&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;æ€»ç»“æ€è€ƒ&#34;&gt;æ€»ç»“æ€è€ƒ&lt;/h2&gt;
&lt;p&gt;â€‹	åº•å±‚çš„åŸºç¡€å»ºè®¾æ¯”è¾ƒé‡è¦(&lt;strong&gt;é«˜æ•ˆèƒ½&lt;/strong&gt;)ï¼›ä¸Šå±‚ä¸šåŠ¡çš„å‘å±•ç¦»ä¸å¼€åŸºç¡€ç»„ä»¶çš„ç¨³å®šæ€§(&lt;strong&gt;é«˜å¯ç”¨&lt;/strong&gt;)ï¼›ä»¥åŠæœåŠ¡å¤šäº†ä¹‹åï¼Œå¦‚ä½•é«˜æ•ˆå¿«é€Ÿè¿­ä»£ï¼Œä¸Šçº¿ä¹‹åä¿è¯æ•´ä½“æœåŠ¡æ€§èƒ½çš„ç¨³å®šæ€§(&lt;strong&gt;é«˜å¹¶å‘/ä½å»¶è¿Ÿ/å¯ç›‘æ§/å¯é…ç½®&lt;/strong&gt;)ï¼› ä»¥åŠæœåŠ¡æ¨¡å—ä¹‹é—´çš„åˆ’åˆ†åˆç†ï¼Œç»†åŒ–å‡ºåŠŸèƒ½ç»„ä»¶ï¼Œå¼‚åŠ¨ä¸šåŠ¡ä»£ç çš„å¯ç»´æŠ¤æ€§ï¼ˆ&lt;strong&gt;ä½è€¦åˆé«˜å†…èš&lt;/strong&gt;ï¼‰ï¼›è¿™äº›éƒ½éœ€è¦ç†è®ºçŸ¥è¯†åŠ ä»¥æŒ‡å¯¼(æ¯”å¦‚æœåŠ¡åˆ’åˆ†æŠ½è±¡åŸåˆ™DDD, ä¸šåŠ¡æŠ½è±¡è®¾è®¡åŸåˆ™SOLID)ï¼Œä»¥åŠå®è·µåœºæ™¯ä¸­å»å¹³è¡¡æŠ˜ä¸­æ”¹è¿›ï¼›æ²¡æœ‰æ°¸æ’çš„é“¶å¼¹(å†…å·)ï¼Œå°šéœ€ä¸æ–­è¿­ä»£æé«˜ã€‚ä¸€ä¸ªå­— &amp;ldquo;ç¨³&amp;rdquo;ã€‚&lt;/p&gt;
&lt;h2 id=&#34;references&#34;&gt;references&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://www.infoq.cn/theme/119&#34;&gt;ä½œä¸šå¸®äº‘åŸç”Ÿæ¢ç´¢å’Œå®è·µ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.infoq.cn/article/9jn0qfcx2xq7h6xltwa9&#34;&gt;å­¦è€Œæ€ç½‘æ ¡ç›´æ’­è¯¾å ‚çš„æ¶æ„æ¼”è¿›ä¹‹è·¯&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://insights.thoughtworks.cn/tag/domain-driven-design/&#34;&gt;Thoughtworksæ´è§-é¢†åŸŸé©±åŠ¨è®¾è®¡&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://tech.meituan.com/2020/03/19/design-pattern-practice-in-marketing.html&#34;&gt;è®¾è®¡æ¨¡å¼åœ¨ç¾å›¢å¤–å–è¥é”€ä¸šåŠ¡ä¸­çš„å®è·µ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://tech.meituan.com/2017/12/22/ddd-in-practice.html&#34;&gt;é¢†åŸŸé©±åŠ¨è®¾è®¡åœ¨äº’è”ç½‘ä¸šåŠ¡å¼€å‘ä¸­çš„å®è·µ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://read.douban.com/ebook/169386436/&#34;&gt;æ¶æ„æ•´æ´ä¹‹é“&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://sre.google/books/&#34;&gt;google-sre-book&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://2012.33degree.org/pdf/JamesLewisMicroServices.pdf&#34;&gt;JamesLewisMicroServices.pdf&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://icyfenix.cn/&#34;&gt;å‡¤å‡°æ¶æ„&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.infoq.cn/article/6dlQZisMiXK3hzLIwEET&#34;&gt;å¾®æœåŠ¡æ¶æ„è®¾è®¡ä¸­çš„è®¾è®¡æ¨¡å¼ã€åŸåˆ™åŠæœ€ä½³å®è·µ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s/mojOSgEUaHWGU3H3j7WjlQ&#34;&gt;å¾®æœåŠ¡æ‹†åˆ†ä¹‹é“&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://book.douban.com/subject/26938710/&#34;&gt;ç³»ç»Ÿæ¶æ„-å¤æ‚ç³»ç»Ÿçš„äº§å“è®¾è®¡ä¸å¼€å‘&lt;/a&gt;: ç†è®ºçŸ¥è¯†ï¼Œå¤šè¯»å¤šæ€è€ƒå¤šå®è·µï¼Œ&amp;lsquo;&amp;lsquo;è™šå®&#39;&amp;lsquo;ç»“åˆ&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&#34;https://mp.weixin.qq.com/s?__biz=MzIzNjUxMzk2NQ==&amp;amp;mid=2247497722&amp;amp;idx=1&amp;amp;sn=33df39c492c508b2086a704612edf186&#34;&gt;æ¶æ„æŒ‡å¯¼åŸåˆ™&lt;/a&gt;&lt;/strong&gt;: å€¼å¾—åå¤æ¨æ•²ï¼Œå†…åŒ–ï¼Œå›é¡¾ä»¥å¾€åšè¿‡çš„é¡¹ç›®ï¼Œæ€»ç»“å‡ºåº•å±‚åŸç†&lt;/li&gt;
&lt;/ol&gt;</description>
      
    </item>
    
    <item>
      <title>ç›´æ’­ç³»åˆ—ä¹‹æ¶ˆæ¯æ¨¡å—æ¼”è¿›</title>
      <link>https://weedge.github.io/post/jxzbim/</link>
      <pubDate>Mon, 02 Nov 2020 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/jxzbim/</guid>
      
        <description>&lt;h4 id=&#34;æ•´ä½“æœåŠ¡æ¡†æ¶&#34;&gt;æ•´ä½“æœåŠ¡æ¡†æ¶&lt;/h4&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/weedge/im/blob/main/zbim.png?raw=true&#34; alt=&#34;zbim&#34;&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>policy worker</title>
      <link>https://weedge.github.io/todo/policyworker/</link>
      <pubDate>Wed, 10 Jun 2020 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/todo/policyworker/</guid>
      
        <description>&lt;h4 id=&#34;ç­–ç•¥æ¨¡å‹&#34;&gt;ç­–ç•¥æ¨¡å‹&lt;/h4&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4&#34;&gt;&lt;code class=&#34;language-go&#34; data-lang=&#34;go&#34;&gt;&lt;span style=&#34;color:#00a&#34;&gt;package&lt;/span&gt; main

&lt;span style=&#34;color:#00a&#34;&gt;import&lt;/span&gt; (
  &lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;sync/atomic&amp;#34;&lt;/span&gt;
  &lt;span style=&#34;color:#a50&#34;&gt;&amp;#34;time&amp;#34;&lt;/span&gt;
)

&lt;span style=&#34;color:#00a&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#0a0&#34;&gt;loadConfig&lt;/span&gt;() &lt;span style=&#34;color:#00a&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#0aa&#34;&gt;string&lt;/span&gt;]&lt;span style=&#34;color:#0aa&#34;&gt;string&lt;/span&gt; {
  &lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;// ä»æ•°æ®åº“æˆ–è€…æ–‡ä»¶ç³»ç»Ÿä¸­è¯»å–é…ç½®ä¿¡æ¯ï¼Œç„¶åä»¥mapçš„å½¢å¼å­˜æ”¾åœ¨å†…å­˜é‡Œ
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#00a&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#0aa&#34;&gt;make&lt;/span&gt;(&lt;span style=&#34;color:#00a&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#0aa&#34;&gt;string&lt;/span&gt;]&lt;span style=&#34;color:#0aa&#34;&gt;string&lt;/span&gt;)
}

&lt;span style=&#34;color:#00a&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#0a0&#34;&gt;requests&lt;/span&gt;() &lt;span style=&#34;color:#00a&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#0aa&#34;&gt;int&lt;/span&gt; {
  &lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;// å°†ä»å¤–ç•Œä¸­æ¥å—åˆ°çš„è¯·æ±‚æ”¾å…¥åˆ°channelé‡Œ
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#00a&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#0aa&#34;&gt;make&lt;/span&gt;(&lt;span style=&#34;color:#00a&#34;&gt;chan&lt;/span&gt; &lt;span style=&#34;color:#0aa&#34;&gt;int&lt;/span&gt;)
}

&lt;span style=&#34;color:#00a&#34;&gt;func&lt;/span&gt; &lt;span style=&#34;color:#0a0&#34;&gt;main&lt;/span&gt;() {
  &lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;// configå˜é‡ç”¨æ¥å­˜æ”¾è¯¥æœåŠ¡çš„é…ç½®ä¿¡æ¯
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#00a&#34;&gt;var&lt;/span&gt; config atomic.Value
  &lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;// åˆå§‹åŒ–æ—¶ä»åˆ«çš„åœ°æ–¹åŠ è½½é…ç½®æ–‡ä»¶ï¼Œå¹¶å­˜åˆ°configå˜é‡é‡Œ
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;  config.&lt;span style=&#34;color:#0a0&#34;&gt;Store&lt;/span&gt;(&lt;span style=&#34;color:#0a0&#34;&gt;loadConfig&lt;/span&gt;())
  &lt;span style=&#34;color:#00a&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;func&lt;/span&gt;() {
    &lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;// æ¯10ç§’é’Ÿå®šæ—¶çš„æ‹‰å–æœ€æ–°çš„é…ç½®ä¿¡æ¯ï¼Œå¹¶ä¸”æ›´æ–°åˆ°configå˜é‡é‡Œ
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#00a&#34;&gt;for&lt;/span&gt; {
      time.&lt;span style=&#34;color:#0a0&#34;&gt;Sleep&lt;/span&gt;(&lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt; * time.Second)
      &lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;// å¯¹åº”äºèµ‹å€¼æ“ä½œ config = loadConfig()
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;      config.&lt;span style=&#34;color:#0a0&#34;&gt;Store&lt;/span&gt;(&lt;span style=&#34;color:#0a0&#34;&gt;loadConfig&lt;/span&gt;())
    }
  }()
  &lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;// åˆ›å»ºå·¥ä½œçº¿ç¨‹ï¼Œæ¯ä¸ªå·¥ä½œçº¿ç¨‹éƒ½ä¼šæ ¹æ®å®ƒæ‰€è¯»å–åˆ°çš„æœ€æ–°çš„é…ç½®ä¿¡æ¯æ¥å¤„ç†è¯·æ±‚
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#00a&#34;&gt;for&lt;/span&gt; i := &lt;span style=&#34;color:#099&#34;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span style=&#34;color:#099&#34;&gt;10&lt;/span&gt;; i++ {
    &lt;span style=&#34;color:#00a&#34;&gt;go&lt;/span&gt; &lt;span style=&#34;color:#00a&#34;&gt;func&lt;/span&gt;() {
      &lt;span style=&#34;color:#00a&#34;&gt;for&lt;/span&gt; r := &lt;span style=&#34;color:#00a&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#0a0&#34;&gt;requests&lt;/span&gt;() {
        &lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;// å¯¹åº”äºå–å€¼æ“ä½œ c := config
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;        &lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;// ç”±äºLoad()è¿”å›çš„æ˜¯ä¸€ä¸ªinterface{}ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å…ˆå¼ºåˆ¶è½¬æ¢ä¸€ä¸‹
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;        c := config.&lt;span style=&#34;color:#0a0&#34;&gt;Load&lt;/span&gt;().(&lt;span style=&#34;color:#00a&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#0aa&#34;&gt;string&lt;/span&gt;]&lt;span style=&#34;color:#0aa&#34;&gt;string&lt;/span&gt;)
        &lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;// è¿™é‡Œæ˜¯æ ¹æ®é…ç½®ä¿¡æ¯å¤„ç†è¯·æ±‚çš„é€»è¾‘...
&lt;/span&gt;&lt;span style=&#34;color:#aaa;font-style:italic&#34;&gt;&lt;/span&gt;        _, _ = r, c
      }
    }()
  }
}

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒï¼š&lt;/h4&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.betacat.io/post/golang-atomic-value-exploration/&#34;&gt;https://blog.betacat.io/post/golang-atomic-value-exploration/&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
      
    </item>
    
  </channel>
</rss>
