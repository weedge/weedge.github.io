<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>附近POI: geohash原理 - 时间飘过</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="weedge" />
  <meta name="description" content="问题  现在吃穿住行的app大都有定位的功能；如何让手机app所在的定位寻找出附近的POI(Point of Interest)呢？至于用户手机是如何获取定位的可以自行Google/Baidu，有时间整理一下。
地图上定位一个地方，通过经度(longitude)和纬度(latitude)来标记，由WGS84规定(为GPS全球定位系统使用而建立的坐标系统)；比如地球🌍作为一个球体，纬度是指所在位置的纬线到地心的直线和赤道的纬线到地心的直线的夹角，通常北纬为正，南纬为负；经度是指所在位置的经线平面和规定的本初子午线平面的夹角，以东为东经，以西为西经，通常东经为正，西经为负；
一个地点的经度一般与它于协调世界时之间的时差相应：每天有24小时，而一个圆圈有360度，因此地球每小时自转15度。因此假如一个人的地方时比协调世界UTC(Coordinated Universal Time)时早3小时的话，那么他在东经45度左右，比如北京是在东经116左右，那时区&#43;8作为中国标准时间CST(China Standard Time)
" />

  <meta name="keywords" content="工作, 技术, 生活" />






<meta name="generator" content="Hugo 0.91.0" />


<link rel="canonical" href="https://weedge.github.io/post/geohash/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css" integrity="sha256-&#43;ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media="screen" crossorigin="anonymous">




<link rel="stylesheet" href="/css/copy-to-clipboard.css">


<meta property="og:title" content="附近POI: geohash原理" />
<meta property="og:description" content="问题
  现在吃穿住行的app大都有定位的功能；如何让手机app所在的定位寻找出附近的POI(Point of Interest)呢？至于用户手机是如何获取定位的可以自行Google/Baidu，有时间整理一下。
地图上定位一个地方，通过经度(longitude)和纬度(latitude)来标记，由WGS84规定(为GPS全球定位系统使用而建立的坐标系统)；比如地球🌍作为一个球体，纬度是指所在位置的纬线到地心的直线和赤道的纬线到地心的直线的夹角，通常北纬为正，南纬为负；经度是指所在位置的经线平面和规定的本初子午线平面的夹角，以东为东经，以西为西经，通常东经为正，西经为负；
一个地点的经度一般与它于协调世界时之间的时差相应：每天有24小时，而一个圆圈有360度，因此地球每小时自转15度。因此假如一个人的地方时比协调世界UTC(Coordinated Universal Time)时早3小时的话，那么他在东经45度左右，比如北京是在东经116左右，那时区&#43;8作为中国标准时间CST(China Standard Time)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://weedge.github.io/post/geohash/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2015-06-03T00:26:23+08:00" />
<meta property="article:modified_time" content="2018-05-03T00:26:23+08:00" />

<meta itemprop="name" content="附近POI: geohash原理">
<meta itemprop="description" content="问题
  现在吃穿住行的app大都有定位的功能；如何让手机app所在的定位寻找出附近的POI(Point of Interest)呢？至于用户手机是如何获取定位的可以自行Google/Baidu，有时间整理一下。
地图上定位一个地方，通过经度(longitude)和纬度(latitude)来标记，由WGS84规定(为GPS全球定位系统使用而建立的坐标系统)；比如地球🌍作为一个球体，纬度是指所在位置的纬线到地心的直线和赤道的纬线到地心的直线的夹角，通常北纬为正，南纬为负；经度是指所在位置的经线平面和规定的本初子午线平面的夹角，以东为东经，以西为西经，通常东经为正，西经为负；
一个地点的经度一般与它于协调世界时之间的时差相应：每天有24小时，而一个圆圈有360度，因此地球每小时自转15度。因此假如一个人的地方时比协调世界UTC(Coordinated Universal Time)时早3小时的话，那么他在东经45度左右，比如北京是在东经116左右，那时区&#43;8作为中国标准时间CST(China Standard Time)"><meta itemprop="datePublished" content="2015-06-03T00:26:23+08:00" />
<meta itemprop="dateModified" content="2018-05-03T00:26:23+08:00" />
<meta itemprop="wordCount" content="3288">
<meta itemprop="keywords" content="geo,geohash," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="附近POI: geohash原理"/>
<meta name="twitter:description" content="问题
  现在吃穿住行的app大都有定位的功能；如何让手机app所在的定位寻找出附近的POI(Point of Interest)呢？至于用户手机是如何获取定位的可以自行Google/Baidu，有时间整理一下。
地图上定位一个地方，通过经度(longitude)和纬度(latitude)来标记，由WGS84规定(为GPS全球定位系统使用而建立的坐标系统)；比如地球🌍作为一个球体，纬度是指所在位置的纬线到地心的直线和赤道的纬线到地心的直线的夹角，通常北纬为正，南纬为负；经度是指所在位置的经线平面和规定的本初子午线平面的夹角，以东为东经，以西为西经，通常东经为正，西经为负；
一个地点的经度一般与它于协调世界时之间的时差相应：每天有24小时，而一个圆圈有360度，因此地球每小时自转15度。因此假如一个人的地方时比协调世界UTC(Coordinated Universal Time)时早3小时的话，那么他在东经45度左右，比如北京是在东经116左右，那时区&#43;8作为中国标准时间CST(China Standard Time)"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">时间飘过</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/about/">About</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      时间飘过
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/about/">About</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">附近POI: geohash原理</h1>
      
      <div class="post-meta">
        <time datetime="2015-06-03" class="post-time">
          2015-06-03
        </time>
        <div class="post-category">
            <a href="https://weedge.github.io/categories/%E6%8A%80%E6%9C%AF/"> 技术 </a>
            <a href="https://weedge.github.io/categories/geo/"> geo </a>
            
          </div>
        

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#问题">问题</a></li>
        <li><a href="#解决方案">解决方案</a></li>
        <li><a href="#方案概要">方案概要</a></li>
        <li><a href="#geohash">GeoHash</a></li>
        <li><a href="#抛出问题">抛出问题</a></li>
        <li><a href="#参考">参考</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h3 id="问题">问题</h3>
<p>  现在吃穿住行的app大都有定位的功能；如何让手机app所在的定位寻找出附近的POI(Point of Interest)呢？至于用户手机是如何获取定位的可以自行Google/Baidu，有时间整理一下。</p>
<p>地图上定位一个地方，通过经度(longitude)和纬度(latitude)来标记，由WGS84规定(为GPS全球定位系统使用而建立的坐标系统)；比如地球🌍作为一个球体，纬度是指<code>所在位置的纬线到地心的直线</code>和<code>赤道的纬线到地心的直线</code>的夹角，通常北纬为正，南纬为负；经度是指<code>所在位置的经线平面</code>和<code>规定的本初子午线平面</code>的夹角，以东为东经，以西为西经，通常东经为正，西经为负；</p>
<p>一个地点的经度一般与它于协调世界时之间的时差相应：每天有24小时，而一个圆圈有360度，因此地球每小时自转15度。因此假如一个人的地方时比协调世界UTC(Coordinated Universal Time)时早3小时的话，那么他在东经45度左右，比如北京是在东经116左右，那时区+8作为中国标准时间CST(China Standard Time)</p>
<hr>
<h3 id="解决方案">解决方案</h3>
<p>通过app可以获取到定位信息经维度，以及后台POI(实时/离线)录入的经纬度信息，如何获取附近POI呢？</p>
<ul>
<li>直接按距离计算：定位的经纬度确定对应的地区；然后和所在地区中的所有商户POI经纬度信息进行距离计算，然后排序，找出最近几公里内的商户POI；这种方法比较暴力，遇到数据量大的时候，比较耗时；</li>
</ul>
<p>既然数据量大，采用分而治之的办法筛选查找：</p>
<ul>
<li>利用Mysql的B+tree索引进行范围筛选：直接按距离计算(经纬度建立索引)/GeoHash；</li>
<li>利用Mysql的Rtree空间索引(5.7.4+,InnoDB支持)：mysql空间数据类型(Point,LineString, Polygon)来进行检索；</li>
<li>利用PostgreSQL的PostGIS模块：通过R树 或 GIST树索引来实现空间索引，PostGIS 实现了Open Geospatial Consortium所提出的基本要素类（点、线、面、多点、多线、多面等）的SQL查询；</li>
<li>利用MongoDB: 依赖MongoDB的空间搜索算法(geoNear,near),底层也是对GeoHash进行B+tree索引;命令如下：  <code>db.runCommand({ geoNear: &quot;places&quot;, near: [30.545162, 104.062018], num:1000 })</code></li>
<li>将经纬度转换成GeoHash字符串，利用字典树查找term,找到对应倒排索引中的商户信息；</li>
<li>利用Redis(3.2+) GEO命令 <code>GEOADD GEOHASH GEOPOS GEODIST GEORADIUS GEORADIUSBYMEMBER</code></li>
<li><a href="https://s2geometry.io/">谷歌的 S² 算法</a>: 将基于希尔伯特曲线实现，算法性能要优于geohash；具体看官网介绍，具体细节还没有弄清楚，待续~</li>
</ul>
<p>从这些解决方案中可以总结出，根据对位置经纬度信息进行转换，然后结合具体的数据结构和算法来实现，适用不同场景:</p>
<ul>
<li>将经纬度信息转成一维的GeoHash字符串(表示对应位置的区块)，通过ziplist,B+树,字典树trie(倒排索引中的term存储结构)来索引，提供索搜查询；</li>
<li>将经纬度信息转换成多维的点线面空间信息，通过四叉树,R树,GIST树来索引，提供索搜查询;</li>
</ul>
<h3 id="方案概要">方案概要</h3>
<p>以上给出的具体实施方案，篇幅有限，这里主要是讨论GeoHash编码方式来表示空间信息。具体空间信息采集可以采集高德地图的接口，或者<a href="https://github.com/lzxue/WeiboDataShare">微博的一份数据</a></p>
<h3 id="geohash">GeoHash</h3>
<p>geohash 是 Gustavo Niemeyer 发明的一种对地理位置进行编码的算法；它是一种分级的数据结构，把空间划分为网格。Geohash 属于空间填充曲线中的 Z 阶曲线(<a href="https://en.wikipedia.org/wiki/Z-order_curve">Z-order curve</a>)的实际应用。</p>
<ul>
<li>通过二维的经纬度所在的区块表示成一维的字符串信息，字符串的长度越长，表示的区域范围更加精确。长度为9的geohash编码的精度能达到4米左右，10位的geohash经度能达到0.6米，一般情况下能满足我们大部分的需求；</li>
<li>geohash 生成的字符串代表的不是地图上的一个点，而是地图上一个矩形区域，在一定程度上能保证隐私(知道大概的位置)；</li>
<li>geohash编号后方便索引和缓存，具有公共前缀的geohash编码作为key/term 索引、查找附近区域的的POI信息；</li>
</ul>
<h4 id="原理">原理</h4>
<h4 id="编码步骤">编码步骤</h4>
<ol>
<li>首先将纬度范围(-90, 90)平分成两个区间(-90, 0)、(0, 90)， 如果目标纬度位于前一个区间，则编码为0，否则编码为1; 以此类推，直到精度符合要求为止;</li>
<li>经度也用同样的算法，对(-180, 180)依次细分;</li>
<li>接下来组码，将经度和纬度的编码合并，奇数位是纬度，偶数位是经度，得到二进制编码；</li>
<li>最后使用base32（0-9、b-z，去掉a,i,l,o，比较常用）或者base36编码(base36的版本对大小写敏感，用了36个字符，“23456789bBCdDFgGhHjJKlLMnNPqQrRtTVWX”)；这里采用base32方式进行操作，首先将组合好的二进制码转成对应的十进制（二进制每5位表示一个base32字符）；十进制对应base32编码表如下：</li>
</ol>
<p><img src="https://raw.githubusercontent.com/weedge/weedge.github.io/3368e1e7132b25ac24459dd137ac57e7a3c0fe2e/image/base32.png" alt="base32"></p>
<p>例如：将坐标 (39.97696,116.3764874)（latitude, longitude）编码成长度为12的字符串(base32编码) wx4g2jwf8tqx</p>
<p>精度表：</p>
<table>
<thead>
<tr>
<th style="text-align:center">length</th>
<th style="text-align:center">latitude bits</th>
<th style="text-align:center">longitude bits</th>
<th style="text-align:center">latitude error</th>
<th style="text-align:center">longitude error</th>
<th style="text-align:center">km error</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">2</td>
<td style="text-align:center">3</td>
<td style="text-align:center">±23</td>
<td style="text-align:center">±23</td>
<td style="text-align:center">±2500</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">5</td>
<td style="text-align:center">5</td>
<td style="text-align:center">±2.8</td>
<td style="text-align:center">±5.6</td>
<td style="text-align:center">±630</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">7</td>
<td style="text-align:center">8</td>
<td style="text-align:center">±0.70</td>
<td style="text-align:center">±0.70</td>
<td style="text-align:center">±78</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">10</td>
<td style="text-align:center">10</td>
<td style="text-align:center">±0.087</td>
<td style="text-align:center">±0.18</td>
<td style="text-align:center">±20</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">12</td>
<td style="text-align:center">13</td>
<td style="text-align:center">±0.022</td>
<td style="text-align:center">±0.022</td>
<td style="text-align:center">±2.4</td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center">15</td>
<td style="text-align:center">15</td>
<td style="text-align:center">±0.0027</td>
<td style="text-align:center">±0.0055</td>
<td style="text-align:center">±0.61</td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td style="text-align:center">17</td>
<td style="text-align:center">18</td>
<td style="text-align:center">±0.00068</td>
<td style="text-align:center">±0.00068</td>
<td style="text-align:center">±0.076</td>
</tr>
<tr>
<td style="text-align:center">8</td>
<td style="text-align:center">20</td>
<td style="text-align:center">20</td>
<td style="text-align:center">±0.00008</td>
<td style="text-align:center">±0.00017</td>
<td style="text-align:center">±0.019</td>
</tr>
<tr>
<td style="text-align:center">9</td>
<td style="text-align:center">22</td>
<td style="text-align:center">23</td>
<td style="text-align:center">±0.00002</td>
<td style="text-align:center">±0.000021</td>
<td style="text-align:center">±0.00478</td>
</tr>
<tr>
<td style="text-align:center">10</td>
<td style="text-align:center">25</td>
<td style="text-align:center">25</td>
<td style="text-align:center">±0.00000268</td>
<td style="text-align:center">±0.00000536</td>
<td style="text-align:center">±0.0005971</td>
</tr>
<tr>
<td style="text-align:center">11</td>
<td style="text-align:center">27</td>
<td style="text-align:center">28</td>
<td style="text-align:center">±0.00000067</td>
<td style="text-align:center">±0.00000067</td>
<td style="text-align:center">±0.0001492</td>
</tr>
<tr>
<td style="text-align:center">12</td>
<td style="text-align:center">30</td>
<td style="text-align:center">30</td>
<td style="text-align:center">±0.00000008</td>
<td style="text-align:center">±0.00000017</td>
<td style="text-align:center">±0.0000186</td>
</tr>
</tbody>
</table>
<p>geohash编码长度对应区域大小：</p>
<table>
<thead>
<tr>
<th style="text-align:center">length</th>
<th style="text-align:center">width</th>
<th style="text-align:center">height</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">5000km</td>
<td style="text-align:center">5000km</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">1250km</td>
<td style="text-align:center">625km</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">156km</td>
<td style="text-align:center">156km</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">39.1km</td>
<td style="text-align:center">19.5km</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">4.89km</td>
<td style="text-align:center">4.89km</td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center">1.22km</td>
<td style="text-align:center">0.61km</td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td style="text-align:center">153m</td>
<td style="text-align:center">153m</td>
</tr>
<tr>
<td style="text-align:center">8</td>
<td style="text-align:center">38.2m</td>
<td style="text-align:center">19.1m</td>
</tr>
<tr>
<td style="text-align:center">9</td>
<td style="text-align:center">4.77m</td>
<td style="text-align:center">4.77m</td>
</tr>
<tr>
<td style="text-align:center">10</td>
<td style="text-align:center">1.19m</td>
<td style="text-align:center">0.596m</td>
</tr>
<tr>
<td style="text-align:center">11</td>
<td style="text-align:center">149mm</td>
<td style="text-align:center">149mm</td>
</tr>
<tr>
<td style="text-align:center">12</td>
<td style="text-align:center">37.2mm</td>
<td style="text-align:center">18.6mm</td>
</tr>
</tbody>
</table>
<h4 id="解码步骤">解码步骤</h4>
<p>解码操作为编码操作的逆向过程，这里就省略(后续补上)</p>
<h4 id="获取相邻区域">获取相邻区域</h4>
<p>为啥要获取相邻区域呢？？？</p>
<p>根据编码算法定义不难看出，如果需要寻找附近多少米的POI，根据精度只要前缀匹配规定长度的字符串(可以把经常访问的前缀匹配的字符串表示的区域POI信息缓存起来)，比如坐标 (39.97696,116.3764874)对应成长度为12的字符串wx4g2jwf8tqx，想找附近500m的POI，长度为6的geohash编码能表示矩形区域在0.744平方千米左右（区域大小和geohash编码长度对应关系见上表），那么查询的时候就可缩小范围，找出那些前缀为wx4g2j的POI，与wx4g2jwf8tqx公共前缀匹配的长度越大，离得距离也就越近；</p>
<p>但是这种前缀匹配的方式存在一个临近边界问题，就是在区域的边界地方，在这个区域的相邻区域的公共前缀不同（长度按照区域大小选出），按照公共前缀匹配的方法会少筛选出一部分附近的POI;</p>
<p>解决的办法是将相邻的8块区域也算进来，扩大寻找范围，计算这些区域中的POI和所在位置的距离， 然后按距离排序筛选；</p>
<h4 id="待续-geohash-vs-s">待续 (Geohash vs S²)</h4>
<ul>
<li>
<p>Geohash 有12级，从5000km 到 3.7cm。中间每一级的变化比较大。有时候可能选择上一级会大很多，选择下一级又会小一些。比如选择字符串长度为4，它对应的区域宽度是39.1km，需求可能是50km，那么选择字符串长度为5，对应的区域宽度就变成了156km，瞬间又大了3倍了。这种情况选择多长的 Geohash 字符串就比较难选。选择不好，每次判断可能就还需要取出周围的8个格子再次进行判断。Geohash 需要 12 bytes 存储。</p>
</li>
<li>
<p>S² 有30级，从 0.7cm² 到 85,000,000km² 。中间每一级的变化都比较平缓，接近于4次方的曲线。所以选择精度不会出现 Geohash 选择困难的问题。S2 的存储只需要一个 uint64 即可存下。S²算法待续</p>
</li>
</ul>
<h3 id="抛出问题">抛出问题</h3>
<ul>
<li><input disabled="" type="checkbox"> 运动的个体(个体也可以当做POI)，如何获取附近实时运动的POI呢？ 实时计算方案呢？(像多人约会涉猎app)</li>
</ul>
<h3 id="参考">参考</h3>
<ul>
<li><a href="https://zh.wikipedia.org/wiki/%E7%BB%8F%E5%BA%A6">经度</a></li>
<li><a href="https://zh.wikipedia.org/wiki/%E7%BA%AC%E5%BA%A6">维度</a></li>
<li><a href="https://en.wikipedia.org/wiki/Geohash">GeoHash</a></li>
<li><a href="http://www.movable-type.co.uk/scripts/gis-faq-5.1.html">空间距离计算</a></li>
<li><a href="https://tech.meituan.com/lucene_distance.html">地理空间距离计算优化</a></li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/spatial-types.html">Mysql8.0 - Spatial Data Types</a></li>
<li><a href="https://postgis.net/workshops/postgis-intro/">PostGIS</a></li>
<li><a href="http://www.mongoing.com/mongodb-geo-index-1/">MongoDB地理索引初探</a></li>
<li><a href="http://blog.huangz.me/diary/2015/redis-geo.html">Redis GEO</a></li>
<li><a href="http://blog.huangz.me/diary/2015/annotated-redis-geo-source.html">Redis GEO源码</a></li>
<li><a href="https://halfrost.com/go_spatial_search/">高效的多维空间点索引算法 — Geohash 和 Google S2</a></li>
<li><a href="https://www.cnblogs.com/LBSer/p/3310455.html">GeoHash核心原理解析</a></li>
<li><a href="http://geohash.gofreerange.com/">GeoHash在线演示</a></li>
<li><a href="https://github.com/mmcloughlin/geohash">Geohash-GO</a></li>
<li><a href="https://github.com/weedge/geo">Geohash-PHP扩展</a></li>
</ul>
    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">weedge</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2018-05-03
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://weedge.github.io/tags/geo/">geo</a>
          <a href="https://weedge.github.io/tags/geohash/">geohash</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/use-hugo-blog/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">更换博客</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/gnu-global/">
            <span class="next-text nav-default">工具盒子-GNU global</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    显示 Disqus 评论
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = "https://weedge.github.io/post/geohash/";
    };
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'weedge';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:weege007@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/weedge" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://weibo.com/weedge" rel="me noopener" class="iconfont"
      title="weibo"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M385.714286 733.714286q12-19.428571 6.285714-39.428571t-25.714286-28.571429q-19.428571-8-41.714286-0.571429t-34.285714 26.285714q-12.571429 19.428571-7.428571 39.142857t24.571429 28.857143 42.571429 1.428571 35.714286-27.142857zm53.714286-69.142857q4.571429-7.428571 2-15.142857t-10-10.571429q-8-2.857143-16.285714 2.857143t-12.285714 10.571429q-9.714286 17.714286 7.428571 25.714286 8 2.857143 16.571429 2.857143t12.571429-10.571429zm99.428571 61.142857q-25.714286 58.285714-90.285714 85.714286t-128 6.857143q-61.142857-19.428571-84.285714-72.285714t3.714286-107.142857q26.857143-53.142857 86.571429-79.428571t120.285714-10.857143q63.428571 16.571429 90.571429 68.285714t1.428571 108.857143zm178.285714-91.428571q-5.142857-54.857143-50.857143-97.142857t-119.142857-62.285714-156.857143-12q-127.428571 13.142857-211.142857 80.857143t-75.714286 151.142857q5.142857 54.857143 50.857143 97.142857t119.142857 62.285714 156.857143 12q127.428571-13.142857 211.142857-80.857143t75.714286-151.142857zm176 2.285714q0 38.857143-21.142857 79.714286t-62.285714 78.285714-96.285714 67.142857-129.142857 47.428571-154.571429 17.714286-157.142857-19.142857-137.428571-53.142857-98-86.285714-37.142857-114q0-65.714286 39.714286-140t112.857143-147.428571q96.571429-96.571429 195.142857-134.857143t140.857143 4q37.142857 36.571429 11.428571 119.428571-2.285714 8-0.571429 11.428571t5.714286 4 8.285714 2.857143 7.714286-2l3.428571-1.142857q79.428571-33.714286 140.571429-33.714286t87.428571 34.857143q25.714286 36 0 101.714286-1.142857 7.428571-2.571429 11.428571t2.571429 7.142857 6.857143 4.285714 9.714286 3.428571q32.571429 10.285714 58.857143 26.857143t45.714286 46.571429 19.428571 66.571429zm-42.285714-356.571429q24 26.857143 31.142857 62t-3.714286 67.142857q-4.571429 13.142857-16.857143 19.428571t-25.428571 2.285714q-13.142857-4.571429-19.428571-16.857143t-2.285714-25.428571q11.428571-36-13.714286-63.428571t-61.142857-20q-13.714286 2.857143-25.714286-4.571429t-14.285714-21.142857q-2.857143-13.714286 4.571429-25.428571t21.142857-14.571429q34.285714-7.428571 68 3.142857t57.714286 37.428571zm103.428571-93.142857q49.714286 54.857143 64.285714 127.142857t-7.714286 138q-5.142857 15.428571-19.428571 22.857143t-29.714286 2.285714-22.857143-19.428571-2.857143-29.714286q16-46.857143 5.714286-98.285714t-45.714286-90.285714q-35.428571-39.428571-84.571429-54.571429t-98.857143-4.857143q-16 3.428571-29.714286-5.428571t-17.142857-24.857143 5.428571-29.428571 24.857143-16.857143q70.285714-14.857143 139.428571 6.571429t118.857143 76.857143z"></path>
</svg>

    </a>


<a href="https://weedge.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2013 -
    2023
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        weedge
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  









  <script id="dsq-count-scr" src="//weedge.disqus.com/count.js" async></script>






  <script src="/js/copy-to-clipboard.js"></script>


</body>
</html>
