<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>译：相似性搜索，第 5 部分：局部敏感哈希 (LSH) - 时间飘过</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="weedge" />
  <meta name="description" content="介绍 在数据科学中，相似性搜索经常出现在 NLP 领域、搜索引擎或推荐系统中，其中需要检索最相关的文档或项目以进行查询。有多种不同的方法可以提高海量数据的搜索性能。
在本系列文章的前几部分中，我们讨论了倒排文件索引、产品量化和 HNSW 以及如何将它们结合使用来提高搜索质量。在本章中，我们将研究一种主要不同的方法，该方法可以保持高搜索速度和质量。
 局部敏感哈希（LSH）是一组方法，用于通过将数据向量转换为哈希值来缩小搜索范围，同时保留有关其相似性的信息。
 我们将讨论传统方法，该方法包括三个步骤：
 Shingling：将原始文本编码为向量。 MinHashing ：将向量转换为称为签名的特殊表示，可用于比较它们之间的相似性。 LSH函数：将签名块散列到不同的桶中。如果一对向量的签名至少一次落入同一个桶中，则它们被视为候选向量。  我们将在整篇文章中逐步深入探讨每个步骤的细节。
" />

  <meta name="keywords" content="工作, 技术, 生活" />






<meta name="generator" content="Hugo 0.91.0" />


<link rel="canonical" href="https://weedge.github.io/post/oneday/similarity-search/5.locality-sensitive-hashing/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css" integrity="sha256-&#43;ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media="screen" crossorigin="anonymous">




<link rel="stylesheet" href="/css/copy-to-clipboard.css">


<meta property="og:title" content="译：相似性搜索，第 5 部分：局部敏感哈希 (LSH)" />
<meta property="og:description" content="
介绍
在数据科学中，相似性搜索经常出现在 NLP 领域、搜索引擎或推荐系统中，其中需要检索最相关的文档或项目以进行查询。有多种不同的方法可以提高海量数据的搜索性能。
在本系列文章的前几部分中，我们讨论了倒排文件索引、产品量化和 HNSW 以及如何将它们结合使用来提高搜索质量。在本章中，我们将研究一种主要不同的方法，该方法可以保持高搜索速度和质量。

局部敏感哈希（LSH）是一组方法，用于通过将数据向量转换为哈希值来缩小搜索范围，同时保留有关其相似性的信息。

我们将讨论传统方法，该方法包括三个步骤：

Shingling：将原始文本编码为向量。
MinHashing ：将向量转换为称为签名的特殊表示，可用于比较它们之间的相似性。
LSH函数：将签名块散列到不同的桶中。如果一对向量的签名至少一次落入同一个桶中，则它们被视为候选向量。

我们将在整篇文章中逐步深入探讨每个步骤的细节。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://weedge.github.io/post/oneday/similarity-search/5.locality-sensitive-hashing/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-09-26T15:26:23+08:00" />
<meta property="article:modified_time" content="2023-09-26T15:26:23+08:00" />

<meta itemprop="name" content="译：相似性搜索，第 5 部分：局部敏感哈希 (LSH)">
<meta itemprop="description" content="
介绍
在数据科学中，相似性搜索经常出现在 NLP 领域、搜索引擎或推荐系统中，其中需要检索最相关的文档或项目以进行查询。有多种不同的方法可以提高海量数据的搜索性能。
在本系列文章的前几部分中，我们讨论了倒排文件索引、产品量化和 HNSW 以及如何将它们结合使用来提高搜索质量。在本章中，我们将研究一种主要不同的方法，该方法可以保持高搜索速度和质量。

局部敏感哈希（LSH）是一组方法，用于通过将数据向量转换为哈希值来缩小搜索范围，同时保留有关其相似性的信息。

我们将讨论传统方法，该方法包括三个步骤：

Shingling：将原始文本编码为向量。
MinHashing ：将向量转换为称为签名的特殊表示，可用于比较它们之间的相似性。
LSH函数：将签名块散列到不同的桶中。如果一对向量的签名至少一次落入同一个桶中，则它们被视为候选向量。

我们将在整篇文章中逐步深入探讨每个步骤的细节。"><meta itemprop="datePublished" content="2023-09-26T15:26:23+08:00" />
<meta itemprop="dateModified" content="2023-09-26T15:26:23+08:00" />
<meta itemprop="wordCount" content="3963">
<meta itemprop="keywords" content="oneday,similarity search,Locality Sensitive Hashing ,lsh," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="译：相似性搜索，第 5 部分：局部敏感哈希 (LSH)"/>
<meta name="twitter:description" content="
介绍
在数据科学中，相似性搜索经常出现在 NLP 领域、搜索引擎或推荐系统中，其中需要检索最相关的文档或项目以进行查询。有多种不同的方法可以提高海量数据的搜索性能。
在本系列文章的前几部分中，我们讨论了倒排文件索引、产品量化和 HNSW 以及如何将它们结合使用来提高搜索质量。在本章中，我们将研究一种主要不同的方法，该方法可以保持高搜索速度和质量。

局部敏感哈希（LSH）是一组方法，用于通过将数据向量转换为哈希值来缩小搜索范围，同时保留有关其相似性的信息。

我们将讨论传统方法，该方法包括三个步骤：

Shingling：将原始文本编码为向量。
MinHashing ：将向量转换为称为签名的特殊表示，可用于比较它们之间的相似性。
LSH函数：将签名块散列到不同的桶中。如果一对向量的签名至少一次落入同一个桶中，则它们被视为候选向量。

我们将在整篇文章中逐步深入探讨每个步骤的细节。"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">时间飘过</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/about/">About</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      时间飘过
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/about/">About</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">译：相似性搜索，第 5 部分：局部敏感哈希 (LSH)</h1>
      
      <div class="post-meta">
        <time datetime="2023-09-26" class="post-time">
          2023-09-26
        </time>
        <div class="post-category">
            <a href="https://weedge.github.io/categories/%E6%8A%80%E6%9C%AF/"> 技术 </a>
            
          </div>
        

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#证明statement-proof">证明(Statement proof)</a></li>
  </ul>

  <ul>
    <li><a href="#例子">例子</a></li>
    <li><a href="#可视化visualisation">可视化(Visualisation)</a></li>
    <li><a href="#不同数量的band和行的实验">不同数量的band和行的实验</a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/0.png" alt=""></p>
<h1 id="介绍">介绍</h1>
<p>在数据科学中，相似性搜索经常出现在 NLP 领域、搜索引擎或推荐系统中，其中需要检索最相关的文档或项目以进行查询。有多种不同的方法可以提高海量数据的搜索性能。</p>
<p>在本系列文章的前几部分中，我们讨论了倒排文件索引、产品量化和 HNSW 以及如何将它们结合使用来提高搜索质量。在本章中，我们将研究一种主要不同的方法，该方法可以保持高搜索速度和质量。</p>
<blockquote>
<p><strong>局部敏感哈希</strong>（LSH）是一组方法，用于通过将数据向量转换为哈希值来缩小搜索范围，同时保留有关其相似性的信息。</p>
</blockquote>
<p>我们将讨论传统方法，该方法包括三个步骤：</p>
<ol>
<li><strong>Shingling</strong>：将原始文本编码为向量。</li>
<li><strong>MinHashing</strong> ：将向量转换为称为<strong>签名</strong>的特殊表示，可用于比较它们之间的相似性。</li>
<li><strong>LSH函数</strong>：将签名块散列到不同的桶中。如果一对向量的签名至少一次落入同一个桶中，则它们被视为候选向量。</li>
</ol>
<p>我们将在整篇文章中逐步深入探讨每个步骤的细节。</p>
<h1 id="shingling">Shingling</h1>
<p><strong>Shingling</strong> 是收集给定文本的k元模型的过程。k-gram是一组<em>k</em>个连续标记(token)。根据上下文，标记(token)可以是单词或符号。shingling 的最终目标是使用收集的<em>k</em>元模型对每个文档进行编码。我们将为此使用 one-hot 编码。然而，也可以应用其他编码方法。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/1.png" alt="img"></p>
<p><em>为“学习数据科学令人着迷(learning data science is fascinating)”这句话收集长度为 k = 3 的独特碎片(shingles)</em></p>
<p>首先，收集每个文档的唯一<em>k</em>元组。其次，为了对每个文档进行编码，需要一个词汇表来表示所有文档中一组唯一的<em>k</em>元组。然后，对于每个文档，创建一个长度等于词汇表大小的零向量。对于文档中出现的每个 k-gram，都会识别其在词汇表中的位置，并在文档向量的相应位置放置“1” 。即使相同的<em>k</em>元模型在文档中出现多次，也没关系：向量中的值将始终为 1。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/2.png" alt="img"></p>
<p>​	<em>one-hot编码</em></p>
<h1 id="最小散列法minhashing">最小散列法(MinHashing)</h1>
<p>在此阶段，初始文本已被向量化。向量的相似度可以通过<strong>Jaccard系数</strong>进行比较。请记住，两个集合的Jaccard系数定义为两个集合中公共元素的数量除以所有元素的长度。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/3.png" alt="img"></p>
<p>​	<em>Jaccard系数定义为两个集合的并集的交集</em></p>
<p>如果采用一对编码向量，则 Jaccard 系数公式中的交集是同时包含 1 的行数（即<em>k</em> -gram 出现在两个向量中），并集是至少包含一个 1 的行数（<em>k</em> -gram 至少出现在向量之一中）。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/4.png" alt="img"></p>
<p>​	<em>两个向量的Jaccard系数</em></p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/5.png" alt="img"></p>
<p>​	<em>使用上述公式计算两个向量的Jaccard系数的示例</em></p>
<p>目前的问题是编码向量的稀疏性。计算两个 one-hot 编码向量之间的相似度得分将花费大量时间。将它们转换为密集格式将使以后的操作更加高效。最终，目标是设计这样一个函数，将这些向量转换为更小的维度，保留有关它们相似性的信息。构造这样一个函数的方法称为 MinHashing。</p>
<blockquote>
<p><strong>MinHashing</strong>是一个哈希函数，它对输入向量的分量进行排列，然后返回排列后的向量分量等于 1 的第一个索引。</p>
</blockquote>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/6.png" alt="img"></p>
<p>​	<em>计算给定向量和排列的 minhash 值的示例</em></p>
<p>为了获得由n 个数字组成的向量的密集表示，可以使用n 个minhash 函数来获取形成签名的n个minhash值。</p>
<p>乍一听起来可能并不明显，但可以使用几个 minhash 值来近似向量之间的 Jaccard 相似度。事实上，使用的 minhash 值越多，近似值就越准确。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/7.png" alt="img"></p>
<p>​	<em>签名矩阵的计算以及如何使用它来计算向量之间的相似度。使用 Jaccard 相似度和签名计算的相似度通常应大致相等。</em></p>
<p>这只是一个有用的观察。事实证明，幕后有一个完整的定理。我们来了解一下为什么可以使用签名来计算Jaccard指数。</p>
<h2 id="证明statement-proof">证明(Statement proof)</h2>
<p>让我们假设给定的向量对仅包含类型为<em>01</em>、<em>10</em>和<em>11</em>的行。然后对这些向量进行随机排列。由于所有行中至少存在一个 1，因此在计算两个哈希值时，这两个哈希值计算过程中至少有一个会停在对应哈希值等于 1 的向量的第一行。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/8.png" alt="img"></p>
<p>第二个哈希值等于第一个哈希值的概率是多少？显然，只有当第二个哈希值也等于 1 时才会发生这种情况。这意味着第一行必须是类型<em>11</em>。由于排列是随机进行的，因此此类事件的概率等于<em>P</em> <em>=</em> <em>count(11) / (count(01) + count(10) + count(11) )</em>。这个表达式与杰卡德指数公式完全相同。所以：</p>
<blockquote>
<p><strong>基于随机行排列的两个二进制向量获得相等哈希值的概率等于 Jaccard 系数</strong>。</p>
</blockquote>
<p>然而，通过证明上面的陈述，我们假设初始向量不包含类型00的行。很明显，类型00的行不会更改 Jaccard 索引的值。同样，获得包含类型00的行的相同哈希值的概率也不会对其产生影响。例如，如果第一个排列行是00，那么 minhash 算法会忽略它并切换到下一行，直到一行中至少存在一个 1。当然，类型 00 的行可能会产生与没有类型 00 的行不同的哈希值，但获得相同哈希值的概率保持不变。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/9.png" alt="img"></p>
<p>我们已经证明了一个重要的说法。但是如何估计获得相同 minhash 值的概率呢？当然，可以生成向量的所有可能排列，然后计算所有最小哈希值以找到所需的概率。出于显而易见的原因，这效率不高，因为大小为<em>n</em>的向量的可能排列数量等于<em>n!</em>。不过，可以近似地评估概率：让我们使用许多哈希函数来生成那么多哈希值。</p>
<blockquote>
<p>两个二进制向量的 Jaccard 系数大约等于其签名中对应值的数量。</p>
</blockquote>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/10.png" alt="img"></p>
<p>很容易注意到，采用更长的签名会导致计算更准确。</p>
<h1 id="lsh-函数">LSH 函数</h1>
<p>目前，我们可以将原始文本转换为等长度的密集签名，保留有关相似性的信息。然而，在实践中，如此密集的签名通常仍然具有很高的维度，直接比较它们的效率很低。</p>
<p>考虑<em>n = 10⁶</em>文档，其签名长度为 100。假设单个签名需要 4 个字节来存储，那么整个签名将需要 400 个字节。为了存储<em>n = 10⁶</em>文档，需要 400 MB 的空间，这在现实中是可行的。但是以强力方式比较每个文档将需要大约 5 * 10^1 比较，这太多了，尤其是当<em>n</em>更大时。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/11.png" alt="img"></p>
<p>为了避免这个问题，可以构建一个哈希表来加速搜索性能，但即使两个签名非常相似并且仅在 1 个位置上不同，它们仍然可能具有不同的哈希值（因为向量余数可能不同）。然而，我们通常希望它们落入同一个桶中。这正是LSH能够发挥作用的地方。</p>
<blockquote>
<p><strong>LSH</strong>机制构建了一个由多个部分组成的哈希表，如果一对签名至少有一个对应的部分，则将它们放入同一个桶中。</p>
</blockquote>
<p>LSH 采用签名矩阵并将其水平划分为相等的<em>b</em>部分，称为<strong>band</strong>，每个部分包含<em>r</em> <strong>rows</strong>。不是将整个签名插入单个哈希函数，而是将签名分为<em>b</em>个部分，并且每个子签名由哈希函数独立处理。因此，每个子签名都会落入不同的桶中。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/12.png" alt="img"></p>
<p><em>使用 LSH 的示例：长度为 9 的两个签名被分为 b = 3 个带，每个带包含 r = 3 行。每个子向量被散列到 k 个可能的桶之一中。由于第二个带中存在匹配（两个子向量具有相同的哈希值），因此我们将这些签名中的一对视为最近邻居的候选者。</em></p>
<p>如果两个不同签名的相应子向量之间至少存在一次冲突，则这些签名被视为候选。正如我们所看到的，这个条件更加灵活，因为将向量视为候选向量不需要绝对相等。然而，这增加了误报的数量：一对不同的签名可以具有单个对应部分，但总体上完全不同。根据问题的不同，优化参数<em>b</em>、<em>r</em>和 k。</p>
<h1 id="错误率error-rate">错误率(Error rate)</h1>
<p>使用 LSH，可以估计具有相似性<em>s</em>的两个签名将被视为候选的概率，给定多个频带<em>b</em>和每个频带中的行数<em>r</em>。让我们分几步找到它的公式。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/13.png" alt="img"></p>
<p>​	<em>两个签名的随机行相等的概率</em></p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/14.png" alt="img"></p>
<p>​	<em>具有 r 行的一个随机带相等的概率</em></p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/15.png" alt="img"></p>
<p>​	<em>具有 r 行的一个随机带不同的概率</em></p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/16.png" alt="img"></p>
<p>​	<em>表中所有b波段不同的概率</em></p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/17.png" alt="img"></p>
<p>​	<em>b 个波段中至少有一个相等的概率，因此两个签名是候选者</em></p>
<p>请注意，该公式没有考虑不同子向量意外散列到同一存储桶中时的冲突。因此，签名成为候选人的真实概率可能差别不大。</p>
<h2 id="例子">例子</h2>
<p>为了更好地理解我们刚刚获得的公式，让我们考虑一个简单的例子。考虑两个长度为 35 个符号的签名，它们被平均分为 5 个带，每个带 7 行。下表表示基于 Jaccard 相似度至少有一个相等带的概率：</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/18.png" alt="img"></p>
<p>​	<em>根据两个签名的相似度 s 获得至少一个相应频带的概率 P</em></p>
<p>我们注意到，如果两个相似的签名的 Jaccard 相似度为 80%，那么它们在 93.8% 的情况下具有相应的band（<em>真阳性 true positives TP</em>）。在其余 6.2% 的场景中，这样的一对签名是<em>漏报的</em>。</p>
<p>现在让我们采取两个不同的签名。例如，它们的相似度只有 20%。因此，在 0.224% 的情况下，它们是<em>假阳性 false positive FP</em>候选者。在其他 99.776% 的情况下，它们没有类似的band，因此它们是<em>真阴性 true negatives TN</em>。</p>
<h2 id="可视化visualisation">可视化(Visualisation)</h2>
<p>现在让我们可视化相似性<em>s</em>和两个签名成为候选者的概率<em>P</em>之间的联系。通常，签名相似度越高*，*签名成为候选的概率就越高。理想情况下，它看起来像下面这样：</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/19.png" alt="img"></p>
<p>​	<em>理想的场景。仅当一对签名的相似度大于某个阈值 t 时，才将其视为候选签名</em></p>
<p>根据上面获得的概率公式，一条典型的线路如下图所示：</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/20.png" alt="img"></p>
<p>​	<em>一条典型的线，在开始和结束时缓慢增加，并在图中近似概率公式给出的阈值 t 处具有陡峭的斜率</em></p>
<p>可以改变band <em>b</em>的数量来将图中的线向左或向右移动。增加<em>b</em>将线向左移动并导致更多<em>FP</em>，减少 - 将其向右移动并导致更多<em>FN</em>。根据问题的不同，找到良好的平衡点很重要。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/21.png" alt="img"></p>
<p>band数量较多时，该线向左移动，band数量较少时，则向右移动</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/22.png" alt="img"></p>
<p>向左移动阈值会增加 FP，向右移动会增加 FN</p>
<h2 id="不同数量的band和行的实验">不同数量的band和行的实验</h2>
<p><em>下面针对b</em>和<em>r</em>的不同值构建了几个线图。最好根据特定任务调整这些参数，以成功检索所有相似文档对并忽略具有不同签名的文档。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/23.png" alt="img"></p>
<p>​	<em>调整频段数量</em></p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/locality-sensitive-hashing/24.png" alt="img"></p>
<p>​	<em>调整行数</em></p>
<p><strong>（注</strong>：<a href="https://github.com/weedge/doraemon-nb/blob/main/testing_lsh.ipynb"><strong>testing_lsh.ipynb</strong></a> 实操笔记）</p>
<h1 id="结论">结论</h1>
<p>我们已经完成了 LSH 方法的经典实现。LSH 通过使用较低维的签名表示和快速哈希机制来缩小候选者的搜索范围，从而显着优化搜索速度。同时，这是以搜索准确性为代价的，但在实践中，差异通常是微不足道的。</p>
<p>然而，LSH 容易受到高维数据的影响：更多维度需要更长的签名长度和更多的计算才能保持良好的搜索质量。在这种情况下，建议使用其他索引。</p>
<p>事实上，LSH 存在不同的实现，但它们都基于相同的范例，即将<em>输入向量转换为哈希值，同时保留有关其相似性的信息</em>。基本上，其他算法只是定义了获取这些哈希值的其他方式。</p>
<p><strong>随机投影</strong>是另一种 LSH 方法，将在下一章中介绍，它在<a href="https://github.com/facebookresearch/faiss">Faiss</a>库中作为 LSH 索引实现，用于相似性搜索。</p>
<h1 id="reference">Reference</h1>
<ul>
<li><a href="https://cse.iitkgp.ac.in/~animeshm/algoml/lsh.pdf">Locality Sensitive Hashing | Andrew Wylie | December 2, 2013</a></li>
<li><a href="https://www.inf.u-szeged.hu/~berendg/docs/dm/DM_lsh_en_pf.pdf">Data Mining | Locality Sensitive Hashing | University of Szeged</a></li>
<li><a href="https://github.com/facebookresearch/faiss">Faiss repository</a></li>
<li><a href="https://www.pinecone.io/learn/series/faiss/locality-sensitive-hashing/">https://www.pinecone.io/learn/series/faiss/locality-sensitive-hashing/</a></li>
</ul>
<p><em>除非另有说明，所有图片均由作者提供</em>。</p>
<p>原文地址： <a href="https://medium.com/towards-data-science/similarity-search-part-5-locality-sensitive-hashing-lsh-76ae4b388203">https://medium.com/towards-data-science/similarity-search-part-5-locality-sensitive-hashing-lsh-76ae4b388203</a></p>
<p><strong>附操作笔记</strong>:</p>
<p><a href="https://github.com/weedge/doraemon-nb/blob/main/testing_lsh.ipynb"><strong>testing_lsh.ipynb</strong></a></p>
<p><a href="https://github.com/weedge/doraemon-nb/blob/main/faiss_lsh.ipynb"><strong>faiss_lsh.ipynb</strong></a></p>
    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">weedge</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2023-09-26
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://weedge.github.io/tags/oneday/">oneday</a>
          <a href="https://weedge.github.io/tags/similarity-search/">similarity search</a>
          <a href="https://weedge.github.io/tags/locality-sensitive-hashing/">Locality Sensitive Hashing </a>
          <a href="https://weedge.github.io/tags/lsh/">lsh</a>
          
        </div>

      
      <nav class="post-nav">
        
        
          <a class="next" href="/post/oneday/similarity-search/4.hierarchical-navigable-small-world-hnsw/">
            <span class="next-text nav-default">译：相似性搜索，第 4 部分：分层可导航小世界 (HNSW)</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    显示 Disqus 评论
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = "https://weedge.github.io/post/oneday/similarity-search/5.locality-sensitive-hashing/";
    };
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'weedge';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:weege007@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/weedge" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://weibo.com/weedge" rel="me noopener" class="iconfont"
      title="weibo"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M385.714286 733.714286q12-19.428571 6.285714-39.428571t-25.714286-28.571429q-19.428571-8-41.714286-0.571429t-34.285714 26.285714q-12.571429 19.428571-7.428571 39.142857t24.571429 28.857143 42.571429 1.428571 35.714286-27.142857zm53.714286-69.142857q4.571429-7.428571 2-15.142857t-10-10.571429q-8-2.857143-16.285714 2.857143t-12.285714 10.571429q-9.714286 17.714286 7.428571 25.714286 8 2.857143 16.571429 2.857143t12.571429-10.571429zm99.428571 61.142857q-25.714286 58.285714-90.285714 85.714286t-128 6.857143q-61.142857-19.428571-84.285714-72.285714t3.714286-107.142857q26.857143-53.142857 86.571429-79.428571t120.285714-10.857143q63.428571 16.571429 90.571429 68.285714t1.428571 108.857143zm178.285714-91.428571q-5.142857-54.857143-50.857143-97.142857t-119.142857-62.285714-156.857143-12q-127.428571 13.142857-211.142857 80.857143t-75.714286 151.142857q5.142857 54.857143 50.857143 97.142857t119.142857 62.285714 156.857143 12q127.428571-13.142857 211.142857-80.857143t75.714286-151.142857zm176 2.285714q0 38.857143-21.142857 79.714286t-62.285714 78.285714-96.285714 67.142857-129.142857 47.428571-154.571429 17.714286-157.142857-19.142857-137.428571-53.142857-98-86.285714-37.142857-114q0-65.714286 39.714286-140t112.857143-147.428571q96.571429-96.571429 195.142857-134.857143t140.857143 4q37.142857 36.571429 11.428571 119.428571-2.285714 8-0.571429 11.428571t5.714286 4 8.285714 2.857143 7.714286-2l3.428571-1.142857q79.428571-33.714286 140.571429-33.714286t87.428571 34.857143q25.714286 36 0 101.714286-1.142857 7.428571-2.571429 11.428571t2.571429 7.142857 6.857143 4.285714 9.714286 3.428571q32.571429 10.285714 58.857143 26.857143t45.714286 46.571429 19.428571 66.571429zm-42.285714-356.571429q24 26.857143 31.142857 62t-3.714286 67.142857q-4.571429 13.142857-16.857143 19.428571t-25.428571 2.285714q-13.142857-4.571429-19.428571-16.857143t-2.285714-25.428571q11.428571-36-13.714286-63.428571t-61.142857-20q-13.714286 2.857143-25.714286-4.571429t-14.285714-21.142857q-2.857143-13.714286 4.571429-25.428571t21.142857-14.571429q34.285714-7.428571 68 3.142857t57.714286 37.428571zm103.428571-93.142857q49.714286 54.857143 64.285714 127.142857t-7.714286 138q-5.142857 15.428571-19.428571 22.857143t-29.714286 2.285714-22.857143-19.428571-2.857143-29.714286q16-46.857143 5.714286-98.285714t-45.714286-90.285714q-35.428571-39.428571-84.571429-54.571429t-98.857143-4.857143q-16 3.428571-29.714286-5.428571t-17.142857-24.857143 5.428571-29.428571 24.857143-16.857143q70.285714-14.857143 139.428571 6.571429t118.857143 76.857143z"></path>
</svg>

    </a>


<a href="https://weedge.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2013 -
    2023
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        weedge
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  









  <script id="dsq-count-scr" src="//weedge.disqus.com/count.js" async></script>






  <script src="/js/copy-to-clipboard.js"></script>


</body>
</html>
