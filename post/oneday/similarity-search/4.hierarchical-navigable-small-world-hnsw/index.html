<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>译：相似性搜索，第 4 部分：分层可导航小世界 (HNSW) - 时间飘过</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="weedge" />
  <meta name="description" content="了解如何构建高效的多层图以提高海量数据的搜索速度
介绍 在数据科学中，相似性搜索经常出现在 NLP 领域、搜索引擎或推荐系统中，其中需要检索最相关的文档或项目以进行查询。有多种不同的方法可以提高海量数据的搜索性能。
分层可导航小世界(HNSW) 是一种用于近似搜索最近邻居的最先进算法。在底层，HNSW 构建了优化的图结构，使其与本系列文章前面部分中讨论的其他方法非常不同。
 HNSW 的主要思想是构建这样一个图，其中任何一对顶点之间的路径都可以通过少量步骤遍历。
 著名的六次握手规则的一个著名类比与此方法有关：
 所有人之间的社会关系距离不超过 6 个。
 在继续讨论 HNSW 的内部工作之前，让我们首先讨论跳跃列表和可导航小世界——HNSW 实现中使用的关键数据结构。
" />

  <meta name="keywords" content="工作, 技术, 生活" />






<meta name="generator" content="Hugo 0.91.0" />


<link rel="canonical" href="https://weedge.github.io/post/oneday/similarity-search/4.hierarchical-navigable-small-world-hnsw/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.fa4b2b9f31b5c6d0b683db81157a9226e17b06e61911791ab547242a4a0556f2.css" integrity="sha256-&#43;ksrnzG1xtC2g9uBFXqSJuF7BuYZEXkatUckKkoFVvI=" media="screen" crossorigin="anonymous">




<link rel="stylesheet" href="/css/copy-to-clipboard.css">


<meta property="og:title" content="译：相似性搜索，第 4 部分：分层可导航小世界 (HNSW)" />
<meta property="og:description" content="
了解如何构建高效的多层图以提高海量数据的搜索速度
介绍
在数据科学中，相似性搜索经常出现在 NLP 领域、搜索引擎或推荐系统中，其中需要检索最相关的文档或项目以进行查询。有多种不同的方法可以提高海量数据的搜索性能。
分层可导航小世界(HNSW) 是一种用于近似搜索最近邻居的最先进算法。在底层，HNSW 构建了优化的图结构，使其与本系列文章前面部分中讨论的其他方法非常不同。

HNSW 的主要思想是构建这样一个图，其中任何一对顶点之间的路径都可以通过少量步骤遍历。

著名的六次握手规则的一个著名类比与此方法有关：

所有人之间的社会关系距离不超过 6 个。

在继续讨论 HNSW 的内部工作之前，让我们首先讨论跳跃列表和可导航小世界——HNSW 实现中使用的关键数据结构。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://weedge.github.io/post/oneday/similarity-search/4.hierarchical-navigable-small-world-hnsw/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-09-25T15:26:23+08:00" />
<meta property="article:modified_time" content="2023-09-25T15:26:23+08:00" />

<meta itemprop="name" content="译：相似性搜索，第 4 部分：分层可导航小世界 (HNSW)">
<meta itemprop="description" content="
了解如何构建高效的多层图以提高海量数据的搜索速度
介绍
在数据科学中，相似性搜索经常出现在 NLP 领域、搜索引擎或推荐系统中，其中需要检索最相关的文档或项目以进行查询。有多种不同的方法可以提高海量数据的搜索性能。
分层可导航小世界(HNSW) 是一种用于近似搜索最近邻居的最先进算法。在底层，HNSW 构建了优化的图结构，使其与本系列文章前面部分中讨论的其他方法非常不同。

HNSW 的主要思想是构建这样一个图，其中任何一对顶点之间的路径都可以通过少量步骤遍历。

著名的六次握手规则的一个著名类比与此方法有关：

所有人之间的社会关系距离不超过 6 个。

在继续讨论 HNSW 的内部工作之前，让我们首先讨论跳跃列表和可导航小世界——HNSW 实现中使用的关键数据结构。"><meta itemprop="datePublished" content="2023-09-25T15:26:23+08:00" />
<meta itemprop="dateModified" content="2023-09-25T15:26:23+08:00" />
<meta itemprop="wordCount" content="5852">
<meta itemprop="keywords" content="oneday,similarity search,hierarchical navigable small world,hnsw," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="译：相似性搜索，第 4 部分：分层可导航小世界 (HNSW)"/>
<meta name="twitter:description" content="
了解如何构建高效的多层图以提高海量数据的搜索速度
介绍
在数据科学中，相似性搜索经常出现在 NLP 领域、搜索引擎或推荐系统中，其中需要检索最相关的文档或项目以进行查询。有多种不同的方法可以提高海量数据的搜索性能。
分层可导航小世界(HNSW) 是一种用于近似搜索最近邻居的最先进算法。在底层，HNSW 构建了优化的图结构，使其与本系列文章前面部分中讨论的其他方法非常不同。

HNSW 的主要思想是构建这样一个图，其中任何一对顶点之间的路径都可以通过少量步骤遍历。

著名的六次握手规则的一个著名类比与此方法有关：

所有人之间的社会关系距离不超过 6 个。

在继续讨论 HNSW 的内部工作之前，让我们首先讨论跳跃列表和可导航小世界——HNSW 实现中使用的关键数据结构。"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->







</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">时间飘过</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/about/">About</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/perf-book-cn/zh/" rel="noopener" target="_blank">
              《现代CPU性能分析与优化》
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      时间飘过
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/post/">归档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/categories/">分类</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/about/">About</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://weedge.github.io/perf-book-cn/zh/" rel="noopener" target="_blank">
              《现代CPU性能分析与优化》
              
              <i class="iconfont">
                <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M623.36 272.96 473.216 423.04C467.2 429.056 467.072 438.656 472.896 444.416c0 0-6.72-6.656 1.6 1.6C496.064 467.648 528.64 500.224 528.64 500.224 534.464 506.048 544 505.856 550.016 499.904l150.08-150.144 67.328 66.432c9.024 8.96 27.456 4.544 30.4-8.96 19.968-92.608 46.656-227.52 46.656-227.52 6.848-34.496-16.192-56.704-49.92-49.92 0 0-134.656 26.816-227.328 46.784C560.32 178.048 556.352 182.272 554.752 187.136c-3.2 6.208-3.008 14.208 3.776 20.992L623.36 272.96z"></path>
  <path d="M841.152 457.152c-30.528 0-54.784 24.512-54.784 54.656l0 274.752L237.696 786.56 237.696 237.696l206.016 0c6.656 0 10.752 0 13.248 0C487.68 237.696 512 213.184 512 182.848 512 152.32 487.36 128 456.96 128L183.04 128C153.216 128 128 152.576 128 182.848c0 3.136 0.256 6.272 0.768 9.28C128.256 195.136 128 198.272 128 201.408l0 639.488c0 0.064 0 0.192 0 0.256 0 0.128 0 0.192 0 0.32 0 30.528 24.512 54.784 54.784 54.784l646.976 0c6.592 0 9.728 0 11.712 0 28.736 0 52.928-22.976 54.464-51.968C896 843.264 896 842.304 896 841.344l0-20.352L896 561.408 896 512.128C896 481.792 871.424 457.152 841.152 457.152z"></path>
</svg>

              </i>
            </a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">译：相似性搜索，第 4 部分：分层可导航小世界 (HNSW)</h1>
      
      <div class="post-meta">
        <time datetime="2023-09-25" class="post-time">
          2023-09-25
        </time>
        <div class="post-category">
            <a href="https://weedge.github.io/categories/%E6%8A%80%E6%9C%AF/"> 技术 </a>
            
          </div>
        

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#搜索">搜索</a></li>
    <li><a href="#建造">建造</a></li>
  </ul>

  <ul>
    <li><a href="#复杂度">复杂度</a></li>
  </ul>

  <ul>
    <li><a href="#选择最大层数">选择最大层数</a></li>
    <li><a href="#插入insertion">插入(Insertion)</a></li>
    <li><a href="#选择构造参数值choosing-values-for-construction-parameters">选择构造参数值(Choosing values for construction parameters)</a></li>
    <li><a href="#候选者启发式选择candidate-selection-heuristic">候选者启发式选择(Candidate selection heuristic)</a></li>
    <li><a href="#复杂度-1">复杂度</a></li>
  </ul>

  <ul>
    <li><a href="#indexhnswflat">IndexHNSWFlat</a></li>
    <li><a href="#indexhnswflat--indexivfpq">IndexHNSWFlat + IndexIVFPQ</a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p><img src="https://github.com/weedge/mypic/raw/master/oneday/hierarchical-navigable-small-world-hnsw/0.png" alt=""></p>
<p><strong>了解如何构建高效的多层图以提高海量数据的搜索速度</strong></p>
<h1 id="介绍">介绍</h1>
<p>在数据科学中，相似性搜索经常出现在 NLP 领域、搜索引擎或推荐系统中，其中需要检索最相关的文档或项目以进行查询。有多种不同的方法可以提高海量数据的搜索性能。</p>
<p><a href="https://arxiv.org/pdf/1603.09320.pdf"><strong>分层可导航小世界</strong></a>(HNSW) 是一种用于近似搜索最近邻居的最先进算法。在底层，HNSW 构建了优化的图结构，使其与本系列文章前面部分中讨论的其他方法非常不同。</p>
<blockquote>
<p>HNSW 的主要思想是构建这样一个图，其中任何一对顶点之间的路径都可以通过少量步骤遍历。</p>
</blockquote>
<p>著名的<a href="https://en.wikipedia.org/wiki/Six_degrees_of_separation">六次握手规则</a>的一个著名类比与此方法有关：</p>
<blockquote>
<p>所有人之间的社会关系距离不超过 6 个。</p>
</blockquote>
<p>在继续讨论 HNSW 的内部工作之前，让我们首先讨论跳跃列表和可导航小世界——HNSW 实现中使用的关键数据结构。</p>
<h1 id="跳跃列表skip-list">跳跃列表(Skip List)</h1>
<p><a href="https://en.wikipedia.org/wiki/Skip_list">skip list</a>是一种概率数据结构，允许在排序列表中插入和搜索元素*O(logn)*一般。跳跃列表由多层链表构成。最底层有原始链表，其中包含所有元素。当移动到更高级别时，跳过的元素数量会增加，从而减少连接数量。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/hierarchical-navigable-small-world-hnsw/1.png" alt="img"></p>
<p><em>在跳跃列表中查找元素 20</em></p>
<p>某个值的搜索过程从最高级别开始，并将其下一个元素与该值进行比较。如果该值小于或等于该元素，则算法将继续处理下一个元素。否则，搜索过程下降到具有更多连接的较低层并重复相同的过程。最后，算法下降到最低层并找到所需的节点。</p>
<p>根据<a href="https://en.wikipedia.org/wiki/Skip_list">维基百科</a>的信息，跳跃列表的主要参数<em>p</em>定义了一个元素出现在多个列表中的概率。如果某个元素出现在<em>第 i层</em>，那么它出现在第<em>i+1</em>层的概率等于<em>p</em>（<em>p</em>通常设置为 0.5 或 0.25 ）。平均而言，每个元素都以*1 / (1 - p)*列表的形式呈现。</p>
<p>我们可以看到，这个过程比链表中普通的线性搜索要快得多。事实上，HNSW 继承了相同的思想，但它使用的不是链表，而是图。</p>
<h1 id="可航行的小世界navigable-small-world">可航行的小世界(Navigable Small World)</h1>
<p><a href="https://en.wikipedia.org/wiki/Small-world_network"><strong>可导航小世界</strong></a>是一个具有多对数*T = O(logᵏn)*搜索复杂度的图，它使用贪婪路由。**路由(Routing)**是指从低度数顶点开始搜索过程，以高度数顶点结束的过程。由于低度顶点的连接很少，因此该算法可以在它们之间快速移动，以有效地导航到最近邻居可能所在的区域。然后算法逐渐放大并切换到高度顶点，以找到该区域顶点中的最近邻居。</p>
<blockquote>
<p>顶点<em>Vertex</em>有时也称为<strong>节点Node</strong>。</p>
</blockquote>
<h2 id="搜索">搜索</h2>
<p>首先，通过选择入口点来进行搜索。为了确定算法要移动到的下一个顶点（或多个顶点），它会计算从查询向量到当前顶点的邻居的距离，并移动到最近的顶点。在某些时候，当算法无法找到比当前节点本身更接近查询的邻居节点时，算法会终止搜索过程。该节点作为查询的响应返回。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/hierarchical-navigable-small-world-hnsw/2.png" alt="img"></p>
<p><em>可导航的小世界中的贪婪搜索过程。节点 A 用作入口点。它有两个邻居 B 和 D。节点 D 比 B 更接近查询。因此，我们移动到 D。节点 D 有三个邻居 C、E 和 F。E 是距离查询最近的邻居，因此我们移动到 D。最后，搜索过程将导致节点 L。由于 L 的所有邻居都比 L 本身距离查询更远，因此我们停止算法并返回 L 作为查询的答案</em>。</p>
<p>这种贪婪策略不能保证它会找到精确的最近邻居，因为该方法仅使用当前步骤的本地信息来做出决策。<strong>提前停止Early stopping</strong>是该算法的问题之一。它尤其发生在搜索过程开始时，当没有比当前节点更好的邻居节点时。在大多数情况下，当起始区域具有太多低度顶点时，可能会发生这种情况。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/hierarchical-navigable-small-world-hnsw/3.png" alt="img"></p>
<p><em>提前停止，当前节点的两个邻居距离查询都较远。因此，算法返回当前节点作为响应，尽管存在距离查询更近的节点</em>。</p>
<p>通过<strong>使用多个入口点</strong>可以提高搜索准确性。</p>
<h2 id="建造">建造</h2>
<p>NSW 图是通过打乱数据集点并将它们一一插入到当前图中来构建的。当插入一个新节点时，它会通过边链接到距离它最近的<em>M 个顶点。</em></p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/hierarchical-navigable-small-world-hnsw/4.png" alt="img"></p>
<p>按 M = 2 顺序插入节点（从左到右）。每次迭代时，都会将一个新顶点添加到图中，并链接到其 M = 2 个最近邻居。蓝线表示与新插入节点的连接边。</p>
<p>在大多数情况下，远程边可能会在图构建的开始阶段创建。它们在图形导航中发挥着重要作用。</p>
<blockquote>
<p>在构造开始时插入的元素的最近邻居的链接后来成为网络集线器之间的桥梁，保持整体图的连接性并允许在贪婪路由期间对跳数进行对数缩放。——于。A.马尔科夫，DA Yashunin</p>
</blockquote>
<p>从上图中的例子我们可以看出一开始添加的远程边<em>AB</em>的重要性。想象一下，一个查询需要从相对较远的节点<em>A</em>和 I 遍历一条路径。有了边<em>AB</em>，可以通过直接从图的一侧导航到另一侧来快速完成此操作。</p>
<p>随着图中顶点数量的增加，新连接到新节点的边的长度变小的可能性也随之增加。</p>
<h1 id="hnsw">HNSW</h1>
<p><a href="https://arxiv.org/pdf/1603.09320.pdf"><strong>HNSW</strong></a>基于与skiplist 调表和navigable small world (NSW) 可导航小世界相同的原理。它的结构代表了一个多层图，顶层的连接较少，底层的区域更密集。</p>
<h1 id="搜索search">搜索(Search)</h1>
<p>搜索从最高层开始，每次在各层节点中贪婪地找到局部最近邻时，都会向下一级进行搜索。最终，在最低层找到的最近邻居就是查询的答案。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/hierarchical-navigable-small-world-hnsw/5.png" alt="img"></p>
<p><em>在HNSW中搜索</em></p>
<p>与 NSW 类似，HNSW 的搜索质量可以通过使用多个入口点来提高。不是在每一层上只找到一个最近邻居，而是找到与查询向量最接近的<em>efSearch</em>（超参数） ，并将这些邻居中的每一个用作下一层的入口点。</p>
<h2 id="复杂度">复杂度</h2>
<p><a href="https://arxiv.org/pdf/1603.09320.pdf">原论文</a>中，在任何层上找到最近邻居所需的操作数量都受到一个常数的限制。考虑到图中所有层的数量是对数的，我们得到的总搜索复杂度为<em>O(logn)</em>。</p>
<h1 id="建造construction">建造(Construction)</h1>
<h2 id="选择最大层数">选择最大层数</h2>
<p>HNSW中的节点是按顺序一一插入的。每个节点都被随机分配一个整数<em>l</em>，表示该节点可以出现在图中的最大层。例如，如果<em>l = 1</em>，则只能在第 0 层和第 1 层上找到该节点。作者为每个节点随机选择<em>l</em> ，其具有由非零乘数 mL 归一化的<strong>指数衰减概率分布(exponentially decaying probability distribution)</strong>（<em>mL= 0</em>导致HNSW 中的单层和未优化的搜索复杂度）。通常，大多数<em>l</em>值应等于 0，因此大多数节点仅存在于最低级别。<em>mL</em>的较大值增加节点出现在较高层的概率。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/hierarchical-navigable-small-world-hnsw/6.png" alt="img"></p>
<p>​	每个节点的层数 <em>l</em> 是按指数衰减概率分布随机选择的。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/hierarchical-navigable-small-world-hnsw/7.png" alt="img"></p>
<p><em>基于归一化因子 mL 的层数分布。水平轴表示均匀(0, 1) 分布的值</em>。</p>
<blockquote>
<p>为了实现可控层次结构的最佳性能优势，不同层上的邻居之间的重叠（即也属于其他层的元素邻居的百分比）必须很小。— Yu. A. Malkov, D. A. Yashunin。</p>
</blockquote>
<p>减少重叠的方法之一是减少<em>mL</em>。但重要的是要记住，减少<em>mL</em>平均也会导致在每层的贪婪搜索期间进行更多的遍历。这就是为什么必须选择一个能够平衡重叠和遍历次数的<em>mL值。</em></p>
<p>该论文的作者建议选择<em>mL</em>的最佳值，即等于<strong>1 / ln(M)</strong>。该值对应于跳跃列表的参数<em>p = 1 / M</em>，即层之间的平均单个元素重叠。</p>
<h2 id="插入insertion">插入(Insertion)</h2>
<p>为节点分配值<em>l</em>后，其插入有两个阶段：</p>
<ol>
<li>该算法从上层开始，贪婪地寻找最近的节点。然后找到的节点将用作下一层的入口点，并且搜索过程将继续。一旦到达第<em>l</em>层*，*插入就进入第二步。</li>
<li>从第<em>l</em>层开始，算法在当前层插入新节点。然后它的行为与之前步骤 1 中的相同，但不是只查找一个最近邻居，而是贪婪地搜索<em>efConstruction</em>（超参数）最近邻居。然后从<em>efConstruction</em>邻居中选择<em>M</em> 个，并构建从插入节点到它们的边。之后，算法下降到下一层，找到的每个<em>efConstruction</em>节点都充当入口点。当新节点及其边被插入到最低层 0 后，算法终止。</li>
</ol>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/hierarchical-navigable-small-world-hnsw/8.png" alt="img"></p>
<p><em>在 HNSW 中插入节点（蓝色）。新节点的最大层被随机选择为 l = 2。因此，该节点将被插入到第 2、1 和 0 层。在这些层的每一层上，该节点将连接到其 M = 2 个最近邻居</em>。</p>
<h2 id="选择构造参数值choosing-values-for-construction-parameters">选择构造参数值(Choosing values for construction parameters)</h2>
<p>原始论文提供了关于如何选择超参数的一些有用的见解：</p>
<ul>
<li>根据模拟，<em>M</em>的最佳值在 5 到 48 之间。较小的<em>M</em>值往往更适合较低召回率或低维数据，而较高的 M 值更适合高召回率或高维数据。</li>
<li><em>efConstruction</em>的值越高，意味着随着探索的候选者越多，搜索就越深入。然而，它需要更多的计算。作者建议选择这样一个<em>efConstruction</em>值，使训练期间的召回率接近<em>0.95-1</em>。</li>
<li>此外，还有一个重要参数<em>Mₘₐₓ</em>——一个顶点可以拥有的最大边数。除此之外，还存在相同的参数<em>Mₘₐₓ₀</em>，但对于最低层Lay 0是单独的。建议为<em>Mₘₐₓ</em>选择接近<em>2 * M</em>的值。大于<em>2 * M</em>的值可能会导致性能下降和内存使用过多。同时，<em>Mₘₐₓ = M</em>导致在高召回率下表现不佳。</li>
</ul>
<h2 id="候选者启发式选择candidate-selection-heuristic">候选者启发式选择(Candidate selection heuristic)</h2>
<p>上面注意到，在节点插入期间，选择<em>efConstruction</em>候选者中的<em>M</em>个来为它们构建边。让我们讨论选择这<em>M</em> 个节点的可能方法。</p>
<p>朴素方法采用<em>M</em>个最接近的候选者。然而，它并不总是最佳选择。下面是一个演示它的例子。</p>
<p>想象一个具有下图结构的图表。如您所见，共有三个区域，其中两个区域未相互连接（左侧和顶部）。因此，例如，从<em>A</em>点到<em>B</em>点需要穿过另一个区域的很长的路径。以某种方式连接这两个区域以实现更好的导航是合乎逻辑的。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/hierarchical-navigable-small-world-hnsw/9.png" alt="img"></p>
<p>​	<em>节点 X 被插入到图中。目标是将其最佳地连接到其他 M = 2 点</em>。</p>
<p>然后将节点<em>X</em>插入到图中，并且需要链接到<em>M</em> <em>= 2 个</em>其他 顶点。</p>
<p>在这种情况下，朴素方法直接采用<em>M = 2 个</em>最近邻居（<em>B</em>和<em>C</em>）并将<em>X</em>连接到它们。尽管<em>X</em>与其真正的最近邻居相连，但这并不能解决问题。让我们看看作者发明的启发式方法。</p>
<blockquote>
<p>启发式不仅考虑节点之间的最近距离，还考虑图上不同区域的连通性。</p>
</blockquote>
<p><strong>启发式选择第一个最近邻居（在我们的例子中为<em>B</em>）并将插入的节点 (<em>X</em>) 连接到它。然后，该算法按顺序选取另一个最接近的最近邻居 (<em>C</em>)，并仅当该邻居到新节点 (<em>X</em>) 的距离小于从该邻居到所有已连接顶点的任何距离时，才为其构建一条边(<em>B</em>) 到新节点 (<em>X</em>)。之后，算法继续到下一个最近邻，直到建立<em>M</em>条边</strong>。</p>
<p>回到示例，启发式过程如下图所示。启发式选择<em>B</em>作为 X 的最近邻并构建边<em>BX</em>。然后算法选择<em>C</em>作为下一个最近的最近邻。然而，这次<em>BC &lt; CX</em>。这表明将边<em>CX</em>添加到图中并不是最佳的，因为已经存在边<em>BX</em>并且节点<em>B</em>和<em>C</em>彼此非常接近。对于节点<em>D</em>和<em>E</em>进行相同的类比。之后，算法检查节点<em>A</em>。<em>这次，它满足BA</em> <em>&gt; AX 的</em>条件。结果，新边<em>AX</em>和两个初始区域彼此连接。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/hierarchical-navigable-small-world-hnsw/10.png" alt="img"></p>
<p>​	<em>左边的例子使用了朴素方法。右侧的示例使用启发式选择，这会导致两个初始不相交区域相互连接</em>。</p>
<h2 id="复杂度-1">复杂度</h2>
<p>与搜索过程相比，插入过程的工作方式非常相似，没有任何可能需要非常数操作的显着差异。因此，插入单个顶点需要<em>O(logn)<em>的时间。为了估计总复杂度，应考虑给定数据集中所有插入节点</em>n</em>的数量。最终，HNSW 构建需要O(n * logn)时间。</p>
<h1 id="将-hnsw-与其他方法相结合">将 HNSW 与其他方法相结合</h1>
<p>HNSW 可以与其他相似性搜索方法一起使用，以提供更好的性能。最流行的方法之一是将其与倒排文件索引和乘积量化 ( <em>IndexIVFPQ</em> ) 结合起来，这在本系列文章的其他部分中进行了描述。</p>
<p>在此范例中，HNSW 扮演IndexIVFPQ 粗量化器(<strong>coarse quantizer</strong>)的角色，这意味着它将负责查找最近的 Voronoi 分区，因此可以缩小搜索范围。为此，必须在所有 Voronoi 质心上构建 HNSW 索引。当给出查询时，HNSW 用于查找最近的 Voronoi 质心（而不是像以前那样通过比较到每个质心的距离进行强力搜索）。之后，查询向量在相应的 Voronoi 分区内进行量化，并使用 PQ 码计算距离。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/hierarchical-navigable-small-world-hnsw/11.png" alt="img"></p>
<p>​	<em>通过查找建立在 Voronoi 质心之上的 HNSW 中的最近邻居来选择最近的 Voronoi 质心</em>。</p>
<p>当仅使用倒排文件索引时，最好将 Voronoi 分区的数量设置得不要太大（例如 256 或 1024），因为会执行强力搜索来找到最近的质心。通过选择少量的 Voronoi 分区，每个分区内的候选者数量会变得相对较多。因此，该算法可以快速识别查询的最近质心，并且其大部分运行时间都集中在查找 Voronoi 分区内的最近邻居上。</p>
<p>然而，将 HNSW 引入工作流程需要进行调整。考虑仅在少量质心（256 或 1024）上运行 HNSW：HNSW 不会带来任何显著的好处，因为在向量数量较少的情况下，HNSW 在执行时间方面与朴素的暴力搜索相对相同。此外，HNSW 需要更多内存来存储图结构。</p>
<blockquote>
<p>这就是为什么在合并 HNSW 和倒排文件索引时，建议将 Voronoi 质心的数量设置得比平常大得多。通过这样做，每个 Voronoi 分区内的候选者数量变得少得多。</p>
</blockquote>
<p>这种范式的转变导致了以下设置：</p>
<ul>
<li>
<p>HNSW 在对数时间内快速识别最近的 Voronoi 质心。</p>
</li>
<li>
<p>之后，在各个 Voronoi 分区内执行穷举搜索。这应该不成问题，因为潜在候选人的数量很少。</p>
</li>
</ul>
<p><strong>注</strong>： 这种HNSW+IndexIVFPQ方式是最常用的方式，常结合场景数据结合硬件训练，调优，<a href="https://github.com/harsha-simhadri/big-ann-benchmarks">刷榜</a>。来处理B级别以上的embedding向量数据；需要关注 <strong>recall 召回率</strong>， <strong>内存使用率</strong> 和 <strong>搜索速度</strong>， 根据场景对这三方面进行取舍。（详情见： faiss复合索引 <a href="https://github.com/weedge/doraemon-nb/blob/main/faiss_composite_indexes.ipynb"><strong>faiss_composite_indexes.ipynb</strong></a>）</p>
<h1 id="faiss实现">FAISS实现</h1>
<p>根据<a href="https://faiss.ai/">Faiss 文档</a>中的信息，我们将了解如何利用 HNSW 并将其与倒排文件索引和乘积量化合并在一起。</p>
<h2 id="indexhnswflat">IndexHNSWFlat</h2>
<p>FAISS 有一个实现 HNSW 结构的<em>IndexHNSWFlat</em>类。与往常一样，后缀“ <em>Flat</em> ”表示数据集向量完全存储在索引中。构造函数接受 2 个参数：</p>
<ul>
<li><strong>d</strong>：数据维度。</li>
<li><strong>M</strong>：插入时每个新节点需要添加的边数。</li>
</ul>
<p>此外，通过<strong>hnsw</strong>字段，<em>IndexHNSWFlat</em>提供了几个有用的属性（可以修改）和方法：</p>
<ul>
<li><strong>hnsw.efConstruction</strong>：构建过程中要探索的最近邻居的数量。</li>
<li><strong>hnsw.efSearch</strong>：搜索期间要探索的最近邻居的数量。</li>
<li><strong>hnsw.max_level</strong>：返回最大层。</li>
<li><strong>hnsw.entry_point</strong>：返回入口点。</li>
<li><strong>faiss.vector_to_array(index.hnsw.levels)</strong>：返回每个向量的最大层列表</li>
<li><strong>hnsw.set_default_probas(M: int, level_mult: float)</strong>：允许分别设置<em>M</em>和<em>mL</em>值。默认情况下，<em>level_mult</em>设置为<em>1 / ln(M)</em>。</li>
</ul>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/hierarchical-navigable-small-world-hnsw/12.png" alt="img"></p>
<p><em>IndexHNSWFlat 的 Faiss 实现</em> (注：图中的efConstruction 和 efSearch 注释弄反了)</p>
<p><em>IndexHNSWFlat</em>设置<em>Mₘₐₓ = M</em>和<em>Mₘₐₓ₀ = 2 * M</em></p>
<h2 id="indexhnswflat--indexivfpq">IndexHNSWFlat + IndexIVFPQ</h2>
<p><em>IndexHNSWFlat</em>也可以与其他索引组合。其中一个示例是上一部分中描述的<em>IndexIVFPQ</em> 。该综合索引的创建分两个步骤进行：</p>
<ol>
<li><em>IndexHNSWFlat</em>被初始化为粗量化器。</li>
<li>量化器作为参数传递给<em>IndexIVFPQ</em>的构造函数。</li>
</ol>
<p>训练和添加可以通过使用不同或相同的数据来完成。</p>
<p><img src="https://github.com/weedge/mypic/raw/master/oneday/hierarchical-navigable-small-world-hnsw/13.png" alt="img"></p>
<p><em>IndexHNSWFlat + IndexIVFPQ 的 FAISS 实现</em></p>
<h1 id="结论">结论</h1>
<p>在本文中，我们研究了一种鲁棒算法，该算法特别适用于大型数据集向量。通过使用多层图表示和候选启发式选择，其搜索速度可以有效扩展，同时保持良好的预测精度。还值得注意的是，HNSW 可以与其他相似性搜索算法结合使用，使其非常灵活。</p>
<h1 id="reference">Reference</h1>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Six_degrees_of_separation">Six degrees of separation | Wikipedia</a></li>
<li><a href="https://en.wikipedia.org/wiki/Skip_list">Skip List | Wikipedia</a></li>
<li><a href="https://arxiv.org/pdf/1603.09320.pdf"><strong>Efficient and robust approximate nearest neighbor search using Hierarchical Navigable Small World graphs</strong>. Yu. A. Malkov, D. A. Yashunin</a></li>
<li><a href="https://faiss.ai/">Faiss documentation</a></li>
<li><a href="https://github.com/facebookresearch/faiss">Faiss repository</a></li>
<li><a href="https://github.com/facebookresearch/faiss/wiki/Faiss-indexes">Summary of Faiss indexes</a></li>
</ul>
<p><em>除非另有说明，所有图片均由作者提供</em>。</p>
<p>原文地址：<a href="https://towardsdatascience.com/similarity-search-part-4-hierarchical-navigable-small-world-hnsw-2aad4fe87d37">https://towardsdatascience.com/similarity-search-part-4-hierarchical-navigable-small-world-hnsw-2aad4fe87d37</a></p>
<p><strong>附操作学习笔记</strong>:</p>
<p><a href="https://github.com/weedge/doraemon-nb/blob/main/faiss_hnsw.ipynb"><strong>faiss_hnsw.ipynb</strong></a></p>
<p><a href="https://github.com/weedge/doraemon-nb/blob/main/faiss_vector_indexes.ipynb"><strong>faiss_vector_indexes.ipynb</strong></a></p>
<p><a href="https://github.com/weedge/doraemon-nb/blob/main/faiss_composite_indexes.ipynb"><strong>faiss_composite_indexes.ipynb</strong></a></p>
    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">weedge</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2023-09-25
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://weedge.github.io/tags/oneday/">oneday</a>
          <a href="https://weedge.github.io/tags/similarity-search/">similarity search</a>
          <a href="https://weedge.github.io/tags/hierarchical-navigable-small-world/">hierarchical navigable small world</a>
          <a href="https://weedge.github.io/tags/hnsw/">hnsw</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/oneday/similarity-search/5.locality-sensitive-hashing/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">译：相似性搜索，第 5 部分：局部敏感哈希 (LSH)</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/oneday/similarity-search/3.blending-inverted-file-index-and-product-quantization/">
            <span class="next-text nav-default">译：相似性搜索，第 3 部分：混合倒排文件索引和乘积量化</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    显示 Disqus 评论
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = "https://weedge.github.io/post/oneday/similarity-search/4.hierarchical-navigable-small-world-hnsw/";
    };
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'weedge';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:weege007@gmail.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/weedge" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://weibo.com/weedge" rel="me noopener" class="iconfont"
      title="weibo"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M385.714286 733.714286q12-19.428571 6.285714-39.428571t-25.714286-28.571429q-19.428571-8-41.714286-0.571429t-34.285714 26.285714q-12.571429 19.428571-7.428571 39.142857t24.571429 28.857143 42.571429 1.428571 35.714286-27.142857zm53.714286-69.142857q4.571429-7.428571 2-15.142857t-10-10.571429q-8-2.857143-16.285714 2.857143t-12.285714 10.571429q-9.714286 17.714286 7.428571 25.714286 8 2.857143 16.571429 2.857143t12.571429-10.571429zm99.428571 61.142857q-25.714286 58.285714-90.285714 85.714286t-128 6.857143q-61.142857-19.428571-84.285714-72.285714t3.714286-107.142857q26.857143-53.142857 86.571429-79.428571t120.285714-10.857143q63.428571 16.571429 90.571429 68.285714t1.428571 108.857143zm178.285714-91.428571q-5.142857-54.857143-50.857143-97.142857t-119.142857-62.285714-156.857143-12q-127.428571 13.142857-211.142857 80.857143t-75.714286 151.142857q5.142857 54.857143 50.857143 97.142857t119.142857 62.285714 156.857143 12q127.428571-13.142857 211.142857-80.857143t75.714286-151.142857zm176 2.285714q0 38.857143-21.142857 79.714286t-62.285714 78.285714-96.285714 67.142857-129.142857 47.428571-154.571429 17.714286-157.142857-19.142857-137.428571-53.142857-98-86.285714-37.142857-114q0-65.714286 39.714286-140t112.857143-147.428571q96.571429-96.571429 195.142857-134.857143t140.857143 4q37.142857 36.571429 11.428571 119.428571-2.285714 8-0.571429 11.428571t5.714286 4 8.285714 2.857143 7.714286-2l3.428571-1.142857q79.428571-33.714286 140.571429-33.714286t87.428571 34.857143q25.714286 36 0 101.714286-1.142857 7.428571-2.571429 11.428571t2.571429 7.142857 6.857143 4.285714 9.714286 3.428571q32.571429 10.285714 58.857143 26.857143t45.714286 46.571429 19.428571 66.571429zm-42.285714-356.571429q24 26.857143 31.142857 62t-3.714286 67.142857q-4.571429 13.142857-16.857143 19.428571t-25.428571 2.285714q-13.142857-4.571429-19.428571-16.857143t-2.285714-25.428571q11.428571-36-13.714286-63.428571t-61.142857-20q-13.714286 2.857143-25.714286-4.571429t-14.285714-21.142857q-2.857143-13.714286 4.571429-25.428571t21.142857-14.571429q34.285714-7.428571 68 3.142857t57.714286 37.428571zm103.428571-93.142857q49.714286 54.857143 64.285714 127.142857t-7.714286 138q-5.142857 15.428571-19.428571 22.857143t-29.714286 2.285714-22.857143-19.428571-2.857143-29.714286q16-46.857143 5.714286-98.285714t-45.714286-90.285714q-35.428571-39.428571-84.571429-54.571429t-98.857143-4.857143q-16 3.428571-29.714286-5.428571t-17.142857-24.857143 5.428571-29.428571 24.857143-16.857143q70.285714-14.857143 139.428571 6.571429t118.857143 76.857143z"></path>
</svg>

    </a>


<a href="https://weedge.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2013 -
    2025
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        weedge
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  









  <script id="dsq-count-scr" src="//weedge.disqus.com/count.js" async></script>






  <script src="/js/copy-to-clipboard.js"></script>


</body>
</html>
