<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>MP on </title>
    <link>https://weedge.github.io/tags/mp/</link>
    <description>Recent content in MP on </description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Fri, 07 Mar 2025 10:26:23 +0800</lastBuildDate><atom:link href="https://weedge.github.io/tags/mp/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>æ¨¡å‹ç³»ç»Ÿå·¥ç¨‹ï¼šæ¨¡å‹åˆ†å¸ƒå¼è®­ç»ƒå¹¶è¡Œç­–ç•¥</title>
      <link>https://weedge.github.io/post/llm/trainingparallelstrategy/</link>
      <pubDate>Fri, 07 Mar 2025 10:26:23 +0800</pubDate>
      
      <guid>https://weedge.github.io/post/llm/trainingparallelstrategy/</guid>
      <description>&lt;iframe frameborder=&#34;no&#34; border=&#34;0&#34; marginwidth=&#34;0&#34; marginheight=&#34;0&#34; width=330 height=86 src=&#34;//music.163.com/outchain/player?type=2&amp;id=28692286&amp;auto=1&amp;height=66&#34;&gt;&lt;/iframe&gt;



&lt;h2 id=&#34;å¼•è¨€&#34;&gt;å¼•è¨€&lt;/h2&gt;
&lt;p&gt;ä»¥å‰åœ¨è®­ç»ƒæ¨¡å‹çš„æ—¶å€™å¤§éƒ¨åˆ†ä½¿ç”¨çš„æ˜¯å•æœºå•å¡è¿›è¡Œè®­ç»ƒæµ‹è¯•ï¼ŒçœŸæ­£ä½¿ç”¨å•æœºå¤šå¡å’Œå¤šæœºå¤šå¡çš„æ—¶å€™ï¼Œå¾ˆå°‘å»å®æ“åˆ°åˆ†å¸ƒå¼çš„è®­ç»ƒæ¨ç†ï¼Œæœ¬èº«è¿™å—å¯¹åº”ç¡¬ä»¶çš„æˆæœ¬é«˜ï¼Œå¯¹äºä¸ªäººæ˜¯å¾ˆå°‘å¯ä»¥å»æŠŠç©ä¸Šçš„ï¼Œæ›´ä½•å†µç°åœ¨è®­ç»ƒå¤§æ¨¡å‹å¤§éƒ¨åˆ†ä½¿ç”¨çš„PTå¥½çš„æ¨¡å‹ï¼Œè¿›è¡Œå¾®è°ƒå’Œè’¸é¦ï¼Œæˆ–è€…é‡åŒ–éƒ¨ç½²ï¼Œéšç€deepseekç³»åˆ—æ¨¡å‹çš„å¼€æºï¼Œå¯¹æ¨¡å‹çš„è®­ç»ƒå¾®è°ƒå’Œéƒ¨ç½²çš„éœ€æ±‚å¢å¤šï¼Œé‡Œé¢æ¶‰åŠåˆ°çš„åˆ†å¸ƒå¼è®­ç»ƒç­–ç•¥ï¼Œæ€æ ·å¯¹æ¨¡å‹å’Œæ•°æ®è¿›è¡Œæ‹†åˆ†è¿›è¡Œå¤šå¡små¹¶è¡Œå¤„ç†, è¿™é‡Œç®€å•ä»‹ç»ä¸‹ç›¸å…³çš„åˆ†å¸ƒå¼è®­ç»ƒæ¨ç†å¹¶è¡Œç­–ç•¥ï¼Œä»¥åŠå¯¹åº”çš„ä»£ç ï¼Œä»£ç ä¸»è¦ä½¿ç”¨pytorchè¿›è¡Œå®ç°,é‡‡ç”¨å•èŠ‚ç‚¹çš„2ä¸ªgpuã€‚(å¦‚æœä½ æœ‰é’±çš„è¯ï¼Œå¯ä»¥å¤ç°ä¸‹ZeROæˆ–è€…Megatronä¸­çš„å®ç°ï¼‰&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ğŸ’¡ä½¿ç”¨ PyTorch è¿›è¡Œæ¨¡å‹è®­ç»ƒçš„è¿‡ç¨‹ï¼š&lt;/p&gt;
&lt;p&gt;PyTorch å°†å€¼ç»„ç»‡æˆTensor ï¼Œ Tensoræ˜¯å…·æœ‰ä¸°å¯Œæ•°æ®æ“ä½œæ“ä½œçš„é€šç”¨ n ç»´æ•°ç»„ã€‚Module å®šä¹‰ä»è¾“å…¥å€¼åˆ°è¾“å‡ºå€¼çš„è½¬æ¢ï¼Œå…¶åœ¨æ­£å‘ä¼ é€’æœŸé—´çš„è¡Œä¸ºç”±å…¶forwardæˆå‘˜å‡½æ•°æŒ‡å®šã€‚Module å¯ä»¥åŒ…å«Tensorä½œä¸ºå‚æ•°ã€‚ä¾‹å¦‚ï¼Œçº¿æ€§æ¨¡å—åŒ…å«æƒé‡å‚æ•°å’Œåå·®å‚æ•°ï¼Œå…¶æ­£å‘å‡½æ•°é€šè¿‡å°†è¾“å…¥ä¸æƒé‡ç›¸ä¹˜å¹¶æ·»åŠ åå·®æ¥ç”Ÿæˆè¾“å‡ºã€‚åº”ç”¨ç¨‹åºé€šè¿‡åœ¨è‡ªå®šä¹‰æ­£å‘å‡½æ•°ä¸­å°†æœ¬æœºModule ï¼ˆ&lt;em&gt;ä¾‹å¦‚&lt;/em&gt;çº¿æ€§ã€å·ç§¯ç­‰ï¼‰å’ŒFunction ï¼ˆä¾‹å¦‚reluã€pool ç­‰ï¼‰æ‹¼æ¥åœ¨ä¸€èµ·æ¥ç»„æˆè‡ªå·±çš„Module ã€‚å…¸å‹çš„è®­ç»ƒè¿­ä»£åŒ…å«ä½¿ç”¨è¾“å…¥å’Œæ ‡ç­¾ç”ŸæˆæŸå¤±çš„å‰å‘ä¼ é€’ã€ç”¨äºè®¡ç®—å‚æ•°æ¢¯åº¦çš„åå‘ä¼ é€’ä»¥åŠä½¿ç”¨æ¢¯åº¦æ›´æ–°å‚æ•°çš„ä¼˜åŒ–å™¨æ­¥éª¤ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œåœ¨æ­£å‘ä¼ é€’æœŸé—´ï¼ŒPyTorch ä¼šæ„å»ºä¸€ä¸ªè‡ªåŠ¨æ±‚å¯¼å›¾æ¥è®°å½•æ‰§è¡Œçš„æ“ä½œã€‚ç„¶åï¼Œåœ¨åå‘ä¼ æ’­ä¸­ï¼Œå®ƒä½¿ç”¨è‡ªåŠ¨æ¢¯åº¦å›¾è¿›è¡Œåå‘ä¼ æ’­ä»¥ç”Ÿæˆæ¢¯åº¦ã€‚æœ€åï¼Œä¼˜åŒ–å™¨åº”ç”¨æ¢¯åº¦æ¥æ›´æ–°å‚æ•°ã€‚è®­ç»ƒè¿‡ç¨‹é‡å¤è¿™ä¸‰ä¸ªæ­¥éª¤ï¼Œç›´åˆ°æ¨¡å‹æ”¶æ•›ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å¹¶è¡Œç­–ç•¥ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://github.com/user-attachments/assets/9616a34d-c9f3-4db9-b2a1-a79342a95856&#34; alt=&#34;&#34;&gt;&lt;/p&gt;
&lt;p&gt;Data Parallelism (DP) åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Distributed Data Parallelismï¼ˆDDPï¼‰&lt;/li&gt;
&lt;li&gt;Fully-Shared Data Parallelism (FSDP)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Model Parallelismï¼ˆMPï¼‰åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Tensor Parallelismï¼ˆTP, æœ‰äº›è®ºæ–‡ä¸­å°†TPæè¿°æˆMP,æ¯”å¦‚Megatron-LM, ZeROï¼‰&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Pipeline Parallelism (PP)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Expert Parallelism (EP)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Activation Partitioning åŒ…æ‹¬ï¼š(SPå’ŒCPä¸¤è€…é€šå¸¸å’ŒTPä¸€èµ·ä½¿ç”¨)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Sequence Parallelism (SP)ï¼š é’ˆå¯¹åºåˆ—åˆ‡åˆ†ï¼Œåœ¨æ¨¡å—çš„è¾“å…¥å’Œè¾“å‡ºä¾§å¯¹åºåˆ—è¿›è¡Œåˆ‡åˆ†ï¼Œå¸¸ä½¿ç”¨åœ¨LayerNorm,Dropoutï¼ˆé€šè¿‡all_gather,reduce-scatter é€šä¿¡è®¡ç®—ï¼Œå‡å°‘è®­ç»ƒæ—¶æ¿€æ´»å€¼ gpuå†…å­˜å ç”¨ï¼Œä»¥å‰æ˜¯æ¯ä¸ªå¡ä¸Šå•ç‹¬çš„å‰¯æœ¬LayerNorm,Dropoutï¼Œå†—ä½™gpuå†…å­˜ï¼‰&lt;/li&gt;
&lt;li&gt;Context Parallelism (CP): ä¸»è¦é’ˆå¯¹Transformeræ¨¡å‹é•¿åºåˆ—çš„è®­ç»ƒã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;DPå’ŒMPçš„æ¯”è¾ƒï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;DP çš„æ‰©å±•æ•ˆç‡æ¯” MP æ›´å¥½ï¼Œå› ä¸º MP é™ä½äº†è®¡ç®—çš„ç²’åº¦ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†é€šä¿¡å¼€é”€ã€‚è¶…è¿‡æŸä¸ªç‚¹åï¼Œè¾ƒä½çš„è®¡ç®—ç²’åº¦ä¼šé™ä½æ¯ä¸ª GPU çš„æ•ˆç‡ï¼Œè€Œå¢åŠ çš„é€šä¿¡å¼€é”€ä¼šé˜»ç¢è·¨ GPU çš„å¯æ‰©å±•æ€§ï¼Œå°¤å…¶æ˜¯è·¨è¶ŠèŠ‚ç‚¹è¾¹ç•Œæ—¶ã€‚ç›¸åï¼ŒDP æ—¢å…·æœ‰æ›´é«˜çš„è®¡ç®—ç²’åº¦ï¼Œåˆå…·æœ‰æ›´ä½çš„é€šä¿¡é‡ï¼Œä»è€Œå¯ä»¥å®ç°æ›´é«˜çš„æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;DP å†…å­˜(GPU HBM)æ•ˆç‡ä½ï¼Œå› ä¸ºæ¨¡å‹çŠ¶æ€åœ¨æ‰€æœ‰æ•°æ®å¹¶è¡Œè¿›ç¨‹ä¸­å†—ä½™å­˜å‚¨ã€‚ç›¸åï¼ŒMP å¯¹æ¨¡å‹çŠ¶æ€è¿›è¡Œåˆ†åŒºï¼Œä»¥æé«˜å†…å­˜æ•ˆç‡ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;DPå’ŒMPéƒ½ä¿å­˜äº†æ•´ä¸ªè®­ç»ƒè¿‡ç¨‹ä¸­éœ€è¦çš„æ‰€æœ‰æ¨¡å‹çŠ¶æ€ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çŠ¶æ€éƒ½æ˜¯ä¸€ç›´éœ€è¦çš„ï¼Œæ¯”å¦‚æ¯ä¸€å±‚å¯¹åº”çš„å‚æ•°åªåœ¨è¯¥å±‚çš„å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­æ—¶æ‰éœ€è¦ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ¨¡å‹è®­ç»ƒçš„å¹¶è¡Œç­–ç•¥åŒæ ·é€‚ç”¨äºæ¨ç†æµ‹çš„å¹¶è¡Œç­–ç•¥ï¼Œä½†æ˜¯è°ƒåº¦å’Œæ‰§è¡Œçš„æ–¹å¼ç¨æœ‰ä¸åŒã€‚è¿™é‡Œä¸»è¦æ˜¯ç»“åˆpytorch å®ç°ç®€å•çš„å¤šå¡æ¨¡å‹å¹¶è¡Œç­–ç•¥è®­ç»ƒã€‚&lt;/p&gt;
&lt;p&gt;ç›¸å…³çš„åˆ†å¸ƒå¼è®­ç»ƒæ¨ç†å¹¶è¡Œç­–ç•¥ï¼Œä»¥åŠå¯¹åº”çš„ä»£ç è¿è¡Œæ“ä½œdemoï¼Œå¯ä»¥æŸ¥çœ‹è¿™ä¸ªPR:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/ai-bot-pro/achatbot/pull/127&#34;&gt;https://github.com/ai-bot-pro/achatbot/pull/127&lt;/a&gt;  (å¦‚æœ‰ä¸å¯¹ï¼Œæ¬¢è¿æŒ‡å‡º~)&lt;/p&gt;</description>
    </item>
    
  </channel>
</rss>
